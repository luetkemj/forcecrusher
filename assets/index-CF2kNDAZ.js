var tT=Object.defineProperty;var eT=(e,t,r)=>t in e?tT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Jt=(e,t,r)=>(eT(e,typeof t!="symbol"?t+"":t,r),r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();var Rr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ga(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function rT(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),r}var _a={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */_a.exports;(function(e,t){(function(){var r,n="4.17.21",i=200,o="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",h="Invalid `variable` option passed into `_.template`",u="__lodash_hash_undefined__",f=500,d="__lodash_placeholder__",g=1,m=2,v=4,_=1,w=2,x=1,A=2,S=4,E=8,I=16,D=32,L=64,O=128,F=256,z=512,j=30,X="...",K=800,W=16,k=1,lt=2,dt=3,Y=1/0,yt=9007199254740991,Ot=17976931348623157e292,H=NaN,nt=4294967295,bt=nt-1,Pt=nt>>>1,Mt=[["ary",O],["bind",x],["bindKey",A],["curry",E],["curryRight",I],["flip",z],["partial",D],["partialRight",L],["rearg",F]],Nt="[object Arguments]",kt="[object Array]",ne="[object AsyncFunction]",jt="[object Boolean]",ie="[object Date]",oe="[object DOMException]",Dt="[object Error]",Ut="[object Function]",qt="[object GeneratorFunction]",Kt="[object Map]",ye="[object Number]",En="[object Null]",xr="[object Object]",Rc="[object Promise]",yy="[object Proxy]",Ki="[object RegExp]",rr="[object Set]",Zi="[object String]",zs="[object Symbol]",_y="[object Undefined]",Ji="[object WeakMap]",xy="[object WeakSet]",Qi="[object ArrayBuffer]",ti="[object DataView]",Ja="[object Float32Array]",Qa="[object Float64Array]",tl="[object Int8Array]",el="[object Int16Array]",rl="[object Int32Array]",nl="[object Uint8Array]",il="[object Uint8ClampedArray]",sl="[object Uint16Array]",ol="[object Uint32Array]",by=/\b__p \+= '';/g,wy=/\b(__p \+=) '' \+/g,Ey=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Mc=/&(?:amp|lt|gt|quot|#39);/g,Dc=/[&<>"']/g,Ty=RegExp(Mc.source),Ay=RegExp(Dc.source),Sy=/<%-([\s\S]+?)%>/g,Cy=/<%([\s\S]+?)%>/g,Bc=/<%=([\s\S]+?)%>/g,Iy=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Py=/^\w*$/,Ry=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,al=/[\\^$.*+?()[\]{}|]/g,My=RegExp(al.source),ll=/^\s+/,Dy=/\s/,By=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Oy=/\{\n\/\* \[wrapped with (.+)\] \*/,Fy=/,? & /,Ly=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ny=/[()=,{}\[\]\/\s]/,ky=/\\(\\)?/g,Uy=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Oc=/\w*$/,Gy=/^[-+]0x[0-9a-f]+$/i,Wy=/^0b[01]+$/i,$y=/^\[object .+?Constructor\]$/,Hy=/^0o[0-7]+$/i,zy=/^(?:0|[1-9]\d*)$/,Xy=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Xs=/($^)/,Vy=/['\n\r\u2028\u2029\\]/g,Vs="\\ud800-\\udfff",Yy="\\u0300-\\u036f",jy="\\ufe20-\\ufe2f",qy="\\u20d0-\\u20ff",Fc=Yy+jy+qy,Lc="\\u2700-\\u27bf",Nc="a-z\\xdf-\\xf6\\xf8-\\xff",Ky="\\xac\\xb1\\xd7\\xf7",Zy="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Jy="\\u2000-\\u206f",Qy=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",kc="A-Z\\xc0-\\xd6\\xd8-\\xde",Uc="\\ufe0e\\ufe0f",Gc=Ky+Zy+Jy+Qy,hl="['’]",t_="["+Vs+"]",Wc="["+Gc+"]",Ys="["+Fc+"]",$c="\\d+",e_="["+Lc+"]",Hc="["+Nc+"]",zc="[^"+Vs+Gc+$c+Lc+Nc+kc+"]",ul="\\ud83c[\\udffb-\\udfff]",r_="(?:"+Ys+"|"+ul+")",Xc="[^"+Vs+"]",cl="(?:\\ud83c[\\udde6-\\uddff]){2}",fl="[\\ud800-\\udbff][\\udc00-\\udfff]",ei="["+kc+"]",Vc="\\u200d",Yc="(?:"+Hc+"|"+zc+")",n_="(?:"+ei+"|"+zc+")",jc="(?:"+hl+"(?:d|ll|m|re|s|t|ve))?",qc="(?:"+hl+"(?:D|LL|M|RE|S|T|VE))?",Kc=r_+"?",Zc="["+Uc+"]?",i_="(?:"+Vc+"(?:"+[Xc,cl,fl].join("|")+")"+Zc+Kc+")*",s_="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",o_="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Jc=Zc+Kc+i_,a_="(?:"+[e_,cl,fl].join("|")+")"+Jc,l_="(?:"+[Xc+Ys+"?",Ys,cl,fl,t_].join("|")+")",h_=RegExp(hl,"g"),u_=RegExp(Ys,"g"),dl=RegExp(ul+"(?="+ul+")|"+l_+Jc,"g"),c_=RegExp([ei+"?"+Hc+"+"+jc+"(?="+[Wc,ei,"$"].join("|")+")",n_+"+"+qc+"(?="+[Wc,ei+Yc,"$"].join("|")+")",ei+"?"+Yc+"+"+jc,ei+"+"+qc,o_,s_,$c,a_].join("|"),"g"),f_=RegExp("["+Vc+Vs+Fc+Uc+"]"),d_=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,p_=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],g_=-1,Gt={};Gt[Ja]=Gt[Qa]=Gt[tl]=Gt[el]=Gt[rl]=Gt[nl]=Gt[il]=Gt[sl]=Gt[ol]=!0,Gt[Nt]=Gt[kt]=Gt[Qi]=Gt[jt]=Gt[ti]=Gt[ie]=Gt[Dt]=Gt[Ut]=Gt[Kt]=Gt[ye]=Gt[xr]=Gt[Ki]=Gt[rr]=Gt[Zi]=Gt[Ji]=!1;var Lt={};Lt[Nt]=Lt[kt]=Lt[Qi]=Lt[ti]=Lt[jt]=Lt[ie]=Lt[Ja]=Lt[Qa]=Lt[tl]=Lt[el]=Lt[rl]=Lt[Kt]=Lt[ye]=Lt[xr]=Lt[Ki]=Lt[rr]=Lt[Zi]=Lt[zs]=Lt[nl]=Lt[il]=Lt[sl]=Lt[ol]=!0,Lt[Dt]=Lt[Ut]=Lt[Ji]=!1;var m_={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},v_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},y_={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},__={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},x_=parseFloat,b_=parseInt,Qc=typeof Rr=="object"&&Rr&&Rr.Object===Object&&Rr,w_=typeof self=="object"&&self&&self.Object===Object&&self,de=Qc||w_||Function("return this")(),pl=t&&!t.nodeType&&t,Tn=pl&&!0&&e&&!e.nodeType&&e,tf=Tn&&Tn.exports===pl,gl=tf&&Qc.process,ze=function(){try{var R=Tn&&Tn.require&&Tn.require("util").types;return R||gl&&gl.binding&&gl.binding("util")}catch{}}(),ef=ze&&ze.isArrayBuffer,rf=ze&&ze.isDate,nf=ze&&ze.isMap,sf=ze&&ze.isRegExp,of=ze&&ze.isSet,af=ze&&ze.isTypedArray;function Oe(R,N,B){switch(B.length){case 0:return R.call(N);case 1:return R.call(N,B[0]);case 2:return R.call(N,B[0],B[1]);case 3:return R.call(N,B[0],B[1],B[2])}return R.apply(N,B)}function E_(R,N,B,Q){for(var ft=-1,It=R==null?0:R.length;++ft<It;){var ae=R[ft];N(Q,ae,B(ae),R)}return Q}function Xe(R,N){for(var B=-1,Q=R==null?0:R.length;++B<Q&&N(R[B],B,R)!==!1;);return R}function T_(R,N){for(var B=R==null?0:R.length;B--&&N(R[B],B,R)!==!1;);return R}function lf(R,N){for(var B=-1,Q=R==null?0:R.length;++B<Q;)if(!N(R[B],B,R))return!1;return!0}function Jr(R,N){for(var B=-1,Q=R==null?0:R.length,ft=0,It=[];++B<Q;){var ae=R[B];N(ae,B,R)&&(It[ft++]=ae)}return It}function js(R,N){var B=R==null?0:R.length;return!!B&&ri(R,N,0)>-1}function ml(R,N,B){for(var Q=-1,ft=R==null?0:R.length;++Q<ft;)if(B(N,R[Q]))return!0;return!1}function Wt(R,N){for(var B=-1,Q=R==null?0:R.length,ft=Array(Q);++B<Q;)ft[B]=N(R[B],B,R);return ft}function Qr(R,N){for(var B=-1,Q=N.length,ft=R.length;++B<Q;)R[ft+B]=N[B];return R}function vl(R,N,B,Q){var ft=-1,It=R==null?0:R.length;for(Q&&It&&(B=R[++ft]);++ft<It;)B=N(B,R[ft],ft,R);return B}function A_(R,N,B,Q){var ft=R==null?0:R.length;for(Q&&ft&&(B=R[--ft]);ft--;)B=N(B,R[ft],ft,R);return B}function yl(R,N){for(var B=-1,Q=R==null?0:R.length;++B<Q;)if(N(R[B],B,R))return!0;return!1}var S_=_l("length");function C_(R){return R.split("")}function I_(R){return R.match(Ly)||[]}function hf(R,N,B){var Q;return B(R,function(ft,It,ae){if(N(ft,It,ae))return Q=It,!1}),Q}function qs(R,N,B,Q){for(var ft=R.length,It=B+(Q?1:-1);Q?It--:++It<ft;)if(N(R[It],It,R))return It;return-1}function ri(R,N,B){return N===N?G_(R,N,B):qs(R,uf,B)}function P_(R,N,B,Q){for(var ft=B-1,It=R.length;++ft<It;)if(Q(R[ft],N))return ft;return-1}function uf(R){return R!==R}function cf(R,N){var B=R==null?0:R.length;return B?bl(R,N)/B:H}function _l(R){return function(N){return N==null?r:N[R]}}function xl(R){return function(N){return R==null?r:R[N]}}function ff(R,N,B,Q,ft){return ft(R,function(It,ae,Ft){B=Q?(Q=!1,It):N(B,It,ae,Ft)}),B}function R_(R,N){var B=R.length;for(R.sort(N);B--;)R[B]=R[B].value;return R}function bl(R,N){for(var B,Q=-1,ft=R.length;++Q<ft;){var It=N(R[Q]);It!==r&&(B=B===r?It:B+It)}return B}function wl(R,N){for(var B=-1,Q=Array(R);++B<R;)Q[B]=N(B);return Q}function M_(R,N){return Wt(N,function(B){return[B,R[B]]})}function df(R){return R&&R.slice(0,vf(R)+1).replace(ll,"")}function Fe(R){return function(N){return R(N)}}function El(R,N){return Wt(N,function(B){return R[B]})}function ts(R,N){return R.has(N)}function pf(R,N){for(var B=-1,Q=R.length;++B<Q&&ri(N,R[B],0)>-1;);return B}function gf(R,N){for(var B=R.length;B--&&ri(N,R[B],0)>-1;);return B}function D_(R,N){for(var B=R.length,Q=0;B--;)R[B]===N&&++Q;return Q}var B_=xl(m_),O_=xl(v_);function F_(R){return"\\"+__[R]}function L_(R,N){return R==null?r:R[N]}function ni(R){return f_.test(R)}function N_(R){return d_.test(R)}function k_(R){for(var N,B=[];!(N=R.next()).done;)B.push(N.value);return B}function Tl(R){var N=-1,B=Array(R.size);return R.forEach(function(Q,ft){B[++N]=[ft,Q]}),B}function mf(R,N){return function(B){return R(N(B))}}function tn(R,N){for(var B=-1,Q=R.length,ft=0,It=[];++B<Q;){var ae=R[B];(ae===N||ae===d)&&(R[B]=d,It[ft++]=B)}return It}function Ks(R){var N=-1,B=Array(R.size);return R.forEach(function(Q){B[++N]=Q}),B}function U_(R){var N=-1,B=Array(R.size);return R.forEach(function(Q){B[++N]=[Q,Q]}),B}function G_(R,N,B){for(var Q=B-1,ft=R.length;++Q<ft;)if(R[Q]===N)return Q;return-1}function W_(R,N,B){for(var Q=B+1;Q--;)if(R[Q]===N)return Q;return Q}function ii(R){return ni(R)?H_(R):S_(R)}function nr(R){return ni(R)?z_(R):C_(R)}function vf(R){for(var N=R.length;N--&&Dy.test(R.charAt(N)););return N}var $_=xl(y_);function H_(R){for(var N=dl.lastIndex=0;dl.test(R);)++N;return N}function z_(R){return R.match(dl)||[]}function X_(R){return R.match(c_)||[]}var V_=function R(N){N=N==null?de:si.defaults(de.Object(),N,si.pick(de,p_));var B=N.Array,Q=N.Date,ft=N.Error,It=N.Function,ae=N.Math,Ft=N.Object,Al=N.RegExp,Y_=N.String,Ve=N.TypeError,Zs=B.prototype,j_=It.prototype,oi=Ft.prototype,Js=N["__core-js_shared__"],Qs=j_.toString,Bt=oi.hasOwnProperty,q_=0,yf=function(){var s=/[^.]+$/.exec(Js&&Js.keys&&Js.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""}(),to=oi.toString,K_=Qs.call(Ft),Z_=de._,J_=Al("^"+Qs.call(Bt).replace(al,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),eo=tf?N.Buffer:r,en=N.Symbol,ro=N.Uint8Array,_f=eo?eo.allocUnsafe:r,no=mf(Ft.getPrototypeOf,Ft),xf=Ft.create,bf=oi.propertyIsEnumerable,io=Zs.splice,wf=en?en.isConcatSpreadable:r,es=en?en.iterator:r,An=en?en.toStringTag:r,so=function(){try{var s=Rn(Ft,"defineProperty");return s({},"",{}),s}catch{}}(),Q_=N.clearTimeout!==de.clearTimeout&&N.clearTimeout,t0=Q&&Q.now!==de.Date.now&&Q.now,e0=N.setTimeout!==de.setTimeout&&N.setTimeout,oo=ae.ceil,ao=ae.floor,Sl=Ft.getOwnPropertySymbols,r0=eo?eo.isBuffer:r,Ef=N.isFinite,n0=Zs.join,i0=mf(Ft.keys,Ft),le=ae.max,_e=ae.min,s0=Q.now,o0=N.parseInt,Tf=ae.random,a0=Zs.reverse,Cl=Rn(N,"DataView"),rs=Rn(N,"Map"),Il=Rn(N,"Promise"),ai=Rn(N,"Set"),ns=Rn(N,"WeakMap"),is=Rn(Ft,"create"),lo=ns&&new ns,li={},l0=Mn(Cl),h0=Mn(rs),u0=Mn(Il),c0=Mn(ai),f0=Mn(ns),ho=en?en.prototype:r,ss=ho?ho.valueOf:r,Af=ho?ho.toString:r;function b(s){if(Zt(s)&&!pt(s)&&!(s instanceof wt)){if(s instanceof Ye)return s;if(Bt.call(s,"__wrapped__"))return Sd(s)}return new Ye(s)}var hi=function(){function s(){}return function(a){if(!zt(a))return{};if(xf)return xf(a);s.prototype=a;var c=new s;return s.prototype=r,c}}();function uo(){}function Ye(s,a){this.__wrapped__=s,this.__actions__=[],this.__chain__=!!a,this.__index__=0,this.__values__=r}b.templateSettings={escape:Sy,evaluate:Cy,interpolate:Bc,variable:"",imports:{_:b}},b.prototype=uo.prototype,b.prototype.constructor=b,Ye.prototype=hi(uo.prototype),Ye.prototype.constructor=Ye;function wt(s){this.__wrapped__=s,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=nt,this.__views__=[]}function d0(){var s=new wt(this.__wrapped__);return s.__actions__=Ce(this.__actions__),s.__dir__=this.__dir__,s.__filtered__=this.__filtered__,s.__iteratees__=Ce(this.__iteratees__),s.__takeCount__=this.__takeCount__,s.__views__=Ce(this.__views__),s}function p0(){if(this.__filtered__){var s=new wt(this);s.__dir__=-1,s.__filtered__=!0}else s=this.clone(),s.__dir__*=-1;return s}function g0(){var s=this.__wrapped__.value(),a=this.__dir__,c=pt(s),p=a<0,y=c?s.length:0,T=Cx(0,y,this.__views__),C=T.start,P=T.end,M=P-C,U=p?P:C-1,G=this.__iteratees__,$=G.length,q=0,et=_e(M,this.__takeCount__);if(!c||!p&&y==M&&et==M)return qf(s,this.__actions__);var ht=[];t:for(;M--&&q<et;){U+=a;for(var vt=-1,ut=s[U];++vt<$;){var xt=G[vt],At=xt.iteratee,ke=xt.type,Ae=At(ut);if(ke==lt)ut=Ae;else if(!Ae){if(ke==k)continue t;break t}}ht[q++]=ut}return ht}wt.prototype=hi(uo.prototype),wt.prototype.constructor=wt;function Sn(s){var a=-1,c=s==null?0:s.length;for(this.clear();++a<c;){var p=s[a];this.set(p[0],p[1])}}function m0(){this.__data__=is?is(null):{},this.size=0}function v0(s){var a=this.has(s)&&delete this.__data__[s];return this.size-=a?1:0,a}function y0(s){var a=this.__data__;if(is){var c=a[s];return c===u?r:c}return Bt.call(a,s)?a[s]:r}function _0(s){var a=this.__data__;return is?a[s]!==r:Bt.call(a,s)}function x0(s,a){var c=this.__data__;return this.size+=this.has(s)?0:1,c[s]=is&&a===r?u:a,this}Sn.prototype.clear=m0,Sn.prototype.delete=v0,Sn.prototype.get=y0,Sn.prototype.has=_0,Sn.prototype.set=x0;function Lr(s){var a=-1,c=s==null?0:s.length;for(this.clear();++a<c;){var p=s[a];this.set(p[0],p[1])}}function b0(){this.__data__=[],this.size=0}function w0(s){var a=this.__data__,c=co(a,s);if(c<0)return!1;var p=a.length-1;return c==p?a.pop():io.call(a,c,1),--this.size,!0}function E0(s){var a=this.__data__,c=co(a,s);return c<0?r:a[c][1]}function T0(s){return co(this.__data__,s)>-1}function A0(s,a){var c=this.__data__,p=co(c,s);return p<0?(++this.size,c.push([s,a])):c[p][1]=a,this}Lr.prototype.clear=b0,Lr.prototype.delete=w0,Lr.prototype.get=E0,Lr.prototype.has=T0,Lr.prototype.set=A0;function Nr(s){var a=-1,c=s==null?0:s.length;for(this.clear();++a<c;){var p=s[a];this.set(p[0],p[1])}}function S0(){this.size=0,this.__data__={hash:new Sn,map:new(rs||Lr),string:new Sn}}function C0(s){var a=To(this,s).delete(s);return this.size-=a?1:0,a}function I0(s){return To(this,s).get(s)}function P0(s){return To(this,s).has(s)}function R0(s,a){var c=To(this,s),p=c.size;return c.set(s,a),this.size+=c.size==p?0:1,this}Nr.prototype.clear=S0,Nr.prototype.delete=C0,Nr.prototype.get=I0,Nr.prototype.has=P0,Nr.prototype.set=R0;function Cn(s){var a=-1,c=s==null?0:s.length;for(this.__data__=new Nr;++a<c;)this.add(s[a])}function M0(s){return this.__data__.set(s,u),this}function D0(s){return this.__data__.has(s)}Cn.prototype.add=Cn.prototype.push=M0,Cn.prototype.has=D0;function ir(s){var a=this.__data__=new Lr(s);this.size=a.size}function B0(){this.__data__=new Lr,this.size=0}function O0(s){var a=this.__data__,c=a.delete(s);return this.size=a.size,c}function F0(s){return this.__data__.get(s)}function L0(s){return this.__data__.has(s)}function N0(s,a){var c=this.__data__;if(c instanceof Lr){var p=c.__data__;if(!rs||p.length<i-1)return p.push([s,a]),this.size=++c.size,this;c=this.__data__=new Nr(p)}return c.set(s,a),this.size=c.size,this}ir.prototype.clear=B0,ir.prototype.delete=O0,ir.prototype.get=F0,ir.prototype.has=L0,ir.prototype.set=N0;function Sf(s,a){var c=pt(s),p=!c&&Dn(s),y=!c&&!p&&an(s),T=!c&&!p&&!y&&di(s),C=c||p||y||T,P=C?wl(s.length,Y_):[],M=P.length;for(var U in s)(a||Bt.call(s,U))&&!(C&&(U=="length"||y&&(U=="offset"||U=="parent")||T&&(U=="buffer"||U=="byteLength"||U=="byteOffset")||Wr(U,M)))&&P.push(U);return P}function Cf(s){var a=s.length;return a?s[Ul(0,a-1)]:r}function k0(s,a){return Ao(Ce(s),In(a,0,s.length))}function U0(s){return Ao(Ce(s))}function Pl(s,a,c){(c!==r&&!sr(s[a],c)||c===r&&!(a in s))&&kr(s,a,c)}function os(s,a,c){var p=s[a];(!(Bt.call(s,a)&&sr(p,c))||c===r&&!(a in s))&&kr(s,a,c)}function co(s,a){for(var c=s.length;c--;)if(sr(s[c][0],a))return c;return-1}function G0(s,a,c,p){return rn(s,function(y,T,C){a(p,y,c(y),C)}),p}function If(s,a){return s&&wr(a,ce(a),s)}function W0(s,a){return s&&wr(a,Pe(a),s)}function kr(s,a,c){a=="__proto__"&&so?so(s,a,{configurable:!0,enumerable:!0,value:c,writable:!0}):s[a]=c}function Rl(s,a){for(var c=-1,p=a.length,y=B(p),T=s==null;++c<p;)y[c]=T?r:uh(s,a[c]);return y}function In(s,a,c){return s===s&&(c!==r&&(s=s<=c?s:c),a!==r&&(s=s>=a?s:a)),s}function je(s,a,c,p,y,T){var C,P=a&g,M=a&m,U=a&v;if(c&&(C=y?c(s,p,y,T):c(s)),C!==r)return C;if(!zt(s))return s;var G=pt(s);if(G){if(C=Px(s),!P)return Ce(s,C)}else{var $=xe(s),q=$==Ut||$==qt;if(an(s))return Jf(s,P);if($==xr||$==Nt||q&&!y){if(C=M||q?{}:vd(s),!P)return M?yx(s,W0(C,s)):vx(s,If(C,s))}else{if(!Lt[$])return y?s:{};C=Rx(s,$,P)}}T=new ir;var et=T.get(s);if(et)return et;T.set(s,C),Vd(s)?s.forEach(function(ut){C.add(je(ut,a,c,ut,s,T))}):zd(s)&&s.forEach(function(ut,xt){C.set(xt,je(ut,a,c,xt,s,T))});var ht=U?M?Kl:ql:M?Pe:ce,vt=G?r:ht(s);return Xe(vt||s,function(ut,xt){vt&&(xt=ut,ut=s[xt]),os(C,xt,je(ut,a,c,xt,s,T))}),C}function $0(s){var a=ce(s);return function(c){return Pf(c,s,a)}}function Pf(s,a,c){var p=c.length;if(s==null)return!p;for(s=Ft(s);p--;){var y=c[p],T=a[y],C=s[y];if(C===r&&!(y in s)||!T(C))return!1}return!0}function Rf(s,a,c){if(typeof s!="function")throw new Ve(l);return ds(function(){s.apply(r,c)},a)}function as(s,a,c,p){var y=-1,T=js,C=!0,P=s.length,M=[],U=a.length;if(!P)return M;c&&(a=Wt(a,Fe(c))),p?(T=ml,C=!1):a.length>=i&&(T=ts,C=!1,a=new Cn(a));t:for(;++y<P;){var G=s[y],$=c==null?G:c(G);if(G=p||G!==0?G:0,C&&$===$){for(var q=U;q--;)if(a[q]===$)continue t;M.push(G)}else T(a,$,p)||M.push(G)}return M}var rn=nd(br),Mf=nd(Dl,!0);function H0(s,a){var c=!0;return rn(s,function(p,y,T){return c=!!a(p,y,T),c}),c}function fo(s,a,c){for(var p=-1,y=s.length;++p<y;){var T=s[p],C=a(T);if(C!=null&&(P===r?C===C&&!Ne(C):c(C,P)))var P=C,M=T}return M}function z0(s,a,c,p){var y=s.length;for(c=mt(c),c<0&&(c=-c>y?0:y+c),p=p===r||p>y?y:mt(p),p<0&&(p+=y),p=c>p?0:jd(p);c<p;)s[c++]=a;return s}function Df(s,a){var c=[];return rn(s,function(p,y,T){a(p,y,T)&&c.push(p)}),c}function pe(s,a,c,p,y){var T=-1,C=s.length;for(c||(c=Dx),y=[];++T<C;){var P=s[T];a>0&&c(P)?a>1?pe(P,a-1,c,p,y):Qr(y,P):p||(y[y.length]=P)}return y}var Ml=id(),Bf=id(!0);function br(s,a){return s&&Ml(s,a,ce)}function Dl(s,a){return s&&Bf(s,a,ce)}function po(s,a){return Jr(a,function(c){return $r(s[c])})}function Pn(s,a){a=sn(a,s);for(var c=0,p=a.length;s!=null&&c<p;)s=s[Er(a[c++])];return c&&c==p?s:r}function Of(s,a,c){var p=a(s);return pt(s)?p:Qr(p,c(s))}function Ee(s){return s==null?s===r?_y:En:An&&An in Ft(s)?Sx(s):Ux(s)}function Bl(s,a){return s>a}function X0(s,a){return s!=null&&Bt.call(s,a)}function V0(s,a){return s!=null&&a in Ft(s)}function Y0(s,a,c){return s>=_e(a,c)&&s<le(a,c)}function Ol(s,a,c){for(var p=c?ml:js,y=s[0].length,T=s.length,C=T,P=B(T),M=1/0,U=[];C--;){var G=s[C];C&&a&&(G=Wt(G,Fe(a))),M=_e(G.length,M),P[C]=!c&&(a||y>=120&&G.length>=120)?new Cn(C&&G):r}G=s[0];var $=-1,q=P[0];t:for(;++$<y&&U.length<M;){var et=G[$],ht=a?a(et):et;if(et=c||et!==0?et:0,!(q?ts(q,ht):p(U,ht,c))){for(C=T;--C;){var vt=P[C];if(!(vt?ts(vt,ht):p(s[C],ht,c)))continue t}q&&q.push(ht),U.push(et)}}return U}function j0(s,a,c,p){return br(s,function(y,T,C){a(p,c(y),T,C)}),p}function ls(s,a,c){a=sn(a,s),s=bd(s,a);var p=s==null?s:s[Er(Ke(a))];return p==null?r:Oe(p,s,c)}function Ff(s){return Zt(s)&&Ee(s)==Nt}function q0(s){return Zt(s)&&Ee(s)==Qi}function K0(s){return Zt(s)&&Ee(s)==ie}function hs(s,a,c,p,y){return s===a?!0:s==null||a==null||!Zt(s)&&!Zt(a)?s!==s&&a!==a:Z0(s,a,c,p,hs,y)}function Z0(s,a,c,p,y,T){var C=pt(s),P=pt(a),M=C?kt:xe(s),U=P?kt:xe(a);M=M==Nt?xr:M,U=U==Nt?xr:U;var G=M==xr,$=U==xr,q=M==U;if(q&&an(s)){if(!an(a))return!1;C=!0,G=!1}if(q&&!G)return T||(T=new ir),C||di(s)?pd(s,a,c,p,y,T):Tx(s,a,M,c,p,y,T);if(!(c&_)){var et=G&&Bt.call(s,"__wrapped__"),ht=$&&Bt.call(a,"__wrapped__");if(et||ht){var vt=et?s.value():s,ut=ht?a.value():a;return T||(T=new ir),y(vt,ut,c,p,T)}}return q?(T||(T=new ir),Ax(s,a,c,p,y,T)):!1}function J0(s){return Zt(s)&&xe(s)==Kt}function Fl(s,a,c,p){var y=c.length,T=y,C=!p;if(s==null)return!T;for(s=Ft(s);y--;){var P=c[y];if(C&&P[2]?P[1]!==s[P[0]]:!(P[0]in s))return!1}for(;++y<T;){P=c[y];var M=P[0],U=s[M],G=P[1];if(C&&P[2]){if(U===r&&!(M in s))return!1}else{var $=new ir;if(p)var q=p(U,G,M,s,a,$);if(!(q===r?hs(G,U,_|w,p,$):q))return!1}}return!0}function Lf(s){if(!zt(s)||Ox(s))return!1;var a=$r(s)?J_:$y;return a.test(Mn(s))}function Q0(s){return Zt(s)&&Ee(s)==Ki}function tx(s){return Zt(s)&&xe(s)==rr}function ex(s){return Zt(s)&&Mo(s.length)&&!!Gt[Ee(s)]}function Nf(s){return typeof s=="function"?s:s==null?Re:typeof s=="object"?pt(s)?Gf(s[0],s[1]):Uf(s):sp(s)}function Ll(s){if(!fs(s))return i0(s);var a=[];for(var c in Ft(s))Bt.call(s,c)&&c!="constructor"&&a.push(c);return a}function rx(s){if(!zt(s))return kx(s);var a=fs(s),c=[];for(var p in s)p=="constructor"&&(a||!Bt.call(s,p))||c.push(p);return c}function Nl(s,a){return s<a}function kf(s,a){var c=-1,p=Ie(s)?B(s.length):[];return rn(s,function(y,T,C){p[++c]=a(y,T,C)}),p}function Uf(s){var a=Jl(s);return a.length==1&&a[0][2]?_d(a[0][0],a[0][1]):function(c){return c===s||Fl(c,s,a)}}function Gf(s,a){return th(s)&&yd(a)?_d(Er(s),a):function(c){var p=uh(c,s);return p===r&&p===a?ch(c,s):hs(a,p,_|w)}}function go(s,a,c,p,y){s!==a&&Ml(a,function(T,C){if(y||(y=new ir),zt(T))nx(s,a,C,c,go,p,y);else{var P=p?p(rh(s,C),T,C+"",s,a,y):r;P===r&&(P=T),Pl(s,C,P)}},Pe)}function nx(s,a,c,p,y,T,C){var P=rh(s,c),M=rh(a,c),U=C.get(M);if(U){Pl(s,c,U);return}var G=T?T(P,M,c+"",s,a,C):r,$=G===r;if($){var q=pt(M),et=!q&&an(M),ht=!q&&!et&&di(M);G=M,q||et||ht?pt(P)?G=P:Qt(P)?G=Ce(P):et?($=!1,G=Jf(M,!0)):ht?($=!1,G=Qf(M,!0)):G=[]:ps(M)||Dn(M)?(G=P,Dn(P)?G=qd(P):(!zt(P)||$r(P))&&(G=vd(M))):$=!1}$&&(C.set(M,G),y(G,M,p,T,C),C.delete(M)),Pl(s,c,G)}function Wf(s,a){var c=s.length;if(c)return a+=a<0?c:0,Wr(a,c)?s[a]:r}function $f(s,a,c){a.length?a=Wt(a,function(T){return pt(T)?function(C){return Pn(C,T.length===1?T[0]:T)}:T}):a=[Re];var p=-1;a=Wt(a,Fe(at()));var y=kf(s,function(T,C,P){var M=Wt(a,function(U){return U(T)});return{criteria:M,index:++p,value:T}});return R_(y,function(T,C){return mx(T,C,c)})}function ix(s,a){return Hf(s,a,function(c,p){return ch(s,p)})}function Hf(s,a,c){for(var p=-1,y=a.length,T={};++p<y;){var C=a[p],P=Pn(s,C);c(P,C)&&us(T,sn(C,s),P)}return T}function sx(s){return function(a){return Pn(a,s)}}function kl(s,a,c,p){var y=p?P_:ri,T=-1,C=a.length,P=s;for(s===a&&(a=Ce(a)),c&&(P=Wt(s,Fe(c)));++T<C;)for(var M=0,U=a[T],G=c?c(U):U;(M=y(P,G,M,p))>-1;)P!==s&&io.call(P,M,1),io.call(s,M,1);return s}function zf(s,a){for(var c=s?a.length:0,p=c-1;c--;){var y=a[c];if(c==p||y!==T){var T=y;Wr(y)?io.call(s,y,1):$l(s,y)}}return s}function Ul(s,a){return s+ao(Tf()*(a-s+1))}function ox(s,a,c,p){for(var y=-1,T=le(oo((a-s)/(c||1)),0),C=B(T);T--;)C[p?T:++y]=s,s+=c;return C}function Gl(s,a){var c="";if(!s||a<1||a>yt)return c;do a%2&&(c+=s),a=ao(a/2),a&&(s+=s);while(a);return c}function _t(s,a){return nh(xd(s,a,Re),s+"")}function ax(s){return Cf(pi(s))}function lx(s,a){var c=pi(s);return Ao(c,In(a,0,c.length))}function us(s,a,c,p){if(!zt(s))return s;a=sn(a,s);for(var y=-1,T=a.length,C=T-1,P=s;P!=null&&++y<T;){var M=Er(a[y]),U=c;if(M==="__proto__"||M==="constructor"||M==="prototype")return s;if(y!=C){var G=P[M];U=p?p(G,M,P):r,U===r&&(U=zt(G)?G:Wr(a[y+1])?[]:{})}os(P,M,U),P=P[M]}return s}var Xf=lo?function(s,a){return lo.set(s,a),s}:Re,hx=so?function(s,a){return so(s,"toString",{configurable:!0,enumerable:!1,value:dh(a),writable:!0})}:Re;function ux(s){return Ao(pi(s))}function qe(s,a,c){var p=-1,y=s.length;a<0&&(a=-a>y?0:y+a),c=c>y?y:c,c<0&&(c+=y),y=a>c?0:c-a>>>0,a>>>=0;for(var T=B(y);++p<y;)T[p]=s[p+a];return T}function cx(s,a){var c;return rn(s,function(p,y,T){return c=a(p,y,T),!c}),!!c}function mo(s,a,c){var p=0,y=s==null?p:s.length;if(typeof a=="number"&&a===a&&y<=Pt){for(;p<y;){var T=p+y>>>1,C=s[T];C!==null&&!Ne(C)&&(c?C<=a:C<a)?p=T+1:y=T}return y}return Wl(s,a,Re,c)}function Wl(s,a,c,p){var y=0,T=s==null?0:s.length;if(T===0)return 0;a=c(a);for(var C=a!==a,P=a===null,M=Ne(a),U=a===r;y<T;){var G=ao((y+T)/2),$=c(s[G]),q=$!==r,et=$===null,ht=$===$,vt=Ne($);if(C)var ut=p||ht;else U?ut=ht&&(p||q):P?ut=ht&&q&&(p||!et):M?ut=ht&&q&&!et&&(p||!vt):et||vt?ut=!1:ut=p?$<=a:$<a;ut?y=G+1:T=G}return _e(T,bt)}function Vf(s,a){for(var c=-1,p=s.length,y=0,T=[];++c<p;){var C=s[c],P=a?a(C):C;if(!c||!sr(P,M)){var M=P;T[y++]=C===0?0:C}}return T}function Yf(s){return typeof s=="number"?s:Ne(s)?H:+s}function Le(s){if(typeof s=="string")return s;if(pt(s))return Wt(s,Le)+"";if(Ne(s))return Af?Af.call(s):"";var a=s+"";return a=="0"&&1/s==-Y?"-0":a}function nn(s,a,c){var p=-1,y=js,T=s.length,C=!0,P=[],M=P;if(c)C=!1,y=ml;else if(T>=i){var U=a?null:wx(s);if(U)return Ks(U);C=!1,y=ts,M=new Cn}else M=a?[]:P;t:for(;++p<T;){var G=s[p],$=a?a(G):G;if(G=c||G!==0?G:0,C&&$===$){for(var q=M.length;q--;)if(M[q]===$)continue t;a&&M.push($),P.push(G)}else y(M,$,c)||(M!==P&&M.push($),P.push(G))}return P}function $l(s,a){return a=sn(a,s),s=bd(s,a),s==null||delete s[Er(Ke(a))]}function jf(s,a,c,p){return us(s,a,c(Pn(s,a)),p)}function vo(s,a,c,p){for(var y=s.length,T=p?y:-1;(p?T--:++T<y)&&a(s[T],T,s););return c?qe(s,p?0:T,p?T+1:y):qe(s,p?T+1:0,p?y:T)}function qf(s,a){var c=s;return c instanceof wt&&(c=c.value()),vl(a,function(p,y){return y.func.apply(y.thisArg,Qr([p],y.args))},c)}function Hl(s,a,c){var p=s.length;if(p<2)return p?nn(s[0]):[];for(var y=-1,T=B(p);++y<p;)for(var C=s[y],P=-1;++P<p;)P!=y&&(T[y]=as(T[y]||C,s[P],a,c));return nn(pe(T,1),a,c)}function Kf(s,a,c){for(var p=-1,y=s.length,T=a.length,C={};++p<y;){var P=p<T?a[p]:r;c(C,s[p],P)}return C}function zl(s){return Qt(s)?s:[]}function Xl(s){return typeof s=="function"?s:Re}function sn(s,a){return pt(s)?s:th(s,a)?[s]:Ad(Rt(s))}var fx=_t;function on(s,a,c){var p=s.length;return c=c===r?p:c,!a&&c>=p?s:qe(s,a,c)}var Zf=Q_||function(s){return de.clearTimeout(s)};function Jf(s,a){if(a)return s.slice();var c=s.length,p=_f?_f(c):new s.constructor(c);return s.copy(p),p}function Vl(s){var a=new s.constructor(s.byteLength);return new ro(a).set(new ro(s)),a}function dx(s,a){var c=a?Vl(s.buffer):s.buffer;return new s.constructor(c,s.byteOffset,s.byteLength)}function px(s){var a=new s.constructor(s.source,Oc.exec(s));return a.lastIndex=s.lastIndex,a}function gx(s){return ss?Ft(ss.call(s)):{}}function Qf(s,a){var c=a?Vl(s.buffer):s.buffer;return new s.constructor(c,s.byteOffset,s.length)}function td(s,a){if(s!==a){var c=s!==r,p=s===null,y=s===s,T=Ne(s),C=a!==r,P=a===null,M=a===a,U=Ne(a);if(!P&&!U&&!T&&s>a||T&&C&&M&&!P&&!U||p&&C&&M||!c&&M||!y)return 1;if(!p&&!T&&!U&&s<a||U&&c&&y&&!p&&!T||P&&c&&y||!C&&y||!M)return-1}return 0}function mx(s,a,c){for(var p=-1,y=s.criteria,T=a.criteria,C=y.length,P=c.length;++p<C;){var M=td(y[p],T[p]);if(M){if(p>=P)return M;var U=c[p];return M*(U=="desc"?-1:1)}}return s.index-a.index}function ed(s,a,c,p){for(var y=-1,T=s.length,C=c.length,P=-1,M=a.length,U=le(T-C,0),G=B(M+U),$=!p;++P<M;)G[P]=a[P];for(;++y<C;)($||y<T)&&(G[c[y]]=s[y]);for(;U--;)G[P++]=s[y++];return G}function rd(s,a,c,p){for(var y=-1,T=s.length,C=-1,P=c.length,M=-1,U=a.length,G=le(T-P,0),$=B(G+U),q=!p;++y<G;)$[y]=s[y];for(var et=y;++M<U;)$[et+M]=a[M];for(;++C<P;)(q||y<T)&&($[et+c[C]]=s[y++]);return $}function Ce(s,a){var c=-1,p=s.length;for(a||(a=B(p));++c<p;)a[c]=s[c];return a}function wr(s,a,c,p){var y=!c;c||(c={});for(var T=-1,C=a.length;++T<C;){var P=a[T],M=p?p(c[P],s[P],P,c,s):r;M===r&&(M=s[P]),y?kr(c,P,M):os(c,P,M)}return c}function vx(s,a){return wr(s,Ql(s),a)}function yx(s,a){return wr(s,gd(s),a)}function yo(s,a){return function(c,p){var y=pt(c)?E_:G0,T=a?a():{};return y(c,s,at(p,2),T)}}function ui(s){return _t(function(a,c){var p=-1,y=c.length,T=y>1?c[y-1]:r,C=y>2?c[2]:r;for(T=s.length>3&&typeof T=="function"?(y--,T):r,C&&Te(c[0],c[1],C)&&(T=y<3?r:T,y=1),a=Ft(a);++p<y;){var P=c[p];P&&s(a,P,p,T)}return a})}function nd(s,a){return function(c,p){if(c==null)return c;if(!Ie(c))return s(c,p);for(var y=c.length,T=a?y:-1,C=Ft(c);(a?T--:++T<y)&&p(C[T],T,C)!==!1;);return c}}function id(s){return function(a,c,p){for(var y=-1,T=Ft(a),C=p(a),P=C.length;P--;){var M=C[s?P:++y];if(c(T[M],M,T)===!1)break}return a}}function _x(s,a,c){var p=a&x,y=cs(s);function T(){var C=this&&this!==de&&this instanceof T?y:s;return C.apply(p?c:this,arguments)}return T}function sd(s){return function(a){a=Rt(a);var c=ni(a)?nr(a):r,p=c?c[0]:a.charAt(0),y=c?on(c,1).join(""):a.slice(1);return p[s]()+y}}function ci(s){return function(a){return vl(np(rp(a).replace(h_,"")),s,"")}}function cs(s){return function(){var a=arguments;switch(a.length){case 0:return new s;case 1:return new s(a[0]);case 2:return new s(a[0],a[1]);case 3:return new s(a[0],a[1],a[2]);case 4:return new s(a[0],a[1],a[2],a[3]);case 5:return new s(a[0],a[1],a[2],a[3],a[4]);case 6:return new s(a[0],a[1],a[2],a[3],a[4],a[5]);case 7:return new s(a[0],a[1],a[2],a[3],a[4],a[5],a[6])}var c=hi(s.prototype),p=s.apply(c,a);return zt(p)?p:c}}function xx(s,a,c){var p=cs(s);function y(){for(var T=arguments.length,C=B(T),P=T,M=fi(y);P--;)C[P]=arguments[P];var U=T<3&&C[0]!==M&&C[T-1]!==M?[]:tn(C,M);if(T-=U.length,T<c)return ud(s,a,_o,y.placeholder,r,C,U,r,r,c-T);var G=this&&this!==de&&this instanceof y?p:s;return Oe(G,this,C)}return y}function od(s){return function(a,c,p){var y=Ft(a);if(!Ie(a)){var T=at(c,3);a=ce(a),c=function(P){return T(y[P],P,y)}}var C=s(a,c,p);return C>-1?y[T?a[C]:C]:r}}function ad(s){return Gr(function(a){var c=a.length,p=c,y=Ye.prototype.thru;for(s&&a.reverse();p--;){var T=a[p];if(typeof T!="function")throw new Ve(l);if(y&&!C&&Eo(T)=="wrapper")var C=new Ye([],!0)}for(p=C?p:c;++p<c;){T=a[p];var P=Eo(T),M=P=="wrapper"?Zl(T):r;M&&eh(M[0])&&M[1]==(O|E|D|F)&&!M[4].length&&M[9]==1?C=C[Eo(M[0])].apply(C,M[3]):C=T.length==1&&eh(T)?C[P]():C.thru(T)}return function(){var U=arguments,G=U[0];if(C&&U.length==1&&pt(G))return C.plant(G).value();for(var $=0,q=c?a[$].apply(this,U):G;++$<c;)q=a[$].call(this,q);return q}})}function _o(s,a,c,p,y,T,C,P,M,U){var G=a&O,$=a&x,q=a&A,et=a&(E|I),ht=a&z,vt=q?r:cs(s);function ut(){for(var xt=arguments.length,At=B(xt),ke=xt;ke--;)At[ke]=arguments[ke];if(et)var Ae=fi(ut),Ue=D_(At,Ae);if(p&&(At=ed(At,p,y,et)),T&&(At=rd(At,T,C,et)),xt-=Ue,et&&xt<U){var te=tn(At,Ae);return ud(s,a,_o,ut.placeholder,c,At,te,P,M,U-xt)}var or=$?c:this,zr=q?or[s]:s;return xt=At.length,P?At=Gx(At,P):ht&&xt>1&&At.reverse(),G&&M<xt&&(At.length=M),this&&this!==de&&this instanceof ut&&(zr=vt||cs(zr)),zr.apply(or,At)}return ut}function ld(s,a){return function(c,p){return j0(c,s,a(p),{})}}function xo(s,a){return function(c,p){var y;if(c===r&&p===r)return a;if(c!==r&&(y=c),p!==r){if(y===r)return p;typeof c=="string"||typeof p=="string"?(c=Le(c),p=Le(p)):(c=Yf(c),p=Yf(p)),y=s(c,p)}return y}}function Yl(s){return Gr(function(a){return a=Wt(a,Fe(at())),_t(function(c){var p=this;return s(a,function(y){return Oe(y,p,c)})})})}function bo(s,a){a=a===r?" ":Le(a);var c=a.length;if(c<2)return c?Gl(a,s):a;var p=Gl(a,oo(s/ii(a)));return ni(a)?on(nr(p),0,s).join(""):p.slice(0,s)}function bx(s,a,c,p){var y=a&x,T=cs(s);function C(){for(var P=-1,M=arguments.length,U=-1,G=p.length,$=B(G+M),q=this&&this!==de&&this instanceof C?T:s;++U<G;)$[U]=p[U];for(;M--;)$[U++]=arguments[++P];return Oe(q,y?c:this,$)}return C}function hd(s){return function(a,c,p){return p&&typeof p!="number"&&Te(a,c,p)&&(c=p=r),a=Hr(a),c===r?(c=a,a=0):c=Hr(c),p=p===r?a<c?1:-1:Hr(p),ox(a,c,p,s)}}function wo(s){return function(a,c){return typeof a=="string"&&typeof c=="string"||(a=Ze(a),c=Ze(c)),s(a,c)}}function ud(s,a,c,p,y,T,C,P,M,U){var G=a&E,$=G?C:r,q=G?r:C,et=G?T:r,ht=G?r:T;a|=G?D:L,a&=~(G?L:D),a&S||(a&=~(x|A));var vt=[s,a,y,et,$,ht,q,P,M,U],ut=c.apply(r,vt);return eh(s)&&wd(ut,vt),ut.placeholder=p,Ed(ut,s,a)}function jl(s){var a=ae[s];return function(c,p){if(c=Ze(c),p=p==null?0:_e(mt(p),292),p&&Ef(c)){var y=(Rt(c)+"e").split("e"),T=a(y[0]+"e"+(+y[1]+p));return y=(Rt(T)+"e").split("e"),+(y[0]+"e"+(+y[1]-p))}return a(c)}}var wx=ai&&1/Ks(new ai([,-0]))[1]==Y?function(s){return new ai(s)}:mh;function cd(s){return function(a){var c=xe(a);return c==Kt?Tl(a):c==rr?U_(a):M_(a,s(a))}}function Ur(s,a,c,p,y,T,C,P){var M=a&A;if(!M&&typeof s!="function")throw new Ve(l);var U=p?p.length:0;if(U||(a&=~(D|L),p=y=r),C=C===r?C:le(mt(C),0),P=P===r?P:mt(P),U-=y?y.length:0,a&L){var G=p,$=y;p=y=r}var q=M?r:Zl(s),et=[s,a,c,p,y,G,$,T,C,P];if(q&&Nx(et,q),s=et[0],a=et[1],c=et[2],p=et[3],y=et[4],P=et[9]=et[9]===r?M?0:s.length:le(et[9]-U,0),!P&&a&(E|I)&&(a&=~(E|I)),!a||a==x)var ht=_x(s,a,c);else a==E||a==I?ht=xx(s,a,P):(a==D||a==(x|D))&&!y.length?ht=bx(s,a,c,p):ht=_o.apply(r,et);var vt=q?Xf:wd;return Ed(vt(ht,et),s,a)}function fd(s,a,c,p){return s===r||sr(s,oi[c])&&!Bt.call(p,c)?a:s}function dd(s,a,c,p,y,T){return zt(s)&&zt(a)&&(T.set(a,s),go(s,a,r,dd,T),T.delete(a)),s}function Ex(s){return ps(s)?r:s}function pd(s,a,c,p,y,T){var C=c&_,P=s.length,M=a.length;if(P!=M&&!(C&&M>P))return!1;var U=T.get(s),G=T.get(a);if(U&&G)return U==a&&G==s;var $=-1,q=!0,et=c&w?new Cn:r;for(T.set(s,a),T.set(a,s);++$<P;){var ht=s[$],vt=a[$];if(p)var ut=C?p(vt,ht,$,a,s,T):p(ht,vt,$,s,a,T);if(ut!==r){if(ut)continue;q=!1;break}if(et){if(!yl(a,function(xt,At){if(!ts(et,At)&&(ht===xt||y(ht,xt,c,p,T)))return et.push(At)})){q=!1;break}}else if(!(ht===vt||y(ht,vt,c,p,T))){q=!1;break}}return T.delete(s),T.delete(a),q}function Tx(s,a,c,p,y,T,C){switch(c){case ti:if(s.byteLength!=a.byteLength||s.byteOffset!=a.byteOffset)return!1;s=s.buffer,a=a.buffer;case Qi:return!(s.byteLength!=a.byteLength||!T(new ro(s),new ro(a)));case jt:case ie:case ye:return sr(+s,+a);case Dt:return s.name==a.name&&s.message==a.message;case Ki:case Zi:return s==a+"";case Kt:var P=Tl;case rr:var M=p&_;if(P||(P=Ks),s.size!=a.size&&!M)return!1;var U=C.get(s);if(U)return U==a;p|=w,C.set(s,a);var G=pd(P(s),P(a),p,y,T,C);return C.delete(s),G;case zs:if(ss)return ss.call(s)==ss.call(a)}return!1}function Ax(s,a,c,p,y,T){var C=c&_,P=ql(s),M=P.length,U=ql(a),G=U.length;if(M!=G&&!C)return!1;for(var $=M;$--;){var q=P[$];if(!(C?q in a:Bt.call(a,q)))return!1}var et=T.get(s),ht=T.get(a);if(et&&ht)return et==a&&ht==s;var vt=!0;T.set(s,a),T.set(a,s);for(var ut=C;++$<M;){q=P[$];var xt=s[q],At=a[q];if(p)var ke=C?p(At,xt,q,a,s,T):p(xt,At,q,s,a,T);if(!(ke===r?xt===At||y(xt,At,c,p,T):ke)){vt=!1;break}ut||(ut=q=="constructor")}if(vt&&!ut){var Ae=s.constructor,Ue=a.constructor;Ae!=Ue&&"constructor"in s&&"constructor"in a&&!(typeof Ae=="function"&&Ae instanceof Ae&&typeof Ue=="function"&&Ue instanceof Ue)&&(vt=!1)}return T.delete(s),T.delete(a),vt}function Gr(s){return nh(xd(s,r,Pd),s+"")}function ql(s){return Of(s,ce,Ql)}function Kl(s){return Of(s,Pe,gd)}var Zl=lo?function(s){return lo.get(s)}:mh;function Eo(s){for(var a=s.name+"",c=li[a],p=Bt.call(li,a)?c.length:0;p--;){var y=c[p],T=y.func;if(T==null||T==s)return y.name}return a}function fi(s){var a=Bt.call(b,"placeholder")?b:s;return a.placeholder}function at(){var s=b.iteratee||ph;return s=s===ph?Nf:s,arguments.length?s(arguments[0],arguments[1]):s}function To(s,a){var c=s.__data__;return Bx(a)?c[typeof a=="string"?"string":"hash"]:c.map}function Jl(s){for(var a=ce(s),c=a.length;c--;){var p=a[c],y=s[p];a[c]=[p,y,yd(y)]}return a}function Rn(s,a){var c=L_(s,a);return Lf(c)?c:r}function Sx(s){var a=Bt.call(s,An),c=s[An];try{s[An]=r;var p=!0}catch{}var y=to.call(s);return p&&(a?s[An]=c:delete s[An]),y}var Ql=Sl?function(s){return s==null?[]:(s=Ft(s),Jr(Sl(s),function(a){return bf.call(s,a)}))}:vh,gd=Sl?function(s){for(var a=[];s;)Qr(a,Ql(s)),s=no(s);return a}:vh,xe=Ee;(Cl&&xe(new Cl(new ArrayBuffer(1)))!=ti||rs&&xe(new rs)!=Kt||Il&&xe(Il.resolve())!=Rc||ai&&xe(new ai)!=rr||ns&&xe(new ns)!=Ji)&&(xe=function(s){var a=Ee(s),c=a==xr?s.constructor:r,p=c?Mn(c):"";if(p)switch(p){case l0:return ti;case h0:return Kt;case u0:return Rc;case c0:return rr;case f0:return Ji}return a});function Cx(s,a,c){for(var p=-1,y=c.length;++p<y;){var T=c[p],C=T.size;switch(T.type){case"drop":s+=C;break;case"dropRight":a-=C;break;case"take":a=_e(a,s+C);break;case"takeRight":s=le(s,a-C);break}}return{start:s,end:a}}function Ix(s){var a=s.match(Oy);return a?a[1].split(Fy):[]}function md(s,a,c){a=sn(a,s);for(var p=-1,y=a.length,T=!1;++p<y;){var C=Er(a[p]);if(!(T=s!=null&&c(s,C)))break;s=s[C]}return T||++p!=y?T:(y=s==null?0:s.length,!!y&&Mo(y)&&Wr(C,y)&&(pt(s)||Dn(s)))}function Px(s){var a=s.length,c=new s.constructor(a);return a&&typeof s[0]=="string"&&Bt.call(s,"index")&&(c.index=s.index,c.input=s.input),c}function vd(s){return typeof s.constructor=="function"&&!fs(s)?hi(no(s)):{}}function Rx(s,a,c){var p=s.constructor;switch(a){case Qi:return Vl(s);case jt:case ie:return new p(+s);case ti:return dx(s,c);case Ja:case Qa:case tl:case el:case rl:case nl:case il:case sl:case ol:return Qf(s,c);case Kt:return new p;case ye:case Zi:return new p(s);case Ki:return px(s);case rr:return new p;case zs:return gx(s)}}function Mx(s,a){var c=a.length;if(!c)return s;var p=c-1;return a[p]=(c>1?"& ":"")+a[p],a=a.join(c>2?", ":" "),s.replace(By,`{
/* [wrapped with `+a+`] */
`)}function Dx(s){return pt(s)||Dn(s)||!!(wf&&s&&s[wf])}function Wr(s,a){var c=typeof s;return a=a??yt,!!a&&(c=="number"||c!="symbol"&&zy.test(s))&&s>-1&&s%1==0&&s<a}function Te(s,a,c){if(!zt(c))return!1;var p=typeof a;return(p=="number"?Ie(c)&&Wr(a,c.length):p=="string"&&a in c)?sr(c[a],s):!1}function th(s,a){if(pt(s))return!1;var c=typeof s;return c=="number"||c=="symbol"||c=="boolean"||s==null||Ne(s)?!0:Py.test(s)||!Iy.test(s)||a!=null&&s in Ft(a)}function Bx(s){var a=typeof s;return a=="string"||a=="number"||a=="symbol"||a=="boolean"?s!=="__proto__":s===null}function eh(s){var a=Eo(s),c=b[a];if(typeof c!="function"||!(a in wt.prototype))return!1;if(s===c)return!0;var p=Zl(c);return!!p&&s===p[0]}function Ox(s){return!!yf&&yf in s}var Fx=Js?$r:yh;function fs(s){var a=s&&s.constructor,c=typeof a=="function"&&a.prototype||oi;return s===c}function yd(s){return s===s&&!zt(s)}function _d(s,a){return function(c){return c==null?!1:c[s]===a&&(a!==r||s in Ft(c))}}function Lx(s){var a=Po(s,function(p){return c.size===f&&c.clear(),p}),c=a.cache;return a}function Nx(s,a){var c=s[1],p=a[1],y=c|p,T=y<(x|A|O),C=p==O&&c==E||p==O&&c==F&&s[7].length<=a[8]||p==(O|F)&&a[7].length<=a[8]&&c==E;if(!(T||C))return s;p&x&&(s[2]=a[2],y|=c&x?0:S);var P=a[3];if(P){var M=s[3];s[3]=M?ed(M,P,a[4]):P,s[4]=M?tn(s[3],d):a[4]}return P=a[5],P&&(M=s[5],s[5]=M?rd(M,P,a[6]):P,s[6]=M?tn(s[5],d):a[6]),P=a[7],P&&(s[7]=P),p&O&&(s[8]=s[8]==null?a[8]:_e(s[8],a[8])),s[9]==null&&(s[9]=a[9]),s[0]=a[0],s[1]=y,s}function kx(s){var a=[];if(s!=null)for(var c in Ft(s))a.push(c);return a}function Ux(s){return to.call(s)}function xd(s,a,c){return a=le(a===r?s.length-1:a,0),function(){for(var p=arguments,y=-1,T=le(p.length-a,0),C=B(T);++y<T;)C[y]=p[a+y];y=-1;for(var P=B(a+1);++y<a;)P[y]=p[y];return P[a]=c(C),Oe(s,this,P)}}function bd(s,a){return a.length<2?s:Pn(s,qe(a,0,-1))}function Gx(s,a){for(var c=s.length,p=_e(a.length,c),y=Ce(s);p--;){var T=a[p];s[p]=Wr(T,c)?y[T]:r}return s}function rh(s,a){if(!(a==="constructor"&&typeof s[a]=="function")&&a!="__proto__")return s[a]}var wd=Td(Xf),ds=e0||function(s,a){return de.setTimeout(s,a)},nh=Td(hx);function Ed(s,a,c){var p=a+"";return nh(s,Mx(p,Wx(Ix(p),c)))}function Td(s){var a=0,c=0;return function(){var p=s0(),y=W-(p-c);if(c=p,y>0){if(++a>=K)return arguments[0]}else a=0;return s.apply(r,arguments)}}function Ao(s,a){var c=-1,p=s.length,y=p-1;for(a=a===r?p:a;++c<a;){var T=Ul(c,y),C=s[T];s[T]=s[c],s[c]=C}return s.length=a,s}var Ad=Lx(function(s){var a=[];return s.charCodeAt(0)===46&&a.push(""),s.replace(Ry,function(c,p,y,T){a.push(y?T.replace(ky,"$1"):p||c)}),a});function Er(s){if(typeof s=="string"||Ne(s))return s;var a=s+"";return a=="0"&&1/s==-Y?"-0":a}function Mn(s){if(s!=null){try{return Qs.call(s)}catch{}try{return s+""}catch{}}return""}function Wx(s,a){return Xe(Mt,function(c){var p="_."+c[0];a&c[1]&&!js(s,p)&&s.push(p)}),s.sort()}function Sd(s){if(s instanceof wt)return s.clone();var a=new Ye(s.__wrapped__,s.__chain__);return a.__actions__=Ce(s.__actions__),a.__index__=s.__index__,a.__values__=s.__values__,a}function $x(s,a,c){(c?Te(s,a,c):a===r)?a=1:a=le(mt(a),0);var p=s==null?0:s.length;if(!p||a<1)return[];for(var y=0,T=0,C=B(oo(p/a));y<p;)C[T++]=qe(s,y,y+=a);return C}function Hx(s){for(var a=-1,c=s==null?0:s.length,p=0,y=[];++a<c;){var T=s[a];T&&(y[p++]=T)}return y}function zx(){var s=arguments.length;if(!s)return[];for(var a=B(s-1),c=arguments[0],p=s;p--;)a[p-1]=arguments[p];return Qr(pt(c)?Ce(c):[c],pe(a,1))}var Xx=_t(function(s,a){return Qt(s)?as(s,pe(a,1,Qt,!0)):[]}),Vx=_t(function(s,a){var c=Ke(a);return Qt(c)&&(c=r),Qt(s)?as(s,pe(a,1,Qt,!0),at(c,2)):[]}),Yx=_t(function(s,a){var c=Ke(a);return Qt(c)&&(c=r),Qt(s)?as(s,pe(a,1,Qt,!0),r,c):[]});function jx(s,a,c){var p=s==null?0:s.length;return p?(a=c||a===r?1:mt(a),qe(s,a<0?0:a,p)):[]}function qx(s,a,c){var p=s==null?0:s.length;return p?(a=c||a===r?1:mt(a),a=p-a,qe(s,0,a<0?0:a)):[]}function Kx(s,a){return s&&s.length?vo(s,at(a,3),!0,!0):[]}function Zx(s,a){return s&&s.length?vo(s,at(a,3),!0):[]}function Jx(s,a,c,p){var y=s==null?0:s.length;return y?(c&&typeof c!="number"&&Te(s,a,c)&&(c=0,p=y),z0(s,a,c,p)):[]}function Cd(s,a,c){var p=s==null?0:s.length;if(!p)return-1;var y=c==null?0:mt(c);return y<0&&(y=le(p+y,0)),qs(s,at(a,3),y)}function Id(s,a,c){var p=s==null?0:s.length;if(!p)return-1;var y=p-1;return c!==r&&(y=mt(c),y=c<0?le(p+y,0):_e(y,p-1)),qs(s,at(a,3),y,!0)}function Pd(s){var a=s==null?0:s.length;return a?pe(s,1):[]}function Qx(s){var a=s==null?0:s.length;return a?pe(s,Y):[]}function tb(s,a){var c=s==null?0:s.length;return c?(a=a===r?1:mt(a),pe(s,a)):[]}function eb(s){for(var a=-1,c=s==null?0:s.length,p={};++a<c;){var y=s[a];p[y[0]]=y[1]}return p}function Rd(s){return s&&s.length?s[0]:r}function rb(s,a,c){var p=s==null?0:s.length;if(!p)return-1;var y=c==null?0:mt(c);return y<0&&(y=le(p+y,0)),ri(s,a,y)}function nb(s){var a=s==null?0:s.length;return a?qe(s,0,-1):[]}var ib=_t(function(s){var a=Wt(s,zl);return a.length&&a[0]===s[0]?Ol(a):[]}),sb=_t(function(s){var a=Ke(s),c=Wt(s,zl);return a===Ke(c)?a=r:c.pop(),c.length&&c[0]===s[0]?Ol(c,at(a,2)):[]}),ob=_t(function(s){var a=Ke(s),c=Wt(s,zl);return a=typeof a=="function"?a:r,a&&c.pop(),c.length&&c[0]===s[0]?Ol(c,r,a):[]});function ab(s,a){return s==null?"":n0.call(s,a)}function Ke(s){var a=s==null?0:s.length;return a?s[a-1]:r}function lb(s,a,c){var p=s==null?0:s.length;if(!p)return-1;var y=p;return c!==r&&(y=mt(c),y=y<0?le(p+y,0):_e(y,p-1)),a===a?W_(s,a,y):qs(s,uf,y,!0)}function hb(s,a){return s&&s.length?Wf(s,mt(a)):r}var ub=_t(Md);function Md(s,a){return s&&s.length&&a&&a.length?kl(s,a):s}function cb(s,a,c){return s&&s.length&&a&&a.length?kl(s,a,at(c,2)):s}function fb(s,a,c){return s&&s.length&&a&&a.length?kl(s,a,r,c):s}var db=Gr(function(s,a){var c=s==null?0:s.length,p=Rl(s,a);return zf(s,Wt(a,function(y){return Wr(y,c)?+y:y}).sort(td)),p});function pb(s,a){var c=[];if(!(s&&s.length))return c;var p=-1,y=[],T=s.length;for(a=at(a,3);++p<T;){var C=s[p];a(C,p,s)&&(c.push(C),y.push(p))}return zf(s,y),c}function ih(s){return s==null?s:a0.call(s)}function gb(s,a,c){var p=s==null?0:s.length;return p?(c&&typeof c!="number"&&Te(s,a,c)?(a=0,c=p):(a=a==null?0:mt(a),c=c===r?p:mt(c)),qe(s,a,c)):[]}function mb(s,a){return mo(s,a)}function vb(s,a,c){return Wl(s,a,at(c,2))}function yb(s,a){var c=s==null?0:s.length;if(c){var p=mo(s,a);if(p<c&&sr(s[p],a))return p}return-1}function _b(s,a){return mo(s,a,!0)}function xb(s,a,c){return Wl(s,a,at(c,2),!0)}function bb(s,a){var c=s==null?0:s.length;if(c){var p=mo(s,a,!0)-1;if(sr(s[p],a))return p}return-1}function wb(s){return s&&s.length?Vf(s):[]}function Eb(s,a){return s&&s.length?Vf(s,at(a,2)):[]}function Tb(s){var a=s==null?0:s.length;return a?qe(s,1,a):[]}function Ab(s,a,c){return s&&s.length?(a=c||a===r?1:mt(a),qe(s,0,a<0?0:a)):[]}function Sb(s,a,c){var p=s==null?0:s.length;return p?(a=c||a===r?1:mt(a),a=p-a,qe(s,a<0?0:a,p)):[]}function Cb(s,a){return s&&s.length?vo(s,at(a,3),!1,!0):[]}function Ib(s,a){return s&&s.length?vo(s,at(a,3)):[]}var Pb=_t(function(s){return nn(pe(s,1,Qt,!0))}),Rb=_t(function(s){var a=Ke(s);return Qt(a)&&(a=r),nn(pe(s,1,Qt,!0),at(a,2))}),Mb=_t(function(s){var a=Ke(s);return a=typeof a=="function"?a:r,nn(pe(s,1,Qt,!0),r,a)});function Db(s){return s&&s.length?nn(s):[]}function Bb(s,a){return s&&s.length?nn(s,at(a,2)):[]}function Ob(s,a){return a=typeof a=="function"?a:r,s&&s.length?nn(s,r,a):[]}function sh(s){if(!(s&&s.length))return[];var a=0;return s=Jr(s,function(c){if(Qt(c))return a=le(c.length,a),!0}),wl(a,function(c){return Wt(s,_l(c))})}function Dd(s,a){if(!(s&&s.length))return[];var c=sh(s);return a==null?c:Wt(c,function(p){return Oe(a,r,p)})}var Fb=_t(function(s,a){return Qt(s)?as(s,a):[]}),Lb=_t(function(s){return Hl(Jr(s,Qt))}),Nb=_t(function(s){var a=Ke(s);return Qt(a)&&(a=r),Hl(Jr(s,Qt),at(a,2))}),kb=_t(function(s){var a=Ke(s);return a=typeof a=="function"?a:r,Hl(Jr(s,Qt),r,a)}),Ub=_t(sh);function Gb(s,a){return Kf(s||[],a||[],os)}function Wb(s,a){return Kf(s||[],a||[],us)}var $b=_t(function(s){var a=s.length,c=a>1?s[a-1]:r;return c=typeof c=="function"?(s.pop(),c):r,Dd(s,c)});function Bd(s){var a=b(s);return a.__chain__=!0,a}function Hb(s,a){return a(s),s}function So(s,a){return a(s)}var zb=Gr(function(s){var a=s.length,c=a?s[0]:0,p=this.__wrapped__,y=function(T){return Rl(T,s)};return a>1||this.__actions__.length||!(p instanceof wt)||!Wr(c)?this.thru(y):(p=p.slice(c,+c+(a?1:0)),p.__actions__.push({func:So,args:[y],thisArg:r}),new Ye(p,this.__chain__).thru(function(T){return a&&!T.length&&T.push(r),T}))});function Xb(){return Bd(this)}function Vb(){return new Ye(this.value(),this.__chain__)}function Yb(){this.__values__===r&&(this.__values__=Yd(this.value()));var s=this.__index__>=this.__values__.length,a=s?r:this.__values__[this.__index__++];return{done:s,value:a}}function jb(){return this}function qb(s){for(var a,c=this;c instanceof uo;){var p=Sd(c);p.__index__=0,p.__values__=r,a?y.__wrapped__=p:a=p;var y=p;c=c.__wrapped__}return y.__wrapped__=s,a}function Kb(){var s=this.__wrapped__;if(s instanceof wt){var a=s;return this.__actions__.length&&(a=new wt(this)),a=a.reverse(),a.__actions__.push({func:So,args:[ih],thisArg:r}),new Ye(a,this.__chain__)}return this.thru(ih)}function Zb(){return qf(this.__wrapped__,this.__actions__)}var Jb=yo(function(s,a,c){Bt.call(s,c)?++s[c]:kr(s,c,1)});function Qb(s,a,c){var p=pt(s)?lf:H0;return c&&Te(s,a,c)&&(a=r),p(s,at(a,3))}function t1(s,a){var c=pt(s)?Jr:Df;return c(s,at(a,3))}var e1=od(Cd),r1=od(Id);function n1(s,a){return pe(Co(s,a),1)}function i1(s,a){return pe(Co(s,a),Y)}function s1(s,a,c){return c=c===r?1:mt(c),pe(Co(s,a),c)}function Od(s,a){var c=pt(s)?Xe:rn;return c(s,at(a,3))}function Fd(s,a){var c=pt(s)?T_:Mf;return c(s,at(a,3))}var o1=yo(function(s,a,c){Bt.call(s,c)?s[c].push(a):kr(s,c,[a])});function a1(s,a,c,p){s=Ie(s)?s:pi(s),c=c&&!p?mt(c):0;var y=s.length;return c<0&&(c=le(y+c,0)),Do(s)?c<=y&&s.indexOf(a,c)>-1:!!y&&ri(s,a,c)>-1}var l1=_t(function(s,a,c){var p=-1,y=typeof a=="function",T=Ie(s)?B(s.length):[];return rn(s,function(C){T[++p]=y?Oe(a,C,c):ls(C,a,c)}),T}),h1=yo(function(s,a,c){kr(s,c,a)});function Co(s,a){var c=pt(s)?Wt:kf;return c(s,at(a,3))}function u1(s,a,c,p){return s==null?[]:(pt(a)||(a=a==null?[]:[a]),c=p?r:c,pt(c)||(c=c==null?[]:[c]),$f(s,a,c))}var c1=yo(function(s,a,c){s[c?0:1].push(a)},function(){return[[],[]]});function f1(s,a,c){var p=pt(s)?vl:ff,y=arguments.length<3;return p(s,at(a,4),c,y,rn)}function d1(s,a,c){var p=pt(s)?A_:ff,y=arguments.length<3;return p(s,at(a,4),c,y,Mf)}function p1(s,a){var c=pt(s)?Jr:Df;return c(s,Ro(at(a,3)))}function g1(s){var a=pt(s)?Cf:ax;return a(s)}function m1(s,a,c){(c?Te(s,a,c):a===r)?a=1:a=mt(a);var p=pt(s)?k0:lx;return p(s,a)}function v1(s){var a=pt(s)?U0:ux;return a(s)}function y1(s){if(s==null)return 0;if(Ie(s))return Do(s)?ii(s):s.length;var a=xe(s);return a==Kt||a==rr?s.size:Ll(s).length}function _1(s,a,c){var p=pt(s)?yl:cx;return c&&Te(s,a,c)&&(a=r),p(s,at(a,3))}var x1=_t(function(s,a){if(s==null)return[];var c=a.length;return c>1&&Te(s,a[0],a[1])?a=[]:c>2&&Te(a[0],a[1],a[2])&&(a=[a[0]]),$f(s,pe(a,1),[])}),Io=t0||function(){return de.Date.now()};function b1(s,a){if(typeof a!="function")throw new Ve(l);return s=mt(s),function(){if(--s<1)return a.apply(this,arguments)}}function Ld(s,a,c){return a=c?r:a,a=s&&a==null?s.length:a,Ur(s,O,r,r,r,r,a)}function Nd(s,a){var c;if(typeof a!="function")throw new Ve(l);return s=mt(s),function(){return--s>0&&(c=a.apply(this,arguments)),s<=1&&(a=r),c}}var oh=_t(function(s,a,c){var p=x;if(c.length){var y=tn(c,fi(oh));p|=D}return Ur(s,p,a,c,y)}),kd=_t(function(s,a,c){var p=x|A;if(c.length){var y=tn(c,fi(kd));p|=D}return Ur(a,p,s,c,y)});function Ud(s,a,c){a=c?r:a;var p=Ur(s,E,r,r,r,r,r,a);return p.placeholder=Ud.placeholder,p}function Gd(s,a,c){a=c?r:a;var p=Ur(s,I,r,r,r,r,r,a);return p.placeholder=Gd.placeholder,p}function Wd(s,a,c){var p,y,T,C,P,M,U=0,G=!1,$=!1,q=!0;if(typeof s!="function")throw new Ve(l);a=Ze(a)||0,zt(c)&&(G=!!c.leading,$="maxWait"in c,T=$?le(Ze(c.maxWait)||0,a):T,q="trailing"in c?!!c.trailing:q);function et(te){var or=p,zr=y;return p=y=r,U=te,C=s.apply(zr,or),C}function ht(te){return U=te,P=ds(xt,a),G?et(te):C}function vt(te){var or=te-M,zr=te-U,op=a-or;return $?_e(op,T-zr):op}function ut(te){var or=te-M,zr=te-U;return M===r||or>=a||or<0||$&&zr>=T}function xt(){var te=Io();if(ut(te))return At(te);P=ds(xt,vt(te))}function At(te){return P=r,q&&p?et(te):(p=y=r,C)}function ke(){P!==r&&Zf(P),U=0,p=M=y=P=r}function Ae(){return P===r?C:At(Io())}function Ue(){var te=Io(),or=ut(te);if(p=arguments,y=this,M=te,or){if(P===r)return ht(M);if($)return Zf(P),P=ds(xt,a),et(M)}return P===r&&(P=ds(xt,a)),C}return Ue.cancel=ke,Ue.flush=Ae,Ue}var w1=_t(function(s,a){return Rf(s,1,a)}),E1=_t(function(s,a,c){return Rf(s,Ze(a)||0,c)});function T1(s){return Ur(s,z)}function Po(s,a){if(typeof s!="function"||a!=null&&typeof a!="function")throw new Ve(l);var c=function(){var p=arguments,y=a?a.apply(this,p):p[0],T=c.cache;if(T.has(y))return T.get(y);var C=s.apply(this,p);return c.cache=T.set(y,C)||T,C};return c.cache=new(Po.Cache||Nr),c}Po.Cache=Nr;function Ro(s){if(typeof s!="function")throw new Ve(l);return function(){var a=arguments;switch(a.length){case 0:return!s.call(this);case 1:return!s.call(this,a[0]);case 2:return!s.call(this,a[0],a[1]);case 3:return!s.call(this,a[0],a[1],a[2])}return!s.apply(this,a)}}function A1(s){return Nd(2,s)}var S1=fx(function(s,a){a=a.length==1&&pt(a[0])?Wt(a[0],Fe(at())):Wt(pe(a,1),Fe(at()));var c=a.length;return _t(function(p){for(var y=-1,T=_e(p.length,c);++y<T;)p[y]=a[y].call(this,p[y]);return Oe(s,this,p)})}),ah=_t(function(s,a){var c=tn(a,fi(ah));return Ur(s,D,r,a,c)}),$d=_t(function(s,a){var c=tn(a,fi($d));return Ur(s,L,r,a,c)}),C1=Gr(function(s,a){return Ur(s,F,r,r,r,a)});function I1(s,a){if(typeof s!="function")throw new Ve(l);return a=a===r?a:mt(a),_t(s,a)}function P1(s,a){if(typeof s!="function")throw new Ve(l);return a=a==null?0:le(mt(a),0),_t(function(c){var p=c[a],y=on(c,0,a);return p&&Qr(y,p),Oe(s,this,y)})}function R1(s,a,c){var p=!0,y=!0;if(typeof s!="function")throw new Ve(l);return zt(c)&&(p="leading"in c?!!c.leading:p,y="trailing"in c?!!c.trailing:y),Wd(s,a,{leading:p,maxWait:a,trailing:y})}function M1(s){return Ld(s,1)}function D1(s,a){return ah(Xl(a),s)}function B1(){if(!arguments.length)return[];var s=arguments[0];return pt(s)?s:[s]}function O1(s){return je(s,v)}function F1(s,a){return a=typeof a=="function"?a:r,je(s,v,a)}function L1(s){return je(s,g|v)}function N1(s,a){return a=typeof a=="function"?a:r,je(s,g|v,a)}function k1(s,a){return a==null||Pf(s,a,ce(a))}function sr(s,a){return s===a||s!==s&&a!==a}var U1=wo(Bl),G1=wo(function(s,a){return s>=a}),Dn=Ff(function(){return arguments}())?Ff:function(s){return Zt(s)&&Bt.call(s,"callee")&&!bf.call(s,"callee")},pt=B.isArray,W1=ef?Fe(ef):q0;function Ie(s){return s!=null&&Mo(s.length)&&!$r(s)}function Qt(s){return Zt(s)&&Ie(s)}function $1(s){return s===!0||s===!1||Zt(s)&&Ee(s)==jt}var an=r0||yh,H1=rf?Fe(rf):K0;function z1(s){return Zt(s)&&s.nodeType===1&&!ps(s)}function X1(s){if(s==null)return!0;if(Ie(s)&&(pt(s)||typeof s=="string"||typeof s.splice=="function"||an(s)||di(s)||Dn(s)))return!s.length;var a=xe(s);if(a==Kt||a==rr)return!s.size;if(fs(s))return!Ll(s).length;for(var c in s)if(Bt.call(s,c))return!1;return!0}function V1(s,a){return hs(s,a)}function Y1(s,a,c){c=typeof c=="function"?c:r;var p=c?c(s,a):r;return p===r?hs(s,a,r,c):!!p}function lh(s){if(!Zt(s))return!1;var a=Ee(s);return a==Dt||a==oe||typeof s.message=="string"&&typeof s.name=="string"&&!ps(s)}function j1(s){return typeof s=="number"&&Ef(s)}function $r(s){if(!zt(s))return!1;var a=Ee(s);return a==Ut||a==qt||a==ne||a==yy}function Hd(s){return typeof s=="number"&&s==mt(s)}function Mo(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=yt}function zt(s){var a=typeof s;return s!=null&&(a=="object"||a=="function")}function Zt(s){return s!=null&&typeof s=="object"}var zd=nf?Fe(nf):J0;function q1(s,a){return s===a||Fl(s,a,Jl(a))}function K1(s,a,c){return c=typeof c=="function"?c:r,Fl(s,a,Jl(a),c)}function Z1(s){return Xd(s)&&s!=+s}function J1(s){if(Fx(s))throw new ft(o);return Lf(s)}function Q1(s){return s===null}function tw(s){return s==null}function Xd(s){return typeof s=="number"||Zt(s)&&Ee(s)==ye}function ps(s){if(!Zt(s)||Ee(s)!=xr)return!1;var a=no(s);if(a===null)return!0;var c=Bt.call(a,"constructor")&&a.constructor;return typeof c=="function"&&c instanceof c&&Qs.call(c)==K_}var hh=sf?Fe(sf):Q0;function ew(s){return Hd(s)&&s>=-yt&&s<=yt}var Vd=of?Fe(of):tx;function Do(s){return typeof s=="string"||!pt(s)&&Zt(s)&&Ee(s)==Zi}function Ne(s){return typeof s=="symbol"||Zt(s)&&Ee(s)==zs}var di=af?Fe(af):ex;function rw(s){return s===r}function nw(s){return Zt(s)&&xe(s)==Ji}function iw(s){return Zt(s)&&Ee(s)==xy}var sw=wo(Nl),ow=wo(function(s,a){return s<=a});function Yd(s){if(!s)return[];if(Ie(s))return Do(s)?nr(s):Ce(s);if(es&&s[es])return k_(s[es]());var a=xe(s),c=a==Kt?Tl:a==rr?Ks:pi;return c(s)}function Hr(s){if(!s)return s===0?s:0;if(s=Ze(s),s===Y||s===-Y){var a=s<0?-1:1;return a*Ot}return s===s?s:0}function mt(s){var a=Hr(s),c=a%1;return a===a?c?a-c:a:0}function jd(s){return s?In(mt(s),0,nt):0}function Ze(s){if(typeof s=="number")return s;if(Ne(s))return H;if(zt(s)){var a=typeof s.valueOf=="function"?s.valueOf():s;s=zt(a)?a+"":a}if(typeof s!="string")return s===0?s:+s;s=df(s);var c=Wy.test(s);return c||Hy.test(s)?b_(s.slice(2),c?2:8):Gy.test(s)?H:+s}function qd(s){return wr(s,Pe(s))}function aw(s){return s?In(mt(s),-yt,yt):s===0?s:0}function Rt(s){return s==null?"":Le(s)}var lw=ui(function(s,a){if(fs(a)||Ie(a)){wr(a,ce(a),s);return}for(var c in a)Bt.call(a,c)&&os(s,c,a[c])}),Kd=ui(function(s,a){wr(a,Pe(a),s)}),Bo=ui(function(s,a,c,p){wr(a,Pe(a),s,p)}),hw=ui(function(s,a,c,p){wr(a,ce(a),s,p)}),uw=Gr(Rl);function cw(s,a){var c=hi(s);return a==null?c:If(c,a)}var fw=_t(function(s,a){s=Ft(s);var c=-1,p=a.length,y=p>2?a[2]:r;for(y&&Te(a[0],a[1],y)&&(p=1);++c<p;)for(var T=a[c],C=Pe(T),P=-1,M=C.length;++P<M;){var U=C[P],G=s[U];(G===r||sr(G,oi[U])&&!Bt.call(s,U))&&(s[U]=T[U])}return s}),dw=_t(function(s){return s.push(r,dd),Oe(Zd,r,s)});function pw(s,a){return hf(s,at(a,3),br)}function gw(s,a){return hf(s,at(a,3),Dl)}function mw(s,a){return s==null?s:Ml(s,at(a,3),Pe)}function vw(s,a){return s==null?s:Bf(s,at(a,3),Pe)}function yw(s,a){return s&&br(s,at(a,3))}function _w(s,a){return s&&Dl(s,at(a,3))}function xw(s){return s==null?[]:po(s,ce(s))}function bw(s){return s==null?[]:po(s,Pe(s))}function uh(s,a,c){var p=s==null?r:Pn(s,a);return p===r?c:p}function ww(s,a){return s!=null&&md(s,a,X0)}function ch(s,a){return s!=null&&md(s,a,V0)}var Ew=ld(function(s,a,c){a!=null&&typeof a.toString!="function"&&(a=to.call(a)),s[a]=c},dh(Re)),Tw=ld(function(s,a,c){a!=null&&typeof a.toString!="function"&&(a=to.call(a)),Bt.call(s,a)?s[a].push(c):s[a]=[c]},at),Aw=_t(ls);function ce(s){return Ie(s)?Sf(s):Ll(s)}function Pe(s){return Ie(s)?Sf(s,!0):rx(s)}function Sw(s,a){var c={};return a=at(a,3),br(s,function(p,y,T){kr(c,a(p,y,T),p)}),c}function Cw(s,a){var c={};return a=at(a,3),br(s,function(p,y,T){kr(c,y,a(p,y,T))}),c}var Iw=ui(function(s,a,c){go(s,a,c)}),Zd=ui(function(s,a,c,p){go(s,a,c,p)}),Pw=Gr(function(s,a){var c={};if(s==null)return c;var p=!1;a=Wt(a,function(T){return T=sn(T,s),p||(p=T.length>1),T}),wr(s,Kl(s),c),p&&(c=je(c,g|m|v,Ex));for(var y=a.length;y--;)$l(c,a[y]);return c});function Rw(s,a){return Jd(s,Ro(at(a)))}var Mw=Gr(function(s,a){return s==null?{}:ix(s,a)});function Jd(s,a){if(s==null)return{};var c=Wt(Kl(s),function(p){return[p]});return a=at(a),Hf(s,c,function(p,y){return a(p,y[0])})}function Dw(s,a,c){a=sn(a,s);var p=-1,y=a.length;for(y||(y=1,s=r);++p<y;){var T=s==null?r:s[Er(a[p])];T===r&&(p=y,T=c),s=$r(T)?T.call(s):T}return s}function Bw(s,a,c){return s==null?s:us(s,a,c)}function Ow(s,a,c,p){return p=typeof p=="function"?p:r,s==null?s:us(s,a,c,p)}var Qd=cd(ce),tp=cd(Pe);function Fw(s,a,c){var p=pt(s),y=p||an(s)||di(s);if(a=at(a,4),c==null){var T=s&&s.constructor;y?c=p?new T:[]:zt(s)?c=$r(T)?hi(no(s)):{}:c={}}return(y?Xe:br)(s,function(C,P,M){return a(c,C,P,M)}),c}function Lw(s,a){return s==null?!0:$l(s,a)}function Nw(s,a,c){return s==null?s:jf(s,a,Xl(c))}function kw(s,a,c,p){return p=typeof p=="function"?p:r,s==null?s:jf(s,a,Xl(c),p)}function pi(s){return s==null?[]:El(s,ce(s))}function Uw(s){return s==null?[]:El(s,Pe(s))}function Gw(s,a,c){return c===r&&(c=a,a=r),c!==r&&(c=Ze(c),c=c===c?c:0),a!==r&&(a=Ze(a),a=a===a?a:0),In(Ze(s),a,c)}function Ww(s,a,c){return a=Hr(a),c===r?(c=a,a=0):c=Hr(c),s=Ze(s),Y0(s,a,c)}function $w(s,a,c){if(c&&typeof c!="boolean"&&Te(s,a,c)&&(a=c=r),c===r&&(typeof a=="boolean"?(c=a,a=r):typeof s=="boolean"&&(c=s,s=r)),s===r&&a===r?(s=0,a=1):(s=Hr(s),a===r?(a=s,s=0):a=Hr(a)),s>a){var p=s;s=a,a=p}if(c||s%1||a%1){var y=Tf();return _e(s+y*(a-s+x_("1e-"+((y+"").length-1))),a)}return Ul(s,a)}var Hw=ci(function(s,a,c){return a=a.toLowerCase(),s+(c?ep(a):a)});function ep(s){return fh(Rt(s).toLowerCase())}function rp(s){return s=Rt(s),s&&s.replace(Xy,B_).replace(u_,"")}function zw(s,a,c){s=Rt(s),a=Le(a);var p=s.length;c=c===r?p:In(mt(c),0,p);var y=c;return c-=a.length,c>=0&&s.slice(c,y)==a}function Xw(s){return s=Rt(s),s&&Ay.test(s)?s.replace(Dc,O_):s}function Vw(s){return s=Rt(s),s&&My.test(s)?s.replace(al,"\\$&"):s}var Yw=ci(function(s,a,c){return s+(c?"-":"")+a.toLowerCase()}),jw=ci(function(s,a,c){return s+(c?" ":"")+a.toLowerCase()}),qw=sd("toLowerCase");function Kw(s,a,c){s=Rt(s),a=mt(a);var p=a?ii(s):0;if(!a||p>=a)return s;var y=(a-p)/2;return bo(ao(y),c)+s+bo(oo(y),c)}function Zw(s,a,c){s=Rt(s),a=mt(a);var p=a?ii(s):0;return a&&p<a?s+bo(a-p,c):s}function Jw(s,a,c){s=Rt(s),a=mt(a);var p=a?ii(s):0;return a&&p<a?bo(a-p,c)+s:s}function Qw(s,a,c){return c||a==null?a=0:a&&(a=+a),o0(Rt(s).replace(ll,""),a||0)}function tE(s,a,c){return(c?Te(s,a,c):a===r)?a=1:a=mt(a),Gl(Rt(s),a)}function eE(){var s=arguments,a=Rt(s[0]);return s.length<3?a:a.replace(s[1],s[2])}var rE=ci(function(s,a,c){return s+(c?"_":"")+a.toLowerCase()});function nE(s,a,c){return c&&typeof c!="number"&&Te(s,a,c)&&(a=c=r),c=c===r?nt:c>>>0,c?(s=Rt(s),s&&(typeof a=="string"||a!=null&&!hh(a))&&(a=Le(a),!a&&ni(s))?on(nr(s),0,c):s.split(a,c)):[]}var iE=ci(function(s,a,c){return s+(c?" ":"")+fh(a)});function sE(s,a,c){return s=Rt(s),c=c==null?0:In(mt(c),0,s.length),a=Le(a),s.slice(c,c+a.length)==a}function oE(s,a,c){var p=b.templateSettings;c&&Te(s,a,c)&&(a=r),s=Rt(s),a=Bo({},a,p,fd);var y=Bo({},a.imports,p.imports,fd),T=ce(y),C=El(y,T),P,M,U=0,G=a.interpolate||Xs,$="__p += '",q=Al((a.escape||Xs).source+"|"+G.source+"|"+(G===Bc?Uy:Xs).source+"|"+(a.evaluate||Xs).source+"|$","g"),et="//# sourceURL="+(Bt.call(a,"sourceURL")?(a.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++g_+"]")+`
`;s.replace(q,function(ut,xt,At,ke,Ae,Ue){return At||(At=ke),$+=s.slice(U,Ue).replace(Vy,F_),xt&&(P=!0,$+=`' +
__e(`+xt+`) +
'`),Ae&&(M=!0,$+=`';
`+Ae+`;
__p += '`),At&&($+=`' +
((__t = (`+At+`)) == null ? '' : __t) +
'`),U=Ue+ut.length,ut}),$+=`';
`;var ht=Bt.call(a,"variable")&&a.variable;if(!ht)$=`with (obj) {
`+$+`
}
`;else if(Ny.test(ht))throw new ft(h);$=(M?$.replace(by,""):$).replace(wy,"$1").replace(Ey,"$1;"),$="function("+(ht||"obj")+`) {
`+(ht?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(P?", __e = _.escape":"")+(M?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+$+`return __p
}`;var vt=ip(function(){return It(T,et+"return "+$).apply(r,C)});if(vt.source=$,lh(vt))throw vt;return vt}function aE(s){return Rt(s).toLowerCase()}function lE(s){return Rt(s).toUpperCase()}function hE(s,a,c){if(s=Rt(s),s&&(c||a===r))return df(s);if(!s||!(a=Le(a)))return s;var p=nr(s),y=nr(a),T=pf(p,y),C=gf(p,y)+1;return on(p,T,C).join("")}function uE(s,a,c){if(s=Rt(s),s&&(c||a===r))return s.slice(0,vf(s)+1);if(!s||!(a=Le(a)))return s;var p=nr(s),y=gf(p,nr(a))+1;return on(p,0,y).join("")}function cE(s,a,c){if(s=Rt(s),s&&(c||a===r))return s.replace(ll,"");if(!s||!(a=Le(a)))return s;var p=nr(s),y=pf(p,nr(a));return on(p,y).join("")}function fE(s,a){var c=j,p=X;if(zt(a)){var y="separator"in a?a.separator:y;c="length"in a?mt(a.length):c,p="omission"in a?Le(a.omission):p}s=Rt(s);var T=s.length;if(ni(s)){var C=nr(s);T=C.length}if(c>=T)return s;var P=c-ii(p);if(P<1)return p;var M=C?on(C,0,P).join(""):s.slice(0,P);if(y===r)return M+p;if(C&&(P+=M.length-P),hh(y)){if(s.slice(P).search(y)){var U,G=M;for(y.global||(y=Al(y.source,Rt(Oc.exec(y))+"g")),y.lastIndex=0;U=y.exec(G);)var $=U.index;M=M.slice(0,$===r?P:$)}}else if(s.indexOf(Le(y),P)!=P){var q=M.lastIndexOf(y);q>-1&&(M=M.slice(0,q))}return M+p}function dE(s){return s=Rt(s),s&&Ty.test(s)?s.replace(Mc,$_):s}var pE=ci(function(s,a,c){return s+(c?" ":"")+a.toUpperCase()}),fh=sd("toUpperCase");function np(s,a,c){return s=Rt(s),a=c?r:a,a===r?N_(s)?X_(s):I_(s):s.match(a)||[]}var ip=_t(function(s,a){try{return Oe(s,r,a)}catch(c){return lh(c)?c:new ft(c)}}),gE=Gr(function(s,a){return Xe(a,function(c){c=Er(c),kr(s,c,oh(s[c],s))}),s});function mE(s){var a=s==null?0:s.length,c=at();return s=a?Wt(s,function(p){if(typeof p[1]!="function")throw new Ve(l);return[c(p[0]),p[1]]}):[],_t(function(p){for(var y=-1;++y<a;){var T=s[y];if(Oe(T[0],this,p))return Oe(T[1],this,p)}})}function vE(s){return $0(je(s,g))}function dh(s){return function(){return s}}function yE(s,a){return s==null||s!==s?a:s}var _E=ad(),xE=ad(!0);function Re(s){return s}function ph(s){return Nf(typeof s=="function"?s:je(s,g))}function bE(s){return Uf(je(s,g))}function wE(s,a){return Gf(s,je(a,g))}var EE=_t(function(s,a){return function(c){return ls(c,s,a)}}),TE=_t(function(s,a){return function(c){return ls(s,c,a)}});function gh(s,a,c){var p=ce(a),y=po(a,p);c==null&&!(zt(a)&&(y.length||!p.length))&&(c=a,a=s,s=this,y=po(a,ce(a)));var T=!(zt(c)&&"chain"in c)||!!c.chain,C=$r(s);return Xe(y,function(P){var M=a[P];s[P]=M,C&&(s.prototype[P]=function(){var U=this.__chain__;if(T||U){var G=s(this.__wrapped__),$=G.__actions__=Ce(this.__actions__);return $.push({func:M,args:arguments,thisArg:s}),G.__chain__=U,G}return M.apply(s,Qr([this.value()],arguments))})}),s}function AE(){return de._===this&&(de._=Z_),this}function mh(){}function SE(s){return s=mt(s),_t(function(a){return Wf(a,s)})}var CE=Yl(Wt),IE=Yl(lf),PE=Yl(yl);function sp(s){return th(s)?_l(Er(s)):sx(s)}function RE(s){return function(a){return s==null?r:Pn(s,a)}}var ME=hd(),DE=hd(!0);function vh(){return[]}function yh(){return!1}function BE(){return{}}function OE(){return""}function FE(){return!0}function LE(s,a){if(s=mt(s),s<1||s>yt)return[];var c=nt,p=_e(s,nt);a=at(a),s-=nt;for(var y=wl(p,a);++c<s;)a(c);return y}function NE(s){return pt(s)?Wt(s,Er):Ne(s)?[s]:Ce(Ad(Rt(s)))}function kE(s){var a=++q_;return Rt(s)+a}var UE=xo(function(s,a){return s+a},0),GE=jl("ceil"),WE=xo(function(s,a){return s/a},1),$E=jl("floor");function HE(s){return s&&s.length?fo(s,Re,Bl):r}function zE(s,a){return s&&s.length?fo(s,at(a,2),Bl):r}function XE(s){return cf(s,Re)}function VE(s,a){return cf(s,at(a,2))}function YE(s){return s&&s.length?fo(s,Re,Nl):r}function jE(s,a){return s&&s.length?fo(s,at(a,2),Nl):r}var qE=xo(function(s,a){return s*a},1),KE=jl("round"),ZE=xo(function(s,a){return s-a},0);function JE(s){return s&&s.length?bl(s,Re):0}function QE(s,a){return s&&s.length?bl(s,at(a,2)):0}return b.after=b1,b.ary=Ld,b.assign=lw,b.assignIn=Kd,b.assignInWith=Bo,b.assignWith=hw,b.at=uw,b.before=Nd,b.bind=oh,b.bindAll=gE,b.bindKey=kd,b.castArray=B1,b.chain=Bd,b.chunk=$x,b.compact=Hx,b.concat=zx,b.cond=mE,b.conforms=vE,b.constant=dh,b.countBy=Jb,b.create=cw,b.curry=Ud,b.curryRight=Gd,b.debounce=Wd,b.defaults=fw,b.defaultsDeep=dw,b.defer=w1,b.delay=E1,b.difference=Xx,b.differenceBy=Vx,b.differenceWith=Yx,b.drop=jx,b.dropRight=qx,b.dropRightWhile=Kx,b.dropWhile=Zx,b.fill=Jx,b.filter=t1,b.flatMap=n1,b.flatMapDeep=i1,b.flatMapDepth=s1,b.flatten=Pd,b.flattenDeep=Qx,b.flattenDepth=tb,b.flip=T1,b.flow=_E,b.flowRight=xE,b.fromPairs=eb,b.functions=xw,b.functionsIn=bw,b.groupBy=o1,b.initial=nb,b.intersection=ib,b.intersectionBy=sb,b.intersectionWith=ob,b.invert=Ew,b.invertBy=Tw,b.invokeMap=l1,b.iteratee=ph,b.keyBy=h1,b.keys=ce,b.keysIn=Pe,b.map=Co,b.mapKeys=Sw,b.mapValues=Cw,b.matches=bE,b.matchesProperty=wE,b.memoize=Po,b.merge=Iw,b.mergeWith=Zd,b.method=EE,b.methodOf=TE,b.mixin=gh,b.negate=Ro,b.nthArg=SE,b.omit=Pw,b.omitBy=Rw,b.once=A1,b.orderBy=u1,b.over=CE,b.overArgs=S1,b.overEvery=IE,b.overSome=PE,b.partial=ah,b.partialRight=$d,b.partition=c1,b.pick=Mw,b.pickBy=Jd,b.property=sp,b.propertyOf=RE,b.pull=ub,b.pullAll=Md,b.pullAllBy=cb,b.pullAllWith=fb,b.pullAt=db,b.range=ME,b.rangeRight=DE,b.rearg=C1,b.reject=p1,b.remove=pb,b.rest=I1,b.reverse=ih,b.sampleSize=m1,b.set=Bw,b.setWith=Ow,b.shuffle=v1,b.slice=gb,b.sortBy=x1,b.sortedUniq=wb,b.sortedUniqBy=Eb,b.split=nE,b.spread=P1,b.tail=Tb,b.take=Ab,b.takeRight=Sb,b.takeRightWhile=Cb,b.takeWhile=Ib,b.tap=Hb,b.throttle=R1,b.thru=So,b.toArray=Yd,b.toPairs=Qd,b.toPairsIn=tp,b.toPath=NE,b.toPlainObject=qd,b.transform=Fw,b.unary=M1,b.union=Pb,b.unionBy=Rb,b.unionWith=Mb,b.uniq=Db,b.uniqBy=Bb,b.uniqWith=Ob,b.unset=Lw,b.unzip=sh,b.unzipWith=Dd,b.update=Nw,b.updateWith=kw,b.values=pi,b.valuesIn=Uw,b.without=Fb,b.words=np,b.wrap=D1,b.xor=Lb,b.xorBy=Nb,b.xorWith=kb,b.zip=Ub,b.zipObject=Gb,b.zipObjectDeep=Wb,b.zipWith=$b,b.entries=Qd,b.entriesIn=tp,b.extend=Kd,b.extendWith=Bo,gh(b,b),b.add=UE,b.attempt=ip,b.camelCase=Hw,b.capitalize=ep,b.ceil=GE,b.clamp=Gw,b.clone=O1,b.cloneDeep=L1,b.cloneDeepWith=N1,b.cloneWith=F1,b.conformsTo=k1,b.deburr=rp,b.defaultTo=yE,b.divide=WE,b.endsWith=zw,b.eq=sr,b.escape=Xw,b.escapeRegExp=Vw,b.every=Qb,b.find=e1,b.findIndex=Cd,b.findKey=pw,b.findLast=r1,b.findLastIndex=Id,b.findLastKey=gw,b.floor=$E,b.forEach=Od,b.forEachRight=Fd,b.forIn=mw,b.forInRight=vw,b.forOwn=yw,b.forOwnRight=_w,b.get=uh,b.gt=U1,b.gte=G1,b.has=ww,b.hasIn=ch,b.head=Rd,b.identity=Re,b.includes=a1,b.indexOf=rb,b.inRange=Ww,b.invoke=Aw,b.isArguments=Dn,b.isArray=pt,b.isArrayBuffer=W1,b.isArrayLike=Ie,b.isArrayLikeObject=Qt,b.isBoolean=$1,b.isBuffer=an,b.isDate=H1,b.isElement=z1,b.isEmpty=X1,b.isEqual=V1,b.isEqualWith=Y1,b.isError=lh,b.isFinite=j1,b.isFunction=$r,b.isInteger=Hd,b.isLength=Mo,b.isMap=zd,b.isMatch=q1,b.isMatchWith=K1,b.isNaN=Z1,b.isNative=J1,b.isNil=tw,b.isNull=Q1,b.isNumber=Xd,b.isObject=zt,b.isObjectLike=Zt,b.isPlainObject=ps,b.isRegExp=hh,b.isSafeInteger=ew,b.isSet=Vd,b.isString=Do,b.isSymbol=Ne,b.isTypedArray=di,b.isUndefined=rw,b.isWeakMap=nw,b.isWeakSet=iw,b.join=ab,b.kebabCase=Yw,b.last=Ke,b.lastIndexOf=lb,b.lowerCase=jw,b.lowerFirst=qw,b.lt=sw,b.lte=ow,b.max=HE,b.maxBy=zE,b.mean=XE,b.meanBy=VE,b.min=YE,b.minBy=jE,b.stubArray=vh,b.stubFalse=yh,b.stubObject=BE,b.stubString=OE,b.stubTrue=FE,b.multiply=qE,b.nth=hb,b.noConflict=AE,b.noop=mh,b.now=Io,b.pad=Kw,b.padEnd=Zw,b.padStart=Jw,b.parseInt=Qw,b.random=$w,b.reduce=f1,b.reduceRight=d1,b.repeat=tE,b.replace=eE,b.result=Dw,b.round=KE,b.runInContext=R,b.sample=g1,b.size=y1,b.snakeCase=rE,b.some=_1,b.sortedIndex=mb,b.sortedIndexBy=vb,b.sortedIndexOf=yb,b.sortedLastIndex=_b,b.sortedLastIndexBy=xb,b.sortedLastIndexOf=bb,b.startCase=iE,b.startsWith=sE,b.subtract=ZE,b.sum=JE,b.sumBy=QE,b.template=oE,b.times=LE,b.toFinite=Hr,b.toInteger=mt,b.toLength=jd,b.toLower=aE,b.toNumber=Ze,b.toSafeInteger=aw,b.toString=Rt,b.toUpper=lE,b.trim=hE,b.trimEnd=uE,b.trimStart=cE,b.truncate=fE,b.unescape=dE,b.uniqueId=kE,b.upperCase=pE,b.upperFirst=fh,b.each=Od,b.eachRight=Fd,b.first=Rd,gh(b,function(){var s={};return br(b,function(a,c){Bt.call(b.prototype,c)||(s[c]=a)}),s}(),{chain:!1}),b.VERSION=n,Xe(["bind","bindKey","curry","curryRight","partial","partialRight"],function(s){b[s].placeholder=b}),Xe(["drop","take"],function(s,a){wt.prototype[s]=function(c){c=c===r?1:le(mt(c),0);var p=this.__filtered__&&!a?new wt(this):this.clone();return p.__filtered__?p.__takeCount__=_e(c,p.__takeCount__):p.__views__.push({size:_e(c,nt),type:s+(p.__dir__<0?"Right":"")}),p},wt.prototype[s+"Right"]=function(c){return this.reverse()[s](c).reverse()}}),Xe(["filter","map","takeWhile"],function(s,a){var c=a+1,p=c==k||c==dt;wt.prototype[s]=function(y){var T=this.clone();return T.__iteratees__.push({iteratee:at(y,3),type:c}),T.__filtered__=T.__filtered__||p,T}}),Xe(["head","last"],function(s,a){var c="take"+(a?"Right":"");wt.prototype[s]=function(){return this[c](1).value()[0]}}),Xe(["initial","tail"],function(s,a){var c="drop"+(a?"":"Right");wt.prototype[s]=function(){return this.__filtered__?new wt(this):this[c](1)}}),wt.prototype.compact=function(){return this.filter(Re)},wt.prototype.find=function(s){return this.filter(s).head()},wt.prototype.findLast=function(s){return this.reverse().find(s)},wt.prototype.invokeMap=_t(function(s,a){return typeof s=="function"?new wt(this):this.map(function(c){return ls(c,s,a)})}),wt.prototype.reject=function(s){return this.filter(Ro(at(s)))},wt.prototype.slice=function(s,a){s=mt(s);var c=this;return c.__filtered__&&(s>0||a<0)?new wt(c):(s<0?c=c.takeRight(-s):s&&(c=c.drop(s)),a!==r&&(a=mt(a),c=a<0?c.dropRight(-a):c.take(a-s)),c)},wt.prototype.takeRightWhile=function(s){return this.reverse().takeWhile(s).reverse()},wt.prototype.toArray=function(){return this.take(nt)},br(wt.prototype,function(s,a){var c=/^(?:filter|find|map|reject)|While$/.test(a),p=/^(?:head|last)$/.test(a),y=b[p?"take"+(a=="last"?"Right":""):a],T=p||/^find/.test(a);y&&(b.prototype[a]=function(){var C=this.__wrapped__,P=p?[1]:arguments,M=C instanceof wt,U=P[0],G=M||pt(C),$=function(xt){var At=y.apply(b,Qr([xt],P));return p&&q?At[0]:At};G&&c&&typeof U=="function"&&U.length!=1&&(M=G=!1);var q=this.__chain__,et=!!this.__actions__.length,ht=T&&!q,vt=M&&!et;if(!T&&G){C=vt?C:new wt(this);var ut=s.apply(C,P);return ut.__actions__.push({func:So,args:[$],thisArg:r}),new Ye(ut,q)}return ht&&vt?s.apply(this,P):(ut=this.thru($),ht?p?ut.value()[0]:ut.value():ut)})}),Xe(["pop","push","shift","sort","splice","unshift"],function(s){var a=Zs[s],c=/^(?:push|sort|unshift)$/.test(s)?"tap":"thru",p=/^(?:pop|shift)$/.test(s);b.prototype[s]=function(){var y=arguments;if(p&&!this.__chain__){var T=this.value();return a.apply(pt(T)?T:[],y)}return this[c](function(C){return a.apply(pt(C)?C:[],y)})}}),br(wt.prototype,function(s,a){var c=b[a];if(c){var p=c.name+"";Bt.call(li,p)||(li[p]=[]),li[p].push({name:a,func:c})}}),li[_o(r,A).name]=[{name:"wrapper",func:r}],wt.prototype.clone=d0,wt.prototype.reverse=p0,wt.prototype.value=g0,b.prototype.at=zb,b.prototype.chain=Xb,b.prototype.commit=Vb,b.prototype.next=Yb,b.prototype.plant=qb,b.prototype.reverse=Kb,b.prototype.toJSON=b.prototype.valueOf=b.prototype.value=Zb,b.prototype.first=b.prototype.head,es&&(b.prototype[es]=jb),b},si=V_();Tn?((Tn.exports=si)._=si,pl._=si):de._=si}).call(Rr)})(_a,_a.exports);var be=_a.exports;const Bn=Ga(be);var Qn=(e=>(e[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2",e))(Qn||{}),du=(e=>(e[e.COLOR=16384]="COLOR",e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL",e))(du||{}),ct=(e=>(e[e.NORMAL=0]="NORMAL",e[e.ADD=1]="ADD",e[e.MULTIPLY=2]="MULTIPLY",e[e.SCREEN=3]="SCREEN",e[e.OVERLAY=4]="OVERLAY",e[e.DARKEN=5]="DARKEN",e[e.LIGHTEN=6]="LIGHTEN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.COLOR_BURN=8]="COLOR_BURN",e[e.HARD_LIGHT=9]="HARD_LIGHT",e[e.SOFT_LIGHT=10]="SOFT_LIGHT",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.EXCLUSION=12]="EXCLUSION",e[e.HUE=13]="HUE",e[e.SATURATION=14]="SATURATION",e[e.COLOR=15]="COLOR",e[e.LUMINOSITY=16]="LUMINOSITY",e[e.NORMAL_NPM=17]="NORMAL_NPM",e[e.ADD_NPM=18]="ADD_NPM",e[e.SCREEN_NPM=19]="SCREEN_NPM",e[e.NONE=20]="NONE",e[e.SRC_OVER=0]="SRC_OVER",e[e.SRC_IN=21]="SRC_IN",e[e.SRC_OUT=22]="SRC_OUT",e[e.SRC_ATOP=23]="SRC_ATOP",e[e.DST_OVER=24]="DST_OVER",e[e.DST_IN=25]="DST_IN",e[e.DST_OUT=26]="DST_OUT",e[e.DST_ATOP=27]="DST_ATOP",e[e.ERASE=26]="ERASE",e[e.SUBTRACT=28]="SUBTRACT",e[e.XOR=29]="XOR",e))(ct||{}),Mr=(e=>(e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e))(Mr||{}),V=(e=>(e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e))(V||{}),Ri=(e=>(e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e))(Ri||{}),ot=(e=>(e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT",e))(ot||{}),pu=(e=>(e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT",e[e.UINT=2]="UINT",e))(pu||{}),Yr=(e=>(e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e))(Yr||{}),gn=(e=>(e[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e))(gn||{}),Or=(e=>(e[e.OFF=0]="OFF",e[e.POW2=1]="POW2",e[e.ON=2]="ON",e[e.ON_MANUAL=3]="ON_MANUAL",e))(Or||{}),_r=(e=>(e[e.NPM=0]="NPM",e[e.UNPACK=1]="UNPACK",e[e.PMA=2]="PMA",e[e.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",e[e.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",e[e.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",e))(_r||{}),Ir=(e=>(e[e.NO=0]="NO",e[e.YES=1]="YES",e[e.AUTO=2]="AUTO",e[e.BLEND=0]="BLEND",e[e.CLEAR=1]="CLEAR",e[e.BLIT=2]="BLIT",e))(Ir||{}),rc=(e=>(e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL",e))(rc||{}),tr=(e=>(e.LOW="lowp",e.MEDIUM="mediump",e.HIGH="highp",e))(tr||{}),ue=(e=>(e[e.NONE=0]="NONE",e[e.SCISSOR=1]="SCISSOR",e[e.STENCIL=2]="STENCIL",e[e.SPRITE=3]="SPRITE",e[e.COLOR=4]="COLOR",e))(ue||{}),se=(e=>(e[e.NONE=0]="NONE",e[e.LOW=2]="LOW",e[e.MEDIUM=4]="MEDIUM",e[e.HIGH=8]="HIGH",e))(se||{}),Dr=(e=>(e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e))(Dr||{});const nT={createCanvas:(e,t)=>{const r=document.createElement("canvas");return r.width=e,r.height=t,r},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(e,t)=>fetch(e,t),parseXML:e=>new DOMParser().parseFromString(e,"text/xml")},J={ADAPTER:nT,RESOLUTION:1,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,premultipliedAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1,hello:!1},CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var _h=/iPhone/i,ap=/iPod/i,lp=/iPad/i,hp=/\biOS-universal(?:.+)Mac\b/i,xh=/\bAndroid(?:.+)Mobile\b/i,up=/Android/i,gi=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Oo=/Silk/i,Xr=/Windows Phone/i,cp=/\bWindows(?:.+)ARM\b/i,fp=/BlackBerry/i,dp=/BB10/i,pp=/Opera Mini/i,gp=/\b(CriOS|Chrome)(?:.+)Mobile/i,mp=/Mobile(?:.+)Firefox\b/i,vp=function(e){return typeof e<"u"&&e.platform==="MacIntel"&&typeof e.maxTouchPoints=="number"&&e.maxTouchPoints>1&&typeof MSStream>"u"};function iT(e){return function(t){return t.test(e)}}function sT(e){var t={userAgent:"",platform:"",maxTouchPoints:0};!e&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof e=="string"?t.userAgent=e:e&&e.userAgent&&(t={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0});var r=t.userAgent,n=r.split("[FBAN");typeof n[1]<"u"&&(r=n[0]),n=r.split("Twitter"),typeof n[1]<"u"&&(r=n[0]);var i=iT(r),o={apple:{phone:i(_h)&&!i(Xr),ipod:i(ap),tablet:!i(_h)&&(i(lp)||vp(t))&&!i(Xr),universal:i(hp),device:(i(_h)||i(ap)||i(lp)||i(hp)||vp(t))&&!i(Xr)},amazon:{phone:i(gi),tablet:!i(gi)&&i(Oo),device:i(gi)||i(Oo)},android:{phone:!i(Xr)&&i(gi)||!i(Xr)&&i(xh),tablet:!i(Xr)&&!i(gi)&&!i(xh)&&(i(Oo)||i(up)),device:!i(Xr)&&(i(gi)||i(Oo)||i(xh)||i(up))||i(/\bokhttp\b/i)},windows:{phone:i(Xr),tablet:i(cp),device:i(Xr)||i(cp)},other:{blackberry:i(fp),blackberry10:i(dp),opera:i(pp),firefox:i(mp),chrome:i(gp),device:i(fp)||i(dp)||i(pp)||i(mp)||i(gp)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}const jr=sT(globalThis.navigator);J.RETINA_PREFIX=/@([0-9\.]+)x/;J.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var tm={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function i(u,f,d){this.fn=u,this.context=f,this.once=d||!1}function o(u,f,d,g,m){if(typeof d!="function")throw new TypeError("The listener must be a function");var v=new i(d,g||u,m),_=r?r+f:f;return u._events[_]?u._events[_].fn?u._events[_]=[u._events[_],v]:u._events[_].push(v):(u._events[_]=v,u._eventsCount++),u}function l(u,f){--u._eventsCount===0?u._events=new n:delete u._events[f]}function h(){this._events=new n,this._eventsCount=0}h.prototype.eventNames=function(){var f=[],d,g;if(this._eventsCount===0)return f;for(g in d=this._events)t.call(d,g)&&f.push(r?g.slice(1):g);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(d)):f},h.prototype.listeners=function(f){var d=r?r+f:f,g=this._events[d];if(!g)return[];if(g.fn)return[g.fn];for(var m=0,v=g.length,_=new Array(v);m<v;m++)_[m]=g[m].fn;return _},h.prototype.listenerCount=function(f){var d=r?r+f:f,g=this._events[d];return g?g.fn?1:g.length:0},h.prototype.emit=function(f,d,g,m,v,_){var w=r?r+f:f;if(!this._events[w])return!1;var x=this._events[w],A=arguments.length,S,E;if(x.fn){switch(x.once&&this.removeListener(f,x.fn,void 0,!0),A){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,d),!0;case 3:return x.fn.call(x.context,d,g),!0;case 4:return x.fn.call(x.context,d,g,m),!0;case 5:return x.fn.call(x.context,d,g,m,v),!0;case 6:return x.fn.call(x.context,d,g,m,v,_),!0}for(E=1,S=new Array(A-1);E<A;E++)S[E-1]=arguments[E];x.fn.apply(x.context,S)}else{var I=x.length,D;for(E=0;E<I;E++)switch(x[E].once&&this.removeListener(f,x[E].fn,void 0,!0),A){case 1:x[E].fn.call(x[E].context);break;case 2:x[E].fn.call(x[E].context,d);break;case 3:x[E].fn.call(x[E].context,d,g);break;case 4:x[E].fn.call(x[E].context,d,g,m);break;default:if(!S)for(D=1,S=new Array(A-1);D<A;D++)S[D-1]=arguments[D];x[E].fn.apply(x[E].context,S)}}return!0},h.prototype.on=function(f,d,g){return o(this,f,d,g,!1)},h.prototype.once=function(f,d,g){return o(this,f,d,g,!0)},h.prototype.removeListener=function(f,d,g,m){var v=r?r+f:f;if(!this._events[v])return this;if(!d)return l(this,v),this;var _=this._events[v];if(_.fn)_.fn===d&&(!m||_.once)&&(!g||_.context===g)&&l(this,v);else{for(var w=0,x=[],A=_.length;w<A;w++)(_[w].fn!==d||m&&!_[w].once||g&&_[w].context!==g)&&x.push(_[w]);x.length?this._events[v]=x.length===1?x[0]:x:l(this,v)}return this},h.prototype.removeAllListeners=function(f){var d;return f?(d=r?r+f:f,this._events[d]&&l(this,d)):(this._events=new n,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=r,h.EventEmitter=h,e.exports=h})(tm);var oT=tm.exports;const ks=Ga(oT);var nc={exports:{}};nc.exports=Wa;nc.exports.default=Wa;function Wa(e,t,r){r=r||2;var n=t&&t.length,i=n?t[0]*r:e.length,o=em(e,0,i,r,!0),l=[];if(!o||o.next===o.prev)return l;var h,u,f,d,g,m,v;if(n&&(o=cT(e,t,o,r)),e.length>80*r){h=f=e[0],u=d=e[1];for(var _=r;_<i;_+=r)g=e[_],m=e[_+1],g<h&&(h=g),m<u&&(u=m),g>f&&(f=g),m>d&&(d=m);v=Math.max(f-h,d-u),v=v!==0?32767/v:0}return Rs(o,l,r,h,u,v,0),l}function em(e,t,r,n,i){var o,l;if(i===vu(e,t,r,n)>0)for(o=t;o<r;o+=n)l=yp(o,e[o],e[o+1],l);else for(o=r-n;o>=t;o-=n)l=yp(o,e[o],e[o+1],l);return l&&$a(l,l.next)&&(Ds(l),l=l.next),l}function jn(e,t){if(!e)return e;t||(t=e);var r=e,n;do if(n=!1,!r.steiner&&($a(r,r.next)||Vt(r.prev,r,r.next)===0)){if(Ds(r),r=t=r.prev,r===r.next)break;n=!0}else r=r.next;while(n||r!==t);return t}function Rs(e,t,r,n,i,o,l){if(e){!l&&o&&mT(e,n,i,o);for(var h=e,u,f;e.prev!==e.next;){if(u=e.prev,f=e.next,o?lT(e,n,i,o):aT(e)){t.push(u.i/r|0),t.push(e.i/r|0),t.push(f.i/r|0),Ds(e),e=f.next,h=f.next;continue}if(e=f,e===h){l?l===1?(e=hT(jn(e),t,r),Rs(e,t,r,n,i,o,2)):l===2&&uT(e,t,r,n,i,o):Rs(jn(e),t,r,n,i,o,1);break}}}}function aT(e){var t=e.prev,r=e,n=e.next;if(Vt(t,r,n)>=0)return!1;for(var i=t.x,o=r.x,l=n.x,h=t.y,u=r.y,f=n.y,d=i<o?i<l?i:l:o<l?o:l,g=h<u?h<f?h:f:u<f?u:f,m=i>o?i>l?i:l:o>l?o:l,v=h>u?h>f?h:f:u>f?u:f,_=n.next;_!==t;){if(_.x>=d&&_.x<=m&&_.y>=g&&_.y<=v&&Ai(i,h,o,u,l,f,_.x,_.y)&&Vt(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function lT(e,t,r,n){var i=e.prev,o=e,l=e.next;if(Vt(i,o,l)>=0)return!1;for(var h=i.x,u=o.x,f=l.x,d=i.y,g=o.y,m=l.y,v=h<u?h<f?h:f:u<f?u:f,_=d<g?d<m?d:m:g<m?g:m,w=h>u?h>f?h:f:u>f?u:f,x=d>g?d>m?d:m:g>m?g:m,A=gu(v,_,t,r,n),S=gu(w,x,t,r,n),E=e.prevZ,I=e.nextZ;E&&E.z>=A&&I&&I.z<=S;){if(E.x>=v&&E.x<=w&&E.y>=_&&E.y<=x&&E!==i&&E!==l&&Ai(h,d,u,g,f,m,E.x,E.y)&&Vt(E.prev,E,E.next)>=0||(E=E.prevZ,I.x>=v&&I.x<=w&&I.y>=_&&I.y<=x&&I!==i&&I!==l&&Ai(h,d,u,g,f,m,I.x,I.y)&&Vt(I.prev,I,I.next)>=0))return!1;I=I.nextZ}for(;E&&E.z>=A;){if(E.x>=v&&E.x<=w&&E.y>=_&&E.y<=x&&E!==i&&E!==l&&Ai(h,d,u,g,f,m,E.x,E.y)&&Vt(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;I&&I.z<=S;){if(I.x>=v&&I.x<=w&&I.y>=_&&I.y<=x&&I!==i&&I!==l&&Ai(h,d,u,g,f,m,I.x,I.y)&&Vt(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function hT(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!$a(i,o)&&rm(i,n,n.next,o)&&Ms(i,o)&&Ms(o,i)&&(t.push(i.i/r|0),t.push(n.i/r|0),t.push(o.i/r|0),Ds(n),Ds(n.next),n=e=o),n=n.next}while(n!==e);return jn(n)}function uT(e,t,r,n,i,o){var l=e;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&_T(l,h)){var u=nm(l,h);l=jn(l,l.next),u=jn(u,u.next),Rs(l,t,r,n,i,o,0),Rs(u,t,r,n,i,o,0);return}h=h.next}l=l.next}while(l!==e)}function cT(e,t,r,n){var i=[],o,l,h,u,f;for(o=0,l=t.length;o<l;o++)h=t[o]*n,u=o<l-1?t[o+1]*n:e.length,f=em(e,h,u,n,!1),f===f.next&&(f.steiner=!0),i.push(yT(f));for(i.sort(fT),o=0;o<i.length;o++)r=dT(i[o],r);return r}function fT(e,t){return e.x-t.x}function dT(e,t){var r=pT(e,t);if(!r)return t;var n=nm(r,e);return jn(n,n.next),jn(r,r.next)}function pT(e,t){var r=t,n=e.x,i=e.y,o=-1/0,l;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var h=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(h<=n&&h>o&&(o=h,l=r.x<r.next.x?r:r.next,h===n))return l}r=r.next}while(r!==t);if(!l)return null;var u=l,f=l.x,d=l.y,g=1/0,m;r=l;do n>=r.x&&r.x>=f&&n!==r.x&&Ai(i<d?n:o,i,f,d,i<d?o:n,i,r.x,r.y)&&(m=Math.abs(i-r.y)/(n-r.x),Ms(r,e)&&(m<g||m===g&&(r.x>l.x||r.x===l.x&&gT(l,r)))&&(l=r,g=m)),r=r.next;while(r!==u);return l}function gT(e,t){return Vt(e.prev,e,t.prev)<0&&Vt(t.next,e,e.next)<0}function mT(e,t,r,n){var i=e;do i.z===0&&(i.z=gu(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,vT(i)}function vT(e){var t,r,n,i,o,l,h,u,f=1;do{for(r=e,e=null,o=null,l=0;r;){for(l++,n=r,h=0,t=0;t<f&&(h++,n=n.nextZ,!!n);t++);for(u=f;h>0||u>0&&n;)h!==0&&(u===0||!n||r.z<=n.z)?(i=r,r=r.nextZ,h--):(i=n,n=n.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,f*=2}while(l>1);return e}function gu(e,t,r,n,i){return e=(e-r)*i|0,t=(t-n)*i|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function yT(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function Ai(e,t,r,n,i,o,l,h){return(i-l)*(t-h)>=(e-l)*(o-h)&&(e-l)*(n-h)>=(r-l)*(t-h)&&(r-l)*(o-h)>=(i-l)*(n-h)}function _T(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!xT(e,t)&&(Ms(e,t)&&Ms(t,e)&&bT(e,t)&&(Vt(e.prev,e,t.prev)||Vt(e,t.prev,t))||$a(e,t)&&Vt(e.prev,e,e.next)>0&&Vt(t.prev,t,t.next)>0)}function Vt(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function $a(e,t){return e.x===t.x&&e.y===t.y}function rm(e,t,r,n){var i=Lo(Vt(e,t,r)),o=Lo(Vt(e,t,n)),l=Lo(Vt(r,n,e)),h=Lo(Vt(r,n,t));return!!(i!==o&&l!==h||i===0&&Fo(e,r,t)||o===0&&Fo(e,n,t)||l===0&&Fo(r,e,n)||h===0&&Fo(r,t,n))}function Fo(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Lo(e){return e>0?1:e<0?-1:0}function xT(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&rm(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function Ms(e,t){return Vt(e.prev,e,e.next)<0?Vt(e,t,e.next)>=0&&Vt(e,e.prev,t)>=0:Vt(e,t,e.prev)<0||Vt(e,e.next,t)<0}function bT(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e);return n}function nm(e,t){var r=new mu(e.i,e.x,e.y),n=new mu(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function yp(e,t,r,n){var i=new mu(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Ds(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function mu(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Wa.deviation=function(e,t,r,n){var i=t&&t.length,o=i?t[0]*r:e.length,l=Math.abs(vu(e,0,o,r));if(i)for(var h=0,u=t.length;h<u;h++){var f=t[h]*r,d=h<u-1?t[h+1]*r:e.length;l-=Math.abs(vu(e,f,d,r))}var g=0;for(h=0;h<n.length;h+=3){var m=n[h]*r,v=n[h+1]*r,_=n[h+2]*r;g+=Math.abs((e[m]-e[_])*(e[v+1]-e[m+1])-(e[m]-e[v])*(e[_+1]-e[m+1]))}return l===0&&g===0?0:Math.abs((g-l)/l)};function vu(e,t,r,n){for(var i=0,o=t,l=r-n;o<r;o+=n)i+=(e[l]-e[o])*(e[o+1]+e[l+1]),l=o;return i}Wa.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var l=0;l<t;l++)r.vertices.push(e[i][o][l]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r};var wT=nc.exports;const ET=Ga(wT);var xa={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */xa.exports;(function(e,t){(function(r){var n=t&&!t.nodeType&&t,i=e&&!e.nodeType&&e,o=typeof Rr=="object"&&Rr;(o.global===o||o.window===o||o.self===o)&&(r=o);var l,h=2147483647,u=36,f=1,d=26,g=38,m=700,v=72,_=128,w="-",x=/^xn--/,A=/[^\x20-\x7E]/,S=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},I=u-f,D=Math.floor,L=String.fromCharCode,O;function F(H){throw new RangeError(E[H])}function z(H,nt){for(var bt=H.length,Pt=[];bt--;)Pt[bt]=nt(H[bt]);return Pt}function j(H,nt){var bt=H.split("@"),Pt="";bt.length>1&&(Pt=bt[0]+"@",H=bt[1]),H=H.replace(S,".");var Mt=H.split("."),Nt=z(Mt,nt).join(".");return Pt+Nt}function X(H){for(var nt=[],bt=0,Pt=H.length,Mt,Nt;bt<Pt;)Mt=H.charCodeAt(bt++),Mt>=55296&&Mt<=56319&&bt<Pt?(Nt=H.charCodeAt(bt++),(Nt&64512)==56320?nt.push(((Mt&1023)<<10)+(Nt&1023)+65536):(nt.push(Mt),bt--)):nt.push(Mt);return nt}function K(H){return z(H,function(nt){var bt="";return nt>65535&&(nt-=65536,bt+=L(nt>>>10&1023|55296),nt=56320|nt&1023),bt+=L(nt),bt}).join("")}function W(H){return H-48<10?H-22:H-65<26?H-65:H-97<26?H-97:u}function k(H,nt){return H+22+75*(H<26)-((nt!=0)<<5)}function lt(H,nt,bt){var Pt=0;for(H=bt?D(H/m):H>>1,H+=D(H/nt);H>I*d>>1;Pt+=u)H=D(H/I);return D(Pt+(I+1)*H/(H+g))}function dt(H){var nt=[],bt=H.length,Pt,Mt=0,Nt=_,kt=v,ne,jt,ie,oe,Dt,Ut,qt,Kt,ye;for(ne=H.lastIndexOf(w),ne<0&&(ne=0),jt=0;jt<ne;++jt)H.charCodeAt(jt)>=128&&F("not-basic"),nt.push(H.charCodeAt(jt));for(ie=ne>0?ne+1:0;ie<bt;){for(oe=Mt,Dt=1,Ut=u;ie>=bt&&F("invalid-input"),qt=W(H.charCodeAt(ie++)),(qt>=u||qt>D((h-Mt)/Dt))&&F("overflow"),Mt+=qt*Dt,Kt=Ut<=kt?f:Ut>=kt+d?d:Ut-kt,!(qt<Kt);Ut+=u)ye=u-Kt,Dt>D(h/ye)&&F("overflow"),Dt*=ye;Pt=nt.length+1,kt=lt(Mt-oe,Pt,oe==0),D(Mt/Pt)>h-Nt&&F("overflow"),Nt+=D(Mt/Pt),Mt%=Pt,nt.splice(Mt++,0,Nt)}return K(nt)}function Y(H){var nt,bt,Pt,Mt,Nt,kt,ne,jt,ie,oe,Dt,Ut=[],qt,Kt,ye,En;for(H=X(H),qt=H.length,nt=_,bt=0,Nt=v,kt=0;kt<qt;++kt)Dt=H[kt],Dt<128&&Ut.push(L(Dt));for(Pt=Mt=Ut.length,Mt&&Ut.push(w);Pt<qt;){for(ne=h,kt=0;kt<qt;++kt)Dt=H[kt],Dt>=nt&&Dt<ne&&(ne=Dt);for(Kt=Pt+1,ne-nt>D((h-bt)/Kt)&&F("overflow"),bt+=(ne-nt)*Kt,nt=ne,kt=0;kt<qt;++kt)if(Dt=H[kt],Dt<nt&&++bt>h&&F("overflow"),Dt==nt){for(jt=bt,ie=u;oe=ie<=Nt?f:ie>=Nt+d?d:ie-Nt,!(jt<oe);ie+=u)En=jt-oe,ye=u-oe,Ut.push(L(k(oe+En%ye,0))),jt=D(En/ye);Ut.push(L(k(jt,0))),Nt=lt(bt,Kt,Pt==Mt),bt=0,++Pt}++bt,++nt}return Ut.join("")}function yt(H){return j(H,function(nt){return x.test(nt)?dt(nt.slice(4).toLowerCase()):nt})}function Ot(H){return j(H,function(nt){return A.test(nt)?"xn--"+Y(nt):nt})}if(l={version:"1.4.1",ucs2:{decode:X,encode:K},decode:dt,encode:Y,toASCII:Ot,toUnicode:yt},n&&i)if(e.exports==n)i.exports=l;else for(O in l)l.hasOwnProperty(O)&&(n[O]=l[O]);else r.punycode=l})(Rr)})(xa,xa.exports);var TT=xa.exports,AT=Error,ST=EvalError,CT=RangeError,IT=ReferenceError,im=SyntaxError,Us=TypeError,PT=URIError,RT=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;t[r]=i;for(r in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==r||!Object.prototype.propertyIsEnumerable.call(t,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var l=Object.getOwnPropertyDescriptor(t,r);if(l.value!==i||l.enumerable!==!0)return!1}return!0},_p=typeof Symbol<"u"&&Symbol,MT=RT,DT=function(){return typeof _p!="function"||typeof Symbol!="function"||typeof _p("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:MT()},bh={__proto__:null,foo:{}},BT=Object,OT=function(){return{__proto__:bh}.foo===bh.foo&&!(bh instanceof BT)},FT="Function.prototype.bind called on incompatible ",LT=Object.prototype.toString,NT=Math.max,kT="[object Function]",xp=function(t,r){for(var n=[],i=0;i<t.length;i+=1)n[i]=t[i];for(var o=0;o<r.length;o+=1)n[o+t.length]=r[o];return n},UT=function(t,r){for(var n=[],i=r,o=0;i<t.length;i+=1,o+=1)n[o]=t[i];return n},GT=function(e,t){for(var r="",n=0;n<e.length;n+=1)r+=e[n],n+1<e.length&&(r+=t);return r},WT=function(t){var r=this;if(typeof r!="function"||LT.apply(r)!==kT)throw new TypeError(FT+r);for(var n=UT(arguments,1),i,o=function(){if(this instanceof i){var d=r.apply(this,xp(n,arguments));return Object(d)===d?d:this}return r.apply(t,xp(n,arguments))},l=NT(0,r.length-n.length),h=[],u=0;u<l;u++)h[u]="$"+u;if(i=Function("binder","return function ("+GT(h,",")+"){ return binder.apply(this,arguments); }")(o),r.prototype){var f=function(){};f.prototype=r.prototype,i.prototype=new f,f.prototype=null}return i},$T=WT,ic=Function.prototype.bind||$T,HT=Function.prototype.call,zT=Object.prototype.hasOwnProperty,XT=ic,VT=XT.call(HT,zT),Et,YT=AT,jT=ST,qT=CT,KT=IT,Li=im,Mi=Us,ZT=PT,sm=Function,wh=function(e){try{return sm('"use strict"; return ('+e+").constructor;")()}catch{}},Xn=Object.getOwnPropertyDescriptor;if(Xn)try{Xn({},"")}catch{Xn=null}var Eh=function(){throw new Mi},JT=Xn?function(){try{return arguments.callee,Eh}catch{try{return Xn(arguments,"callee").get}catch{return Eh}}}():Eh,mi=DT(),QT=OT(),fe=Object.getPrototypeOf||(QT?function(e){return e.__proto__}:null),bi={},tA=typeof Uint8Array>"u"||!fe?Et:fe(Uint8Array),Vn={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Et:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Et:ArrayBuffer,"%ArrayIteratorPrototype%":mi&&fe?fe([][Symbol.iterator]()):Et,"%AsyncFromSyncIteratorPrototype%":Et,"%AsyncFunction%":bi,"%AsyncGenerator%":bi,"%AsyncGeneratorFunction%":bi,"%AsyncIteratorPrototype%":bi,"%Atomics%":typeof Atomics>"u"?Et:Atomics,"%BigInt%":typeof BigInt>"u"?Et:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Et:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Et:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Et:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":YT,"%eval%":eval,"%EvalError%":jT,"%Float32Array%":typeof Float32Array>"u"?Et:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Et:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Et:FinalizationRegistry,"%Function%":sm,"%GeneratorFunction%":bi,"%Int8Array%":typeof Int8Array>"u"?Et:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Et:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Et:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":mi&&fe?fe(fe([][Symbol.iterator]())):Et,"%JSON%":typeof JSON=="object"?JSON:Et,"%Map%":typeof Map>"u"?Et:Map,"%MapIteratorPrototype%":typeof Map>"u"||!mi||!fe?Et:fe(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Et:Promise,"%Proxy%":typeof Proxy>"u"?Et:Proxy,"%RangeError%":qT,"%ReferenceError%":KT,"%Reflect%":typeof Reflect>"u"?Et:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Et:Set,"%SetIteratorPrototype%":typeof Set>"u"||!mi||!fe?Et:fe(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Et:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":mi&&fe?fe(""[Symbol.iterator]()):Et,"%Symbol%":mi?Symbol:Et,"%SyntaxError%":Li,"%ThrowTypeError%":JT,"%TypedArray%":tA,"%TypeError%":Mi,"%Uint8Array%":typeof Uint8Array>"u"?Et:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Et:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Et:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Et:Uint32Array,"%URIError%":ZT,"%WeakMap%":typeof WeakMap>"u"?Et:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Et:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Et:WeakSet};if(fe)try{null.error}catch(e){var eA=fe(fe(e));Vn["%Error.prototype%"]=eA}var rA=function e(t){var r;if(t==="%AsyncFunction%")r=wh("async function () {}");else if(t==="%GeneratorFunction%")r=wh("function* () {}");else if(t==="%AsyncGeneratorFunction%")r=wh("async function* () {}");else if(t==="%AsyncGenerator%"){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if(t==="%AsyncIteratorPrototype%"){var i=e("%AsyncGenerator%");i&&fe&&(r=fe(i.prototype))}return Vn[t]=r,r},bp={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Gs=ic,ba=VT,nA=Gs.call(Function.call,Array.prototype.concat),iA=Gs.call(Function.apply,Array.prototype.splice),wp=Gs.call(Function.call,String.prototype.replace),wa=Gs.call(Function.call,String.prototype.slice),sA=Gs.call(Function.call,RegExp.prototype.exec),oA=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,aA=/\\(\\)?/g,lA=function(t){var r=wa(t,0,1),n=wa(t,-1);if(r==="%"&&n!=="%")throw new Li("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&r!=="%")throw new Li("invalid intrinsic syntax, expected opening `%`");var i=[];return wp(t,oA,function(o,l,h,u){i[i.length]=h?wp(u,aA,"$1"):l||o}),i},hA=function(t,r){var n=t,i;if(ba(bp,n)&&(i=bp[n],n="%"+i[0]+"%"),ba(Vn,n)){var o=Vn[n];if(o===bi&&(o=rA(n)),typeof o>"u"&&!r)throw new Mi("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:o}}throw new Li("intrinsic "+t+" does not exist!")},Xi=function(t,r){if(typeof t!="string"||t.length===0)throw new Mi("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof r!="boolean")throw new Mi('"allowMissing" argument must be a boolean');if(sA(/^%?[^%]*%?$/,t)===null)throw new Li("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=lA(t),i=n.length>0?n[0]:"",o=hA("%"+i+"%",r),l=o.name,h=o.value,u=!1,f=o.alias;f&&(i=f[0],iA(n,nA([0,1],f)));for(var d=1,g=!0;d<n.length;d+=1){var m=n[d],v=wa(m,0,1),_=wa(m,-1);if((v==='"'||v==="'"||v==="`"||_==='"'||_==="'"||_==="`")&&v!==_)throw new Li("property names with quotes must have matching quotes");if((m==="constructor"||!g)&&(u=!0),i+="."+m,l="%"+i+"%",ba(Vn,l))h=Vn[l];else if(h!=null){if(!(m in h)){if(!r)throw new Mi("base intrinsic for "+t+" exists, but the property is not available.");return}if(Xn&&d+1>=n.length){var w=Xn(h,m);g=!!w,g&&"get"in w&&!("originalValue"in w.get)?h=w.get:h=h[m]}else g=ba(h,m),h=h[m];g&&!u&&(Vn[l]=h)}}return h},om={exports:{}},Th,Ep;function sc(){if(Ep)return Th;Ep=1;var e=Xi,t=e("%Object.defineProperty%",!0)||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return Th=t,Th}var uA=Xi,ha=uA("%Object.getOwnPropertyDescriptor%",!0);if(ha)try{ha([],"length")}catch{ha=null}var am=ha,Tp=sc(),cA=im,vi=Us,Ap=am,fA=function(t,r,n){if(!t||typeof t!="object"&&typeof t!="function")throw new vi("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new vi("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new vi("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new vi("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new vi("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new vi("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,l=arguments.length>5?arguments[5]:null,h=arguments.length>6?arguments[6]:!1,u=!!Ap&&Ap(t,r);if(Tp)Tp(t,r,{configurable:l===null&&u?u.configurable:!l,enumerable:i===null&&u?u.enumerable:!i,value:n,writable:o===null&&u?u.writable:!o});else if(h||!i&&!o&&!l)t[r]=n;else throw new cA("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},yu=sc(),lm=function(){return!!yu};lm.hasArrayLengthDefineBug=function(){if(!yu)return null;try{return yu([],"length",{value:1}).length!==1}catch{return!0}};var dA=lm,pA=Xi,Sp=fA,gA=dA(),Cp=am,Ip=Us,mA=pA("%Math.floor%"),vA=function(t,r){if(typeof t!="function")throw new Ip("`fn` is not a function");if(typeof r!="number"||r<0||r>4294967295||mA(r)!==r)throw new Ip("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],i=!0,o=!0;if("length"in t&&Cp){var l=Cp(t,"length");l&&!l.configurable&&(i=!1),l&&!l.writable&&(o=!1)}return(i||o||!n)&&(gA?Sp(t,"length",r,!0,!0):Sp(t,"length",r)),t};(function(e){var t=ic,r=Xi,n=vA,i=Us,o=r("%Function.prototype.apply%"),l=r("%Function.prototype.call%"),h=r("%Reflect.apply%",!0)||t.call(l,o),u=sc(),f=r("%Math.max%");e.exports=function(m){if(typeof m!="function")throw new i("a function is required");var v=h(t,l,arguments);return n(v,1+f(0,m.length-(arguments.length-1)),!0)};var d=function(){return h(t,o,arguments)};u?u(e.exports,"apply",{value:d}):e.exports.apply=d})(om);var yA=om.exports,hm=Xi,um=yA,_A=um(hm("String.prototype.indexOf")),xA=function(t,r){var n=hm(t,!!r);return typeof n=="function"&&_A(t,".prototype.")>-1?um(n):n};const bA={},wA=Object.freeze(Object.defineProperty({__proto__:null,default:bA},Symbol.toStringTag,{value:"Module"})),EA=rT(wA);var oc=typeof Map=="function"&&Map.prototype,Ah=Object.getOwnPropertyDescriptor&&oc?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Ea=oc&&Ah&&typeof Ah.get=="function"?Ah.get:null,Pp=oc&&Map.prototype.forEach,ac=typeof Set=="function"&&Set.prototype,Sh=Object.getOwnPropertyDescriptor&&ac?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Ta=ac&&Sh&&typeof Sh.get=="function"?Sh.get:null,Rp=ac&&Set.prototype.forEach,TA=typeof WeakMap=="function"&&WeakMap.prototype,As=TA?WeakMap.prototype.has:null,AA=typeof WeakSet=="function"&&WeakSet.prototype,Ss=AA?WeakSet.prototype.has:null,SA=typeof WeakRef=="function"&&WeakRef.prototype,Mp=SA?WeakRef.prototype.deref:null,CA=Boolean.prototype.valueOf,IA=Object.prototype.toString,PA=Function.prototype.toString,RA=String.prototype.match,lc=String.prototype.slice,fn=String.prototype.replace,MA=String.prototype.toUpperCase,Dp=String.prototype.toLowerCase,cm=RegExp.prototype.test,Bp=Array.prototype.concat,Pr=Array.prototype.join,DA=Array.prototype.slice,Op=Math.floor,_u=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Ch=Object.getOwnPropertySymbols,xu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Ni=typeof Symbol=="function"&&typeof Symbol.iterator=="object",we=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Ni||!0)?Symbol.toStringTag:null,fm=Object.prototype.propertyIsEnumerable,Fp=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function Lp(e,t){if(e===1/0||e===-1/0||e!==e||e&&e>-1e3&&e<1e3||cm.call(/e/,t))return t;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof e=="number"){var n=e<0?-Op(-e):Op(e);if(n!==e){var i=String(n),o=lc.call(t,i.length+1);return fn.call(i,r,"$&_")+"."+fn.call(fn.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return fn.call(t,r,"$&_")}var bu=EA,Np=bu.custom,kp=pm(Np)?Np:null,BA=function e(t,r,n,i){var o=r||{};if(hn(o,"quoteStyle")&&o.quoteStyle!=="single"&&o.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(hn(o,"maxStringLength")&&(typeof o.maxStringLength=="number"?o.maxStringLength<0&&o.maxStringLength!==1/0:o.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var l=hn(o,"customInspect")?o.customInspect:!0;if(typeof l!="boolean"&&l!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(hn(o,"indent")&&o.indent!==null&&o.indent!=="	"&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(hn(o,"numericSeparator")&&typeof o.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var h=o.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return mm(t,o);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var u=String(t);return h?Lp(t,u):u}if(typeof t=="bigint"){var f=String(t)+"n";return h?Lp(t,f):f}var d=typeof o.depth>"u"?5:o.depth;if(typeof n>"u"&&(n=0),n>=d&&d>0&&typeof t=="object")return wu(t)?"[Array]":"[Object]";var g=ZA(o,n);if(typeof i>"u")i=[];else if(gm(i,t)>=0)return"[Circular]";function m(W,k,lt){if(k&&(i=DA.call(i),i.push(k)),lt){var dt={depth:o.depth};return hn(o,"quoteStyle")&&(dt.quoteStyle=o.quoteStyle),e(W,dt,n+1,i)}return e(W,o,n+1,i)}if(typeof t=="function"&&!Up(t)){var v=$A(t),_=No(t,m);return"[Function"+(v?": "+v:" (anonymous)")+"]"+(_.length>0?" { "+Pr.call(_,", ")+" }":"")}if(pm(t)){var w=Ni?fn.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):xu.call(t);return typeof t=="object"&&!Ni?gs(w):w}if(jA(t)){for(var x="<"+Dp.call(String(t.nodeName)),A=t.attributes||[],S=0;S<A.length;S++)x+=" "+A[S].name+"="+dm(OA(A[S].value),"double",o);return x+=">",t.childNodes&&t.childNodes.length&&(x+="..."),x+="</"+Dp.call(String(t.nodeName))+">",x}if(wu(t)){if(t.length===0)return"[]";var E=No(t,m);return g&&!KA(E)?"["+Eu(E,g)+"]":"[ "+Pr.call(E,", ")+" ]"}if(LA(t)){var I=No(t,m);return!("cause"in Error.prototype)&&"cause"in t&&!fm.call(t,"cause")?"{ ["+String(t)+"] "+Pr.call(Bp.call("[cause]: "+m(t.cause),I),", ")+" }":I.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+Pr.call(I,", ")+" }"}if(typeof t=="object"&&l){if(kp&&typeof t[kp]=="function"&&bu)return bu(t,{depth:d-n});if(l!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(HA(t)){var D=[];return Pp&&Pp.call(t,function(W,k){D.push(m(k,t,!0)+" => "+m(W,t))}),Gp("Map",Ea.call(t),D,g)}if(VA(t)){var L=[];return Rp&&Rp.call(t,function(W){L.push(m(W,t))}),Gp("Set",Ta.call(t),L,g)}if(zA(t))return Ih("WeakMap");if(YA(t))return Ih("WeakSet");if(XA(t))return Ih("WeakRef");if(kA(t))return gs(m(Number(t)));if(GA(t))return gs(m(_u.call(t)));if(UA(t))return gs(CA.call(t));if(NA(t))return gs(m(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(t===Rr)return"{ [object globalThis] }";if(!FA(t)&&!Up(t)){var O=No(t,m),F=Fp?Fp(t)===Object.prototype:t instanceof Object||t.constructor===Object,z=t instanceof Object?"":"null prototype",j=!F&&we&&Object(t)===t&&we in t?lc.call(xn(t),8,-1):z?"Object":"",X=F||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",K=X+(j||z?"["+Pr.call(Bp.call([],j||[],z||[]),": ")+"] ":"");return O.length===0?K+"{}":g?K+"{"+Eu(O,g)+"}":K+"{ "+Pr.call(O,", ")+" }"}return String(t)};function dm(e,t,r){var n=(r.quoteStyle||t)==="double"?'"':"'";return n+e+n}function OA(e){return fn.call(String(e),/"/g,"&quot;")}function wu(e){return xn(e)==="[object Array]"&&(!we||!(typeof e=="object"&&we in e))}function FA(e){return xn(e)==="[object Date]"&&(!we||!(typeof e=="object"&&we in e))}function Up(e){return xn(e)==="[object RegExp]"&&(!we||!(typeof e=="object"&&we in e))}function LA(e){return xn(e)==="[object Error]"&&(!we||!(typeof e=="object"&&we in e))}function NA(e){return xn(e)==="[object String]"&&(!we||!(typeof e=="object"&&we in e))}function kA(e){return xn(e)==="[object Number]"&&(!we||!(typeof e=="object"&&we in e))}function UA(e){return xn(e)==="[object Boolean]"&&(!we||!(typeof e=="object"&&we in e))}function pm(e){if(Ni)return e&&typeof e=="object"&&e instanceof Symbol;if(typeof e=="symbol")return!0;if(!e||typeof e!="object"||!xu)return!1;try{return xu.call(e),!0}catch{}return!1}function GA(e){if(!e||typeof e!="object"||!_u)return!1;try{return _u.call(e),!0}catch{}return!1}var WA=Object.prototype.hasOwnProperty||function(e){return e in this};function hn(e,t){return WA.call(e,t)}function xn(e){return IA.call(e)}function $A(e){if(e.name)return e.name;var t=RA.call(PA.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}function gm(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}function HA(e){if(!Ea||!e||typeof e!="object")return!1;try{Ea.call(e);try{Ta.call(e)}catch{return!0}return e instanceof Map}catch{}return!1}function zA(e){if(!As||!e||typeof e!="object")return!1;try{As.call(e,As);try{Ss.call(e,Ss)}catch{return!0}return e instanceof WeakMap}catch{}return!1}function XA(e){if(!Mp||!e||typeof e!="object")return!1;try{return Mp.call(e),!0}catch{}return!1}function VA(e){if(!Ta||!e||typeof e!="object")return!1;try{Ta.call(e);try{Ea.call(e)}catch{return!0}return e instanceof Set}catch{}return!1}function YA(e){if(!Ss||!e||typeof e!="object")return!1;try{Ss.call(e,Ss);try{As.call(e,As)}catch{return!0}return e instanceof WeakSet}catch{}return!1}function jA(e){return!e||typeof e!="object"?!1:typeof HTMLElement<"u"&&e instanceof HTMLElement?!0:typeof e.nodeName=="string"&&typeof e.getAttribute=="function"}function mm(e,t){if(e.length>t.maxStringLength){var r=e.length-t.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return mm(lc.call(e,0,t.maxStringLength),t)+n}var i=fn.call(fn.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,qA);return dm(i,"single",t)}function qA(e){var t=e.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return r?"\\"+r:"\\x"+(t<16?"0":"")+MA.call(t.toString(16))}function gs(e){return"Object("+e+")"}function Ih(e){return e+" { ? }"}function Gp(e,t,r,n){var i=n?Eu(r,n):Pr.call(r,", ");return e+" ("+t+") {"+i+"}"}function KA(e){for(var t=0;t<e.length;t++)if(gm(e[t],`
`)>=0)return!1;return!0}function ZA(e,t){var r;if(e.indent==="	")r="	";else if(typeof e.indent=="number"&&e.indent>0)r=Pr.call(Array(e.indent+1)," ");else return null;return{base:r,prev:Pr.call(Array(t+1),r)}}function Eu(e,t){if(e.length===0)return"";var r=`
`+t.prev+t.base;return r+Pr.call(e,","+r)+`
`+t.prev}function No(e,t){var r=wu(e),n=[];if(r){n.length=e.length;for(var i=0;i<e.length;i++)n[i]=hn(e,i)?t(e[i],e):""}var o=typeof Ch=="function"?Ch(e):[],l;if(Ni){l={};for(var h=0;h<o.length;h++)l["$"+o[h]]=o[h]}for(var u in e)hn(e,u)&&(r&&String(Number(u))===u&&u<e.length||Ni&&l["$"+u]instanceof Symbol||(cm.call(/[^\w$]/,u)?n.push(t(u,e)+": "+t(e[u],e)):n.push(u+": "+t(e[u],e))));if(typeof Ch=="function")for(var f=0;f<o.length;f++)fm.call(e,o[f])&&n.push("["+t(o[f])+"]: "+t(e[o[f]],e));return n}var vm=Xi,Vi=xA,JA=BA,QA=Us,ko=vm("%WeakMap%",!0),Uo=vm("%Map%",!0),tS=Vi("WeakMap.prototype.get",!0),eS=Vi("WeakMap.prototype.set",!0),rS=Vi("WeakMap.prototype.has",!0),nS=Vi("Map.prototype.get",!0),iS=Vi("Map.prototype.set",!0),sS=Vi("Map.prototype.has",!0),hc=function(e,t){for(var r=e,n;(n=r.next)!==null;r=n)if(n.key===t)return r.next=n.next,n.next=e.next,e.next=n,n},oS=function(e,t){var r=hc(e,t);return r&&r.value},aS=function(e,t,r){var n=hc(e,t);n?n.value=r:e.next={key:t,next:e.next,value:r}},lS=function(e,t){return!!hc(e,t)},hS=function(){var t,r,n,i={assert:function(o){if(!i.has(o))throw new QA("Side channel does not contain "+JA(o))},get:function(o){if(ko&&o&&(typeof o=="object"||typeof o=="function")){if(t)return tS(t,o)}else if(Uo){if(r)return nS(r,o)}else if(n)return oS(n,o)},has:function(o){if(ko&&o&&(typeof o=="object"||typeof o=="function")){if(t)return rS(t,o)}else if(Uo){if(r)return sS(r,o)}else if(n)return lS(n,o);return!1},set:function(o,l){ko&&o&&(typeof o=="object"||typeof o=="function")?(t||(t=new ko),eS(t,o,l)):Uo?(r||(r=new Uo),iS(r,o,l)):(n||(n={key:{},next:null}),aS(n,o,l))}};return i},uS=String.prototype.replace,cS=/%20/g,Ph={RFC1738:"RFC1738",RFC3986:"RFC3986"},uc={default:Ph.RFC3986,formatters:{RFC1738:function(e){return uS.call(e,cS,"+")},RFC3986:function(e){return String(e)}},RFC1738:Ph.RFC1738,RFC3986:Ph.RFC3986},fS=uc,Rh=Object.prototype.hasOwnProperty,Wn=Array.isArray,Tr=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),dS=function(t){for(;t.length>1;){var r=t.pop(),n=r.obj[r.prop];if(Wn(n)){for(var i=[],o=0;o<n.length;++o)typeof n[o]<"u"&&i.push(n[o]);r.obj[r.prop]=i}}},ym=function(t,r){for(var n=r&&r.plainObjects?Object.create(null):{},i=0;i<t.length;++i)typeof t[i]<"u"&&(n[i]=t[i]);return n},pS=function e(t,r,n){if(!r)return t;if(typeof r!="object"){if(Wn(t))t.push(r);else if(t&&typeof t=="object")(n&&(n.plainObjects||n.allowPrototypes)||!Rh.call(Object.prototype,r))&&(t[r]=!0);else return[t,r];return t}if(!t||typeof t!="object")return[t].concat(r);var i=t;return Wn(t)&&!Wn(r)&&(i=ym(t,n)),Wn(t)&&Wn(r)?(r.forEach(function(o,l){if(Rh.call(t,l)){var h=t[l];h&&typeof h=="object"&&o&&typeof o=="object"?t[l]=e(h,o,n):t.push(o)}else t[l]=o}),t):Object.keys(r).reduce(function(o,l){var h=r[l];return Rh.call(o,l)?o[l]=e(o[l],h,n):o[l]=h,o},i)},gS=function(t,r){return Object.keys(r).reduce(function(n,i){return n[i]=r[i],n},t)},mS=function(e,t,r){var n=e.replace(/\+/g," ");if(r==="iso-8859-1")return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch{return n}},Mh=1024,vS=function(t,r,n,i,o){if(t.length===0)return t;var l=t;if(typeof t=="symbol"?l=Symbol.prototype.toString.call(t):typeof t!="string"&&(l=String(t)),n==="iso-8859-1")return escape(l).replace(/%u[0-9a-f]{4}/gi,function(v){return"%26%23"+parseInt(v.slice(2),16)+"%3B"});for(var h="",u=0;u<l.length;u+=Mh){for(var f=l.length>=Mh?l.slice(u,u+Mh):l,d=[],g=0;g<f.length;++g){var m=f.charCodeAt(g);if(m===45||m===46||m===95||m===126||m>=48&&m<=57||m>=65&&m<=90||m>=97&&m<=122||o===fS.RFC1738&&(m===40||m===41)){d[d.length]=f.charAt(g);continue}if(m<128){d[d.length]=Tr[m];continue}if(m<2048){d[d.length]=Tr[192|m>>6]+Tr[128|m&63];continue}if(m<55296||m>=57344){d[d.length]=Tr[224|m>>12]+Tr[128|m>>6&63]+Tr[128|m&63];continue}g+=1,m=65536+((m&1023)<<10|f.charCodeAt(g)&1023),d[d.length]=Tr[240|m>>18]+Tr[128|m>>12&63]+Tr[128|m>>6&63]+Tr[128|m&63]}h+=d.join("")}return h},yS=function(t){for(var r=[{obj:{o:t},prop:"o"}],n=[],i=0;i<r.length;++i)for(var o=r[i],l=o.obj[o.prop],h=Object.keys(l),u=0;u<h.length;++u){var f=h[u],d=l[f];typeof d=="object"&&d!==null&&n.indexOf(d)===-1&&(r.push({obj:l,prop:f}),n.push(d))}return dS(r),t},_S=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},xS=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},bS=function(t,r){return[].concat(t,r)},wS=function(t,r){if(Wn(t)){for(var n=[],i=0;i<t.length;i+=1)n.push(r(t[i]));return n}return r(t)},_m={arrayToObject:ym,assign:gS,combine:bS,compact:yS,decode:mS,encode:vS,isBuffer:xS,isRegExp:_S,maybeMap:wS,merge:pS},xm=hS,ua=_m,Cs=uc,ES=Object.prototype.hasOwnProperty,bm={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,r){return t+"["+r+"]"},repeat:function(t){return t}},Cr=Array.isArray,TS=Array.prototype.push,wm=function(e,t){TS.apply(e,Cr(t)?t:[t])},AS=Date.prototype.toISOString,Wp=Cs.default,he={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:ua.encode,encodeValuesOnly:!1,format:Wp,formatter:Cs.formatters[Wp],indices:!1,serializeDate:function(t){return AS.call(t)},skipNulls:!1,strictNullHandling:!1},SS=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},Dh={},CS=function e(t,r,n,i,o,l,h,u,f,d,g,m,v,_,w,x,A,S){for(var E=t,I=S,D=0,L=!1;(I=I.get(Dh))!==void 0&&!L;){var O=I.get(t);if(D+=1,typeof O<"u"){if(O===D)throw new RangeError("Cyclic object value");L=!0}typeof I.get(Dh)>"u"&&(D=0)}if(typeof d=="function"?E=d(r,E):E instanceof Date?E=v(E):n==="comma"&&Cr(E)&&(E=ua.maybeMap(E,function(H){return H instanceof Date?v(H):H})),E===null){if(l)return f&&!x?f(r,he.encoder,A,"key",_):r;E=""}if(SS(E)||ua.isBuffer(E)){if(f){var F=x?r:f(r,he.encoder,A,"key",_);return[w(F)+"="+w(f(E,he.encoder,A,"value",_))]}return[w(r)+"="+w(String(E))]}var z=[];if(typeof E>"u")return z;var j;if(n==="comma"&&Cr(E))x&&f&&(E=ua.maybeMap(E,f)),j=[{value:E.length>0?E.join(",")||null:void 0}];else if(Cr(d))j=d;else{var X=Object.keys(E);j=g?X.sort(g):X}var K=u?r.replace(/\./g,"%2E"):r,W=i&&Cr(E)&&E.length===1?K+"[]":K;if(o&&Cr(E)&&E.length===0)return W+"[]";for(var k=0;k<j.length;++k){var lt=j[k],dt=typeof lt=="object"&&typeof lt.value<"u"?lt.value:E[lt];if(!(h&&dt===null)){var Y=m&&u?lt.replace(/\./g,"%2E"):lt,yt=Cr(E)?typeof n=="function"?n(W,Y):W:W+(m?"."+Y:"["+Y+"]");S.set(t,D);var Ot=xm();Ot.set(Dh,S),wm(z,e(dt,yt,n,i,o,l,h,u,n==="comma"&&x&&Cr(E)?null:f,d,g,m,v,_,w,x,A,Ot))}}return z},IS=function(t){if(!t)return he;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var r=t.charset||he.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=Cs.default;if(typeof t.format<"u"){if(!ES.call(Cs.formatters,t.format))throw new TypeError("Unknown format option provided.");n=t.format}var i=Cs.formatters[n],o=he.filter;(typeof t.filter=="function"||Cr(t.filter))&&(o=t.filter);var l;if(t.arrayFormat in bm?l=t.arrayFormat:"indices"in t?l=t.indices?"indices":"repeat":l=he.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var h=typeof t.allowDots>"u"?t.encodeDotInKeys===!0?!0:he.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:he.addQueryPrefix,allowDots:h,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:he.allowEmptyArrays,arrayFormat:l,charset:r,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:he.charsetSentinel,commaRoundTrip:t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?he.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:he.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:he.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:he.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:he.encodeValuesOnly,filter:o,format:n,formatter:i,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:he.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:he.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:he.strictNullHandling}},PS=function(e,t){var r=e,n=IS(t),i,o;typeof n.filter=="function"?(o=n.filter,r=o("",r)):Cr(n.filter)&&(o=n.filter,i=o);var l=[];if(typeof r!="object"||r===null)return"";var h=bm[n.arrayFormat],u=h==="comma"&&n.commaRoundTrip;i||(i=Object.keys(r)),n.sort&&i.sort(n.sort);for(var f=xm(),d=0;d<i.length;++d){var g=i[d];n.skipNulls&&r[g]===null||wm(l,CS(r[g],g,h,u,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,f))}var m=l.join(n.delimiter),v=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?v+="utf8=%26%2310003%3B&":v+="utf8=%E2%9C%93&"),m.length>0?v+m:""},ki=_m,Tu=Object.prototype.hasOwnProperty,RS=Array.isArray,ee={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:ki.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},MS=function(e){return e.replace(/&#(\d+);/g,function(t,r){return String.fromCharCode(parseInt(r,10))})},Em=function(e,t){return e&&typeof e=="string"&&t.comma&&e.indexOf(",")>-1?e.split(","):e},DS="utf8=%26%2310003%3B",BS="utf8=%E2%9C%93",OS=function(t,r){var n={__proto__:null},i=r.ignoreQueryPrefix?t.replace(/^\?/,""):t,o=r.parameterLimit===1/0?void 0:r.parameterLimit,l=i.split(r.delimiter,o),h=-1,u,f=r.charset;if(r.charsetSentinel)for(u=0;u<l.length;++u)l[u].indexOf("utf8=")===0&&(l[u]===BS?f="utf-8":l[u]===DS&&(f="iso-8859-1"),h=u,u=l.length);for(u=0;u<l.length;++u)if(u!==h){var d=l[u],g=d.indexOf("]="),m=g===-1?d.indexOf("="):g+1,v,_;m===-1?(v=r.decoder(d,ee.decoder,f,"key"),_=r.strictNullHandling?null:""):(v=r.decoder(d.slice(0,m),ee.decoder,f,"key"),_=ki.maybeMap(Em(d.slice(m+1),r),function(x){return r.decoder(x,ee.decoder,f,"value")})),_&&r.interpretNumericEntities&&f==="iso-8859-1"&&(_=MS(_)),d.indexOf("[]=")>-1&&(_=RS(_)?[_]:_);var w=Tu.call(n,v);w&&r.duplicates==="combine"?n[v]=ki.combine(n[v],_):(!w||r.duplicates==="last")&&(n[v]=_)}return n},FS=function(e,t,r,n){for(var i=n?t:Em(t,r),o=e.length-1;o>=0;--o){var l,h=e[o];if(h==="[]"&&r.parseArrays)l=r.allowEmptyArrays&&i===""?[]:[].concat(i);else{l=r.plainObjects?Object.create(null):{};var u=h.charAt(0)==="["&&h.charAt(h.length-1)==="]"?h.slice(1,-1):h,f=r.decodeDotInKeys?u.replace(/%2E/g,"."):u,d=parseInt(f,10);!r.parseArrays&&f===""?l={0:i}:!isNaN(d)&&h!==f&&String(d)===f&&d>=0&&r.parseArrays&&d<=r.arrayLimit?(l=[],l[d]=i):f!=="__proto__"&&(l[f]=i)}i=l}return i},LS=function(t,r,n,i){if(t){var o=n.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,l=/(\[[^[\]]*])/,h=/(\[[^[\]]*])/g,u=n.depth>0&&l.exec(o),f=u?o.slice(0,u.index):o,d=[];if(f){if(!n.plainObjects&&Tu.call(Object.prototype,f)&&!n.allowPrototypes)return;d.push(f)}for(var g=0;n.depth>0&&(u=h.exec(o))!==null&&g<n.depth;){if(g+=1,!n.plainObjects&&Tu.call(Object.prototype,u[1].slice(1,-1))&&!n.allowPrototypes)return;d.push(u[1])}return u&&d.push("["+o.slice(u.index)+"]"),FS(d,r,n,i)}},NS=function(t){if(!t)return ee;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.decodeDotInKeys<"u"&&typeof t.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(t.decoder!==null&&typeof t.decoder<"u"&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=typeof t.charset>"u"?ee.charset:t.charset,n=typeof t.duplicates>"u"?ee.duplicates:t.duplicates;if(n!=="combine"&&n!=="first"&&n!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var i=typeof t.allowDots>"u"?t.decodeDotInKeys===!0?!0:ee.allowDots:!!t.allowDots;return{allowDots:i,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:ee.allowEmptyArrays,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:ee.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:ee.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:ee.arrayLimit,charset:r,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:ee.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:ee.comma,decodeDotInKeys:typeof t.decodeDotInKeys=="boolean"?t.decodeDotInKeys:ee.decodeDotInKeys,decoder:typeof t.decoder=="function"?t.decoder:ee.decoder,delimiter:typeof t.delimiter=="string"||ki.isRegExp(t.delimiter)?t.delimiter:ee.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:ee.depth,duplicates:n,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:ee.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:ee.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:ee.plainObjects,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:ee.strictNullHandling}},kS=function(e,t){var r=NS(t);if(e===""||e===null||typeof e>"u")return r.plainObjects?Object.create(null):{};for(var n=typeof e=="string"?OS(e,r):e,i=r.plainObjects?Object.create(null):{},o=Object.keys(n),l=0;l<o.length;++l){var h=o[l],u=LS(h,n[h],r,typeof e=="string");i=ki.merge(i,u,r)}return r.allowSparse===!0?i:ki.compact(i)},US=PS,GS=kS,WS=uc,$S={formats:WS,parse:GS,stringify:US},HS=TT;function mr(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var zS=/^([a-z0-9.+-]+:)/i,XS=/:[0-9]*$/,VS=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,YS=["<",">",'"',"`"," ","\r",`
`,"	"],jS=["{","}","|","\\","^","`"].concat(YS),Au=["'"].concat(jS),$p=["%","/","?",";","#"].concat(Au),Hp=["/","?","#"],qS=255,zp=/^[+a-z0-9A-Z_-]{0,63}$/,KS=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,ZS={javascript:!0,"javascript:":!0},Su={javascript:!0,"javascript:":!0},Di={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Cu=$S;function Ha(e,t,r){if(e&&typeof e=="object"&&e instanceof mr)return e;var n=new mr;return n.parse(e,t,r),n}mr.prototype.parse=function(e,t,r){if(typeof e!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e.indexOf("?"),i=n!==-1&&n<e.indexOf("#")?"?":"#",o=e.split(i),l=/\\/g;o[0]=o[0].replace(l,"/"),e=o.join(i);var h=e;if(h=h.trim(),!r&&e.split("#").length===1){var u=VS.exec(h);if(u)return this.path=h,this.href=h,this.pathname=u[1],u[2]?(this.search=u[2],t?this.query=Cu.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var f=zS.exec(h);if(f){f=f[0];var d=f.toLowerCase();this.protocol=d,h=h.substr(f.length)}if(r||f||h.match(/^\/\/[^@/]+@[^@/]+/)){var g=h.substr(0,2)==="//";g&&!(f&&Su[f])&&(h=h.substr(2),this.slashes=!0)}if(!Su[f]&&(g||f&&!Di[f])){for(var m=-1,v=0;v<Hp.length;v++){var _=h.indexOf(Hp[v]);_!==-1&&(m===-1||_<m)&&(m=_)}var w,x;m===-1?x=h.lastIndexOf("@"):x=h.lastIndexOf("@",m),x!==-1&&(w=h.slice(0,x),h=h.slice(x+1),this.auth=decodeURIComponent(w)),m=-1;for(var v=0;v<$p.length;v++){var _=h.indexOf($p[v]);_!==-1&&(m===-1||_<m)&&(m=_)}m===-1&&(m=h.length),this.host=h.slice(0,m),h=h.slice(m),this.parseHost(),this.hostname=this.hostname||"";var A=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!A)for(var S=this.hostname.split(/\./),v=0,E=S.length;v<E;v++){var I=S[v];if(I&&!I.match(zp)){for(var D="",L=0,O=I.length;L<O;L++)I.charCodeAt(L)>127?D+="x":D+=I[L];if(!D.match(zp)){var F=S.slice(0,v),z=S.slice(v+1),j=I.match(KS);j&&(F.push(j[1]),z.unshift(j[2])),z.length&&(h="/"+z.join(".")+h),this.hostname=F.join(".");break}}}this.hostname.length>qS?this.hostname="":this.hostname=this.hostname.toLowerCase(),A||(this.hostname=HS.toASCII(this.hostname));var X=this.port?":"+this.port:"",K=this.hostname||"";this.host=K+X,this.href+=this.host,A&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),h[0]!=="/"&&(h="/"+h))}if(!ZS[d])for(var v=0,E=Au.length;v<E;v++){var W=Au[v];if(h.indexOf(W)!==-1){var k=encodeURIComponent(W);k===W&&(k=escape(W)),h=h.split(W).join(k)}}var lt=h.indexOf("#");lt!==-1&&(this.hash=h.substr(lt),h=h.slice(0,lt));var dt=h.indexOf("?");if(dt!==-1?(this.search=h.substr(dt),this.query=h.substr(dt+1),t&&(this.query=Cu.parse(this.query)),h=h.slice(0,dt)):t&&(this.search="",this.query={}),h&&(this.pathname=h),Di[d]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var X=this.pathname||"",Y=this.search||"";this.path=X+Y}return this.href=this.format(),this};function JS(e){return typeof e=="string"&&(e=Ha(e)),e instanceof mr?e.format():mr.prototype.format.call(e)}mr.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",i=!1,o="";this.host?i=e+this.host:this.hostname&&(i=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(o=Cu.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var l=this.search||o&&"?"+o||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||Di[t])&&i!==!1?(i="//"+(i||""),r&&r.charAt(0)!=="/"&&(r="/"+r)):i||(i=""),n&&n.charAt(0)!=="#"&&(n="#"+n),l&&l.charAt(0)!=="?"&&(l="?"+l),r=r.replace(/[?#]/g,function(h){return encodeURIComponent(h)}),l=l.replace("#","%23"),t+i+r+l+n};function QS(e,t){return Ha(e,!1,!0).resolve(t)}mr.prototype.resolve=function(e){return this.resolveObject(Ha(e,!1,!0)).format()};mr.prototype.resolveObject=function(e){if(typeof e=="string"){var t=new mr;t.parse(e,!1,!0),e=t}for(var r=new mr,n=Object.keys(this),i=0;i<n.length;i++){var o=n[i];r[o]=this[o]}if(r.hash=e.hash,e.href==="")return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),h=0;h<l.length;h++){var u=l[h];u!=="protocol"&&(r[u]=e[u])}return Di[r.protocol]&&r.hostname&&!r.pathname&&(r.pathname="/",r.path=r.pathname),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!Di[e.protocol]){for(var f=Object.keys(e),d=0;d<f.length;d++){var g=f[d];r[g]=e[g]}return r.href=r.format(),r}if(r.protocol=e.protocol,!e.host&&!Su[e.protocol]){for(var E=(e.pathname||"").split("/");E.length&&!(e.host=E.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),E[0]!==""&&E.unshift(""),E.length<2&&E.unshift(""),r.pathname=E.join("/")}else r.pathname=e.pathname;if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var m=r.pathname||"",v=r.search||"";r.path=m+v}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var _=r.pathname&&r.pathname.charAt(0)==="/",w=e.host||e.pathname&&e.pathname.charAt(0)==="/",x=w||_||r.host&&e.pathname,A=x,S=r.pathname&&r.pathname.split("/")||[],E=e.pathname&&e.pathname.split("/")||[],I=r.protocol&&!Di[r.protocol];if(I&&(r.hostname="",r.port=null,r.host&&(S[0]===""?S[0]=r.host:S.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(E[0]===""?E[0]=e.host:E.unshift(e.host)),e.host=null),x=x&&(E[0]===""||S[0]==="")),w)r.host=e.host||e.host===""?e.host:r.host,r.hostname=e.hostname||e.hostname===""?e.hostname:r.hostname,r.search=e.search,r.query=e.query,S=E;else if(E.length)S||(S=[]),S.pop(),S=S.concat(E),r.search=e.search,r.query=e.query;else if(e.search!=null){if(I){r.host=S.shift(),r.hostname=r.host;var D=r.host&&r.host.indexOf("@")>0?r.host.split("@"):!1;D&&(r.auth=D.shift(),r.hostname=D.shift(),r.host=r.hostname)}return r.search=e.search,r.query=e.query,(r.pathname!==null||r.search!==null)&&(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!S.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var L=S.slice(-1)[0],O=(r.host||e.host||S.length>1)&&(L==="."||L==="..")||L==="",F=0,z=S.length;z>=0;z--)L=S[z],L==="."?S.splice(z,1):L===".."?(S.splice(z,1),F++):F&&(S.splice(z,1),F--);if(!x&&!A)for(;F--;F)S.unshift("..");x&&S[0]!==""&&(!S[0]||S[0].charAt(0)!=="/")&&S.unshift(""),O&&S.join("/").substr(-1)!=="/"&&S.push("");var j=S[0]===""||S[0]&&S[0].charAt(0)==="/";if(I){r.hostname=j?"":S.length?S.shift():"",r.host=r.hostname;var D=r.host&&r.host.indexOf("@")>0?r.host.split("@"):!1;D&&(r.auth=D.shift(),r.hostname=D.shift(),r.host=r.hostname)}return x=x||r.host&&S.length,x&&!j&&S.unshift(""),S.length>0?r.pathname=S.join("/"):(r.pathname=null,r.path=null),(r.pathname!==null||r.search!==null)&&(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r};mr.prototype.parseHost=function(){var e=this.host,t=XS.exec(e);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)};var tC=Ha,eC=QS,rC=JS;const nC={parse:tC,format:rC,resolve:eC};function ar(e){if(typeof e!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function ms(e){return e.split("?")[0].split("#")[0]}function iC(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function sC(e,t,r){return e.replace(new RegExp(iC(t),"g"),r)}function oC(e,t){let r="",n=0,i=-1,o=0,l=-1;for(let h=0;h<=e.length;++h){if(h<e.length)l=e.charCodeAt(h);else{if(l===47)break;l=47}if(l===47){if(!(i===h-1||o===1))if(i!==h-1&&o===2){if(r.length<2||n!==2||r.charCodeAt(r.length-1)!==46||r.charCodeAt(r.length-2)!==46){if(r.length>2){const u=r.lastIndexOf("/");if(u!==r.length-1){u===-1?(r="",n=0):(r=r.slice(0,u),n=r.length-1-r.lastIndexOf("/")),i=h,o=0;continue}}else if(r.length===2||r.length===1){r="",n=0,i=h,o=0;continue}}}else r.length>0?r+=`/${e.slice(i+1,h)}`:r=e.slice(i+1,h),n=h-i-1;i=h,o=0}else l===46&&o!==-1?++o:o=-1}return r}const ve={toPosix(e){return sC(e,"\\","/")},isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl(e){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(e)},hasProtocol(e){return/^[^/:]+:\//.test(this.toPosix(e))},getProtocol(e){ar(e),e=this.toPosix(e);let t="";const r=/^file:\/\/\//.exec(e),n=/^[^/:]+:\/\//.exec(e),i=/^[^/:]+:\//.exec(e);if(r||n||i){const o=(r==null?void 0:r[0])||(n==null?void 0:n[0])||(i==null?void 0:i[0]);t=o,e=e.slice(o.length)}return t},toAbsolute(e,t,r){if(this.isDataUrl(e))return e;const n=ms(this.toPosix(t??J.ADAPTER.getBaseUrl())),i=ms(this.toPosix(r??this.rootname(n)));return ar(e),e=this.toPosix(e),e.startsWith("/")?ve.join(i,e.slice(1)):this.isAbsolute(e)?e:this.join(n,e)},normalize(e){if(e=this.toPosix(e),ar(e),e.length===0)return".";let t="";const r=e.startsWith("/");this.hasProtocol(e)&&(t=this.rootname(e),e=e.slice(t.length));const n=e.endsWith("/");return e=oC(e),e.length>0&&n&&(e+="/"),r?`/${e}`:t+e},isAbsolute(e){return ar(e),e=this.toPosix(e),this.hasProtocol(e)?!0:e.startsWith("/")},join(...e){if(e.length===0)return".";let t;for(let r=0;r<e.length;++r){const n=e[r];if(ar(n),n.length>0)if(t===void 0)t=n;else{const i=e[r-1]??"";this.extname(i)?t+=`/../${n}`:t+=`/${n}`}}return t===void 0?".":this.normalize(t)},dirname(e){if(ar(e),e.length===0)return".";e=this.toPosix(e);let t=e.charCodeAt(0);const r=t===47;let n=-1,i=!0;const o=this.getProtocol(e),l=e;e=e.slice(o.length);for(let h=e.length-1;h>=1;--h)if(t=e.charCodeAt(h),t===47){if(!i){n=h;break}}else i=!1;return n===-1?r?"/":this.isUrl(l)?o+e:o:r&&n===1?"//":o+e.slice(0,n)},rootname(e){ar(e),e=this.toPosix(e);let t="";if(e.startsWith("/")?t="/":t=this.getProtocol(e),this.isUrl(e)){const r=e.indexOf("/",t.length);r!==-1?t=e.slice(0,r):t=e,t.endsWith("/")||(t+="/")}return t},basename(e,t){ar(e),t&&ar(t),e=ms(this.toPosix(e));let r=0,n=-1,i=!0,o;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let l=t.length-1,h=-1;for(o=e.length-1;o>=0;--o){const u=e.charCodeAt(o);if(u===47){if(!i){r=o+1;break}}else h===-1&&(i=!1,h=o+1),l>=0&&(u===t.charCodeAt(l)?--l===-1&&(n=o):(l=-1,n=h))}return r===n?n=h:n===-1&&(n=e.length),e.slice(r,n)}for(o=e.length-1;o>=0;--o)if(e.charCodeAt(o)===47){if(!i){r=o+1;break}}else n===-1&&(i=!1,n=o+1);return n===-1?"":e.slice(r,n)},extname(e){ar(e),e=ms(this.toPosix(e));let t=-1,r=0,n=-1,i=!0,o=0;for(let l=e.length-1;l>=0;--l){const h=e.charCodeAt(l);if(h===47){if(!i){r=l+1;break}continue}n===-1&&(i=!1,n=l+1),h===46?t===-1?t=l:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||n===-1||o===0||o===1&&t===n-1&&t===r+1?"":e.slice(t,n)},parse(e){ar(e);const t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;e=ms(this.toPosix(e));let r=e.charCodeAt(0);const n=this.isAbsolute(e);let i;t.root=this.rootname(e),n||this.hasProtocol(e)?i=1:i=0;let o=-1,l=0,h=-1,u=!0,f=e.length-1,d=0;for(;f>=i;--f){if(r=e.charCodeAt(f),r===47){if(!u){l=f+1;break}continue}h===-1&&(u=!1,h=f+1),r===46?o===-1?o=f:d!==1&&(d=1):o!==-1&&(d=-1)}return o===-1||h===-1||d===0||d===1&&o===h-1&&o===l+1?h!==-1&&(l===0&&n?t.base=t.name=e.slice(1,h):t.base=t.name=e.slice(l,h)):(l===0&&n?(t.name=e.slice(1,o),t.base=e.slice(1,h)):(t.name=e.slice(l,o),t.base=e.slice(l,h)),t.ext=e.slice(o,h)),t.dir=this.dirname(e),t},sep:"/",delimiter:":"},Xp={};function Ct(e,t,r=3){if(Xp[t])return;let n=new Error().stack;typeof n>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`):(n=n.split(`
`).splice(r).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${e}`),console.warn(n),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`),console.warn(n))),Xp[t]=!0}let Bh;function aC(){return typeof Bh>"u"&&(Bh=function(){var r;const t={stencil:!0,failIfMajorPerformanceCaveat:J.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!J.ADAPTER.getWebGLRenderingContext())return!1;const n=J.ADAPTER.createCanvas();let i=n.getContext("webgl",t)||n.getContext("experimental-webgl",t);const o=!!((r=i==null?void 0:i.getContextAttributes())!=null&&r.stencil);if(i){const l=i.getExtension("WEBGL_lose_context");l&&l.loseContext()}return i=null,o}catch{return!1}}()),Bh}var lC="#f0f8ff",hC="#faebd7",uC="#00ffff",cC="#7fffd4",fC="#f0ffff",dC="#f5f5dc",pC="#ffe4c4",gC="#000000",mC="#ffebcd",vC="#0000ff",yC="#8a2be2",_C="#a52a2a",xC="#deb887",bC="#5f9ea0",wC="#7fff00",EC="#d2691e",TC="#ff7f50",AC="#6495ed",SC="#fff8dc",CC="#dc143c",IC="#00ffff",PC="#00008b",RC="#008b8b",MC="#b8860b",DC="#a9a9a9",BC="#006400",OC="#a9a9a9",FC="#bdb76b",LC="#8b008b",NC="#556b2f",kC="#ff8c00",UC="#9932cc",GC="#8b0000",WC="#e9967a",$C="#8fbc8f",HC="#483d8b",zC="#2f4f4f",XC="#2f4f4f",VC="#00ced1",YC="#9400d3",jC="#ff1493",qC="#00bfff",KC="#696969",ZC="#696969",JC="#1e90ff",QC="#b22222",tI="#fffaf0",eI="#228b22",rI="#ff00ff",nI="#dcdcdc",iI="#f8f8ff",sI="#daa520",oI="#ffd700",aI="#808080",lI="#008000",hI="#adff2f",uI="#808080",cI="#f0fff0",fI="#ff69b4",dI="#cd5c5c",pI="#4b0082",gI="#fffff0",mI="#f0e68c",vI="#fff0f5",yI="#e6e6fa",_I="#7cfc00",xI="#fffacd",bI="#add8e6",wI="#f08080",EI="#e0ffff",TI="#fafad2",AI="#d3d3d3",SI="#90ee90",CI="#d3d3d3",II="#ffb6c1",PI="#ffa07a",RI="#20b2aa",MI="#87cefa",DI="#778899",BI="#778899",OI="#b0c4de",FI="#ffffe0",LI="#00ff00",NI="#32cd32",kI="#faf0e6",UI="#ff00ff",GI="#800000",WI="#66cdaa",$I="#0000cd",HI="#ba55d3",zI="#9370db",XI="#3cb371",VI="#7b68ee",YI="#00fa9a",jI="#48d1cc",qI="#c71585",KI="#191970",ZI="#f5fffa",JI="#ffe4e1",QI="#ffe4b5",tP="#ffdead",eP="#000080",rP="#fdf5e6",nP="#808000",iP="#6b8e23",sP="#ffa500",oP="#ff4500",aP="#da70d6",lP="#eee8aa",hP="#98fb98",uP="#afeeee",cP="#db7093",fP="#ffefd5",dP="#ffdab9",pP="#cd853f",gP="#ffc0cb",mP="#dda0dd",vP="#b0e0e6",yP="#800080",_P="#663399",xP="#ff0000",bP="#bc8f8f",wP="#4169e1",EP="#8b4513",TP="#fa8072",AP="#f4a460",SP="#2e8b57",CP="#fff5ee",IP="#a0522d",PP="#c0c0c0",RP="#87ceeb",MP="#6a5acd",DP="#708090",BP="#708090",OP="#fffafa",FP="#00ff7f",LP="#4682b4",NP="#d2b48c",kP="#008080",UP="#d8bfd8",GP="#ff6347",WP="#40e0d0",$P="#ee82ee",HP="#f5deb3",zP="#ffffff",XP="#f5f5f5",VP="#ffff00",YP="#9acd32",jP={aliceblue:lC,antiquewhite:hC,aqua:uC,aquamarine:cC,azure:fC,beige:dC,bisque:pC,black:gC,blanchedalmond:mC,blue:vC,blueviolet:yC,brown:_C,burlywood:xC,cadetblue:bC,chartreuse:wC,chocolate:EC,coral:TC,cornflowerblue:AC,cornsilk:SC,crimson:CC,cyan:IC,darkblue:PC,darkcyan:RC,darkgoldenrod:MC,darkgray:DC,darkgreen:BC,darkgrey:OC,darkkhaki:FC,darkmagenta:LC,darkolivegreen:NC,darkorange:kC,darkorchid:UC,darkred:GC,darksalmon:WC,darkseagreen:$C,darkslateblue:HC,darkslategray:zC,darkslategrey:XC,darkturquoise:VC,darkviolet:YC,deeppink:jC,deepskyblue:qC,dimgray:KC,dimgrey:ZC,dodgerblue:JC,firebrick:QC,floralwhite:tI,forestgreen:eI,fuchsia:rI,gainsboro:nI,ghostwhite:iI,goldenrod:sI,gold:oI,gray:aI,green:lI,greenyellow:hI,grey:uI,honeydew:cI,hotpink:fI,indianred:dI,indigo:pI,ivory:gI,khaki:mI,lavenderblush:vI,lavender:yI,lawngreen:_I,lemonchiffon:xI,lightblue:bI,lightcoral:wI,lightcyan:EI,lightgoldenrodyellow:TI,lightgray:AI,lightgreen:SI,lightgrey:CI,lightpink:II,lightsalmon:PI,lightseagreen:RI,lightskyblue:MI,lightslategray:DI,lightslategrey:BI,lightsteelblue:OI,lightyellow:FI,lime:LI,limegreen:NI,linen:kI,magenta:UI,maroon:GI,mediumaquamarine:WI,mediumblue:$I,mediumorchid:HI,mediumpurple:zI,mediumseagreen:XI,mediumslateblue:VI,mediumspringgreen:YI,mediumturquoise:jI,mediumvioletred:qI,midnightblue:KI,mintcream:ZI,mistyrose:JI,moccasin:QI,navajowhite:tP,navy:eP,oldlace:rP,olive:nP,olivedrab:iP,orange:sP,orangered:oP,orchid:aP,palegoldenrod:lP,palegreen:hP,paleturquoise:uP,palevioletred:cP,papayawhip:fP,peachpuff:dP,peru:pP,pink:gP,plum:mP,powderblue:vP,purple:yP,rebeccapurple:_P,red:xP,rosybrown:bP,royalblue:wP,saddlebrown:EP,salmon:TP,sandybrown:AP,seagreen:SP,seashell:CP,sienna:IP,silver:PP,skyblue:RP,slateblue:MP,slategray:DP,slategrey:BP,snow:OP,springgreen:FP,steelblue:LP,tan:NP,teal:kP,thistle:UP,tomato:GP,turquoise:WP,violet:$P,wheat:HP,white:zP,whitesmoke:XP,yellow:VP,yellowgreen:YP};function Bs(e,t=[]){return t[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(e&255)/255,t}function Tm(e){let t=e.toString(16);return t="000000".substring(0,6-t.length)+t,`#${t}`}function cc(e){if(typeof e=="string"&&(e=jP[e.toLowerCase()]||e,e[0]==="#"&&(e=e.slice(1)),e.length===3)){const[t,r,n]=e;e=t+t+r+r+n+n}return parseInt(e,16)}function qP(){const e=[],t=[];for(let n=0;n<32;n++)e[n]=n,t[n]=n;e[ct.NORMAL_NPM]=ct.NORMAL,e[ct.ADD_NPM]=ct.ADD,e[ct.SCREEN_NPM]=ct.SCREEN,t[ct.NORMAL]=ct.NORMAL_NPM,t[ct.ADD]=ct.ADD_NPM,t[ct.SCREEN]=ct.SCREEN_NPM;const r=[];return r.push(t),r.push(e),r}const Am=qP();function Sm(e,t){return Am[t?1:0][e]}function KP(e,t,r,n){return r=r||new Float32Array(4),n||n===void 0?(r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t):(r[0]=e[0],r[1]=e[1],r[2]=e[2]),r[3]=t,r}function fc(e,t){if(t===1)return(t*255<<24)+e;if(t===0)return 0;let r=e>>16&255,n=e>>8&255,i=e&255;return r=r*t+.5|0,n=n*t+.5|0,i=i*t+.5|0,(t*255<<24)+(r<<16)+(n<<8)+i}function Cm(e,t,r,n){return r=r||new Float32Array(4),r[0]=(e>>16&255)/255,r[1]=(e>>8&255)/255,r[2]=(e&255)/255,(n||n===void 0)&&(r[0]*=t,r[1]*=t,r[2]*=t),r[3]=t,r}function ZP(e,t=null){const r=e*6;if(t=t||new Uint16Array(r),t.length!==r)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${r}`);for(let n=0,i=0;n<r;n+=6,i+=4)t[n+0]=i+0,t[n+1]=i+1,t[n+2]=i+2,t[n+3]=i+0,t[n+4]=i+2,t[n+5]=i+3;return t}function Im(e){if(e.BYTES_PER_ELEMENT===4)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(e.BYTES_PER_ELEMENT===2){if(e instanceof Uint16Array)return"Uint16Array"}else if(e.BYTES_PER_ELEMENT===1&&e instanceof Uint8Array)return"Uint8Array";return null}function Aa(e){return e+=e===0?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e+1}function Vp(e){return!(e&e-1)&&!!e}function Yp(e){let t=(e>65535?1:0)<<4;e>>>=t;let r=(e>255?1:0)<<3;return e>>>=r,t|=r,r=(e>15?1:0)<<2,e>>>=r,t|=r,r=(e>3?1:0)<<1,e>>>=r,t|=r,t|e>>1}function Bi(e,t,r){const n=e.length;let i;if(t>=n||r===0)return;r=t+r>n?n-t:r;const o=n-r;for(i=t;i<o;++i)e[i]=e[i+r];e.length=o}function Si(e){return e===0?0:e<0?-1:1}let JP=0;function qn(){return++JP}const Pm=class{constructor(e,t,r,n){this.left=e,this.top=t,this.right=r,this.bottom=n}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let Iu=Pm;Iu.EMPTY=new Pm(0,0,0,0);const jp={},Sr=Object.create(null),ln=Object.create(null);class qp{constructor(t,r,n){this._canvas=J.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=n||J.RESOLUTION,this.resize(t,r)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,r){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(r*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function Kp(e,t,r){for(let n=0,i=4*r*t;n<t;++n,i+=4)if(e[i+3]!==0)return!1;return!0}function Zp(e,t,r,n,i){const o=4*t;for(let l=n,h=n*o+4*r;l<=i;++l,h+=o)if(e[h+3]!==0)return!1;return!0}function QP(e){const{width:t,height:r}=e,n=e.getContext("2d",{willReadFrequently:!0});if(n===null)throw new TypeError("Failed to get canvas 2D context");const o=n.getImageData(0,0,t,r).data;let l=0,h=0,u=t-1,f=r-1;for(;h<r&&Kp(o,t,h);)++h;if(h===r)return Iu.EMPTY;for(;Kp(o,t,f);)--f;for(;Zp(o,t,l,h,f);)++l;for(;Zp(o,t,u,h,f);)--u;return++u,++f,new Iu(l,h,u,f)}function tR(e){const t=QP(e),{width:r,height:n}=t;let i=null;if(!t.isEmpty()){const o=e.getContext("2d");if(o===null)throw new TypeError("Failed to get canvas 2D context");i=o.getImageData(t.left,t.top,r,n)}return{width:r,height:n,data:i}}let Go;function eR(e,t=globalThis.location){if(e.startsWith("data:"))return"";t=t||globalThis.location,Go||(Go=document.createElement("a")),Go.href=e;const r=nC.parse(Go.href),n=!r.port&&t.port===""||r.port===t.port;return r.hostname!==t.hostname||!n||r.protocol!==t.protocol?"anonymous":""}function mn(e,t=1){var n;const r=(n=J.RETINA_PREFIX)==null?void 0:n.exec(e);return r?parseFloat(r[1]):t}var Z=(e=>(e.Renderer="renderer",e.Application="application",e.RendererSystem="renderer-webgl-system",e.RendererPlugin="renderer-webgl-plugin",e.CanvasRendererSystem="renderer-canvas-system",e.CanvasRendererPlugin="renderer-canvas-plugin",e.Asset="asset",e.LoadParser="load-parser",e.ResolveParser="resolve-parser",e.CacheParser="cache-parser",e.DetectionParser="detection-parser",e))(Z||{});const Pu=e=>{if(typeof e=="function"||typeof e=="object"&&e.extension){if(!e.extension)throw new Error("Extension class must have an extension object");e={...typeof e.extension!="object"?{type:e.extension}:e.extension,ref:e}}if(typeof e=="object")e={...e};else throw new Error("Invalid extension type");return typeof e.type=="string"&&(e.type=[e.type]),e},Jp=(e,t)=>Pu(e).priority??t,st={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...e){return e.map(Pu).forEach(t=>{t.type.forEach(r=>{var n,i;return(i=(n=this._removeHandlers)[r])==null?void 0:i.call(n,t)})}),this},add(...e){return e.map(Pu).forEach(t=>{t.type.forEach(r=>{const n=this._addHandlers,i=this._queue;n[r]?n[r](t):(i[r]=i[r]||[],i[r].push(t))})}),this},handle(e,t,r){const n=this._addHandlers,i=this._removeHandlers;if(n[e]||i[e])throw new Error(`Extension type ${e} already has a handler`);n[e]=t,i[e]=r;const o=this._queue;return o[e]&&(o[e].forEach(l=>t(l)),delete o[e]),this},handleByMap(e,t){return this.handle(e,r=>{t[r.name]=r.ref},r=>{delete t[r.name]})},handleByList(e,t,r=-1){return this.handle(e,n=>{t.includes(n.ref)||(t.push(n.ref),t.sort((i,o)=>Jp(o,r)-Jp(i,r)))},n=>{const i=t.indexOf(n.ref);i!==-1&&t.splice(i,1)})}};class Ru{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const rR=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function nR(e){let t="";for(let r=0;r<e;++r)r>0&&(t+=`
else `),r<e-1&&(t+=`if(test == ${r}.0){}`);return t}function iR(e,t){if(e===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const r=t.createShader(t.FRAGMENT_SHADER);for(;;){const n=rR.replace(/%forloop%/gi,nR(e));if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))e=e/2|0;else break}return e}const Oh=0,Fh=1,Lh=2,Nh=3,kh=4,Uh=5;class Zr{constructor(){this.data=0,this.blendMode=ct.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Oh)}set blend(t){!!(this.data&1<<Oh)!==t&&(this.data^=1<<Oh)}get offsets(){return!!(this.data&1<<Fh)}set offsets(t){!!(this.data&1<<Fh)!==t&&(this.data^=1<<Fh)}get culling(){return!!(this.data&1<<Lh)}set culling(t){!!(this.data&1<<Lh)!==t&&(this.data^=1<<Lh)}get depthTest(){return!!(this.data&1<<Nh)}set depthTest(t){!!(this.data&1<<Nh)!==t&&(this.data^=1<<Nh)}get depthMask(){return!!(this.data&1<<Uh)}set depthMask(t){!!(this.data&1<<Uh)!==t&&(this.data^=1<<Uh)}get clockwiseFrontFace(){return!!(this.data&1<<kh)}set clockwiseFrontFace(t){!!(this.data&1<<kh)!==t&&(this.data^=1<<kh)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==ct.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new Zr;return t.depthTest=!1,t.blend=!0,t}}const Mu=[];function Rm(e,t){if(!e)return null;let r="";if(typeof e=="string"){const n=/\.(\w{3,4})(?:$|\?|#)/i.exec(e);n&&(r=n[1].toLowerCase())}for(let n=Mu.length-1;n>=0;--n){const i=Mu[n];if(i.test&&i.test(e,r))return new i(e,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class vr{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,r,n,i,o,l,h,u){if(arguments.length>8)throw new Error("max arguments reached");const{name:f,items:d}=this;this._aliasCount++;for(let g=0,m=d.length;g<m;g++)d[g][f](t,r,n,i,o,l,h,u);return d===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const r=this.items.indexOf(t);return r!==-1&&(this.ensureNonAliasedItems(),this.items.splice(r,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(vr.prototype,{dispatch:{value:vr.prototype.emit},run:{value:vr.prototype.emit}});class Os{constructor(t=0,r=0){this._width=t,this._height=r,this.destroyed=!1,this.internal=!1,this.onResize=new vr("setRealSize"),this.onUpdate=new vr("update"),this.onError=new vr("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,r){(t!==this._width||r!==this._height)&&(this._width=t,this._height=r,this.onResize.emit(t,r))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,r,n){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,r){return!1}}class Ws extends Os{constructor(t,r){const{width:n,height:i}=r||{};if(!n||!i)throw new Error("BufferResource width or height invalid");super(n,i),this.data=t}upload(t,r,n){const i=t.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===_r.UNPACK);const o=r.realWidth,l=r.realHeight;return n.width===o&&n.height===l?i.texSubImage2D(r.target,0,0,0,o,l,r.format,n.type,this.data):(n.width=o,n.height=l,i.texImage2D(r.target,0,n.internalFormat,o,l,0,r.format,n.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const sR={scaleMode:Yr.NEAREST,format:V.RGBA,alphaMode:_r.NPM},wi=class extends ks{constructor(e=null,t=null){super(),t=Object.assign({},wi.defaultOptions,t);const{alphaMode:r,mipmap:n,anisotropicLevel:i,scaleMode:o,width:l,height:h,wrapMode:u,format:f,type:d,target:g,resolution:m,resourceOptions:v}=t;e&&!(e instanceof Os)&&(e=Rm(e,v),e.internal=!0),this.resolution=m||J.RESOLUTION,this.width=Math.round((l||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=n,this.anisotropicLevel=i,this._wrapMode=u,this._scaleMode=o,this.format=f,this.type=d,this.target=g,this.alphaMode=r,this.uid=qn(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=l>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let r;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,r=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,r=!0),r&&this.dirtyStyleId++,this}setSize(e,t,r){return r=r||this.resolution,this.setRealSize(e*r,t*r,r)}setRealSize(e,t,r){return this.resolution=r||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Vp(this.realWidth)&&Vp(this.realHeight)}setResolution(e){const t=this.resolution;return t===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT(),this)}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete ln[this.cacheId],delete Sr[this.cacheId],this.cacheId=null),this.dispose(),wi.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,t,r=J.STRICT_TEXTURE_CACHE){const n=typeof e=="string";let i=null;if(n)i=e;else{if(!e._pixiId){const l=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${l}_${qn()}`}i=e._pixiId}let o=ln[i];if(n&&r&&!o)throw new Error(`The cacheId "${i}" does not exist in BaseTextureCache.`);return o||(o=new wi(e,t),o.cacheId=i,wi.addToCache(o,i)),o}static fromBuffer(e,t,r,n){e=e||new Float32Array(t*r*4);const i=new Ws(e,{width:t,height:r}),o=e instanceof Float32Array?ot.FLOAT:ot.UNSIGNED_BYTE;return new wi(i,Object.assign({},sR,n||{width:t,height:r,type:o}))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),ln[t]&&ln[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),ln[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=ln[e];if(t){const r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete ln[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete ln[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};let gt=wi;gt.defaultOptions={mipmap:Or.POW2,anisotropicLevel:0,scaleMode:Yr.LINEAR,wrapMode:gn.CLAMP,alphaMode:_r.UNPACK,target:Ri.TEXTURE_2D,format:V.RGBA,type:ot.UNSIGNED_BYTE};gt._globalBatch=0;class Du{constructor(){this.texArray=null,this.blend=0,this.type=Mr.TRIANGLES,this.start=0,this.size=0,this.data=null}}let oR=0;class re{constructor(t,r=!0,n=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=n,this.static=r,this.id=oR++,this.disposeRunner=new vr("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Dr.ELEMENT_ARRAY_BUFFER:Dr.ARRAY_BUFFER}get index(){return this.type===Dr.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new re(t)}}class Sa{constructor(t,r=0,n=!1,i=ot.FLOAT,o,l,h,u=1){this.buffer=t,this.size=r,this.normalized=n,this.type=i,this.stride=o,this.start=l,this.instance=h,this.divisor=u}destroy(){this.buffer=null}static from(t,r,n,i,o){return new Sa(t,r,n,i,o)}}const aR={Float32Array,Uint32Array,Int32Array,Uint8Array};function lR(e,t){let r=0,n=0;const i={};for(let u=0;u<e.length;u++)n+=t[u],r+=e[u].length;const o=new ArrayBuffer(r*4);let l=null,h=0;for(let u=0;u<e.length;u++){const f=t[u],d=e[u],g=Im(d);i[g]||(i[g]=new aR[g](o)),l=i[g];for(let m=0;m<d.length;m++){const v=(m/f|0)*n+h,_=m%f;l[v+_]=d[m]}h+=f}return new Float32Array(o)}const Qp={5126:4,5123:2,5121:1};let hR=0;const uR={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class vn{constructor(t=[],r={}){this.buffers=t,this.indexBuffer=null,this.attributes=r,this.glVertexArrayObjects={},this.id=hR++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new vr("disposeGeometry"),this.refCount=0}addAttribute(t,r,n=0,i=!1,o,l,h,u=!1){if(!r)throw new Error("You must pass a buffer when creating an attribute");r instanceof re||(r instanceof Array&&(r=new Float32Array(r)),r=new re(r));const f=t.split("|");if(f.length>1){for(let g=0;g<f.length;g++)this.addAttribute(f[g],r,n,i,o);return this}let d=this.buffers.indexOf(r);return d===-1&&(this.buffers.push(r),d=this.buffers.length-1),this.attributes[t]=new Sa(d,n,i,o,l,h,u),this.instanced=this.instanced||u,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof re||(t instanceof Array&&(t=new Uint16Array(t)),t=new re(t)),t.type=Dr.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],r=[],n=new re;let i;for(i in this.attributes){const o=this.attributes[i],l=this.buffers[o.buffer];t.push(l.data),r.push(o.size*Qp[o.type]/4),o.buffer=0}for(n.data=lR(t,r),i=0;i<this.buffers.length;i++)this.buffers[i]!==this.indexBuffer&&this.buffers[i].destroy();return this.buffers=[n],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const r=this.attributes[t];return this.buffers[r.buffer].data.length/(r.stride/4||r.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new vn;for(let r=0;r<this.buffers.length;r++)t.buffers[r]=new re(this.buffers[r].data.slice(0));for(const r in this.attributes){const n=this.attributes[r];t.attributes[r]=new Sa(n.buffer,n.size,n.normalized,n.type,n.stride,n.start,n.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Dr.ELEMENT_ARRAY_BUFFER),t}static merge(t){const r=new vn,n=[],i=[],o=[];let l;for(let h=0;h<t.length;h++){l=t[h];for(let u=0;u<l.buffers.length;u++)i[u]=i[u]||0,i[u]+=l.buffers[u].data.length,o[u]=0}for(let h=0;h<l.buffers.length;h++)n[h]=new uR[Im(l.buffers[h].data)](i[h]),r.buffers[h]=new re(n[h]);for(let h=0;h<t.length;h++){l=t[h];for(let u=0;u<l.buffers.length;u++)n[u].set(l.buffers[u].data,o[u]),o[u]+=l.buffers[u].data.length}if(r.attributes=l.attributes,l.indexBuffer){r.indexBuffer=r.buffers[l.buffers.indexOf(l.indexBuffer)],r.indexBuffer.type=Dr.ELEMENT_ARRAY_BUFFER;let h=0,u=0,f=0,d=0;for(let g=0;g<l.buffers.length;g++)if(l.buffers[g]!==l.indexBuffer){d=g;break}for(const g in l.attributes){const m=l.attributes[g];(m.buffer|0)===d&&(u+=m.size*Qp[m.type]/4)}for(let g=0;g<t.length;g++){const m=t[g].indexBuffer.data;for(let v=0;v<m.length;v++)r.indexBuffer.data[v+f]+=h;h+=t[g].buffers[d].data.length/u,f+=m.length}}return r}}class Mm extends vn{constructor(t=!1){super(),this._buffer=new re(null,t,!1),this._indexBuffer=new re(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,ot.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,ot.FLOAT).addAttribute("aColor",this._buffer,4,!0,ot.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,ot.FLOAT).addIndex(this._indexBuffer)}}const Ca=Math.PI*2,cR=180/Math.PI,fR=Math.PI/180;var me=(e=>(e[e.POLY=0]="POLY",e[e.RECT=1]="RECT",e[e.CIRC=2]="CIRC",e[e.ELIP=3]="ELIP",e[e.RREC=4]="RREC",e))(me||{});class St{constructor(t=0,r=0){this.x=0,this.y=0,this.x=t,this.y=r}clone(){return new St(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,r=t){return this.x=t,this.y=r,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const Wo=[new St,new St,new St,new St];class Tt{constructor(t=0,r=0,n=0,i=0){this.x=Number(t),this.y=Number(r),this.width=Number(n),this.height=Number(i),this.type=me.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Tt(0,0,0,0)}clone(){return new Tt(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,r){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&r>=this.y&&r<this.y+this.height}intersects(t,r){if(!r){const F=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=F)return!1;const j=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>j}const n=this.left,i=this.right,o=this.top,l=this.bottom;if(i<=n||l<=o)return!1;const h=Wo[0].set(t.left,t.top),u=Wo[1].set(t.left,t.bottom),f=Wo[2].set(t.right,t.top),d=Wo[3].set(t.right,t.bottom);if(f.x<=h.x||u.y<=h.y)return!1;const g=Math.sign(r.a*r.d-r.b*r.c);if(g===0||(r.apply(h,h),r.apply(u,u),r.apply(f,f),r.apply(d,d),Math.max(h.x,u.x,f.x,d.x)<=n||Math.min(h.x,u.x,f.x,d.x)>=i||Math.max(h.y,u.y,f.y,d.y)<=o||Math.min(h.y,u.y,f.y,d.y)>=l))return!1;const m=g*(u.y-h.y),v=g*(h.x-u.x),_=m*n+v*o,w=m*i+v*o,x=m*n+v*l,A=m*i+v*l;if(Math.max(_,w,x,A)<=m*h.x+v*h.y||Math.min(_,w,x,A)>=m*d.x+v*d.y)return!1;const S=g*(h.y-f.y),E=g*(f.x-h.x),I=S*n+E*o,D=S*i+E*o,L=S*n+E*l,O=S*i+E*l;return!(Math.max(I,D,L,O)<=S*h.x+E*h.y||Math.min(I,D,L,O)>=S*d.x+E*d.y)}pad(t=0,r=t){return this.x-=t,this.y-=r,this.width+=t*2,this.height+=r*2,this}fit(t){const r=Math.max(this.x,t.x),n=Math.min(this.x+this.width,t.x+t.width),i=Math.max(this.y,t.y),o=Math.min(this.y+this.height,t.y+t.height);return this.x=r,this.width=Math.max(n-r,0),this.y=i,this.height=Math.max(o-i,0),this}ceil(t=1,r=.001){const n=Math.ceil((this.x+this.width-r)*t)/t,i=Math.ceil((this.y+this.height-r)*t)/t;return this.x=Math.floor((this.x+r)*t)/t,this.y=Math.floor((this.y+r)*t)/t,this.width=n-this.x,this.height=i-this.y,this}enlarge(t){const r=Math.min(this.x,t.x),n=Math.max(this.x+this.width,t.x+t.width),i=Math.min(this.y,t.y),o=Math.max(this.y+this.height,t.y+t.height);return this.x=r,this.width=n-r,this.y=i,this.height=o-i,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class dc{constructor(t=0,r=0,n=0){this.x=t,this.y=r,this.radius=n,this.type=me.CIRC}clone(){return new dc(this.x,this.y,this.radius)}contains(t,r){if(this.radius<=0)return!1;const n=this.radius*this.radius;let i=this.x-t,o=this.y-r;return i*=i,o*=o,i+o<=n}getBounds(){return new Tt(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class pc{constructor(t=0,r=0,n=0,i=0){this.x=t,this.y=r,this.width=n,this.height=i,this.type=me.ELIP}clone(){return new pc(this.x,this.y,this.width,this.height)}contains(t,r){if(this.width<=0||this.height<=0)return!1;let n=(t-this.x)/this.width,i=(r-this.y)/this.height;return n*=n,i*=i,n+i<=1}getBounds(){return new Tt(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Oi{constructor(...t){let r=Array.isArray(t[0])?t[0]:t;if(typeof r[0]!="number"){const n=[];for(let i=0,o=r.length;i<o;i++)n.push(r[i].x,r[i].y);r=n}this.points=r,this.type=me.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),r=new Oi(t);return r.closeStroke=this.closeStroke,r}contains(t,r){let n=!1;const i=this.points.length/2;for(let o=0,l=i-1;o<i;l=o++){const h=this.points[o*2],u=this.points[o*2+1],f=this.points[l*2],d=this.points[l*2+1];u>r!=d>r&&t<(f-h)*((r-u)/(d-u))+h&&(n=!n)}return n}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((t,r)=>`${t}, ${r}`,"")}]`}}class gc{constructor(t=0,r=0,n=0,i=0,o=20){this.x=t,this.y=r,this.width=n,this.height=i,this.radius=o,this.type=me.RREC}clone(){return new gc(this.x,this.y,this.width,this.height,this.radius)}contains(t,r){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&r>=this.y&&r<=this.y+this.height){const n=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(r>=this.y+n&&r<=this.y+this.height-n||t>=this.x+n&&t<=this.x+this.width-n)return!0;let i=t-(this.x+n),o=r-(this.y+n);const l=n*n;if(i*i+o*o<=l||(i=t-(this.x+this.width-n),i*i+o*o<=l)||(o=r-(this.y+this.height-n),i*i+o*o<=l)||(i=t-(this.x+n),i*i+o*o<=l))return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class Ht{constructor(t=1,r=0,n=0,i=1,o=0,l=0){this.array=null,this.a=t,this.b=r,this.c=n,this.d=i,this.tx=o,this.ty=l}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,r,n,i,o,l){return this.a=t,this.b=r,this.c=n,this.d=i,this.tx=o,this.ty=l,this}toArray(t,r){this.array||(this.array=new Float32Array(9));const n=r||this.array;return t?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n}apply(t,r){r=r||new St;const n=t.x,i=t.y;return r.x=this.a*n+this.c*i+this.tx,r.y=this.b*n+this.d*i+this.ty,r}applyInverse(t,r){r=r||new St;const n=1/(this.a*this.d+this.c*-this.b),i=t.x,o=t.y;return r.x=this.d*n*i+-this.c*n*o+(this.ty*this.c-this.tx*this.d)*n,r.y=this.a*n*o+-this.b*n*i+(-this.ty*this.a+this.tx*this.b)*n,r}translate(t,r){return this.tx+=t,this.ty+=r,this}scale(t,r){return this.a*=t,this.d*=r,this.c*=t,this.b*=r,this.tx*=t,this.ty*=r,this}rotate(t){const r=Math.cos(t),n=Math.sin(t),i=this.a,o=this.c,l=this.tx;return this.a=i*r-this.b*n,this.b=i*n+this.b*r,this.c=o*r-this.d*n,this.d=o*n+this.d*r,this.tx=l*r-this.ty*n,this.ty=l*n+this.ty*r,this}append(t){const r=this.a,n=this.b,i=this.c,o=this.d;return this.a=t.a*r+t.b*i,this.b=t.a*n+t.b*o,this.c=t.c*r+t.d*i,this.d=t.c*n+t.d*o,this.tx=t.tx*r+t.ty*i+this.tx,this.ty=t.tx*n+t.ty*o+this.ty,this}setTransform(t,r,n,i,o,l,h,u,f){return this.a=Math.cos(h+f)*o,this.b=Math.sin(h+f)*o,this.c=-Math.sin(h-u)*l,this.d=Math.cos(h-u)*l,this.tx=t-(n*this.a+i*this.c),this.ty=r-(n*this.b+i*this.d),this}prepend(t){const r=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const n=this.a,i=this.c;this.a=n*t.a+this.b*t.c,this.b=n*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d}return this.tx=r*t.a+this.ty*t.c+t.tx,this.ty=r*t.b+this.ty*t.d+t.ty,this}decompose(t){const r=this.a,n=this.b,i=this.c,o=this.d,l=t.pivot,h=-Math.atan2(-i,o),u=Math.atan2(n,r),f=Math.abs(h+u);return f<1e-5||Math.abs(Ca-f)<1e-5?(t.rotation=u,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=h,t.skew.y=u),t.scale.x=Math.sqrt(r*r+n*n),t.scale.y=Math.sqrt(i*i+o*o),t.position.x=this.tx+(l.x*r+l.y*i),t.position.y=this.ty+(l.x*n+l.y*o),t}invert(){const t=this.a,r=this.b,n=this.c,i=this.d,o=this.tx,l=t*i-r*n;return this.a=i/l,this.b=-r/l,this.c=-n/l,this.d=t/l,this.tx=(n*this.ty-i*o)/l,this.ty=-(t*this.ty-r*o)/l,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Ht;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new Ht}static get TEMP_MATRIX(){return new Ht}}const Ln=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Nn=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],kn=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Un=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Bu=[],Dm=[],$o=Math.sign;function dR(){for(let e=0;e<16;e++){const t=[];Bu.push(t);for(let r=0;r<16;r++){const n=$o(Ln[e]*Ln[r]+kn[e]*Nn[r]),i=$o(Nn[e]*Ln[r]+Un[e]*Nn[r]),o=$o(Ln[e]*kn[r]+kn[e]*Un[r]),l=$o(Nn[e]*kn[r]+Un[e]*Un[r]);for(let h=0;h<16;h++)if(Ln[h]===n&&Nn[h]===i&&kn[h]===o&&Un[h]===l){t.push(h);break}}}for(let e=0;e<16;e++){const t=new Ht;t.set(Ln[e],Nn[e],kn[e],Un[e],0,0),Dm.push(t)}}dR();const Xt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:e=>Ln[e],uY:e=>Nn[e],vX:e=>kn[e],vY:e=>Un[e],inv:e=>e&8?e&15:-e&7,add:(e,t)=>Bu[e][t],sub:(e,t)=>Bu[e][Xt.inv(t)],rotate180:e=>e^4,isVertical:e=>(e&3)===2,byDirection:(e,t)=>Math.abs(e)*2<=Math.abs(t)?t>=0?Xt.S:Xt.N:Math.abs(t)*2<=Math.abs(e)?e>0?Xt.E:Xt.W:t>0?e>0?Xt.SE:Xt.SW:e>0?Xt.NE:Xt.NW,matrixAppendRotationInv:(e,t,r=0,n=0)=>{const i=Dm[Xt.inv(t)];i.tx=r,i.ty=n,e.append(i)}};class dn{constructor(t,r,n=0,i=0){this._x=n,this._y=i,this.cb=t,this.scope=r}clone(t=this.cb,r=this.scope){return new dn(t,r,this._x,this._y)}set(t=0,r=t){return(this._x!==t||this._y!==r)&&(this._x=t,this._y=r,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const Bm=class{constructor(){this.worldTransform=new Ht,this.localTransform=new Ht,this.position=new dn(this.onChange,this,0,0),this.scale=new dn(this.onChange,this,1,1),this.pivot=new dn(this.onChange,this,0,0),this.skew=new dn(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(e){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){const r=e.worldTransform,n=this.worldTransform;n.a=t.a*r.a+t.b*r.c,n.b=t.a*r.b+t.b*r.d,n.c=t.c*r.a+t.d*r.c,n.d=t.c*r.b+t.d*r.d,n.tx=t.tx*r.a+t.ty*r.c+r.tx,n.ty=t.tx*r.b+t.ty*r.d+r.ty,this._parentID=e._worldID,this._worldID++}}setFromMatrix(e){e.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())}};let mc=Bm;mc.IDENTITY=new Bm;var pR=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,gR=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function tg(e,t,r){const n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),n}function Gh(e){const t=new Array(e);for(let r=0;r<t.length;r++)t[r]=!1;return t}function Om(e,t){switch(e){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Gh(2*t);case"bvec3":return Gh(3*t);case"bvec4":return Gh(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Fi=[{test:e=>e.type==="float"&&e.size===1&&!e.isArray,code:e=>`
            if(uv["${e}"] !== ud["${e}"].value)
            {
                ud["${e}"].value = uv["${e}"]
                gl.uniform1f(ud["${e}"].location, uv["${e}"])
            }
            `},{test:(e,t)=>(e.type==="sampler2D"||e.type==="samplerCube"||e.type==="sampler2DArray")&&e.size===1&&!e.isArray&&(t==null||t.castToBaseTexture!==void 0),code:e=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${e}"], t);

            if(ud["${e}"].value !== t)
            {
                ud["${e}"].value = t;
                gl.uniform1i(ud["${e}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(e,t)=>e.type==="mat3"&&e.size===1&&!e.isArray&&t.a!==void 0,code:e=>`
            gl.uniformMatrix3fv(ud["${e}"].location, false, uv["${e}"].toArray(true));
            `,codeUbo:e=>`
                var ${e}_matrix = uv.${e}.toArray(true);

                data[offset] = ${e}_matrix[0];
                data[offset+1] = ${e}_matrix[1];
                data[offset+2] = ${e}_matrix[2];
        
                data[offset + 4] = ${e}_matrix[3];
                data[offset + 5] = ${e}_matrix[4];
                data[offset + 6] = ${e}_matrix[5];
        
                data[offset + 8] = ${e}_matrix[6];
                data[offset + 9] = ${e}_matrix[7];
                data[offset + 10] = ${e}_matrix[8];
            `},{test:(e,t)=>e.type==="vec2"&&e.size===1&&!e.isArray&&t.x!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${e}"].location, v.x, v.y);
                }`,codeUbo:e=>`
                v = uv.${e};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:e=>e.type==="vec2"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${e}"].location, v[0], v[1]);
                }
            `},{test:(e,t)=>e.type==="vec4"&&e.size===1&&!e.isArray&&t.width!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${e}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:e=>e.type==="vec4"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${e}"].location, v[0], v[1], v[2], v[3])
                }`}],mR={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},vR={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function yR(e,t){var n;const r=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const i in e.uniforms){const o=t[i];if(!o){(n=e.uniforms[i])!=null&&n.group&&(e.uniforms[i].ubo?r.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${i}, '${i}');
                    `):r.push(`
                        renderer.shader.syncUniformGroup(uv.${i}, syncData);
                    `));continue}const l=e.uniforms[i];let h=!1;for(let u=0;u<Fi.length;u++)if(Fi[u].test(o,l)){r.push(Fi[u].code(i,l)),h=!0;break}if(!h){const f=(o.size===1&&!o.isArray?mR:vR)[o.type].replace("location",`ud["${i}"].location`);r.push(`
            cu = ud["${i}"];
            cv = cu.value;
            v = uv["${i}"];
            ${f};`)}}return new Function("ud","uv","renderer","syncData",r.join(`
`))}const Fm={};let yi=Fm;function _R(){if(yi===Fm||yi!=null&&yi.isContextLost()){const e=J.ADAPTER.createCanvas();let t;J.PREFER_ENV>=Qn.WEBGL2&&(t=e.getContext("webgl2",{})),t||(t=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),yi=t}return yi}let Ho;function xR(){if(!Ho){Ho=tr.MEDIUM;const e=_R();e&&e.getShaderPrecisionFormat&&(Ho=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision?tr.HIGH:tr.MEDIUM)}return Ho}function eg(e,t){const r=e.getShaderSource(t).split(`
`).map((f,d)=>`${d}: ${f}`),n=e.getShaderInfoLog(t),i=n.split(`
`),o={},l=i.map(f=>parseFloat(f.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(f=>f&&!o[f]?(o[f]=!0,!0):!1),h=[""];l.forEach(f=>{r[f-1]=`%c${r[f-1]}%c`,h.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const u=r.join(`
`);h[0]=u,console.error(n),console.groupCollapsed("click to view full shader code"),console.warn(...h),console.groupEnd()}function bR(e,t,r,n){e.getProgramParameter(t,e.LINK_STATUS)||(e.getShaderParameter(r,e.COMPILE_STATUS)||eg(e,r),e.getShaderParameter(n,e.COMPILE_STATUS)||eg(e,n),console.error("PixiJS Error: Could not initialize shader."),e.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(t)))}const wR={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Lm(e){return wR[e]}let zo=null;const rg={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Nm(e,t){if(!zo){const r=Object.keys(rg);zo={};for(let n=0;n<r.length;++n){const i=r[n];zo[e[i]]=rg[i]}}return zo[t]}function ng(e,t,r){if(e.substring(0,9)!=="precision"){let n=t;return t===tr.HIGH&&r!==tr.HIGH&&(n=tr.MEDIUM),`precision ${n} float;
${e}`}else if(r!==tr.HIGH&&e.substring(0,15)==="precision highp")return e.replace("precision highp","precision mediump");return e}let vs;function ER(){if(typeof vs=="boolean")return vs;try{vs=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{vs=!1}return vs}let TR=0;const Xo={},Ei=class{constructor(e,t,r="pixi-shader",n={}){this.extra={},this.id=TR++,this.vertexSrc=e||Ei.defaultVertexSrc,this.fragmentSrc=t||Ei.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),Xo[r]?(Xo[r]++,r+=`-${Xo[r]}`):Xo[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=ng(this.vertexSrc,Ei.defaultVertexPrecision,tr.HIGH),this.fragmentSrc=ng(this.fragmentSrc,Ei.defaultFragmentPrecision,xR())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return gR}static get defaultFragmentSrc(){return pR}static from(e,t,r){const n=e+t;let i=jp[n];return i||(jp[n]=i=new Ei(e,t,r)),i}};let pr=Ei;pr.defaultVertexPrecision=tr.HIGH;pr.defaultFragmentPrecision=jr.apple.device?tr.HIGH:tr.MEDIUM;let AR=0;class yr{constructor(t,r,n){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=AR++,this.static=!!r,this.ubo=!!n,t instanceof re?(this.buffer=t,this.buffer.type=Dr.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new re(new Float32Array(1)),this.buffer.type=Dr.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,r,n){if(!this.ubo)this.uniforms[t]=new yr(r,n);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,r,n){return new yr(t,r,n)}static uboFrom(t,r){return new yr(t,r??!0,!0)}}class Br{constructor(t,r){this.uniformBindCount=0,this.program=t,r?r instanceof yr?this.uniformGroup=r:this.uniformGroup=new yr(r):this.uniformGroup=new yr({}),this.disposeRunner=new vr("disposeShader")}checkUniformExists(t,r){if(r.uniforms[t])return!0;for(const n in r.uniforms){const i=r.uniforms[n];if(i.group&&this.checkUniformExists(t,i))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,r,n){const i=pr.from(t,r);return new Br(i,n)}}class SR{constructor(t,r){if(this.vertexSrc=t,this.fragTemplate=r,this.programCache={},this.defaultGroupCache={},!r.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!r.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const n=new Int32Array(t);for(let o=0;o<t;o++)n[o]=o;this.defaultGroupCache[t]=yr.from({uSamplers:n},!0);let i=this.fragTemplate;i=i.replace(/%count%/gi,`${t}`),i=i.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new pr(this.vertexSrc,i)}const r={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ht,default:this.defaultGroupCache[t]};return new Br(this.programCache[t],r)}generateSampleSrc(t){let r="";r+=`
`,r+=`
`;for(let n=0;n<t;n++)n>0&&(r+=`
else `),n<t-1&&(r+=`if(vTextureId < ${n}.5)`),r+=`
{`,r+=`
	color = texture2D(uSamplers[${n}], vTextureCoord);`,r+=`
}`;return r+=`
`,r+=`
`,r}}class Ou{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function CR(){return!jr.apple.device}function IR(e){let t=!0;const r=J.ADAPTER.getNavigator();if(jr.tablet||jr.phone){if(jr.apple.device){const n=r.userAgent.match(/OS (\d+)_(\d+)?/);n&&parseInt(n[1],10)<11&&(t=!1)}if(jr.android.device){const n=r.userAgent.match(/Android\s([0-9.]*)/);n&&parseInt(n[1],10)<7&&(t=!1)}}return t?e:4}class za{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var PR=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,RR=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const hr=class extends za{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=Mm,this.vertexSize=6,this.state=Zr.for2d(),this.size=hr.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??IR(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??CR(),this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return Ct("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return RR}static get defaultFragmentTemplate(){return PR}setShaderGenerator({vertex:e=hr.defaultVertexSrc,fragment:t=hr.defaultFragmentTemplate}={}){this.shaderGenerator=new SR(e,t)}contextChange(){const e=this.renderer.gl;J.PREFER_ENV===Qn.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),hr.defaultMaxTextures),this.maxTextures=iR(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:t}=hr,r=this.size/4,n=Math.floor(r/this.maxTextures)+1;for(;e.length<r;)e.push(new Du);for(;t.length<n;)t.push(new Ou);for(let i=0;i<this.maxTextures;i++)this._tempBoundTextures[i]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:t}=this,r=hr._textureArrayPool,n=this.renderer.batch,i=this._tempBoundTextures,o=this.renderer.textureGC.count;let l=++gt._globalBatch,h=0,u=r[0],f=0;n.copyBoundTextures(i,t);for(let d=0;d<this._bufferSize;++d){const g=e[d];e[d]=null,g._batchEnabled!==l&&(u.count>=t&&(n.boundArray(u,i,l,t),this.buildDrawCalls(u,f,d),f=d,u=r[++h],++l),g._batchEnabled=l,g.touched=o,u.elements[u.count++]=g)}u.count>0&&(n.boundArray(u,i,l,t),this.buildDrawCalls(u,f,this._bufferSize),++h,++l);for(let d=0;d<i.length;d++)i[d]=null;gt._globalBatch=l}buildDrawCalls(e,t,r){const{_bufferedElements:n,_attributeBuffer:i,_indexBuffer:o,vertexSize:l}=this,h=hr._drawCallPool;let u=this._dcIndex,f=this._aIndex,d=this._iIndex,g=h[u];g.start=this._iIndex,g.texArray=e;for(let m=t;m<r;++m){const v=n[m],_=v._texture.baseTexture,w=Am[_.alphaMode?1:0][v.blendMode];n[m]=null,t<m&&g.blend!==w&&(g.size=d-g.start,t=m,g=h[++u],g.texArray=e,g.start=d),this.packInterleavedGeometry(v,i,o,f,d),f+=v.vertexData.length/2*l,d+=v.indices.length,g.blend=w}t<r&&(g.size=d-g.start,++u),this._dcIndex=u,this._aIndex=f,this._iIndex=d}bindAndClearTexArray(e){const t=this.renderer.texture;for(let r=0;r<e.count;r++)t.bind(e.elements[r],e.ids[r]),e.elements[r]=null;e.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:t,_indexBuffer:r}=this;hr.canUploadSameBuffer?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:t,state:r}=this.renderer,n=hr._drawCallPool;let i=null;for(let o=0;o<e;o++){const{texArray:l,type:h,size:u,start:f,blend:d}=n[o];i!==l&&(i=l,this.bindAndClearTexArray(l)),this.state.blendMode=d,r.set(this.state),t.drawElements(h,u,t.UNSIGNED_SHORT,f*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),hr.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=Aa(Math.ceil(e/8)),r=Yp(t),n=t*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let i=this._aBuffers[n];return i||(this._aBuffers[n]=i=new Ru(n*this.vertexSize*4)),i}getIndexBuffer(e){const t=Aa(Math.ceil(e/12)),r=Yp(t),n=t*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let i=this._iBuffers[r];return i||(this._iBuffers[r]=i=new Uint16Array(n)),i}packInterleavedGeometry(e,t,r,n,i){const{uint32View:o,float32View:l}=t,h=n/this.vertexSize,u=e.uvs,f=e.indices,d=e.vertexData,g=e._texture.baseTexture._batchLocation,m=Math.min(e.worldAlpha,1),v=m<1&&e._texture.baseTexture.alphaMode?fc(e._tintRGB,m):e._tintRGB+(m*255<<24);for(let _=0;_<d.length;_+=2)l[n++]=d[_],l[n++]=d[_+1],l[n++]=u[_],l[n++]=u[_+1],o[n++]=v,l[n++]=g;for(let _=0;_<f.length;_++)r[i++]=h+f[_]}};let fr=hr;fr.defaultBatchSize=4096;fr.extension={name:"batch",type:Z.RendererPlugin};fr._drawCallPool=[];fr._textureArrayPool=[];st.add(fr);var MR=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,DR=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const bs=class extends Br{constructor(e,t,r){const n=pr.from(e||bs.defaultVertexSrc,t||bs.defaultFragmentSrc);super(n,r),this.padding=0,this.resolution=bs.defaultResolution,this.multisample=bs.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Zr}apply(e,t,r,n,i){e.applyFilter(this,t,r,n)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return DR}static get defaultFragmentSrc(){return MR}};let Se=bs;Se.defaultResolution=1;Se.defaultMultisample=se.NONE;class km{constructor(){this.clearBeforeRender=!0,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,1],this._backgroundColorString="#000000",this.color=this._backgroundColor,this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender,t.color&&(this.color=typeof t.color=="string"?cc(t.color):t.color),this.alpha=t.alpha}get color(){return this._backgroundColor}set color(t){this._backgroundColor=t,this._backgroundColorString=Tm(t),Bs(t,this._backgroundColorRgba)}get alpha(){return this._backgroundColorRgba[3]}set alpha(t){this._backgroundColorRgba[3]=t}get colorRgba(){return this._backgroundColorRgba}get colorString(){return this._backgroundColorString}destroy(){}}km.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"background"};st.add(km);class Um{constructor(t){this.renderer=t,this.emptyRenderer=new za(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,r){const{boundTextures:n}=this.renderer.texture;for(let i=r-1;i>=0;--i)t[i]=n[i]||null,t[i]&&(t[i]._batchLocation=i)}boundArray(t,r,n,i){const{elements:o,ids:l,count:h}=t;let u=0;for(let f=0;f<h;f++){const d=o[f],g=d._batchLocation;if(g>=0&&g<i&&r[g]===d){l[f]=g;continue}for(;u<i;){const m=r[u];if(m&&m._batchEnabled===n&&m._batchLocation===u){u++;continue}l[f]=u,d._batchLocation=u,r[u]=d;break}}}destroy(){this.renderer=null}}Um.extension={type:Z.RendererSystem,name:"batch"};st.add(Um);let ig=0;class Gm{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=ig++}init(t){if(t.context)this.initFromContext(t.context);else{const r=this.renderer.background.alpha<1,n=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:r,premultipliedAlpha:n,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=ig++,this.renderer.runners.contextChange.emit(t);const r=this.renderer.view;r.addEventListener!==void 0&&(r.addEventListener("webglcontextlost",this.handleContextLost,!1),r.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const r=this.createContext(this.renderer.view,t);this.initFromContext(r)}createContext(t,r){let n;if(J.PREFER_ENV>=Qn.WEBGL2&&(n=t.getContext("webgl2",r)),n)this.webGLVersion=2;else if(this.webGLVersion=1,n=t.getContext("webgl",r)||t.getContext("experimental-webgl",r),!n)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=n,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,r={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,r,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,r,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const r=t.getContextAttributes(),n="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;n&&(this.webGLVersion=2),r&&!r.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const i=n||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=i,i||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Gm.extension={type:Z.RendererSystem,name:"context"};st.add(Gm);class BR extends Ws{upload(t,r,n){const i=t.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===_r.UNPACK);const o=r.realWidth,l=r.realHeight;return n.width===o&&n.height===l?i.texSubImage2D(r.target,0,0,0,o,l,r.format,n.type,this.data):(n.width=o,n.height=l,i.texImage2D(r.target,0,n.internalFormat,o,l,0,r.format,n.type,this.data)),!0}}class Fu{constructor(t,r){this.width=Math.round(t||100),this.height=Math.round(r||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new vr("disposeFramebuffer"),this.multisample=se.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,r){return this.colorTextures[t]=r||new gt(null,{scaleMode:Yr.NEAREST,resolution:1,mipmap:Or.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new gt(new BR(null,{width:this.width,height:this.height}),{scaleMode:Yr.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Or.OFF,format:V.DEPTH_COMPONENT,type:ot.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,r){if(t=Math.round(t),r=Math.round(r),!(t===this.width&&r===this.height)){this.width=t,this.height=r,this.dirtyId++,this.dirtySize++;for(let n=0;n<this.colorTextures.length;n++){const i=this.colorTextures[n],o=i.resolution;i.setSize(t/o,r/o)}if(this.depthTexture){const n=this.depthTexture.resolution;this.depthTexture.setSize(t/n,r/n)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Wm extends gt{constructor(t={}){if(typeof t=="number"){const r=arguments[0],n=arguments[1],i=arguments[2],o=arguments[3];t={width:r,height:n,scaleMode:i,resolution:o}}t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=se.NONE),super(null,t),this.mipmap=Or.OFF,this.valid=!0,this.clearColor=[0,0,0,0],this.framebuffer=new Fu(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}resize(t,r){this.framebuffer.resize(t*this.resolution,r*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class yn extends Os{constructor(t){const r=t,n=r.naturalWidth||r.videoWidth||r.width,i=r.naturalHeight||r.videoHeight||r.height;super(n,i),this.source=t,this.noSubImage=!1}static crossOrigin(t,r,n){n===void 0&&!r.startsWith("data:")?t.crossOrigin=eR(r):n!==!1&&(t.crossOrigin=typeof n=="string"?n:"anonymous")}upload(t,r,n,i){const o=t.gl,l=r.realWidth,h=r.realHeight;if(i=i||this.source,typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement){if(!i.complete||i.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement&&i.readyState<=1&&i.buffered.length===0)return!1;return o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===_r.UNPACK),!this.noSubImage&&r.target===o.TEXTURE_2D&&n.width===l&&n.height===h?o.texSubImage2D(o.TEXTURE_2D,0,0,0,r.format,n.type,i):(n.width=l,n.height=h,o.texImage2D(r.target,0,n.internalFormat,r.format,n.type,i)),!0}update(){if(this.destroyed)return;const t=this.source,r=t.naturalWidth||t.videoWidth||t.width,n=t.naturalHeight||t.videoHeight||t.height;this.resize(r,n),super.update()}dispose(){this.source=null}}class $m extends yn{constructor(t,r){if(r=r||{},typeof t=="string"){const n=new Image;yn.crossOrigin(n,t,r.crossorigin),n.src=t,t=n}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(r.createBitmap??J.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof r.alphaMode=="number"?r.alphaMode:null,this.bitmap=null,this._load=null,r.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((r,n)=>{const i=this.source;this.url=i.src;const o=()=>{this.destroyed||(i.onload=null,i.onerror=null,this.resize(i.width,i.height),this._load=null,this.createBitmap?r(this.process()):r(this))};i.complete&&i.src?o():(i.onload=o,i.onerror=l=>{n(l),this.onError.emit(l)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const r=globalThis.createImageBitmap,n=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:n?"cors":"no-cors"}).then(i=>i.blob()).then(i=>r(i,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===_r.UNPACK?"premultiply":"none"})).then(i=>this.destroyed?Promise.reject():(this.bitmap=i,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,r,n){if(typeof this.alphaMode=="number"&&(r.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,r,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,r,n,this.bitmap),!this.preserveBitmap){let i=!0;const o=r._glTextures;for(const l in o){const h=o[l];if(h!==n&&h.dirtyId!==r.dirtyId){i=!1;break}}i&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class Hm{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,r,n){const i=r.width,o=r.height;if(n){const l=t.width/2/i,h=t.height/2/o,u=t.x/i+l,f=t.y/o+h;n=Xt.add(n,Xt.NW),this.x0=u+l*Xt.uX(n),this.y0=f+h*Xt.uY(n),n=Xt.add(n,2),this.x1=u+l*Xt.uX(n),this.y1=f+h*Xt.uY(n),n=Xt.add(n,2),this.x2=u+l*Xt.uX(n),this.y2=f+h*Xt.uY(n),n=Xt.add(n,2),this.x3=u+l*Xt.uX(n),this.y3=f+h*Xt.uY(n)}else this.x0=t.x/i,this.y0=t.y/o,this.x1=(t.x+t.width)/i,this.y1=t.y/o,this.x2=(t.x+t.width)/i,this.y2=(t.y+t.height)/o,this.x3=t.x/i,this.y3=(t.y+t.height)/o;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const sg=new Hm;function Vo(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}class it extends ks{constructor(t,r,n,i,o,l){if(super(),this.noFrame=!1,r||(this.noFrame=!0,r=new Tt(0,0,1,1)),t instanceof it&&(t=t.baseTexture),this.baseTexture=t,this._frame=r,this.trim=i,this.valid=!1,this._uvs=sg,this.uvMatrix=null,this.orig=n||r,this._rotate=Number(o||0),o===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=l?new St(l.x,l.y):new St(0,0),this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=r:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:r}=this.baseTexture;r!=null&&r.url&&Sr[r.url]&&it.removeFromCache(r.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,it.removeFromCache(this),this.textureCacheIds=null}clone(){var i;const t=this._frame.clone(),r=this._frame===this.orig?t:this.orig.clone(),n=new it(this.baseTexture,!this.noFrame&&t,r,(i=this.trim)==null?void 0:i.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(n._frame=t),n}updateUvs(){this._uvs===sg&&(this._uvs=new Hm),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,r={},n=J.STRICT_TEXTURE_CACHE){const i=typeof t=="string";let o=null;if(i)o=t;else if(t instanceof gt){if(!t.cacheId){const h=(r==null?void 0:r.pixiIdPrefix)||"pixiid";t.cacheId=`${h}-${qn()}`,gt.addToCache(t,t.cacheId)}o=t.cacheId}else{if(!t._pixiId){const h=(r==null?void 0:r.pixiIdPrefix)||"pixiid";t._pixiId=`${h}_${qn()}`}o=t._pixiId}let l=Sr[o];if(i&&n&&!l)throw new Error(`The cacheId "${o}" does not exist in TextureCache.`);return!l&&!(t instanceof gt)?(r.resolution||(r.resolution=mn(t)),l=new it(new gt(t,r)),l.baseTexture.cacheId=o,gt.addToCache(l.baseTexture,o),it.addToCache(l,o)):!l&&t instanceof gt&&(l=new it(t),it.addToCache(l,o)),l}static fromURL(t,r){const n=Object.assign({autoLoad:!1},r==null?void 0:r.resourceOptions),i=it.from(t,Object.assign({resourceOptions:n},r),!1),o=i.baseTexture.resource;return i.baseTexture.valid?Promise.resolve(i):o.load().then(()=>Promise.resolve(i))}static fromBuffer(t,r,n,i){return new it(gt.fromBuffer(t,r,n,i))}static fromLoader(t,r,n,i){const o=new gt(t,Object.assign({scaleMode:J.SCALE_MODE,resolution:mn(r)},i)),{resource:l}=o;l instanceof $m&&(l.url=r);const h=new it(o);return n||(n=r),gt.addToCache(h.baseTexture,n),it.addToCache(h,n),n!==r&&(gt.addToCache(h.baseTexture,r),it.addToCache(h,r)),h.baseTexture.valid?Promise.resolve(h):new Promise(u=>{h.baseTexture.once("loaded",()=>u(h))})}static addToCache(t,r){r&&(t.textureCacheIds.includes(r)||t.textureCacheIds.push(r),Sr[r]&&Sr[r]!==t&&console.warn(`Texture added to the cache with an id [${r}] that already had an entry`),Sr[r]=t)}static removeFromCache(t){if(typeof t=="string"){const r=Sr[t];if(r){const n=r.textureCacheIds.indexOf(t);return n>-1&&r.textureCacheIds.splice(n,1),delete Sr[t],r}}else if(t!=null&&t.textureCacheIds){for(let r=0;r<t.textureCacheIds.length;++r)Sr[t.textureCacheIds[r]]===t&&delete Sr[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:r,y:n,width:i,height:o}=t,l=r+i>this.baseTexture.width,h=n+o>this.baseTexture.height;if(l||h){const u=l&&h?"and":"or",f=`X: ${r} + ${i} = ${r+i} > ${this.baseTexture.width}`,d=`Y: ${n} + ${o} = ${n+o} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${f} ${u} ${d}`)}this.valid=i&&o&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return it._EMPTY||(it._EMPTY=new it(new gt),Vo(it._EMPTY),Vo(it._EMPTY.baseTexture)),it._EMPTY}static get WHITE(){if(!it._WHITE){const t=J.ADAPTER.createCanvas(16,16),r=t.getContext("2d");t.width=16,t.height=16,r.fillStyle="white",r.fillRect(0,0,16,16),it._WHITE=new it(gt.from(t)),Vo(it._WHITE),Vo(it._WHITE.baseTexture)}return it._WHITE}}class _n extends it{constructor(t,r){super(t,r),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,r,n=!0){const i=this.baseTexture.resolution,o=Math.round(t*i)/i,l=Math.round(r*i)/i;this.valid=o>0&&l>0,this._frame.width=this.orig.width=o,this._frame.height=this.orig.height=l,n&&this.baseTexture.resize(o,l),this.updateUvs()}setResolution(t){const{baseTexture:r}=this;r.resolution!==t&&(r.setResolution(t),this.resize(r.width,r.height,!1))}static create(t){return new _n(new Wm(t))}}class zm{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,r,n=se.NONE){const i=new Wm(Object.assign({width:t,height:r,resolution:1,multisample:n},this.textureOptions));return new _n(i)}getOptimalTexture(t,r,n=1,i=se.NONE){let o;t=Math.ceil(t*n-1e-6),r=Math.ceil(r*n-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||r!==this._pixelsHeight?(t=Aa(t),r=Aa(r),o=((t&65535)<<16|r&65535)>>>0,i>1&&(o+=i*4294967296)):o=i>1?-i:-1,this.texturePool[o]||(this.texturePool[o]=[]);let l=this.texturePool[o].pop();return l||(l=this.createTexture(t,r,i)),l.filterPoolKey=o,l.setResolution(n),l}getFilterTexture(t,r,n){const i=this.getOptimalTexture(t.width,t.height,r||t.resolution,n||se.NONE);return i.filterFrame=t.filterFrame,i}returnTexture(t){const r=t.filterPoolKey;t.filterFrame=null,this.texturePool[r].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const r in this.texturePool){const n=this.texturePool[r];if(n)for(let i=0;i<n.length;i++)n[i].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const r in this.texturePool){if(!(Number(r)<0))continue;const n=this.texturePool[r];if(n)for(let i=0;i<n.length;i++)n[i].destroy(!0);this.texturePool[r]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}zm.SCREEN_KEY=-1;class OR extends vn{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Xm extends vn{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new re(this.vertices),this.uvBuffer=new re(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,r){let n=0,i=0;return this.uvs[0]=n,this.uvs[1]=i,this.uvs[2]=n+r.width/t.width,this.uvs[3]=i,this.uvs[4]=n+r.width/t.width,this.uvs[5]=i+r.height/t.height,this.uvs[6]=n,this.uvs[7]=i+r.height/t.height,n=r.x,i=r.y,this.vertices[0]=n,this.vertices[1]=i,this.vertices[2]=n+r.width,this.vertices[3]=i,this.vertices[4]=n+r.width,this.vertices[5]=i+r.height,this.vertices[6]=n,this.vertices[7]=i+r.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class FR{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=se.NONE,this.sourceFrame=new Tt,this.destinationFrame=new Tt,this.bindingSourceFrame=new Tt,this.bindingDestinationFrame=new Tt,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Yo=[new St,new St,new St,new St],Wh=new Ht;class Vm{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new zm,this.statePool=[],this.quad=new OR,this.quadUv=new Xm,this.tempRect=new Tt,this.activeState={},this.globalUniforms=new yr({outputFrame:new Tt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,r){const n=this.renderer,i=this.defaultFilterStack,o=this.statePool.pop()||new FR,l=this.renderer.renderTexture;let h=r[0].resolution,u=r[0].multisample,f=r[0].padding,d=r[0].autoFit,g=r[0].legacy??!0;for(let _=1;_<r.length;_++){const w=r[_];h=Math.min(h,w.resolution),u=Math.min(u,w.multisample),f=this.useMaxPadding?Math.max(f,w.padding):f+w.padding,d=d&&w.autoFit,g=g||(w.legacy??!0)}i.length===1&&(this.defaultFilterStack[0].renderTexture=l.current),i.push(o),o.resolution=h,o.multisample=u,o.legacy=g,o.target=t,o.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),o.sourceFrame.pad(f);const m=this.tempRect.copyFrom(l.sourceFrame);n.projection.transform&&this.transformAABB(Wh.copyFrom(n.projection.transform).invert(),m),d?(o.sourceFrame.fit(m),(o.sourceFrame.width<=0||o.sourceFrame.height<=0)&&(o.sourceFrame.width=0,o.sourceFrame.height=0)):o.sourceFrame.intersects(m)||(o.sourceFrame.width=0,o.sourceFrame.height=0),this.roundFrame(o.sourceFrame,l.current?l.current.resolution:n.resolution,l.sourceFrame,l.destinationFrame,n.projection.transform),o.renderTexture=this.getOptimalFilterTexture(o.sourceFrame.width,o.sourceFrame.height,h,u),o.filters=r,o.destinationFrame.width=o.renderTexture.width,o.destinationFrame.height=o.renderTexture.height;const v=this.tempRect;v.x=0,v.y=0,v.width=o.sourceFrame.width,v.height=o.sourceFrame.height,o.renderTexture.filterFrame=o.sourceFrame,o.bindingSourceFrame.copyFrom(l.sourceFrame),o.bindingDestinationFrame.copyFrom(l.destinationFrame),o.transform=n.projection.transform,n.projection.transform=null,l.bind(o.renderTexture,o.sourceFrame,v),n.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,r=t.pop(),n=r.filters;this.activeState=r;const i=this.globalUniforms.uniforms;i.outputFrame=r.sourceFrame,i.resolution=r.resolution;const o=i.inputSize,l=i.inputPixel,h=i.inputClamp;if(o[0]=r.destinationFrame.width,o[1]=r.destinationFrame.height,o[2]=1/o[0],o[3]=1/o[1],l[0]=Math.round(o[0]*r.resolution),l[1]=Math.round(o[1]*r.resolution),l[2]=1/l[0],l[3]=1/l[1],h[0]=.5*l[2],h[1]=.5*l[3],h[2]=r.sourceFrame.width*o[2]-.5*l[2],h[3]=r.sourceFrame.height*o[3]-.5*l[3],r.legacy){const f=i.filterArea;f[0]=r.destinationFrame.width,f[1]=r.destinationFrame.height,f[2]=r.sourceFrame.x,f[3]=r.sourceFrame.y,i.filterClamp=i.inputClamp}this.globalUniforms.update();const u=t[t.length-1];if(this.renderer.framebuffer.blit(),n.length===1)n[0].apply(this,r.renderTexture,u.renderTexture,Ir.BLEND,r),this.returnFilterTexture(r.renderTexture);else{let f=r.renderTexture,d=this.getOptimalFilterTexture(f.width,f.height,r.resolution);d.filterFrame=f.filterFrame;let g=0;for(g=0;g<n.length-1;++g){g===1&&r.multisample>1&&(d=this.getOptimalFilterTexture(f.width,f.height,r.resolution),d.filterFrame=f.filterFrame),n[g].apply(this,f,d,Ir.CLEAR,r);const m=f;f=d,d=m}n[g].apply(this,f,u.renderTexture,Ir.BLEND,r),g>1&&r.multisample>1&&this.returnFilterTexture(r.renderTexture),this.returnFilterTexture(f),this.returnFilterTexture(d)}r.clear(),this.statePool.push(r)}bindAndClear(t,r=Ir.CLEAR){const{renderTexture:n,state:i}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t!=null&&t.filterFrame){const l=this.tempRect;l.x=0,l.y=0,l.width=t.filterFrame.width,l.height=t.filterFrame.height,n.bind(t,t.filterFrame,l)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const o=i.stateId&1||this.forceClear;(r===Ir.CLEAR||r===Ir.BLIT&&o)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,r,n,i){const o=this.renderer;o.state.set(t.state),this.bindAndClear(n,i),t.uniforms.uSampler=r,t.uniforms.filterGlobals=this.globalUniforms,o.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(r._frame,r.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(Mr.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(Mr.TRIANGLE_STRIP))}calculateSpriteMatrix(t,r){const{sourceFrame:n,destinationFrame:i}=this.activeState,{orig:o}=r._texture,l=t.set(i.width,0,0,i.height,n.x,n.y),h=r.worldTransform.copyTo(Ht.TEMP_MATRIX);return h.invert(),l.prepend(h),l.scale(1/o.width,1/o.height),l.translate(r.anchor.x,r.anchor.y),l}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,r,n=1,i=se.NONE){return this.texturePool.getOptimalTexture(t,r,n,i)}getFilterTexture(t,r,n){if(typeof t=="number"){const o=t;t=r,r=o}t=t||this.activeState.renderTexture;const i=this.texturePool.getOptimalTexture(t.width,t.height,r||t.resolution,n||se.NONE);return i.filterFrame=t.filterFrame,i}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,r){const n=Yo[0],i=Yo[1],o=Yo[2],l=Yo[3];n.set(r.left,r.top),i.set(r.left,r.bottom),o.set(r.right,r.top),l.set(r.right,r.bottom),t.apply(n,n),t.apply(i,i),t.apply(o,o),t.apply(l,l);const h=Math.min(n.x,i.x,o.x,l.x),u=Math.min(n.y,i.y,o.y,l.y),f=Math.max(n.x,i.x,o.x,l.x),d=Math.max(n.y,i.y,o.y,l.y);r.x=h,r.y=u,r.width=f-h,r.height=d-u}roundFrame(t,r,n,i,o){if(!(t.width<=0||t.height<=0||n.width<=0||n.height<=0)){if(o){const{a:l,b:h,c:u,d:f}=o;if((Math.abs(h)>1e-4||Math.abs(u)>1e-4)&&(Math.abs(l)>1e-4||Math.abs(f)>1e-4))return}o=o?Wh.copyFrom(o):Wh.identity(),o.translate(-n.x,-n.y).scale(i.width/n.width,i.height/n.height).translate(i.x,i.y),this.transformAABB(o,t),t.ceil(r),this.transformAABB(o.invert(),t)}}}Vm.extension={type:Z.RendererSystem,name:"filter"};st.add(Vm);class LR{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=se.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const NR=new Tt;class Ym{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Fu(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Tt,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let r=this.renderer.context.extensions.drawBuffers,n=this.renderer.context.extensions.depthTexture;J.PREFER_ENV===Qn.WEBGL_LEGACY&&(r=null,n=null),r?t.drawBuffers=i=>r.drawBuffersWEBGL(i):(this.hasMRT=!1,t.drawBuffers=()=>{}),n||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,r,n=0){const{gl:i}=this;if(t){const o=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,i.bindFramebuffer(i.FRAMEBUFFER,o.framebuffer)),o.mipLevel!==n&&(t.dirtyId++,t.dirtyFormat++,o.mipLevel=n),o.dirtyId!==t.dirtyId&&(o.dirtyId=t.dirtyId,o.dirtyFormat!==t.dirtyFormat?(o.dirtyFormat=t.dirtyFormat,o.dirtySize=t.dirtySize,this.updateFramebuffer(t,n)):o.dirtySize!==t.dirtySize&&(o.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let l=0;l<t.colorTextures.length;l++){const h=t.colorTextures[l];this.renderer.texture.unbind(h.parentTextureArray||h)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),r){const l=r.width>>n,h=r.height>>n,u=l/r.width;this.setViewport(r.x*u,r.y*u,l,h)}else{const l=t.width>>n,h=t.height>>n;this.setViewport(0,0,l,h)}}else this.current&&(this.current=null,i.bindFramebuffer(i.FRAMEBUFFER,null)),r?this.setViewport(r.x,r.y,r.width,r.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,r,n,i){const o=this.viewport;t=Math.round(t),r=Math.round(r),n=Math.round(n),i=Math.round(i),(o.width!==n||o.height!==i||o.x!==t||o.y!==r)&&(o.x=t,o.y=r,o.width=n,o.height=i,this.gl.viewport(t,r,n,i))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,r,n,i,o=du.COLOR|du.DEPTH){const{gl:l}=this;l.clearColor(t,r,n,i),l.clear(o)}initFramebuffer(t){const{gl:r}=this,n=new LR(r.createFramebuffer());return n.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=n,this.managedFramebuffers.push(t),t.disposeRunner.add(this),n}resizeFramebuffer(t){const{gl:r}=this,n=t.glFramebuffers[this.CONTEXT_UID];n.stencil&&(r.bindRenderbuffer(r.RENDERBUFFER,n.stencil),n.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,r.DEPTH24_STENCIL8,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t.width,t.height));const i=t.colorTextures;let o=i.length;r.drawBuffers||(o=Math.min(o,1));for(let l=0;l<o;l++){const h=i[l],u=h.parentTextureArray||h;this.renderer.texture.bind(u,0),l===0&&n.msaaBuffer&&(r.bindRenderbuffer(r.RENDERBUFFER,n.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,r){const{gl:n}=this,i=t.glFramebuffers[this.CONTEXT_UID],o=t.colorTextures;let l=o.length;n.drawBuffers||(l=Math.min(l,1)),i.multisample>1&&this.canMultisampleFramebuffer(t)?i.msaaBuffer=i.msaaBuffer||n.createRenderbuffer():i.msaaBuffer&&(n.deleteRenderbuffer(i.msaaBuffer),i.msaaBuffer=null,i.blitFramebuffer&&(i.blitFramebuffer.dispose(),i.blitFramebuffer=null));const h=[];for(let u=0;u<l;u++){const f=o[u],d=f.parentTextureArray||f;this.renderer.texture.bind(d,0),u===0&&i.msaaBuffer?(n.bindRenderbuffer(n.RENDERBUFFER,i.msaaBuffer),n.renderbufferStorageMultisample(n.RENDERBUFFER,i.multisample,d._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,i.msaaBuffer)):(n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+u,f.target,d._glTextures[this.CONTEXT_UID].texture,r),h.push(n.COLOR_ATTACHMENT0+u))}if(h.length>1&&n.drawBuffers(h),t.depthTexture&&this.writeDepthTexture){const f=t.depthTexture;this.renderer.texture.bind(f,0),n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,f._glTextures[this.CONTEXT_UID].texture,r)}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(i.stencil=i.stencil||n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,i.stencil),i.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,i.multisample,n.DEPTH24_STENCIL8,t.width,t.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,i.stencil)):i.stencil&&(n.deleteRenderbuffer(i.stencil),i.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:r}=this;let n=se.NONE;if(t<=1||r===null)return n;for(let i=0;i<r.length;i++)if(r[i]<=t){n=r[i];break}return n===1&&(n=se.NONE),n}blit(t,r,n){const{current:i,renderer:o,gl:l,CONTEXT_UID:h}=this;if(o.context.webGLVersion!==2||!i)return;const u=i.glFramebuffers[h];if(!u)return;if(!t){if(!u.msaaBuffer)return;const d=i.colorTextures[0];if(!d)return;u.blitFramebuffer||(u.blitFramebuffer=new Fu(i.width,i.height),u.blitFramebuffer.addColorTexture(0,d)),t=u.blitFramebuffer,t.colorTextures[0]!==d&&(t.colorTextures[0]=d,t.dirtyId++,t.dirtyFormat++),(t.width!==i.width||t.height!==i.height)&&(t.width=i.width,t.height=i.height,t.dirtyId++,t.dirtySize++)}r||(r=NR,r.width=i.width,r.height=i.height),n||(n=r);const f=r.width===n.width&&r.height===n.height;this.bind(t),l.bindFramebuffer(l.READ_FRAMEBUFFER,u.framebuffer),l.blitFramebuffer(r.left,r.top,r.right,r.bottom,n.left,n.top,n.right,n.bottom,l.COLOR_BUFFER_BIT,f?l.NEAREST:l.LINEAR)}disposeFramebuffer(t,r){const n=t.glFramebuffers[this.CONTEXT_UID],i=this.gl;if(!n)return;delete t.glFramebuffers[this.CONTEXT_UID];const o=this.managedFramebuffers.indexOf(t);o>=0&&this.managedFramebuffers.splice(o,1),t.disposeRunner.remove(this),r||(i.deleteFramebuffer(n.framebuffer),n.msaaBuffer&&i.deleteRenderbuffer(n.msaaBuffer),n.stencil&&i.deleteRenderbuffer(n.stencil)),n.blitFramebuffer&&n.blitFramebuffer.dispose()}disposeAll(t){const r=this.managedFramebuffers;this.managedFramebuffers=[];for(let n=0;n<r.length;n++)this.disposeFramebuffer(r[n],t)}forceStencil(){const t=this.current;if(!t)return;const r=t.glFramebuffers[this.CONTEXT_UID];if(!r||r.stencil)return;t.stencil=!0;const n=t.width,i=t.height,o=this.gl,l=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,l),r.msaaBuffer?o.renderbufferStorageMultisample(o.RENDERBUFFER,r.multisample,o.DEPTH24_STENCIL8,n,i):o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,n,i),r.stencil=l,o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,l)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Tt}destroy(){this.renderer=null}}Ym.extension={type:Z.RendererSystem,name:"framebuffer"};st.add(Ym);const $h={5126:4,5123:2,5121:1};class jm{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,r=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,r.webGLVersion!==2){let n=this.renderer.context.extensions.vertexArrayObject;J.PREFER_ENV===Qn.WEBGL_LEGACY&&(n=null),n?(t.createVertexArray=()=>n.createVertexArrayOES(),t.bindVertexArray=i=>n.bindVertexArrayOES(i),t.deleteVertexArray=i=>n.deleteVertexArrayOES(i)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(r.webGLVersion!==2){const n=t.getExtension("ANGLE_instanced_arrays");n?(t.vertexAttribDivisor=(i,o)=>n.vertexAttribDivisorANGLE(i,o),t.drawElementsInstanced=(i,o,l,h,u)=>n.drawElementsInstancedANGLE(i,o,l,h,u),t.drawArraysInstanced=(i,o,l,h)=>n.drawArraysInstancedANGLE(i,o,l,h)):this.hasInstance=!1}this.canUseUInt32ElementIndex=r.webGLVersion===2||!!r.extensions.uint32ElementIndex}bind(t,r){r=r||this.renderer.shader.shader;const{gl:n}=this;let i=t.glVertexArrayObjects[this.CONTEXT_UID],o=!1;i||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=i={},o=!0);const l=i[r.program.id]||this.initGeometryVao(t,r,o);this._activeGeometry=t,this._activeVao!==l&&(this._activeVao=l,this.hasVao?n.bindVertexArray(l):this.activateVao(t,r.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,r=this.renderer.buffer;for(let n=0;n<t.buffers.length;n++){const i=t.buffers[n];r.update(i)}}checkCompatibility(t,r){const n=t.attributes,i=r.attributeData;for(const o in i)if(!n[o])throw new Error(`shader and geometry incompatible, geometry missing the "${o}" attribute`)}getSignature(t,r){const n=t.attributes,i=r.attributeData,o=["g",t.id];for(const l in n)i[l]&&o.push(l,i[l].location);return o.join("-")}initGeometryVao(t,r,n=!0){const i=this.gl,o=this.CONTEXT_UID,l=this.renderer.buffer,h=r.program;h.glPrograms[o]||this.renderer.shader.generateProgram(r),this.checkCompatibility(t,h);const u=this.getSignature(t,h),f=t.glVertexArrayObjects[this.CONTEXT_UID];let d=f[u];if(d)return f[h.id]=d,d;const g=t.buffers,m=t.attributes,v={},_={};for(const w in g)v[w]=0,_[w]=0;for(const w in m)!m[w].size&&h.attributeData[w]?m[w].size=h.attributeData[w].size:m[w].size||console.warn(`PIXI Geometry attribute '${w}' size cannot be determined (likely the bound shader does not have the attribute)`),v[m[w].buffer]+=m[w].size*$h[m[w].type];for(const w in m){const x=m[w],A=x.size;x.stride===void 0&&(v[x.buffer]===A*$h[x.type]?x.stride=0:x.stride=v[x.buffer]),x.start===void 0&&(x.start=_[x.buffer],_[x.buffer]+=A*$h[x.type])}d=i.createVertexArray(),i.bindVertexArray(d);for(let w=0;w<g.length;w++){const x=g[w];l.bind(x),n&&x._glBuffers[o].refCount++}return this.activateVao(t,h),f[h.id]=d,f[u]=d,i.bindVertexArray(null),l.unbind(Dr.ARRAY_BUFFER),d}disposeGeometry(t,r){var h;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const n=t.glVertexArrayObjects[this.CONTEXT_UID],i=this.gl,o=t.buffers,l=(h=this.renderer)==null?void 0:h.buffer;if(t.disposeRunner.remove(this),!!n){if(l)for(let u=0;u<o.length;u++){const f=o[u]._glBuffers[this.CONTEXT_UID];f&&(f.refCount--,f.refCount===0&&!r&&l.dispose(o[u],r))}if(!r){for(const u in n)if(u[0]==="g"){const f=n[u];this._activeVao===f&&this.unbind(),i.deleteVertexArray(f)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const r=Object.keys(this.managedGeometries);for(let n=0;n<r.length;n++)this.disposeGeometry(this.managedGeometries[r[n]],t)}activateVao(t,r){const n=this.gl,i=this.CONTEXT_UID,o=this.renderer.buffer,l=t.buffers,h=t.attributes;t.indexBuffer&&o.bind(t.indexBuffer);let u=null;for(const f in h){const d=h[f],g=l[d.buffer],m=g._glBuffers[i];if(r.attributeData[f]){u!==m&&(o.bind(g),u=m);const v=r.attributeData[f].location;if(n.enableVertexAttribArray(v),n.vertexAttribPointer(v,d.size,d.type||n.FLOAT,d.normalized,d.stride,d.start),d.instance)if(this.hasInstance)n.vertexAttribDivisor(v,d.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,r,n,i){const{gl:o}=this,l=this._activeGeometry;if(l.indexBuffer){const h=l.indexBuffer.data.BYTES_PER_ELEMENT,u=h===2?o.UNSIGNED_SHORT:o.UNSIGNED_INT;h===2||h===4&&this.canUseUInt32ElementIndex?l.instanced?o.drawElementsInstanced(t,r||l.indexBuffer.data.length,u,(n||0)*h,i||1):o.drawElements(t,r||l.indexBuffer.data.length,u,(n||0)*h):console.warn("unsupported index buffer type: uint32")}else l.instanced?o.drawArraysInstanced(t,n,r||l.getSize(),i||1):o.drawArrays(t,n,r||l.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}jm.extension={type:Z.RendererSystem,name:"geometry"};st.add(jm);const og=new Ht;class qm{constructor(t,r){this._texture=t,this.mapCoord=new Ht,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof r>"u"?.5:r,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,r){r===void 0&&(r=t);const n=this.mapCoord;for(let i=0;i<t.length;i+=2){const o=t[i],l=t[i+1];r[i]=o*n.a+l*n.c+n.tx,r[i+1]=o*n.b+l*n.d+n.ty}return r}update(t){const r=this._texture;if(!r||!r.valid||!t&&this._textureID===r._updateID)return!1;this._textureID=r._updateID,this._updateID++;const n=r._uvs;this.mapCoord.set(n.x1-n.x0,n.y1-n.y0,n.x3-n.x0,n.y3-n.y0,n.x0,n.y0);const i=r.orig,o=r.trim;o&&(og.set(i.width/o.width,0,0,i.height/o.height,-o.x/o.width,-o.y/o.height),this.mapCoord.append(og));const l=r.baseTexture,h=this.uClampFrame,u=this.clampMargin/l.resolution,f=this.clampOffset;return h[0]=(r._frame.x+u+f)/l.width,h[1]=(r._frame.y+u+f)/l.height,h[2]=(r._frame.x+r._frame.width-u+f)/l.width,h[3]=(r._frame.y+r._frame.height-u+f)/l.height,this.uClampOffset[0]=f/l.realWidth,this.uClampOffset[1]=f/l.realHeight,this.isSimple=r._frame.width===l.width&&r._frame.height===l.height&&r.rotate===0,!0}}var kR=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,UR=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class GR extends Se{constructor(t,r,n){let i=null;typeof t!="string"&&r===void 0&&n===void 0&&(i=t,t=void 0,r=void 0,n=void 0),super(t||UR,r||kR,n),this.maskSprite=i,this.maskMatrix=new Ht}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,r,n,i){const o=this._maskSprite,l=o._texture;l.valid&&(l.uvMatrix||(l.uvMatrix=new qm(l,0)),l.uvMatrix.update(),this.uniforms.npmAlpha=l.baseTexture.alphaMode?0:1,this.uniforms.mask=l,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,o).prepend(l.uvMatrix.mapCoord),this.uniforms.alpha=o.worldAlpha,this.uniforms.maskClamp=l.uvMatrix.uClampFrame,t.applyFilter(this,r,n,i))}}class WR{constructor(t=null){this.type=ue.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=J.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=ue.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Km{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,r){let n=r;if(!n.isMaskData){const o=this.maskDataPool.pop()||new WR;o.pooled=!0,o.maskObject=r,n=o}const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(n.copyCountersOrReset(i),n._colorMask=i?i._colorMask:15,n.autoDetect&&this.detect(n),n._target=t,n.type!==ue.SPRITE&&this.maskStack.push(n),n.enabled)switch(n.type){case ue.SCISSOR:this.renderer.scissor.push(n);break;case ue.STENCIL:this.renderer.stencil.push(n);break;case ue.SPRITE:n.copyCountersOrReset(null),this.pushSpriteMask(n);break;case ue.COLOR:this.pushColorMask(n);break}n.type===ue.SPRITE&&this.maskStack.push(n)}pop(t){const r=this.maskStack.pop();if(!(!r||r._target!==t)){if(r.enabled)switch(r.type){case ue.SCISSOR:this.renderer.scissor.pop(r);break;case ue.STENCIL:this.renderer.stencil.pop(r.maskObject);break;case ue.SPRITE:this.popSpriteMask(r);break;case ue.COLOR:this.popColorMask(r);break}if(r.reset(),r.pooled&&this.maskDataPool.push(r),this.maskStack.length!==0){const n=this.maskStack[this.maskStack.length-1];n.type===ue.SPRITE&&n._filters&&(n._filters[0].maskSprite=n.maskObject)}}}detect(t){const r=t.maskObject;r?r.isSprite?t.type=ue.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=ue.SCISSOR:t.type=ue.STENCIL:t.type=ue.COLOR}pushSpriteMask(t){const{maskObject:r}=t,n=t._target;let i=t._filters;i||(i=this.alphaMaskPool[this.alphaMaskIndex],i||(i=this.alphaMaskPool[this.alphaMaskIndex]=[new GR]));const o=this.renderer,l=o.renderTexture;let h,u;if(l.current){const d=l.current;h=t.resolution||d.resolution,u=t.multisample??d.multisample}else h=t.resolution||o.resolution,u=t.multisample??o.multisample;i[0].resolution=h,i[0].multisample=u,i[0].maskSprite=r;const f=n.filterArea;n.filterArea=r.getBounds(!0),o.filter.push(n,i),n.filterArea=f,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const r=t._colorMask,n=t._colorMask=r&t.colorMask;n!==r&&this.renderer.gl.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)}popColorMask(t){const r=t._colorMask,n=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;n!==r&&this.renderer.gl.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)}destroy(){this.renderer=null}}Km.extension={type:Z.RendererSystem,name:"mask"};st.add(Km);class Zm{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:r}=this.renderer,n=this.getStackLength();this.maskStack=t;const i=this.getStackLength();i!==n&&(i===0?r.disable(this.glConst):(r.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const ag=new Ht,lg=[],ca=class extends Zm{constructor(e){super(e),this.glConst=J.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:r}=e,{renderer:n}=this,i=n.renderTexture,o=r.getBounds(!0,lg.pop()??new Tt);this.roundFrameToPixels(o,i.current?i.current.resolution:n.resolution,i.sourceFrame,i.destinationFrame,n.projection.transform),t&&o.fit(t),e._scissorRectLocal=o}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:r,c:n,d:i}=e;return(Math.abs(r)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(i)>1e-4)}testScissor(e){const{maskObject:t}=e;if(!t.isFastRect||!t.isFastRect()||ca.isMatrixRotated(t.worldTransform)||ca.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const r=e._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(e,t,r,n,i){ca.isMatrixRotated(i)||(i=i?ag.copyFrom(i):ag.identity(),i.translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.renderer.filter.transformAABB(i,e),e.fit(n),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&lg.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=e.y:t=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};let Jm=ca;Jm.extension={type:Z.RendererSystem,name:"scissor"};st.add(Jm);class Qm extends Zm{constructor(t){super(t),this.glConst=J.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const r=t.maskObject,{gl:n}=this.renderer,i=t._stencilCounter;i===0&&(this.renderer.framebuffer.forceStencil(),n.clearStencil(0),n.clear(n.STENCIL_BUFFER_BIT),n.enable(n.STENCIL_TEST)),t._stencilCounter++;const o=t._colorMask;o!==0&&(t._colorMask=0,n.colorMask(!1,!1,!1,!1)),n.stencilFunc(n.EQUAL,i,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.INCR),r.renderable=!0,r.render(this.renderer),this.renderer.batch.flush(),r.renderable=!1,o!==0&&(t._colorMask=o,n.colorMask((o&1)!==0,(o&2)!==0,(o&4)!==0,(o&8)!==0)),this._useCurrent()}pop(t){const r=this.renderer.gl;if(this.getStackLength()===0)r.disable(r.STENCIL_TEST);else{const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,i=n?n._colorMask:15;i!==0&&(n._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilOp(r.KEEP,r.KEEP,r.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,i!==0&&(n._colorMask=i,r.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Qm.extension={type:Z.RendererSystem,name:"stencil"};st.add(Qm);class tv{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return Ct("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return Ct("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return Ct("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(t){for(const r in t)this.plugins[r]=new t[r](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}tv.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"_plugin"};st.add(tv);class ev{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Ht,this.transform=null}update(t,r,n,i){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=r||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,n,i),this.transform&&this.projectionMatrix.append(this.transform);const o=this.renderer;o.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,o.globalUniforms.update(),o.shader.shader&&o.shader.syncUniformGroup(o.shader.shader.uniforms.globals)}calculateProjection(t,r,n,i){const o=this.projectionMatrix,l=i?-1:1;o.identity(),o.a=1/r.width*2,o.d=l*(1/r.height*2),o.tx=-1-r.x*o.a,o.ty=-l-r.y*o.d}setTransform(t){}destroy(){this.renderer=null}}ev.extension={type:Z.RendererSystem,name:"projection"};st.add(ev);const $R=new mc;class rv{constructor(t){this.renderer=t,this._tempMatrix=new Ht}generateTexture(t,r){const{region:n,...i}=r||{},o=n||t.getLocalBounds(null,!0);o.width===0&&(o.width=1),o.height===0&&(o.height=1);const l=_n.create({width:o.width,height:o.height,...i});this._tempMatrix.tx=-o.x,this._tempMatrix.ty=-o.y;const h=t.transform;return t.transform=$R,this.renderer.render(t,{renderTexture:l,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=h,l}destroy(){}}rv.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"textureGenerator"};st.add(rv);const On=new Tt,ys=new Tt;class nv{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Tt,this.destinationFrame=new Tt,this.viewportFrame=new Tt}bind(t=null,r,n){const i=this.renderer;this.current=t;let o,l,h;t?(o=t.baseTexture,h=o.resolution,r||(On.width=t.frame.width,On.height=t.frame.height,r=On),n||(ys.x=t.frame.x,ys.y=t.frame.y,ys.width=r.width,ys.height=r.height,n=ys),l=o.framebuffer):(h=i.resolution,r||(On.width=i._view.screen.width,On.height=i._view.screen.height,r=On),n||(n=On,n.width=r.width,n.height=r.height));const u=this.viewportFrame;u.x=n.x*h,u.y=n.y*h,u.width=n.width*h,u.height=n.height*h,t||(u.y=i.view.height-(u.y+u.height)),u.ceil(),this.renderer.framebuffer.bind(l,u),this.renderer.projection.update(n,r,h,!l),t?this.renderer.mask.setMaskStack(o.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(r),this.destinationFrame.copyFrom(n)}clear(t,r){this.current?t=t||this.current.baseTexture.clearColor:t=t||this.renderer.background.colorRgba;const n=this.destinationFrame,i=this.current?this.current.baseTexture:this.renderer._view.screen,o=n.width!==i.width||n.height!==i.height;if(o){let{x:l,y:h,width:u,height:f}=this.viewportFrame;l=Math.round(l),h=Math.round(h),u=Math.round(u),f=Math.round(f),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,h,u,f)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],r),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}nv.extension={type:Z.RendererSystem,name:"renderTexture"};st.add(nv);class HR{constructor(t,r){this.program=t,this.uniformData=r,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function zR(e,t){const r={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const o=t.getActiveAttrib(e,i);if(o.name.startsWith("gl_"))continue;const l=Nm(t,o.type),h={type:l,name:o.name,size:Lm(l),location:t.getAttribLocation(e,o.name)};r[o.name]=h}return r}function XR(e,t){const r={},n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<n;i++){const o=t.getActiveUniform(e,i),l=o.name.replace(/\[.*?\]$/,""),h=!!o.name.match(/\[.*?\]$/),u=Nm(t,o.type);r[l]={name:l,index:i,type:u,size:o.size,isArray:h,value:Om(u,o.size)}}return r}function VR(e,t){var u;const r=tg(e,e.VERTEX_SHADER,t.vertexSrc),n=tg(e,e.FRAGMENT_SHADER,t.fragmentSrc),i=e.createProgram();e.attachShader(i,r),e.attachShader(i,n);const o=(u=t.extra)==null?void 0:u.transformFeedbackVaryings;if(o&&(typeof e.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):e.transformFeedbackVaryings(i,o.names,o.bufferMode==="separate"?e.SEPARATE_ATTRIBS:e.INTERLEAVED_ATTRIBS)),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)||bR(e,i,r,n),t.attributeData=zR(i,e),t.uniformData=XR(i,e),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const f=Object.keys(t.attributeData);f.sort((d,g)=>d>g?1:-1);for(let d=0;d<f.length;d++)t.attributeData[f[d]].location=d,e.bindAttribLocation(i,d,f[d]);e.linkProgram(i)}e.deleteShader(r),e.deleteShader(n);const l={};for(const f in t.uniformData){const d=t.uniformData[f];l[f]={location:e.getUniformLocation(i,f),value:Om(d.type,d.size)}}return new HR(i,l)}function YR(e,t,r,n,i){r.buffer.update(i)}const jR={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},iv={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function qR(e){const t=e.map(o=>({data:o,offset:0,dataLen:0,dirty:0}));let r=0,n=0,i=0;for(let o=0;o<t.length;o++){const l=t[o];if(r=iv[l.data.type],l.data.size>1&&(r=Math.max(r,16)*l.data.size),l.dataLen=r,n%r!==0&&n<16){const h=n%r%16;n+=h,i+=h}n+r>16?(i=Math.ceil(i/16)*16,l.offset=i,i+=r,n=r):(l.offset=i,n+=r,i+=r)}return i=Math.ceil(i/16)*16,{uboElements:t,size:i}}function KR(e,t){const r=[];for(const n in e)t[n]&&r.push(t[n]);return r.sort((n,i)=>n.index-i.index),r}function ZR(e,t){if(!e.autoManage)return{size:0,syncFunc:YR};const r=KR(e.uniforms,t),{uboElements:n,size:i}=qR(r),o=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let l=0;l<n.length;l++){const h=n[l],u=e.uniforms[h.data.name],f=h.data.name;let d=!1;for(let g=0;g<Fi.length;g++){const m=Fi[g];if(m.codeUbo&&m.test(h.data,u)){o.push(`offset = ${h.offset/4};`,Fi[g].codeUbo(h.data.name,u)),d=!0;break}}if(!d)if(h.data.size>1){const g=Lm(h.data.type),m=Math.max(iv[h.data.type]/16,1),v=g/m,_=(4-v%4)%4;o.push(`
                cv = ud.${f}.value;
                v = uv.${f};
                offset = ${h.offset/4};

                t = 0;

                for(var i=0; i < ${h.data.size*m}; i++)
                {
                    for(var j = 0; j < ${v}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${_};
                }

                `)}else{const g=jR[h.data.type];o.push(`
                cv = ud.${f}.value;
                v = uv.${f};
                offset = ${h.offset/4};
                ${g};
                `)}}return o.push(`
       renderer.buffer.update(buffer);
    `),{size:i,syncFunc:new Function("ud","uv","renderer","syncData","buffer",o.join(`
`))}}let JR=0;const jo={textureCount:0,uboCount:0};class sv{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=JR++}systemCheck(){if(!ER())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,r){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const n=t.program,i=n.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==n&&(this.program=n,this.gl.useProgram(i.program)),r||(jo.textureCount=0,jo.uboCount=0,this.syncUniformGroup(t.uniformGroup,jo)),i}setUniforms(t){const r=this.shader.program,n=r.glPrograms[this.renderer.CONTEXT_UID];r.syncUniforms(n.uniformData,t,this.renderer)}syncUniformGroup(t,r){const n=this.getGlProgram();(!t.static||t.dirtyId!==n.uniformDirtyGroups[t.id])&&(n.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,n,r))}syncUniforms(t,r,n){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(r.uniformData,t.uniforms,this.renderer,n)}createSyncGroups(t){const r=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[r]||(this.cache[r]=yR(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[r],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,r){const n=this.getGlProgram();if(!t.static||t.dirtyId!==0||!n.uniformGroups[t.id]){t.dirtyId=0;const i=n.uniformGroups[t.id]||this.createSyncBufferGroup(t,n,r);t.buffer.update(),i(n.uniformData,t.uniforms,this.renderer,jo,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,n.uniformBufferBindings[r])}createSyncBufferGroup(t,r,n){const{gl:i}=this.renderer;this.renderer.buffer.bind(t.buffer);const o=this.gl.getUniformBlockIndex(r.program,n);r.uniformBufferBindings[n]=this.shader.uniformBindCount,i.uniformBlockBinding(r.program,o,this.shader.uniformBindCount),this.shader.uniformBindCount++;const l=this.getSignature(t,this.shader.program.uniformData,"ubo");let h=this._uboCache[l];if(h||(h=this._uboCache[l]=ZR(t,this.shader.program.uniformData)),t.autoManage){const u=new Float32Array(h.size/4);t.buffer.update(u)}return r.uniformGroups[t.id]=h.syncFunc,r.uniformGroups[t.id]}getSignature(t,r,n){const i=t.uniforms,o=[`${n}-`];for(const l in i)o.push(l),r[l]&&o.push(r[l].type);return o.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const r=this.gl,n=t.program,i=VR(r,n);return n.glPrograms[this.renderer.CONTEXT_UID]=i,i}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}sv.extension={type:Z.RendererSystem,name:"shader"};st.add(sv);class ov{constructor(t){this.renderer=t}run(t){const r=this.renderer;r.emitWithCustomOptions(r.runners.init,t),t.hello&&console.log(`PixiJS 7.1.0 - ${r.rendererLogId} - https://pixijs.com`),r.resize(this.renderer.screen.width,this.renderer.screen.height)}destroy(){}}ov.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"startup"};st.add(ov);function QR(e,t=[]){return t[ct.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.ADD]=[e.ONE,e.ONE],t[ct.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.NONE]=[0,0],t[ct.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[ct.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[ct.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[ct.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[ct.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[ct.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[ct.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[ct.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[ct.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[ct.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t}const tM=0,eM=1,rM=2,nM=3,iM=4,sM=5,Lu=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=ct.NONE,this._blendEq=!1,this.map=[],this.map[tM]=this.setBlend,this.map[eM]=this.setOffset,this.map[rM]=this.setCullFace,this.map[nM]=this.setDepthTest,this.map[iM]=this.setFrontFace,this.map[sM]=this.setDepthMask,this.checks=[],this.defaultState=new Zr,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=QR(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,r=0;for(;t;)t&1&&this.map[r].call(this,!!(e.data&1<<r)),t=t>>1,r++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this.updateCheck(Lu.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(Lu.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],r=this.gl;t.length===2?r.blendFunc(t[0],t[1]):r.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,r.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const r=this.checks.indexOf(e);t&&r===-1?this.checks.push(e):!t&&r!==-1&&this.checks.splice(r,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let av=Lu;av.extension={type:Z.RendererSystem,name:"state"};st.add(av);class oM extends ks{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const r=(t.priority??[]).filter(i=>t.systems[i]),n=[...r,...Object.keys(t.systems).filter(i=>!r.includes(i))];for(const i of n)this.addSystem(t.systems[i],i)}addRunners(...t){t.forEach(r=>{this.runners[r]=new vr(r)})}addSystem(t,r){const n=new t(this);if(this[r])throw new Error(`Whoops! The name "${r}" is already in use`);this[r]=n,this._systemsHash[r]=n;for(const i in this.runners)this.runners[i].add(n);return this}emitWithCustomOptions(t,r){const n=Object.keys(this._systemsHash);t.items.forEach(i=>{const o=n.find(l=>this._systemsHash[l]===i);i[t.name](r[o])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const fa=class{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=fa.defaultMaxIdle,this.checkCountMax=fa.defaultCheckCountMax,this.mode=fa.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==rc.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let r=!1;for(let n=0;n<t.length;n++){const i=t[n];!i.framebuffer&&this.count-i.touched>this.maxIdle&&(e.destroyTexture(i,!0),t[n]=null,r=!0)}if(r){let n=0;for(let i=0;i<t.length;i++)t[i]!==null&&(t[n++]=t[i]);t.length=n}}unload(e){const t=this.renderer.texture,r=e._texture;r&&!r.framebuffer&&t.destroyTexture(r);for(let n=e.children.length-1;n>=0;n--)this.unload(e.children[n])}destroy(){this.renderer=null}};let dr=fa;dr.defaultMode=rc.AUTO;dr.defaultMaxIdle=60*60;dr.defaultCheckCountMax=60*10;dr.extension={type:Z.RendererSystem,name:"textureGC"};st.add(dr);class Hh{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=ot.UNSIGNED_BYTE,this.internalFormat=V.RGBA,this.samplerType=0}}function aM(e){let t;return"WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?t={[ot.UNSIGNED_BYTE]:{[V.RGBA]:e.RGBA8,[V.RGB]:e.RGB8,[V.RG]:e.RG8,[V.RED]:e.R8,[V.RGBA_INTEGER]:e.RGBA8UI,[V.RGB_INTEGER]:e.RGB8UI,[V.RG_INTEGER]:e.RG8UI,[V.RED_INTEGER]:e.R8UI,[V.ALPHA]:e.ALPHA,[V.LUMINANCE]:e.LUMINANCE,[V.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[ot.BYTE]:{[V.RGBA]:e.RGBA8_SNORM,[V.RGB]:e.RGB8_SNORM,[V.RG]:e.RG8_SNORM,[V.RED]:e.R8_SNORM,[V.RGBA_INTEGER]:e.RGBA8I,[V.RGB_INTEGER]:e.RGB8I,[V.RG_INTEGER]:e.RG8I,[V.RED_INTEGER]:e.R8I},[ot.UNSIGNED_SHORT]:{[V.RGBA_INTEGER]:e.RGBA16UI,[V.RGB_INTEGER]:e.RGB16UI,[V.RG_INTEGER]:e.RG16UI,[V.RED_INTEGER]:e.R16UI,[V.DEPTH_COMPONENT]:e.DEPTH_COMPONENT16},[ot.SHORT]:{[V.RGBA_INTEGER]:e.RGBA16I,[V.RGB_INTEGER]:e.RGB16I,[V.RG_INTEGER]:e.RG16I,[V.RED_INTEGER]:e.R16I},[ot.UNSIGNED_INT]:{[V.RGBA_INTEGER]:e.RGBA32UI,[V.RGB_INTEGER]:e.RGB32UI,[V.RG_INTEGER]:e.RG32UI,[V.RED_INTEGER]:e.R32UI,[V.DEPTH_COMPONENT]:e.DEPTH_COMPONENT24},[ot.INT]:{[V.RGBA_INTEGER]:e.RGBA32I,[V.RGB_INTEGER]:e.RGB32I,[V.RG_INTEGER]:e.RG32I,[V.RED_INTEGER]:e.R32I},[ot.FLOAT]:{[V.RGBA]:e.RGBA32F,[V.RGB]:e.RGB32F,[V.RG]:e.RG32F,[V.RED]:e.R32F,[V.DEPTH_COMPONENT]:e.DEPTH_COMPONENT32F},[ot.HALF_FLOAT]:{[V.RGBA]:e.RGBA16F,[V.RGB]:e.RGB16F,[V.RG]:e.RG16F,[V.RED]:e.R16F},[ot.UNSIGNED_SHORT_5_6_5]:{[V.RGB]:e.RGB565},[ot.UNSIGNED_SHORT_4_4_4_4]:{[V.RGBA]:e.RGBA4},[ot.UNSIGNED_SHORT_5_5_5_1]:{[V.RGBA]:e.RGB5_A1},[ot.UNSIGNED_INT_2_10_10_10_REV]:{[V.RGBA]:e.RGB10_A2,[V.RGBA_INTEGER]:e.RGB10_A2UI},[ot.UNSIGNED_INT_10F_11F_11F_REV]:{[V.RGB]:e.R11F_G11F_B10F},[ot.UNSIGNED_INT_5_9_9_9_REV]:{[V.RGB]:e.RGB9_E5},[ot.UNSIGNED_INT_24_8]:{[V.DEPTH_STENCIL]:e.DEPTH24_STENCIL8},[ot.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[V.DEPTH_STENCIL]:e.DEPTH32F_STENCIL8}}:t={[ot.UNSIGNED_BYTE]:{[V.RGBA]:e.RGBA,[V.RGB]:e.RGB,[V.ALPHA]:e.ALPHA,[V.LUMINANCE]:e.LUMINANCE,[V.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[ot.UNSIGNED_SHORT_5_6_5]:{[V.RGB]:e.RGB},[ot.UNSIGNED_SHORT_4_4_4_4]:{[V.RGBA]:e.RGBA},[ot.UNSIGNED_SHORT_5_5_5_1]:{[V.RGBA]:e.RGBA}},t}class lv{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new gt,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=aM(t);const r=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=r;for(let i=0;i<r;i++)this.boundTextures[i]=null;this.emptyTextures={};const n=new Hh(t.createTexture());t.bindTexture(t.TEXTURE_2D,n.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=n,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Hh(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let i=0;i<6;i++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let i=0;i<this.boundTextures.length;i++)this.bind(null,i)}bind(t,r=0){const{gl:n}=this;if(t=t==null?void 0:t.castToBaseTexture(),t!=null&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const i=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[r]!==t&&(this.currentLocation!==r&&(this.currentLocation=r,n.activeTexture(n.TEXTURE0+r)),n.bindTexture(t.target,i.texture)),i.dirtyId!==t.dirtyId?(this.currentLocation!==r&&(this.currentLocation=r,n.activeTexture(n.TEXTURE0+r)),this.updateTexture(t)):i.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[r]=t}else this.currentLocation!==r&&(this.currentLocation=r,n.activeTexture(n.TEXTURE0+r)),n.bindTexture(n.TEXTURE_2D,this.emptyTextures[n.TEXTURE_2D].texture),this.boundTextures[r]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:r,boundTextures:n}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let i=0;i<n.length;i++)n[i]===this.unknownTexture&&this.bind(null,i)}for(let i=0;i<n.length;i++)n[i]===t&&(this.currentLocation!==i&&(r.activeTexture(r.TEXTURE0+i),this.currentLocation=i),r.bindTexture(t.target,this.emptyTextures[t.target].texture),n[i]=null)}ensureSamplerType(t){const{boundTextures:r,hasIntegerTextures:n,CONTEXT_UID:i}=this;if(n)for(let o=t-1;o>=0;--o){const l=r[o];l&&l._glTextures[i].samplerType!==pu.FLOAT&&this.renderer.texture.unbind(l)}}initTexture(t){const r=new Hh(this.gl.createTexture());return r.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=r,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),r}initTextureType(t,r){var n;r.internalFormat=((n=this.internalFormats[t.type])==null?void 0:n[t.format])??t.format,this.webGLVersion===2&&t.type===ot.HALF_FLOAT?r.type=this.gl.HALF_FLOAT:r.type=t.type}updateTexture(t){var i;const r=t._glTextures[this.CONTEXT_UID];if(!r)return;const n=this.renderer;if(this.initTextureType(t,r),(i=t.resource)!=null&&i.upload(n,t,r))r.samplerType!==pu.FLOAT&&(this.hasIntegerTextures=!0);else{const o=t.realWidth,l=t.realHeight,h=n.gl;(r.width!==o||r.height!==l||r.dirtyId<0)&&(r.width=o,r.height=l,h.texImage2D(t.target,0,r.internalFormat,o,l,0,t.format,r.type,null))}t.dirtyStyleId!==r.dirtyStyleId&&this.updateTextureStyle(t),r.dirtyId=t.dirtyId}destroyTexture(t,r){const{gl:n}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),n.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!r)){const i=this.managedTextures.indexOf(t);i!==-1&&Bi(this.managedTextures,i,1)}}updateTextureStyle(t){var n;const r=t._glTextures[this.CONTEXT_UID];r&&((t.mipmap===Or.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?r.mipmap=!1:r.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?r.wrapMode=gn.CLAMP:r.wrapMode=t.wrapMode,(n=t.resource)!=null&&n.style(this.renderer,t,r)||this.setStyle(t,r),r.dirtyStyleId=t.dirtyStyleId)}setStyle(t,r){const n=this.gl;if(r.mipmap&&t.mipmap!==Or.ON_MANUAL&&n.generateMipmap(t.target),n.texParameteri(t.target,n.TEXTURE_WRAP_S,r.wrapMode),n.texParameteri(t.target,n.TEXTURE_WRAP_T,r.wrapMode),r.mipmap){n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode===Yr.LINEAR?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST);const i=this.renderer.context.extensions.anisotropicFiltering;if(i&&t.anisotropicLevel>0&&t.scaleMode===Yr.LINEAR){const o=Math.min(t.anisotropicLevel,n.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT));n.texParameterf(t.target,i.TEXTURE_MAX_ANISOTROPY_EXT,o)}}else n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode===Yr.LINEAR?n.LINEAR:n.NEAREST);n.texParameteri(t.target,n.TEXTURE_MAG_FILTER,t.scaleMode===Yr.LINEAR?n.LINEAR:n.NEAREST)}destroy(){this.renderer=null}}lv.extension={type:Z.RendererSystem,name:"texture"};st.add(lv);class hv{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:r,CONTEXT_UID:n}=this,i=t._glTransformFeedbacks[n]||this.createGLTransformFeedback(t);r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,i)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,r){const{gl:n,renderer:i}=this;r&&i.shader.bind(r),n.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:r,renderer:n,CONTEXT_UID:i}=this,o=r.createTransformFeedback();t._glTransformFeedbacks[i]=o,r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,o);for(let l=0;l<t.buffers.length;l++){const h=t.buffers[l];h&&(n.buffer.update(h),h._glBuffers[i].refCount++,r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,l,h._glBuffers[i].buffer||null))}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),o}disposeTransformFeedback(t,r){const n=t._glTransformFeedbacks[this.CONTEXT_UID],i=this.gl;t.disposeRunner.remove(this);const o=this.renderer.buffer;if(o)for(let l=0;l<t.buffers.length;l++){const h=t.buffers[l];if(!h)continue;const u=h._glBuffers[this.CONTEXT_UID];u&&(u.refCount--,u.refCount===0&&!r&&o.dispose(h,r))}n&&(r||i.deleteTransformFeedback(n),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}hv.extension={type:Z.RendererSystem,name:"transformFeedback"};st.add(hv);class uv{constructor(t){this.renderer=t}init(t){this.screen=new Tt(0,0,t.width,t.height),this.element=t.view||J.ADAPTER.createCanvas(),this.resolution=t.resolution||J.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,r){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(r*this.resolution);const n=this.element.width/this.resolution,i=this.element.height/this.resolution;this.screen.width=n,this.screen.height=i,this.autoDensity&&(this.element.style.width=`${n}px`,this.element.style.height=`${i}px`),this.renderer.emit("resize",n,i),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var r;t&&((r=this.element.parentNode)==null||r.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}uv.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"_view"};st.add(uv);J.PREFER_ENV=Qn.WEBGL2;J.STRICT_TEXTURE_CACHE=!1;Object.defineProperties(J,{WRAP_MODE:{get(){return gt.defaultOptions.wrapMode},set(e){Ct("7.1.0","settings.WRAP_MODE is deprecated, use BaseTeture.defaultOptions.wrapMode"),gt.defaultOptions.wrapMode=e}},SCALE_MODE:{get(){return gt.defaultOptions.scaleMode},set(e){Ct("7.1.0","settings.SCALE_MODE is deprecated, use BaseTeture.defaultOptions.scaleMode"),gt.defaultOptions.scaleMode=e}},MIPMAP_TEXTURES:{get(){return gt.defaultOptions.mipmap},set(e){Ct("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTeture.defaultOptions.mipmap"),gt.defaultOptions.mipmap=e}},ANISOTROPIC_LEVEL:{get(){return gt.defaultOptions.anisotropicLevel},set(e){Ct("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTeture.defaultOptions.anisotropicLevel"),gt.defaultOptions.anisotropicLevel=e}},FILTER_RESOLUTION:{get(){return Ct("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Se.defaultResolution},set(e){Se.defaultResolution=e}},FILTER_MULTISAMPLE:{get(){return Ct("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Se.defaultMultisample},set(e){Se.defaultMultisample=e}},SPRITE_MAX_TEXTURES:{get(){return fr.defaultMaxTextures},set(e){Ct("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),fr.defaultMaxTextures=e}},SPRITE_BATCH_SIZE:{get(){return fr.defaultBatchSize},set(e){Ct("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),fr.defaultBatchSize=e}},CAN_UPLOAD_SAME_BUFFER:{get(){return fr.canUploadSameBuffer},set(e){Ct("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),fr.canUploadSameBuffer=e}},GC_MODE:{get(){return dr.defaultMode},set(e){Ct("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),dr.defaultMode=e}},GC_MAX_IDLE:{get(){return dr.defaultMaxIdle},set(e){Ct("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),dr.defaultMaxIdle=e}},GC_MAX_CHECK_COUNT:{get(){return dr.defaultCheckCountMax},set(e){Ct("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),dr.defaultCheckCountMax=e}},PRECISION_VERTEX:{get(){return pr.defaultVertexPrecision},set(e){Ct("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),pr.defaultVertexPrecision=e}},PRECISION_FRAGMENT:{get(){return pr.defaultFragmentPrecision},set(e){Ct("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),pr.defaultFragmentPrecision=e}}});var Ui=(e=>(e[e.HIGH=25]="HIGH",e[e.NORMAL=0]="NORMAL",e[e.LOW=-25]="LOW",e[e.UTILITY=-50]="UTILITY",e))(Ui||{});class zh{constructor(t,r=null,n=0,i=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=r,this.priority=n,this.once=i}match(t,r=null){return this.fn===t&&this.context===r}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const r=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),r}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const r=this.next;return this.next=t?null:r,this.previous=null,r}}const Ge=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new zh(null,null,1/0),this.deltaMS=1/Ge.targetFPMS,this.elapsedMS=1/Ge.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,r=Ui.NORMAL){return this._addListener(new zh(e,t,r))}addOnce(e,t,r=Ui.NORMAL){return this._addListener(new zh(e,t,r,!0))}_addListener(e){let t=this._head.next,r=this._head;if(!t)e.connect(r);else{for(;t;){if(e.priority>t.priority){e.connect(r);break}r=t,t=t.next}e.previous||e.connect(r)}return this._startIfPossible(),this}remove(e,t){let r=this._head.next;for(;r;)r.match(e,t)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const i=e-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=e-i%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*Ge.targetFPMS;const r=this._head;let n=r.next;for(;n;)n=n.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),r=Math.min(Math.max(0,t)/1e3,Ge.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!Ge._shared){const e=Ge._shared=new Ge;e.autoStart=!0,e._protected=!0}return Ge._shared}static get system(){if(!Ge._system){const e=Ge._system=new Ge;e.autoStart=!0,e._protected=!0}return Ge._system}};let Be=Ge;Be.targetFPMS=.06;Object.defineProperties(J,{TARGET_FPMS:{get(){return Be.targetFPMS},set(e){Ct("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Be.targetFPMS=e}}});class cv{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(r){this._ticker&&this._ticker.remove(this.render,this),this._ticker=r,r&&r.add(this.render,this,Ui.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Be.shared:new Be,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}cv.extension=Z.Application;st.add(cv);const fv=[];st.handleByList(Z.Renderer,fv);function lM(e){for(const t of fv)if(t.test(e))return new t(e);throw new Error("Unable to auto-detect a suitable renderer.")}var hM=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,uM=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const cM=hM,dv=uM;class pv{constructor(t){this.renderer=t}contextChange(t){let r;if(this.renderer.context.webGLVersion===1){const n=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),r=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,n)}else{const n=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),r=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,n)}r>=se.HIGH?this.multisample=se.HIGH:r>=se.MEDIUM?this.multisample=se.MEDIUM:r>=se.LOW?this.multisample=se.LOW:this.multisample=se.NONE}destroy(){}}pv.extension={type:Z.RendererSystem,name:"_multisample"};st.add(pv);class fM{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class gv{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:r,CONTEXT_UID:n}=this,i=t._glBuffers[n]||this.createGLBuffer(t);r.bindBuffer(t.type,i.buffer)}unbind(t){const{gl:r}=this;r.bindBuffer(t,null)}bindBufferBase(t,r){const{gl:n,CONTEXT_UID:i}=this;if(this.boundBufferBases[r]!==t){const o=t._glBuffers[i]||this.createGLBuffer(t);this.boundBufferBases[r]=t,n.bindBufferBase(n.UNIFORM_BUFFER,r,o.buffer)}}bindBufferRange(t,r,n){const{gl:i,CONTEXT_UID:o}=this;n=n||0;const l=t._glBuffers[o]||this.createGLBuffer(t);i.bindBufferRange(i.UNIFORM_BUFFER,r||0,l.buffer,n*256,256)}update(t){const{gl:r,CONTEXT_UID:n}=this,i=t._glBuffers[n]||this.createGLBuffer(t);if(t._updateID!==i.updateID)if(i.updateID=t._updateID,r.bindBuffer(t.type,i.buffer),i.byteLength>=t.data.byteLength)r.bufferSubData(t.type,0,t.data);else{const o=t.static?r.STATIC_DRAW:r.DYNAMIC_DRAW;i.byteLength=t.data.byteLength,r.bufferData(t.type,t.data,o)}}dispose(t,r){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const n=t._glBuffers[this.CONTEXT_UID],i=this.gl;t.disposeRunner.remove(this),n&&(r||i.deleteBuffer(n.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const r=Object.keys(this.managedBuffers);for(let n=0;n<r.length;n++)this.dispose(this.managedBuffers[r[n]],t)}createGLBuffer(t){const{CONTEXT_UID:r,gl:n}=this;return t._glBuffers[r]=new fM(n.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[r]}}gv.extension={type:Z.RendererSystem,name:"buffer"};st.add(gv);class mv{constructor(t){this.renderer=t}render(t,r){const n=this.renderer;let i,o,l,h;if(r&&(i=r.renderTexture,o=r.clear,l=r.transform,h=r.skipUpdateTransform),this.renderingToScreen=!i,n.runners.prerender.emit(),n.emit("prerender"),n.projection.transform=l,!n.context.isLost){if(i||(this.lastObjectRendered=t),!h){const u=t.enableTempParent();t.updateTransform(),t.disableTempParent(u)}n.renderTexture.bind(i),n.batch.currentRenderer.start(),(o??n.background.clearBeforeRender)&&n.renderTexture.clear(),t.render(n),n.batch.currentRenderer.flush(),i&&(r.blit&&n.framebuffer.blit(),i.baseTexture.update()),n.runners.postrender.emit(),n.projection.transform=null,n.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}mv.extension={type:Z.RendererSystem,name:"objectRenderer"};st.add(mv);const Nu=class extends oM{constructor(e){super(),e=Object.assign({},J.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new yr({projectionMatrix:new Ht},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Nu.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in e&&(Ct("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&e.useContextAlpha!=="notMultiplied",e.backgroundAlpha=e.useContextAlpha===!1?1:e.backgroundAlpha);const r={hello:e.hello,_plugin:Nu.__plugins,background:{alpha:e.backgroundAlpha,color:e.background??e.backgroundColor,clearBeforeRender:e.clearBeforeRender},_view:{height:e.height,width:e.width,autoDensity:e.autoDensity,resolution:e.resolution,view:e.view},context:{antialias:e.antialias,context:e.context,powerPreference:e.powerPreference,premultipliedAlpha:e.premultipliedAlpha,preserveDrawingBuffer:e.preserveDrawingBuffer}};this.startup.run(r),this.options=e}static test(e){return e!=null&&e.forceCanvas?!1:aC()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Ct("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Ct("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Ct("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Ct("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){Ct("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return Ct("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.color}set backgroundAlpha(e){Ct("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return Ct("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};let Yi=Nu;Yi.extension={type:Z.Renderer,priority:1};Yi.__plugins={};Yi.__systems={};st.handleByMap(Z.RendererPlugin,Yi.__plugins);st.handleByMap(Z.RendererSystem,Yi.__systems);st.add(Yi);class vv extends Os{constructor(t,r){const{width:n,height:i}=r||{};super(n,i),this.items=[],this.itemDirtyIds=[];for(let o=0;o<t;o++){const l=new gt;this.items.push(l),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,r){for(let n=0;n<this.length;n++)t[n]&&(t[n].castToBaseTexture?this.addBaseTextureAt(t[n].castToBaseTexture(),n):t[n]instanceof Os?this.addResourceAt(t[n],n):this.addResourceAt(Rm(t[n],r),n))}dispose(){for(let t=0,r=this.length;t<r;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,r){if(!this.items[r])throw new Error(`Index ${r} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[r].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let r=0;r<this.length;r++)this.items[r].parentTextureArray=t,this.items[r].on("update",t.update,t)}unbind(t){super.unbind(t);for(let r=0;r<this.length;r++)this.items[r].parentTextureArray=null,this.items[r].off("update",t.update,t)}load(){if(this._load)return this._load;const r=this.items.map(n=>n.resource).filter(n=>n).map(n=>n.load());return this._load=Promise.all(r).then(()=>{const{realWidth:n,realHeight:i}=this.items[0];return this.resize(n,i),Promise.resolve(this)}),this._load}}class dM extends vv{constructor(t,r){const{width:n,height:i}=r||{};let o,l;Array.isArray(t)?(o=t,l=t.length):l=t,super(l,{width:n,height:i}),o&&this.initFromArray(o,r)}addBaseTextureAt(t,r){if(t.resource)this.addResourceAt(t.resource,r);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=Ri.TEXTURE_2D_ARRAY}upload(t,r,n){const{length:i,itemDirtyIds:o,items:l}=this,{gl:h}=t;n.dirtyId<0&&h.texImage3D(h.TEXTURE_2D_ARRAY,0,n.internalFormat,this._width,this._height,i,0,r.format,n.type,null);for(let u=0;u<i;u++){const f=l[u];o[u]<f.dirtyId&&(o[u]=f.dirtyId,f.valid&&h.texSubImage3D(h.TEXTURE_2D_ARRAY,0,0,0,u,f.resource.width,f.resource.height,1,r.format,n.type,f.resource.source))}return!0}}class pM extends yn{constructor(t){super(t)}static test(t){const{OffscreenCanvas:r}=globalThis;return r&&t instanceof r?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const ws=class extends vv{constructor(e,t){const{width:r,height:n,autoLoad:i,linkBaseTexture:o}=t||{};if(e&&e.length!==ws.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:r,height:n});for(let l=0;l<ws.SIDES;l++)this.items[l].target=Ri.TEXTURE_CUBE_MAP_POSITIVE_X+l;this.linkBaseTexture=o!==!1,e&&this.initFromArray(e,t),i!==!1&&this.load()}bind(e){super.bind(e),e.target=Ri.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,r){if(r===void 0&&(r=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=Ri.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(e,t,r){const n=this.itemDirtyIds;for(let i=0;i<ws.SIDES;i++){const o=this.items[i];(n[i]<o.dirtyId||r.dirtyId<t.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(e,o,r),n[i]=o.dirtyId):n[i]<-1&&(e.gl.texImage2D(o.target,0,r.internalFormat,t.realWidth,t.realHeight,0,t.format,r.type,null),n[i]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===ws.SIDES}};let yv=ws;yv.SIDES=6;class Ci extends yn{constructor(t,r){var n=(...i)=>{super(...i)};r=r||{},typeof t=="string"?(n(Ci.EMPTY),this.url=t):(n(t),this.url=null),this.crossOrigin=r.crossOrigin??!0,this.alphaMode=typeof r.alphaMode=="number"?r.alphaMode:null,this._load=null,r.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,r)=>{if(this.url===null){t(this);return}try{const n=await J.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const i=await n.blob();if(this.destroyed)return;const o=await createImageBitmap(i,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===_r.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=o,this.update(),t(this)}catch(n){if(this.destroyed)return;r(n),this.onError.emit(n)}}),this._load)}upload(t,r,n){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(r.alphaMode=this.alphaMode),super.upload(t,r,n)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return Ci._EMPTY=Ci._EMPTY??J.ADAPTER.createCanvas(0,0),Ci._EMPTY}}const da=class extends yn{constructor(e,t){t=t||{},super(J.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(e=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),e(this)},da.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const e=new Image;yn.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,r=e.height;if(!t||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let n=t*this.scale,i=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(n=this._overrideWidth||this._overrideHeight/r*t,i=this._overrideHeight||this._overrideWidth/t*r),n=Math.round(n),i=Math.round(i);const o=this.source;o.width=n,o.height=i,o._pixiId=`canvas_${qn()}`,o.getContext("2d").drawImage(e,0,0,t,r,0,0,n,i),this._resolve(),this._resolve=null}}static getSize(e){const t=da.SVG_SIZE.exec(e),r={};return t&&(r[t[1]]=Math.round(parseFloat(t[3])),r[t[5]]=Math.round(parseFloat(t[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,t){return t==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&da.SVG_XML.test(e)}};let Fs=da;Fs.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;Fs.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const ku=class extends yn{constructor(e,t){if(t=t||{},!(e instanceof HTMLVideoElement)){const r=document.createElement("video");r.setAttribute("preload","auto"),r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline",""),typeof e=="string"&&(e=[e]);const n=e[0].src||e[0];yn.crossOrigin(r,n,t.crossorigin);for(let i=0;i<e.length;++i){const o=document.createElement("source");let{src:l,mime:h}=e[i];l=l||e[i];const u=l.split("?").shift().toLowerCase(),f=u.slice(u.lastIndexOf(".")+1);h=h||ku.MIME_TYPES[f]||`video/${f}`,o.src=l,o.type=h,r.appendChild(o)}e=r}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),t.autoLoad!==!1&&this.load()}update(e=0){if(!this.destroyed){const t=Be.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Be.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Be.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(e.videoWidth,e.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._isConnectedToTicker&&(Be.shared.remove(this.update,this),this._isConnectedToTicker=!1);const e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(Be.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Be.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e)}static test(e,t){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||ku.TYPES.includes(t)}};let vc=ku;vc.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];vc.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};Mu.push(Ci,$m,pM,vc,Fs,Ws,yv,dM);class Ia{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Tt.EMPTY:(t=t||new Tt(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,r){const{a:n,b:i,c:o,d:l,tx:h,ty:u}=t,f=n*r.x+o*r.y+h,d=i*r.x+l*r.y+u;this.minX=Math.min(this.minX,f),this.maxX=Math.max(this.maxX,f),this.minY=Math.min(this.minY,d),this.maxY=Math.max(this.maxY,d)}addQuad(t){let r=this.minX,n=this.minY,i=this.maxX,o=this.maxY,l=t[0],h=t[1];r=l<r?l:r,n=h<n?h:n,i=l>i?l:i,o=h>o?h:o,l=t[2],h=t[3],r=l<r?l:r,n=h<n?h:n,i=l>i?l:i,o=h>o?h:o,l=t[4],h=t[5],r=l<r?l:r,n=h<n?h:n,i=l>i?l:i,o=h>o?h:o,l=t[6],h=t[7],r=l<r?l:r,n=h<n?h:n,i=l>i?l:i,o=h>o?h:o,this.minX=r,this.minY=n,this.maxX=i,this.maxY=o}addFrame(t,r,n,i,o){this.addFrameMatrix(t.worldTransform,r,n,i,o)}addFrameMatrix(t,r,n,i,o){const l=t.a,h=t.b,u=t.c,f=t.d,d=t.tx,g=t.ty;let m=this.minX,v=this.minY,_=this.maxX,w=this.maxY,x=l*r+u*n+d,A=h*r+f*n+g;m=x<m?x:m,v=A<v?A:v,_=x>_?x:_,w=A>w?A:w,x=l*i+u*n+d,A=h*i+f*n+g,m=x<m?x:m,v=A<v?A:v,_=x>_?x:_,w=A>w?A:w,x=l*r+u*o+d,A=h*r+f*o+g,m=x<m?x:m,v=A<v?A:v,_=x>_?x:_,w=A>w?A:w,x=l*i+u*o+d,A=h*i+f*o+g,m=x<m?x:m,v=A<v?A:v,_=x>_?x:_,w=A>w?A:w,this.minX=m,this.minY=v,this.maxX=_,this.maxY=w}addVertexData(t,r,n){let i=this.minX,o=this.minY,l=this.maxX,h=this.maxY;for(let u=r;u<n;u+=2){const f=t[u],d=t[u+1];i=f<i?f:i,o=d<o?d:o,l=f>l?f:l,h=d>h?d:h}this.minX=i,this.minY=o,this.maxX=l,this.maxY=h}addVertices(t,r,n,i){this.addVerticesMatrix(t.worldTransform,r,n,i)}addVerticesMatrix(t,r,n,i,o=0,l=o){const h=t.a,u=t.b,f=t.c,d=t.d,g=t.tx,m=t.ty;let v=this.minX,_=this.minY,w=this.maxX,x=this.maxY;for(let A=n;A<i;A+=2){const S=r[A],E=r[A+1],I=h*S+f*E+g,D=d*E+u*S+m;v=Math.min(v,I-o),w=Math.max(w,I+o),_=Math.min(_,D-l),x=Math.max(x,D+l)}this.minX=v,this.minY=_,this.maxX=w,this.maxY=x}addBounds(t){const r=this.minX,n=this.minY,i=this.maxX,o=this.maxY;this.minX=t.minX<r?t.minX:r,this.minY=t.minY<n?t.minY:n,this.maxX=t.maxX>i?t.maxX:i,this.maxY=t.maxY>o?t.maxY:o}addBoundsMask(t,r){const n=t.minX>r.minX?t.minX:r.minX,i=t.minY>r.minY?t.minY:r.minY,o=t.maxX<r.maxX?t.maxX:r.maxX,l=t.maxY<r.maxY?t.maxY:r.maxY;if(n<=o&&i<=l){const h=this.minX,u=this.minY,f=this.maxX,d=this.maxY;this.minX=n<h?n:h,this.minY=i<u?i:u,this.maxX=o>f?o:f,this.maxY=l>d?l:d}}addBoundsMatrix(t,r){this.addFrameMatrix(r,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,r){const n=t.minX>r.x?t.minX:r.x,i=t.minY>r.y?t.minY:r.y,o=t.maxX<r.x+r.width?t.maxX:r.x+r.width,l=t.maxY<r.y+r.height?t.maxY:r.y+r.height;if(n<=o&&i<=l){const h=this.minX,u=this.minY,f=this.maxX,d=this.maxY;this.minX=n<h?n:h,this.minY=i<u?i:u,this.maxX=o>f?o:f,this.maxY=l>d?l:d}}pad(t=0,r=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=r,this.maxY+=r)}addFramePad(t,r,n,i,o,l){t-=o,r-=l,n+=o,i+=l,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>n?this.maxX:n,this.minY=this.minY<r?this.minY:r,this.maxY=this.maxY>i?this.maxY:i}}class Yt extends ks{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new mc,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Ia,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const r=Object.keys(t);for(let n=0;n<r.length;++n){const i=r[n];Object.defineProperty(Yt.prototype,i,Object.getOwnPropertyDescriptor(t,i))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,r){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),r||(this._boundsRect||(this._boundsRect=new Tt),r=this._boundsRect),this._bounds.getRectangle(r)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Tt),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Ia);const r=this.transform,n=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const i=this._bounds,o=this._boundsID;this._bounds=this._localBounds;const l=this.getBounds(!1,t);return this.parent=n,this.transform=r,this._bounds=i,this._bounds.updateID+=this._boundsID-o,l}toGlobal(t,r,n=!1){return n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,r)}toLocal(t,r,n,i){return r&&(t=r.toGlobal(t,n,i)),i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,n)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,r=0,n=1,i=1,o=0,l=0,h=0,u=0,f=0){return this.position.x=t,this.position.y=r,this.scale.x=n||1,this.scale.y=i||1,this.rotation=o,this.skew.x=l,this.skew.y=h,this.pivot.x=u,this.pivot.y=f,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new gM),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*cR}set angle(t){this.transform.rotation=t*fR}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount--,r._maskRefCount===0&&(r.renderable=!0,r.isMask=!1))}if(this._mask=t,this._mask){const r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount===0&&(r.renderable=!1,r.isMask=!0),r._maskRefCount++)}}}}class gM extends Yt{constructor(){super(...arguments),this.sortDirty=null}}Yt.prototype.displayObjectUpdateTransform=Yt.prototype.updateTransform;const mM=new Ht;function vM(e,t){return e.zIndex===t.zIndex?e._lastSortedIndex-t._lastSortedIndex:e.zIndex-t.zIndex}const Uu=class extends Yt{constructor(){super(),this.children=[],this.sortableChildren=Uu.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const r=this.getChildIndex(e),n=this.getChildIndex(t);this.children[r]=t,this.children[n]=e,this.onChildrenChange(r<n?r:n)}getChildIndex(e){const t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(e);Bi(this.children,r,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],r=this.children.indexOf(t);if(r===-1)return null;t.parent=null,t.transform._parentID=-1,Bi(this.children,r,1),this._boundsID++,this.onChildrenChange(r),t.emit("removed",this),this.emit("childRemoved",t,this,r)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,Bi(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const r=e,n=t,i=n-r;let o;if(i>0&&i<=n){o=this.children.splice(r,i);for(let l=0;l<o.length;++l)o[l].parent=null,o[l].transform&&(o[l].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let l=0;l<o.length;++l)o[l].emit("removed",this),this.emit("childRemoved",o[l],this,l);return o}else if(i===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,r=this.children.length;t<r;++t){const n=this.children[t];n._lastSortedIndex=t,!e&&n.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(vM),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const r=this.children[e];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(t._bounds,r._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const r=super.getLocalBounds(e);if(!t)for(let n=0,i=this.children.length;n<i;++n){const o=this.children[n];o.visible&&o.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(e){const t=e.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let r,n;this.cullArea?(r=this.cullArea,n=this.worldTransform):this._render!==Uu.prototype._render&&(r=this.getBounds(!0));const i=e.projection.transform;if(i&&(n?(n=mM.copyFrom(n),n.prepend(i)):n=i),r&&t.intersects(r,n))this._render(e);else if(this.cullArea)return;for(let o=0,l=this.children.length;o<l;++o){const h=this.children[o],u=h.cullable;h.cullable=u||!this.cullArea,h.render(e),h.cullable=u}}render(e){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(t=this.filters)!=null&&t.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let r=0,n=this.children.length;r<n;++r)this.children[r].render(e)}}renderAdvanced(e){var i,o,l;const t=this.filters,r=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let h=0;h<t.length;h++)t[h].enabled&&this._enabledFilters.push(t[h])}const n=t&&((i=this._enabledFilters)==null?void 0:i.length)||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==ue.NONE));if(n&&e.batch.flush(),t&&((o=this._enabledFilters)!=null&&o.length)&&e.filter.push(this,this._enabledFilters),r&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let h=0,u=this.children.length;h<u;++h)this.children[h].render(e)}n&&e.batch.flush(),r&&e.mask.pop(this),t&&((l=this._enabledFilters)!=null&&l.length)&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t=typeof e=="boolean"?e:e==null?void 0:e.children,r=this.removeChildren(0,this.children.length);if(t)for(let n=0;n<r.length;++n)r[n].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}};let $e=Uu;$e.defaultSortableChildren=!1;$e.prototype.containerUpdateTransform=$e.prototype.updateTransform;Object.defineProperties(J,{SORTABLE_CHILDREN:{get(){return $e.defaultSortableChildren},set(e){Ct("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),$e.defaultSortableChildren=e}}});const _s=new St,yM=new Uint16Array([0,1,2,0,2,3]);class ji extends $e{constructor(t){super(),this._anchor=new dn(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=ct.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||it.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=yM,this.pluginName="batch",this.isSprite=!0,this._roundPixels=J.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Si(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Si(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const r=this.transform.worldTransform,n=r.a,i=r.b,o=r.c,l=r.d,h=r.tx,u=r.ty,f=this.vertexData,d=t.trim,g=t.orig,m=this._anchor;let v=0,_=0,w=0,x=0;if(d?(_=d.x-m._x*g.width,v=_+d.width,x=d.y-m._y*g.height,w=x+d.height):(_=-m._x*g.width,v=_+g.width,x=-m._y*g.height,w=x+g.height),f[0]=n*_+o*x+h,f[1]=l*x+i*_+u,f[2]=n*v+o*x+h,f[3]=l*x+i*v+u,f[4]=n*v+o*w+h,f[5]=l*w+i*v+u,f[6]=n*_+o*w+h,f[7]=l*w+i*_+u,this._roundPixels){const A=J.RESOLUTION;for(let S=0;S<f.length;++S)f[S]=Math.round(f[S]*A)/A}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,r=this.vertexTrimmedData,n=t.orig,i=this._anchor,o=this.transform.worldTransform,l=o.a,h=o.b,u=o.c,f=o.d,d=o.tx,g=o.ty,m=-i._x*n.width,v=m+n.width,_=-i._y*n.height,w=_+n.height;r[0]=l*m+u*_+d,r[1]=f*_+h*m+g,r[2]=l*v+u*_+d,r[3]=f*_+h*v+g,r[4]=l*v+u*w+d,r[5]=f*w+h*v+g,r[6]=l*m+u*w+d,r[7]=f*w+h*m+g}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,r=this._texture.orig;!t||t.width===r.width&&t.height===r.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new Ia),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Tt),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,_s);const r=this._texture.orig.width,n=this._texture.orig.height,i=-r*this.anchor.x;let o=0;return _s.x>=i&&_s.x<i+r&&(o=-n*this.anchor.y,_s.y>=o&&_s.y<o+n)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const n=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!n)}this._texture=null}static from(t,r){const n=t instanceof it?t:it.from(t,r);return new ji(n)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const r=Si(this.scale.x)||1;this.scale.x=r*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const r=Si(this.scale.y)||1;this.scale.y=r*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tint}set tint(t){this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16)}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||it.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const _v=new Ht;Yt.prototype._cacheAsBitmap=!1;Yt.prototype._cacheData=null;Yt.prototype._cacheAsBitmapResolution=null;Yt.prototype._cacheAsBitmapMultisample=null;class _M{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Yt.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(e){e!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(e){e!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(e){if(this._cacheAsBitmap===e)return;this._cacheAsBitmap=e;let t;e?(this._cacheData||(this._cacheData=new _M),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});Yt.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))};Yt.prototype._initCachedDisplayObject=function(t){var m,v;if((m=this._cacheData)!=null&&m.sprite)return;const r=this.alpha;this.alpha=1,t.batch.flush();const n=this.getLocalBounds(null,!0).clone();if((v=this.filters)!=null&&v.length){const _=this.filters[0].padding;n.pad(_)}n.ceil(J.RESOLUTION);const i=t.renderTexture.current,o=t.renderTexture.sourceFrame.clone(),l=t.renderTexture.destinationFrame.clone(),h=t.projection.transform,u=_n.create({width:n.width,height:n.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),f=`cacheAsBitmap_${qn()}`;this._cacheData.textureCacheId=f,gt.addToCache(u.baseTexture,f),it.addToCache(u,f);const d=this.transform.localTransform.copyTo(_v).invert().translate(-n.x,-n.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:u,clear:!0,transform:d,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=h,t.renderTexture.bind(i,o,l),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const g=new ji(u);g.transform.worldTransform=this.transform.worldTransform,g.anchor.x=-(n.x/n.width),g.anchor.y=-(n.y/n.height),g.alpha=r,g._bounds=this._bounds,this._cacheData.sprite=g,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=g.containsPoint.bind(g)};Yt.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))};Yt.prototype._initCachedDisplayObjectCanvas=function(t){var d;if((d=this._cacheData)!=null&&d.sprite)return;const r=this.getLocalBounds(null,!0),n=this.alpha;this.alpha=1;const i=t.canvasContext.activeContext,o=t._projTransform;r.ceil(J.RESOLUTION);const l=_n.create({width:r.width,height:r.height}),h=`cacheAsBitmap_${qn()}`;this._cacheData.textureCacheId=h,gt.addToCache(l.baseTexture,h),it.addToCache(l,h);const u=_v;this.transform.localTransform.copyTo(u),u.invert(),u.tx-=r.x,u.ty-=r.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:l,clear:!0,transform:u,skipUpdateTransform:!1}),t.canvasContext.activeContext=i,t._projTransform=o,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=n;const f=new ji(l);f.transform.worldTransform=this.transform.worldTransform,f.anchor.x=-(r.x/r.width),f.anchor.y=-(r.y/r.height),f.alpha=n,f._bounds=this._bounds,this._cacheData.sprite=f,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=f.containsPoint.bind(f)};Yt.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};Yt.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};Yt.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,gt.removeFromCache(this._cacheData.textureCacheId),it.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};Yt.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)};Yt.prototype.name=null;$e.prototype.getChildByName=function(t,r){for(let n=0,i=this.children.length;n<i;n++)if(this.children[n].name===t)return this.children[n];if(r)for(let n=0,i=this.children.length;n<i;n++){const o=this.children[n];if(!o.getChildByName)continue;const l=o.getChildByName(t,!0);if(l)return l}return null};Yt.prototype.getGlobalPosition=function(t=new St,r=!1){return this.parent?this.parent.toGlobal(this.position,t,r):(t.x=this.position.x,t.y=this.position.y),t};var xM=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class bM extends Se{constructor(t=1){super(cM,xM,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const wM={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},EM=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function TM(e){const t=wM[e],r=t.length;let n=EM,i="";const o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let l;for(let h=0;h<e;h++){let u=o.replace("%index%",h.toString());l=h,h>=r&&(l=e-h-1),u=u.replace("%value%",t[l].toString()),i+=u,i+=`
`}return n=n.replace("%blur%",i),n=n.replace("%size%",e.toString()),n}const AM=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function SM(e,t){const r=Math.ceil(e/2);let n=AM,i="",o;t?o="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":o="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let l=0;l<e;l++){let h=o.replace("%index%",l.toString());h=h.replace("%sampleIndex%",`${l-(r-1)}.0`),i+=h,i+=`
`}return n=n.replace("%blur%",i),n=n.replace("%size%",e.toString()),n}class Gu extends Se{constructor(t,r=8,n=4,i=J.FILTER_RESOLUTION,o=5){const l=SM(o,t),h=TM(o);super(l,h),this.horizontal=t,this.resolution=i,this._quality=0,this.quality=n,this.blur=r}apply(t,r,n,i){if(n?this.horizontal?this.uniforms.strength=1/n.width*(n.width/r.width):this.uniforms.strength=1/n.height*(n.height/r.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/r.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/r.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,r,n,i);else{const o=t.getFilterTexture(),l=t.renderer;let h=r,u=o;this.state.blend=!1,t.applyFilter(this,h,u,Ir.CLEAR);for(let f=1;f<this.passes-1;f++){t.bindAndClear(h,Ir.BLIT),this.uniforms.uSampler=u;const d=u;u=h,h=d,l.shader.bind(this),l.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,u,n,i),t.returnFilterTexture(o)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class CM extends Se{constructor(t=8,r=4,n=Se.defaultResolution,i=5){super(),this.blurXFilter=new Gu(!0,t,r,n,i),this.blurYFilter=new Gu(!1,t,r,n,i),this.resolution=n,this.quality=r,this.blur=t,this.repeatEdgePixels=!1}apply(t,r,n,i){const o=Math.abs(this.blurXFilter.strength),l=Math.abs(this.blurYFilter.strength);if(o&&l){const h=t.getFilterTexture();this.blurXFilter.apply(t,r,h,Ir.CLEAR),this.blurYFilter.apply(t,h,n,i),t.returnFilterTexture(h)}else l?this.blurYFilter.apply(t,r,n,i):this.blurXFilter.apply(t,r,n,i)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var IM=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class Wu extends Se{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(dv,IM,t),this.alpha=1}_loadMatrix(t,r=!1){let n=t;r&&(this._multiply(n,this.uniforms.m,t),n=this._colorMatrix(n)),this.uniforms.m=n}_multiply(t,r,n){return t[0]=r[0]*n[0]+r[1]*n[5]+r[2]*n[10]+r[3]*n[15],t[1]=r[0]*n[1]+r[1]*n[6]+r[2]*n[11]+r[3]*n[16],t[2]=r[0]*n[2]+r[1]*n[7]+r[2]*n[12]+r[3]*n[17],t[3]=r[0]*n[3]+r[1]*n[8]+r[2]*n[13]+r[3]*n[18],t[4]=r[0]*n[4]+r[1]*n[9]+r[2]*n[14]+r[3]*n[19]+r[4],t[5]=r[5]*n[0]+r[6]*n[5]+r[7]*n[10]+r[8]*n[15],t[6]=r[5]*n[1]+r[6]*n[6]+r[7]*n[11]+r[8]*n[16],t[7]=r[5]*n[2]+r[6]*n[7]+r[7]*n[12]+r[8]*n[17],t[8]=r[5]*n[3]+r[6]*n[8]+r[7]*n[13]+r[8]*n[18],t[9]=r[5]*n[4]+r[6]*n[9]+r[7]*n[14]+r[8]*n[19]+r[9],t[10]=r[10]*n[0]+r[11]*n[5]+r[12]*n[10]+r[13]*n[15],t[11]=r[10]*n[1]+r[11]*n[6]+r[12]*n[11]+r[13]*n[16],t[12]=r[10]*n[2]+r[11]*n[7]+r[12]*n[12]+r[13]*n[17],t[13]=r[10]*n[3]+r[11]*n[8]+r[12]*n[13]+r[13]*n[18],t[14]=r[10]*n[4]+r[11]*n[9]+r[12]*n[14]+r[13]*n[19]+r[14],t[15]=r[15]*n[0]+r[16]*n[5]+r[17]*n[10]+r[18]*n[15],t[16]=r[15]*n[1]+r[16]*n[6]+r[17]*n[11]+r[18]*n[16],t[17]=r[15]*n[2]+r[16]*n[7]+r[17]*n[12]+r[18]*n[17],t[18]=r[15]*n[3]+r[16]*n[8]+r[17]*n[13]+r[18]*n[18],t[19]=r[15]*n[4]+r[16]*n[9]+r[17]*n[14]+r[18]*n[19]+r[19],t}_colorMatrix(t){const r=new Float32Array(t);return r[4]/=255,r[9]/=255,r[14]/=255,r[19]/=255,r}brightness(t,r){const n=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(n,r)}tint(t,r){const n=t>>16&255,i=t>>8&255,o=t&255,l=[n/255,0,0,0,0,0,i/255,0,0,0,0,0,o/255,0,0,0,0,0,1,0];this._loadMatrix(l,r)}greyscale(t,r){const n=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(n,r)}blackAndWhite(t){const r=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(r,t)}hue(t,r){t=(t||0)/180*Math.PI;const n=Math.cos(t),i=Math.sin(t),o=Math.sqrt,l=1/3,h=o(l),u=n+(1-n)*l,f=l*(1-n)-h*i,d=l*(1-n)+h*i,g=l*(1-n)+h*i,m=n+l*(1-n),v=l*(1-n)-h*i,_=l*(1-n)-h*i,w=l*(1-n)+h*i,x=n+l*(1-n),A=[u,f,d,0,0,g,m,v,0,0,_,w,x,0,0,0,0,0,1,0];this._loadMatrix(A,r)}contrast(t,r){const n=(t||0)+1,i=-.5*(n-1),o=[n,0,0,0,i,0,n,0,0,i,0,0,n,0,i,0,0,0,1,0];this._loadMatrix(o,r)}saturate(t=0,r){const n=t*2/3+1,i=(n-1)*-.5,o=[n,i,i,0,0,i,n,i,0,0,i,i,n,0,0,0,0,0,1,0];this._loadMatrix(o,r)}desaturate(){this.saturate(-1)}negative(t){const r=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(r,t)}sepia(t){const r=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(r,t)}technicolor(t){const r=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(r,t)}polaroid(t){const r=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(r,t)}toBGR(t){const r=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(r,t)}kodachrome(t){const r=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(r,t)}browni(t){const r=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(r,t)}vintage(t){const r=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(r,t)}colorTone(t,r,n,i,o){t=t||.2,r=r||.15,n=n||16770432,i=i||3375104;const l=(n>>16&255)/255,h=(n>>8&255)/255,u=(n&255)/255,f=(i>>16&255)/255,d=(i>>8&255)/255,g=(i&255)/255,m=[.3,.59,.11,0,0,l,h,u,t,0,f,d,g,r,0,l-f,h-d,u-g,0,0];this._loadMatrix(m,o)}night(t,r){t=t||.1;const n=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(n,r)}predator(t,r){const n=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(n,r)}lsd(t){const r=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(r,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}Wu.prototype.grayscale=Wu.prototype.greyscale;var PM=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,RM=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class MM extends Se{constructor(t,r){const n=new Ht;t.renderable=!1,super(RM,PM,{mapSampler:t._texture,filterMatrix:n,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=n,r==null&&(r=20),this.scale=new St(r,r)}apply(t,r,n,i){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const o=this.maskSprite.worldTransform,l=Math.sqrt(o.a*o.a+o.b*o.b),h=Math.sqrt(o.c*o.c+o.d*o.d);l!==0&&h!==0&&(this.uniforms.rotation[0]=o.a/l,this.uniforms.rotation[1]=o.b/l,this.uniforms.rotation[2]=o.c/h,this.uniforms.rotation[3]=o.d/h),t.applyFilter(this,r,n,i)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var DM=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,BM=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class OM extends Se{constructor(){super(BM,DM)}}var FM=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class LM extends Se{constructor(t=.5,r=Math.random()){super(dv,FM,{uNoise:0,uSeed:0}),this.noise=t,this.seed=r}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const hg={AlphaFilter:bM,BlurFilter:CM,BlurFilterPass:Gu,ColorMatrixFilter:Wu,DisplacementFilter:MM,FXAAFilter:OM,NoiseFilter:LM};Object.entries(hg).forEach(([e,t])=>{Object.defineProperty(hg,e,{get(){return Ct("7.1.0",`filters.${e} has moved to ${e}`),t}})});class $s{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=$s.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new St,this.page=new St,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,r,n){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,r,n,i,o){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Pa extends $s{constructor(){super(...arguments),this.client=new St,this.movement=new St,this.offset=new St,this.global=new St,this.screen=new St}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,r,n,i,o,l,h,u,f,d,g,m,v,_,w){throw new Error("Method not implemented.")}}class ur extends Pa{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class $u extends Pa{constructor(){super(...arguments),this.DOM_DELTA_LINE=0,this.DOM_DELTA_PAGE=1,this.DOM_DELTA_PIXEL=2}}const NM=2048,kM=new St,Xh=new St;class UM{constructor(t){this.dispatch=new ks,this.moveOnAll=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,r){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:r,priority:0}),this.mappingTable[t].sort((n,i)=>n.priority-i.priority)}dispatchEvent(t,r){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,r),this.dispatch.emit(r||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const r=this.mappingTable[t.type];if(r)for(let n=0,i=r.length;n<i;n++)r[n].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,r){const n=this.hitTestRecursive(this.rootTarget,this.rootTarget.interactive,kM.set(t,r),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(t,r){if(!t.target)return;const n=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let i=0,o=n.length-1;i<o;i++)if(t.currentTarget=n[i],this.notifyTarget(t,r),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,r),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let i=n.length-2;i>=0;i--)if(t.currentTarget=n[i],this.notifyTarget(t,r),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,r,n=this.rootTarget){t.eventPhase=t.BUBBLING_PHASE;const i=n.children;if(i)for(let o=0;o<i.length;o++)this.all(t,r,i[o]);t.currentTarget=n,this.notifyTarget(t,r)}propagationPath(t){const r=[t];for(let n=0;n<NM&&t!==this.rootTarget;n++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");r.push(t.parent),t=t.parent}return r.reverse(),r}hitTestRecursive(t,r,n,i,o){if(!t||!t.visible||o(t,n))return null;if(t.interactiveChildren&&t.children){const l=t.children;for(let h=l.length-1;h>=0;h--){const u=l[h],f=this.hitTestRecursive(u,r||u.interactive,n,i,o);if(f){if(f.length>0&&!f[f.length-1].parent)continue;return(f.length>0||t.interactive)&&f.push(t),f}}}return r&&i(t,n)?t.interactive?[t]:[]:null}hitPruneFn(t,r){var n;if(t.hitArea&&(t.worldTransform.applyInverse(r,Xh),!t.hitArea.contains(Xh.x,Xh.y)))return!0;if(t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;if(i&&!((n=i.containsPoint)!=null&&n.call(i,r)))return!0}return!1}hitTestFn(t,r){return t.hitArea?!0:t.containsPoint?t.containsPoint(r):!1}notifyTarget(t,r){var o,l;r=r??t.type;const n=`on${r}`;(l=(o=t.currentTarget)[n])==null||l.call(o,t);const i=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${r}capture`:r;this.notifyListeners(t,i),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,r)}mapPointerDown(t){if(!(t instanceof ur)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerdown"),r.pointerType==="touch")this.dispatchEvent(r,"touchstart");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const i=r.button===2;this.dispatchEvent(r,i?"rightdown":"mousedown")}const n=this.trackingData(t.pointerId);n.pressTargetsByButton[t.button]=r.composedPath(),this.freeEvent(r)}mapPointerMove(t){var h;if(!(t instanceof ur)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.createPointerEvent(t),n=r.pointerType==="mouse"||r.pointerType==="pen",i=this.trackingData(t.pointerId),o=this.findMountedTarget(i.overTargets);if(i.overTargets&&o!==r.target){const u=t.type==="mousemove"?"mouseout":"pointerout",f=this.createPointerEvent(t,u,o);if(this.dispatchEvent(f,"pointerout"),n&&this.dispatchEvent(f,"mouseout"),!r.composedPath().includes(o)){const d=this.createPointerEvent(t,"pointerleave",o);for(d.eventPhase=d.AT_TARGET;d.target&&!r.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),n&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(f)}if(o!==r.target){const u=t.type==="mousemove"?"mouseover":"pointerover",f=this.clonePointerEvent(r,u);this.dispatchEvent(f,"pointerover"),n&&this.dispatchEvent(f,"mouseover");let d=o==null?void 0:o.parent;for(;d&&d!==this.rootTarget.parent&&d!==r.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const m=this.clonePointerEvent(r,"pointerenter");for(m.eventPhase=m.AT_TARGET;m.target&&m.target!==o&&m.target!==this.rootTarget.parent;)m.currentTarget=m.target,this.notifyTarget(m),n&&this.notifyTarget(m,"mouseenter"),m.target=m.target.parent;this.freeEvent(m)}this.freeEvent(f)}const l=this.moveOnAll?"all":"dispatchEvent";this[l](r,"pointermove"),r.pointerType==="touch"&&this[l](r,"touchmove"),n&&(this[l](r,"mousemove"),this.cursor=(h=r.target)==null?void 0:h.cursor),i.overTargets=r.composedPath(),this.freeEvent(r)}mapPointerOver(t){var l;if(!(t instanceof ur)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.trackingData(t.pointerId),n=this.createPointerEvent(t),i=n.pointerType==="mouse"||n.pointerType==="pen";this.dispatchEvent(n,"pointerover"),i&&this.dispatchEvent(n,"mouseover"),n.pointerType==="mouse"&&(this.cursor=(l=n.target)==null?void 0:l.cursor);const o=this.clonePointerEvent(n,"pointerenter");for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),i&&this.notifyTarget(o,"mouseenter"),o.target=o.target.parent;r.overTargets=n.composedPath(),this.freeEvent(n),this.freeEvent(o)}mapPointerOut(t){if(!(t instanceof ur)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.trackingData(t.pointerId);if(r.overTargets){const n=t.pointerType==="mouse"||t.pointerType==="pen",i=this.findMountedTarget(r.overTargets),o=this.createPointerEvent(t,"pointerout",i);this.dispatchEvent(o),n&&this.dispatchEvent(o,"mouseout");const l=this.createPointerEvent(t,"pointerleave",i);for(l.eventPhase=l.AT_TARGET;l.target&&l.target!==this.rootTarget.parent;)l.currentTarget=l.target,this.notifyTarget(l),n&&this.notifyTarget(l,"mouseleave"),l.target=l.target.parent;r.overTargets=null,this.freeEvent(o),this.freeEvent(l)}this.cursor=null}mapPointerUp(t){if(!(t instanceof ur)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=performance.now(),n=this.createPointerEvent(t);if(this.dispatchEvent(n,"pointerup"),n.pointerType==="touch")this.dispatchEvent(n,"touchend");else if(n.pointerType==="mouse"||n.pointerType==="pen"){const h=n.button===2;this.dispatchEvent(n,h?"rightup":"mouseup")}const i=this.trackingData(t.pointerId),o=this.findMountedTarget(i.pressTargetsByButton[t.button]);let l=o;if(o&&!n.composedPath().includes(o)){let h=o;for(;h&&!n.composedPath().includes(h);){if(n.currentTarget=h,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch")this.notifyTarget(n,"touchendoutside");else if(n.pointerType==="mouse"||n.pointerType==="pen"){const u=n.button===2;this.notifyTarget(n,u?"rightupoutside":"mouseupoutside")}h=h.parent}delete i.pressTargetsByButton[t.button],l=h}if(l){const h=this.clonePointerEvent(n,"click");h.target=l,h.path=null,i.clicksByButton[t.button]||(i.clicksByButton[t.button]={clickCount:0,target:h.target,timeStamp:r});const u=i.clicksByButton[t.button];u.target===h.target&&r-u.timeStamp<200?++u.clickCount:u.clickCount=1,u.target=h.target,u.timeStamp=r,h.detail=u.clickCount,h.pointerType==="mouse"?this.dispatchEvent(h,"click"):h.pointerType==="touch"&&this.dispatchEvent(h,"tap"),this.dispatchEvent(h,"pointertap"),this.freeEvent(h)}this.freeEvent(n)}mapPointerUpOutside(t){if(!(t instanceof ur)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.trackingData(t.pointerId),n=this.findMountedTarget(r.pressTargetsByButton[t.button]),i=this.createPointerEvent(t);if(n){let o=n;for(;o;)i.currentTarget=o,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch"?this.notifyTarget(i,"touchendoutside"):(i.pointerType==="mouse"||i.pointerType==="pen")&&this.notifyTarget(i,i.button===2?"rightupoutside":"mouseupoutside"),o=o.parent;delete r.pressTargetsByButton[t.button]}this.freeEvent(i)}mapWheel(t){if(!(t instanceof $u)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const r=this.createWheelEvent(t);this.dispatchEvent(r),this.freeEvent(r)}findMountedTarget(t){if(!t)return null;let r=t[0];for(let n=1;n<t.length&&t[n].parent===r;n++)r=t[n];return r}createPointerEvent(t,r,n){const i=this.allocateEvent(ur);return this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.nativeEvent=t.nativeEvent,i.originalEvent=t,i.target=n??this.hitTest(i.global.x,i.global.y),typeof r=="string"&&(i.type=r),i}createWheelEvent(t){const r=this.allocateEvent($u);return this.copyWheelData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t,r.target=this.hitTest(r.global.x,r.global.y),r}clonePointerEvent(t,r){const n=this.allocateEvent(ur);return n.nativeEvent=t.nativeEvent,n.originalEvent=t.originalEvent,this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.target=t.target,n.path=t.composedPath().slice(),n.type=r??n.type,n}copyWheelData(t,r){r.deltaMode=t.deltaMode,r.deltaX=t.deltaX,r.deltaY=t.deltaY,r.deltaZ=t.deltaZ}copyPointerData(t,r){t instanceof ur&&r instanceof ur&&(r.pointerId=t.pointerId,r.width=t.width,r.height=t.height,r.isPrimary=t.isPrimary,r.pointerType=t.pointerType,r.pressure=t.pressure,r.tangentialPressure=t.tangentialPressure,r.tiltX=t.tiltX,r.tiltY=t.tiltY,r.twist=t.twist)}copyMouseData(t,r){t instanceof Pa&&r instanceof Pa&&(r.altKey=t.altKey,r.button=t.button,r.buttons=t.buttons,r.client.copyFrom(t.client),r.ctrlKey=t.ctrlKey,r.metaKey=t.metaKey,r.movement.copyFrom(t.movement),r.screen.copyFrom(t.screen),r.global.copyFrom(t.global))}copyData(t,r){r.isTrusted=t.isTrusted,r.srcElement=t.srcElement,r.timeStamp=performance.now(),r.type=t.type,r.detail=t.detail,r.view=t.view,r.which=t.which,r.layer.copyFrom(t.layer),r.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const r=this.eventPool.get(t).pop()||new t(this);return r.eventPhase=r.NONE,r.currentTarget=null,r.path=null,r.target=null,r}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const r=t.constructor;this.eventPool.has(r)||this.eventPool.set(r,[]),this.eventPool.get(r).push(t)}notifyListeners(t,r){const n=t.currentTarget._events[r];if(n)if("fn"in n)n.fn.call(n.context,t);else for(let i=0,o=n.length;i<o&&!t.propagationImmediatelyStopped;i++)n[i].fn.call(n[i].context,t)}}const GM=1,WM={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class xv{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new UM(null),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new ur(null),this.rootWheelEvent=new $u(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}init(){const{view:t,resolution:r}=this.renderer;this.setTargetElement(t),this.resolution=r}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let r=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(r=!1),this.currentCursor===t)return;this.currentCursor=t;const n=this.cursorStyles[t];if(n)switch(typeof n){case"string":r&&(this.domElement.style.cursor=n);break;case"function":n(t);break;case"object":r&&Object.assign(this.domElement.style,n);break}else r&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}onPointerDown(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const r=this.normalizeToPointerData(t);this.autoPreventDefault&&r[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let n=0,i=r.length;n<i;n++){const o=r[n],l=this.bootstrapEvent(this.rootPointerEvent,o);this.rootBoundary.mapEvent(l)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const r=this.normalizeToPointerData(t);for(let n=0,i=r.length;n<i;n++){const o=this.bootstrapEvent(this.rootPointerEvent,r[n]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;let r=t.target;t.composedPath&&t.composedPath().length>0&&(r=t.composedPath()[0]);const n=r!==this.domElement?"outside":"",i=this.normalizeToPointerData(t);for(let o=0,l=i.length;o<l;o++){const h=this.bootstrapEvent(this.rootPointerEvent,i[o]);h.type+=n,this.rootBoundary.mapEvent(h)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const r=this.normalizeToPointerData(t);for(let n=0,i=r.length;n<i;n++){const o=this.bootstrapEvent(this.rootPointerEvent,r[n]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){const r=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(r)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,r,n){let i;this.domElement.parentElement?i=this.domElement.getBoundingClientRect():i={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const o=1/this.resolution;t.x=(r-i.left)*(this.domElement.width/i.width)*o,t.y=(n-i.top)*(this.domElement.height/i.height)*o}normalizeToPointerData(t){const r=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let n=0,i=t.changedTouches.length;n<i;n++){const o=t.changedTouches[n];typeof o.button>"u"&&(o.button=0),typeof o.buttons>"u"&&(o.buttons=1),typeof o.isPrimary>"u"&&(o.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof o.width>"u"&&(o.width=o.radiusX||1),typeof o.height>"u"&&(o.height=o.radiusY||1),typeof o.tiltX>"u"&&(o.tiltX=0),typeof o.tiltY>"u"&&(o.tiltY=0),typeof o.pointerType>"u"&&(o.pointerType="touch"),typeof o.pointerId>"u"&&(o.pointerId=o.identifier||0),typeof o.pressure>"u"&&(o.pressure=o.force||.5),typeof o.twist>"u"&&(o.twist=0),typeof o.tangentialPressure>"u"&&(o.tangentialPressure=0),typeof o.layerX>"u"&&(o.layerX=o.offsetX=o.clientX),typeof o.layerY>"u"&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,o.type=t.type,r.push(o)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const n=t;typeof n.isPrimary>"u"&&(n.isPrimary=!0),typeof n.width>"u"&&(n.width=1),typeof n.height>"u"&&(n.height=1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="mouse"),typeof n.pointerId>"u"&&(n.pointerId=GM),typeof n.pressure>"u"&&(n.pressure=.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),n.isNormalized=!0,r.push(n)}else r.push(t);return r}normalizeWheelEvent(t){const r=this.rootWheelEvent;return this.transferMouseData(r,t),r.deltaX=t.deltaX,r.deltaY=t.deltaY,r.deltaZ=t.deltaZ,r.deltaMode=t.deltaMode,this.mapPositionToPoint(r.screen,t.clientX,t.clientY),r.global.copyFrom(r.screen),r.offset.copyFrom(r.screen),r.nativeEvent=t,r.type=t.type,r}bootstrapEvent(t,r){return t.originalEvent=null,t.nativeEvent=r,t.pointerId=r.pointerId,t.width=r.width,t.height=r.height,t.isPrimary=r.isPrimary,t.pointerType=r.pointerType,t.pressure=r.pressure,t.tangentialPressure=r.tangentialPressure,t.tiltX=r.tiltX,t.tiltY=r.tiltY,t.twist=r.twist,this.transferMouseData(t,r),this.mapPositionToPoint(t.screen,r.clientX,r.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=r.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=WM[t.type]||t.type),t}transferMouseData(t,r){t.isTrusted=r.isTrusted,t.srcElement=r.srcElement,t.timeStamp=performance.now(),t.type=r.type,t.altKey=r.altKey,t.button=r.button,t.buttons=r.buttons,t.client.x=r.clientX,t.client.y=r.clientY,t.ctrlKey=r.ctrlKey,t.metaKey=r.metaKey,t.movement.x=r.movementX,t.movement.y=r.movementY,t.page.x=r.pageX,t.page.y=r.pageY,t.relatedTarget=null,t.shiftKey=r.shiftKey}}xv.extension={name:"events",type:[Z.RendererSystem,Z.CanvasRendererSystem]};st.add(xv);const $M={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,ontouchstart:null,onwheel:null,interactive:!1,interactiveChildren:!0,hitArea:null,addEventListener(e,t,r){const n=typeof r=="boolean"&&r||typeof r=="object"&&r.capture,i=typeof t=="function"?void 0:t;e=n?`${e}capture`:e,t=typeof t=="function"?t:t.handleEvent,this.on(e,t,i)},removeEventListener(e,t,r){const n=typeof r=="boolean"&&r||typeof r=="object"&&r.capture,i=typeof t=="function"?void 0:t;e=n?`${e}capture`:e,t=typeof t=="function"?t:t.handleEvent,this.off(e,t,i)},dispatchEvent(e){if(!(e instanceof $s))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return e.defaultPrevented=!1,e.path=null,e.target=this,e.manager.dispatchEvent(e),!e.defaultPrevented}};Yt.mixin($M);const HM={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Yt.mixin(HM);const zM=9,qo=100,XM=0,VM=0,ug=2,cg=1,YM=-1e3,jM=-1e3,qM=2;class bv{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(jr.tablet||jr.phone)&&this.createTouchHook();const r=document.createElement("div");r.style.width=`${qo}px`,r.style.height=`${qo}px`,r.style.position="absolute",r.style.top=`${XM}px`,r.style.left=`${VM}px`,r.style.zIndex=ug.toString(),this.div=r,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${cg}px`,t.style.height=`${cg}px`,t.style.position="absolute",t.style.top=`${YM}px`,t.style.left=`${jM}px`,t.style.zIndex=qM.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const r=t.children;if(r)for(let n=0;n<r.length;n++)this.updateAccessibleObjects(r[n])}update(){const t=performance.now();if(jr.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:r,y:n,width:i,height:o}=this.renderer.view.getBoundingClientRect(),{width:l,height:h,resolution:u}=this.renderer,f=i/l*u,d=o/h*u;let g=this.div;g.style.left=`${r}px`,g.style.top=`${n}px`,g.style.width=`${l}px`,g.style.height=`${h}px`;for(let m=0;m<this.children.length;m++){const v=this.children[m];if(v.renderId!==this.renderId)v._accessibleActive=!1,Bi(this.children,m,1),this.div.removeChild(v._accessibleDiv),this.pool.push(v._accessibleDiv),v._accessibleDiv=null,m--;else{g=v._accessibleDiv;let _=v.hitArea;const w=v.worldTransform;v.hitArea?(g.style.left=`${(w.tx+_.x*w.a)*f}px`,g.style.top=`${(w.ty+_.y*w.d)*d}px`,g.style.width=`${_.width*w.a*f}px`,g.style.height=`${_.height*w.d*d}px`):(_=v.getBounds(),this.capHitArea(_),g.style.left=`${_.x*f}px`,g.style.top=`${_.y*d}px`,g.style.width=`${_.width*f}px`,g.style.height=`${_.height*d}px`,g.title!==v.accessibleTitle&&v.accessibleTitle!==null&&(g.title=v.accessibleTitle),g.getAttribute("aria-label")!==v.accessibleHint&&v.accessibleHint!==null&&g.setAttribute("aria-label",v.accessibleHint)),(v.accessibleTitle!==g.title||v.tabIndex!==g.tabIndex)&&(g.title=v.accessibleTitle,g.tabIndex=v.tabIndex,this.debug&&this.updateDebugHTML(g))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:r,height:n}=this.renderer;t.x+t.width>r&&(t.width=r-t.x),t.y+t.height>n&&(t.height=n-t.y)}addChild(t){let r=this.pool.pop();r||(r=document.createElement("button"),r.style.width=`${qo}px`,r.style.height=`${qo}px`,r.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",r.style.position="absolute",r.style.zIndex=ug.toString(),r.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?r.setAttribute("aria-live","off"):r.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?r.setAttribute("aria-relevant","additions"):r.setAttribute("aria-relevant","text"),r.addEventListener("click",this._onClick.bind(this)),r.addEventListener("focus",this._onFocus.bind(this)),r.addEventListener("focusout",this._onFocusOut.bind(this))),r.style.pointerEvents=t.accessiblePointerEvents,r.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?r.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(r.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&r.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(r),t._accessibleActive=!0,t._accessibleDiv=r,r.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,r){const{displayObject:n}=t.target,i=this.renderer.events.rootBoundary,o=Object.assign(new $s(i),{target:n});i.rootTarget=this.renderer.lastObjectRendered,r.forEach(l=>i.dispatchEvent(o,l))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===zM&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}bv.extension={name:"accessibility",type:[Z.RendererPlugin,Z.CanvasRendererPlugin]};st.add(bv);const Hu=class{constructor(e){this.stage=new $e,e=Object.assign({forceCanvas:!1},e),this.renderer=lM(e),Hu._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(e,t){const r=Hu._plugins.slice(0);r.reverse(),r.forEach(n=>{n.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};let yc=Hu;yc._plugins=[];st.handleByList(Z.Application,yc._plugins);class wv{static init(t){Object.defineProperty(this,"resizeTo",{set(r){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=r,r&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let r,n;if(this._resizeTo===globalThis.window)r=globalThis.innerWidth,n=globalThis.innerHeight;else{const{clientWidth:i,clientHeight:o}=this._resizeTo;r=i,n=o}this.renderer.resize(r,n),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}wv.extension=Z.Application;st.add(wv);const fg={loader:Z.LoadParser,resolver:Z.ResolveParser,cache:Z.CacheParser,detection:Z.DetectionParser};st.handle(Z.Asset,e=>{const t=e.ref;Object.entries(fg).filter(([r])=>!!t[r]).forEach(([r,n])=>st.add(Object.assign(t[r],{extension:t[r].extension??n})))},e=>{const t=e.ref;Object.keys(fg).filter(r=>!!t[r]).forEach(r=>st.remove(t[r]))});class KM{constructor(t,r=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=r}add(t){t.forEach(r=>{this._assetList.push(r)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],r=Math.min(this._assetList.length,this._maxConcurrent);for(let n=0;n<r;n++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Ev(e,t){if(Array.isArray(t)){for(const r of t)if(e.startsWith(`data:${r}`))return!0;return!1}return e.startsWith(`data:${t}`)}function Xa(e,t){const r=e.split("?")[0],n=ve.extname(r).toLowerCase();return Array.isArray(t)?t.includes(n):n===t}const qr=(e,t)=>(Array.isArray(e)||(e=[e]),t?e.map(r=>typeof r=="string"?t(r):r):e);function Tv(e,t,r,n,i){const o=t[r];for(let l=0;l<o.length;l++){const h=o[l];r<t.length-1?Tv(e.replace(n[r],h),t,r+1,n,i):i.push(e.replace(n[r],h))}}function ZM(e){const t=/\{(.*?)\}/g,r=e.match(t),n=[];if(r){const i=[];r.forEach(o=>{const l=o.substring(1,o.length-1).split(",");i.push(l)}),Tv(e,i,0,r,n)}else n.push(e);return n}const Ra=e=>!Array.isArray(e);class JM{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const r=this._cache.get(t);return r||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),r}set(t,r){const n=qr(t);let i;for(let h=0;h<this.parsers.length;h++){const u=this.parsers[h];if(u.test(r)){i=u.getCacheableAssets(n,r);break}}i||(i={},n.forEach(h=>{i[h]=r}));const o=Object.keys(i),l={cacheKeys:o,keys:n};if(n.forEach(h=>{this._cacheMap.set(h,l)}),o.forEach(h=>{this._cache.has(h)&&this._cache.get(h)!==r&&console.warn("[Cache] already has key:",h),this._cache.set(h,i[h])}),r instanceof it){const h=r;n.forEach(u=>{h.baseTexture!==it.EMPTY.baseTexture&&gt.addToCache(h.baseTexture,u),it.addToCache(h,u)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const r=this._cacheMap.get(t);r.cacheKeys.forEach(i=>{this._cache.delete(i)}),r.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}}const xs=new JM;class QM{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(t,r){const n={promise:null,parser:null};return n.promise=(async()=>{var o,l;let i=null;for(let h=0;h<this.parsers.length;h++){const u=this.parsers[h];if(u.load&&((o=u.test)!=null&&o.call(u,t,r,this))){i=await u.load(t,r,this),n.parser=u;break}}if(!n.parser)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has being added`),null;for(let h=0;h<this.parsers.length;h++){const u=this.parsers[h];u.parse&&u.parse&&await((l=u.testParse)==null?void 0:l.call(u,i,r,this))&&(i=await u.parse(i,r,this)||i,n.parser=u)}return i})(),n}async load(t,r){let n=0;const i={},o=Ra(t),l=qr(t,f=>({src:f})),h=l.length,u=l.map(async f=>{const d=ve.toAbsolute(f.src);if(!i[f.src])try{this.promiseCache[d]||(this.promiseCache[d]=this._getLoadPromiseAndParser(d,f)),i[f.src]=await this.promiseCache[d].promise,r&&r(++n/h)}catch(g){throw delete this.promiseCache[d],delete i[f.src],new Error(`[Loader.load] Failed to load ${d}.
${g}`)}});return await Promise.all(u),o?i[l[0].src]:i}async unload(t){const n=qr(t,i=>({src:i})).map(async i=>{var h,u;const o=ve.toAbsolute(i.src),l=this.promiseCache[o];if(l){const f=await l.promise;(u=(h=l.parser)==null?void 0:h.unload)==null||u.call(h,f,i,this),delete this.promiseCache[o]}});await Promise.all(n)}get parsers(){return this._parsers}}var Fr=(e=>(e[e.Low=0]="Low",e[e.Normal=1]="Normal",e[e.High=2]="High",e))(Fr||{});const tD={extension:{type:Z.LoadParser,priority:Fr.Low},test(e){return ve.extname(e).toLowerCase()===".json"},async load(e){return await(await J.ADAPTER.fetch(e)).json()}};st.add(tD);const eD={extension:{type:Z.LoadParser,priority:Fr.Low},test(e){return ve.extname(e).toLowerCase()===".txt"},async load(e){return await(await J.ADAPTER.fetch(e)).text()}};st.add(eD);const rD=["normal","bold","100","200","300","400","500","600","700","800","900"],nD=[".ttf",".otf",".woff",".woff2"],iD=["font/ttf","font/otf","font/woff","font/woff2"];function sD(e){const t=ve.extname(e);return ve.basename(e,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ")}const oD={extension:{type:Z.LoadParser,priority:Fr.Low},test(e){return Ev(e,iD)||Xa(e,nD)},async load(e,t){var n,i,o;if(!globalThis.navigator.onLine)throw new Error("[loadWebFont] Cannot load font - navigator is offline");const r=J.ADAPTER.getFontFaceSet();if(r){const l=[],h=((n=t.data)==null?void 0:n.family)??sD(e),u=((o=(i=t.data)==null?void 0:i.weights)==null?void 0:o.filter(d=>rD.includes(d)))??["normal"],f=t.data??{};for(let d=0;d<u.length;d++){const g=u[d],m=new FontFace(h,`url(${encodeURI(e)})`,{...f,weight:g});await m.load(),r.add(m),l.push(m)}return l.length===1?l[0]:l}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach(t=>J.ADAPTER.getFontFaceSet().delete(t))}};st.add(oD);let dg=0,Vh;const aD="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",lD={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${aD}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},hD={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let Yh;class uD{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const r=URL.createObjectURL(new Blob([lD.code],{type:"application/javascript"})),n=new Worker(r);n.addEventListener("message",i=>{n.terminate(),URL.revokeObjectURL(r),t(i.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){Vh===void 0&&(Vh=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Vh&&(Yh||(Yh=URL.createObjectURL(new Blob([hD.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Yh),t.addEventListener("message",r=>{this.complete(r.data),this.returnWorker(r.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,r){await this._initWorkers();const n=new Promise((i,o)=>{this.queue.push({id:t,arguments:r,resolve:i,reject:o})});return this.next(),n}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const r=this.queue.pop(),n=r.id;this.resolveHash[dg]={resolve:r.resolve,reject:r.reject},t.postMessage({data:r.arguments,uuid:dg++,id:n})}}const pg=new uD;function Va(e,t,r){const n=new it(e);return n.baseTexture.on("dispose",()=>{delete t.promiseCache[r]}),n}const cD=[".jpeg",".jpg",".png",".webp",".avif"],fD=["image/jpeg","image/png","image/webp","image/avif"];async function dD(e){const t=await J.ADAPTER.fetch(e);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${t.status} ${t.statusText}`);const r=await t.blob();return await createImageBitmap(r)}const Ls={extension:{type:Z.LoadParser,priority:Fr.High},config:{preferWorkers:!0},test(e){return Ev(e,fD)||Xa(e,cD)},async load(e,t,r){let n=null;globalThis.createImageBitmap?this.config.preferWorkers&&await pg.isImageBitmapSupported()?n=await pg.loadImageBitmap(e):n=await dD(e):n=await new Promise(o=>{n=new Image,n.crossOrigin="anonymous",n.src=e,n.complete?o(n):n.onload=()=>{o(n)}});const i=new gt(n,{resolution:mn(e),...t.data});return i.resource.src=e,Va(i,r,e)},unload(e){e.destroy(!0)}};st.add(Ls);const pD={extension:{type:Z.LoadParser,priority:Fr.High},test(e){return ve.extname(e).toLowerCase()===".svg"},async testParse(e){return Fs.test(e)},async parse(e,t,r){var l,h,u;const n=new Fs(e,(l=t==null?void 0:t.data)==null?void 0:l.resourceOptions),i=new gt(n,{resolution:mn(e),...t==null?void 0:t.data});i.resource.src=e;const o=Va(i,r,e);return(u=(h=t==null?void 0:t.data)==null?void 0:h.resourceOptions)!=null&&u.autoLoad||await n.load(),o},async load(e,t){return(await J.ADAPTER.fetch(e)).text()},unload:Ls.unload};st.add(pD);class gD{constructor(){this._bundleIdConnector="-",this._createBundleAssetId=(t,r)=>`${t}${this._bundleIdConnector}${r}`,this._extractAssetIdFromBundle=(t,r)=>r.replace(`${t}${this._bundleIdConnector}`,""),this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(r=>{this._preferredOrder.push(r),r.priority||(r.priority=Object.keys(r.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this._preferredOrder=[],this._resolverHash={},this._assetMap={},this._rootPath=null,this._basePath=null,this._manifest=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const r=t;this._defaultSearchParams=Object.keys(r).map(n=>`${encodeURIComponent(n)}=${encodeURIComponent(r[n])}`).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(r=>{this.addBundle(r.name,r.assets)})}addBundle(t,r){const n=[];Array.isArray(r)?r.forEach(i=>{if(typeof i.name=="string"){const o=this._createBundleAssetId(t,i.name);n.push(o),this.add([i.name,o],i.srcs)}else{const o=i.name.map(l=>this._createBundleAssetId(t,l));o.forEach(l=>{n.push(l)}),this.add([...i.name,...o],i.srcs)}}):Object.keys(r).forEach(i=>{n.push(this._createBundleAssetId(t,i)),this.add([i,this._createBundleAssetId(t,i)],r[i])}),this._bundles[t]=n}add(t,r,n){const i=qr(t);i.forEach(l=>{this._assetMap[l]&&console.warn(`[Resolver] already has key: ${l} overwriting`)}),Array.isArray(r)||(typeof r=="string"?r=ZM(r):r=[r]);const o=r.map(l=>{let h=l;if(typeof l=="string"){let u=!1;for(let f=0;f<this._parsers.length;f++){const d=this._parsers[f];if(d.test(l)){h=d.parse(l),u=!0;break}}u||(h={src:l})}return h.format||(h.format=h.src.split(".").pop()),h.alias||(h.alias=i),(this._basePath||this._rootPath)&&(h.src=ve.toAbsolute(h.src,this._basePath,this._rootPath)),h.src=this._appendDefaultSearchParams(h.src),h.data=h.data??n,h});i.forEach(l=>{this._assetMap[l]=o})}resolveBundle(t){const r=Ra(t);t=qr(t);const n={};return t.forEach(i=>{const o=this._bundles[i];if(o){const l=this.resolve(o),h={};for(const u in l){const f=l[u];h[this._extractAssetIdFromBundle(i,u)]=f}n[i]=h}}),r?n[t[0]]:n}resolveUrl(t){const r=this.resolve(t);if(typeof t!="string"){const n={};for(const i in r)n[i]=r[i].src;return n}return r.src}resolve(t){const r=Ra(t);t=qr(t);const n={};return t.forEach(i=>{if(!this._resolverHash[i])if(this._assetMap[i]){let o=this._assetMap[i];const l=this._getPreferredOrder(o),h=o[0];l==null||l.priority.forEach(u=>{l.params[u].forEach(f=>{const d=o.filter(g=>g[u]?g[u]===f:!1);d.length&&(o=d)})}),this._resolverHash[i]=o[0]??h}else{let o=i;(this._basePath||this._rootPath)&&(o=ve.toAbsolute(o,this._basePath,this._rootPath)),o=this._appendDefaultSearchParams(o),this._resolverHash[i]={src:o}}n[i]=this._resolverHash[i]}),r?n[t[0]]:n}_getPreferredOrder(t){for(let r=0;r<t.length;r++){const n=t[0],i=this._preferredOrder.find(o=>o.params.format.includes(n.format));if(i)return i}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const r=/\?/.test(t)?"&":"?";return`${t}${r}${this._defaultSearchParams}`}}class mD{constructor(){this._detections=[],this._initialized=!1,this.resolver=new gD,this.loader=new QM,this.cache=xs,this._backgroundLoader=new KM(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var o,l,h;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let u=t.manifest;typeof u=="string"&&(u=await this.load(u)),this.resolver.addManifest(u)}const r=((o=t.texturePreference)==null?void 0:o.resolution)??1,n=typeof r=="number"?[r]:r;let i=[];if((l=t.texturePreference)!=null&&l.format){const u=(h=t.texturePreference)==null?void 0:h.format;i=typeof u=="string"?[u]:u;for(const f of this._detections)await f.test()||(i=await f.remove(i))}else for(const u of this._detections)await u.test()&&(i=await u.add(i));this.resolver.prefer({params:{format:i,resolution:n}})}add(t,r,n){this.resolver.add(t,r,n)}async load(t,r){this._initialized||await this.init();const n=Ra(t),i=qr(t).map(h=>typeof h!="string"?(this.resolver.add(h.src,h),h.src):h),o=this.resolver.resolve(i),l=await this._mapLoadToResolve(o,r);return n?l[i[0]]:l}addBundle(t,r){this.resolver.addBundle(t,r)}async loadBundle(t,r){this._initialized||await this.init();let n=!1;typeof t=="string"&&(n=!0,t=[t]);const i=this.resolver.resolveBundle(t),o={},l=Object.keys(i);let h=0,u=0;const f=()=>{r==null||r(++h/u)},d=l.map(g=>{const m=i[g];return u+=Object.keys(m).length,this._mapLoadToResolve(m,f).then(v=>{o[g]=v})});return await Promise.all(d),n?o[t[0]]:o}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const r=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(r))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const r=this.resolver.resolveBundle(t);Object.values(r).forEach(n=>{this._backgroundLoader.add(Object.values(n))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return xs.get(t);const r={};for(let n=0;n<t.length;n++)r[n]=xs.get(t[n]);return r}async _mapLoadToResolve(t,r){const n=Object.values(t),i=Object.keys(t);this._backgroundLoader.active=!1;const o=await this.loader.load(n,r);this._backgroundLoader.active=!0;const l={};return n.forEach((h,u)=>{const f=o[h.src],d=[h.src];h.alias&&d.push(...h.alias),l[i[u]]=f,xs.set(d,f)}),l}async unload(t){this._initialized||await this.init();const r=qr(t).map(i=>typeof i!="string"?i.src:i),n=this.resolver.resolve(r);await this._unloadFromResolved(n)}async unloadBundle(t){this._initialized||await this.init(),t=qr(t);const r=this.resolver.resolveBundle(t),n=Object.keys(r).map(i=>this._unloadFromResolved(r[i]));await Promise.all(n)}async _unloadFromResolved(t){const r=Object.values(t);r.forEach(n=>{xs.remove(n.src)}),await this.loader.unload(r)}get detections(){return this._detections}get preferWorkers(){return Ls.config.preferWorkers}set preferWorkers(t){Ls.config.preferWorkers=t}}const $n=new mD;st.handleByList(Z.LoadParser,$n.loader.parsers).handleByList(Z.ResolveParser,$n.resolver.parsers).handleByList(Z.CacheParser,$n.cache.parsers).handleByList(Z.DetectionParser,$n.detections);const vD={extension:Z.CacheParser,test:e=>Array.isArray(e)&&e.every(t=>t instanceof it),getCacheableAssets:(e,t)=>{const r={};return e.forEach(n=>{t.forEach((i,o)=>{r[n+(o===0?"":o+1)]=i})}),r}};st.add(vD);const yD={extension:{type:Z.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await J.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then(r=>r.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"avif"],remove:async e=>e.filter(t=>t!=="avif")};st.add(yD);const _D={extension:{type:Z.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await J.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then(r=>r.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"webp"],remove:async e=>e.filter(t=>t!=="webp")};st.add(_D);const gg=["png","jpg","jpeg"],xD={extension:{type:Z.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...gg],remove:async e=>e.filter(t=>!gg.includes(t))};st.add(xD);const bD={extension:Z.ResolveParser,test:Ls.test,parse:e=>{var t;return{resolution:parseFloat(((t=J.RETINA_PREFIX.exec(e))==null?void 0:t[1])??"1"),format:e.split(".").pop(),src:e}}};st.add(bD);var We=(e=>(e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e))(We||{});const Ma={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let Vr,Ti;function mg(){Ti={s3tc:Vr.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Vr.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Vr.getExtension("WEBGL_compressed_texture_etc"),etc1:Vr.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Vr.getExtension("WEBGL_compressed_texture_pvrtc")||Vr.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Vr.getExtension("WEBGL_compressed_texture_atc"),astc:Vr.getExtension("WEBGL_compressed_texture_astc")}}const wD={extension:{type:Z.DetectionParser,priority:2},test:async()=>{const t=J.ADAPTER.createCanvas().getContext("webgl");return t?(Vr=t,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async e=>{Ti||mg();const t=[];for(const r in Ti)Ti[r]&&t.push(r);return[...t,...e]},remove:async e=>(Ti||mg(),e.filter(t=>!(t in Ti)))};st.add(wD);class ED extends Ws{constructor(t,r={width:1,height:1,autoLoad:!0}){let n,i;typeof t=="string"?(n=t,i=new Uint8Array):(n=null,i=t),super(i,r),this.origin=n,this.buffer=i?new Ru(i):null,this.origin&&r.autoLoad!==!1&&this.load(),i!=null&&i.length&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}async load(){const n=await(await(await fetch(this.origin)).blob()).arrayBuffer();return this.data=new Uint32Array(n),this.buffer=new Ru(n),this.loaded=!0,this.onBlobLoaded(n),this.update(),this}}class Yn extends ED{constructor(t,r){super(t,r),this.format=r.format,this.levels=r.levels||1,this._width=r.width,this._height=r.height,this._extension=Yn._formatToExtension(this.format),(r.levelBuffers||this.buffer)&&(this._levelBuffers=r.levelBuffers||Yn._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,r,n){const i=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let l=0,h=this.levels;l<h;l++){const{levelID:u,levelWidth:f,levelHeight:d,levelBuffer:g}=this._levelBuffers[l];i.compressedTexImage2D(i.TEXTURE_2D,u,this.format,f,d,0,g)}return!0}onBlobLoaded(){this._levelBuffers=Yn._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,r,n,i,o,l,h){const u=new Array(n);let f=t.byteOffset,d=l,g=h,m=d+i-1&~(i-1),v=g+o-1&~(o-1),_=m*v*Ma[r];for(let w=0;w<n;w++)u[w]={levelID:w,levelWidth:n>1?d:m,levelHeight:n>1?g:v,levelBuffer:new Uint8Array(t.buffer,f,_)},f+=_,d=d>>1||1,g=g>>1||1,m=d+i-1&~(i-1),v=g+o-1&~(o-1),_=m*v*Ma[r];return u}}const jh=4,Ko=124,TD=32,vg=20,AD=542327876,Zo={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},SD={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},Jo={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},CD=1,ID=2,PD=4,RD=64,MD=512,DD=131072,BD=827611204,OD=861165636,FD=894720068,LD=808540228,ND=4,kD={[BD]:We.COMPRESSED_RGBA_S3TC_DXT1_EXT,[OD]:We.COMPRESSED_RGBA_S3TC_DXT3_EXT,[FD]:We.COMPRESSED_RGBA_S3TC_DXT5_EXT},UD={70:We.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:We.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:We.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:We.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:We.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:We.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:We.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:We.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:We.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function GD(e){const t=new Uint32Array(e);if(t[0]!==AD)throw new Error("Invalid DDS file magic word");const n=new Uint32Array(e,0,Ko/Uint32Array.BYTES_PER_ELEMENT),i=n[Zo.HEIGHT],o=n[Zo.WIDTH],l=n[Zo.MIPMAP_COUNT],h=new Uint32Array(e,Zo.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,TD/Uint32Array.BYTES_PER_ELEMENT),u=h[CD];if(u&PD){const f=h[SD.FOURCC];if(f!==LD){const E=kD[f],I=jh+Ko,D=new Uint8Array(e,I);return[new Yn(D,{format:E,width:o,height:i,levels:l})]}const d=jh+Ko,g=new Uint32Array(t.buffer,d,vg/Uint32Array.BYTES_PER_ELEMENT),m=g[Jo.DXGI_FORMAT],v=g[Jo.RESOURCE_DIMENSION],_=g[Jo.MISC_FLAG],w=g[Jo.ARRAY_SIZE],x=UD[m];if(x===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${m}`);if(_===ND)throw new Error("DDSParser does not support cubemap textures");if(v===6)throw new Error("DDSParser does not supported 3D texture data");const A=new Array,S=jh+Ko+vg;if(w===1)A.push(new Uint8Array(e,S));else{const E=Ma[x];let I=0,D=o,L=i;for(let F=0;F<l;F++){const z=Math.max(1,D+3&-4),j=Math.max(1,L+3&-4),X=z*j*E;I+=X,D=D>>>1,L=L>>>1}let O=S;for(let F=0;F<w;F++)A.push(new Uint8Array(e,O,I)),O+=I}return A.map(E=>new Yn(E,{format:x,width:o,height:i,levels:l}))}throw u&RD?new Error("DDSParser does not support uncompressed texture data."):u&MD?new Error("DDSParser does not supported YUV uncompressed texture data."):u&DD?new Error("DDSParser does not support single-channel (lumninance) texture data!"):u&ID?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const yg=[171,75,84,88,32,49,49,187,13,10,26,10],WD=67305985,lr={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},zu=64,_g={[ot.UNSIGNED_BYTE]:1,[ot.UNSIGNED_SHORT]:2,[ot.INT]:4,[ot.UNSIGNED_INT]:4,[ot.FLOAT]:4,[ot.HALF_FLOAT]:8},$D={[V.RGBA]:4,[V.RGB]:3,[V.RG]:2,[V.RED]:1,[V.LUMINANCE]:1,[V.LUMINANCE_ALPHA]:2,[V.ALPHA]:1},HD={[ot.UNSIGNED_SHORT_4_4_4_4]:2,[ot.UNSIGNED_SHORT_5_5_5_1]:2,[ot.UNSIGNED_SHORT_5_6_5]:2};function zD(e,t,r=!1){const n=new DataView(t);if(!XD(e,n))return null;const i=n.getUint32(lr.ENDIANNESS,!0)===WD,o=n.getUint32(lr.GL_TYPE,i),l=n.getUint32(lr.GL_FORMAT,i),h=n.getUint32(lr.GL_INTERNAL_FORMAT,i),u=n.getUint32(lr.PIXEL_WIDTH,i),f=n.getUint32(lr.PIXEL_HEIGHT,i)||1,d=n.getUint32(lr.PIXEL_DEPTH,i)||1,g=n.getUint32(lr.NUMBER_OF_ARRAY_ELEMENTS,i)||1,m=n.getUint32(lr.NUMBER_OF_FACES,i),v=n.getUint32(lr.NUMBER_OF_MIPMAP_LEVELS,i),_=n.getUint32(lr.BYTES_OF_KEY_VALUE_DATA,i);if(f===0||d!==1)throw new Error("Only 2D textures are supported");if(m!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(g!==1)throw new Error("WebGL does not support array textures");const w=4,x=4,A=u+3&-4,S=f+3&-4,E=new Array(g);let I=u*f;o===0&&(I=A*S);let D;if(o!==0?_g[o]?D=_g[o]*$D[l]:D=HD[o]:D=Ma[h],D===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const L=r?YD(n,_,i):null;let F=I*D,z=u,j=f,X=A,K=S,W=zu+_;for(let k=0;k<v;k++){const lt=n.getUint32(W,i);let dt=W+4;for(let Y=0;Y<g;Y++){let yt=E[Y];yt||(yt=E[Y]=new Array(v)),yt[k]={levelID:k,levelWidth:v>1||o!==0?z:X,levelHeight:v>1||o!==0?j:K,levelBuffer:new Uint8Array(t,dt,F)},dt+=F}W+=lt+4,W=W%4!==0?W+4-W%4:W,z=z>>1||1,j=j>>1||1,X=z+w-1&~(w-1),K=j+x-1&~(x-1),F=X*K*D}return o!==0?{uncompressed:E.map(k=>{let lt=k[0].levelBuffer,dt=!1;return o===ot.FLOAT?lt=new Float32Array(k[0].levelBuffer.buffer,k[0].levelBuffer.byteOffset,k[0].levelBuffer.byteLength/4):o===ot.UNSIGNED_INT?(dt=!0,lt=new Uint32Array(k[0].levelBuffer.buffer,k[0].levelBuffer.byteOffset,k[0].levelBuffer.byteLength/4)):o===ot.INT&&(dt=!0,lt=new Int32Array(k[0].levelBuffer.buffer,k[0].levelBuffer.byteOffset,k[0].levelBuffer.byteLength/4)),{resource:new Ws(lt,{width:k[0].levelWidth,height:k[0].levelHeight}),type:o,format:dt?VD(l):l}}),kvData:L}:{compressed:E.map(k=>new Yn(null,{format:h,width:u,height:f,levels:v,levelBuffers:k})),kvData:L}}function XD(e,t){for(let r=0;r<yg.length;r++)if(t.getUint8(r)!==yg[r])return console.error(`${e} is not a valid *.ktx file!`),!1;return!0}function VD(e){switch(e){case V.RGBA:return V.RGBA_INTEGER;case V.RGB:return V.RGB_INTEGER;case V.RG:return V.RG_INTEGER;case V.RED:return V.RED_INTEGER;default:return e}}function YD(e,t,r){const n=new Map;let i=0;for(;i<t;){const o=e.getUint32(zu+i,r),l=zu+i+4,h=3-(o+3)%4;if(o===0||o>t-i){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let u=0;for(;u<o&&e.getUint8(l+u)!==0;u++);if(u===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const f=new TextDecoder().decode(new Uint8Array(e.buffer,l,u)),d=new DataView(e.buffer,l+u+1,o-u-1);n.set(f,d),i+=4+o+h}return n}const jD={extension:{type:Z.LoadParser,priority:Fr.High},test(e){return Xa(e,".dds")},async load(e,t,r){const i=await(await J.ADAPTER.fetch(e)).arrayBuffer(),l=GD(i).map(h=>{const u=new gt(h,{mipmap:Or.OFF,alphaMode:_r.NO_PREMULTIPLIED_ALPHA,resolution:mn(e),...t.data});return Va(u,r,e)});return l.length===1?l[0]:l},unload(e){Array.isArray(e)?e.forEach(t=>t.destroy(!0)):e.destroy(!0)}};st.add(jD);const qD={extension:{type:Z.LoadParser,priority:Fr.High},test(e){return Xa(e,".ktx")},async load(e,t,r){const i=await(await J.ADAPTER.fetch(e)).arrayBuffer(),{compressed:o,uncompressed:l,kvData:h}=zD(e,i),u=o??l,f={mipmap:Or.OFF,alphaMode:_r.NO_PREMULTIPLIED_ALPHA,resolution:mn(e),...t.data},d=u.map(g=>{u===l&&Object.assign(f,{type:g.type,format:g.format});const m=new gt(g,f);return m.ktxKeyValueData=h,Va(m,r,e)});return d.length===1?d[0]:d},unload(e){Array.isArray(e)?e.forEach(t=>t.destroy(!0)):e.destroy(!0)}};st.add(qD);const KD={extension:Z.ResolveParser,test:e=>{const r=e.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(r)},parse:e=>{var n,i;if(e.split("?")[0].split(".").pop()==="ktx"){const o=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(o.some(l=>e.endsWith(l)))return{resolution:parseFloat(((n=J.RETINA_PREFIX.exec(e))==null?void 0:n[1])??"1"),format:o.find(l=>e.endsWith(l)),src:e}}return{resolution:parseFloat(((i=J.RETINA_PREFIX.exec(e))==null?void 0:i[1])??"1"),format:e.split(".").pop(),src:e}}};st.add(KD);const xg=new Tt,bg=4,Xu=class{constructor(e){this.renderer=e}async image(e,t,r){const n=new Image;return n.src=await this.base64(e,t,r),n}async base64(e,t,r){const n=this.canvas(e);if(n.toDataURL!==void 0)return n.toDataURL(t,r);if(n.convertToBlob!==void 0){const i=await n.convertToBlob({type:t,quality:r});return await new Promise(o=>{const l=new FileReader;l.onload=()=>o(l.result),l.readAsDataURL(i)})}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")}canvas(e,t){const r=this.renderer;let n,i=!1,o,l=!1;e&&(e instanceof _n?o=e:(o=this.renderer.generateTexture(e),l=!0)),o?(n=o.baseTexture.resolution,t=t??o.frame,i=!1,r.renderTexture.bind(o)):(n=r.resolution,t||(t=xg,t.width=r.width,t.height=r.height),i=!0,r.renderTexture.bind(null));const h=Math.round(t.width*n),u=Math.round(t.height*n);let f=new qp(h,u,1);const d=new Uint8Array(bg*h*u),g=r.gl;g.readPixels(Math.round(t.x*n),Math.round(t.y*n),h,u,g.RGBA,g.UNSIGNED_BYTE,d);const m=f.context.getImageData(0,0,h,u);if(Xu.arrayPostDivide(d,m.data),f.context.putImageData(m,0,0),i){const v=new qp(f.width,f.height,1);v.context.scale(1,-1),v.context.drawImage(f.canvas,0,-u),f.destroy(),f=v}return l&&o.destroy(!0),f.canvas}pixels(e,t){const r=this.renderer;let n,i,o=!1;e&&(e instanceof _n?i=e:(i=this.renderer.generateTexture(e),o=!0)),i?(n=i.baseTexture.resolution,t=t??i.frame,r.renderTexture.bind(i)):(n=r.resolution,t||(t=xg,t.width=r.width,t.height=r.height),r.renderTexture.bind(null));const l=Math.round(t.width*n),h=Math.round(t.height*n),u=new Uint8Array(bg*l*h),f=r.gl;return f.readPixels(Math.round(t.x*n),Math.round(t.y*n),l,h,f.RGBA,f.UNSIGNED_BYTE,u),o&&i.destroy(!0),Xu.arrayPostDivide(u,u),u}destroy(){this.renderer=null}static arrayPostDivide(e,t){for(let r=0;r<e.length;r+=4){const n=t[r+3]=e[r+3];n!==0?(t[r]=Math.round(Math.min(e[r]*255/n,255)),t[r+1]=Math.round(Math.min(e[r+1]*255/n,255)),t[r+2]=Math.round(Math.min(e[r+2]*255/n,255))):(t[r]=e[r],t[r+1]=e[r+1],t[r+2]=e[r+2])}}};let Av=Xu;Av.extension={name:"extract",type:Z.RendererSystem};st.add(Av);const Da={build(e){const t=e.points;let r,n,i,o,l,h;if(e.type===me.CIRC){const _=e.shape;r=_.x,n=_.y,l=h=_.radius,i=o=0}else if(e.type===me.ELIP){const _=e.shape;r=_.x,n=_.y,l=_.width,h=_.height,i=o=0}else{const _=e.shape,w=_.width/2,x=_.height/2;r=_.x+w,n=_.y+x,l=h=Math.max(0,Math.min(_.radius,Math.min(w,x))),i=w-l,o=x-h}if(!(l>=0&&h>=0&&i>=0&&o>=0)){t.length=0;return}const u=Math.ceil(2.3*Math.sqrt(l+h)),f=u*8+(i?4:0)+(o?4:0);if(t.length=f,f===0)return;if(u===0){t.length=8,t[0]=t[6]=r+i,t[1]=t[3]=n+o,t[2]=t[4]=r-i,t[5]=t[7]=n-o;return}let d=0,g=u*4+(i?2:0)+2,m=g,v=f;{const _=i+l,w=o,x=r+_,A=r-_,S=n+w;if(t[d++]=x,t[d++]=S,t[--g]=S,t[--g]=A,o){const E=n-w;t[m++]=A,t[m++]=E,t[--v]=E,t[--v]=x}}for(let _=1;_<u;_++){const w=Math.PI/2*(_/u),x=i+Math.cos(w)*l,A=o+Math.sin(w)*h,S=r+x,E=r-x,I=n+A,D=n-A;t[d++]=S,t[d++]=I,t[--g]=I,t[--g]=E,t[m++]=E,t[m++]=D,t[--v]=D,t[--v]=S}{const _=i,w=o+h,x=r+_,A=r-_,S=n+w,E=n-w;t[d++]=x,t[d++]=S,t[--v]=E,t[--v]=x,i&&(t[d++]=A,t[d++]=S,t[--v]=E,t[--v]=A)}},triangulate(e,t){const r=e.points,n=t.points,i=t.indices;if(r.length===0)return;let o=n.length/2;const l=o;let h,u;if(e.type!==me.RREC){const d=e.shape;h=d.x,u=d.y}else{const d=e.shape;h=d.x+d.width/2,u=d.y+d.height/2}const f=e.matrix;n.push(e.matrix?f.a*h+f.c*u+f.tx:h,e.matrix?f.b*h+f.d*u+f.ty:u),o++,n.push(r[0],r[1]);for(let d=2;d<r.length;d+=2)n.push(r[d],r[d+1]),i.push(o++,l,o);i.push(l+1,l,o)}};function wg(e,t=!1){const r=e.length;if(r<6)return;let n=0;for(let i=0,o=e[r-2],l=e[r-1];i<r;i+=2){const h=e[i],u=e[i+1];n+=(h-o)*(u+l),o=h,l=u}if(!t&&n>0||t&&n<=0){const i=r/2;for(let o=i+i%2;o<r;o+=2){const l=r-o-2,h=r-o-1,u=o,f=o+1;[e[l],e[u]]=[e[u],e[l]],[e[h],e[f]]=[e[f],e[h]]}}}const Sv={build(e){e.points=e.shape.points.slice()},triangulate(e,t){let r=e.points;const n=e.holes,i=t.points,o=t.indices;if(r.length>=6){wg(r,!1);const l=[];for(let f=0;f<n.length;f++){const d=n[f];wg(d.points,!0),l.push(r.length/2),r=r.concat(d.points)}const h=ET(r,l,2);if(!h)return;const u=i.length/2;for(let f=0;f<h.length;f+=3)o.push(h[f]+u),o.push(h[f+1]+u),o.push(h[f+2]+u);for(let f=0;f<r.length;f++)i.push(r[f])}}},ZD={build(e){const t=e.shape,r=t.x,n=t.y,i=t.width,o=t.height,l=e.points;l.length=0,i>=0&&o>=0&&l.push(r,n,r+i,n,r+i,n+o,r,n+o)},triangulate(e,t){const r=e.points,n=t.points;if(r.length===0)return;const i=n.length/2;n.push(r[0],r[1],r[2],r[3],r[6],r[7],r[4],r[5]),t.indices.push(i,i+1,i+2,i+1,i+2,i+3)}},JD={build(e){Da.build(e)},triangulate(e,t){Da.triangulate(e,t)}};var un=(e=>(e.MITER="miter",e.BEVEL="bevel",e.ROUND="round",e))(un||{}),Hn=(e=>(e.BUTT="butt",e.ROUND="round",e.SQUARE="square",e))(Hn||{});const Gi={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(e,t=20){if(!this.adaptive||!e||isNaN(e))return t;let r=Math.ceil(e/this.maxLength);return r<this.minSegments?r=this.minSegments:r>this.maxSegments&&(r=this.maxSegments),r}};class Eg{static curveTo(t,r,n,i,o,l){const h=l[l.length-2],f=l[l.length-1]-r,d=h-t,g=i-r,m=n-t,v=Math.abs(f*m-d*g);if(v<1e-8||o===0)return(l[l.length-2]!==t||l[l.length-1]!==r)&&l.push(t,r),null;const _=f*f+d*d,w=g*g+m*m,x=f*g+d*m,A=o*Math.sqrt(_)/v,S=o*Math.sqrt(w)/v,E=A*x/_,I=S*x/w,D=A*m+S*d,L=A*g+S*f,O=d*(S+E),F=f*(S+E),z=m*(A+I),j=g*(A+I),X=Math.atan2(F-L,O-D),K=Math.atan2(j-L,z-D);return{cx:D+t,cy:L+r,radius:o,startAngle:X,endAngle:K,anticlockwise:d*g>m*f}}static arc(t,r,n,i,o,l,h,u,f){const d=h-l,g=Gi._segmentsCount(Math.abs(d)*o,Math.ceil(Math.abs(d)/Ca)*40),m=d/(g*2),v=m*2,_=Math.cos(m),w=Math.sin(m),x=g-1,A=x%1/x;for(let S=0;S<=x;++S){const E=S+A*S,I=m+l+v*E,D=Math.cos(I),L=-Math.sin(I);f.push((_*D+w*L)*o+n,(_*-L+w*D)*o+i)}}}class QD{constructor(){this.reset()}begin(t,r,n){this.reset(),this.style=t,this.start=r,this.attribStart=n}end(t,r){this.attribSize=r-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class _c{static curveLength(t,r,n,i,o,l,h,u){let d=0,g=0,m=0,v=0,_=0,w=0,x=0,A=0,S=0,E=0,I=0,D=t,L=r;for(let O=1;O<=10;++O)g=O/10,m=g*g,v=m*g,_=1-g,w=_*_,x=w*_,A=x*t+3*w*g*n+3*_*m*o+v*h,S=x*r+3*w*g*i+3*_*m*l+v*u,E=D-A,I=L-S,D=A,L=S,d+=Math.sqrt(E*E+I*I);return d}static curveTo(t,r,n,i,o,l,h){const u=h[h.length-2],f=h[h.length-1];h.length-=2;const d=Gi._segmentsCount(_c.curveLength(u,f,t,r,n,i,o,l));let g=0,m=0,v=0,_=0,w=0;h.push(u,f);for(let x=1,A=0;x<=d;++x)A=x/d,g=1-A,m=g*g,v=m*g,_=A*A,w=_*A,h.push(v*u+3*m*A*t+3*g*_*n+w*o,v*f+3*m*A*r+3*g*_*i+w*l)}}function Tg(e,t,r,n,i,o,l,h){const u=e-r*i,f=t-n*i,d=e+r*o,g=t+n*o;let m,v;l?(m=n,v=-r):(m=-n,v=r);const _=u+m,w=f+v,x=d+m,A=g+v;return h.push(_,w),h.push(x,A),2}function Fn(e,t,r,n,i,o,l,h){const u=r-e,f=n-t;let d=Math.atan2(u,f),g=Math.atan2(i-e,o-t);h&&d<g?d+=Math.PI*2:!h&&d>g&&(g+=Math.PI*2);let m=d;const v=g-d,_=Math.abs(v),w=Math.sqrt(u*u+f*f),x=(15*_*Math.sqrt(w)/Math.PI>>0)+1,A=v/x;if(m+=A,h){l.push(e,t),l.push(r,n);for(let S=1,E=m;S<x;S++,E+=A)l.push(e,t),l.push(e+Math.sin(E)*w,t+Math.cos(E)*w);l.push(e,t),l.push(i,o)}else{l.push(r,n),l.push(e,t);for(let S=1,E=m;S<x;S++,E+=A)l.push(e+Math.sin(E)*w,t+Math.cos(E)*w),l.push(e,t);l.push(i,o),l.push(e,t)}return x*2}function tB(e,t){const r=e.shape;let n=e.points||r.points.slice();const i=t.closePointEps;if(n.length===0)return;const o=e.lineStyle,l=new St(n[0],n[1]),h=new St(n[n.length-2],n[n.length-1]),u=r.type!==me.POLY||r.closeStroke,f=Math.abs(l.x-h.x)<i&&Math.abs(l.y-h.y)<i;if(u){n=n.slice(),f&&(n.pop(),n.pop(),h.set(n[n.length-2],n[n.length-1]));const Y=(l.x+h.x)*.5,yt=(h.y+l.y)*.5;n.unshift(Y,yt),n.push(Y,yt)}const d=t.points,g=n.length/2;let m=n.length;const v=d.length/2,_=o.width/2,w=_*_,x=o.miterLimit*o.miterLimit;let A=n[0],S=n[1],E=n[2],I=n[3],D=0,L=0,O=-(S-I),F=A-E,z=0,j=0,X=Math.sqrt(O*O+F*F);O/=X,F/=X,O*=_,F*=_;const K=o.alignment,W=(1-K)*2,k=K*2;u||(o.cap===Hn.ROUND?m+=Fn(A-O*(W-k)*.5,S-F*(W-k)*.5,A-O*W,S-F*W,A+O*k,S+F*k,d,!0)+2:o.cap===Hn.SQUARE&&(m+=Tg(A,S,O,F,W,k,!0,d))),d.push(A-O*W,S-F*W),d.push(A+O*k,S+F*k);for(let Y=1;Y<g-1;++Y){A=n[(Y-1)*2],S=n[(Y-1)*2+1],E=n[Y*2],I=n[Y*2+1],D=n[(Y+1)*2],L=n[(Y+1)*2+1],O=-(S-I),F=A-E,X=Math.sqrt(O*O+F*F),O/=X,F/=X,O*=_,F*=_,z=-(I-L),j=E-D,X=Math.sqrt(z*z+j*j),z/=X,j/=X,z*=_,j*=_;const yt=E-A,Ot=S-I,H=E-D,nt=L-I,bt=yt*H+Ot*nt,Pt=Ot*H-nt*yt,Mt=Pt<0;if(Math.abs(Pt)<.001*Math.abs(bt)){d.push(E-O*W,I-F*W),d.push(E+O*k,I+F*k),bt>=0&&(o.join===un.ROUND?m+=Fn(E,I,E-O*W,I-F*W,E-z*W,I-j*W,d,!1)+4:m+=2,d.push(E-z*k,I-j*k),d.push(E+z*W,I+j*W));continue}const Nt=(-O+A)*(-F+I)-(-O+E)*(-F+S),kt=(-z+D)*(-j+I)-(-z+E)*(-j+L),ne=(yt*kt-H*Nt)/Pt,jt=(nt*Nt-Ot*kt)/Pt,ie=(ne-E)*(ne-E)+(jt-I)*(jt-I),oe=E+(ne-E)*W,Dt=I+(jt-I)*W,Ut=E-(ne-E)*k,qt=I-(jt-I)*k,Kt=Math.min(yt*yt+Ot*Ot,H*H+nt*nt),ye=Mt?W:k,En=Kt+ye*ye*w;ie<=En?o.join===un.BEVEL||ie/w>x?(Mt?(d.push(oe,Dt),d.push(E+O*k,I+F*k),d.push(oe,Dt),d.push(E+z*k,I+j*k)):(d.push(E-O*W,I-F*W),d.push(Ut,qt),d.push(E-z*W,I-j*W),d.push(Ut,qt)),m+=2):o.join===un.ROUND?Mt?(d.push(oe,Dt),d.push(E+O*k,I+F*k),m+=Fn(E,I,E+O*k,I+F*k,E+z*k,I+j*k,d,!0)+4,d.push(oe,Dt),d.push(E+z*k,I+j*k)):(d.push(E-O*W,I-F*W),d.push(Ut,qt),m+=Fn(E,I,E-O*W,I-F*W,E-z*W,I-j*W,d,!1)+4,d.push(E-z*W,I-j*W),d.push(Ut,qt)):(d.push(oe,Dt),d.push(Ut,qt)):(d.push(E-O*W,I-F*W),d.push(E+O*k,I+F*k),o.join===un.ROUND?Mt?m+=Fn(E,I,E+O*k,I+F*k,E+z*k,I+j*k,d,!0)+2:m+=Fn(E,I,E-O*W,I-F*W,E-z*W,I-j*W,d,!1)+2:o.join===un.MITER&&ie/w<=x&&(Mt?(d.push(Ut,qt),d.push(Ut,qt)):(d.push(oe,Dt),d.push(oe,Dt)),m+=2),d.push(E-z*W,I-j*W),d.push(E+z*k,I+j*k),m+=2)}A=n[(g-2)*2],S=n[(g-2)*2+1],E=n[(g-1)*2],I=n[(g-1)*2+1],O=-(S-I),F=A-E,X=Math.sqrt(O*O+F*F),O/=X,F/=X,O*=_,F*=_,d.push(E-O*W,I-F*W),d.push(E+O*k,I+F*k),u||(o.cap===Hn.ROUND?m+=Fn(E-O*(W-k)*.5,I-F*(W-k)*.5,E-O*W,I-F*W,E+O*k,I+F*k,d,!1)+2:o.cap===Hn.SQUARE&&(m+=Tg(E,I,O,F,W,k,!1,d)));const lt=t.indices,dt=Gi.epsilon*Gi.epsilon;for(let Y=v;Y<m+v-2;++Y)A=d[Y*2],S=d[Y*2+1],E=d[(Y+1)*2],I=d[(Y+1)*2+1],D=d[(Y+2)*2],L=d[(Y+2)*2+1],!(Math.abs(A*(I-L)+E*(L-S)+D*(S-I))<dt)&&lt.push(Y,Y+1,Y+2)}function eB(e,t){let r=0;const n=e.shape,i=e.points||n.points,o=n.type!==me.POLY||n.closeStroke;if(i.length===0)return;const l=t.points,h=t.indices,u=i.length/2,f=l.length/2;let d=f;for(l.push(i[0],i[1]),r=1;r<u;r++)l.push(i[r*2],i[r*2+1]),h.push(d,d+1),d++;o&&h.push(d,f)}function Ag(e,t){e.lineStyle.native?eB(e,t):tB(e,t)}class xc{static curveLength(t,r,n,i,o,l){const h=t-2*n+o,u=r-2*i+l,f=2*n-2*t,d=2*i-2*r,g=4*(h*h+u*u),m=4*(h*f+u*d),v=f*f+d*d,_=2*Math.sqrt(g+m+v),w=Math.sqrt(g),x=2*g*w,A=2*Math.sqrt(v),S=m/w;return(x*_+w*m*(_-A)+(4*v*g-m*m)*Math.log((2*w+S+_)/(S+A)))/(4*x)}static curveTo(t,r,n,i,o){const l=o[o.length-2],h=o[o.length-1],u=Gi._segmentsCount(xc.curveLength(l,h,t,r,n,i));let f=0,d=0;for(let g=1;g<=u;++g){const m=g/u;f=l+(t-l)*m,d=h+(r-h)*m,o.push(f+(t+(n-t)*m-f)*m,d+(r+(i-r)*m-d)*m)}}}const qh={[me.POLY]:Sv,[me.CIRC]:Da,[me.ELIP]:Da,[me.RECT]:ZD,[me.RREC]:JD},Sg=[],Qo=[];class Ba{constructor(t,r=null,n=null,i=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=n,this.fillStyle=r,this.matrix=i,this.type=t.type}clone(){return new Ba(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const _i=new St,Cv=class extends Mm{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Ia,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),Qo.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),Sg.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,r=null,n=null){const i=new Ba(e,t,r,n);return this.graphicsData.push(i),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const r=new Ba(e,null,null,t),n=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=n.lineStyle,n.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let r=0;r<t.length;++r){const n=t[r];if(n.fillStyle.visible&&n.shape&&(n.matrix?n.matrix.applyInverse(e,_i):_i.copyFrom(e),n.shape.contains(_i.x,_i.y))){let i=!1;if(n.holes){for(let o=0;o<n.holes.length;o++)if(n.holes[o].shape.contains(_i.x,_i.y)){i=!0;break}}if(!i)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let r=null,n=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],n=r.style);for(let h=this.shapeIndex;h<t.length;h++){this.shapeIndex++;const u=t[h],f=u.fillStyle,d=u.lineStyle;qh[u.type].build(u),u.matrix&&this.transformPoints(u.points,u.matrix),(f.visible||d.visible)&&this.processHoles(u.holes);for(let m=0;m<2;m++){const v=m===0?f:d;if(!v.visible)continue;const _=v.texture.baseTexture,w=this.indices.length,x=this.points.length/2;_.wrapMode=gn.REPEAT,m===0?this.processFill(u):this.processLine(u);const A=this.points.length/2-x;A!==0&&(r&&!this._compareStyles(n,v)&&(r.end(w,x),r=null),r||(r=Sg.pop()||new QD,r.begin(v,w,x),this.batches.push(r),n=v),this.addUvs(this.points,e,v.texture,x,A,v.matrix))}}const i=this.indices.length,o=this.points.length/2;if(r&&r.end(i,o),this.batches.length===0){this.batchable=!0;return}const l=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&l===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=l?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const r=this.graphicsData[e],n=r.fillStyle,i=r.lineStyle;if(n&&!n.texture.baseTexture.valid||i&&!i.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,r=e.length;t<r;t++){const n=e[t];for(let i=0;i<n.size;i++){const o=n.start+i;this.indicesUint16[o]=this.indicesUint16[o]-n.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<Cv.BATCHABLE_SIZE*2}buildDrawCalls(){let e=++gt._globalBatch;for(let d=0;d<this.drawCalls.length;d++)this.drawCalls[d].texArray.clear(),Qo.push(this.drawCalls[d]);this.drawCalls.length=0;const t=this.colors,r=this.textureIds;let n=Qo.pop();n||(n=new Du,n.texArray=new Ou),n.texArray.count=0,n.start=0,n.size=0,n.type=Mr.TRIANGLES;let i=0,o=null,l=0,h=!1,u=Mr.TRIANGLES,f=0;this.drawCalls.push(n);for(let d=0;d<this.batches.length;d++){const g=this.batches[d],m=8,v=g.style,_=v.texture.baseTexture;h!==!!v.native&&(h=!!v.native,u=h?Mr.LINES:Mr.TRIANGLES,o=null,i=m,e++),o!==_&&(o=_,_._batchEnabled!==e&&(i===m&&(e++,i=0,n.size>0&&(n=Qo.pop(),n||(n=new Du,n.texArray=new Ou),this.drawCalls.push(n)),n.start=f,n.size=0,n.texArray.count=0,n.type=u),_.touched=1,_._batchEnabled=e,_._batchLocation=i,_.wrapMode=gn.REPEAT,n.texArray.elements[n.texArray.count++]=_,i++)),n.size+=g.size,f+=g.size,l=_._batchLocation,this.addColors(t,v.color,v.alpha,g.attribSize,g.attribStart),this.addTextureIds(r,l,g.attribSize,g.attribStart)}gt._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,r=this.colors,n=this.textureIds,i=new ArrayBuffer(e.length*3*4),o=new Float32Array(i),l=new Uint32Array(i);let h=0;for(let u=0;u<e.length/2;u++)o[h++]=e[u*2],o[h++]=e[u*2+1],o[h++]=t[u*2],o[h++]=t[u*2+1],l[h++]=r[u],o[h++]=n[u];this._buffer.update(i),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?Sv.triangulate(e,this):qh[e.type].triangulate(e,this)}processLine(e){Ag(e,this);for(let t=0;t<e.holes.length;t++)Ag(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const r=e[t];qh[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let r=0;r<e.length/2;r++){const n=e[r*2],i=e[r*2+1];e[r*2]=t.a*n+t.c*i+t.tx,e[r*2+1]=t.b*n+t.d*i+t.ty}}addColors(e,t,r,n,i=0){const o=(t>>16)+(t&65280)+((t&255)<<16),l=fc(o,r);e.length=Math.max(e.length,i+n);for(let h=0;h<n;h++)e[i+h]=l}addTextureIds(e,t,r,n=0){e.length=Math.max(e.length,n+r);for(let i=0;i<r;i++)e[n+i]=t}addUvs(e,t,r,n,i,o=null){let l=0;const h=t.length,u=r.frame;for(;l<i;){let d=e[(n+l)*2],g=e[(n+l)*2+1];if(o){const m=o.a*d+o.c*g+o.tx;g=o.b*d+o.d*g+o.ty,d=m}l++,t.push(d/u.width,g/u.height)}const f=r.baseTexture;(u.width<f.width||u.height<f.height)&&this.adjustUvs(t,r,h,i)}adjustUvs(e,t,r,n){const i=t.baseTexture,o=1e-6,l=r+n*2,h=t.frame,u=h.width/i.width,f=h.height/i.height;let d=h.x/h.width,g=h.y/h.height,m=Math.floor(e[r]+o),v=Math.floor(e[r+1]+o);for(let _=r+2;_<l;_+=2)m=Math.min(m,Math.floor(e[_]+o)),v=Math.min(v,Math.floor(e[_+1]+o));d-=m,g-=v;for(let _=r;_<l;_+=2)e[_]=(e[_]+d)*u,e[_+1]=(e[_+1]+g)*f}};let Iv=Cv;Iv.BATCHABLE_SIZE=100;class Ya{constructor(){this.color=16777215,this.alpha=1,this.texture=it.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Ya;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=it.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class bc extends Ya{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Hn.BUTT,this.join=un.MITER,this.miterLimit=10}clone(){const t=new bc;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const rB=new Float32Array(3),Kh={},pa=class extends $e{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Ya,this._lineStyle=new bc,this._matrix=null,this._holeMode=!1,this.state=Zr.for2d(),this._geometry=e||new Iv,this._geometry.refCount++,this._transformID=-1,this.tint=16777215,this.blendMode=ct.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new pa(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tint}set tint(e){this._tint=e}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,r=1,n=.5,i=!1){return typeof e=="number"&&(e={width:e,color:t,alpha:r,alignment:n,native:i}),this.lineTextureStyle(e)}lineTextureStyle(e){e=Object.assign({width:0,texture:it.WHITE,color:e!=null&&e.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:Hn.BUTT,join:un.MITER,miterLimit:10},e),this.currentPath&&this.startPoly();const t=e.width>0&&e.alpha>0;return t?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:t},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new Oi,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new Oi,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const r=this.currentPath.points,n=r[r.length-2],i=r[r.length-1];return(n!==e||i!==t)&&r.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,r,n){this._initCurve();const i=this.currentPath.points;return i.length===0&&this.moveTo(0,0),xc.curveTo(e,t,r,n,i),this}bezierCurveTo(e,t,r,n,i,o){return this._initCurve(),_c.curveTo(e,t,r,n,i,o,this.currentPath.points),this}arcTo(e,t,r,n,i){this._initCurve(e,t);const o=this.currentPath.points,l=Eg.curveTo(e,t,r,n,i,o);if(l){const{cx:h,cy:u,radius:f,startAngle:d,endAngle:g,anticlockwise:m}=l;this.arc(h,u,f,d,g,m)}return this}arc(e,t,r,n,i,o=!1){if(n===i)return this;if(!o&&i<=n?i+=Ca:o&&n<=i&&(n+=Ca),i-n===0)return this;const h=e+Math.cos(n)*r,u=t+Math.sin(n)*r,f=this._geometry.closePointEps;let d=this.currentPath?this.currentPath.points:null;if(d){const g=Math.abs(d[d.length-2]-h),m=Math.abs(d[d.length-1]-u);g<f&&m<f||d.push(h,u)}else this.moveTo(h,u),d=this.currentPath.points;return Eg.arc(h,u,e,t,r,n,i,o,d),this}beginFill(e=0,t=1){return this.beginTextureFill({texture:it.WHITE,color:e,alpha:t})}beginTextureFill(e){e=Object.assign({texture:it.WHITE,color:16777215,alpha:1,matrix:null},e),this.currentPath&&this.startPoly();const t=e.alpha>0;return t?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:t},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,r,n){return this.drawShape(new Tt(e,t,r,n))}drawRoundedRect(e,t,r,n,i){return this.drawShape(new gc(e,t,r,n,i))}drawCircle(e,t,r){return this.drawShape(new dc(e,t,r))}drawEllipse(e,t,r,n){return this.drawShape(new pc(e,t,r,n))}drawPolygon(...e){let t,r=!0;const n=e[0];n.points?(r=n.closeStroke,t=n.points):Array.isArray(e[0])?t=e[0]:t=e;const i=new Oi(t);return i.closeStroke=r,this.drawShape(i),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return e.length===1&&e[0].shape.type===me.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,r=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(e.points);for(let n=0;n<r;n++){const i=e.batches[n],o=i.style.color,l=new Float32Array(this.vertexData.buffer,i.attribStart*4*2,i.attribSize*2),h=new Float32Array(e.uvsFloat32.buffer,i.attribStart*4*2,i.attribSize*2),u=new Uint16Array(e.indicesUint16.buffer,i.start*2,i.size),f={vertexData:l,blendMode:t,indices:u,uvs:h,_batchRGB:Bs(o),_tintRGB:o,_texture:i.style.texture,alpha:i.style.alpha,worldAlpha:1};this.batches[n]=f}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,r=this.batches.length;t<r;t++){const n=this.batches[t];n.worldAlpha=this.worldAlpha*n.alpha,e.plugins[this.pluginName].render(n)}}}_renderDirect(e){const t=this._resolveDirectShader(e),r=this._geometry,n=this.tint,i=this.worldAlpha,o=t.uniforms,l=r.drawCalls;o.translationMatrix=this.transform.worldTransform,o.tint[0]=(n>>16&255)/255*i,o.tint[1]=(n>>8&255)/255*i,o.tint[2]=(n&255)/255*i,o.tint[3]=i,e.shader.bind(t),e.geometry.bind(r,t),e.state.set(this.state);for(let h=0,u=l.length;h<u;h++)this._renderDrawCallDirect(e,r.drawCalls[h])}_renderDrawCallDirect(e,t){const{texArray:r,type:n,size:i,start:o}=t,l=r.count;for(let h=0;h<l;h++)e.texture.bind(r.elements[h],h);e.geometry.draw(n,i,o)}_resolveDirectShader(e){let t=this.shader;const r=this.pluginName;if(!t){if(!Kh[r]){const{maxTextures:n}=e.plugins[r],i=new Int32Array(n);for(let h=0;h<n;h++)i[h]=h;const o={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ht,default:yr.from({uSamplers:i},!0)},l=e.plugins[r]._shader.program;Kh[r]=new Br(l,o)}t=Kh[r]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:r,maxX:n,maxY:i}=e.bounds;this._bounds.addFrame(this.transform,t,r,n,i)}containsPoint(e){return this.worldTransform.applyInverse(e,pa._TEMP_POINT),this._geometry.containsPoint(pa._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;const e=Bs(this.tint,rB);for(let t=0;t<this.batches.length;t++){const r=this.batches[t],n=r._batchRGB,i=e[0]*n[0]*255,o=e[1]*n[1]*255,l=e[2]*n[2]*255,h=(i<<16)+(o<<8)+(l|0);r._tintRGB=(h>>16)+(h&65280)+((h&255)<<16)}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,r=t.a,n=t.b,i=t.c,o=t.d,l=t.tx,h=t.ty,u=this._geometry.points,f=this.vertexData;let d=0;for(let g=0;g<u.length;g+=2){const m=u[g],v=u[g+1];f[d++]=r*m+i*v+l,f[d++]=o*v+n*m+h}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};let ja=pa;ja.curves=Gi;ja._TEMP_POINT=new St;class nB{constructor(t,r){this.uvBuffer=t,this.uvMatrix=r,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const r=this.uvBuffer.data;(!this.data||this.data.length!==r.length)&&(this.data=new Float32Array(r.length)),this.uvMatrix.multiplyUvs(r,this.data),this._updateID++}}const Zh=new St,Cg=new Oi,Pv=class extends $e{constructor(e,t,r,n=Mr.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=r||Zr.for2d(),this.drawMode=n,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=J.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(e){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Mr.TRIANGLES&&t.length<Pv.BATCHABLE_SIZE*2?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;const n=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[n]),e.plugins[n].render(this)}calculateVertices(){const t=this.geometry.buffers[0],r=t.data,n=t._updateID;if(n===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==r.length&&(this.vertexData=new Float32Array(r.length));const i=this.transform.worldTransform,o=i.a,l=i.b,h=i.c,u=i.d,f=i.tx,d=i.ty,g=this.vertexData;for(let m=0;m<g.length/2;m++){const v=r[m*2],_=r[m*2+1];g[m*2]=o*v+h*_+f,g[m*2+1]=l*v+u*_+d}if(this._roundPixels){const m=J.RESOLUTION;for(let v=0;v<g.length;++v)g[v]=Math.round(g[v]*m)/m}this.vertexDirty=n}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new nB(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,Zh);const t=this.geometry.getBuffer("aVertexPosition").data,r=Cg.points,n=this.geometry.getIndex().data,i=n.length,o=this.drawMode===4?3:1;for(let l=0;l+2<i;l+=o){const h=n[l]*2,u=n[l+1]*2,f=n[l+2]*2;if(r[0]=t[h],r[1]=t[h+1],r[2]=t[u],r[3]=t[u+1],r[4]=t[f],r[5]=t[f+1],Cg.contains(Zh.x,Zh.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let Vu=Pv;Vu.BATCHABLE_SIZE=100;class iB extends vn{constructor(t,r,n){super();const i=new re(t),o=new re(r,!0),l=new re(n,!0,!0);this.addAttribute("aVertexPosition",i,2,!1,ot.FLOAT).addAttribute("aTextureCoord",o,2,!1,ot.FLOAT).addIndex(l),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var sB=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,oB=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class Ig extends Br{constructor(t,r){const n={uSampler:t,alpha:1,uTextureMatrix:Ht.IDENTITY,uColor:new Float32Array([1,1,1,1])};r=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},r),r.uniforms&&Object.assign(n,r.uniforms),super(r.program||pr.from(oB,sB),n),this._colorDirty=!1,this.uvMatrix=new qm(t),this.batchable=r.program===void 0,this.pluginName=r.pluginName,this.tint=r.tint,this.alpha=r.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16),this._colorDirty=!0)}get tint(){return this._tint}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture;Cm(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Pg{constructor(t,r,n){this.geometry=new vn,this.indexBuffer=null,this.size=n,this.dynamicProperties=[],this.staticProperties=[];for(let i=0;i<t.length;++i){let o=t[i];o={attributeName:o.attributeName,size:o.size,uploadFunction:o.uploadFunction,type:o.type||ot.FLOAT,offset:o.offset},r[i]?this.dynamicProperties.push(o):this.staticProperties.push(o)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let r=0;this.indexBuffer=new re(ZP(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let l=0;l<this.dynamicProperties.length;++l){const h=this.dynamicProperties[l];h.offset=r,r+=h.size,this.dynamicStride+=h.size}const n=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(n),this.dynamicDataUint32=new Uint32Array(n),this.dynamicBuffer=new re(this.dynamicData,!1,!1);let i=0;this.staticStride=0;for(let l=0;l<this.staticProperties.length;++l){const h=this.staticProperties[l];h.offset=i,i+=h.size,this.staticStride+=h.size}const o=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(o),this.staticDataUint32=new Uint32Array(o),this.staticBuffer=new re(this.staticData,!0,!1);for(let l=0;l<this.dynamicProperties.length;++l){const h=this.dynamicProperties[l];t.addAttribute(h.attributeName,this.dynamicBuffer,0,h.type===ot.UNSIGNED_BYTE,h.type,this.dynamicStride*4,h.offset*4)}for(let l=0;l<this.staticProperties.length;++l){const h=this.staticProperties[l];t.addAttribute(h.attributeName,this.staticBuffer,0,h.type===ot.UNSIGNED_BYTE,h.type,this.staticStride*4,h.offset*4)}}uploadDynamic(t,r,n){for(let i=0;i<this.dynamicProperties.length;i++){const o=this.dynamicProperties[i];o.uploadFunction(t,r,n,o.type===ot.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,o.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,r,n){for(let i=0;i<this.staticProperties.length;i++){const o=this.staticProperties[i];o.uploadFunction(t,r,n,o.type===ot.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,o.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var aB=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,lB=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class Rv extends za{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new Ht,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:ot.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Br.from(lB,aB,{}),this.state=Zr.for2d()}render(t){const r=t.children,n=t._maxSize,i=t._batchSize,o=this.renderer;let l=r.length;if(l===0)return;l>n&&!t.autoResize&&(l=n);let h=t._buffers;h||(h=t._buffers=this.generateBuffers(t));const u=r[0]._texture.baseTexture,f=u.alphaMode>0;this.state.blendMode=Sm(t.blendMode,f),o.state.set(this.state);const d=o.gl,g=t.worldTransform.copyTo(this.tempMatrix);g.prepend(o.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=g.toArray(!0),this.shader.uniforms.uColor=KP(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,f),this.shader.uniforms.uSampler=u,this.renderer.shader.bind(this.shader);let m=!1;for(let v=0,_=0;v<l;v+=i,_+=1){let w=l-v;w>i&&(w=i),_>=h.length&&h.push(this._generateOneMoreBuffer(t));const x=h[_];x.uploadDynamic(r,v,w);const A=t._bufferUpdateIDs[_]||0;m=m||x._updateID<A,m&&(x._updateID=t._updateID,x.uploadStatic(r,v,w)),o.geometry.bind(x.geometry),d.drawElements(d.TRIANGLES,w*6,d.UNSIGNED_SHORT,0)}}generateBuffers(t){const r=[],n=t._maxSize,i=t._batchSize,o=t._properties;for(let l=0;l<n;l+=i)r.push(new Pg(this.properties,o,i));return r}_generateOneMoreBuffer(t){const r=t._batchSize,n=t._properties;return new Pg(this.properties,n,r)}uploadVertices(t,r,n,i,o,l){let h=0,u=0,f=0,d=0;for(let g=0;g<n;++g){const m=t[r+g],v=m._texture,_=m.scale.x,w=m.scale.y,x=v.trim,A=v.orig;x?(u=x.x-m.anchor.x*A.width,h=u+x.width,d=x.y-m.anchor.y*A.height,f=d+x.height):(h=A.width*(1-m.anchor.x),u=A.width*-m.anchor.x,f=A.height*(1-m.anchor.y),d=A.height*-m.anchor.y),i[l]=u*_,i[l+1]=d*w,i[l+o]=h*_,i[l+o+1]=d*w,i[l+o*2]=h*_,i[l+o*2+1]=f*w,i[l+o*3]=u*_,i[l+o*3+1]=f*w,l+=o*4}}uploadPosition(t,r,n,i,o,l){for(let h=0;h<n;h++){const u=t[r+h].position;i[l]=u.x,i[l+1]=u.y,i[l+o]=u.x,i[l+o+1]=u.y,i[l+o*2]=u.x,i[l+o*2+1]=u.y,i[l+o*3]=u.x,i[l+o*3+1]=u.y,l+=o*4}}uploadRotation(t,r,n,i,o,l){for(let h=0;h<n;h++){const u=t[r+h].rotation;i[l]=u,i[l+o]=u,i[l+o*2]=u,i[l+o*3]=u,l+=o*4}}uploadUvs(t,r,n,i,o,l){for(let h=0;h<n;++h){const u=t[r+h]._texture._uvs;u?(i[l]=u.x0,i[l+1]=u.y0,i[l+o]=u.x1,i[l+o+1]=u.y1,i[l+o*2]=u.x2,i[l+o*2+1]=u.y2,i[l+o*3]=u.x3,i[l+o*3+1]=u.y3,l+=o*4):(i[l]=0,i[l+1]=0,i[l+o]=0,i[l+o+1]=0,i[l+o*2]=0,i[l+o*2+1]=0,i[l+o*3]=0,i[l+o*3+1]=0,l+=o*4)}}uploadTint(t,r,n,i,o,l){for(let h=0;h<n;++h){const u=t[r+h],f=u._texture.baseTexture.alphaMode>0,d=u.alpha,g=d<1&&f?fc(u._tintRGB,d):u._tintRGB+(d*255<<24);i[l]=g,i[l+o]=g,i[l+o*2]=g,i[l+o*3]=g,l+=o*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Rv.extension={name:"particle",type:Z.RendererPlugin};st.add(Rv);var qa=(e=>(e[e.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",e[e.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",e))(qa||{});const ta={willReadFrequently:!0},rt=class{static get experimentalLetterSpacingSupported(){let e=rt._experimentalLetterSpacingSupported;if(e!==void 0){const t=J.ADAPTER.getCanvasRenderingContext2D().prototype;e=rt._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,r,n,i,o,l,h,u){this.text=e,this.style=t,this.width=r,this.height=n,this.lines=i,this.lineWidths=o,this.lineHeight=l,this.maxLineWidth=h,this.fontProperties=u}static measureText(e,t,r,n=rt._canvas){r=r??t.wordWrap;const i=t.toFontString(),o=rt.measureFont(i);o.fontSize===0&&(o.fontSize=t.fontSize,o.ascent=t.fontSize);const l=n.getContext("2d",ta);l.font=i;const u=(r?rt.wordWrap(e,t,n):e).split(/(?:\r\n|\r|\n)/),f=new Array(u.length);let d=0;for(let _=0;_<u.length;_++){const w=rt._measureText(u[_],t.letterSpacing,l);f[_]=w,d=Math.max(d,w)}let g=d+t.strokeThickness;t.dropShadow&&(g+=t.dropShadowDistance);const m=t.lineHeight||o.fontSize+t.strokeThickness;let v=Math.max(m,o.fontSize+t.strokeThickness*2)+(u.length-1)*(m+t.leading);return t.dropShadow&&(v+=t.dropShadowDistance),new rt(e,t,g,v,u,f,m+t.leading,d,o)}static _measureText(e,t,r){let n=!1;rt.experimentalLetterSpacingSupported&&(rt.experimentalLetterSpacing?(r.letterSpacing=`${t}px`,r.textLetterSpacing=`${t}px`,n=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let i=r.measureText(e).width;return i>0&&(n?i-=t:i+=(rt.graphemeSegmenter(e).length-1)*t),i}static wordWrap(e,t,r=rt._canvas){const n=r.getContext("2d",ta);let i=0,o="",l="";const h=Object.create(null),{letterSpacing:u,whiteSpace:f}=t,d=rt.collapseSpaces(f),g=rt.collapseNewlines(f);let m=!d;const v=t.wordWrapWidth+u,_=rt.tokenize(e);for(let w=0;w<_.length;w++){let x=_[w];if(rt.isNewline(x)){if(!g){l+=rt.addLine(o),m=!d,o="",i=0;continue}x=" "}if(d){const S=rt.isBreakingSpace(x),E=rt.isBreakingSpace(o[o.length-1]);if(S&&E)continue}const A=rt.getFromCache(x,u,h,n);if(A>v)if(o!==""&&(l+=rt.addLine(o),o="",i=0),rt.canBreakWords(x,t.breakWords)){const S=rt.wordWrapSplit(x);for(let E=0;E<S.length;E++){let I=S[E],D=I,L=1;for(;S[E+L];){const F=S[E+L];if(!rt.canBreakChars(D,F,x,E,t.breakWords))I+=F;else break;D=F,L++}E+=L-1;const O=rt.getFromCache(I,u,h,n);O+i>v&&(l+=rt.addLine(o),m=!1,o="",i=0),o+=I,i+=O}}else{o.length>0&&(l+=rt.addLine(o),o="",i=0);const S=w===_.length-1;l+=rt.addLine(x,!S),m=!1,o="",i=0}else A+i>v&&(m=!1,l+=rt.addLine(o),o="",i=0),(o.length>0||!rt.isBreakingSpace(x)||m)&&(o+=x,i+=A)}return l+=rt.addLine(o,!1),l}static addLine(e,t=!0){return e=rt.trimRight(e),e=t?`${e}
`:e,e}static getFromCache(e,t,r,n){let i=r[e];return typeof i!="number"&&(i=rt._measureText(e,t,n)+t,r[e]=i),i}static collapseSpaces(e){return e==="normal"||e==="pre-line"}static collapseNewlines(e){return e==="normal"}static trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){const r=e[t];if(!rt.isBreakingSpace(r))break;e=e.slice(0,-1)}return e}static isNewline(e){return typeof e!="string"?!1:rt._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return typeof e!="string"?!1:rt._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const t=[];let r="";if(typeof e!="string")return t;for(let n=0;n<e.length;n++){const i=e[n],o=e[n+1];if(rt.isBreakingSpace(i,o)||rt.isNewline(i)){r!==""&&(t.push(r),r=""),t.push(i);continue}r+=i}return r!==""&&t.push(r),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,r,n,i){return!0}static wordWrapSplit(e){return rt.graphemeSegmenter(e)}static measureFont(e){if(rt._fonts[e])return rt._fonts[e];const t={ascent:0,descent:0,fontSize:0},r=rt._canvas,n=rt._context;n.font=e;const i=rt.METRICS_STRING+rt.BASELINE_SYMBOL,o=Math.ceil(n.measureText(i).width);let l=Math.ceil(n.measureText(rt.BASELINE_SYMBOL).width);const h=Math.ceil(rt.HEIGHT_MULTIPLIER*l);if(l=l*rt.BASELINE_MULTIPLIER|0,o===0||h===0)return rt._fonts[e]=t,t;r.width=o,r.height=h,n.fillStyle="#f00",n.fillRect(0,0,o,h),n.font=e,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(i,0,l);const u=n.getImageData(0,0,o,h).data,f=u.length,d=o*4;let g=0,m=0,v=!1;for(g=0;g<l;++g){for(let _=0;_<d;_+=4)if(u[m+_]!==255){v=!0;break}if(!v)m+=d;else break}for(t.ascent=l-g,m=f-d,v=!1,g=h;g>l;--g){for(let _=0;_<d;_+=4)if(u[m+_]!==255){v=!0;break}if(!v)m-=d;else break}return t.descent=g-l,t.fontSize=t.ascent+t.descent,rt._fonts[e]=t,t}static clearMetrics(e=""){e?delete rt._fonts[e]:rt._fonts={}}static get _canvas(){if(!rt.__canvas){let e;try{const t=new OffscreenCanvas(0,0),r=t.getContext("2d",ta);if(r!=null&&r.measureText)return rt.__canvas=t,t;e=J.ADAPTER.createCanvas()}catch{e=J.ADAPTER.createCanvas()}e.width=e.height=10,rt.__canvas=e}return rt.__canvas}static get _context(){return rt.__context||(rt.__context=rt._canvas.getContext("2d",ta)),rt.__context}};let ge=rt;ge.METRICS_STRING="|ÉqÅ";ge.BASELINE_SYMBOL="M";ge.BASELINE_MULTIPLIER=1.4;ge.HEIGHT_MULTIPLIER=2;ge.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const e=new Intl.Segmenter;return t=>[...e.segment(t)].map(r=>r.segment)}return e=>[...e]})();ge.experimentalLetterSpacing=!1;ge._fonts={};ge._newlines=[10,13];ge._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const hB=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Es=class{constructor(e){this.styleID=0,this.reset(),Qh(this,e,e)}clone(){const e={};return Qh(e,this,Es.defaultStyle),new Es(e)}reset(){Qh(this,Es.defaultStyle,Es.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=Jh(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=Jh(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){uB(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=Jh(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let r=t.length-1;r>=0;r--){let n=t[r].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!hB.includes(n)&&(n=`"${n}"`),t[r]=n}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};let Kn=Es;Kn.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:qa.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};function Rg(e){return typeof e=="number"?Tm(e):(typeof e=="string"&&e.startsWith("0x")&&(e=e.replace("0x","#")),e)}function Jh(e){if(Array.isArray(e)){for(let t=0;t<e.length;++t)e[t]=Rg(e[t]);return e}else return Rg(e)}function uB(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}function Qh(e,t,r){for(const n in r)Array.isArray(t[n])?e[n]=t[n].slice():e[n]=t[n]}const cB={texture:!0,children:!1,baseTexture:!0},Yu=class extends ji{constructor(e,t,r){let n=!1;r||(r=J.ADAPTER.createCanvas(),n=!0),r.width=3,r.height=3;const i=it.from(r);i.orig=new Tt,i.trim=new Tt,super(i),this._ownCanvas=n,this.canvas=r,this.context=r.getContext("2d",{willReadFrequently:!0}),this._resolution=Yu.defaultResolution??J.RESOLUTION,this._autoResolution=Yu.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return ge.experimentalLetterSpacing}static set experimentalLetterSpacing(e){Ct("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),ge.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const r=this.context,n=ge.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),i=n.width,o=n.height,l=n.lines,h=n.lineHeight,u=n.lineWidths,f=n.maxLineWidth,d=n.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,i)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+t.padding*2)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=t.strokeThickness,r.textBaseline=t.textBaseline,r.lineJoin=t.lineJoin,r.miterLimit=t.miterLimit;let g,m;const v=t.dropShadow?2:1;for(let _=0;_<v;++_){const w=t.dropShadow&&_===0,x=w?Math.ceil(Math.max(1,o)+t.padding*2):0,A=x*this._resolution;if(w){r.fillStyle="black",r.strokeStyle="black";const E=t.dropShadowColor,I=Bs(typeof E=="number"?E:cc(E)),D=t.dropShadowBlur*this._resolution,L=t.dropShadowDistance*this._resolution;r.shadowColor=`rgba(${I[0]*255},${I[1]*255},${I[2]*255},${t.dropShadowAlpha})`,r.shadowBlur=D,r.shadowOffsetX=Math.cos(t.dropShadowAngle)*L,r.shadowOffsetY=Math.sin(t.dropShadowAngle)*L+A}else r.fillStyle=this._generateFillStyle(t,l,n),r.strokeStyle=t.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;let S=(h-d.fontSize)/2;h-d.fontSize<0&&(S=0);for(let E=0;E<l.length;E++)g=t.strokeThickness/2,m=t.strokeThickness/2+E*h+d.ascent+S,t.align==="right"?g+=f-u[E]:t.align==="center"&&(g+=(f-u[E])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(l[E],g+t.padding,m+t.padding-x,!0),t.fill&&this.drawLetterSpacing(l[E],g+t.padding,m+t.padding-x)}this.updateTexture()}drawLetterSpacing(e,t,r,n=!1){const o=this._style.letterSpacing;let l=!1;if(ge.experimentalLetterSpacingSupported&&(ge.experimentalLetterSpacing?(this.context.letterSpacing=`${o}px`,this.context.textLetterSpacing=`${o}px`,l=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),o===0||l){n?this.context.strokeText(e,t,r):this.context.fillText(e,t,r);return}let h=t;const u=ge.graphemeSegmenter(e);let f=this.context.measureText(e).width,d=0;for(let g=0;g<u.length;++g){const m=u[g];n?this.context.strokeText(m,h,r):this.context.fillText(m,h,r);let v="";for(let _=g+1;_<u.length;++_)v+=u[_];d=this.context.measureText(v).width,h+=f-d+o,f=d}}updateTexture(){const e=this.canvas;if(this._style.trim){const o=tR(e);o.data&&(e.width=o.width,e.height=o.height,this.context.putImageData(o.data,0,0))}const t=this._texture,r=this._style,n=r.trim?0:r.padding,i=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-n,t.trim.y=-n,t.orig.width=t._frame.width-n*2,t.orig.height=t._frame.height-n*2,this._onTextureUpdate(),i.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),this._textureID===-1&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,r){const n=e.fill;if(Array.isArray(n)){if(n.length===1)return n[0]}else return n;let i;const o=e.dropShadow?e.dropShadowDistance:0,l=e.padding||0,h=this.canvas.width/this._resolution-o-l*2,u=this.canvas.height/this._resolution-o-l*2,f=n.slice(),d=e.fillGradientStops.slice();if(!d.length){const g=f.length+1;for(let m=1;m<g;++m)d.push(m/g)}if(f.unshift(n[0]),d.unshift(0),f.push(n[n.length-1]),d.push(1),e.fillGradientType===qa.LINEAR_VERTICAL){i=this.context.createLinearGradient(h/2,l,h/2,u+l);const g=r.fontProperties.fontSize+e.strokeThickness;for(let m=0;m<t.length;m++){const v=r.lineHeight*(m-1)+g,_=r.lineHeight*m;let w=_;m>0&&v>_&&(w=(_+v)/2);const x=_+g,A=r.lineHeight*(m+1);let S=x;m+1<t.length&&A<x&&(S=(x+A)/2);const E=(S-w)/u;for(let I=0;I<f.length;I++){let D=0;typeof d[I]=="number"?D=d[I]:D=I/f.length;let L=Math.min(1,Math.max(0,w/u+D*E));L=Number(L.toFixed(5)),i.addColorStop(L,f[I])}}}else{i=this.context.createLinearGradient(l,u/2,h+l,u/2);const g=f.length+1;let m=1;for(let v=0;v<f.length;v++){let _;typeof d[v]=="number"?_=d[v]:_=m/g,i.addColorStop(_,f[v]),m++}}return i}destroy(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},cB,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=Si(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=Si(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},e instanceof Kn?this._style=e:this._style=new Kn(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};let wc=Yu;wc.defaultAutoResolution=!0;class fB{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function dB(e,t){var n;let r=!1;if((n=e==null?void 0:e._textures)!=null&&n.length){for(let i=0;i<e._textures.length;i++)if(e._textures[i]instanceof it){const o=e._textures[i].baseTexture;t.includes(o)||(t.push(o),r=!0)}}return r}function pB(e,t){if(e.baseTexture instanceof gt){const r=e.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function gB(e,t){if(e._texture&&e._texture instanceof it){const r=e._texture.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function mB(e,t){return t instanceof wc?(t.updateText(!0),!0):!1}function vB(e,t){if(t instanceof Kn){const r=t.toFontString();return ge.measureFont(r),!0}return!1}function yB(e,t){if(e instanceof wc){t.includes(e.style)||t.push(e.style),t.includes(e)||t.push(e);const r=e._texture.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function _B(e,t){return e instanceof Kn?(t.includes(e)||t.push(e),!0):!1}const Mv=class{constructor(e){this.limiter=new fB(Mv.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(yB),this.registerFindHook(_B),this.registerFindHook(dB),this.registerFindHook(pB),this.registerFindHook(gB),this.registerUploadHook(mB),this.registerUploadHook(vB)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,Be.system.addOnce(this.tick,this,Ui.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed){for(let r=0,n=this.uploadHooks.length;r<n;r++)if(this.uploadHooks[r](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)Be.system.addOnce(this.tick,this,Ui.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,r=e.length;t<r;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,r=this.addHooks.length;t<r&&!this.addHooks[t](e,this.queue);t++);if(e instanceof $e)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&Be.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let Oa=Mv;Oa.uploadsPerFrame=4;Object.defineProperties(J,{UPLOADS_PER_FRAME:{get(){return Oa.uploadsPerFrame},set(e){Ct("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Oa.uploadsPerFrame=e}}});function Dv(e,t){return t instanceof gt?(t._glTextures[e.CONTEXT_UID]||e.texture.bind(t),!0):!1}function xB(e,t){if(!(t instanceof ja))return!1;const{geometry:r}=t;t.finishPoly(),r.updateBatches();const{batches:n}=r;for(let i=0;i<n.length;i++){const{texture:o}=n[i].style;o&&Dv(e,o.baseTexture)}return r.batchable||e.geometry.bind(r,t._resolveDirectShader(e)),!0}function bB(e,t){return e instanceof ja?(t.push(e),!0):!1}class Bv extends Oa{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(bB),this.registerUploadHook(Dv),this.registerUploadHook(xB)}}Bv.extension={name:"prepare",type:Z.RendererSystem};st.add(Bv);var wB=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,EB=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,TB=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,Mg=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,AB=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const ea=new Ht;class Ov extends za{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Xm,this.state=Zr.for2d()}contextChange(){const t=this.renderer,r={globals:t.globalUniforms};this.simpleShader=Br.from(Mg,AB,r),this.shader=t.context.webGLVersion>1?Br.from(EB,wB,r):Br.from(Mg,TB,r)}render(t){const r=this.renderer,n=this.quad;let i=n.vertices;i[0]=i[6]=t._width*-t.anchor.x,i[1]=i[3]=t._height*-t.anchor.y,i[2]=i[4]=t._width*(1-t.anchor.x),i[5]=i[7]=t._height*(1-t.anchor.y);const o=t.uvRespectAnchor?t.anchor.x:0,l=t.uvRespectAnchor?t.anchor.y:0;i=n.uvs,i[0]=i[6]=-o,i[1]=i[3]=-l,i[2]=i[4]=1-o,i[5]=i[7]=1-l,n.invalidate();const h=t._texture,u=h.baseTexture,f=u.alphaMode>0,d=t.tileTransform.localTransform,g=t.uvMatrix;let m=u.isPowerOfTwo&&h.frame.width===u.width&&h.frame.height===u.height;m&&(u._glTextures[r.CONTEXT_UID]?m=u.wrapMode!==gn.CLAMP:u.wrapMode===gn.CLAMP&&(u.wrapMode=gn.REPEAT));const v=m?this.simpleShader:this.shader,_=h.width,w=h.height,x=t._width,A=t._height;ea.set(d.a*_/x,d.b*_/A,d.c*w/x,d.d*w/A,d.tx/x,d.ty/A),ea.invert(),m?ea.prepend(g.mapCoord):(v.uniforms.uMapCoord=g.mapCoord.toArray(!0),v.uniforms.uClampFrame=g.uClampFrame,v.uniforms.uClampOffset=g.uClampOffset),v.uniforms.uTransform=ea.toArray(!0),v.uniforms.uColor=Cm(t.tint,t.worldAlpha,v.uniforms.uColor,f),v.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),v.uniforms.uSampler=h,r.shader.bind(v),r.geometry.bind(n),this.state.blendMode=Sm(t.blendMode,f),r.state.set(this.state),r.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Ov.extension={name:"tilingSprite",type:Z.RendererPlugin};st.add(Ov);const Ts=class{constructor(e,t,r=null){this.linkedSheets=[],this._texture=e instanceof it?e:null,this.baseTexture=e instanceof gt?e:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;const n=this.baseTexture.resource;this.resolution=this._updateResolution(r||(n?n.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:t}=this.data.meta;let r=mn(e,null);return r===null&&(r=parseFloat(t??"1")),r!==1&&this.baseTexture.setResolution(r),r}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=Ts.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e;const r=Ts.BATCH_SIZE;for(;t-e<r&&t<this._frameKeys.length;){const n=this._frameKeys[t],i=this._frames[n],o=i.frame;if(o){let l=null,h=null;const u=i.trimmed!==!1&&i.sourceSize?i.sourceSize:i.frame,f=new Tt(0,0,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution);i.rotated?l=new Tt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):l=new Tt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),i.trimmed!==!1&&i.spriteSourceSize&&(h=new Tt(Math.floor(i.spriteSourceSize.x)/this.resolution,Math.floor(i.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[n]=new it(this.baseTexture,l,f,h,i.rotated?2:0,i.anchor),it.addToCache(this.textures[n],n)}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let r=0;r<e[t].length;r++){const n=e[t][r];this.animations[t].push(this.textures[n])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Ts.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Ts.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){var t;for(const r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let ju=Ts;ju.BATCH_SIZE=1e3;const SB=["jpg","png","jpeg","avif","webp"];function Fv(e,t,r){const n={};if(e.forEach(i=>{n[i]=t}),Object.keys(t.textures).forEach(i=>{n[i]=t.textures[i]}),!r){const i=ve.dirname(e[0]);t.linkedSheets.forEach((o,l)=>{const h=Fv([`${i}/${t.data.meta.related_multi_packs[l]}`],o,!0);Object.assign(n,h)})}return n}const CB={extension:Z.Asset,cache:{test:e=>e instanceof ju,getCacheableAssets:(e,t)=>Fv(e,t,!1)},resolver:{test:e=>{const r=e.split("?")[0].split("."),n=r.pop(),i=r.pop();return n==="json"&&SB.includes(i)},parse:e=>{var r;const t=e.split(".");return{resolution:parseFloat(((r=J.RETINA_PREFIX.exec(e))==null?void 0:r[1])??"1"),format:t[t.length-2],src:e}}},loader:{extension:{type:Z.LoadParser,priority:Fr.Normal},async testParse(e,t){return ve.extname(t.src).toLowerCase()===".json"&&!!e.frames},async parse(e,t,r){var f,d;let n=ve.dirname(t.src);n&&n.lastIndexOf("/")!==n.length-1&&(n+="/");const i=n+e.meta.image,l=(await r.load([i]))[i],h=new ju(l.baseTexture,e,t.src);await h.parse();const u=(f=e==null?void 0:e.meta)==null?void 0:f.related_multi_packs;if(Array.isArray(u)){const g=[];for(const v of u){if(typeof v!="string")continue;const _=n+v;(d=t.data)!=null&&d.ignoreMultiPack||g.push(r.load({src:_,data:{ignoreMultiPack:!0}}))}const m=await Promise.all(g);h.linkedSheets=m,m.forEach(v=>{v.linkedSheets=[h].concat(h.linkedSheets.filter(_=>_!==v))})}return h},unload(e){e.destroy(!0)}}};st.add(CB);class Fa{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class ga{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const r=t.match(/^[a-z]+\s+.+$/gm),n={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const o in r){const l=r[o].match(/^[a-z]+/gm)[0],h=r[o].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),u={};for(const f in h){const d=h[f].split("="),g=d[0],m=d[1].replace(/"/gm,""),v=parseFloat(m),_=isNaN(v)?m:v;u[g]=_}n[l].push(u)}const i=new Fa;return n.info.forEach(o=>i.info.push({face:o.face,size:parseInt(o.size,10)})),n.common.forEach(o=>i.common.push({lineHeight:parseInt(o.lineHeight,10)})),n.page.forEach(o=>i.page.push({id:parseInt(o.id,10),file:o.file})),n.char.forEach(o=>i.char.push({id:parseInt(o.id,10),page:parseInt(o.page,10),x:parseInt(o.x,10),y:parseInt(o.y,10),width:parseInt(o.width,10),height:parseInt(o.height,10),xoffset:parseInt(o.xoffset,10),yoffset:parseInt(o.yoffset,10),xadvance:parseInt(o.xadvance,10)})),n.kerning.forEach(o=>i.kerning.push({first:parseInt(o.first,10),second:parseInt(o.second,10),amount:parseInt(o.amount,10)})),n.distanceField.forEach(o=>i.distanceField.push({distanceRange:parseInt(o.distanceRange,10),fieldType:o.fieldType})),i}}class qu{static test(t){const r=t;return"getElementsByTagName"in r&&r.getElementsByTagName("page").length&&r.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const r=new Fa,n=t.getElementsByTagName("info"),i=t.getElementsByTagName("common"),o=t.getElementsByTagName("page"),l=t.getElementsByTagName("char"),h=t.getElementsByTagName("kerning"),u=t.getElementsByTagName("distanceField");for(let f=0;f<n.length;f++)r.info.push({face:n[f].getAttribute("face"),size:parseInt(n[f].getAttribute("size"),10)});for(let f=0;f<i.length;f++)r.common.push({lineHeight:parseInt(i[f].getAttribute("lineHeight"),10)});for(let f=0;f<o.length;f++)r.page.push({id:parseInt(o[f].getAttribute("id"),10)||0,file:o[f].getAttribute("file")});for(let f=0;f<l.length;f++){const d=l[f];r.char.push({id:parseInt(d.getAttribute("id"),10),page:parseInt(d.getAttribute("page"),10)||0,x:parseInt(d.getAttribute("x"),10),y:parseInt(d.getAttribute("y"),10),width:parseInt(d.getAttribute("width"),10),height:parseInt(d.getAttribute("height"),10),xoffset:parseInt(d.getAttribute("xoffset"),10),yoffset:parseInt(d.getAttribute("yoffset"),10),xadvance:parseInt(d.getAttribute("xadvance"),10)})}for(let f=0;f<h.length;f++)r.kerning.push({first:parseInt(h[f].getAttribute("first"),10),second:parseInt(h[f].getAttribute("second"),10),amount:parseInt(h[f].getAttribute("amount"),10)});for(let f=0;f<u.length;f++)r.distanceField.push({fieldType:u[f].getAttribute("fieldType"),distanceRange:parseInt(u[f].getAttribute("distanceRange"),10)});return r}}class Ku{static test(t){return typeof t=="string"&&t.includes("<font>")?qu.test(J.ADAPTER.parseXML(t)):!1}static parse(t){return qu.parse(J.ADAPTER.parseXML(t))}}const tu=[ga,qu,Ku];function IB(e){for(let t=0;t<tu.length;t++)if(tu[t].test(e))return tu[t];return null}function PB(e,t,r,n,i,o){const l=r.fill;if(Array.isArray(l)){if(l.length===1)return l[0]}else return l;let h;const u=r.dropShadow?r.dropShadowDistance:0,f=r.padding||0,d=e.width/n-u-f*2,g=e.height/n-u-f*2,m=l.slice(),v=r.fillGradientStops.slice();if(!v.length){const _=m.length+1;for(let w=1;w<_;++w)v.push(w/_)}if(m.unshift(l[0]),v.unshift(0),m.push(l[l.length-1]),v.push(1),r.fillGradientType===qa.LINEAR_VERTICAL){h=t.createLinearGradient(d/2,f,d/2,g+f);let _=0;const x=(o.fontProperties.fontSize+r.strokeThickness)/g;for(let A=0;A<i.length;A++){const S=o.lineHeight*A;for(let E=0;E<m.length;E++){let I=0;typeof v[E]=="number"?I=v[E]:I=E/m.length;const D=S/g+I*x;let L=Math.max(_,D);L=Math.min(L,1),h.addColorStop(L,m[E]),_=L}}}else{h=t.createLinearGradient(f,g/2,d+f,g/2);const _=m.length+1;let w=1;for(let x=0;x<m.length;x++){let A;typeof v[x]=="number"?A=v[x]:A=w/_,h.addColorStop(A,m[x]),w++}}return h}function RB(e,t,r,n,i,o,l){const h=r.text,u=r.fontProperties;t.translate(n,i),t.scale(o,o);const f=l.strokeThickness/2,d=-(l.strokeThickness/2);if(t.font=l.toFontString(),t.lineWidth=l.strokeThickness,t.textBaseline=l.textBaseline,t.lineJoin=l.lineJoin,t.miterLimit=l.miterLimit,t.fillStyle=PB(e,t,l,o,[h],r),t.strokeStyle=l.stroke,l.dropShadow){const g=l.dropShadowColor,m=Bs(typeof g=="number"?g:cc(g)),v=l.dropShadowBlur*o,_=l.dropShadowDistance*o;t.shadowColor=`rgba(${m[0]*255},${m[1]*255},${m[2]*255},${l.dropShadowAlpha})`,t.shadowBlur=v,t.shadowOffsetX=Math.cos(l.dropShadowAngle)*_,t.shadowOffsetY=Math.sin(l.dropShadowAngle)*_}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;l.stroke&&l.strokeThickness&&t.strokeText(h,f,d+r.lineHeight-u.descent),l.fill&&t.fillText(h,f,d+r.lineHeight-u.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function ma(e){return e.codePointAt?e.codePointAt(0):e.charCodeAt(0)}function Lv(e){return Array.from?Array.from(e):e.split("")}function MB(e){typeof e=="string"&&(e=[e]);const t=[];for(let r=0,n=e.length;r<n;r++){const i=e[r];if(Array.isArray(i)){if(i.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${i.length}.`);const o=i[0].charCodeAt(0),l=i[1].charCodeAt(0);if(l<o)throw new Error("[BitmapFont]: Invalid character range.");for(let h=o,u=l;h<=u;h++)t.push(String.fromCharCode(h))}else t.push(...Lv(i))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const cr=class{constructor(e,t,r){var f;const[n]=e.info,[i]=e.common,[o]=e.page,[l]=e.distanceField,h=mn(o.file),u={};this._ownsTextures=r,this.font=n.face,this.size=n.size,this.lineHeight=i.lineHeight/h,this.chars={},this.pageTextures=u;for(let d=0;d<e.page.length;d++){const{id:g,file:m}=e.page[d];u[g]=t instanceof Array?t[d]:t[m],l!=null&&l.fieldType&&l.fieldType!=="none"&&(u[g].baseTexture.alphaMode=_r.NO_PREMULTIPLIED_ALPHA,u[g].baseTexture.mipmap=Or.OFF)}for(let d=0;d<e.char.length;d++){const{id:g,page:m}=e.char[d];let{x:v,y:_,width:w,height:x,xoffset:A,yoffset:S,xadvance:E}=e.char[d];v/=h,_/=h,w/=h,x/=h,A/=h,S/=h,E/=h;const I=new Tt(v+u[m].frame.x/h,_+u[m].frame.y/h,w,x);this.chars[g]={xOffset:A,yOffset:S,xAdvance:E,kerning:{},texture:new it(u[m].baseTexture,I),page:m}}for(let d=0;d<e.kerning.length;d++){let{first:g,second:m,amount:v}=e.kerning[d];g/=h,m/=h,v/=h,this.chars[m]&&(this.chars[m].kerning[g]=v)}this.distanceFieldRange=l==null?void 0:l.distanceRange,this.distanceFieldType=((f=l==null?void 0:l.fieldType)==null?void 0:f.toLowerCase())??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(e,t,r){let n;if(e instanceof Fa)n=e;else{const o=IB(e);if(!o)throw new Error("Unrecognized data format for font.");n=o.parse(e)}t instanceof it&&(t=[t]);const i=new cr(n,t,r);return cr.available[i.font]=i,i}static uninstall(e){const t=cr.available[e];if(!t)throw new Error(`No font found named '${e}'`);t.destroy(),delete cr.available[e]}static from(e,t,r){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:n,padding:i,resolution:o,textureWidth:l,textureHeight:h,...u}=Object.assign({},cr.defaultOptions,r),f=MB(n),d=t instanceof Kn?t:new Kn(t),g=l,m=new Fa;m.info[0]={face:d.fontFamily,size:d.fontSize},m.common[0]={lineHeight:d.fontSize};let v=0,_=0,w,x,A,S=0;const E=[];for(let D=0;D<f.length;D++){w||(w=J.ADAPTER.createCanvas(),w.width=l,w.height=h,x=w.getContext("2d"),A=new gt(w,{resolution:o,...u}),E.push(new it(A)),m.page.push({id:E.length-1,file:""}));const L=f[D],O=ge.measureText(L,d,!1,w),F=O.width,z=Math.ceil(O.height),j=Math.ceil((d.fontStyle==="italic"?2:1)*F);if(_>=h-z*o){if(_===0)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${L}')`);--D,w=null,x=null,A=null,_=0,v=0,S=0;continue}if(S=Math.max(z+O.fontProperties.descent,S),j*o+v>=g){if(v===0)throw new Error(`[BitmapFont] textureWidth ${l}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${L}')`);--D,_+=S*o,_=Math.ceil(_),v=0,S=0;continue}RB(w,x,O,v,_,o,d);const X=ma(O.text);m.char.push({id:X,page:E.length-1,x:v/o,y:_/o,width:j,height:z,xoffset:0,yoffset:0,xadvance:Math.ceil(F-(d.dropShadow?d.dropShadowDistance:0)-(d.stroke?d.strokeThickness:0))}),v+=(j+2*i)*o,v=Math.ceil(v)}for(let D=0,L=f.length;D<L;D++){const O=f[D];for(let F=0;F<L;F++){const z=f[F],j=x.measureText(O).width,X=x.measureText(z).width,W=x.measureText(O+z).width-(j+X);W&&m.kerning.push({first:ma(O),second:ma(z),amount:W})}}const I=new cr(m,E,!0);return cr.available[e]!==void 0&&cr.uninstall(e),cr.available[e]=I,I}};let Me=cr;Me.ALPHA=[["a","z"],["A","Z"]," "];Me.NUMERIC=[["0","9"]];Me.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];Me.ASCII=[[" ","~"]];Me.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:cr.ALPHANUMERIC};Me.available={};var DB=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r
\r
}\r
`,BB=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const Dg=[],Bg=[],Og=[],Nv=class extends $e{constructor(e,t={}){super(),this._tint=16777215;const{align:r,tint:n,maxWidth:i,letterSpacing:o,fontName:l,fontSize:h}=Object.assign({},Nv.styleDefaults,t);if(!Me.available[l])throw new Error(`Missing BitmapFont "${l}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=r,this._tint=n,this._font=void 0,this._fontName=l,this._fontSize=h,this.text=e,this._maxWidth=i,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new dn(()=>{this.dirty=!0},this,0,0),this._roundPixels=J.ROUND_PIXELS,this.dirty=!0,this._resolution=J.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var j;const e=Me.available[this._fontName],t=this.fontSize,r=t/e.size,n=new St,i=[],o=[],l=[],h=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",u=Lv(h),f=this._maxWidth*e.size/t,d=e.distanceFieldType==="none"?Dg:Bg;let g=null,m=0,v=0,_=0,w=-1,x=0,A=0,S=0,E=0;for(let X=0;X<u.length;X++){const K=u[X],W=ma(K);if(/(?:\s)/.test(K)&&(w=X,x=m,E++),K==="\r"||K===`
`){o.push(m),l.push(-1),v=Math.max(v,m),++_,++A,n.x=0,n.y+=e.lineHeight,g=null,E=0;continue}const k=e.chars[W];if(!k)continue;g&&k.kerning[g]&&(n.x+=k.kerning[g]);const lt=Og.pop()||{texture:it.EMPTY,line:0,charCode:0,prevSpaces:0,position:new St};lt.texture=k.texture,lt.line=_,lt.charCode=W,lt.position.x=n.x+k.xOffset+this._letterSpacing/2,lt.position.y=n.y+k.yOffset,lt.prevSpaces=E,i.push(lt),m=lt.position.x+Math.max(k.xAdvance-k.xOffset,k.texture.orig.width),n.x+=k.xAdvance+this._letterSpacing,S=Math.max(S,k.yOffset+k.texture.height),g=W,w!==-1&&f>0&&n.x>f&&(++A,Bi(i,1+w-A,1+X-w),X=w,w=-1,o.push(x),l.push(i.length>0?i[i.length-1].prevSpaces:0),v=Math.max(v,x),_++,n.x=0,n.y+=e.lineHeight,g=null,E=0)}const I=u[u.length-1];I!=="\r"&&I!==`
`&&(/(?:\s)/.test(I)&&(m=x),o.push(m),v=Math.max(v,m),l.push(-1));const D=[];for(let X=0;X<=_;X++){let K=0;this._align==="right"?K=v-o[X]:this._align==="center"?K=(v-o[X])/2:this._align==="justify"&&(K=l[X]<0?0:(v-o[X])/l[X]),D.push(K)}const L=i.length,O={},F=[],z=this._activePagesMeshData;d.push(...z);for(let X=0;X<L;X++){const K=i[X].texture,W=K.baseTexture.uid;if(!O[W]){let k=d.pop();if(!k){const dt=new iB;let Y,yt;e.distanceFieldType==="none"?(Y=new Ig(it.EMPTY),yt=ct.NORMAL):(Y=new Ig(it.EMPTY,{program:pr.from(BB,DB),uniforms:{uFWidth:0}}),yt=ct.NORMAL_NPM);const Ot=new Vu(dt,Y);Ot.blendMode=yt,k={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:Ot,vertices:null,uvs:null,indices:null}}k.index=0,k.indexCount=0,k.vertexCount=0,k.uvsCount=0,k.total=0;const{_textureCache:lt}=this;lt[W]=lt[W]||new it(K.baseTexture),k.mesh.texture=lt[W],k.mesh.tint=this._tint,F.push(k),O[W]=k}O[W].total++}for(let X=0;X<z.length;X++)F.includes(z[X])||this.removeChild(z[X].mesh);for(let X=0;X<F.length;X++)F[X].mesh.parent!==this&&this.addChild(F[X].mesh);this._activePagesMeshData=F;for(const X in O){const K=O[X],W=K.total;if(!(((j=K.indices)==null?void 0:j.length)>6*W)||K.vertices.length<Vu.BATCHABLE_SIZE*2)K.vertices=new Float32Array(4*2*W),K.uvs=new Float32Array(4*2*W),K.indices=new Uint16Array(6*W);else{const k=K.total,lt=K.vertices;for(let dt=k*4*2;dt<lt.length;dt++)lt[dt]=0}K.mesh.size=6*W}for(let X=0;X<L;X++){const K=i[X];let W=K.position.x+D[K.line]*(this._align==="justify"?K.prevSpaces:1);this._roundPixels&&(W=Math.round(W));const k=W*r,lt=K.position.y*r,dt=K.texture,Y=O[dt.baseTexture.uid],yt=dt.frame,Ot=dt._uvs,H=Y.index++;Y.indices[H*6+0]=0+H*4,Y.indices[H*6+1]=1+H*4,Y.indices[H*6+2]=2+H*4,Y.indices[H*6+3]=0+H*4,Y.indices[H*6+4]=2+H*4,Y.indices[H*6+5]=3+H*4,Y.vertices[H*8+0]=k,Y.vertices[H*8+1]=lt,Y.vertices[H*8+2]=k+yt.width*r,Y.vertices[H*8+3]=lt,Y.vertices[H*8+4]=k+yt.width*r,Y.vertices[H*8+5]=lt+yt.height*r,Y.vertices[H*8+6]=k,Y.vertices[H*8+7]=lt+yt.height*r,Y.uvs[H*8+0]=Ot.x0,Y.uvs[H*8+1]=Ot.y0,Y.uvs[H*8+2]=Ot.x1,Y.uvs[H*8+3]=Ot.y1,Y.uvs[H*8+4]=Ot.x2,Y.uvs[H*8+5]=Ot.y2,Y.uvs[H*8+6]=Ot.x3,Y.uvs[H*8+7]=Ot.y3}this._textWidth=v*r,this._textHeight=(n.y+e.lineHeight)*r;for(const X in O){const K=O[X];if(this.anchor.x!==0||this.anchor.y!==0){let dt=0;const Y=this._textWidth*this.anchor.x,yt=this._textHeight*this.anchor.y;for(let Ot=0;Ot<K.total;Ot++)K.vertices[dt++]-=Y,K.vertices[dt++]-=yt,K.vertices[dt++]-=Y,K.vertices[dt++]-=yt,K.vertices[dt++]-=Y,K.vertices[dt++]-=yt,K.vertices[dt++]-=Y,K.vertices[dt++]-=yt}this._maxLineHeight=S*r;const W=K.mesh.geometry.getBuffer("aVertexPosition"),k=K.mesh.geometry.getBuffer("aTextureCoord"),lt=K.mesh.geometry.getIndex();W.data=K.vertices,k.data=K.uvs,lt.data=K.indices,W.update(),k.update(),lt.update()}for(let X=0;X<i.length;X++)Og.push(i[X]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:r,size:n}=Me.available[this._fontName];if(r!=="none"){const{a:i,b:o,c:l,d:h}=this.worldTransform,u=Math.sqrt(i*i+o*o),f=Math.sqrt(l*l+h*h),d=(Math.abs(u)+Math.abs(f))/2,g=this.fontSize/n,m=e._view.resolution;for(const v of this._activePagesMeshData)v.mesh.shader.uniforms.uFWidth=d*t*g*m}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=Me.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tint}set tint(e){if(this._tint!==e){this._tint=e;for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!Me.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??Me.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,n=Me.available[this._fontName].distanceFieldType==="none"?Dg:Bg;n.push(...this._activePagesMeshData);for(const i of this._activePagesMeshData)this.removeChild(i.mesh);this._activePagesMeshData=[],n.filter(i=>t[i.mesh.texture.baseTexture.uid]).forEach(i=>{i.mesh.texture=it.EMPTY});for(const i in t)t[i].destroy(),delete t[i];this._font=null,this._textureCache=null,super.destroy(e)}};let OB=Nv;OB.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const FB=[".xml",".fnt"],LB={extension:{type:Z.LoadParser,priority:Fr.Normal},test(e){return FB.includes(ve.extname(e).toLowerCase())},async testParse(e){return ga.test(e)||Ku.test(e)},async parse(e,t,r){const n=ga.test(e)?ga.parse(e):Ku.parse(e),{src:i}=t,{page:o}=n,l=[];for(let f=0;f<o.length;++f){const d=o[f].file,g=ve.join(ve.dirname(i),d);l.push(g)}const h=await r.load(l),u=l.map(f=>h[f]);return Me.install(n,u,!0)},async load(e,t){return(await J.ADAPTER.fetch(e)).text()},unload(e){e.destroy()}};st.add(LB);const NB={A:"menlo-bold-0.png",B:"menlo-bold-1.png",C:"menlo-bold-2.png",D:"menlo-bold-3.png",E:"menlo-bold-4.png",F:"menlo-bold-5.png",G:"menlo-bold-6.png",H:"menlo-bold-7.png",I:"menlo-bold-8.png",J:"menlo-bold-9.png",K:"menlo-bold-10.png",L:"menlo-bold-11.png",M:"menlo-bold-12.png",N:"menlo-bold-13.png",O:"menlo-bold-14.png",P:"menlo-bold-15.png",Q:"menlo-bold-16.png",R:"menlo-bold-17.png",S:"menlo-bold-18.png",T:"menlo-bold-19.png",U:"menlo-bold-20.png",V:"menlo-bold-21.png",W:"menlo-bold-22.png",X:"menlo-bold-23.png",Y:"menlo-bold-24.png",Z:"menlo-bold-25.png",a:"menlo-bold-26.png",b:"menlo-bold-27.png",c:"menlo-bold-28.png",d:"menlo-bold-29.png",e:"menlo-bold-30.png",f:"menlo-bold-31.png",g:"menlo-bold-32.png",h:"menlo-bold-33.png",i:"menlo-bold-34.png",j:"menlo-bold-35.png",k:"menlo-bold-36.png",l:"menlo-bold-37.png",m:"menlo-bold-38.png",n:"menlo-bold-39.png",o:"menlo-bold-40.png",p:"menlo-bold-41.png",q:"menlo-bold-42.png",r:"menlo-bold-43.png",s:"menlo-bold-44.png",t:"menlo-bold-45.png",u:"menlo-bold-46.png",v:"menlo-bold-47.png",w:"menlo-bold-48.png",x:"menlo-bold-49.png",y:"menlo-bold-50.png",z:"menlo-bold-51.png",0:"menlo-bold-52.png",1:"menlo-bold-53.png",2:"menlo-bold-54.png",3:"menlo-bold-55.png",4:"menlo-bold-56.png",5:"menlo-bold-57.png",6:"menlo-bold-58.png",7:"menlo-bold-59.png",8:"menlo-bold-60.png",9:"menlo-bold-61.png","!":"menlo-bold-62.png","@":"menlo-bold-63.png","#":"menlo-bold-64.png",$:"menlo-bold-65.png","%":"menlo-bold-66.png","^":"menlo-bold-67.png","&":"menlo-bold-68.png","*":"menlo-bold-69.png","(":"menlo-bold-70.png",")":"menlo-bold-71.png","-":"menlo-bold-72.png",_:"menlo-bold-73.png","=":"menlo-bold-74.png","+":"menlo-bold-75.png",",":"menlo-bold-76.png",".":"menlo-bold-77.png","<":"menlo-bold-78.png",">":"menlo-bold-79.png","/":"menlo-bold-80.png","?":"menlo-bold-81.png",";":"menlo-bold-82.png",":":"menlo-bold-83.png",'"':"menlo-bold-84.png","'":"menlo-bold-85.png","[":"menlo-bold-86.png","]":"menlo-bold-87.png","{":"menlo-bold-88.png","}":"menlo-bold-89.png","\\":"menlo-bold-90.png","|":"menlo-bold-91.png","`":"menlo-bold-92.png","~":"menlo-bold-93.png","•":"menlo-bold-94.png"},kB={A:"menlo-bold-half-0.png",B:"menlo-bold-half-1.png",C:"menlo-bold-half-2.png",D:"menlo-bold-half-3.png",E:"menlo-bold-half-4.png",F:"menlo-bold-half-5.png",G:"menlo-bold-half-6.png",H:"menlo-bold-half-7.png",I:"menlo-bold-half-8.png",J:"menlo-bold-half-9.png",K:"menlo-bold-half-10.png",L:"menlo-bold-half-11.png",M:"menlo-bold-half-12.png",N:"menlo-bold-half-13.png",O:"menlo-bold-half-14.png",P:"menlo-bold-half-15.png",Q:"menlo-bold-half-16.png",R:"menlo-bold-half-17.png",S:"menlo-bold-half-18.png",T:"menlo-bold-half-19.png",U:"menlo-bold-half-20.png",V:"menlo-bold-half-21.png",W:"menlo-bold-half-22.png",X:"menlo-bold-half-23.png",Y:"menlo-bold-half-24.png",Z:"menlo-bold-half-25.png",a:"menlo-bold-half-26.png",b:"menlo-bold-half-27.png",c:"menlo-bold-half-28.png",d:"menlo-bold-half-29.png",e:"menlo-bold-half-30.png",f:"menlo-bold-half-31.png",g:"menlo-bold-half-32.png",h:"menlo-bold-half-33.png",i:"menlo-bold-half-34.png",j:"menlo-bold-half-35.png",k:"menlo-bold-half-36.png",l:"menlo-bold-half-37.png",m:"menlo-bold-half-38.png",n:"menlo-bold-half-39.png",o:"menlo-bold-half-40.png",p:"menlo-bold-half-41.png",q:"menlo-bold-half-42.png",r:"menlo-bold-half-43.png",s:"menlo-bold-half-44.png",t:"menlo-bold-half-45.png",u:"menlo-bold-half-46.png",v:"menlo-bold-half-47.png",w:"menlo-bold-half-48.png",x:"menlo-bold-half-49.png",y:"menlo-bold-half-50.png",z:"menlo-bold-half-51.png",0:"menlo-bold-half-52.png",1:"menlo-bold-half-53.png",2:"menlo-bold-half-54.png",3:"menlo-bold-half-55.png",4:"menlo-bold-half-56.png",5:"menlo-bold-half-57.png",6:"menlo-bold-half-58.png",7:"menlo-bold-half-59.png",8:"menlo-bold-half-60.png",9:"menlo-bold-half-61.png","!":"menlo-bold-half-62.png","@":"menlo-bold-half-63.png","#":"menlo-bold-half-64.png",$:"menlo-bold-half-65.png","%":"menlo-bold-half-66.png","^":"menlo-bold-half-67.png","&":"menlo-bold-half-68.png","*":"menlo-bold-half-69.png","(":"menlo-bold-half-70.png",")":"menlo-bold-half-71.png","-":"menlo-bold-half-72.png",_:"menlo-bold-half-73.png","=":"menlo-bold-half-74.png","+":"menlo-bold-half-75.png",",":"menlo-bold-half-76.png",".":"menlo-bold-half-77.png","<":"menlo-bold-half-78.png",">":"menlo-bold-half-79.png","/":"menlo-bold-half-80.png","?":"menlo-bold-half-81.png",";":"menlo-bold-half-82.png",":":"menlo-bold-half-83.png",'"':"menlo-bold-half-84.png","'":"menlo-bold-half-85.png","[":"menlo-bold-half-86.png","]":"menlo-bold-half-87.png","{":"menlo-bold-half-88.png","}":"menlo-bold-half-89.png","\\":"menlo-bold-half-90.png","|":"menlo-bold-half-91.png","`":"menlo-bold-half-92.png","~":"menlo-bold-half-93.png","•":"menlo-bold-half-94.png"};let kv;const Uv={width:100,height:46},cn=window.innerWidth/Uv.width,UB=(e,t,r)=>{const n=Math.trunc(e/cn),i=Math.trunc(t/cn);return`${n},${i},${r}`},zn={};async function GB(e){kv=new yc({view:e,width:window.innerWidth,height:cn*Uv.height,autoDensity:!0,resolution:window.devicePixelRatio||1}),await WB()}const WB=async()=>(zn.ascii=await $n.load("/forcecrusher/fonts/menlo-bold.json"),zn.text=await $n.load("/forcecrusher/fonts/menlo-bold-half.json"),zn.tile=await $n.load("/forcecrusher/tile.png"),zn),$B=e=>zn.ascii.textures[NB[e]],HB=e=>zn.text.textures[kB[e]],zB=()=>zn.tile;class Ar{constructor(t){Jt(this,"x",0);Jt(this,"y",0);Jt(this,"halfWidth",!1);Jt(this,"width");Jt(this,"height");Jt(this,"layers",[]);Jt(this,"sprites",[]);Jt(this,"tileSets",[]);Jt(this,"tints",[]);Jt(this,"alphas",[]);Jt(this,"visible",!0);Jt(this,"_getTexture",t=>{const{tileSet:r,char:n}=t;return r==="ascii"?$B(n):r==="text"?HB(n):zB()});Jt(this,"_createSprite",t=>{const{char:r,width:n,height:i,layer:o,x:l,y:h,tileSet:u,tint:f=16777215,alpha:d=1}=t,g=this._getTexture({tileSet:u,char:r});let m=new ji(g);m.width=this.halfWidth?n/2:n,m.height=i,m.x=this.halfWidth?l*(n/2):l*n,m.y=h*i,m.tint=f,m.alpha=d,this.sprites[o][h][l]=m,this.layers[o].addChild(m)});Jt(this,"updateCell",t=>(Object.keys(t).forEach(r=>{const{char:n,tint:i,alpha:o,tileSet:l,x:h,y:u}=t[r];this.updateSprite({char:n,tint:i,alpha:o,tileSet:l,x:h,y:u,layer:parseInt(r)})}),this));Jt(this,"updateSprite",async t=>{const{char:r="",layer:n,x:i,y:o,tileSet:l="text",tint:h,alpha:u}=t,f=this.sprites[n][o][i];if(f)return f.texture=this._getTexture({tileSet:l,char:r}),h&&(f.tint=h),typeof u<"u"&&(f.alpha=u),this});Jt(this,"updateRows",t=>(t.forEach((r,n)=>{r.forEach((i,o)=>{this.clearRow(o,n),this.updateRow({...i,layer:o,y:n})})}),this));Jt(this,"updateRow",t=>{const{string:r="",layer:n=0,x:i,y:o,tileSet:l,tint:h,alpha:u}=t;return[...r].forEach((d,g)=>this.updateSprite({char:d,layer:n||0,x:i||0+g,y:o||0,tileSet:l||this.tileSets[n],tint:h||this.tints[n],alpha:u||this.alphas[n]})),(l||this.tileSets[n])==="tile"&&Bn.times(this.width,d=>{this.updateSprite({layer:n,x:i||0+d,y:o||0,tileSet:l||this.tileSets[n],tint:h||this.tints[n],alpha:u||this.alphas[n]})}),this});Jt(this,"clearRow",(t,r)=>{const n=new Array(this.width+1).join(" ");this.updateRow({string:n,layer:t,y:r})});Jt(this,"clearView",()=>{let t=0;this.layers.forEach(()=>{Bn.times(this.height,r=>{this.clearRow(t,r)}),t+=1})});Jt(this,"show",()=>{this.visible=!0,this.layers.forEach(t=>t.visible=this.visible)});Jt(this,"hide",()=>{this.visible=!1,this.layers.forEach(t=>t.visible=this.visible)});return this.width=t.width,this.height=t.height,this.tileSets=t.tileSets,this.tints=t.tints,this.alphas=t.alphas,this.halfWidth=this.tileSets.includes("text"),this.visible=t.visible,Bn.times(t.layers,()=>this.layers.push(new $e)),this.layers.forEach(r=>{const n=this.halfWidth?t.x*(cn/2):t.x*cn,i=t.y*cn;r.x=n,r.y=i,r.interactiveChildren=!1,r.visible=this.visible,kv.stage.addChild(r)}),Bn.times(t.layers,()=>this.sprites.push(Array.from(Array(this.height),()=>Array.from(Array(this.width))))),Bn.times(t.layers,r=>{Bn.times(this.height,n=>{Bn.times(this.width,async i=>{this._createSprite({char:"",width:cn,height:cn,layer:r,x:i,y:n,tileSet:t.tileSets[r],tint:t.tints[r],alpha:t.alphas[r]})})})}),this}}var Gv={exports:{}},Ec={};Object.defineProperty(Ec,"__esModule",{value:!0});function Zu(e,t){t=e.length;for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function XB(e){if(Array.isArray(e))return Zu(e)}function VB(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Wv(e,t){if(e){if(typeof e=="string")return Zu(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zu(e,t)}}function YB(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jB(e){return XB(e)||VB(e)||Wv(e)||YB()}function qB(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Wv(e))||t){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,l=!1,h;return{s:function(){r=r.call(e)},n:function(){var u=r.next();return o=u.done,u},e:function(u){l=!0,h=u},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(l)throw h}}}}function KB(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ZB(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function $v(e){var t=ZB(e,"string");return typeof t=="symbol"?t:String(t)}function JB(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,$v(n.key),n)}}function QB(e,t,r){return t&&JB(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function tO(e,t,r){return t=$v(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var eO=function(){function e(){KB(this,e),tO(this,"subscribers",new Set)}return QB(e,[{key:"onSubscribe",get:function(){return this._onSubscribe||(this._onSubscribe=new e),this._onSubscribe}},{key:"onUnsubscribe",get:function(){return this._onUnsubscribe||(this._onUnsubscribe=new e),this._onUnsubscribe}},{key:"subscribe",value:function(r){var n,i=this;return this.subscribers.add(r),(n=this._onSubscribe)===null||n===void 0||n.emit(r),function(){return i.unsubscribe(r)}}},{key:"unsubscribe",value:function(r){var n;this.subscribers.delete(r),(n=this._onUnsubscribe)===null||n===void 0||n.emit(r)}},{key:"clear",value:function(){if(this._onUnsubscribe){var r=qB(this.subscribers),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;this._onUnsubscribe.emit(i)}}catch(o){r.e(o)}finally{r.f()}}this.subscribers.clear()}},{key:"emit",value:function(){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];this.subscribers.forEach(function(o){return o.apply(void 0,n)})}},{key:"emitAsync",value:function(){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return Promise.all(jB(this.subscribers).map(function(o){return o.apply(void 0,n)}))}}]),e}();Ec.Event=eO;Gv.exports=Ec;var Fg=Gv.exports;function Lg(e,t){t=e.length;for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function rO(e,t){if(e){if(typeof e=="string")return Lg(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Lg(e,t)}}function nO(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=rO(e))||t){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,l=!1,h;return{s:function(){r=r.call(e)},n:function(){var u=r.next();return o=u.done,u},e:function(u){l=!0,h=u},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(l)throw h}}}}function iO(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function sO(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Hv(e){var t=sO(e,"string");return typeof t=="symbol"?t:String(t)}function oO(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Hv(n.key),n)}}function aO(e,t,r){return t&&oO(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function ra(e,t,r){return t=Hv(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var zv;zv=Symbol.iterator;var Xv=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];iO(this,e),ra(this,"_version",0),ra(this,"onEntityAdded",new Fg.Event),ra(this,"onEntityRemoved",new Fg.Event),ra(this,"entityPositions",new Map),this._entities=t,this.add=this.add.bind(this),this.remove=this.remove.bind(this);for(var r=0;r<t.length;r++)this.entityPositions.set(t[r],r)}return aO(e,[{key:"version",get:function(){return this._version}},{key:"entities",get:function(){return this._entities}},{key:zv,value:function(){var r=this,n=this._entities.length,i={value:void 0,done:!1};return{next:function(){return i.value=r._entities[--n],i.done=n<0,i}}}},{key:"size",get:function(){return this.entities.length}},{key:"first",get:function(){return this.entities[0]}},{key:"has",value:function(r){return this.entityPositions.has(r)}},{key:"add",value:function(r){return r&&!this.has(r)&&(this.entities.push(r),this.entityPositions.set(r,this.entities.length-1),this._version++,this.onEntityAdded.emit(r)),r}},{key:"remove",value:function(r){if(this.has(r)){this.onEntityRemoved.emit(r);var n=this.entityPositions.get(r);this.entityPositions.delete(r);var i=this.entities[this.entities.length-1];i!==r&&(this.entities[n]=i,this.entityPositions.set(i,n)),this.entities.pop(),this._version++}return r}},{key:"clear",value:function(){var r=nO(this),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;this.remove(i)}}catch(o){r.e(o)}finally{r.f()}}}]),e}(),Ng=new WeakMap,kg=0,lO=function(t){var r=Ng.get(t);return r!==void 0?r:(Ng.set(t,kg),kg++)};function hO(){var e=new Array;function t(i){e.push(i)}function r(){e.length=0}function n(){e.forEach(function(i){return i()}),r()}return t.clear=r,t.flush=n,t}function Ju(e,t){t=e.length;for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function uO(e){if(Array.isArray(e))return Ju(e)}function cO(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Vv(e,t){if(e){if(typeof e=="string")return Ju(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ju(e,t)}}function fO(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Is(e){return uO(e)||cO(e)||Vv(e)||fO()}function Zn(e){return Zn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Zn(e)}function dO(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=Zn(e),e!==null););return e}function Ps(){return typeof Reflect<"u"&&Reflect.get?Ps=Reflect.get.bind():Ps=function(t,r,n){var i=dO(t,r);if(i){var o=Object.getOwnPropertyDescriptor(i,r);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Ps.apply(this,arguments)}function Qu(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Vv(e))||t){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,l=!1,h;return{s:function(){r=r.call(e)},n:function(){var u=r.next();return o=u.done,u},e:function(u){l=!0,h=u},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(l)throw h}}}}function pO(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Yv(e){var t=pO(e,"string");return typeof t=="symbol"?t:String(t)}function Ii(e,t,r){return t=Yv(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ug(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Gn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ug(Object(r),!0).forEach(function(n){Ii(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ug(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jv(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function gO(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Yv(n.key),n)}}function qv(e,t,r){return t&&gO(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Pi(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tc(e,t){return tc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},tc(e,t)}function Kv(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tc(e,t)}function mO(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function vO(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Pi(e)}function Zv(e){var t=mO();return function(){var n=Zn(e),i;if(t){var o=Zn(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return vO(this,i)}}var Jv,yO=function(e){Kv(r,e);var t=Zv(r);function r(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return jv(this,r),n=t.call(this,i),Ii(Pi(n),"queries",new Set),Ii(Pi(n),"entityToId",new Map),Ii(Pi(n),"idToEntity",new Map),Ii(Pi(n),"nextId",0),n.onEntityAdded.subscribe(function(o){n.reindex(o)}),n.onEntityRemoved.subscribe(function(o){if(n.queries.forEach(function(h){return h.remove(o)}),n.entityToId.has(o)){var l=n.entityToId.get(o);n.idToEntity.delete(l),n.entityToId.delete(o)}}),n}return qv(r,[{key:"update",value:function(n){function i(o,l,h){return n.apply(this,arguments)}return i.toString=function(){return n.toString()},i}(function(n,i,o){if(typeof i=="function"){var l=i(n);l&&Object.assign(n,l)}else typeof i=="string"?n[i]=o:i&&Object.assign(n,i);return this.reindex(n),n})},{key:"addComponent",value:function(i,o,l){i[o]===void 0&&(i[o]=l,this.reindex(i))}},{key:"removeComponent",value:function(i,o){if(i[o]!==void 0){if(this.has(i)){var l=Gn({},i);delete l[o],this.reindex(i,l)}delete i[o]}}},{key:"query",value:function(i){var o=bO(i),l=Qv(o),h=Qu(this.queries),u;try{for(h.s();!(u=h.n()).done;){var f=u.value;if(f.key===l)return f}}catch(g){h.e(g)}finally{h.f()}var d=new _O(this,o);return this.queries.add(d),d}},{key:"with",value:function(){for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return this.query({with:o,without:[],predicates:[]})}},{key:"without",value:function(){for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return this.query({with:[],without:o,predicates:[]})}},{key:"where",value:function(i){return this.query({with:[],without:[],predicates:[i]})}},{key:"reindex",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:i;if(this.has(i)){var l=Qu(this.queries),h;try{for(l.s();!(h=l.n()).done;){var u=h.value;u.evaluate(i,o)}}catch(f){l.e(f)}finally{l.f()}}}},{key:"id",value:function(i){if(this.has(i)){if(!this.entityToId.has(i)){var o=this.nextId++;this.entityToId.set(i,o),this.idToEntity.set(o,i)}return this.entityToId.get(i)}}},{key:"entity",value:function(i){return this.idToEntity.get(i)}}]),r}(Xv);Jv=Symbol.iterator;var _O=function(e){Kv(r,e);var t=Zv(r);function r(n,i){var o;return jv(this,r),o=t.call(this),Ii(Pi(o),"_isConnected",!1),o.world=n,o.config=i,o.key=Qv(i),o.onEntityAdded.onSubscribe.subscribe(function(){return o.connect()}),o.onEntityRemoved.onSubscribe.subscribe(function(){return o.connect()}),o}return qv(r,[{key:"isConnected",get:function(){return this._isConnected}},{key:"entities",get:function(){return this._isConnected||this.connect(),Ps(Zn(r.prototype),"entities",this)}},{key:Jv,value:function(){return this._isConnected||this.connect(),Ps(Zn(r.prototype),Symbol.iterator,this).call(this)}},{key:"connect",value:function(){if(!this._isConnected){this._isConnected=!0;var i=Qu(this.world),o;try{for(i.s();!(o=i.n()).done;){var l=o.value;this.evaluate(l)}}catch(h){i.e(h)}finally{i.f()}}return this}},{key:"disconnect",value:function(){return this._isConnected=!1,this}},{key:"with",value:function(){for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return this.world.query(Gn(Gn({},this.config),{},{with:[].concat(Is(this.config.with),o)}))}},{key:"without",value:function(){for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return this.world.query(Gn(Gn({},this.config),{},{without:[].concat(Is(this.config.without),o)}))}},{key:"where",value:function(i){return this.world.query(Gn(Gn({},this.config),{},{predicates:[].concat(Is(this.config.predicates),[i])}))}},{key:"want",value:function(i){return this.config.with.every(function(o){return i[o]!==void 0})&&this.config.without.every(function(o){return i[o]===void 0})&&this.config.predicates.every(function(o){return o(i)})}},{key:"evaluate",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:i;if(this.isConnected){var l=this.want(o),h=this.has(i);l&&!h?this.add(i):!l&&h&&this.remove(i)}}}]),r}(Xv),Gg=function(t){return Is(new Set(t.sort().filter(function(r){return!!r&&r!==""})))};function xO(e){return Is(new Set(e))}function bO(e){return{with:Gg(e.with),without:Gg(e.without),predicates:xO(e.predicates)}}function Qv(e){return"".concat(e.with.join(","),":").concat(e.without.join(","),":").concat(e.predicates.map(function(t){return lO(t)}).join(","))}hO();const tt=new yO,wO=tt.with("activeEffects"),eu=()=>{for(const e of wO){const{activeEffects:t}=e;t.forEach(r=>{const n=e[r.component];n&&(n.current+=r.delta)}),t.splice(0,t.length)}};var Tc={exports:{}};Tc.exports;(function(e){(function(){var t,r,n,i,o,l,h,u,f,d,g,m,v,_,w;n=Math.floor,d=Math.min,r=function(x,A){return x<A?-1:x>A?1:0},f=function(x,A,S,E,I){var D;if(S==null&&(S=0),I==null&&(I=r),S<0)throw new Error("lo must be non-negative");for(E==null&&(E=x.length);S<E;)D=n((S+E)/2),I(A,x[D])<0?E=D:S=D+1;return[].splice.apply(x,[S,S-S].concat(A)),A},l=function(x,A,S){return S==null&&(S=r),x.push(A),_(x,0,x.length-1,S)},o=function(x,A){var S,E;return A==null&&(A=r),S=x.pop(),x.length?(E=x[0],x[0]=S,w(x,0,A)):E=S,E},u=function(x,A,S){var E;return S==null&&(S=r),E=x[0],x[0]=A,w(x,0,S),E},h=function(x,A,S){var E;return S==null&&(S=r),x.length&&S(x[0],A)<0&&(E=[x[0],A],A=E[0],x[0]=E[1],w(x,0,S)),A},i=function(x,A){var S,E,I,D,L,O;for(A==null&&(A=r),D=(function(){O=[];for(var F=0,z=n(x.length/2);0<=z?F<z:F>z;0<=z?F++:F--)O.push(F);return O}).apply(this).reverse(),L=[],E=0,I=D.length;E<I;E++)S=D[E],L.push(w(x,S,A));return L},v=function(x,A,S){var E;if(S==null&&(S=r),E=x.indexOf(A),E!==-1)return _(x,0,E,S),w(x,E,S)},g=function(x,A,S){var E,I,D,L,O;if(S==null&&(S=r),I=x.slice(0,A),!I.length)return I;for(i(I,S),O=x.slice(A),D=0,L=O.length;D<L;D++)E=O[D],h(I,E,S);return I.sort(S).reverse()},m=function(x,A,S){var E,I,D,L,O,F,z,j,X;if(S==null&&(S=r),A*10<=x.length){if(D=x.slice(0,A).sort(S),!D.length)return D;for(I=D[D.length-1],z=x.slice(A),L=0,F=z.length;L<F;L++)E=z[L],S(E,I)<0&&(f(D,E,0,null,S),D.pop(),I=D[D.length-1]);return D}for(i(x,S),X=[],O=0,j=d(A,x.length);0<=j?O<j:O>j;0<=j?++O:--O)X.push(o(x,S));return X},_=function(x,A,S,E){var I,D,L;for(E==null&&(E=r),I=x[S];S>A;){if(L=S-1>>1,D=x[L],E(I,D)<0){x[S]=D,S=L;continue}break}return x[S]=I},w=function(x,A,S){var E,I,D,L,O;for(S==null&&(S=r),I=x.length,O=A,D=x[A],E=2*A+1;E<I;)L=E+1,L<I&&!(S(x[E],x[L])<0)&&(E=L),x[A]=x[E],A=E,E=2*A+1;return x[A]=D,_(x,O,A,S)},t=function(){x.push=l,x.pop=o,x.replace=u,x.pushpop=h,x.heapify=i,x.updateItem=v,x.nlargest=g,x.nsmallest=m;function x(A){this.cmp=A??r,this.nodes=[]}return x.prototype.push=function(A){return l(this.nodes,A,this.cmp)},x.prototype.pop=function(){return o(this.nodes,this.cmp)},x.prototype.peek=function(){return this.nodes[0]},x.prototype.contains=function(A){return this.nodes.indexOf(A)!==-1},x.prototype.replace=function(A){return u(this.nodes,A,this.cmp)},x.prototype.pushpop=function(A){return h(this.nodes,A,this.cmp)},x.prototype.heapify=function(){return i(this.nodes,this.cmp)},x.prototype.updateItem=function(A){return v(this.nodes,A,this.cmp)},x.prototype.clear=function(){return this.nodes=[]},x.prototype.empty=function(){return this.nodes.length===0},x.prototype.size=function(){return this.nodes.length},x.prototype.clone=function(){var A;return A=new x,A.nodes=this.nodes.slice(0),A},x.prototype.toArray=function(){return this.nodes.slice(0)},x.prototype.insert=x.prototype.push,x.prototype.top=x.prototype.peek,x.prototype.front=x.prototype.peek,x.prototype.has=x.prototype.contains,x.prototype.copy=x.prototype.clone,x}(),e!==null&&e.exports?e.exports=t:window.Heap=t}).call(Rr)})(Tc);var EO=Tc.exports,Ka=EO;function TO(e,t,r){this.x=e,this.y=t,this.walkable=r===void 0?!0:r}var Ac=TO,AO={Always:1,Never:2,IfAtMostOneObstacle:3,OnlyWhenNoObstacles:4},er=AO,ty=Ac,na=er;function Kr(e,t,r){var n;typeof e!="object"?n=e:(t=e.length,n=e[0].length,r=e),this.width=n,this.height=t,this.nodes=this._buildNodes(n,t,r)}Kr.prototype._buildNodes=function(e,t,r){var n,i,o=new Array(t);for(n=0;n<t;++n)for(o[n]=new Array(e),i=0;i<e;++i)o[n][i]=new ty(i,n);if(r===void 0)return o;if(r.length!==t||r[0].length!==e)throw new Error("Matrix size does not fit");for(n=0;n<t;++n)for(i=0;i<e;++i)r[n][i]&&(o[n][i].walkable=!1);return o};Kr.prototype.getNodeAt=function(e,t){return this.nodes[t][e]};Kr.prototype.isWalkableAt=function(e,t){return this.isInside(e,t)&&this.nodes[t][e].walkable};Kr.prototype.isInside=function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height};Kr.prototype.setWalkableAt=function(e,t,r){this.nodes[t][e].walkable=r};Kr.prototype.getNeighbors=function(e,t){var r=e.x,n=e.y,i=[],o=!1,l=!1,h=!1,u=!1,f=!1,d=!1,g=!1,m=!1,v=this.nodes;if(this.isWalkableAt(r,n-1)&&(i.push(v[n-1][r]),o=!0),this.isWalkableAt(r+1,n)&&(i.push(v[n][r+1]),h=!0),this.isWalkableAt(r,n+1)&&(i.push(v[n+1][r]),f=!0),this.isWalkableAt(r-1,n)&&(i.push(v[n][r-1]),g=!0),t===na.Never)return i;if(t===na.OnlyWhenNoObstacles)l=g&&o,u=o&&h,d=h&&f,m=f&&g;else if(t===na.IfAtMostOneObstacle)l=g||o,u=o||h,d=h||f,m=f||g;else if(t===na.Always)l=!0,u=!0,d=!0,m=!0;else throw new Error("Incorrect value of diagonalMovement");return l&&this.isWalkableAt(r-1,n-1)&&i.push(v[n-1][r-1]),u&&this.isWalkableAt(r+1,n-1)&&i.push(v[n-1][r+1]),d&&this.isWalkableAt(r+1,n+1)&&i.push(v[n+1][r+1]),m&&this.isWalkableAt(r-1,n+1)&&i.push(v[n+1][r-1]),i};Kr.prototype.clone=function(){var e,t,r=this.width,n=this.height,i=this.nodes,o=new Kr(r,n),l=new Array(n);for(e=0;e<n;++e)for(l[e]=new Array(r),t=0;t<r;++t)l[e][t]=new ty(t,e,i[e][t].walkable);return o.nodes=l,o};var SO=Kr,He={};function ec(e){for(var t=[[e.x,e.y]];e.parent;)e=e.parent,t.push([e.x,e.y]);return t.reverse()}He.backtrace=ec;function CO(e,t){var r=ec(e),n=ec(t);return r.concat(n.reverse())}He.biBacktrace=CO;function IO(e){var t,r=0,n,i,o,l;for(t=1;t<e.length;++t)n=e[t-1],i=e[t],o=n[0]-i[0],l=n[1]-i[1],r+=Math.sqrt(o*o+l*l);return r}He.pathLength=IO;function Sc(e,t,r,n){var i=Math.abs,o=[],l,h,u,f,d,g;for(u=i(r-e),f=i(n-t),l=e<r?1:-1,h=t<n?1:-1,d=u-f;o.push([e,t]),!(e===r&&t===n);)g=2*d,g>-f&&(d=d-f,e=e+l),g<u&&(d=d+u,t=t+h);return o}He.interpolate=Sc;function PO(e){var t=[],r=e.length,n,i,o,l,h,u;if(r<2)return t;for(h=0;h<r-1;++h)for(n=e[h],i=e[h+1],o=Sc(n[0],n[1],i[0],i[1]),l=o.length,u=0;u<l-1;++u)t.push(o[u]);return t.push(e[r-1]),t}He.expandPath=PO;function RO(e,t){var r=t.length,n=t[0][0],i=t[0][1],o=t[r-1][0],l=t[r-1][1],h,u,f,d,g,m,v,_,w,x,A;for(h=n,u=i,g=[[h,u]],m=2;m<r;++m){for(_=t[m],f=_[0],d=_[1],w=Sc(h,u,f,d),A=!1,v=1;v<w.length;++v)if(x=w[v],!e.isWalkableAt(x[0],x[1])){A=!0;break}A&&(lastValidCoord=t[m-1],g.push(lastValidCoord),h=lastValidCoord[0],u=lastValidCoord[1])}return g.push([o,l]),g}He.smoothenPath=RO;function MO(e){if(e.length<3)return e;var t=[],r=e[0][0],n=e[0][1],i=e[1][0],o=e[1][1],l=i-r,h=o-n,u,f,d,g,m,v;for(m=Math.sqrt(l*l+h*h),l/=m,h/=m,t.push([r,n]),v=2;v<e.length;v++)u=i,f=o,d=l,g=h,i=e[v][0],o=e[v][1],l=i-u,h=o-f,m=Math.sqrt(l*l+h*h),l/=m,h/=m,(l!==d||h!==g)&&t.push([u,f]);return t.push([i,o]),t}He.compressPath=MO;var Hs={manhattan:function(e,t){return e+t},euclidean:function(e,t){return Math.sqrt(e*e+t*t)},octile:function(e,t){var r=Math.SQRT2-1;return e<t?r*e+t:r*t+e},chebyshev:function(e,t){return Math.max(e,t)}},DO=Ka,BO=He,ru=Hs,ia=er;function ey(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.heuristic=e.heuristic||ru.manhattan,this.weight=e.weight||1,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=ia.OnlyWhenNoObstacles:this.diagonalMovement=ia.IfAtMostOneObstacle:this.diagonalMovement=ia.Never),this.diagonalMovement===ia.Never?this.heuristic=e.heuristic||ru.manhattan:this.heuristic=e.heuristic||ru.octile}ey.prototype.findPath=function(e,t,r,n,i){var o=new DO(function(D,L){return D.f-L.f}),l=i.getNodeAt(e,t),h=i.getNodeAt(r,n),u=this.heuristic,f=this.diagonalMovement,d=this.weight,g=Math.abs,m=Math.SQRT2,v,_,w,x,A,S,E,I;for(l.g=0,l.f=0,o.push(l),l.opened=!0;!o.empty();){if(v=o.pop(),v.closed=!0,v===h)return BO.backtrace(h);for(_=i.getNeighbors(v,f),x=0,A=_.length;x<A;++x)w=_[x],!w.closed&&(S=w.x,E=w.y,I=v.g+(S-v.x===0||E-v.y===0?1:m),(!w.opened||I<w.g)&&(w.g=I,w.h=w.h||d*u(g(S-r),g(E-n)),w.f=w.g+w.h,w.parent=v,w.opened?o.updateItem(w):(o.push(w),w.opened=!0)))}return[]};var Cc=ey,ry=Cc;function La(e){ry.call(this,e);var t=this.heuristic;this.heuristic=function(r,n){return t(r,n)*1e6}}La.prototype=new ry;La.prototype.constructor=La;var OO=La,FO=He,nu=er;function ny(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=nu.OnlyWhenNoObstacles:this.diagonalMovement=nu.IfAtMostOneObstacle:this.diagonalMovement=nu.Never)}ny.prototype.findPath=function(e,t,r,n,i){var o=[],l=this.diagonalMovement,h=i.getNodeAt(e,t),u=i.getNodeAt(r,n),f,d,g,m,v;for(o.push(h),h.opened=!0;o.length;){if(g=o.shift(),g.closed=!0,g===u)return FO.backtrace(u);for(f=i.getNeighbors(g,l),m=0,v=f.length;m<v;++m)d=f[m],!(d.closed||d.opened)&&(o.push(d),d.opened=!0,d.parent=g)}return[]};var LO=ny,iy=Cc;function Na(e){iy.call(this,e),this.heuristic=function(t,r){return 0}}Na.prototype=new iy;Na.prototype.constructor=Na;var NO=Na,Wg=Ka,$g=He,iu=Hs,sa=er;function sy(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.heuristic=e.heuristic||iu.manhattan,this.weight=e.weight||1,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=sa.OnlyWhenNoObstacles:this.diagonalMovement=sa.IfAtMostOneObstacle:this.diagonalMovement=sa.Never),this.diagonalMovement===sa.Never?this.heuristic=e.heuristic||iu.manhattan:this.heuristic=e.heuristic||iu.octile}sy.prototype.findPath=function(e,t,r,n,i){var o=function(z,j){return z.f-j.f},l=new Wg(o),h=new Wg(o),u=i.getNodeAt(e,t),f=i.getNodeAt(r,n),d=this.heuristic,g=this.diagonalMovement,m=this.weight,v=Math.abs,_=Math.SQRT2,w,x,A,S,E,I,D,L,O=1,F=2;for(u.g=0,u.f=0,l.push(u),u.opened=O,f.g=0,f.f=0,h.push(f),f.opened=F;!l.empty()&&!h.empty();){for(w=l.pop(),w.closed=!0,x=i.getNeighbors(w,g),S=0,E=x.length;S<E;++S)if(A=x[S],!A.closed){if(A.opened===F)return $g.biBacktrace(w,A);I=A.x,D=A.y,L=w.g+(I-w.x===0||D-w.y===0?1:_),(!A.opened||L<A.g)&&(A.g=L,A.h=A.h||m*d(v(I-r),v(D-n)),A.f=A.g+A.h,A.parent=w,A.opened?l.updateItem(A):(l.push(A),A.opened=O))}for(w=h.pop(),w.closed=!0,x=i.getNeighbors(w,g),S=0,E=x.length;S<E;++S)if(A=x[S],!A.closed){if(A.opened===O)return $g.biBacktrace(A,w);I=A.x,D=A.y,L=w.g+(I-w.x===0||D-w.y===0?1:_),(!A.opened||L<A.g)&&(A.g=L,A.h=A.h||m*d(v(I-e),v(D-t)),A.f=A.g+A.h,A.parent=w,A.opened?h.updateItem(A):(h.push(A),A.opened=F))}}return[]};var Ic=sy,oy=Ic;function ka(e){oy.call(this,e);var t=this.heuristic;this.heuristic=function(r,n){return t(r,n)*1e6}}ka.prototype=new oy;ka.prototype.constructor=ka;var kO=ka,Hg=He,su=er;function ay(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=su.OnlyWhenNoObstacles:this.diagonalMovement=su.IfAtMostOneObstacle:this.diagonalMovement=su.Never)}ay.prototype.findPath=function(e,t,r,n,i){var o=i.getNodeAt(e,t),l=i.getNodeAt(r,n),h=[],u=[],f,d,g,m=this.diagonalMovement,v=0,_=1,w,x;for(h.push(o),o.opened=!0,o.by=v,u.push(l),l.opened=!0,l.by=_;h.length&&u.length;){for(g=h.shift(),g.closed=!0,f=i.getNeighbors(g,m),w=0,x=f.length;w<x;++w)if(d=f[w],!d.closed){if(d.opened){if(d.by===_)return Hg.biBacktrace(g,d);continue}h.push(d),d.parent=g,d.opened=!0,d.by=v}for(g=u.shift(),g.closed=!0,f=i.getNeighbors(g,m),w=0,x=f.length;w<x;++w)if(d=f[w],!d.closed){if(d.opened){if(d.by===v)return Hg.biBacktrace(d,g);continue}u.push(d),d.parent=g,d.opened=!0,d.by=_}}return[]};var UO=ay,ly=Ic;function Ua(e){ly.call(this,e),this.heuristic=function(t,r){return 0}}Ua.prototype=new ly;Ua.prototype.constructor=Ua;var GO=Ua,ou=Hs,zg=Ac,oa=er;function hy(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.heuristic=e.heuristic||ou.manhattan,this.weight=e.weight||1,this.trackRecursion=e.trackRecursion||!1,this.timeLimit=e.timeLimit||1/0,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=oa.OnlyWhenNoObstacles:this.diagonalMovement=oa.IfAtMostOneObstacle:this.diagonalMovement=oa.Never),this.diagonalMovement===oa.Never?this.heuristic=e.heuristic||ou.manhattan:this.heuristic=e.heuristic||ou.octile}hy.prototype.findPath=function(e,t,r,n,i){var o=new Date().getTime(),l=(function(w,x){return this.heuristic(Math.abs(x.x-w.x),Math.abs(x.y-w.y))}).bind(this),h=function(w,x){return w.x===x.x||w.y===x.y?1:Math.SQRT2},u=(function(w,x,A,S,E){if(this.timeLimit>0&&new Date().getTime()-o>this.timeLimit*1e3)return 1/0;var I=x+l(w,d)*this.weight;if(I>A)return I;if(w==d)return S[E]=[w.x,w.y],w;var D,L,O,F,z=i.getNeighbors(w,this.diagonalMovement);for(O=0,D=1/0;F=z[O];++O){if(this.trackRecursion&&(F.retainCount=F.retainCount+1||1,F.tested!==!0&&(F.tested=!0)),L=u(F,x+h(w,F),A,S,E+1),L instanceof zg)return S[E]=[w.x,w.y],L;this.trackRecursion&&--F.retainCount===0&&(F.tested=!1),L<D&&(D=L)}return D}).bind(this),f=i.getNodeAt(e,t),d=i.getNodeAt(r,n),g=l(f,d),m,v,_;for(m=0;;++m){if(v=[],_=u(f,0,g,v,0),_===1/0)return[];if(_ instanceof zg)return v;g=_}return[]};var WO=hy,$O=Ka,Xg=He,uy=Hs;function Pc(e){e=e||{},this.heuristic=e.heuristic||uy.manhattan,this.trackJumpRecursion=e.trackJumpRecursion||!1}Pc.prototype.findPath=function(e,t,r,n,i){var o=this.openList=new $O(function(f,d){return f.f-d.f}),l=this.startNode=i.getNodeAt(e,t),h=this.endNode=i.getNodeAt(r,n),u;for(this.grid=i,l.g=0,l.f=0,o.push(l),l.opened=!0;!o.empty();){if(u=o.pop(),u.closed=!0,u===h)return Xg.expandPath(Xg.backtrace(h));this._identifySuccessors(u)}return[]};Pc.prototype._identifySuccessors=function(e){var t=this.grid,r=this.heuristic,n=this.openList,i=this.endNode.x,o=this.endNode.y,l,h,u,f,d,g=e.x,m=e.y,v,_,w,x,A,S=Math.abs;for(l=this._findNeighbors(e),f=0,d=l.length;f<d;++f)if(h=l[f],u=this._jump(h[0],h[1],g,m),u){if(v=u[0],_=u[1],A=t.getNodeAt(v,_),A.closed)continue;w=uy.octile(S(v-g),S(_-m)),x=e.g+w,(!A.opened||x<A.g)&&(A.g=x,A.h=A.h||r(S(v-i),S(_-o)),A.f=A.g+A.h,A.parent=e,A.opened?n.updateItem(A):(n.push(A),A.opened=!0))}};var Za=Pc,cy=Za,HO=er;function Wi(e){cy.call(this,e)}Wi.prototype=new cy;Wi.prototype.constructor=Wi;Wi.prototype._jump=function(e,t,r,n){var i=this.grid,o=e-r,l=t-n;if(!i.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(i.getNodeAt(e,t).tested=!0),i.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0){if(i.isWalkableAt(e,t-1)&&!i.isWalkableAt(e-o,t-1)||i.isWalkableAt(e,t+1)&&!i.isWalkableAt(e-o,t+1))return[e,t]}else if(l!==0){if(i.isWalkableAt(e-1,t)&&!i.isWalkableAt(e-1,t-l)||i.isWalkableAt(e+1,t)&&!i.isWalkableAt(e+1,t-l))return[e,t];if(this._jump(e+1,t,e,t)||this._jump(e-1,t,e,t))return[e,t]}else throw new Error("Only horizontal and vertical movements are allowed");return this._jump(e+o,t+l,e,t)};Wi.prototype._findNeighbors=function(e){var t=e.parent,r=e.x,n=e.y,i=this.grid,o,l,h,u,f=[],d,g,m,v;if(t)o=t.x,l=t.y,h=(r-o)/Math.max(Math.abs(r-o),1),u=(n-l)/Math.max(Math.abs(n-l),1),h!==0?(i.isWalkableAt(r,n-1)&&f.push([r,n-1]),i.isWalkableAt(r,n+1)&&f.push([r,n+1]),i.isWalkableAt(r+h,n)&&f.push([r+h,n])):u!==0&&(i.isWalkableAt(r-1,n)&&f.push([r-1,n]),i.isWalkableAt(r+1,n)&&f.push([r+1,n]),i.isWalkableAt(r,n+u)&&f.push([r,n+u]));else for(d=i.getNeighbors(e,HO.Never),m=0,v=d.length;m<v;++m)g=d[m],f.push([g.x,g.y]);return f};var zO=Wi,fy=Za,XO=er;function $i(e){fy.call(this,e)}$i.prototype=new fy;$i.prototype.constructor=$i;$i.prototype._jump=function(e,t,r,n){var i=this.grid,o=e-r,l=t-n;if(!i.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(i.getNodeAt(e,t).tested=!0),i.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0&&l!==0){if(i.isWalkableAt(e-o,t+l)&&!i.isWalkableAt(e-o,t)||i.isWalkableAt(e+o,t-l)&&!i.isWalkableAt(e,t-l))return[e,t];if(this._jump(e+o,t,e,t)||this._jump(e,t+l,e,t))return[e,t]}else if(o!==0){if(i.isWalkableAt(e+o,t+1)&&!i.isWalkableAt(e,t+1)||i.isWalkableAt(e+o,t-1)&&!i.isWalkableAt(e,t-1))return[e,t]}else if(i.isWalkableAt(e+1,t+l)&&!i.isWalkableAt(e+1,t)||i.isWalkableAt(e-1,t+l)&&!i.isWalkableAt(e-1,t))return[e,t];return this._jump(e+o,t+l,e,t)};$i.prototype._findNeighbors=function(e){var t=e.parent,r=e.x,n=e.y,i=this.grid,o,l,h,u,f=[],d,g,m,v;if(t)o=t.x,l=t.y,h=(r-o)/Math.max(Math.abs(r-o),1),u=(n-l)/Math.max(Math.abs(n-l),1),h!==0&&u!==0?(i.isWalkableAt(r,n+u)&&f.push([r,n+u]),i.isWalkableAt(r+h,n)&&f.push([r+h,n]),i.isWalkableAt(r+h,n+u)&&f.push([r+h,n+u]),i.isWalkableAt(r-h,n)||f.push([r-h,n+u]),i.isWalkableAt(r,n-u)||f.push([r+h,n-u])):h===0?(i.isWalkableAt(r,n+u)&&f.push([r,n+u]),i.isWalkableAt(r+1,n)||f.push([r+1,n+u]),i.isWalkableAt(r-1,n)||f.push([r-1,n+u])):(i.isWalkableAt(r+h,n)&&f.push([r+h,n]),i.isWalkableAt(r,n+1)||f.push([r+h,n+1]),i.isWalkableAt(r,n-1)||f.push([r+h,n-1]));else for(d=i.getNeighbors(e,XO.Always),m=0,v=d.length;m<v;++m)g=d[m],f.push([g.x,g.y]);return f};var VO=$i,dy=Za,YO=er;function Hi(e){dy.call(this,e)}Hi.prototype=new dy;Hi.prototype.constructor=Hi;Hi.prototype._jump=function(e,t,r,n){var i=this.grid,o=e-r,l=t-n;if(!i.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(i.getNodeAt(e,t).tested=!0),i.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0&&l!==0){if(this._jump(e+o,t,e,t)||this._jump(e,t+l,e,t))return[e,t]}else if(o!==0){if(i.isWalkableAt(e,t-1)&&!i.isWalkableAt(e-o,t-1)||i.isWalkableAt(e,t+1)&&!i.isWalkableAt(e-o,t+1))return[e,t]}else if(l!==0&&(i.isWalkableAt(e-1,t)&&!i.isWalkableAt(e-1,t-l)||i.isWalkableAt(e+1,t)&&!i.isWalkableAt(e+1,t-l)))return[e,t];return i.isWalkableAt(e+o,t)&&i.isWalkableAt(e,t+l)?this._jump(e+o,t+l,e,t):null};Hi.prototype._findNeighbors=function(e){var t=e.parent,r=e.x,n=e.y,i=this.grid,o,l,h,u,f=[],d,g,m,v;if(t)if(o=t.x,l=t.y,h=(r-o)/Math.max(Math.abs(r-o),1),u=(n-l)/Math.max(Math.abs(n-l),1),h!==0&&u!==0)i.isWalkableAt(r,n+u)&&f.push([r,n+u]),i.isWalkableAt(r+h,n)&&f.push([r+h,n]),i.isWalkableAt(r,n+u)&&i.isWalkableAt(r+h,n)&&f.push([r+h,n+u]);else{var _;if(h!==0){_=i.isWalkableAt(r+h,n);var w=i.isWalkableAt(r,n+1),x=i.isWalkableAt(r,n-1);_&&(f.push([r+h,n]),w&&f.push([r+h,n+1]),x&&f.push([r+h,n-1])),w&&f.push([r,n+1]),x&&f.push([r,n-1])}else if(u!==0){_=i.isWalkableAt(r,n+u);var A=i.isWalkableAt(r+1,n),S=i.isWalkableAt(r-1,n);_&&(f.push([r,n+u]),A&&f.push([r+1,n+u]),S&&f.push([r-1,n+u])),A&&f.push([r+1,n]),S&&f.push([r-1,n])}}else for(d=i.getNeighbors(e,YO.OnlyWhenNoObstacles),m=0,v=d.length;m<v;++m)g=d[m],f.push([g.x,g.y]);return f};var jO=Hi,py=Za,qO=er;function zi(e){py.call(this,e)}zi.prototype=new py;zi.prototype.constructor=zi;zi.prototype._jump=function(e,t,r,n){var i=this.grid,o=e-r,l=t-n;if(!i.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(i.getNodeAt(e,t).tested=!0),i.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0&&l!==0){if(i.isWalkableAt(e-o,t+l)&&!i.isWalkableAt(e-o,t)||i.isWalkableAt(e+o,t-l)&&!i.isWalkableAt(e,t-l))return[e,t];if(this._jump(e+o,t,e,t)||this._jump(e,t+l,e,t))return[e,t]}else if(o!==0){if(i.isWalkableAt(e+o,t+1)&&!i.isWalkableAt(e,t+1)||i.isWalkableAt(e+o,t-1)&&!i.isWalkableAt(e,t-1))return[e,t]}else if(i.isWalkableAt(e+1,t+l)&&!i.isWalkableAt(e+1,t)||i.isWalkableAt(e-1,t+l)&&!i.isWalkableAt(e-1,t))return[e,t];return i.isWalkableAt(e+o,t)||i.isWalkableAt(e,t+l)?this._jump(e+o,t+l,e,t):null};zi.prototype._findNeighbors=function(e){var t=e.parent,r=e.x,n=e.y,i=this.grid,o,l,h,u,f=[],d,g,m,v;if(t)o=t.x,l=t.y,h=(r-o)/Math.max(Math.abs(r-o),1),u=(n-l)/Math.max(Math.abs(n-l),1),h!==0&&u!==0?(i.isWalkableAt(r,n+u)&&f.push([r,n+u]),i.isWalkableAt(r+h,n)&&f.push([r+h,n]),(i.isWalkableAt(r,n+u)||i.isWalkableAt(r+h,n))&&f.push([r+h,n+u]),!i.isWalkableAt(r-h,n)&&i.isWalkableAt(r,n+u)&&f.push([r-h,n+u]),!i.isWalkableAt(r,n-u)&&i.isWalkableAt(r+h,n)&&f.push([r+h,n-u])):h===0?i.isWalkableAt(r,n+u)&&(f.push([r,n+u]),i.isWalkableAt(r+1,n)||f.push([r+1,n+u]),i.isWalkableAt(r-1,n)||f.push([r-1,n+u])):i.isWalkableAt(r+h,n)&&(f.push([r+h,n]),i.isWalkableAt(r,n+1)||f.push([r+h,n+1]),i.isWalkableAt(r,n-1)||f.push([r+h,n-1]));else for(d=i.getNeighbors(e,qO.IfAtMostOneObstacle),m=0,v=d.length;m<v;++m)g=d[m],f.push([g.x,g.y]);return f};var KO=zi,au=er,ZO=zO,JO=VO,QO=jO,tF=KO;function eF(e){return e=e||{},e.diagonalMovement===au.Never?new ZO(e):e.diagonalMovement===au.Always?new JO(e):e.diagonalMovement===au.OnlyWhenNoObstacles?new QO(e):new tF(e)}var rF=eF,nF={Heap:Ka,Node:Ac,Grid:SO,Util:He,DiagonalMovement:er,Heuristic:Hs,AStarFinder:Cc,BestFirstFinder:OO,BreadthFirstFinder:LO,DijkstraFinder:NO,BiAStarFinder:Ic,BiBestFirstFinder:kO,BiBreadthFirstFinder:UO,BiDijkstraFinder:GO,IDAStarFinder:WO,JumpPointFinder:rF},iF=nF;const Vg=Ga(iF),sF=tt.with("position"),oF=(e,t)=>{const{width:r,height:n}=$t().views.map,i=new Vg.Grid(r,n);for(const h of sF)if(h.blocking&&!h.pathThrough){const{x:u,y:f}=h.position;i.setWalkableAt(u,f,!1)}return i.setWalkableAt(e.x,e.y,!0),i.setWalkableAt(t.x,t.y,!0),new Vg.AStarFinder({}).findPath(e.x,e.y,t.x,t.y,i)},aF=tt.with("pc","position"),lF=tt.with("ai","position"),hF=()=>{const[e]=aF.entities;for(const t of lF){const r=oF(t.position,e.position);if(r[1]){const n={x:r[1][0],y:r[1][1],z:t.position.z};tt.addComponent(t,"tryMove",n)}}},Jn=e=>`${e.x},${e.y},${e.z}`,Yg=(e,t)=>{const{x:r,y:n,z:i,width:o,height:l,hasWalls:h}=e,u={},f=r,d=r+o,g=n,m=n+l;if(h)for(let _=g+1;_<m-1;_++)for(let w=f+1;w<d-1;w++)u[`${w},${_},${i}`]={x:w,y:_,z:i,...t};else for(let _=g;_<m;_++)for(let w=f;w<d;w++)u[`${w},${_},${i}`]={x:w,y:_,z:i,...t};const v={x:Math.round((f+d)/2),y:Math.round((g+m)/2),z:i};return{x1:f,x2:d,y1:g,y2:m,z:i,center:v,hasWalls:h,tiles:u,width:o,height:l}},uF=(e,t)=>e.x1<=t.x2&&e.x2>=t.x1&&e.y1<=t.y2&&e.y2>=t.y1,cF=(e,t)=>{const r=Math.pow(t.x-e.x,2),n=Math.pow(t.y-e.y,2);return Math.floor(Math.sqrt(r+n))},fF=[{xx:1,xy:0,yx:0,yy:1},{xx:1,xy:0,yx:0,yy:-1},{xx:-1,xy:0,yx:0,yy:1},{xx:-1,xy:0,yx:0,yy:-1},{xx:0,xy:1,yx:1,yy:0},{xx:0,xy:1,yx:-1,yy:0},{xx:0,xy:-1,yx:1,yy:0},{xx:0,xy:-1,yx:-1,yy:0}];function dF(e,t,r,n,i){const{x:o,y:l,z:h}=n,u=new Set,f=new Set;for(const v of e)v.position.z===h&&f.add(Jn(v.position));const d=(v,_)=>{const w=`${v},${_},${h}`;return!!f.has(w)},g=(v,_)=>u.add(`${v},${_},${h}`);function m(v,_,w,x,A,S,E){let I=0;if(x<A)return;let D=!1;for(let L=w;L<E&&!D;L++){let O=-L;for(let F=-L;F<=0;F++){let z=v+F*S.xx+O*S.xy,j=_+F*S.yx+O*S.yy,X=(F-.5)/(O+.5),K=(F+.5)/(O-.5);if(!(!(z>=0&&j>=0&&z<t&&j<r)||x<K)){if(A>X)break;if(Math.sqrt(F*F+O*O)<=E&&g(z,j),D)if(d(z,j)){I=K;continue}else D=!1,x=I;else d(z,j)&&L<E&&(D=!0,m(v,_,L+1,x,X,S,E),I=K)}}}}g(o,l);for(let v of fF)m(o,l,1,1,0,v,i);return{fov:u}}const pF=tt.with("inFov","position"),gF=tt.with("opaque","position"),mF=tt.with("pc","position"),vF=tt.with("appearance","position"),va=()=>{let e;for(const r of mF)e=r;if(!e)return;const t=dF(gF,74,39,e.position,10);for(const r of pF)tt.removeComponent(r,"inFov");for(const r of vF)t.fov.has(Jn(r.position))&&(tt.addComponent(r,"inFov",!0),tt.addComponent(r,"revealed",!0))},Qe=e=>{console.log(JSON.parse(JSON.stringify(e)))},De=e=>{gr(t=>t.log.push(e))},yF=tt.with("tryDrop"),jg=()=>{var e;for(const t of yF){const{dropperId:r}=t.tryDrop,n=tt.entity(r);if(!n){console.log(`dropperId: ${r} does not exist`),Qe(t),tt.removeComponent(t,"tryDrop");break}const i=tt.id(t);if(!i){console.log("Entity does not have an id."),Qe(t),tt.removeComponent(t,"tryDrop");break}if(!((e=n==null?void 0:n.container)!=null&&e.contents.includes(i))){console.log(`${n.name} is not holding ${t.name}`),Qe(n),Qe(t),tt.removeComponent(t,"tryDrop");break}const{position:o}=n;if(!o){console.log(`${n.name} has not position and cannot drop ${t.name}`),Qe(n),Qe(t),tt.removeComponent(t,"tryDrop");break}tt.addComponent(t,"position",{...o}),be.remove(n.container.contents,l=>i===l),tt.removeComponent(t,"tryDrop"),De(`${n.name} drops ${t.name}`)}},_F=tt.with("pc"),xF=tt.with("tryPickUp"),bF=()=>{var t,r;const[e]=_F;for(const n of xF){if(!n.pickUp){console.log("Entity is not a pickup"),Qe(n);break}const{pickerId:i}=n.tryPickUp,o=tt.entity(i);if(!o){console.log(`pickerId ${i} does not exist`);break}const{container:l}=o;if(!l){console.log("Picker has no container"),Qe(o),o===e&&De("You have nowhere to put that."),tt.removeComponent(n,"tryPickUp");break}if(l.contents.length>=l.slots){console.log("Picker has no room in container"),Qe(o),o===e&&De(`You have no room in your ${(t=e==null?void 0:e.container)==null?void 0:t.name}.`),tt.removeComponent(n,"tryPickUp");break}const h=tt.id(n);if(be.isUndefined(h)){console.log(`pickupId ${h} does not exist`),tt.removeComponent(n,"tryPickUp");break}l.contents.push(h),tt.removeComponent(n,"tryPickUp"),tt.removeComponent(n,"position"),De(`${o.name} puts ${n.name} in ${(r=o==null?void 0:o.container)==null?void 0:r.name}`)}},wF=tt.with("position","tryMove"),EF=tt.with("blocking","position"),qg=()=>{for(const e of wF){const{position:t,tryMove:r}=e;let n=!1;for(const i of EF)if(i.position.x===r.x&&i.position.y===r.y){tt.removeComponent(e,"tryMove"),i.health?(i.health.current-=5,(e.pc||i.pc)&&De(`${i.name} attacked by ${e.name} for 5hp`)):e.pc&&De(`${e.name} blocked by ${i.name}`),n=!0;break}n||(t.x=r.x,t.y=r.y,t.z=r.z,tt.removeComponent(e,"tryMove"))}},xi=(e,t)=>{let r=e;if(r.length>t){const n=r.length-(t-3);r=r.substring(0,r.length-n).trim().concat("...")}return r},TF=e=>e<4?(100-(5-e)*7)/100:1,lu=tt.with("position","appearance","layer100"),hu=tt.with("position","appearance","layer200"),uu=tt.with("position","appearance","layer300"),cu=tt.with("position","appearance","layer400"),AF=tt.with("inFov","legendable","position","appearance","name"),Kg=tt.with("pc","position"),Je=(e,t,r)=>{const{appearance:n,position:i}=t;if(!n||!i)return;const{char:o,tint:l,tileSet:h}=n,{x:u,y:f}=i;e==null||e.updateCell({0:{char:o,tint:65280,alpha:0,tileSet:"tile",x:u,y:f},1:{char:o,tint:l,alpha:r,tileSet:h,x:u,y:f}})},ya=()=>{var r;const e=$t().views.map;if(!e)return;for(const n of lu)n.inFov&&Je(e,n,1);for(const n of hu)n.inFov&&Je(e,n,1);for(const n of uu)n.inFov&&Je(e,n,1);for(const n of cu)n.inFov&&Je(e,n,1);for(const n of lu)!n.inFov&&n.revealed&&Je(e,n,.35);for(const n of hu)!n.inFov&&n.revealed&&Je(e,n,.35);for(const n of uu)!n.inFov&&n.revealed&&Je(e,n,.35);for(const n of cu)!n.inFov&&n.revealed&&Je(e,n,.35);if(window.skulltooth.debug){for(const n of lu)Je(e,n,1);for(const n of hu)Je(e,n,1);for(const n of uu)Je(e,n,1);for(const n of cu)Je(e,n,1)}{const n=$t().views.senses,i=$t().senses,o=n.width-1;n==null||n.updateRows([[{string:xi(i.feel,o)}],[{string:xi(i.see,o)}],[{string:xi(i.hear,o)}],[{string:xi(i.smell,o)}],[{string:xi(i.taste,o)}]])}{const n=$t().views.legend;if(n){const i=[],[o]=Kg;for(const h of AF)i.push(h);i.sort(h=>cF(o.position,h.position)),n==null||n.clearView();const l=[];i.forEach(h=>{const u=h.appearance.char,f=h.name,d=`${u} ${f}`;l.push([{string:d}])}),n==null||n.updateRows(l)}}{const n=$t().views.menuUnderlay,i=$t().views.inventory;if($t().gameState===pn.INVENTORY){const[o]=Kg;if(!o)return;const l=[];(((r=o.container)==null?void 0:r.contents)||[]).map(f=>tt.entity(f)).forEach(f=>{var d;l.push([{},{string:`${(d=f==null?void 0:f.appearance)==null?void 0:d.char} ${f==null?void 0:f.name} ${f==null?void 0:f.description}`}])}),n==null||n.show(),i==null||i.clearView(),i==null||i.updateRows(l),i==null||i.show()}else n==null||n.hide(),i==null||i.hide()}{const n=$t().views.log;if(n){const i=$t().log,o=i.slice(Math.max(i.length-5,0)),l=n.width-1;n==null||n.updateRows(o.map((h,u)=>[{string:xi(h,l),alpha:TF(u)}]))}}const t=$t().views.controls;if(t){let n="(arrows/hjkl)Move (i)Inventory";$t().gameState===pn.INVENTORY&&(n="(i/escape)Return to Game (d)Drop (c)Consume"),t==null||t.updateRows([[],[{string:n}]])}},SF=["ArrowLeft","ArrowDown","ArrowUp","ArrowRight","h","j","k","l"],Zg=tt.with("pc"),CF=tt.with("pickUp"),Jg=()=>{var i,o;const{userInput:e,gameState:t}=$t();if(!e)return gr(l=>{l.userInput=null});const{key:r}=e,[n]=Zg;if(t===pn.GAME){if(r==="i"&&gr(l=>l.gameState=pn.INVENTORY),SF.includes(r)){for(const l of Zg)if(l!=null&&l.position){const{x:h,y:u,z:f}=l.position;if(r==="h"||r==="ArrowLeft"){const d={x:h-1,y:u,z:f};tt.addComponent(l,"tryMove",d)}if(r==="j"||r==="ArrowDown"){const d={x:h,y:u+1,z:f};tt.addComponent(l,"tryMove",d)}if(r==="k"||r==="ArrowUp"){const d={x:h,y:u-1,z:f};tt.addComponent(l,"tryMove",d)}if(r==="l"||r==="ArrowRight"){const d={x:h+1,y:u,z:f};tt.addComponent(l,"tryMove",d)}}}if(r==="g"){let l=!0;for(const h of CF)if(n.position&&h.position&&Jn(n.position)===Jn(h.position)){const u=tt.id(n);be.isUndefined(u)||(tt.addComponent(h,"tryPickUp",{pickerId:u}),l=!1)}l&&De("There is nothing to pickup")}}if(t===pn.INVENTORY){if((r==="i"||r==="Escape")&&gr(l=>l.gameState=pn.GAME),r==="d")do{if(!n.container){De("You can't drop without a container to hold.");break}if(!((i=n.container)!=null&&i.contents.length)){De("You have nothing to drop");break}const l=n.container.contents[0],h=tt.entity(l);if(!h){console.log(`id: ${l} does not exist.`),Qe(n);break}const u=tt.id(n);if(be.isUndefined(u))break;tt.addComponent(h,"tryDrop",{dropperId:u});break}while(!0);if(r==="c")do{if(!n.container){De("You have no container to hold consumables");break}if(!((o=n.container)!=null&&o.contents.length)){De("You have nothing to consume");break}const l=n.container.contents[0],h=tt.entity(l);if(!h){console.log(`id: ${l} does not exist.`),Qe(n);break}if(!h.consumable){De(`${n.name} cannot consume ${h.name}`);break}h.effects&&n.activeEffects.push(...h.effects),be.remove(n.container.contents,u=>l===u),De(`${n.name} consumes ${h.name}`),tt.remove(h);break}while(!0)}gr(l=>{l.userInput=null})};var bn=(e=>(e.default="?",e.floor="•",e.owlbear="F",e.player="@",e.potion="!",e.rat="r",e.rock="*",e.wall="#",e))(bn||{}),wn=(e=>(e[e.default=65399]="default",e[e.floor=3355443]="floor",e[e.owlbear=11027200]="owlbear",e[e.player=16777215]="player",e[e.potion=14329120]="potion",e[e.rat=14047863]="rat",e[e.rock=8355711]="rock",e[e.wall=8421504]="wall",e))(wn||{});const qi={appearance:{char:bn.default,tint:wn.default,tileSet:"ascii"},position:{x:0,y:0,z:0},name:"default"},gy={layer100:!0},my={health:{max:1,current:1},blocking:!0,layer300:!0},IF={...qi,...my,appearance:{char:bn.player,tint:wn.player,tileSet:"ascii"},health:{max:1e3,current:1e3},legendable:!0,name:"player",pc:!0,container:{name:"Haversack",description:"A simple medium sized burlap pouch with a single shoulder strap.",slots:10,contents:[]},activeEffects:[{delta:-5,component:"health"},{delta:-1,component:"health"}]},PF={...qi,...gy,appearance:{char:bn.wall,tint:wn.wall,tileSet:"ascii"},blocking:!0,opaque:!0,name:"wall"},RF={...qi,...gy,appearance:{char:bn.floor,tint:wn.floor,tileSet:"ascii"},name:"floor"},MF={...qi,...my,ai:!0,appearance:{char:bn.rat,tint:wn.rat,tileSet:"ascii"},health:{max:1,current:1},legendable:!0,name:"rat",description:"A medium-sized, long-tailed rodent",pathThrough:!0},DF={...qi,appearance:{char:bn.rock,tint:wn.rock,tileSet:"ascii"},legendable:!0,name:"Rock",description:"A small rock for throwing",layer200:!0,pickUp:!0},BF={...qi,appearance:{char:bn.potion,tint:wn.potion,tileSet:"ascii"},consumable:!0,legendable:!0,name:"Health Potion",description:"A syrupy red liquid in a small glass vile",effects:[{component:"health",delta:10}],layer200:!0,pickUp:!0};function OF(e,t){const r={},n=Math.min(e.x,t.x),i=Math.max(e.x,t.x)+1;let o=n;for(;o<i;){const l={...t,x:o};r[Jn(l)]={...l,sprite:"FLOOR"},o++}return r}function FF(e,t){const r={},n=Math.min(e.y,t.y),i=Math.max(e.y,t.y)+1;let o=n;for(;o<i;){const l={...e,y:o};r[Jn(l)]={...l,sprite:"FLOOR"},o++}return r}const LF=e=>{const{pos:t,width:r,height:n,minRoomSize:i=6,maxRoomSize:o=12,maxRoomCount:l=30}=e,{x:h,y:u,z:f}=t,d={...Yg({x:h,y:u,z:f,width:r,height:n,hasWalls:!1},{sprite:"WALL"}),rooms:[]};let g={};be.times(l,()=>{let _=be.random(i,o),w=be.random(i,o),x=be.random(h,r+h-_-1),A=be.random(u,n+u-w-1);const S=Yg({x,y:A,z:f,width:_,height:w,hasWalls:!0},{sprite:"FLOOR"});d.rooms.some(E=>uF(E,S))||(d.rooms.push(S),g={...g,...S.tiles})});let m=null,v={};for(let _ of d.rooms)m&&(v={...v,...OF(_.center,m.center),...FF(_.center,m.center)}),m=_;return d.tiles={...d.tiles,...g,...v},d},NF=()=>{const e=LF({pos:{x:0,y:0,z:0},width:74,height:39,minRoomSize:8,maxRoomSize:18,maxRoomCount:100}),t=Object.values(e.tiles);for(const r of t){if(r.sprite==="WALL"){const{x:n,y:i,z:o}=r;tt.add({...be.cloneDeep(PF),position:{x:n,y:i,z:o}})}if(r.sprite==="FLOOR"){const{x:n,y:i,z:o}=r;tt.add({...be.cloneDeep(RF),position:{x:n,y:i,z:o}})}}return e.rooms.forEach((r,n)=>{const i=be.sample([MF,DF,BF]);n&&tt.add({...be.cloneDeep(i),position:r.center})}),e},kF=tt.with("health").without("dead"),Qg=()=>{for(const e of kF)e.health.current<=0&&(e.appearance&&(e.appearance.char="%"),tt.removeComponent(e,"ai"),tt.removeComponent(e,"blocking"),tt.removeComponent(e,"layer300"),tt.addComponent(e,"dead",!0),tt.addComponent(e,"pickUp",!0),tt.addComponent(e,"layer200",!0),De(`${e.name} has died!`),e.pc&&(gr(t=>t.gameState=pn.GAME_OVER),console.log("Game Over!")))};var pn=(e=>(e.GAME="GAME",e.GAME_OVER="GAME_OVER",e.INVENTORY="INVENTORY",e.INSPECT="INSPECT",e.TARGET="TARGET",e))(pn||{});window.skulltooth=window.skulltooth||{};window.skulltooth.debug=!1;const Ns={fps:0,gameState:"GAME",log:["hello world","your adventure begins anew!"],senses:{feel:"You feel nothing.",see:"You see nothing.",hear:"You hear nothing.",smell:"You smell nothing.",taste:"You taste nothing."},turn:"PLAYER",userInput:null,views:{}};window.skulltooth.state=Ns;const gr=e=>{e(Ns)},$t=()=>Ns,UF=async()=>{await GB(document.querySelector("#canvas")),new Ar({width:12,height:2,x:0,y:0,layers:2,tileSets:["tile","text"],tints:[16777215,16711799],alphas:[1,1],visible:!0}).updateRows([[{},{string:"skulltooth 2"}],[{tint:16711799},{string:"forcecrusher",tint:16777215}]]);const e=new Ar({width:25,height:42,x:0,y:2,layers:1,tileSets:["text"],tints:[16711799],alphas:[1],visible:!0}),t=new Ar({width:74,height:5,x:26,y:0,layers:1,tileSets:["text"],tints:[15658734],alphas:[1],visible:!0}),r=new Ar({width:74,height:5,x:100,y:0,layers:1,tileSets:["text"],tints:[16711799],alphas:[1],visible:!0}),n=new Ar({width:74,height:39,x:13,y:5,layers:3,tileSets:["tile","ascii","tile"],tints:[0,0,0],alphas:[1,1,0],visible:!0}),i=new Ar({width:12,height:1,x:0,y:44,layers:1,tileSets:["text"],tints:[14540253],alphas:[1],visible:!0}).updateRows([[{string:"FPS: calc..."}]]);new Ar({width:12,height:1,x:0,y:45,layers:1,tileSets:["text"],tints:[16777215],alphas:[1],visible:!0}).updateRows([[{string:"TAG: 822cfc3"}]]);const o=new Ar({width:148,height:2,x:26,y:44,layers:1,tileSets:["text"],tints:[15658734],alphas:[1],visible:!0}),l=new Ar({width:100,height:44,x:0,y:0,layers:1,tileSets:["tile"],tints:[1118481],alphas:[.75],visible:!1}),h=new Ar({width:148,height:39,x:26,y:5,layers:2,tileSets:["text","text"],tints:[1118481,16777215],alphas:[1],visible:!1});gr(g=>{g.views.fps=i,g.views.map=n,g.views.log=t,g.views.senses=r,g.views.legend=e,g.views.inventory=h,g.views.menuUnderlay=l,g.views.controls=o});const f=NF().rooms[0].center,d=tt.add(IF);d.position.x=f.x,d.position.y=f.y,d.position.z=f.z,va(),ya(),vy(),document.addEventListener("keydown",g=>{gr(m=>{m.userInput=g})}),document.addEventListener("mousedown",g=>{const m=g.x-Ns.views.map.layers[0].x,v=g.layerY-Ns.views.map.layers[0].y,w=UB(m,v,0);if(window.skulltooth.debug===!0){const x=tt.with("position");for(const A of x)w===Jn(A.position)&&(console.log(w),Qe(A))}})};let fu=0,aa=Date.now(),la=[];function vy(){var e;requestAnimationFrame(vy),$t().gameState==="INVENTORY"&&$t().userInput&&$t().turn==="PLAYER"&&(eu(),Jg(),jg(),va(),ya()),$t().gameState==="GAME"&&($t().userInput&&$t().turn==="PLAYER"&&(eu(),Jg(),bF(),jg(),qg(),Qg(),va(),ya(),$t().gameState==="GAME"&&gr(t=>{t.turn="WORLD"})),$t().turn==="WORLD"&&(eu(),hF(),qg(),Qg(),va(),ya(),gr(t=>{t.turn="PLAYER"}))),aa||(aa=Date.now()),Date.now()-aa>1e3&&(la.unshift(fu),la.length>3&&la.pop(),isNaN($t().fps)||(e=$t().views.fps)==null||e.updateRow({string:`FPS: ${$t().fps}     `,layer:0,x:0,y:0,tileSet:"text"}),aa=Date.now(),fu=0),gr(t=>t.fps=Math.round(be.mean(la))),fu++}UF();
