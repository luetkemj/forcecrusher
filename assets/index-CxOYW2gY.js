var qE=Object.defineProperty;var KE=(e,t,r)=>t in e?qE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Zt=(e,t,r)=>(KE(e,typeof t!="symbol"?t+"":t,r),r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();var Cr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Na(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function ZE(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:function(){return e[i]}})}),r}var ma={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */ma.exports;(function(e,t){(function(){var r,i="4.17.21",n=200,o="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",h="Invalid `variable` option passed into `_.template`",u="__lodash_hash_undefined__",f=500,d="__lodash_placeholder__",g=1,m=2,v=4,y=1,w=2,x=1,A=2,S=4,E=8,I=16,D=32,L=64,O=128,F=256,X=512,j=30,z="...",K=800,W=16,k=1,at=2,ft=3,Y=1/0,vt=9007199254740991,Ot=17976931348623157e292,H=NaN,rt=4294967295,bt=rt-1,Rt=rt>>>1,Mt=[["ary",O],["bind",x],["bindKey",A],["curry",E],["curryRight",I],["flip",X],["partial",D],["partialRight",L],["rearg",F]],Nt="[object Arguments]",kt="[object Array]",ie="[object AsyncFunction]",Yt="[object Boolean]",ne="[object Date]",oe="[object DOMException]",Dt="[object Error]",Ut="[object Function]",jt="[object GeneratorFunction]",qt="[object Map]",_e="[object Number]",vi="[object Null]",vr="[object Object]",Ic="[object Promise]",d_="[object Proxy]",Vn="[object RegExp]",Qe="[object Set]",Yn="[object String]",Ws="[object Symbol]",p_="[object Undefined]",jn="[object WeakMap]",g_="[object WeakSet]",qn="[object ArrayBuffer]",ji="[object DataView]",Ka="[object Float32Array]",Za="[object Float64Array]",Ja="[object Int8Array]",Qa="[object Int16Array]",tl="[object Int32Array]",el="[object Uint8Array]",rl="[object Uint8ClampedArray]",il="[object Uint16Array]",nl="[object Uint32Array]",m_=/\b__p \+= '';/g,v_=/\b(__p \+=) '' \+/g,__=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Rc=/&(?:amp|lt|gt|quot|#39);/g,Pc=/[&<>"']/g,y_=RegExp(Rc.source),x_=RegExp(Pc.source),b_=/<%-([\s\S]+?)%>/g,w_=/<%([\s\S]+?)%>/g,Mc=/<%=([\s\S]+?)%>/g,E_=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,T_=/^\w*$/,A_=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,sl=/[\\^$.*+?()[\]{}|]/g,S_=RegExp(sl.source),ol=/^\s+/,C_=/\s/,I_=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,R_=/\{\n\/\* \[wrapped with (.+)\] \*/,P_=/,? & /,M_=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,D_=/[()=,{}\[\]\/\s]/,B_=/\\(\\)?/g,O_=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Dc=/\w*$/,F_=/^[-+]0x[0-9a-f]+$/i,L_=/^0b[01]+$/i,N_=/^\[object .+?Constructor\]$/,k_=/^0o[0-7]+$/i,U_=/^(?:0|[1-9]\d*)$/,G_=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,$s=/($^)/,W_=/['\n\r\u2028\u2029\\]/g,Hs="\\ud800-\\udfff",$_="\\u0300-\\u036f",H_="\\ufe20-\\ufe2f",X_="\\u20d0-\\u20ff",Bc=$_+H_+X_,Oc="\\u2700-\\u27bf",Fc="a-z\\xdf-\\xf6\\xf8-\\xff",z_="\\xac\\xb1\\xd7\\xf7",V_="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Y_="\\u2000-\\u206f",j_=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Lc="A-Z\\xc0-\\xd6\\xd8-\\xde",Nc="\\ufe0e\\ufe0f",kc=z_+V_+Y_+j_,al="['’]",q_="["+Hs+"]",Uc="["+kc+"]",Xs="["+Bc+"]",Gc="\\d+",K_="["+Oc+"]",Wc="["+Fc+"]",$c="[^"+Hs+kc+Gc+Oc+Fc+Lc+"]",ll="\\ud83c[\\udffb-\\udfff]",Z_="(?:"+Xs+"|"+ll+")",Hc="[^"+Hs+"]",hl="(?:\\ud83c[\\udde6-\\uddff]){2}",ul="[\\ud800-\\udbff][\\udc00-\\udfff]",qi="["+Lc+"]",Xc="\\u200d",zc="(?:"+Wc+"|"+$c+")",J_="(?:"+qi+"|"+$c+")",Vc="(?:"+al+"(?:d|ll|m|re|s|t|ve))?",Yc="(?:"+al+"(?:D|LL|M|RE|S|T|VE))?",jc=Z_+"?",qc="["+Nc+"]?",Q_="(?:"+Xc+"(?:"+[Hc,hl,ul].join("|")+")"+qc+jc+")*",ty="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ey="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Kc=qc+jc+Q_,ry="(?:"+[K_,hl,ul].join("|")+")"+Kc,iy="(?:"+[Hc+Xs+"?",Xs,hl,ul,q_].join("|")+")",ny=RegExp(al,"g"),sy=RegExp(Xs,"g"),cl=RegExp(ll+"(?="+ll+")|"+iy+Kc,"g"),oy=RegExp([qi+"?"+Wc+"+"+Vc+"(?="+[Uc,qi,"$"].join("|")+")",J_+"+"+Yc+"(?="+[Uc,qi+zc,"$"].join("|")+")",qi+"?"+zc+"+"+Vc,qi+"+"+Yc,ey,ty,Gc,ry].join("|"),"g"),ay=RegExp("["+Xc+Hs+Bc+Nc+"]"),ly=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,hy=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],uy=-1,Gt={};Gt[Ka]=Gt[Za]=Gt[Ja]=Gt[Qa]=Gt[tl]=Gt[el]=Gt[rl]=Gt[il]=Gt[nl]=!0,Gt[Nt]=Gt[kt]=Gt[qn]=Gt[Yt]=Gt[ji]=Gt[ne]=Gt[Dt]=Gt[Ut]=Gt[qt]=Gt[_e]=Gt[vr]=Gt[Vn]=Gt[Qe]=Gt[Yn]=Gt[jn]=!1;var Lt={};Lt[Nt]=Lt[kt]=Lt[qn]=Lt[ji]=Lt[Yt]=Lt[ne]=Lt[Ka]=Lt[Za]=Lt[Ja]=Lt[Qa]=Lt[tl]=Lt[qt]=Lt[_e]=Lt[vr]=Lt[Vn]=Lt[Qe]=Lt[Yn]=Lt[Ws]=Lt[el]=Lt[rl]=Lt[il]=Lt[nl]=!0,Lt[Dt]=Lt[Ut]=Lt[jn]=!1;var cy={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},fy={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},dy={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},py={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},gy=parseFloat,my=parseInt,Zc=typeof Cr=="object"&&Cr&&Cr.Object===Object&&Cr,vy=typeof self=="object"&&self&&self.Object===Object&&self,de=Zc||vy||Function("return this")(),fl=t&&!t.nodeType&&t,_i=fl&&!0&&e&&!e.nodeType&&e,Jc=_i&&_i.exports===fl,dl=Jc&&Zc.process,$e=function(){try{var P=_i&&_i.require&&_i.require("util").types;return P||dl&&dl.binding&&dl.binding("util")}catch{}}(),Qc=$e&&$e.isArrayBuffer,tf=$e&&$e.isDate,ef=$e&&$e.isMap,rf=$e&&$e.isRegExp,nf=$e&&$e.isSet,sf=$e&&$e.isTypedArray;function De(P,N,B){switch(B.length){case 0:return P.call(N);case 1:return P.call(N,B[0]);case 2:return P.call(N,B[0],B[1]);case 3:return P.call(N,B[0],B[1],B[2])}return P.apply(N,B)}function _y(P,N,B,Q){for(var ct=-1,It=P==null?0:P.length;++ct<It;){var ae=P[ct];N(Q,ae,B(ae),P)}return Q}function He(P,N){for(var B=-1,Q=P==null?0:P.length;++B<Q&&N(P[B],B,P)!==!1;);return P}function yy(P,N){for(var B=P==null?0:P.length;B--&&N(P[B],B,P)!==!1;);return P}function of(P,N){for(var B=-1,Q=P==null?0:P.length;++B<Q;)if(!N(P[B],B,P))return!1;return!0}function Kr(P,N){for(var B=-1,Q=P==null?0:P.length,ct=0,It=[];++B<Q;){var ae=P[B];N(ae,B,P)&&(It[ct++]=ae)}return It}function zs(P,N){var B=P==null?0:P.length;return!!B&&Ki(P,N,0)>-1}function pl(P,N,B){for(var Q=-1,ct=P==null?0:P.length;++Q<ct;)if(B(N,P[Q]))return!0;return!1}function Wt(P,N){for(var B=-1,Q=P==null?0:P.length,ct=Array(Q);++B<Q;)ct[B]=N(P[B],B,P);return ct}function Zr(P,N){for(var B=-1,Q=N.length,ct=P.length;++B<Q;)P[ct+B]=N[B];return P}function gl(P,N,B,Q){var ct=-1,It=P==null?0:P.length;for(Q&&It&&(B=P[++ct]);++ct<It;)B=N(B,P[ct],ct,P);return B}function xy(P,N,B,Q){var ct=P==null?0:P.length;for(Q&&ct&&(B=P[--ct]);ct--;)B=N(B,P[ct],ct,P);return B}function ml(P,N){for(var B=-1,Q=P==null?0:P.length;++B<Q;)if(N(P[B],B,P))return!0;return!1}var by=vl("length");function wy(P){return P.split("")}function Ey(P){return P.match(M_)||[]}function af(P,N,B){var Q;return B(P,function(ct,It,ae){if(N(ct,It,ae))return Q=It,!1}),Q}function Vs(P,N,B,Q){for(var ct=P.length,It=B+(Q?1:-1);Q?It--:++It<ct;)if(N(P[It],It,P))return It;return-1}function Ki(P,N,B){return N===N?Fy(P,N,B):Vs(P,lf,B)}function Ty(P,N,B,Q){for(var ct=B-1,It=P.length;++ct<It;)if(Q(P[ct],N))return ct;return-1}function lf(P){return P!==P}function hf(P,N){var B=P==null?0:P.length;return B?yl(P,N)/B:H}function vl(P){return function(N){return N==null?r:N[P]}}function _l(P){return function(N){return P==null?r:P[N]}}function uf(P,N,B,Q,ct){return ct(P,function(It,ae,Ft){B=Q?(Q=!1,It):N(B,It,ae,Ft)}),B}function Ay(P,N){var B=P.length;for(P.sort(N);B--;)P[B]=P[B].value;return P}function yl(P,N){for(var B,Q=-1,ct=P.length;++Q<ct;){var It=N(P[Q]);It!==r&&(B=B===r?It:B+It)}return B}function xl(P,N){for(var B=-1,Q=Array(P);++B<P;)Q[B]=N(B);return Q}function Sy(P,N){return Wt(N,function(B){return[B,P[B]]})}function cf(P){return P&&P.slice(0,gf(P)+1).replace(ol,"")}function Be(P){return function(N){return P(N)}}function bl(P,N){return Wt(N,function(B){return P[B]})}function Kn(P,N){return P.has(N)}function ff(P,N){for(var B=-1,Q=P.length;++B<Q&&Ki(N,P[B],0)>-1;);return B}function df(P,N){for(var B=P.length;B--&&Ki(N,P[B],0)>-1;);return B}function Cy(P,N){for(var B=P.length,Q=0;B--;)P[B]===N&&++Q;return Q}var Iy=_l(cy),Ry=_l(fy);function Py(P){return"\\"+py[P]}function My(P,N){return P==null?r:P[N]}function Zi(P){return ay.test(P)}function Dy(P){return ly.test(P)}function By(P){for(var N,B=[];!(N=P.next()).done;)B.push(N.value);return B}function wl(P){var N=-1,B=Array(P.size);return P.forEach(function(Q,ct){B[++N]=[ct,Q]}),B}function pf(P,N){return function(B){return P(N(B))}}function Jr(P,N){for(var B=-1,Q=P.length,ct=0,It=[];++B<Q;){var ae=P[B];(ae===N||ae===d)&&(P[B]=d,It[ct++]=B)}return It}function Ys(P){var N=-1,B=Array(P.size);return P.forEach(function(Q){B[++N]=Q}),B}function Oy(P){var N=-1,B=Array(P.size);return P.forEach(function(Q){B[++N]=[Q,Q]}),B}function Fy(P,N,B){for(var Q=B-1,ct=P.length;++Q<ct;)if(P[Q]===N)return Q;return-1}function Ly(P,N,B){for(var Q=B+1;Q--;)if(P[Q]===N)return Q;return Q}function Ji(P){return Zi(P)?ky(P):by(P)}function tr(P){return Zi(P)?Uy(P):wy(P)}function gf(P){for(var N=P.length;N--&&C_.test(P.charAt(N)););return N}var Ny=_l(dy);function ky(P){for(var N=cl.lastIndex=0;cl.test(P);)++N;return N}function Uy(P){return P.match(cl)||[]}function Gy(P){return P.match(oy)||[]}var Wy=function P(N){N=N==null?de:Qi.defaults(de.Object(),N,Qi.pick(de,hy));var B=N.Array,Q=N.Date,ct=N.Error,It=N.Function,ae=N.Math,Ft=N.Object,El=N.RegExp,$y=N.String,Xe=N.TypeError,js=B.prototype,Hy=It.prototype,tn=Ft.prototype,qs=N["__core-js_shared__"],Ks=Hy.toString,Bt=tn.hasOwnProperty,Xy=0,mf=function(){var s=/[^.]+$/.exec(qs&&qs.keys&&qs.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""}(),Zs=tn.toString,zy=Ks.call(Ft),Vy=de._,Yy=El("^"+Ks.call(Bt).replace(sl,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Js=Jc?N.Buffer:r,Qr=N.Symbol,Qs=N.Uint8Array,vf=Js?Js.allocUnsafe:r,to=pf(Ft.getPrototypeOf,Ft),_f=Ft.create,yf=tn.propertyIsEnumerable,eo=js.splice,xf=Qr?Qr.isConcatSpreadable:r,Zn=Qr?Qr.iterator:r,yi=Qr?Qr.toStringTag:r,ro=function(){try{var s=Ti(Ft,"defineProperty");return s({},"",{}),s}catch{}}(),jy=N.clearTimeout!==de.clearTimeout&&N.clearTimeout,qy=Q&&Q.now!==de.Date.now&&Q.now,Ky=N.setTimeout!==de.setTimeout&&N.setTimeout,io=ae.ceil,no=ae.floor,Tl=Ft.getOwnPropertySymbols,Zy=Js?Js.isBuffer:r,bf=N.isFinite,Jy=js.join,Qy=pf(Ft.keys,Ft),le=ae.max,ye=ae.min,t0=Q.now,e0=N.parseInt,wf=ae.random,r0=js.reverse,Al=Ti(N,"DataView"),Jn=Ti(N,"Map"),Sl=Ti(N,"Promise"),en=Ti(N,"Set"),Qn=Ti(N,"WeakMap"),ts=Ti(Ft,"create"),so=Qn&&new Qn,rn={},i0=Ai(Al),n0=Ai(Jn),s0=Ai(Sl),o0=Ai(en),a0=Ai(Qn),oo=Qr?Qr.prototype:r,es=oo?oo.valueOf:r,Ef=oo?oo.toString:r;function b(s){if(Kt(s)&&!dt(s)&&!(s instanceof wt)){if(s instanceof ze)return s;if(Bt.call(s,"__wrapped__"))return Td(s)}return new ze(s)}var nn=function(){function s(){}return function(a){if(!Ht(a))return{};if(_f)return _f(a);s.prototype=a;var c=new s;return s.prototype=r,c}}();function ao(){}function ze(s,a){this.__wrapped__=s,this.__actions__=[],this.__chain__=!!a,this.__index__=0,this.__values__=r}b.templateSettings={escape:b_,evaluate:w_,interpolate:Mc,variable:"",imports:{_:b}},b.prototype=ao.prototype,b.prototype.constructor=b,ze.prototype=nn(ao.prototype),ze.prototype.constructor=ze;function wt(s){this.__wrapped__=s,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=rt,this.__views__=[]}function l0(){var s=new wt(this.__wrapped__);return s.__actions__=Se(this.__actions__),s.__dir__=this.__dir__,s.__filtered__=this.__filtered__,s.__iteratees__=Se(this.__iteratees__),s.__takeCount__=this.__takeCount__,s.__views__=Se(this.__views__),s}function h0(){if(this.__filtered__){var s=new wt(this);s.__dir__=-1,s.__filtered__=!0}else s=this.clone(),s.__dir__*=-1;return s}function u0(){var s=this.__wrapped__.value(),a=this.__dir__,c=dt(s),p=a<0,_=c?s.length:0,T=wx(0,_,this.__views__),C=T.start,R=T.end,M=R-C,U=p?R:C-1,G=this.__iteratees__,$=G.length,q=0,tt=ye(M,this.__takeCount__);if(!c||!p&&_==M&&tt==M)return Yf(s,this.__actions__);var lt=[];t:for(;M--&&q<tt;){U+=a;for(var mt=-1,ht=s[U];++mt<$;){var yt=G[mt],At=yt.iteratee,Le=yt.type,Te=At(ht);if(Le==at)ht=Te;else if(!Te){if(Le==k)continue t;break t}}lt[q++]=ht}return lt}wt.prototype=nn(ao.prototype),wt.prototype.constructor=wt;function xi(s){var a=-1,c=s==null?0:s.length;for(this.clear();++a<c;){var p=s[a];this.set(p[0],p[1])}}function c0(){this.__data__=ts?ts(null):{},this.size=0}function f0(s){var a=this.has(s)&&delete this.__data__[s];return this.size-=a?1:0,a}function d0(s){var a=this.__data__;if(ts){var c=a[s];return c===u?r:c}return Bt.call(a,s)?a[s]:r}function p0(s){var a=this.__data__;return ts?a[s]!==r:Bt.call(a,s)}function g0(s,a){var c=this.__data__;return this.size+=this.has(s)?0:1,c[s]=ts&&a===r?u:a,this}xi.prototype.clear=c0,xi.prototype.delete=f0,xi.prototype.get=d0,xi.prototype.has=p0,xi.prototype.set=g0;function Or(s){var a=-1,c=s==null?0:s.length;for(this.clear();++a<c;){var p=s[a];this.set(p[0],p[1])}}function m0(){this.__data__=[],this.size=0}function v0(s){var a=this.__data__,c=lo(a,s);if(c<0)return!1;var p=a.length-1;return c==p?a.pop():eo.call(a,c,1),--this.size,!0}function _0(s){var a=this.__data__,c=lo(a,s);return c<0?r:a[c][1]}function y0(s){return lo(this.__data__,s)>-1}function x0(s,a){var c=this.__data__,p=lo(c,s);return p<0?(++this.size,c.push([s,a])):c[p][1]=a,this}Or.prototype.clear=m0,Or.prototype.delete=v0,Or.prototype.get=_0,Or.prototype.has=y0,Or.prototype.set=x0;function Fr(s){var a=-1,c=s==null?0:s.length;for(this.clear();++a<c;){var p=s[a];this.set(p[0],p[1])}}function b0(){this.size=0,this.__data__={hash:new xi,map:new(Jn||Or),string:new xi}}function w0(s){var a=bo(this,s).delete(s);return this.size-=a?1:0,a}function E0(s){return bo(this,s).get(s)}function T0(s){return bo(this,s).has(s)}function A0(s,a){var c=bo(this,s),p=c.size;return c.set(s,a),this.size+=c.size==p?0:1,this}Fr.prototype.clear=b0,Fr.prototype.delete=w0,Fr.prototype.get=E0,Fr.prototype.has=T0,Fr.prototype.set=A0;function bi(s){var a=-1,c=s==null?0:s.length;for(this.__data__=new Fr;++a<c;)this.add(s[a])}function S0(s){return this.__data__.set(s,u),this}function C0(s){return this.__data__.has(s)}bi.prototype.add=bi.prototype.push=S0,bi.prototype.has=C0;function er(s){var a=this.__data__=new Or(s);this.size=a.size}function I0(){this.__data__=new Or,this.size=0}function R0(s){var a=this.__data__,c=a.delete(s);return this.size=a.size,c}function P0(s){return this.__data__.get(s)}function M0(s){return this.__data__.has(s)}function D0(s,a){var c=this.__data__;if(c instanceof Or){var p=c.__data__;if(!Jn||p.length<n-1)return p.push([s,a]),this.size=++c.size,this;c=this.__data__=new Fr(p)}return c.set(s,a),this.size=c.size,this}er.prototype.clear=I0,er.prototype.delete=R0,er.prototype.get=P0,er.prototype.has=M0,er.prototype.set=D0;function Tf(s,a){var c=dt(s),p=!c&&Si(s),_=!c&&!p&&ni(s),T=!c&&!p&&!_&&ln(s),C=c||p||_||T,R=C?xl(s.length,$y):[],M=R.length;for(var U in s)(a||Bt.call(s,U))&&!(C&&(U=="length"||_&&(U=="offset"||U=="parent")||T&&(U=="buffer"||U=="byteLength"||U=="byteOffset")||Ur(U,M)))&&R.push(U);return R}function Af(s){var a=s.length;return a?s[Nl(0,a-1)]:r}function B0(s,a){return wo(Se(s),wi(a,0,s.length))}function O0(s){return wo(Se(s))}function Cl(s,a,c){(c!==r&&!rr(s[a],c)||c===r&&!(a in s))&&Lr(s,a,c)}function rs(s,a,c){var p=s[a];(!(Bt.call(s,a)&&rr(p,c))||c===r&&!(a in s))&&Lr(s,a,c)}function lo(s,a){for(var c=s.length;c--;)if(rr(s[c][0],a))return c;return-1}function F0(s,a,c,p){return ti(s,function(_,T,C){a(p,_,c(_),C)}),p}function Sf(s,a){return s&&yr(a,ce(a),s)}function L0(s,a){return s&&yr(a,Ie(a),s)}function Lr(s,a,c){a=="__proto__"&&ro?ro(s,a,{configurable:!0,enumerable:!0,value:c,writable:!0}):s[a]=c}function Il(s,a){for(var c=-1,p=a.length,_=B(p),T=s==null;++c<p;)_[c]=T?r:lh(s,a[c]);return _}function wi(s,a,c){return s===s&&(c!==r&&(s=s<=c?s:c),a!==r&&(s=s>=a?s:a)),s}function Ve(s,a,c,p,_,T){var C,R=a&g,M=a&m,U=a&v;if(c&&(C=_?c(s,p,_,T):c(s)),C!==r)return C;if(!Ht(s))return s;var G=dt(s);if(G){if(C=Tx(s),!R)return Se(s,C)}else{var $=xe(s),q=$==Ut||$==jt;if(ni(s))return Kf(s,R);if($==vr||$==Nt||q&&!_){if(C=M||q?{}:gd(s),!R)return M?dx(s,L0(C,s)):fx(s,Sf(C,s))}else{if(!Lt[$])return _?s:{};C=Ax(s,$,R)}}T=new er;var tt=T.get(s);if(tt)return tt;T.set(s,C),Xd(s)?s.forEach(function(ht){C.add(Ve(ht,a,c,ht,s,T))}):$d(s)&&s.forEach(function(ht,yt){C.set(yt,Ve(ht,a,c,yt,s,T))});var lt=U?M?jl:Yl:M?Ie:ce,mt=G?r:lt(s);return He(mt||s,function(ht,yt){mt&&(yt=ht,ht=s[yt]),rs(C,yt,Ve(ht,a,c,yt,s,T))}),C}function N0(s){var a=ce(s);return function(c){return Cf(c,s,a)}}function Cf(s,a,c){var p=c.length;if(s==null)return!p;for(s=Ft(s);p--;){var _=c[p],T=a[_],C=s[_];if(C===r&&!(_ in s)||!T(C))return!1}return!0}function If(s,a,c){if(typeof s!="function")throw new Xe(l);return hs(function(){s.apply(r,c)},a)}function is(s,a,c,p){var _=-1,T=zs,C=!0,R=s.length,M=[],U=a.length;if(!R)return M;c&&(a=Wt(a,Be(c))),p?(T=pl,C=!1):a.length>=n&&(T=Kn,C=!1,a=new bi(a));t:for(;++_<R;){var G=s[_],$=c==null?G:c(G);if(G=p||G!==0?G:0,C&&$===$){for(var q=U;q--;)if(a[q]===$)continue t;M.push(G)}else T(a,$,p)||M.push(G)}return M}var ti=ed(_r),Rf=ed(Pl,!0);function k0(s,a){var c=!0;return ti(s,function(p,_,T){return c=!!a(p,_,T),c}),c}function ho(s,a,c){for(var p=-1,_=s.length;++p<_;){var T=s[p],C=a(T);if(C!=null&&(R===r?C===C&&!Fe(C):c(C,R)))var R=C,M=T}return M}function U0(s,a,c,p){var _=s.length;for(c=gt(c),c<0&&(c=-c>_?0:_+c),p=p===r||p>_?_:gt(p),p<0&&(p+=_),p=c>p?0:Vd(p);c<p;)s[c++]=a;return s}function Pf(s,a){var c=[];return ti(s,function(p,_,T){a(p,_,T)&&c.push(p)}),c}function pe(s,a,c,p,_){var T=-1,C=s.length;for(c||(c=Cx),_=[];++T<C;){var R=s[T];a>0&&c(R)?a>1?pe(R,a-1,c,p,_):Zr(_,R):p||(_[_.length]=R)}return _}var Rl=rd(),Mf=rd(!0);function _r(s,a){return s&&Rl(s,a,ce)}function Pl(s,a){return s&&Mf(s,a,ce)}function uo(s,a){return Kr(a,function(c){return Gr(s[c])})}function Ei(s,a){a=ri(a,s);for(var c=0,p=a.length;s!=null&&c<p;)s=s[xr(a[c++])];return c&&c==p?s:r}function Df(s,a,c){var p=a(s);return dt(s)?p:Zr(p,c(s))}function we(s){return s==null?s===r?p_:vi:yi&&yi in Ft(s)?bx(s):Ox(s)}function Ml(s,a){return s>a}function G0(s,a){return s!=null&&Bt.call(s,a)}function W0(s,a){return s!=null&&a in Ft(s)}function $0(s,a,c){return s>=ye(a,c)&&s<le(a,c)}function Dl(s,a,c){for(var p=c?pl:zs,_=s[0].length,T=s.length,C=T,R=B(T),M=1/0,U=[];C--;){var G=s[C];C&&a&&(G=Wt(G,Be(a))),M=ye(G.length,M),R[C]=!c&&(a||_>=120&&G.length>=120)?new bi(C&&G):r}G=s[0];var $=-1,q=R[0];t:for(;++$<_&&U.length<M;){var tt=G[$],lt=a?a(tt):tt;if(tt=c||tt!==0?tt:0,!(q?Kn(q,lt):p(U,lt,c))){for(C=T;--C;){var mt=R[C];if(!(mt?Kn(mt,lt):p(s[C],lt,c)))continue t}q&&q.push(lt),U.push(tt)}}return U}function H0(s,a,c,p){return _r(s,function(_,T,C){a(p,c(_),T,C)}),p}function ns(s,a,c){a=ri(a,s),s=yd(s,a);var p=s==null?s:s[xr(je(a))];return p==null?r:De(p,s,c)}function Bf(s){return Kt(s)&&we(s)==Nt}function X0(s){return Kt(s)&&we(s)==qn}function z0(s){return Kt(s)&&we(s)==ne}function ss(s,a,c,p,_){return s===a?!0:s==null||a==null||!Kt(s)&&!Kt(a)?s!==s&&a!==a:V0(s,a,c,p,ss,_)}function V0(s,a,c,p,_,T){var C=dt(s),R=dt(a),M=C?kt:xe(s),U=R?kt:xe(a);M=M==Nt?vr:M,U=U==Nt?vr:U;var G=M==vr,$=U==vr,q=M==U;if(q&&ni(s)){if(!ni(a))return!1;C=!0,G=!1}if(q&&!G)return T||(T=new er),C||ln(s)?fd(s,a,c,p,_,T):yx(s,a,M,c,p,_,T);if(!(c&y)){var tt=G&&Bt.call(s,"__wrapped__"),lt=$&&Bt.call(a,"__wrapped__");if(tt||lt){var mt=tt?s.value():s,ht=lt?a.value():a;return T||(T=new er),_(mt,ht,c,p,T)}}return q?(T||(T=new er),xx(s,a,c,p,_,T)):!1}function Y0(s){return Kt(s)&&xe(s)==qt}function Bl(s,a,c,p){var _=c.length,T=_,C=!p;if(s==null)return!T;for(s=Ft(s);_--;){var R=c[_];if(C&&R[2]?R[1]!==s[R[0]]:!(R[0]in s))return!1}for(;++_<T;){R=c[_];var M=R[0],U=s[M],G=R[1];if(C&&R[2]){if(U===r&&!(M in s))return!1}else{var $=new er;if(p)var q=p(U,G,M,s,a,$);if(!(q===r?ss(G,U,y|w,p,$):q))return!1}}return!0}function Of(s){if(!Ht(s)||Rx(s))return!1;var a=Gr(s)?Yy:N_;return a.test(Ai(s))}function j0(s){return Kt(s)&&we(s)==Vn}function q0(s){return Kt(s)&&xe(s)==Qe}function K0(s){return Kt(s)&&Io(s.length)&&!!Gt[we(s)]}function Ff(s){return typeof s=="function"?s:s==null?Re:typeof s=="object"?dt(s)?kf(s[0],s[1]):Nf(s):ip(s)}function Ol(s){if(!ls(s))return Qy(s);var a=[];for(var c in Ft(s))Bt.call(s,c)&&c!="constructor"&&a.push(c);return a}function Z0(s){if(!Ht(s))return Bx(s);var a=ls(s),c=[];for(var p in s)p=="constructor"&&(a||!Bt.call(s,p))||c.push(p);return c}function Fl(s,a){return s<a}function Lf(s,a){var c=-1,p=Ce(s)?B(s.length):[];return ti(s,function(_,T,C){p[++c]=a(_,T,C)}),p}function Nf(s){var a=Kl(s);return a.length==1&&a[0][2]?vd(a[0][0],a[0][1]):function(c){return c===s||Bl(c,s,a)}}function kf(s,a){return Jl(s)&&md(a)?vd(xr(s),a):function(c){var p=lh(c,s);return p===r&&p===a?hh(c,s):ss(a,p,y|w)}}function co(s,a,c,p,_){s!==a&&Rl(a,function(T,C){if(_||(_=new er),Ht(T))J0(s,a,C,c,co,p,_);else{var R=p?p(th(s,C),T,C+"",s,a,_):r;R===r&&(R=T),Cl(s,C,R)}},Ie)}function J0(s,a,c,p,_,T,C){var R=th(s,c),M=th(a,c),U=C.get(M);if(U){Cl(s,c,U);return}var G=T?T(R,M,c+"",s,a,C):r,$=G===r;if($){var q=dt(M),tt=!q&&ni(M),lt=!q&&!tt&&ln(M);G=M,q||tt||lt?dt(R)?G=R:Jt(R)?G=Se(R):tt?($=!1,G=Kf(M,!0)):lt?($=!1,G=Zf(M,!0)):G=[]:us(M)||Si(M)?(G=R,Si(R)?G=Yd(R):(!Ht(R)||Gr(R))&&(G=gd(M))):$=!1}$&&(C.set(M,G),_(G,M,p,T,C),C.delete(M)),Cl(s,c,G)}function Uf(s,a){var c=s.length;if(c)return a+=a<0?c:0,Ur(a,c)?s[a]:r}function Gf(s,a,c){a.length?a=Wt(a,function(T){return dt(T)?function(C){return Ei(C,T.length===1?T[0]:T)}:T}):a=[Re];var p=-1;a=Wt(a,Be(ot()));var _=Lf(s,function(T,C,R){var M=Wt(a,function(U){return U(T)});return{criteria:M,index:++p,value:T}});return Ay(_,function(T,C){return cx(T,C,c)})}function Q0(s,a){return Wf(s,a,function(c,p){return hh(s,p)})}function Wf(s,a,c){for(var p=-1,_=a.length,T={};++p<_;){var C=a[p],R=Ei(s,C);c(R,C)&&os(T,ri(C,s),R)}return T}function tx(s){return function(a){return Ei(a,s)}}function Ll(s,a,c,p){var _=p?Ty:Ki,T=-1,C=a.length,R=s;for(s===a&&(a=Se(a)),c&&(R=Wt(s,Be(c)));++T<C;)for(var M=0,U=a[T],G=c?c(U):U;(M=_(R,G,M,p))>-1;)R!==s&&eo.call(R,M,1),eo.call(s,M,1);return s}function $f(s,a){for(var c=s?a.length:0,p=c-1;c--;){var _=a[c];if(c==p||_!==T){var T=_;Ur(_)?eo.call(s,_,1):Gl(s,_)}}return s}function Nl(s,a){return s+no(wf()*(a-s+1))}function ex(s,a,c,p){for(var _=-1,T=le(io((a-s)/(c||1)),0),C=B(T);T--;)C[p?T:++_]=s,s+=c;return C}function kl(s,a){var c="";if(!s||a<1||a>vt)return c;do a%2&&(c+=s),a=no(a/2),a&&(s+=s);while(a);return c}function _t(s,a){return eh(_d(s,a,Re),s+"")}function rx(s){return Af(hn(s))}function ix(s,a){var c=hn(s);return wo(c,wi(a,0,c.length))}function os(s,a,c,p){if(!Ht(s))return s;a=ri(a,s);for(var _=-1,T=a.length,C=T-1,R=s;R!=null&&++_<T;){var M=xr(a[_]),U=c;if(M==="__proto__"||M==="constructor"||M==="prototype")return s;if(_!=C){var G=R[M];U=p?p(G,M,R):r,U===r&&(U=Ht(G)?G:Ur(a[_+1])?[]:{})}rs(R,M,U),R=R[M]}return s}var Hf=so?function(s,a){return so.set(s,a),s}:Re,nx=ro?function(s,a){return ro(s,"toString",{configurable:!0,enumerable:!1,value:ch(a),writable:!0})}:Re;function sx(s){return wo(hn(s))}function Ye(s,a,c){var p=-1,_=s.length;a<0&&(a=-a>_?0:_+a),c=c>_?_:c,c<0&&(c+=_),_=a>c?0:c-a>>>0,a>>>=0;for(var T=B(_);++p<_;)T[p]=s[p+a];return T}function ox(s,a){var c;return ti(s,function(p,_,T){return c=a(p,_,T),!c}),!!c}function fo(s,a,c){var p=0,_=s==null?p:s.length;if(typeof a=="number"&&a===a&&_<=Rt){for(;p<_;){var T=p+_>>>1,C=s[T];C!==null&&!Fe(C)&&(c?C<=a:C<a)?p=T+1:_=T}return _}return Ul(s,a,Re,c)}function Ul(s,a,c,p){var _=0,T=s==null?0:s.length;if(T===0)return 0;a=c(a);for(var C=a!==a,R=a===null,M=Fe(a),U=a===r;_<T;){var G=no((_+T)/2),$=c(s[G]),q=$!==r,tt=$===null,lt=$===$,mt=Fe($);if(C)var ht=p||lt;else U?ht=lt&&(p||q):R?ht=lt&&q&&(p||!tt):M?ht=lt&&q&&!tt&&(p||!mt):tt||mt?ht=!1:ht=p?$<=a:$<a;ht?_=G+1:T=G}return ye(T,bt)}function Xf(s,a){for(var c=-1,p=s.length,_=0,T=[];++c<p;){var C=s[c],R=a?a(C):C;if(!c||!rr(R,M)){var M=R;T[_++]=C===0?0:C}}return T}function zf(s){return typeof s=="number"?s:Fe(s)?H:+s}function Oe(s){if(typeof s=="string")return s;if(dt(s))return Wt(s,Oe)+"";if(Fe(s))return Ef?Ef.call(s):"";var a=s+"";return a=="0"&&1/s==-Y?"-0":a}function ei(s,a,c){var p=-1,_=zs,T=s.length,C=!0,R=[],M=R;if(c)C=!1,_=pl;else if(T>=n){var U=a?null:vx(s);if(U)return Ys(U);C=!1,_=Kn,M=new bi}else M=a?[]:R;t:for(;++p<T;){var G=s[p],$=a?a(G):G;if(G=c||G!==0?G:0,C&&$===$){for(var q=M.length;q--;)if(M[q]===$)continue t;a&&M.push($),R.push(G)}else _(M,$,c)||(M!==R&&M.push($),R.push(G))}return R}function Gl(s,a){return a=ri(a,s),s=yd(s,a),s==null||delete s[xr(je(a))]}function Vf(s,a,c,p){return os(s,a,c(Ei(s,a)),p)}function po(s,a,c,p){for(var _=s.length,T=p?_:-1;(p?T--:++T<_)&&a(s[T],T,s););return c?Ye(s,p?0:T,p?T+1:_):Ye(s,p?T+1:0,p?_:T)}function Yf(s,a){var c=s;return c instanceof wt&&(c=c.value()),gl(a,function(p,_){return _.func.apply(_.thisArg,Zr([p],_.args))},c)}function Wl(s,a,c){var p=s.length;if(p<2)return p?ei(s[0]):[];for(var _=-1,T=B(p);++_<p;)for(var C=s[_],R=-1;++R<p;)R!=_&&(T[_]=is(T[_]||C,s[R],a,c));return ei(pe(T,1),a,c)}function jf(s,a,c){for(var p=-1,_=s.length,T=a.length,C={};++p<_;){var R=p<T?a[p]:r;c(C,s[p],R)}return C}function $l(s){return Jt(s)?s:[]}function Hl(s){return typeof s=="function"?s:Re}function ri(s,a){return dt(s)?s:Jl(s,a)?[s]:Ed(Pt(s))}var ax=_t;function ii(s,a,c){var p=s.length;return c=c===r?p:c,!a&&c>=p?s:Ye(s,a,c)}var qf=jy||function(s){return de.clearTimeout(s)};function Kf(s,a){if(a)return s.slice();var c=s.length,p=vf?vf(c):new s.constructor(c);return s.copy(p),p}function Xl(s){var a=new s.constructor(s.byteLength);return new Qs(a).set(new Qs(s)),a}function lx(s,a){var c=a?Xl(s.buffer):s.buffer;return new s.constructor(c,s.byteOffset,s.byteLength)}function hx(s){var a=new s.constructor(s.source,Dc.exec(s));return a.lastIndex=s.lastIndex,a}function ux(s){return es?Ft(es.call(s)):{}}function Zf(s,a){var c=a?Xl(s.buffer):s.buffer;return new s.constructor(c,s.byteOffset,s.length)}function Jf(s,a){if(s!==a){var c=s!==r,p=s===null,_=s===s,T=Fe(s),C=a!==r,R=a===null,M=a===a,U=Fe(a);if(!R&&!U&&!T&&s>a||T&&C&&M&&!R&&!U||p&&C&&M||!c&&M||!_)return 1;if(!p&&!T&&!U&&s<a||U&&c&&_&&!p&&!T||R&&c&&_||!C&&_||!M)return-1}return 0}function cx(s,a,c){for(var p=-1,_=s.criteria,T=a.criteria,C=_.length,R=c.length;++p<C;){var M=Jf(_[p],T[p]);if(M){if(p>=R)return M;var U=c[p];return M*(U=="desc"?-1:1)}}return s.index-a.index}function Qf(s,a,c,p){for(var _=-1,T=s.length,C=c.length,R=-1,M=a.length,U=le(T-C,0),G=B(M+U),$=!p;++R<M;)G[R]=a[R];for(;++_<C;)($||_<T)&&(G[c[_]]=s[_]);for(;U--;)G[R++]=s[_++];return G}function td(s,a,c,p){for(var _=-1,T=s.length,C=-1,R=c.length,M=-1,U=a.length,G=le(T-R,0),$=B(G+U),q=!p;++_<G;)$[_]=s[_];for(var tt=_;++M<U;)$[tt+M]=a[M];for(;++C<R;)(q||_<T)&&($[tt+c[C]]=s[_++]);return $}function Se(s,a){var c=-1,p=s.length;for(a||(a=B(p));++c<p;)a[c]=s[c];return a}function yr(s,a,c,p){var _=!c;c||(c={});for(var T=-1,C=a.length;++T<C;){var R=a[T],M=p?p(c[R],s[R],R,c,s):r;M===r&&(M=s[R]),_?Lr(c,R,M):rs(c,R,M)}return c}function fx(s,a){return yr(s,Zl(s),a)}function dx(s,a){return yr(s,dd(s),a)}function go(s,a){return function(c,p){var _=dt(c)?_y:F0,T=a?a():{};return _(c,s,ot(p,2),T)}}function sn(s){return _t(function(a,c){var p=-1,_=c.length,T=_>1?c[_-1]:r,C=_>2?c[2]:r;for(T=s.length>3&&typeof T=="function"?(_--,T):r,C&&Ee(c[0],c[1],C)&&(T=_<3?r:T,_=1),a=Ft(a);++p<_;){var R=c[p];R&&s(a,R,p,T)}return a})}function ed(s,a){return function(c,p){if(c==null)return c;if(!Ce(c))return s(c,p);for(var _=c.length,T=a?_:-1,C=Ft(c);(a?T--:++T<_)&&p(C[T],T,C)!==!1;);return c}}function rd(s){return function(a,c,p){for(var _=-1,T=Ft(a),C=p(a),R=C.length;R--;){var M=C[s?R:++_];if(c(T[M],M,T)===!1)break}return a}}function px(s,a,c){var p=a&x,_=as(s);function T(){var C=this&&this!==de&&this instanceof T?_:s;return C.apply(p?c:this,arguments)}return T}function id(s){return function(a){a=Pt(a);var c=Zi(a)?tr(a):r,p=c?c[0]:a.charAt(0),_=c?ii(c,1).join(""):a.slice(1);return p[s]()+_}}function on(s){return function(a){return gl(ep(tp(a).replace(ny,"")),s,"")}}function as(s){return function(){var a=arguments;switch(a.length){case 0:return new s;case 1:return new s(a[0]);case 2:return new s(a[0],a[1]);case 3:return new s(a[0],a[1],a[2]);case 4:return new s(a[0],a[1],a[2],a[3]);case 5:return new s(a[0],a[1],a[2],a[3],a[4]);case 6:return new s(a[0],a[1],a[2],a[3],a[4],a[5]);case 7:return new s(a[0],a[1],a[2],a[3],a[4],a[5],a[6])}var c=nn(s.prototype),p=s.apply(c,a);return Ht(p)?p:c}}function gx(s,a,c){var p=as(s);function _(){for(var T=arguments.length,C=B(T),R=T,M=an(_);R--;)C[R]=arguments[R];var U=T<3&&C[0]!==M&&C[T-1]!==M?[]:Jr(C,M);if(T-=U.length,T<c)return ld(s,a,mo,_.placeholder,r,C,U,r,r,c-T);var G=this&&this!==de&&this instanceof _?p:s;return De(G,this,C)}return _}function nd(s){return function(a,c,p){var _=Ft(a);if(!Ce(a)){var T=ot(c,3);a=ce(a),c=function(R){return T(_[R],R,_)}}var C=s(a,c,p);return C>-1?_[T?a[C]:C]:r}}function sd(s){return kr(function(a){var c=a.length,p=c,_=ze.prototype.thru;for(s&&a.reverse();p--;){var T=a[p];if(typeof T!="function")throw new Xe(l);if(_&&!C&&xo(T)=="wrapper")var C=new ze([],!0)}for(p=C?p:c;++p<c;){T=a[p];var R=xo(T),M=R=="wrapper"?ql(T):r;M&&Ql(M[0])&&M[1]==(O|E|D|F)&&!M[4].length&&M[9]==1?C=C[xo(M[0])].apply(C,M[3]):C=T.length==1&&Ql(T)?C[R]():C.thru(T)}return function(){var U=arguments,G=U[0];if(C&&U.length==1&&dt(G))return C.plant(G).value();for(var $=0,q=c?a[$].apply(this,U):G;++$<c;)q=a[$].call(this,q);return q}})}function mo(s,a,c,p,_,T,C,R,M,U){var G=a&O,$=a&x,q=a&A,tt=a&(E|I),lt=a&X,mt=q?r:as(s);function ht(){for(var yt=arguments.length,At=B(yt),Le=yt;Le--;)At[Le]=arguments[Le];if(tt)var Te=an(ht),Ne=Cy(At,Te);if(p&&(At=Qf(At,p,_,tt)),T&&(At=td(At,T,C,tt)),yt-=Ne,tt&&yt<U){var Qt=Jr(At,Te);return ld(s,a,mo,ht.placeholder,c,At,Qt,R,M,U-yt)}var ir=$?c:this,$r=q?ir[s]:s;return yt=At.length,R?At=Fx(At,R):lt&&yt>1&&At.reverse(),G&&M<yt&&(At.length=M),this&&this!==de&&this instanceof ht&&($r=mt||as($r)),$r.apply(ir,At)}return ht}function od(s,a){return function(c,p){return H0(c,s,a(p),{})}}function vo(s,a){return function(c,p){var _;if(c===r&&p===r)return a;if(c!==r&&(_=c),p!==r){if(_===r)return p;typeof c=="string"||typeof p=="string"?(c=Oe(c),p=Oe(p)):(c=zf(c),p=zf(p)),_=s(c,p)}return _}}function zl(s){return kr(function(a){return a=Wt(a,Be(ot())),_t(function(c){var p=this;return s(a,function(_){return De(_,p,c)})})})}function _o(s,a){a=a===r?" ":Oe(a);var c=a.length;if(c<2)return c?kl(a,s):a;var p=kl(a,io(s/Ji(a)));return Zi(a)?ii(tr(p),0,s).join(""):p.slice(0,s)}function mx(s,a,c,p){var _=a&x,T=as(s);function C(){for(var R=-1,M=arguments.length,U=-1,G=p.length,$=B(G+M),q=this&&this!==de&&this instanceof C?T:s;++U<G;)$[U]=p[U];for(;M--;)$[U++]=arguments[++R];return De(q,_?c:this,$)}return C}function ad(s){return function(a,c,p){return p&&typeof p!="number"&&Ee(a,c,p)&&(c=p=r),a=Wr(a),c===r?(c=a,a=0):c=Wr(c),p=p===r?a<c?1:-1:Wr(p),ex(a,c,p,s)}}function yo(s){return function(a,c){return typeof a=="string"&&typeof c=="string"||(a=qe(a),c=qe(c)),s(a,c)}}function ld(s,a,c,p,_,T,C,R,M,U){var G=a&E,$=G?C:r,q=G?r:C,tt=G?T:r,lt=G?r:T;a|=G?D:L,a&=~(G?L:D),a&S||(a&=~(x|A));var mt=[s,a,_,tt,$,lt,q,R,M,U],ht=c.apply(r,mt);return Ql(s)&&xd(ht,mt),ht.placeholder=p,bd(ht,s,a)}function Vl(s){var a=ae[s];return function(c,p){if(c=qe(c),p=p==null?0:ye(gt(p),292),p&&bf(c)){var _=(Pt(c)+"e").split("e"),T=a(_[0]+"e"+(+_[1]+p));return _=(Pt(T)+"e").split("e"),+(_[0]+"e"+(+_[1]-p))}return a(c)}}var vx=en&&1/Ys(new en([,-0]))[1]==Y?function(s){return new en(s)}:ph;function hd(s){return function(a){var c=xe(a);return c==qt?wl(a):c==Qe?Oy(a):Sy(a,s(a))}}function Nr(s,a,c,p,_,T,C,R){var M=a&A;if(!M&&typeof s!="function")throw new Xe(l);var U=p?p.length:0;if(U||(a&=~(D|L),p=_=r),C=C===r?C:le(gt(C),0),R=R===r?R:gt(R),U-=_?_.length:0,a&L){var G=p,$=_;p=_=r}var q=M?r:ql(s),tt=[s,a,c,p,_,G,$,T,C,R];if(q&&Dx(tt,q),s=tt[0],a=tt[1],c=tt[2],p=tt[3],_=tt[4],R=tt[9]=tt[9]===r?M?0:s.length:le(tt[9]-U,0),!R&&a&(E|I)&&(a&=~(E|I)),!a||a==x)var lt=px(s,a,c);else a==E||a==I?lt=gx(s,a,R):(a==D||a==(x|D))&&!_.length?lt=mx(s,a,c,p):lt=mo.apply(r,tt);var mt=q?Hf:xd;return bd(mt(lt,tt),s,a)}function ud(s,a,c,p){return s===r||rr(s,tn[c])&&!Bt.call(p,c)?a:s}function cd(s,a,c,p,_,T){return Ht(s)&&Ht(a)&&(T.set(a,s),co(s,a,r,cd,T),T.delete(a)),s}function _x(s){return us(s)?r:s}function fd(s,a,c,p,_,T){var C=c&y,R=s.length,M=a.length;if(R!=M&&!(C&&M>R))return!1;var U=T.get(s),G=T.get(a);if(U&&G)return U==a&&G==s;var $=-1,q=!0,tt=c&w?new bi:r;for(T.set(s,a),T.set(a,s);++$<R;){var lt=s[$],mt=a[$];if(p)var ht=C?p(mt,lt,$,a,s,T):p(lt,mt,$,s,a,T);if(ht!==r){if(ht)continue;q=!1;break}if(tt){if(!ml(a,function(yt,At){if(!Kn(tt,At)&&(lt===yt||_(lt,yt,c,p,T)))return tt.push(At)})){q=!1;break}}else if(!(lt===mt||_(lt,mt,c,p,T))){q=!1;break}}return T.delete(s),T.delete(a),q}function yx(s,a,c,p,_,T,C){switch(c){case ji:if(s.byteLength!=a.byteLength||s.byteOffset!=a.byteOffset)return!1;s=s.buffer,a=a.buffer;case qn:return!(s.byteLength!=a.byteLength||!T(new Qs(s),new Qs(a)));case Yt:case ne:case _e:return rr(+s,+a);case Dt:return s.name==a.name&&s.message==a.message;case Vn:case Yn:return s==a+"";case qt:var R=wl;case Qe:var M=p&y;if(R||(R=Ys),s.size!=a.size&&!M)return!1;var U=C.get(s);if(U)return U==a;p|=w,C.set(s,a);var G=fd(R(s),R(a),p,_,T,C);return C.delete(s),G;case Ws:if(es)return es.call(s)==es.call(a)}return!1}function xx(s,a,c,p,_,T){var C=c&y,R=Yl(s),M=R.length,U=Yl(a),G=U.length;if(M!=G&&!C)return!1;for(var $=M;$--;){var q=R[$];if(!(C?q in a:Bt.call(a,q)))return!1}var tt=T.get(s),lt=T.get(a);if(tt&&lt)return tt==a&&lt==s;var mt=!0;T.set(s,a),T.set(a,s);for(var ht=C;++$<M;){q=R[$];var yt=s[q],At=a[q];if(p)var Le=C?p(At,yt,q,a,s,T):p(yt,At,q,s,a,T);if(!(Le===r?yt===At||_(yt,At,c,p,T):Le)){mt=!1;break}ht||(ht=q=="constructor")}if(mt&&!ht){var Te=s.constructor,Ne=a.constructor;Te!=Ne&&"constructor"in s&&"constructor"in a&&!(typeof Te=="function"&&Te instanceof Te&&typeof Ne=="function"&&Ne instanceof Ne)&&(mt=!1)}return T.delete(s),T.delete(a),mt}function kr(s){return eh(_d(s,r,Cd),s+"")}function Yl(s){return Df(s,ce,Zl)}function jl(s){return Df(s,Ie,dd)}var ql=so?function(s){return so.get(s)}:ph;function xo(s){for(var a=s.name+"",c=rn[a],p=Bt.call(rn,a)?c.length:0;p--;){var _=c[p],T=_.func;if(T==null||T==s)return _.name}return a}function an(s){var a=Bt.call(b,"placeholder")?b:s;return a.placeholder}function ot(){var s=b.iteratee||fh;return s=s===fh?Ff:s,arguments.length?s(arguments[0],arguments[1]):s}function bo(s,a){var c=s.__data__;return Ix(a)?c[typeof a=="string"?"string":"hash"]:c.map}function Kl(s){for(var a=ce(s),c=a.length;c--;){var p=a[c],_=s[p];a[c]=[p,_,md(_)]}return a}function Ti(s,a){var c=My(s,a);return Of(c)?c:r}function bx(s){var a=Bt.call(s,yi),c=s[yi];try{s[yi]=r;var p=!0}catch{}var _=Zs.call(s);return p&&(a?s[yi]=c:delete s[yi]),_}var Zl=Tl?function(s){return s==null?[]:(s=Ft(s),Kr(Tl(s),function(a){return yf.call(s,a)}))}:gh,dd=Tl?function(s){for(var a=[];s;)Zr(a,Zl(s)),s=to(s);return a}:gh,xe=we;(Al&&xe(new Al(new ArrayBuffer(1)))!=ji||Jn&&xe(new Jn)!=qt||Sl&&xe(Sl.resolve())!=Ic||en&&xe(new en)!=Qe||Qn&&xe(new Qn)!=jn)&&(xe=function(s){var a=we(s),c=a==vr?s.constructor:r,p=c?Ai(c):"";if(p)switch(p){case i0:return ji;case n0:return qt;case s0:return Ic;case o0:return Qe;case a0:return jn}return a});function wx(s,a,c){for(var p=-1,_=c.length;++p<_;){var T=c[p],C=T.size;switch(T.type){case"drop":s+=C;break;case"dropRight":a-=C;break;case"take":a=ye(a,s+C);break;case"takeRight":s=le(s,a-C);break}}return{start:s,end:a}}function Ex(s){var a=s.match(R_);return a?a[1].split(P_):[]}function pd(s,a,c){a=ri(a,s);for(var p=-1,_=a.length,T=!1;++p<_;){var C=xr(a[p]);if(!(T=s!=null&&c(s,C)))break;s=s[C]}return T||++p!=_?T:(_=s==null?0:s.length,!!_&&Io(_)&&Ur(C,_)&&(dt(s)||Si(s)))}function Tx(s){var a=s.length,c=new s.constructor(a);return a&&typeof s[0]=="string"&&Bt.call(s,"index")&&(c.index=s.index,c.input=s.input),c}function gd(s){return typeof s.constructor=="function"&&!ls(s)?nn(to(s)):{}}function Ax(s,a,c){var p=s.constructor;switch(a){case qn:return Xl(s);case Yt:case ne:return new p(+s);case ji:return lx(s,c);case Ka:case Za:case Ja:case Qa:case tl:case el:case rl:case il:case nl:return Zf(s,c);case qt:return new p;case _e:case Yn:return new p(s);case Vn:return hx(s);case Qe:return new p;case Ws:return ux(s)}}function Sx(s,a){var c=a.length;if(!c)return s;var p=c-1;return a[p]=(c>1?"& ":"")+a[p],a=a.join(c>2?", ":" "),s.replace(I_,`{
/* [wrapped with `+a+`] */
`)}function Cx(s){return dt(s)||Si(s)||!!(xf&&s&&s[xf])}function Ur(s,a){var c=typeof s;return a=a??vt,!!a&&(c=="number"||c!="symbol"&&U_.test(s))&&s>-1&&s%1==0&&s<a}function Ee(s,a,c){if(!Ht(c))return!1;var p=typeof a;return(p=="number"?Ce(c)&&Ur(a,c.length):p=="string"&&a in c)?rr(c[a],s):!1}function Jl(s,a){if(dt(s))return!1;var c=typeof s;return c=="number"||c=="symbol"||c=="boolean"||s==null||Fe(s)?!0:T_.test(s)||!E_.test(s)||a!=null&&s in Ft(a)}function Ix(s){var a=typeof s;return a=="string"||a=="number"||a=="symbol"||a=="boolean"?s!=="__proto__":s===null}function Ql(s){var a=xo(s),c=b[a];if(typeof c!="function"||!(a in wt.prototype))return!1;if(s===c)return!0;var p=ql(c);return!!p&&s===p[0]}function Rx(s){return!!mf&&mf in s}var Px=qs?Gr:mh;function ls(s){var a=s&&s.constructor,c=typeof a=="function"&&a.prototype||tn;return s===c}function md(s){return s===s&&!Ht(s)}function vd(s,a){return function(c){return c==null?!1:c[s]===a&&(a!==r||s in Ft(c))}}function Mx(s){var a=So(s,function(p){return c.size===f&&c.clear(),p}),c=a.cache;return a}function Dx(s,a){var c=s[1],p=a[1],_=c|p,T=_<(x|A|O),C=p==O&&c==E||p==O&&c==F&&s[7].length<=a[8]||p==(O|F)&&a[7].length<=a[8]&&c==E;if(!(T||C))return s;p&x&&(s[2]=a[2],_|=c&x?0:S);var R=a[3];if(R){var M=s[3];s[3]=M?Qf(M,R,a[4]):R,s[4]=M?Jr(s[3],d):a[4]}return R=a[5],R&&(M=s[5],s[5]=M?td(M,R,a[6]):R,s[6]=M?Jr(s[5],d):a[6]),R=a[7],R&&(s[7]=R),p&O&&(s[8]=s[8]==null?a[8]:ye(s[8],a[8])),s[9]==null&&(s[9]=a[9]),s[0]=a[0],s[1]=_,s}function Bx(s){var a=[];if(s!=null)for(var c in Ft(s))a.push(c);return a}function Ox(s){return Zs.call(s)}function _d(s,a,c){return a=le(a===r?s.length-1:a,0),function(){for(var p=arguments,_=-1,T=le(p.length-a,0),C=B(T);++_<T;)C[_]=p[a+_];_=-1;for(var R=B(a+1);++_<a;)R[_]=p[_];return R[a]=c(C),De(s,this,R)}}function yd(s,a){return a.length<2?s:Ei(s,Ye(a,0,-1))}function Fx(s,a){for(var c=s.length,p=ye(a.length,c),_=Se(s);p--;){var T=a[p];s[p]=Ur(T,c)?_[T]:r}return s}function th(s,a){if(!(a==="constructor"&&typeof s[a]=="function")&&a!="__proto__")return s[a]}var xd=wd(Hf),hs=Ky||function(s,a){return de.setTimeout(s,a)},eh=wd(nx);function bd(s,a,c){var p=a+"";return eh(s,Sx(p,Lx(Ex(p),c)))}function wd(s){var a=0,c=0;return function(){var p=t0(),_=W-(p-c);if(c=p,_>0){if(++a>=K)return arguments[0]}else a=0;return s.apply(r,arguments)}}function wo(s,a){var c=-1,p=s.length,_=p-1;for(a=a===r?p:a;++c<a;){var T=Nl(c,_),C=s[T];s[T]=s[c],s[c]=C}return s.length=a,s}var Ed=Mx(function(s){var a=[];return s.charCodeAt(0)===46&&a.push(""),s.replace(A_,function(c,p,_,T){a.push(_?T.replace(B_,"$1"):p||c)}),a});function xr(s){if(typeof s=="string"||Fe(s))return s;var a=s+"";return a=="0"&&1/s==-Y?"-0":a}function Ai(s){if(s!=null){try{return Ks.call(s)}catch{}try{return s+""}catch{}}return""}function Lx(s,a){return He(Mt,function(c){var p="_."+c[0];a&c[1]&&!zs(s,p)&&s.push(p)}),s.sort()}function Td(s){if(s instanceof wt)return s.clone();var a=new ze(s.__wrapped__,s.__chain__);return a.__actions__=Se(s.__actions__),a.__index__=s.__index__,a.__values__=s.__values__,a}function Nx(s,a,c){(c?Ee(s,a,c):a===r)?a=1:a=le(gt(a),0);var p=s==null?0:s.length;if(!p||a<1)return[];for(var _=0,T=0,C=B(io(p/a));_<p;)C[T++]=Ye(s,_,_+=a);return C}function kx(s){for(var a=-1,c=s==null?0:s.length,p=0,_=[];++a<c;){var T=s[a];T&&(_[p++]=T)}return _}function Ux(){var s=arguments.length;if(!s)return[];for(var a=B(s-1),c=arguments[0],p=s;p--;)a[p-1]=arguments[p];return Zr(dt(c)?Se(c):[c],pe(a,1))}var Gx=_t(function(s,a){return Jt(s)?is(s,pe(a,1,Jt,!0)):[]}),Wx=_t(function(s,a){var c=je(a);return Jt(c)&&(c=r),Jt(s)?is(s,pe(a,1,Jt,!0),ot(c,2)):[]}),$x=_t(function(s,a){var c=je(a);return Jt(c)&&(c=r),Jt(s)?is(s,pe(a,1,Jt,!0),r,c):[]});function Hx(s,a,c){var p=s==null?0:s.length;return p?(a=c||a===r?1:gt(a),Ye(s,a<0?0:a,p)):[]}function Xx(s,a,c){var p=s==null?0:s.length;return p?(a=c||a===r?1:gt(a),a=p-a,Ye(s,0,a<0?0:a)):[]}function zx(s,a){return s&&s.length?po(s,ot(a,3),!0,!0):[]}function Vx(s,a){return s&&s.length?po(s,ot(a,3),!0):[]}function Yx(s,a,c,p){var _=s==null?0:s.length;return _?(c&&typeof c!="number"&&Ee(s,a,c)&&(c=0,p=_),U0(s,a,c,p)):[]}function Ad(s,a,c){var p=s==null?0:s.length;if(!p)return-1;var _=c==null?0:gt(c);return _<0&&(_=le(p+_,0)),Vs(s,ot(a,3),_)}function Sd(s,a,c){var p=s==null?0:s.length;if(!p)return-1;var _=p-1;return c!==r&&(_=gt(c),_=c<0?le(p+_,0):ye(_,p-1)),Vs(s,ot(a,3),_,!0)}function Cd(s){var a=s==null?0:s.length;return a?pe(s,1):[]}function jx(s){var a=s==null?0:s.length;return a?pe(s,Y):[]}function qx(s,a){var c=s==null?0:s.length;return c?(a=a===r?1:gt(a),pe(s,a)):[]}function Kx(s){for(var a=-1,c=s==null?0:s.length,p={};++a<c;){var _=s[a];p[_[0]]=_[1]}return p}function Id(s){return s&&s.length?s[0]:r}function Zx(s,a,c){var p=s==null?0:s.length;if(!p)return-1;var _=c==null?0:gt(c);return _<0&&(_=le(p+_,0)),Ki(s,a,_)}function Jx(s){var a=s==null?0:s.length;return a?Ye(s,0,-1):[]}var Qx=_t(function(s){var a=Wt(s,$l);return a.length&&a[0]===s[0]?Dl(a):[]}),tb=_t(function(s){var a=je(s),c=Wt(s,$l);return a===je(c)?a=r:c.pop(),c.length&&c[0]===s[0]?Dl(c,ot(a,2)):[]}),eb=_t(function(s){var a=je(s),c=Wt(s,$l);return a=typeof a=="function"?a:r,a&&c.pop(),c.length&&c[0]===s[0]?Dl(c,r,a):[]});function rb(s,a){return s==null?"":Jy.call(s,a)}function je(s){var a=s==null?0:s.length;return a?s[a-1]:r}function ib(s,a,c){var p=s==null?0:s.length;if(!p)return-1;var _=p;return c!==r&&(_=gt(c),_=_<0?le(p+_,0):ye(_,p-1)),a===a?Ly(s,a,_):Vs(s,lf,_,!0)}function nb(s,a){return s&&s.length?Uf(s,gt(a)):r}var sb=_t(Rd);function Rd(s,a){return s&&s.length&&a&&a.length?Ll(s,a):s}function ob(s,a,c){return s&&s.length&&a&&a.length?Ll(s,a,ot(c,2)):s}function ab(s,a,c){return s&&s.length&&a&&a.length?Ll(s,a,r,c):s}var lb=kr(function(s,a){var c=s==null?0:s.length,p=Il(s,a);return $f(s,Wt(a,function(_){return Ur(_,c)?+_:_}).sort(Jf)),p});function hb(s,a){var c=[];if(!(s&&s.length))return c;var p=-1,_=[],T=s.length;for(a=ot(a,3);++p<T;){var C=s[p];a(C,p,s)&&(c.push(C),_.push(p))}return $f(s,_),c}function rh(s){return s==null?s:r0.call(s)}function ub(s,a,c){var p=s==null?0:s.length;return p?(c&&typeof c!="number"&&Ee(s,a,c)?(a=0,c=p):(a=a==null?0:gt(a),c=c===r?p:gt(c)),Ye(s,a,c)):[]}function cb(s,a){return fo(s,a)}function fb(s,a,c){return Ul(s,a,ot(c,2))}function db(s,a){var c=s==null?0:s.length;if(c){var p=fo(s,a);if(p<c&&rr(s[p],a))return p}return-1}function pb(s,a){return fo(s,a,!0)}function gb(s,a,c){return Ul(s,a,ot(c,2),!0)}function mb(s,a){var c=s==null?0:s.length;if(c){var p=fo(s,a,!0)-1;if(rr(s[p],a))return p}return-1}function vb(s){return s&&s.length?Xf(s):[]}function _b(s,a){return s&&s.length?Xf(s,ot(a,2)):[]}function yb(s){var a=s==null?0:s.length;return a?Ye(s,1,a):[]}function xb(s,a,c){return s&&s.length?(a=c||a===r?1:gt(a),Ye(s,0,a<0?0:a)):[]}function bb(s,a,c){var p=s==null?0:s.length;return p?(a=c||a===r?1:gt(a),a=p-a,Ye(s,a<0?0:a,p)):[]}function wb(s,a){return s&&s.length?po(s,ot(a,3),!1,!0):[]}function Eb(s,a){return s&&s.length?po(s,ot(a,3)):[]}var Tb=_t(function(s){return ei(pe(s,1,Jt,!0))}),Ab=_t(function(s){var a=je(s);return Jt(a)&&(a=r),ei(pe(s,1,Jt,!0),ot(a,2))}),Sb=_t(function(s){var a=je(s);return a=typeof a=="function"?a:r,ei(pe(s,1,Jt,!0),r,a)});function Cb(s){return s&&s.length?ei(s):[]}function Ib(s,a){return s&&s.length?ei(s,ot(a,2)):[]}function Rb(s,a){return a=typeof a=="function"?a:r,s&&s.length?ei(s,r,a):[]}function ih(s){if(!(s&&s.length))return[];var a=0;return s=Kr(s,function(c){if(Jt(c))return a=le(c.length,a),!0}),xl(a,function(c){return Wt(s,vl(c))})}function Pd(s,a){if(!(s&&s.length))return[];var c=ih(s);return a==null?c:Wt(c,function(p){return De(a,r,p)})}var Pb=_t(function(s,a){return Jt(s)?is(s,a):[]}),Mb=_t(function(s){return Wl(Kr(s,Jt))}),Db=_t(function(s){var a=je(s);return Jt(a)&&(a=r),Wl(Kr(s,Jt),ot(a,2))}),Bb=_t(function(s){var a=je(s);return a=typeof a=="function"?a:r,Wl(Kr(s,Jt),r,a)}),Ob=_t(ih);function Fb(s,a){return jf(s||[],a||[],rs)}function Lb(s,a){return jf(s||[],a||[],os)}var Nb=_t(function(s){var a=s.length,c=a>1?s[a-1]:r;return c=typeof c=="function"?(s.pop(),c):r,Pd(s,c)});function Md(s){var a=b(s);return a.__chain__=!0,a}function kb(s,a){return a(s),s}function Eo(s,a){return a(s)}var Ub=kr(function(s){var a=s.length,c=a?s[0]:0,p=this.__wrapped__,_=function(T){return Il(T,s)};return a>1||this.__actions__.length||!(p instanceof wt)||!Ur(c)?this.thru(_):(p=p.slice(c,+c+(a?1:0)),p.__actions__.push({func:Eo,args:[_],thisArg:r}),new ze(p,this.__chain__).thru(function(T){return a&&!T.length&&T.push(r),T}))});function Gb(){return Md(this)}function Wb(){return new ze(this.value(),this.__chain__)}function $b(){this.__values__===r&&(this.__values__=zd(this.value()));var s=this.__index__>=this.__values__.length,a=s?r:this.__values__[this.__index__++];return{done:s,value:a}}function Hb(){return this}function Xb(s){for(var a,c=this;c instanceof ao;){var p=Td(c);p.__index__=0,p.__values__=r,a?_.__wrapped__=p:a=p;var _=p;c=c.__wrapped__}return _.__wrapped__=s,a}function zb(){var s=this.__wrapped__;if(s instanceof wt){var a=s;return this.__actions__.length&&(a=new wt(this)),a=a.reverse(),a.__actions__.push({func:Eo,args:[rh],thisArg:r}),new ze(a,this.__chain__)}return this.thru(rh)}function Vb(){return Yf(this.__wrapped__,this.__actions__)}var Yb=go(function(s,a,c){Bt.call(s,c)?++s[c]:Lr(s,c,1)});function jb(s,a,c){var p=dt(s)?of:k0;return c&&Ee(s,a,c)&&(a=r),p(s,ot(a,3))}function qb(s,a){var c=dt(s)?Kr:Pf;return c(s,ot(a,3))}var Kb=nd(Ad),Zb=nd(Sd);function Jb(s,a){return pe(To(s,a),1)}function Qb(s,a){return pe(To(s,a),Y)}function t1(s,a,c){return c=c===r?1:gt(c),pe(To(s,a),c)}function Dd(s,a){var c=dt(s)?He:ti;return c(s,ot(a,3))}function Bd(s,a){var c=dt(s)?yy:Rf;return c(s,ot(a,3))}var e1=go(function(s,a,c){Bt.call(s,c)?s[c].push(a):Lr(s,c,[a])});function r1(s,a,c,p){s=Ce(s)?s:hn(s),c=c&&!p?gt(c):0;var _=s.length;return c<0&&(c=le(_+c,0)),Ro(s)?c<=_&&s.indexOf(a,c)>-1:!!_&&Ki(s,a,c)>-1}var i1=_t(function(s,a,c){var p=-1,_=typeof a=="function",T=Ce(s)?B(s.length):[];return ti(s,function(C){T[++p]=_?De(a,C,c):ns(C,a,c)}),T}),n1=go(function(s,a,c){Lr(s,c,a)});function To(s,a){var c=dt(s)?Wt:Lf;return c(s,ot(a,3))}function s1(s,a,c,p){return s==null?[]:(dt(a)||(a=a==null?[]:[a]),c=p?r:c,dt(c)||(c=c==null?[]:[c]),Gf(s,a,c))}var o1=go(function(s,a,c){s[c?0:1].push(a)},function(){return[[],[]]});function a1(s,a,c){var p=dt(s)?gl:uf,_=arguments.length<3;return p(s,ot(a,4),c,_,ti)}function l1(s,a,c){var p=dt(s)?xy:uf,_=arguments.length<3;return p(s,ot(a,4),c,_,Rf)}function h1(s,a){var c=dt(s)?Kr:Pf;return c(s,Co(ot(a,3)))}function u1(s){var a=dt(s)?Af:rx;return a(s)}function c1(s,a,c){(c?Ee(s,a,c):a===r)?a=1:a=gt(a);var p=dt(s)?B0:ix;return p(s,a)}function f1(s){var a=dt(s)?O0:sx;return a(s)}function d1(s){if(s==null)return 0;if(Ce(s))return Ro(s)?Ji(s):s.length;var a=xe(s);return a==qt||a==Qe?s.size:Ol(s).length}function p1(s,a,c){var p=dt(s)?ml:ox;return c&&Ee(s,a,c)&&(a=r),p(s,ot(a,3))}var g1=_t(function(s,a){if(s==null)return[];var c=a.length;return c>1&&Ee(s,a[0],a[1])?a=[]:c>2&&Ee(a[0],a[1],a[2])&&(a=[a[0]]),Gf(s,pe(a,1),[])}),Ao=qy||function(){return de.Date.now()};function m1(s,a){if(typeof a!="function")throw new Xe(l);return s=gt(s),function(){if(--s<1)return a.apply(this,arguments)}}function Od(s,a,c){return a=c?r:a,a=s&&a==null?s.length:a,Nr(s,O,r,r,r,r,a)}function Fd(s,a){var c;if(typeof a!="function")throw new Xe(l);return s=gt(s),function(){return--s>0&&(c=a.apply(this,arguments)),s<=1&&(a=r),c}}var nh=_t(function(s,a,c){var p=x;if(c.length){var _=Jr(c,an(nh));p|=D}return Nr(s,p,a,c,_)}),Ld=_t(function(s,a,c){var p=x|A;if(c.length){var _=Jr(c,an(Ld));p|=D}return Nr(a,p,s,c,_)});function Nd(s,a,c){a=c?r:a;var p=Nr(s,E,r,r,r,r,r,a);return p.placeholder=Nd.placeholder,p}function kd(s,a,c){a=c?r:a;var p=Nr(s,I,r,r,r,r,r,a);return p.placeholder=kd.placeholder,p}function Ud(s,a,c){var p,_,T,C,R,M,U=0,G=!1,$=!1,q=!0;if(typeof s!="function")throw new Xe(l);a=qe(a)||0,Ht(c)&&(G=!!c.leading,$="maxWait"in c,T=$?le(qe(c.maxWait)||0,a):T,q="trailing"in c?!!c.trailing:q);function tt(Qt){var ir=p,$r=_;return p=_=r,U=Qt,C=s.apply($r,ir),C}function lt(Qt){return U=Qt,R=hs(yt,a),G?tt(Qt):C}function mt(Qt){var ir=Qt-M,$r=Qt-U,np=a-ir;return $?ye(np,T-$r):np}function ht(Qt){var ir=Qt-M,$r=Qt-U;return M===r||ir>=a||ir<0||$&&$r>=T}function yt(){var Qt=Ao();if(ht(Qt))return At(Qt);R=hs(yt,mt(Qt))}function At(Qt){return R=r,q&&p?tt(Qt):(p=_=r,C)}function Le(){R!==r&&qf(R),U=0,p=M=_=R=r}function Te(){return R===r?C:At(Ao())}function Ne(){var Qt=Ao(),ir=ht(Qt);if(p=arguments,_=this,M=Qt,ir){if(R===r)return lt(M);if($)return qf(R),R=hs(yt,a),tt(M)}return R===r&&(R=hs(yt,a)),C}return Ne.cancel=Le,Ne.flush=Te,Ne}var v1=_t(function(s,a){return If(s,1,a)}),_1=_t(function(s,a,c){return If(s,qe(a)||0,c)});function y1(s){return Nr(s,X)}function So(s,a){if(typeof s!="function"||a!=null&&typeof a!="function")throw new Xe(l);var c=function(){var p=arguments,_=a?a.apply(this,p):p[0],T=c.cache;if(T.has(_))return T.get(_);var C=s.apply(this,p);return c.cache=T.set(_,C)||T,C};return c.cache=new(So.Cache||Fr),c}So.Cache=Fr;function Co(s){if(typeof s!="function")throw new Xe(l);return function(){var a=arguments;switch(a.length){case 0:return!s.call(this);case 1:return!s.call(this,a[0]);case 2:return!s.call(this,a[0],a[1]);case 3:return!s.call(this,a[0],a[1],a[2])}return!s.apply(this,a)}}function x1(s){return Fd(2,s)}var b1=ax(function(s,a){a=a.length==1&&dt(a[0])?Wt(a[0],Be(ot())):Wt(pe(a,1),Be(ot()));var c=a.length;return _t(function(p){for(var _=-1,T=ye(p.length,c);++_<T;)p[_]=a[_].call(this,p[_]);return De(s,this,p)})}),sh=_t(function(s,a){var c=Jr(a,an(sh));return Nr(s,D,r,a,c)}),Gd=_t(function(s,a){var c=Jr(a,an(Gd));return Nr(s,L,r,a,c)}),w1=kr(function(s,a){return Nr(s,F,r,r,r,a)});function E1(s,a){if(typeof s!="function")throw new Xe(l);return a=a===r?a:gt(a),_t(s,a)}function T1(s,a){if(typeof s!="function")throw new Xe(l);return a=a==null?0:le(gt(a),0),_t(function(c){var p=c[a],_=ii(c,0,a);return p&&Zr(_,p),De(s,this,_)})}function A1(s,a,c){var p=!0,_=!0;if(typeof s!="function")throw new Xe(l);return Ht(c)&&(p="leading"in c?!!c.leading:p,_="trailing"in c?!!c.trailing:_),Ud(s,a,{leading:p,maxWait:a,trailing:_})}function S1(s){return Od(s,1)}function C1(s,a){return sh(Hl(a),s)}function I1(){if(!arguments.length)return[];var s=arguments[0];return dt(s)?s:[s]}function R1(s){return Ve(s,v)}function P1(s,a){return a=typeof a=="function"?a:r,Ve(s,v,a)}function M1(s){return Ve(s,g|v)}function D1(s,a){return a=typeof a=="function"?a:r,Ve(s,g|v,a)}function B1(s,a){return a==null||Cf(s,a,ce(a))}function rr(s,a){return s===a||s!==s&&a!==a}var O1=yo(Ml),F1=yo(function(s,a){return s>=a}),Si=Bf(function(){return arguments}())?Bf:function(s){return Kt(s)&&Bt.call(s,"callee")&&!yf.call(s,"callee")},dt=B.isArray,L1=Qc?Be(Qc):X0;function Ce(s){return s!=null&&Io(s.length)&&!Gr(s)}function Jt(s){return Kt(s)&&Ce(s)}function N1(s){return s===!0||s===!1||Kt(s)&&we(s)==Yt}var ni=Zy||mh,k1=tf?Be(tf):z0;function U1(s){return Kt(s)&&s.nodeType===1&&!us(s)}function G1(s){if(s==null)return!0;if(Ce(s)&&(dt(s)||typeof s=="string"||typeof s.splice=="function"||ni(s)||ln(s)||Si(s)))return!s.length;var a=xe(s);if(a==qt||a==Qe)return!s.size;if(ls(s))return!Ol(s).length;for(var c in s)if(Bt.call(s,c))return!1;return!0}function W1(s,a){return ss(s,a)}function $1(s,a,c){c=typeof c=="function"?c:r;var p=c?c(s,a):r;return p===r?ss(s,a,r,c):!!p}function oh(s){if(!Kt(s))return!1;var a=we(s);return a==Dt||a==oe||typeof s.message=="string"&&typeof s.name=="string"&&!us(s)}function H1(s){return typeof s=="number"&&bf(s)}function Gr(s){if(!Ht(s))return!1;var a=we(s);return a==Ut||a==jt||a==ie||a==d_}function Wd(s){return typeof s=="number"&&s==gt(s)}function Io(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=vt}function Ht(s){var a=typeof s;return s!=null&&(a=="object"||a=="function")}function Kt(s){return s!=null&&typeof s=="object"}var $d=ef?Be(ef):Y0;function X1(s,a){return s===a||Bl(s,a,Kl(a))}function z1(s,a,c){return c=typeof c=="function"?c:r,Bl(s,a,Kl(a),c)}function V1(s){return Hd(s)&&s!=+s}function Y1(s){if(Px(s))throw new ct(o);return Of(s)}function j1(s){return s===null}function q1(s){return s==null}function Hd(s){return typeof s=="number"||Kt(s)&&we(s)==_e}function us(s){if(!Kt(s)||we(s)!=vr)return!1;var a=to(s);if(a===null)return!0;var c=Bt.call(a,"constructor")&&a.constructor;return typeof c=="function"&&c instanceof c&&Ks.call(c)==zy}var ah=rf?Be(rf):j0;function K1(s){return Wd(s)&&s>=-vt&&s<=vt}var Xd=nf?Be(nf):q0;function Ro(s){return typeof s=="string"||!dt(s)&&Kt(s)&&we(s)==Yn}function Fe(s){return typeof s=="symbol"||Kt(s)&&we(s)==Ws}var ln=sf?Be(sf):K0;function Z1(s){return s===r}function J1(s){return Kt(s)&&xe(s)==jn}function Q1(s){return Kt(s)&&we(s)==g_}var tw=yo(Fl),ew=yo(function(s,a){return s<=a});function zd(s){if(!s)return[];if(Ce(s))return Ro(s)?tr(s):Se(s);if(Zn&&s[Zn])return By(s[Zn]());var a=xe(s),c=a==qt?wl:a==Qe?Ys:hn;return c(s)}function Wr(s){if(!s)return s===0?s:0;if(s=qe(s),s===Y||s===-Y){var a=s<0?-1:1;return a*Ot}return s===s?s:0}function gt(s){var a=Wr(s),c=a%1;return a===a?c?a-c:a:0}function Vd(s){return s?wi(gt(s),0,rt):0}function qe(s){if(typeof s=="number")return s;if(Fe(s))return H;if(Ht(s)){var a=typeof s.valueOf=="function"?s.valueOf():s;s=Ht(a)?a+"":a}if(typeof s!="string")return s===0?s:+s;s=cf(s);var c=L_.test(s);return c||k_.test(s)?my(s.slice(2),c?2:8):F_.test(s)?H:+s}function Yd(s){return yr(s,Ie(s))}function rw(s){return s?wi(gt(s),-vt,vt):s===0?s:0}function Pt(s){return s==null?"":Oe(s)}var iw=sn(function(s,a){if(ls(a)||Ce(a)){yr(a,ce(a),s);return}for(var c in a)Bt.call(a,c)&&rs(s,c,a[c])}),jd=sn(function(s,a){yr(a,Ie(a),s)}),Po=sn(function(s,a,c,p){yr(a,Ie(a),s,p)}),nw=sn(function(s,a,c,p){yr(a,ce(a),s,p)}),sw=kr(Il);function ow(s,a){var c=nn(s);return a==null?c:Sf(c,a)}var aw=_t(function(s,a){s=Ft(s);var c=-1,p=a.length,_=p>2?a[2]:r;for(_&&Ee(a[0],a[1],_)&&(p=1);++c<p;)for(var T=a[c],C=Ie(T),R=-1,M=C.length;++R<M;){var U=C[R],G=s[U];(G===r||rr(G,tn[U])&&!Bt.call(s,U))&&(s[U]=T[U])}return s}),lw=_t(function(s){return s.push(r,cd),De(qd,r,s)});function hw(s,a){return af(s,ot(a,3),_r)}function uw(s,a){return af(s,ot(a,3),Pl)}function cw(s,a){return s==null?s:Rl(s,ot(a,3),Ie)}function fw(s,a){return s==null?s:Mf(s,ot(a,3),Ie)}function dw(s,a){return s&&_r(s,ot(a,3))}function pw(s,a){return s&&Pl(s,ot(a,3))}function gw(s){return s==null?[]:uo(s,ce(s))}function mw(s){return s==null?[]:uo(s,Ie(s))}function lh(s,a,c){var p=s==null?r:Ei(s,a);return p===r?c:p}function vw(s,a){return s!=null&&pd(s,a,G0)}function hh(s,a){return s!=null&&pd(s,a,W0)}var _w=od(function(s,a,c){a!=null&&typeof a.toString!="function"&&(a=Zs.call(a)),s[a]=c},ch(Re)),yw=od(function(s,a,c){a!=null&&typeof a.toString!="function"&&(a=Zs.call(a)),Bt.call(s,a)?s[a].push(c):s[a]=[c]},ot),xw=_t(ns);function ce(s){return Ce(s)?Tf(s):Ol(s)}function Ie(s){return Ce(s)?Tf(s,!0):Z0(s)}function bw(s,a){var c={};return a=ot(a,3),_r(s,function(p,_,T){Lr(c,a(p,_,T),p)}),c}function ww(s,a){var c={};return a=ot(a,3),_r(s,function(p,_,T){Lr(c,_,a(p,_,T))}),c}var Ew=sn(function(s,a,c){co(s,a,c)}),qd=sn(function(s,a,c,p){co(s,a,c,p)}),Tw=kr(function(s,a){var c={};if(s==null)return c;var p=!1;a=Wt(a,function(T){return T=ri(T,s),p||(p=T.length>1),T}),yr(s,jl(s),c),p&&(c=Ve(c,g|m|v,_x));for(var _=a.length;_--;)Gl(c,a[_]);return c});function Aw(s,a){return Kd(s,Co(ot(a)))}var Sw=kr(function(s,a){return s==null?{}:Q0(s,a)});function Kd(s,a){if(s==null)return{};var c=Wt(jl(s),function(p){return[p]});return a=ot(a),Wf(s,c,function(p,_){return a(p,_[0])})}function Cw(s,a,c){a=ri(a,s);var p=-1,_=a.length;for(_||(_=1,s=r);++p<_;){var T=s==null?r:s[xr(a[p])];T===r&&(p=_,T=c),s=Gr(T)?T.call(s):T}return s}function Iw(s,a,c){return s==null?s:os(s,a,c)}function Rw(s,a,c,p){return p=typeof p=="function"?p:r,s==null?s:os(s,a,c,p)}var Zd=hd(ce),Jd=hd(Ie);function Pw(s,a,c){var p=dt(s),_=p||ni(s)||ln(s);if(a=ot(a,4),c==null){var T=s&&s.constructor;_?c=p?new T:[]:Ht(s)?c=Gr(T)?nn(to(s)):{}:c={}}return(_?He:_r)(s,function(C,R,M){return a(c,C,R,M)}),c}function Mw(s,a){return s==null?!0:Gl(s,a)}function Dw(s,a,c){return s==null?s:Vf(s,a,Hl(c))}function Bw(s,a,c,p){return p=typeof p=="function"?p:r,s==null?s:Vf(s,a,Hl(c),p)}function hn(s){return s==null?[]:bl(s,ce(s))}function Ow(s){return s==null?[]:bl(s,Ie(s))}function Fw(s,a,c){return c===r&&(c=a,a=r),c!==r&&(c=qe(c),c=c===c?c:0),a!==r&&(a=qe(a),a=a===a?a:0),wi(qe(s),a,c)}function Lw(s,a,c){return a=Wr(a),c===r?(c=a,a=0):c=Wr(c),s=qe(s),$0(s,a,c)}function Nw(s,a,c){if(c&&typeof c!="boolean"&&Ee(s,a,c)&&(a=c=r),c===r&&(typeof a=="boolean"?(c=a,a=r):typeof s=="boolean"&&(c=s,s=r)),s===r&&a===r?(s=0,a=1):(s=Wr(s),a===r?(a=s,s=0):a=Wr(a)),s>a){var p=s;s=a,a=p}if(c||s%1||a%1){var _=wf();return ye(s+_*(a-s+gy("1e-"+((_+"").length-1))),a)}return Nl(s,a)}var kw=on(function(s,a,c){return a=a.toLowerCase(),s+(c?Qd(a):a)});function Qd(s){return uh(Pt(s).toLowerCase())}function tp(s){return s=Pt(s),s&&s.replace(G_,Iy).replace(sy,"")}function Uw(s,a,c){s=Pt(s),a=Oe(a);var p=s.length;c=c===r?p:wi(gt(c),0,p);var _=c;return c-=a.length,c>=0&&s.slice(c,_)==a}function Gw(s){return s=Pt(s),s&&x_.test(s)?s.replace(Pc,Ry):s}function Ww(s){return s=Pt(s),s&&S_.test(s)?s.replace(sl,"\\$&"):s}var $w=on(function(s,a,c){return s+(c?"-":"")+a.toLowerCase()}),Hw=on(function(s,a,c){return s+(c?" ":"")+a.toLowerCase()}),Xw=id("toLowerCase");function zw(s,a,c){s=Pt(s),a=gt(a);var p=a?Ji(s):0;if(!a||p>=a)return s;var _=(a-p)/2;return _o(no(_),c)+s+_o(io(_),c)}function Vw(s,a,c){s=Pt(s),a=gt(a);var p=a?Ji(s):0;return a&&p<a?s+_o(a-p,c):s}function Yw(s,a,c){s=Pt(s),a=gt(a);var p=a?Ji(s):0;return a&&p<a?_o(a-p,c)+s:s}function jw(s,a,c){return c||a==null?a=0:a&&(a=+a),e0(Pt(s).replace(ol,""),a||0)}function qw(s,a,c){return(c?Ee(s,a,c):a===r)?a=1:a=gt(a),kl(Pt(s),a)}function Kw(){var s=arguments,a=Pt(s[0]);return s.length<3?a:a.replace(s[1],s[2])}var Zw=on(function(s,a,c){return s+(c?"_":"")+a.toLowerCase()});function Jw(s,a,c){return c&&typeof c!="number"&&Ee(s,a,c)&&(a=c=r),c=c===r?rt:c>>>0,c?(s=Pt(s),s&&(typeof a=="string"||a!=null&&!ah(a))&&(a=Oe(a),!a&&Zi(s))?ii(tr(s),0,c):s.split(a,c)):[]}var Qw=on(function(s,a,c){return s+(c?" ":"")+uh(a)});function tE(s,a,c){return s=Pt(s),c=c==null?0:wi(gt(c),0,s.length),a=Oe(a),s.slice(c,c+a.length)==a}function eE(s,a,c){var p=b.templateSettings;c&&Ee(s,a,c)&&(a=r),s=Pt(s),a=Po({},a,p,ud);var _=Po({},a.imports,p.imports,ud),T=ce(_),C=bl(_,T),R,M,U=0,G=a.interpolate||$s,$="__p += '",q=El((a.escape||$s).source+"|"+G.source+"|"+(G===Mc?O_:$s).source+"|"+(a.evaluate||$s).source+"|$","g"),tt="//# sourceURL="+(Bt.call(a,"sourceURL")?(a.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++uy+"]")+`
`;s.replace(q,function(ht,yt,At,Le,Te,Ne){return At||(At=Le),$+=s.slice(U,Ne).replace(W_,Py),yt&&(R=!0,$+=`' +
__e(`+yt+`) +
'`),Te&&(M=!0,$+=`';
`+Te+`;
__p += '`),At&&($+=`' +
((__t = (`+At+`)) == null ? '' : __t) +
'`),U=Ne+ht.length,ht}),$+=`';
`;var lt=Bt.call(a,"variable")&&a.variable;if(!lt)$=`with (obj) {
`+$+`
}
`;else if(D_.test(lt))throw new ct(h);$=(M?$.replace(m_,""):$).replace(v_,"$1").replace(__,"$1;"),$="function("+(lt||"obj")+`) {
`+(lt?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(R?", __e = _.escape":"")+(M?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+$+`return __p
}`;var mt=rp(function(){return It(T,tt+"return "+$).apply(r,C)});if(mt.source=$,oh(mt))throw mt;return mt}function rE(s){return Pt(s).toLowerCase()}function iE(s){return Pt(s).toUpperCase()}function nE(s,a,c){if(s=Pt(s),s&&(c||a===r))return cf(s);if(!s||!(a=Oe(a)))return s;var p=tr(s),_=tr(a),T=ff(p,_),C=df(p,_)+1;return ii(p,T,C).join("")}function sE(s,a,c){if(s=Pt(s),s&&(c||a===r))return s.slice(0,gf(s)+1);if(!s||!(a=Oe(a)))return s;var p=tr(s),_=df(p,tr(a))+1;return ii(p,0,_).join("")}function oE(s,a,c){if(s=Pt(s),s&&(c||a===r))return s.replace(ol,"");if(!s||!(a=Oe(a)))return s;var p=tr(s),_=ff(p,tr(a));return ii(p,_).join("")}function aE(s,a){var c=j,p=z;if(Ht(a)){var _="separator"in a?a.separator:_;c="length"in a?gt(a.length):c,p="omission"in a?Oe(a.omission):p}s=Pt(s);var T=s.length;if(Zi(s)){var C=tr(s);T=C.length}if(c>=T)return s;var R=c-Ji(p);if(R<1)return p;var M=C?ii(C,0,R).join(""):s.slice(0,R);if(_===r)return M+p;if(C&&(R+=M.length-R),ah(_)){if(s.slice(R).search(_)){var U,G=M;for(_.global||(_=El(_.source,Pt(Dc.exec(_))+"g")),_.lastIndex=0;U=_.exec(G);)var $=U.index;M=M.slice(0,$===r?R:$)}}else if(s.indexOf(Oe(_),R)!=R){var q=M.lastIndexOf(_);q>-1&&(M=M.slice(0,q))}return M+p}function lE(s){return s=Pt(s),s&&y_.test(s)?s.replace(Rc,Ny):s}var hE=on(function(s,a,c){return s+(c?" ":"")+a.toUpperCase()}),uh=id("toUpperCase");function ep(s,a,c){return s=Pt(s),a=c?r:a,a===r?Dy(s)?Gy(s):Ey(s):s.match(a)||[]}var rp=_t(function(s,a){try{return De(s,r,a)}catch(c){return oh(c)?c:new ct(c)}}),uE=kr(function(s,a){return He(a,function(c){c=xr(c),Lr(s,c,nh(s[c],s))}),s});function cE(s){var a=s==null?0:s.length,c=ot();return s=a?Wt(s,function(p){if(typeof p[1]!="function")throw new Xe(l);return[c(p[0]),p[1]]}):[],_t(function(p){for(var _=-1;++_<a;){var T=s[_];if(De(T[0],this,p))return De(T[1],this,p)}})}function fE(s){return N0(Ve(s,g))}function ch(s){return function(){return s}}function dE(s,a){return s==null||s!==s?a:s}var pE=sd(),gE=sd(!0);function Re(s){return s}function fh(s){return Ff(typeof s=="function"?s:Ve(s,g))}function mE(s){return Nf(Ve(s,g))}function vE(s,a){return kf(s,Ve(a,g))}var _E=_t(function(s,a){return function(c){return ns(c,s,a)}}),yE=_t(function(s,a){return function(c){return ns(s,c,a)}});function dh(s,a,c){var p=ce(a),_=uo(a,p);c==null&&!(Ht(a)&&(_.length||!p.length))&&(c=a,a=s,s=this,_=uo(a,ce(a)));var T=!(Ht(c)&&"chain"in c)||!!c.chain,C=Gr(s);return He(_,function(R){var M=a[R];s[R]=M,C&&(s.prototype[R]=function(){var U=this.__chain__;if(T||U){var G=s(this.__wrapped__),$=G.__actions__=Se(this.__actions__);return $.push({func:M,args:arguments,thisArg:s}),G.__chain__=U,G}return M.apply(s,Zr([this.value()],arguments))})}),s}function xE(){return de._===this&&(de._=Vy),this}function ph(){}function bE(s){return s=gt(s),_t(function(a){return Uf(a,s)})}var wE=zl(Wt),EE=zl(of),TE=zl(ml);function ip(s){return Jl(s)?vl(xr(s)):tx(s)}function AE(s){return function(a){return s==null?r:Ei(s,a)}}var SE=ad(),CE=ad(!0);function gh(){return[]}function mh(){return!1}function IE(){return{}}function RE(){return""}function PE(){return!0}function ME(s,a){if(s=gt(s),s<1||s>vt)return[];var c=rt,p=ye(s,rt);a=ot(a),s-=rt;for(var _=xl(p,a);++c<s;)a(c);return _}function DE(s){return dt(s)?Wt(s,xr):Fe(s)?[s]:Se(Ed(Pt(s)))}function BE(s){var a=++Xy;return Pt(s)+a}var OE=vo(function(s,a){return s+a},0),FE=Vl("ceil"),LE=vo(function(s,a){return s/a},1),NE=Vl("floor");function kE(s){return s&&s.length?ho(s,Re,Ml):r}function UE(s,a){return s&&s.length?ho(s,ot(a,2),Ml):r}function GE(s){return hf(s,Re)}function WE(s,a){return hf(s,ot(a,2))}function $E(s){return s&&s.length?ho(s,Re,Fl):r}function HE(s,a){return s&&s.length?ho(s,ot(a,2),Fl):r}var XE=vo(function(s,a){return s*a},1),zE=Vl("round"),VE=vo(function(s,a){return s-a},0);function YE(s){return s&&s.length?yl(s,Re):0}function jE(s,a){return s&&s.length?yl(s,ot(a,2)):0}return b.after=m1,b.ary=Od,b.assign=iw,b.assignIn=jd,b.assignInWith=Po,b.assignWith=nw,b.at=sw,b.before=Fd,b.bind=nh,b.bindAll=uE,b.bindKey=Ld,b.castArray=I1,b.chain=Md,b.chunk=Nx,b.compact=kx,b.concat=Ux,b.cond=cE,b.conforms=fE,b.constant=ch,b.countBy=Yb,b.create=ow,b.curry=Nd,b.curryRight=kd,b.debounce=Ud,b.defaults=aw,b.defaultsDeep=lw,b.defer=v1,b.delay=_1,b.difference=Gx,b.differenceBy=Wx,b.differenceWith=$x,b.drop=Hx,b.dropRight=Xx,b.dropRightWhile=zx,b.dropWhile=Vx,b.fill=Yx,b.filter=qb,b.flatMap=Jb,b.flatMapDeep=Qb,b.flatMapDepth=t1,b.flatten=Cd,b.flattenDeep=jx,b.flattenDepth=qx,b.flip=y1,b.flow=pE,b.flowRight=gE,b.fromPairs=Kx,b.functions=gw,b.functionsIn=mw,b.groupBy=e1,b.initial=Jx,b.intersection=Qx,b.intersectionBy=tb,b.intersectionWith=eb,b.invert=_w,b.invertBy=yw,b.invokeMap=i1,b.iteratee=fh,b.keyBy=n1,b.keys=ce,b.keysIn=Ie,b.map=To,b.mapKeys=bw,b.mapValues=ww,b.matches=mE,b.matchesProperty=vE,b.memoize=So,b.merge=Ew,b.mergeWith=qd,b.method=_E,b.methodOf=yE,b.mixin=dh,b.negate=Co,b.nthArg=bE,b.omit=Tw,b.omitBy=Aw,b.once=x1,b.orderBy=s1,b.over=wE,b.overArgs=b1,b.overEvery=EE,b.overSome=TE,b.partial=sh,b.partialRight=Gd,b.partition=o1,b.pick=Sw,b.pickBy=Kd,b.property=ip,b.propertyOf=AE,b.pull=sb,b.pullAll=Rd,b.pullAllBy=ob,b.pullAllWith=ab,b.pullAt=lb,b.range=SE,b.rangeRight=CE,b.rearg=w1,b.reject=h1,b.remove=hb,b.rest=E1,b.reverse=rh,b.sampleSize=c1,b.set=Iw,b.setWith=Rw,b.shuffle=f1,b.slice=ub,b.sortBy=g1,b.sortedUniq=vb,b.sortedUniqBy=_b,b.split=Jw,b.spread=T1,b.tail=yb,b.take=xb,b.takeRight=bb,b.takeRightWhile=wb,b.takeWhile=Eb,b.tap=kb,b.throttle=A1,b.thru=Eo,b.toArray=zd,b.toPairs=Zd,b.toPairsIn=Jd,b.toPath=DE,b.toPlainObject=Yd,b.transform=Pw,b.unary=S1,b.union=Tb,b.unionBy=Ab,b.unionWith=Sb,b.uniq=Cb,b.uniqBy=Ib,b.uniqWith=Rb,b.unset=Mw,b.unzip=ih,b.unzipWith=Pd,b.update=Dw,b.updateWith=Bw,b.values=hn,b.valuesIn=Ow,b.without=Pb,b.words=ep,b.wrap=C1,b.xor=Mb,b.xorBy=Db,b.xorWith=Bb,b.zip=Ob,b.zipObject=Fb,b.zipObjectDeep=Lb,b.zipWith=Nb,b.entries=Zd,b.entriesIn=Jd,b.extend=jd,b.extendWith=Po,dh(b,b),b.add=OE,b.attempt=rp,b.camelCase=kw,b.capitalize=Qd,b.ceil=FE,b.clamp=Fw,b.clone=R1,b.cloneDeep=M1,b.cloneDeepWith=D1,b.cloneWith=P1,b.conformsTo=B1,b.deburr=tp,b.defaultTo=dE,b.divide=LE,b.endsWith=Uw,b.eq=rr,b.escape=Gw,b.escapeRegExp=Ww,b.every=jb,b.find=Kb,b.findIndex=Ad,b.findKey=hw,b.findLast=Zb,b.findLastIndex=Sd,b.findLastKey=uw,b.floor=NE,b.forEach=Dd,b.forEachRight=Bd,b.forIn=cw,b.forInRight=fw,b.forOwn=dw,b.forOwnRight=pw,b.get=lh,b.gt=O1,b.gte=F1,b.has=vw,b.hasIn=hh,b.head=Id,b.identity=Re,b.includes=r1,b.indexOf=Zx,b.inRange=Lw,b.invoke=xw,b.isArguments=Si,b.isArray=dt,b.isArrayBuffer=L1,b.isArrayLike=Ce,b.isArrayLikeObject=Jt,b.isBoolean=N1,b.isBuffer=ni,b.isDate=k1,b.isElement=U1,b.isEmpty=G1,b.isEqual=W1,b.isEqualWith=$1,b.isError=oh,b.isFinite=H1,b.isFunction=Gr,b.isInteger=Wd,b.isLength=Io,b.isMap=$d,b.isMatch=X1,b.isMatchWith=z1,b.isNaN=V1,b.isNative=Y1,b.isNil=q1,b.isNull=j1,b.isNumber=Hd,b.isObject=Ht,b.isObjectLike=Kt,b.isPlainObject=us,b.isRegExp=ah,b.isSafeInteger=K1,b.isSet=Xd,b.isString=Ro,b.isSymbol=Fe,b.isTypedArray=ln,b.isUndefined=Z1,b.isWeakMap=J1,b.isWeakSet=Q1,b.join=rb,b.kebabCase=$w,b.last=je,b.lastIndexOf=ib,b.lowerCase=Hw,b.lowerFirst=Xw,b.lt=tw,b.lte=ew,b.max=kE,b.maxBy=UE,b.mean=GE,b.meanBy=WE,b.min=$E,b.minBy=HE,b.stubArray=gh,b.stubFalse=mh,b.stubObject=IE,b.stubString=RE,b.stubTrue=PE,b.multiply=XE,b.nth=nb,b.noConflict=xE,b.noop=ph,b.now=Ao,b.pad=zw,b.padEnd=Vw,b.padStart=Yw,b.parseInt=jw,b.random=Nw,b.reduce=a1,b.reduceRight=l1,b.repeat=qw,b.replace=Kw,b.result=Cw,b.round=zE,b.runInContext=P,b.sample=u1,b.size=d1,b.snakeCase=Zw,b.some=p1,b.sortedIndex=cb,b.sortedIndexBy=fb,b.sortedIndexOf=db,b.sortedLastIndex=pb,b.sortedLastIndexBy=gb,b.sortedLastIndexOf=mb,b.startCase=Qw,b.startsWith=tE,b.subtract=VE,b.sum=YE,b.sumBy=jE,b.template=eE,b.times=ME,b.toFinite=Wr,b.toInteger=gt,b.toLength=Vd,b.toLower=rE,b.toNumber=qe,b.toSafeInteger=rw,b.toString=Pt,b.toUpper=iE,b.trim=nE,b.trimEnd=sE,b.trimStart=oE,b.truncate=aE,b.unescape=lE,b.uniqueId=BE,b.upperCase=hE,b.upperFirst=uh,b.each=Dd,b.eachRight=Bd,b.first=Id,dh(b,function(){var s={};return _r(b,function(a,c){Bt.call(b.prototype,c)||(s[c]=a)}),s}(),{chain:!1}),b.VERSION=i,He(["bind","bindKey","curry","curryRight","partial","partialRight"],function(s){b[s].placeholder=b}),He(["drop","take"],function(s,a){wt.prototype[s]=function(c){c=c===r?1:le(gt(c),0);var p=this.__filtered__&&!a?new wt(this):this.clone();return p.__filtered__?p.__takeCount__=ye(c,p.__takeCount__):p.__views__.push({size:ye(c,rt),type:s+(p.__dir__<0?"Right":"")}),p},wt.prototype[s+"Right"]=function(c){return this.reverse()[s](c).reverse()}}),He(["filter","map","takeWhile"],function(s,a){var c=a+1,p=c==k||c==ft;wt.prototype[s]=function(_){var T=this.clone();return T.__iteratees__.push({iteratee:ot(_,3),type:c}),T.__filtered__=T.__filtered__||p,T}}),He(["head","last"],function(s,a){var c="take"+(a?"Right":"");wt.prototype[s]=function(){return this[c](1).value()[0]}}),He(["initial","tail"],function(s,a){var c="drop"+(a?"":"Right");wt.prototype[s]=function(){return this.__filtered__?new wt(this):this[c](1)}}),wt.prototype.compact=function(){return this.filter(Re)},wt.prototype.find=function(s){return this.filter(s).head()},wt.prototype.findLast=function(s){return this.reverse().find(s)},wt.prototype.invokeMap=_t(function(s,a){return typeof s=="function"?new wt(this):this.map(function(c){return ns(c,s,a)})}),wt.prototype.reject=function(s){return this.filter(Co(ot(s)))},wt.prototype.slice=function(s,a){s=gt(s);var c=this;return c.__filtered__&&(s>0||a<0)?new wt(c):(s<0?c=c.takeRight(-s):s&&(c=c.drop(s)),a!==r&&(a=gt(a),c=a<0?c.dropRight(-a):c.take(a-s)),c)},wt.prototype.takeRightWhile=function(s){return this.reverse().takeWhile(s).reverse()},wt.prototype.toArray=function(){return this.take(rt)},_r(wt.prototype,function(s,a){var c=/^(?:filter|find|map|reject)|While$/.test(a),p=/^(?:head|last)$/.test(a),_=b[p?"take"+(a=="last"?"Right":""):a],T=p||/^find/.test(a);_&&(b.prototype[a]=function(){var C=this.__wrapped__,R=p?[1]:arguments,M=C instanceof wt,U=R[0],G=M||dt(C),$=function(yt){var At=_.apply(b,Zr([yt],R));return p&&q?At[0]:At};G&&c&&typeof U=="function"&&U.length!=1&&(M=G=!1);var q=this.__chain__,tt=!!this.__actions__.length,lt=T&&!q,mt=M&&!tt;if(!T&&G){C=mt?C:new wt(this);var ht=s.apply(C,R);return ht.__actions__.push({func:Eo,args:[$],thisArg:r}),new ze(ht,q)}return lt&&mt?s.apply(this,R):(ht=this.thru($),lt?p?ht.value()[0]:ht.value():ht)})}),He(["pop","push","shift","sort","splice","unshift"],function(s){var a=js[s],c=/^(?:push|sort|unshift)$/.test(s)?"tap":"thru",p=/^(?:pop|shift)$/.test(s);b.prototype[s]=function(){var _=arguments;if(p&&!this.__chain__){var T=this.value();return a.apply(dt(T)?T:[],_)}return this[c](function(C){return a.apply(dt(C)?C:[],_)})}}),_r(wt.prototype,function(s,a){var c=b[a];if(c){var p=c.name+"";Bt.call(rn,p)||(rn[p]=[]),rn[p].push({name:a,func:c})}}),rn[mo(r,A).name]=[{name:"wrapper",func:r}],wt.prototype.clone=l0,wt.prototype.reverse=h0,wt.prototype.value=u0,b.prototype.at=Ub,b.prototype.chain=Gb,b.prototype.commit=Wb,b.prototype.next=$b,b.prototype.plant=Xb,b.prototype.reverse=zb,b.prototype.toJSON=b.prototype.valueOf=b.prototype.value=Vb,b.prototype.first=b.prototype.head,Zn&&(b.prototype[Zn]=Hb),b},Qi=Wy();_i?((_i.exports=Qi)._=Qi,fl._=Qi):de._=Qi}).call(Cr)})(ma,ma.exports);var Ir=ma.exports;const Ci=Na(Ir);var Yi=(e=>(e[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2",e))(Yi||{}),uu=(e=>(e[e.COLOR=16384]="COLOR",e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL",e))(uu||{}),ut=(e=>(e[e.NORMAL=0]="NORMAL",e[e.ADD=1]="ADD",e[e.MULTIPLY=2]="MULTIPLY",e[e.SCREEN=3]="SCREEN",e[e.OVERLAY=4]="OVERLAY",e[e.DARKEN=5]="DARKEN",e[e.LIGHTEN=6]="LIGHTEN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.COLOR_BURN=8]="COLOR_BURN",e[e.HARD_LIGHT=9]="HARD_LIGHT",e[e.SOFT_LIGHT=10]="SOFT_LIGHT",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.EXCLUSION=12]="EXCLUSION",e[e.HUE=13]="HUE",e[e.SATURATION=14]="SATURATION",e[e.COLOR=15]="COLOR",e[e.LUMINOSITY=16]="LUMINOSITY",e[e.NORMAL_NPM=17]="NORMAL_NPM",e[e.ADD_NPM=18]="ADD_NPM",e[e.SCREEN_NPM=19]="SCREEN_NPM",e[e.NONE=20]="NONE",e[e.SRC_OVER=0]="SRC_OVER",e[e.SRC_IN=21]="SRC_IN",e[e.SRC_OUT=22]="SRC_OUT",e[e.SRC_ATOP=23]="SRC_ATOP",e[e.DST_OVER=24]="DST_OVER",e[e.DST_IN=25]="DST_IN",e[e.DST_OUT=26]="DST_OUT",e[e.DST_ATOP=27]="DST_ATOP",e[e.ERASE=26]="ERASE",e[e.SUBTRACT=28]="SUBTRACT",e[e.XOR=29]="XOR",e))(ut||{}),Rr=(e=>(e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e))(Rr||{}),V=(e=>(e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e))(V||{}),An=(e=>(e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e))(An||{}),st=(e=>(e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT",e))(st||{}),cu=(e=>(e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT",e[e.UINT=2]="UINT",e))(cu||{}),zr=(e=>(e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e))(zr||{}),ci=(e=>(e[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e))(ci||{}),Dr=(e=>(e[e.OFF=0]="OFF",e[e.POW2=1]="POW2",e[e.ON=2]="ON",e[e.ON_MANUAL=3]="ON_MANUAL",e))(Dr||{}),mr=(e=>(e[e.NPM=0]="NPM",e[e.UNPACK=1]="UNPACK",e[e.PMA=2]="PMA",e[e.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",e[e.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",e[e.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",e))(mr||{}),Ar=(e=>(e[e.NO=0]="NO",e[e.YES=1]="YES",e[e.AUTO=2]="AUTO",e[e.BLEND=0]="BLEND",e[e.CLEAR=1]="CLEAR",e[e.BLIT=2]="BLIT",e))(Ar||{}),tc=(e=>(e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL",e))(tc||{}),Ze=(e=>(e.LOW="lowp",e.MEDIUM="mediump",e.HIGH="highp",e))(Ze||{}),ue=(e=>(e[e.NONE=0]="NONE",e[e.SCISSOR=1]="SCISSOR",e[e.STENCIL=2]="STENCIL",e[e.SPRITE=3]="SPRITE",e[e.COLOR=4]="COLOR",e))(ue||{}),se=(e=>(e[e.NONE=0]="NONE",e[e.LOW=2]="LOW",e[e.MEDIUM=4]="MEDIUM",e[e.HIGH=8]="HIGH",e))(se||{}),Pr=(e=>(e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e))(Pr||{});const JE={createCanvas:(e,t)=>{const r=document.createElement("canvas");return r.width=e,r.height=t,r},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(e,t)=>fetch(e,t),parseXML:e=>new DOMParser().parseFromString(e,"text/xml")},J={ADAPTER:JE,RESOLUTION:1,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,premultipliedAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1,hello:!1},CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var vh=/iPhone/i,sp=/iPod/i,op=/iPad/i,ap=/\biOS-universal(?:.+)Mac\b/i,_h=/\bAndroid(?:.+)Mobile\b/i,lp=/Android/i,un=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Mo=/Silk/i,Hr=/Windows Phone/i,hp=/\bWindows(?:.+)ARM\b/i,up=/BlackBerry/i,cp=/BB10/i,fp=/Opera Mini/i,dp=/\b(CriOS|Chrome)(?:.+)Mobile/i,pp=/Mobile(?:.+)Firefox\b/i,gp=function(e){return typeof e<"u"&&e.platform==="MacIntel"&&typeof e.maxTouchPoints=="number"&&e.maxTouchPoints>1&&typeof MSStream>"u"};function QE(e){return function(t){return t.test(e)}}function tT(e){var t={userAgent:"",platform:"",maxTouchPoints:0};!e&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof e=="string"?t.userAgent=e:e&&e.userAgent&&(t={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0});var r=t.userAgent,i=r.split("[FBAN");typeof i[1]<"u"&&(r=i[0]),i=r.split("Twitter"),typeof i[1]<"u"&&(r=i[0]);var n=QE(r),o={apple:{phone:n(vh)&&!n(Hr),ipod:n(sp),tablet:!n(vh)&&(n(op)||gp(t))&&!n(Hr),universal:n(ap),device:(n(vh)||n(sp)||n(op)||n(ap)||gp(t))&&!n(Hr)},amazon:{phone:n(un),tablet:!n(un)&&n(Mo),device:n(un)||n(Mo)},android:{phone:!n(Hr)&&n(un)||!n(Hr)&&n(_h),tablet:!n(Hr)&&!n(un)&&!n(_h)&&(n(Mo)||n(lp)),device:!n(Hr)&&(n(un)||n(Mo)||n(_h)||n(lp))||n(/\bokhttp\b/i)},windows:{phone:n(Hr),tablet:n(hp),device:n(Hr)||n(hp)},other:{blackberry:n(up),blackberry10:n(cp),opera:n(fp),firefox:n(pp),chrome:n(dp),device:n(up)||n(cp)||n(fp)||n(pp)||n(dp)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}const Vr=tT(globalThis.navigator);J.RETINA_PREFIX=/@([0-9\.]+)x/;J.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var qg={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(r=!1));function n(u,f,d){this.fn=u,this.context=f,this.once=d||!1}function o(u,f,d,g,m){if(typeof d!="function")throw new TypeError("The listener must be a function");var v=new n(d,g||u,m),y=r?r+f:f;return u._events[y]?u._events[y].fn?u._events[y]=[u._events[y],v]:u._events[y].push(v):(u._events[y]=v,u._eventsCount++),u}function l(u,f){--u._eventsCount===0?u._events=new i:delete u._events[f]}function h(){this._events=new i,this._eventsCount=0}h.prototype.eventNames=function(){var f=[],d,g;if(this._eventsCount===0)return f;for(g in d=this._events)t.call(d,g)&&f.push(r?g.slice(1):g);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(d)):f},h.prototype.listeners=function(f){var d=r?r+f:f,g=this._events[d];if(!g)return[];if(g.fn)return[g.fn];for(var m=0,v=g.length,y=new Array(v);m<v;m++)y[m]=g[m].fn;return y},h.prototype.listenerCount=function(f){var d=r?r+f:f,g=this._events[d];return g?g.fn?1:g.length:0},h.prototype.emit=function(f,d,g,m,v,y){var w=r?r+f:f;if(!this._events[w])return!1;var x=this._events[w],A=arguments.length,S,E;if(x.fn){switch(x.once&&this.removeListener(f,x.fn,void 0,!0),A){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,d),!0;case 3:return x.fn.call(x.context,d,g),!0;case 4:return x.fn.call(x.context,d,g,m),!0;case 5:return x.fn.call(x.context,d,g,m,v),!0;case 6:return x.fn.call(x.context,d,g,m,v,y),!0}for(E=1,S=new Array(A-1);E<A;E++)S[E-1]=arguments[E];x.fn.apply(x.context,S)}else{var I=x.length,D;for(E=0;E<I;E++)switch(x[E].once&&this.removeListener(f,x[E].fn,void 0,!0),A){case 1:x[E].fn.call(x[E].context);break;case 2:x[E].fn.call(x[E].context,d);break;case 3:x[E].fn.call(x[E].context,d,g);break;case 4:x[E].fn.call(x[E].context,d,g,m);break;default:if(!S)for(D=1,S=new Array(A-1);D<A;D++)S[D-1]=arguments[D];x[E].fn.apply(x[E].context,S)}}return!0},h.prototype.on=function(f,d,g){return o(this,f,d,g,!1)},h.prototype.once=function(f,d,g){return o(this,f,d,g,!0)},h.prototype.removeListener=function(f,d,g,m){var v=r?r+f:f;if(!this._events[v])return this;if(!d)return l(this,v),this;var y=this._events[v];if(y.fn)y.fn===d&&(!m||y.once)&&(!g||y.context===g)&&l(this,v);else{for(var w=0,x=[],A=y.length;w<A;w++)(y[w].fn!==d||m&&!y[w].once||g&&y[w].context!==g)&&x.push(y[w]);x.length?this._events[v]=x.length===1?x[0]:x:l(this,v)}return this},h.prototype.removeAllListeners=function(f){var d;return f?(d=r?r+f:f,this._events[d]&&l(this,d)):(this._events=new i,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=r,h.EventEmitter=h,e.exports=h})(qg);var eT=qg.exports;const Os=Na(eT);var ec={exports:{}};ec.exports=ka;ec.exports.default=ka;function ka(e,t,r){r=r||2;var i=t&&t.length,n=i?t[0]*r:e.length,o=Kg(e,0,n,r,!0),l=[];if(!o||o.next===o.prev)return l;var h,u,f,d,g,m,v;if(i&&(o=oT(e,t,o,r)),e.length>80*r){h=f=e[0],u=d=e[1];for(var y=r;y<n;y+=r)g=e[y],m=e[y+1],g<h&&(h=g),m<u&&(u=m),g>f&&(f=g),m>d&&(d=m);v=Math.max(f-h,d-u),v=v!==0?32767/v:0}return Ss(o,l,r,h,u,v,0),l}function Kg(e,t,r,i,n){var o,l;if(n===pu(e,t,r,i)>0)for(o=t;o<r;o+=i)l=mp(o,e[o],e[o+1],l);else for(o=r-i;o>=t;o-=i)l=mp(o,e[o],e[o+1],l);return l&&Ua(l,l.next)&&(Is(l),l=l.next),l}function Hi(e,t){if(!e)return e;t||(t=e);var r=e,i;do if(i=!1,!r.steiner&&(Ua(r,r.next)||zt(r.prev,r,r.next)===0)){if(Is(r),r=t=r.prev,r===r.next)break;i=!0}else r=r.next;while(i||r!==t);return t}function Ss(e,t,r,i,n,o,l){if(e){!l&&o&&cT(e,i,n,o);for(var h=e,u,f;e.prev!==e.next;){if(u=e.prev,f=e.next,o?iT(e,i,n,o):rT(e)){t.push(u.i/r|0),t.push(e.i/r|0),t.push(f.i/r|0),Is(e),e=f.next,h=f.next;continue}if(e=f,e===h){l?l===1?(e=nT(Hi(e),t,r),Ss(e,t,r,i,n,o,2)):l===2&&sT(e,t,r,i,n,o):Ss(Hi(e),t,r,i,n,o,1);break}}}}function rT(e){var t=e.prev,r=e,i=e.next;if(zt(t,r,i)>=0)return!1;for(var n=t.x,o=r.x,l=i.x,h=t.y,u=r.y,f=i.y,d=n<o?n<l?n:l:o<l?o:l,g=h<u?h<f?h:f:u<f?u:f,m=n>o?n>l?n:l:o>l?o:l,v=h>u?h>f?h:f:u>f?u:f,y=i.next;y!==t;){if(y.x>=d&&y.x<=m&&y.y>=g&&y.y<=v&&xn(n,h,o,u,l,f,y.x,y.y)&&zt(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function iT(e,t,r,i){var n=e.prev,o=e,l=e.next;if(zt(n,o,l)>=0)return!1;for(var h=n.x,u=o.x,f=l.x,d=n.y,g=o.y,m=l.y,v=h<u?h<f?h:f:u<f?u:f,y=d<g?d<m?d:m:g<m?g:m,w=h>u?h>f?h:f:u>f?u:f,x=d>g?d>m?d:m:g>m?g:m,A=fu(v,y,t,r,i),S=fu(w,x,t,r,i),E=e.prevZ,I=e.nextZ;E&&E.z>=A&&I&&I.z<=S;){if(E.x>=v&&E.x<=w&&E.y>=y&&E.y<=x&&E!==n&&E!==l&&xn(h,d,u,g,f,m,E.x,E.y)&&zt(E.prev,E,E.next)>=0||(E=E.prevZ,I.x>=v&&I.x<=w&&I.y>=y&&I.y<=x&&I!==n&&I!==l&&xn(h,d,u,g,f,m,I.x,I.y)&&zt(I.prev,I,I.next)>=0))return!1;I=I.nextZ}for(;E&&E.z>=A;){if(E.x>=v&&E.x<=w&&E.y>=y&&E.y<=x&&E!==n&&E!==l&&xn(h,d,u,g,f,m,E.x,E.y)&&zt(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;I&&I.z<=S;){if(I.x>=v&&I.x<=w&&I.y>=y&&I.y<=x&&I!==n&&I!==l&&xn(h,d,u,g,f,m,I.x,I.y)&&zt(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function nT(e,t,r){var i=e;do{var n=i.prev,o=i.next.next;!Ua(n,o)&&Zg(n,i,i.next,o)&&Cs(n,o)&&Cs(o,n)&&(t.push(n.i/r|0),t.push(i.i/r|0),t.push(o.i/r|0),Is(i),Is(i.next),i=e=o),i=i.next}while(i!==e);return Hi(i)}function sT(e,t,r,i,n,o){var l=e;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&pT(l,h)){var u=Jg(l,h);l=Hi(l,l.next),u=Hi(u,u.next),Ss(l,t,r,i,n,o,0),Ss(u,t,r,i,n,o,0);return}h=h.next}l=l.next}while(l!==e)}function oT(e,t,r,i){var n=[],o,l,h,u,f;for(o=0,l=t.length;o<l;o++)h=t[o]*i,u=o<l-1?t[o+1]*i:e.length,f=Kg(e,h,u,i,!1),f===f.next&&(f.steiner=!0),n.push(dT(f));for(n.sort(aT),o=0;o<n.length;o++)r=lT(n[o],r);return r}function aT(e,t){return e.x-t.x}function lT(e,t){var r=hT(e,t);if(!r)return t;var i=Jg(r,e);return Hi(i,i.next),Hi(r,r.next)}function hT(e,t){var r=t,i=e.x,n=e.y,o=-1/0,l;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var h=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(h<=i&&h>o&&(o=h,l=r.x<r.next.x?r:r.next,h===i))return l}r=r.next}while(r!==t);if(!l)return null;var u=l,f=l.x,d=l.y,g=1/0,m;r=l;do i>=r.x&&r.x>=f&&i!==r.x&&xn(n<d?i:o,n,f,d,n<d?o:i,n,r.x,r.y)&&(m=Math.abs(n-r.y)/(i-r.x),Cs(r,e)&&(m<g||m===g&&(r.x>l.x||r.x===l.x&&uT(l,r)))&&(l=r,g=m)),r=r.next;while(r!==u);return l}function uT(e,t){return zt(e.prev,e,t.prev)<0&&zt(t.next,e,e.next)<0}function cT(e,t,r,i){var n=e;do n.z===0&&(n.z=fu(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,fT(n)}function fT(e){var t,r,i,n,o,l,h,u,f=1;do{for(r=e,e=null,o=null,l=0;r;){for(l++,i=r,h=0,t=0;t<f&&(h++,i=i.nextZ,!!i);t++);for(u=f;h>0||u>0&&i;)h!==0&&(u===0||!i||r.z<=i.z)?(n=r,r=r.nextZ,h--):(n=i,i=i.nextZ,u--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;r=i}o.nextZ=null,f*=2}while(l>1);return e}function fu(e,t,r,i,n){return e=(e-r)*n|0,t=(t-i)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function dT(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function xn(e,t,r,i,n,o,l,h){return(n-l)*(t-h)>=(e-l)*(o-h)&&(e-l)*(i-h)>=(r-l)*(t-h)&&(r-l)*(o-h)>=(n-l)*(i-h)}function pT(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!gT(e,t)&&(Cs(e,t)&&Cs(t,e)&&mT(e,t)&&(zt(e.prev,e,t.prev)||zt(e,t.prev,t))||Ua(e,t)&&zt(e.prev,e,e.next)>0&&zt(t.prev,t,t.next)>0)}function zt(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Ua(e,t){return e.x===t.x&&e.y===t.y}function Zg(e,t,r,i){var n=Bo(zt(e,t,r)),o=Bo(zt(e,t,i)),l=Bo(zt(r,i,e)),h=Bo(zt(r,i,t));return!!(n!==o&&l!==h||n===0&&Do(e,r,t)||o===0&&Do(e,i,t)||l===0&&Do(r,e,i)||h===0&&Do(r,t,i))}function Do(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Bo(e){return e>0?1:e<0?-1:0}function gT(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Zg(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function Cs(e,t){return zt(e.prev,e,e.next)<0?zt(e,t,e.next)>=0&&zt(e,e.prev,t)>=0:zt(e,t,e.prev)<0||zt(e,e.next,t)<0}function mT(e,t){var r=e,i=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==e);return i}function Jg(e,t){var r=new du(e.i,e.x,e.y),i=new du(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function mp(e,t,r,i){var n=new du(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Is(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function du(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}ka.deviation=function(e,t,r,i){var n=t&&t.length,o=n?t[0]*r:e.length,l=Math.abs(pu(e,0,o,r));if(n)for(var h=0,u=t.length;h<u;h++){var f=t[h]*r,d=h<u-1?t[h+1]*r:e.length;l-=Math.abs(pu(e,f,d,r))}var g=0;for(h=0;h<i.length;h+=3){var m=i[h]*r,v=i[h+1]*r,y=i[h+2]*r;g+=Math.abs((e[m]-e[y])*(e[v+1]-e[m+1])-(e[m]-e[v])*(e[y+1]-e[m+1]))}return l===0&&g===0?0:Math.abs((g-l)/l)};function pu(e,t,r,i){for(var n=0,o=t,l=r-i;o<r;o+=i)n+=(e[l]-e[o])*(e[o+1]+e[l+1]),l=o;return n}ka.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var l=0;l<t;l++)r.vertices.push(e[n][o][l]);n>0&&(i+=e[n-1].length,r.holes.push(i))}return r};var vT=ec.exports;const _T=Na(vT);var va={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */va.exports;(function(e,t){(function(r){var i=t&&!t.nodeType&&t,n=e&&!e.nodeType&&e,o=typeof Cr=="object"&&Cr;(o.global===o||o.window===o||o.self===o)&&(r=o);var l,h=2147483647,u=36,f=1,d=26,g=38,m=700,v=72,y=128,w="-",x=/^xn--/,A=/[^\x20-\x7E]/,S=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},I=u-f,D=Math.floor,L=String.fromCharCode,O;function F(H){throw new RangeError(E[H])}function X(H,rt){for(var bt=H.length,Rt=[];bt--;)Rt[bt]=rt(H[bt]);return Rt}function j(H,rt){var bt=H.split("@"),Rt="";bt.length>1&&(Rt=bt[0]+"@",H=bt[1]),H=H.replace(S,".");var Mt=H.split("."),Nt=X(Mt,rt).join(".");return Rt+Nt}function z(H){for(var rt=[],bt=0,Rt=H.length,Mt,Nt;bt<Rt;)Mt=H.charCodeAt(bt++),Mt>=55296&&Mt<=56319&&bt<Rt?(Nt=H.charCodeAt(bt++),(Nt&64512)==56320?rt.push(((Mt&1023)<<10)+(Nt&1023)+65536):(rt.push(Mt),bt--)):rt.push(Mt);return rt}function K(H){return X(H,function(rt){var bt="";return rt>65535&&(rt-=65536,bt+=L(rt>>>10&1023|55296),rt=56320|rt&1023),bt+=L(rt),bt}).join("")}function W(H){return H-48<10?H-22:H-65<26?H-65:H-97<26?H-97:u}function k(H,rt){return H+22+75*(H<26)-((rt!=0)<<5)}function at(H,rt,bt){var Rt=0;for(H=bt?D(H/m):H>>1,H+=D(H/rt);H>I*d>>1;Rt+=u)H=D(H/I);return D(Rt+(I+1)*H/(H+g))}function ft(H){var rt=[],bt=H.length,Rt,Mt=0,Nt=y,kt=v,ie,Yt,ne,oe,Dt,Ut,jt,qt,_e;for(ie=H.lastIndexOf(w),ie<0&&(ie=0),Yt=0;Yt<ie;++Yt)H.charCodeAt(Yt)>=128&&F("not-basic"),rt.push(H.charCodeAt(Yt));for(ne=ie>0?ie+1:0;ne<bt;){for(oe=Mt,Dt=1,Ut=u;ne>=bt&&F("invalid-input"),jt=W(H.charCodeAt(ne++)),(jt>=u||jt>D((h-Mt)/Dt))&&F("overflow"),Mt+=jt*Dt,qt=Ut<=kt?f:Ut>=kt+d?d:Ut-kt,!(jt<qt);Ut+=u)_e=u-qt,Dt>D(h/_e)&&F("overflow"),Dt*=_e;Rt=rt.length+1,kt=at(Mt-oe,Rt,oe==0),D(Mt/Rt)>h-Nt&&F("overflow"),Nt+=D(Mt/Rt),Mt%=Rt,rt.splice(Mt++,0,Nt)}return K(rt)}function Y(H){var rt,bt,Rt,Mt,Nt,kt,ie,Yt,ne,oe,Dt,Ut=[],jt,qt,_e,vi;for(H=z(H),jt=H.length,rt=y,bt=0,Nt=v,kt=0;kt<jt;++kt)Dt=H[kt],Dt<128&&Ut.push(L(Dt));for(Rt=Mt=Ut.length,Mt&&Ut.push(w);Rt<jt;){for(ie=h,kt=0;kt<jt;++kt)Dt=H[kt],Dt>=rt&&Dt<ie&&(ie=Dt);for(qt=Rt+1,ie-rt>D((h-bt)/qt)&&F("overflow"),bt+=(ie-rt)*qt,rt=ie,kt=0;kt<jt;++kt)if(Dt=H[kt],Dt<rt&&++bt>h&&F("overflow"),Dt==rt){for(Yt=bt,ne=u;oe=ne<=Nt?f:ne>=Nt+d?d:ne-Nt,!(Yt<oe);ne+=u)vi=Yt-oe,_e=u-oe,Ut.push(L(k(oe+vi%_e,0))),Yt=D(vi/_e);Ut.push(L(k(Yt,0))),Nt=at(bt,qt,Rt==Mt),bt=0,++Rt}++bt,++rt}return Ut.join("")}function vt(H){return j(H,function(rt){return x.test(rt)?ft(rt.slice(4).toLowerCase()):rt})}function Ot(H){return j(H,function(rt){return A.test(rt)?"xn--"+Y(rt):rt})}if(l={version:"1.4.1",ucs2:{decode:z,encode:K},decode:ft,encode:Y,toASCII:Ot,toUnicode:vt},i&&n)if(e.exports==i)n.exports=l;else for(O in l)l.hasOwnProperty(O)&&(i[O]=l[O]);else r.punycode=l})(Cr)})(va,va.exports);var yT=va.exports,xT=Error,bT=EvalError,wT=RangeError,ET=ReferenceError,Qg=SyntaxError,Fs=TypeError,TT=URIError,AT=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},r=Symbol("test"),i=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var n=42;t[r]=n;for(r in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==r||!Object.prototype.propertyIsEnumerable.call(t,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var l=Object.getOwnPropertyDescriptor(t,r);if(l.value!==n||l.enumerable!==!0)return!1}return!0},vp=typeof Symbol<"u"&&Symbol,ST=AT,CT=function(){return typeof vp!="function"||typeof Symbol!="function"||typeof vp("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:ST()},yh={__proto__:null,foo:{}},IT=Object,RT=function(){return{__proto__:yh}.foo===yh.foo&&!(yh instanceof IT)},PT="Function.prototype.bind called on incompatible ",MT=Object.prototype.toString,DT=Math.max,BT="[object Function]",_p=function(t,r){for(var i=[],n=0;n<t.length;n+=1)i[n]=t[n];for(var o=0;o<r.length;o+=1)i[o+t.length]=r[o];return i},OT=function(t,r){for(var i=[],n=r,o=0;n<t.length;n+=1,o+=1)i[o]=t[n];return i},FT=function(e,t){for(var r="",i=0;i<e.length;i+=1)r+=e[i],i+1<e.length&&(r+=t);return r},LT=function(t){var r=this;if(typeof r!="function"||MT.apply(r)!==BT)throw new TypeError(PT+r);for(var i=OT(arguments,1),n,o=function(){if(this instanceof n){var d=r.apply(this,_p(i,arguments));return Object(d)===d?d:this}return r.apply(t,_p(i,arguments))},l=DT(0,r.length-i.length),h=[],u=0;u<l;u++)h[u]="$"+u;if(n=Function("binder","return function ("+FT(h,",")+"){ return binder.apply(this,arguments); }")(o),r.prototype){var f=function(){};f.prototype=r.prototype,n.prototype=new f,f.prototype=null}return n},NT=LT,rc=Function.prototype.bind||NT,kT=Function.prototype.call,UT=Object.prototype.hasOwnProperty,GT=rc,WT=GT.call(kT,UT),Et,$T=xT,HT=bT,XT=wT,zT=ET,Mn=Qg,Sn=Fs,VT=TT,tm=Function,xh=function(e){try{return tm('"use strict"; return ('+e+").constructor;")()}catch{}},Gi=Object.getOwnPropertyDescriptor;if(Gi)try{Gi({},"")}catch{Gi=null}var bh=function(){throw new Sn},YT=Gi?function(){try{return arguments.callee,bh}catch{try{return Gi(arguments,"callee").get}catch{return bh}}}():bh,cn=CT(),jT=RT(),fe=Object.getPrototypeOf||(jT?function(e){return e.__proto__}:null),mn={},qT=typeof Uint8Array>"u"||!fe?Et:fe(Uint8Array),Wi={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Et:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Et:ArrayBuffer,"%ArrayIteratorPrototype%":cn&&fe?fe([][Symbol.iterator]()):Et,"%AsyncFromSyncIteratorPrototype%":Et,"%AsyncFunction%":mn,"%AsyncGenerator%":mn,"%AsyncGeneratorFunction%":mn,"%AsyncIteratorPrototype%":mn,"%Atomics%":typeof Atomics>"u"?Et:Atomics,"%BigInt%":typeof BigInt>"u"?Et:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Et:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Et:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Et:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":$T,"%eval%":eval,"%EvalError%":HT,"%Float32Array%":typeof Float32Array>"u"?Et:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Et:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Et:FinalizationRegistry,"%Function%":tm,"%GeneratorFunction%":mn,"%Int8Array%":typeof Int8Array>"u"?Et:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Et:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Et:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":cn&&fe?fe(fe([][Symbol.iterator]())):Et,"%JSON%":typeof JSON=="object"?JSON:Et,"%Map%":typeof Map>"u"?Et:Map,"%MapIteratorPrototype%":typeof Map>"u"||!cn||!fe?Et:fe(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Et:Promise,"%Proxy%":typeof Proxy>"u"?Et:Proxy,"%RangeError%":XT,"%ReferenceError%":zT,"%Reflect%":typeof Reflect>"u"?Et:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Et:Set,"%SetIteratorPrototype%":typeof Set>"u"||!cn||!fe?Et:fe(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Et:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":cn&&fe?fe(""[Symbol.iterator]()):Et,"%Symbol%":cn?Symbol:Et,"%SyntaxError%":Mn,"%ThrowTypeError%":YT,"%TypedArray%":qT,"%TypeError%":Sn,"%Uint8Array%":typeof Uint8Array>"u"?Et:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Et:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Et:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Et:Uint32Array,"%URIError%":VT,"%WeakMap%":typeof WeakMap>"u"?Et:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Et:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Et:WeakSet};if(fe)try{null.error}catch(e){var KT=fe(fe(e));Wi["%Error.prototype%"]=KT}var ZT=function e(t){var r;if(t==="%AsyncFunction%")r=xh("async function () {}");else if(t==="%GeneratorFunction%")r=xh("function* () {}");else if(t==="%AsyncGeneratorFunction%")r=xh("async function* () {}");else if(t==="%AsyncGenerator%"){var i=e("%AsyncGeneratorFunction%");i&&(r=i.prototype)}else if(t==="%AsyncIteratorPrototype%"){var n=e("%AsyncGenerator%");n&&fe&&(r=fe(n.prototype))}return Wi[t]=r,r},yp={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Ls=rc,_a=WT,JT=Ls.call(Function.call,Array.prototype.concat),QT=Ls.call(Function.apply,Array.prototype.splice),xp=Ls.call(Function.call,String.prototype.replace),ya=Ls.call(Function.call,String.prototype.slice),tA=Ls.call(Function.call,RegExp.prototype.exec),eA=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,rA=/\\(\\)?/g,iA=function(t){var r=ya(t,0,1),i=ya(t,-1);if(r==="%"&&i!=="%")throw new Mn("invalid intrinsic syntax, expected closing `%`");if(i==="%"&&r!=="%")throw new Mn("invalid intrinsic syntax, expected opening `%`");var n=[];return xp(t,eA,function(o,l,h,u){n[n.length]=h?xp(u,rA,"$1"):l||o}),n},nA=function(t,r){var i=t,n;if(_a(yp,i)&&(n=yp[i],i="%"+n[0]+"%"),_a(Wi,i)){var o=Wi[i];if(o===mn&&(o=ZT(i)),typeof o>"u"&&!r)throw new Sn("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:n,name:i,value:o}}throw new Mn("intrinsic "+t+" does not exist!")},Gn=function(t,r){if(typeof t!="string"||t.length===0)throw new Sn("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof r!="boolean")throw new Sn('"allowMissing" argument must be a boolean');if(tA(/^%?[^%]*%?$/,t)===null)throw new Mn("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=iA(t),n=i.length>0?i[0]:"",o=nA("%"+n+"%",r),l=o.name,h=o.value,u=!1,f=o.alias;f&&(n=f[0],QT(i,JT([0,1],f)));for(var d=1,g=!0;d<i.length;d+=1){var m=i[d],v=ya(m,0,1),y=ya(m,-1);if((v==='"'||v==="'"||v==="`"||y==='"'||y==="'"||y==="`")&&v!==y)throw new Mn("property names with quotes must have matching quotes");if((m==="constructor"||!g)&&(u=!0),n+="."+m,l="%"+n+"%",_a(Wi,l))h=Wi[l];else if(h!=null){if(!(m in h)){if(!r)throw new Sn("base intrinsic for "+t+" exists, but the property is not available.");return}if(Gi&&d+1>=i.length){var w=Gi(h,m);g=!!w,g&&"get"in w&&!("originalValue"in w.get)?h=w.get:h=h[m]}else g=_a(h,m),h=h[m];g&&!u&&(Wi[l]=h)}}return h},em={exports:{}},wh,bp;function ic(){if(bp)return wh;bp=1;var e=Gn,t=e("%Object.defineProperty%",!0)||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return wh=t,wh}var sA=Gn,oa=sA("%Object.getOwnPropertyDescriptor%",!0);if(oa)try{oa([],"length")}catch{oa=null}var rm=oa,wp=ic(),oA=Qg,fn=Fs,Ep=rm,aA=function(t,r,i){if(!t||typeof t!="object"&&typeof t!="function")throw new fn("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new fn("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new fn("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new fn("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new fn("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new fn("`loose`, if provided, must be a boolean");var n=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,l=arguments.length>5?arguments[5]:null,h=arguments.length>6?arguments[6]:!1,u=!!Ep&&Ep(t,r);if(wp)wp(t,r,{configurable:l===null&&u?u.configurable:!l,enumerable:n===null&&u?u.enumerable:!n,value:i,writable:o===null&&u?u.writable:!o});else if(h||!n&&!o&&!l)t[r]=i;else throw new oA("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},gu=ic(),im=function(){return!!gu};im.hasArrayLengthDefineBug=function(){if(!gu)return null;try{return gu([],"length",{value:1}).length!==1}catch{return!0}};var lA=im,hA=Gn,Tp=aA,uA=lA(),Ap=rm,Sp=Fs,cA=hA("%Math.floor%"),fA=function(t,r){if(typeof t!="function")throw new Sp("`fn` is not a function");if(typeof r!="number"||r<0||r>4294967295||cA(r)!==r)throw new Sp("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],n=!0,o=!0;if("length"in t&&Ap){var l=Ap(t,"length");l&&!l.configurable&&(n=!1),l&&!l.writable&&(o=!1)}return(n||o||!i)&&(uA?Tp(t,"length",r,!0,!0):Tp(t,"length",r)),t};(function(e){var t=rc,r=Gn,i=fA,n=Fs,o=r("%Function.prototype.apply%"),l=r("%Function.prototype.call%"),h=r("%Reflect.apply%",!0)||t.call(l,o),u=ic(),f=r("%Math.max%");e.exports=function(m){if(typeof m!="function")throw new n("a function is required");var v=h(t,l,arguments);return i(v,1+f(0,m.length-(arguments.length-1)),!0)};var d=function(){return h(t,o,arguments)};u?u(e.exports,"apply",{value:d}):e.exports.apply=d})(em);var dA=em.exports,nm=Gn,sm=dA,pA=sm(nm("String.prototype.indexOf")),gA=function(t,r){var i=nm(t,!!r);return typeof i=="function"&&pA(t,".prototype.")>-1?sm(i):i};const mA={},vA=Object.freeze(Object.defineProperty({__proto__:null,default:mA},Symbol.toStringTag,{value:"Module"})),_A=ZE(vA);var nc=typeof Map=="function"&&Map.prototype,Eh=Object.getOwnPropertyDescriptor&&nc?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,xa=nc&&Eh&&typeof Eh.get=="function"?Eh.get:null,Cp=nc&&Map.prototype.forEach,sc=typeof Set=="function"&&Set.prototype,Th=Object.getOwnPropertyDescriptor&&sc?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,ba=sc&&Th&&typeof Th.get=="function"?Th.get:null,Ip=sc&&Set.prototype.forEach,yA=typeof WeakMap=="function"&&WeakMap.prototype,bs=yA?WeakMap.prototype.has:null,xA=typeof WeakSet=="function"&&WeakSet.prototype,ws=xA?WeakSet.prototype.has:null,bA=typeof WeakRef=="function"&&WeakRef.prototype,Rp=bA?WeakRef.prototype.deref:null,wA=Boolean.prototype.valueOf,EA=Object.prototype.toString,TA=Function.prototype.toString,AA=String.prototype.match,oc=String.prototype.slice,hi=String.prototype.replace,SA=String.prototype.toUpperCase,Pp=String.prototype.toLowerCase,om=RegExp.prototype.test,Mp=Array.prototype.concat,Sr=Array.prototype.join,CA=Array.prototype.slice,Dp=Math.floor,mu=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Ah=Object.getOwnPropertySymbols,vu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Dn=typeof Symbol=="function"&&typeof Symbol.iterator=="object",be=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Dn||!0)?Symbol.toStringTag:null,am=Object.prototype.propertyIsEnumerable,Bp=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function Op(e,t){if(e===1/0||e===-1/0||e!==e||e&&e>-1e3&&e<1e3||om.call(/e/,t))return t;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof e=="number"){var i=e<0?-Dp(-e):Dp(e);if(i!==e){var n=String(i),o=oc.call(t,n.length+1);return hi.call(n,r,"$&_")+"."+hi.call(hi.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return hi.call(t,r,"$&_")}var _u=_A,Fp=_u.custom,Lp=hm(Fp)?Fp:null,IA=function e(t,r,i,n){var o=r||{};if(oi(o,"quoteStyle")&&o.quoteStyle!=="single"&&o.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(oi(o,"maxStringLength")&&(typeof o.maxStringLength=="number"?o.maxStringLength<0&&o.maxStringLength!==1/0:o.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var l=oi(o,"customInspect")?o.customInspect:!0;if(typeof l!="boolean"&&l!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(oi(o,"indent")&&o.indent!==null&&o.indent!=="	"&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(oi(o,"numericSeparator")&&typeof o.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var h=o.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return cm(t,o);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var u=String(t);return h?Op(t,u):u}if(typeof t=="bigint"){var f=String(t)+"n";return h?Op(t,f):f}var d=typeof o.depth>"u"?5:o.depth;if(typeof i>"u"&&(i=0),i>=d&&d>0&&typeof t=="object")return yu(t)?"[Array]":"[Object]";var g=VA(o,i);if(typeof n>"u")n=[];else if(um(n,t)>=0)return"[Circular]";function m(W,k,at){if(k&&(n=CA.call(n),n.push(k)),at){var ft={depth:o.depth};return oi(o,"quoteStyle")&&(ft.quoteStyle=o.quoteStyle),e(W,ft,i+1,n)}return e(W,o,i+1,n)}if(typeof t=="function"&&!Np(t)){var v=NA(t),y=Oo(t,m);return"[Function"+(v?": "+v:" (anonymous)")+"]"+(y.length>0?" { "+Sr.call(y,", ")+" }":"")}if(hm(t)){var w=Dn?hi.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):vu.call(t);return typeof t=="object"&&!Dn?cs(w):w}if(HA(t)){for(var x="<"+Pp.call(String(t.nodeName)),A=t.attributes||[],S=0;S<A.length;S++)x+=" "+A[S].name+"="+lm(RA(A[S].value),"double",o);return x+=">",t.childNodes&&t.childNodes.length&&(x+="..."),x+="</"+Pp.call(String(t.nodeName))+">",x}if(yu(t)){if(t.length===0)return"[]";var E=Oo(t,m);return g&&!zA(E)?"["+xu(E,g)+"]":"[ "+Sr.call(E,", ")+" ]"}if(MA(t)){var I=Oo(t,m);return!("cause"in Error.prototype)&&"cause"in t&&!am.call(t,"cause")?"{ ["+String(t)+"] "+Sr.call(Mp.call("[cause]: "+m(t.cause),I),", ")+" }":I.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+Sr.call(I,", ")+" }"}if(typeof t=="object"&&l){if(Lp&&typeof t[Lp]=="function"&&_u)return _u(t,{depth:d-i});if(l!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(kA(t)){var D=[];return Cp&&Cp.call(t,function(W,k){D.push(m(k,t,!0)+" => "+m(W,t))}),kp("Map",xa.call(t),D,g)}if(WA(t)){var L=[];return Ip&&Ip.call(t,function(W){L.push(m(W,t))}),kp("Set",ba.call(t),L,g)}if(UA(t))return Sh("WeakMap");if($A(t))return Sh("WeakSet");if(GA(t))return Sh("WeakRef");if(BA(t))return cs(m(Number(t)));if(FA(t))return cs(m(mu.call(t)));if(OA(t))return cs(wA.call(t));if(DA(t))return cs(m(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(t===Cr)return"{ [object globalThis] }";if(!PA(t)&&!Np(t)){var O=Oo(t,m),F=Bp?Bp(t)===Object.prototype:t instanceof Object||t.constructor===Object,X=t instanceof Object?"":"null prototype",j=!F&&be&&Object(t)===t&&be in t?oc.call(mi(t),8,-1):X?"Object":"",z=F||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",K=z+(j||X?"["+Sr.call(Mp.call([],j||[],X||[]),": ")+"] ":"");return O.length===0?K+"{}":g?K+"{"+xu(O,g)+"}":K+"{ "+Sr.call(O,", ")+" }"}return String(t)};function lm(e,t,r){var i=(r.quoteStyle||t)==="double"?'"':"'";return i+e+i}function RA(e){return hi.call(String(e),/"/g,"&quot;")}function yu(e){return mi(e)==="[object Array]"&&(!be||!(typeof e=="object"&&be in e))}function PA(e){return mi(e)==="[object Date]"&&(!be||!(typeof e=="object"&&be in e))}function Np(e){return mi(e)==="[object RegExp]"&&(!be||!(typeof e=="object"&&be in e))}function MA(e){return mi(e)==="[object Error]"&&(!be||!(typeof e=="object"&&be in e))}function DA(e){return mi(e)==="[object String]"&&(!be||!(typeof e=="object"&&be in e))}function BA(e){return mi(e)==="[object Number]"&&(!be||!(typeof e=="object"&&be in e))}function OA(e){return mi(e)==="[object Boolean]"&&(!be||!(typeof e=="object"&&be in e))}function hm(e){if(Dn)return e&&typeof e=="object"&&e instanceof Symbol;if(typeof e=="symbol")return!0;if(!e||typeof e!="object"||!vu)return!1;try{return vu.call(e),!0}catch{}return!1}function FA(e){if(!e||typeof e!="object"||!mu)return!1;try{return mu.call(e),!0}catch{}return!1}var LA=Object.prototype.hasOwnProperty||function(e){return e in this};function oi(e,t){return LA.call(e,t)}function mi(e){return EA.call(e)}function NA(e){if(e.name)return e.name;var t=AA.call(TA.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}function um(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1}function kA(e){if(!xa||!e||typeof e!="object")return!1;try{xa.call(e);try{ba.call(e)}catch{return!0}return e instanceof Map}catch{}return!1}function UA(e){if(!bs||!e||typeof e!="object")return!1;try{bs.call(e,bs);try{ws.call(e,ws)}catch{return!0}return e instanceof WeakMap}catch{}return!1}function GA(e){if(!Rp||!e||typeof e!="object")return!1;try{return Rp.call(e),!0}catch{}return!1}function WA(e){if(!ba||!e||typeof e!="object")return!1;try{ba.call(e);try{xa.call(e)}catch{return!0}return e instanceof Set}catch{}return!1}function $A(e){if(!ws||!e||typeof e!="object")return!1;try{ws.call(e,ws);try{bs.call(e,bs)}catch{return!0}return e instanceof WeakSet}catch{}return!1}function HA(e){return!e||typeof e!="object"?!1:typeof HTMLElement<"u"&&e instanceof HTMLElement?!0:typeof e.nodeName=="string"&&typeof e.getAttribute=="function"}function cm(e,t){if(e.length>t.maxStringLength){var r=e.length-t.maxStringLength,i="... "+r+" more character"+(r>1?"s":"");return cm(oc.call(e,0,t.maxStringLength),t)+i}var n=hi.call(hi.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,XA);return lm(n,"single",t)}function XA(e){var t=e.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return r?"\\"+r:"\\x"+(t<16?"0":"")+SA.call(t.toString(16))}function cs(e){return"Object("+e+")"}function Sh(e){return e+" { ? }"}function kp(e,t,r,i){var n=i?xu(r,i):Sr.call(r,", ");return e+" ("+t+") {"+n+"}"}function zA(e){for(var t=0;t<e.length;t++)if(um(e[t],`
`)>=0)return!1;return!0}function VA(e,t){var r;if(e.indent==="	")r="	";else if(typeof e.indent=="number"&&e.indent>0)r=Sr.call(Array(e.indent+1)," ");else return null;return{base:r,prev:Sr.call(Array(t+1),r)}}function xu(e,t){if(e.length===0)return"";var r=`
`+t.prev+t.base;return r+Sr.call(e,","+r)+`
`+t.prev}function Oo(e,t){var r=yu(e),i=[];if(r){i.length=e.length;for(var n=0;n<e.length;n++)i[n]=oi(e,n)?t(e[n],e):""}var o=typeof Ah=="function"?Ah(e):[],l;if(Dn){l={};for(var h=0;h<o.length;h++)l["$"+o[h]]=o[h]}for(var u in e)oi(e,u)&&(r&&String(Number(u))===u&&u<e.length||Dn&&l["$"+u]instanceof Symbol||(om.call(/[^\w$]/,u)?i.push(t(u,e)+": "+t(e[u],e)):i.push(u+": "+t(e[u],e))));if(typeof Ah=="function")for(var f=0;f<o.length;f++)am.call(e,o[f])&&i.push("["+t(o[f])+"]: "+t(e[o[f]],e));return i}var fm=Gn,Wn=gA,YA=IA,jA=Fs,Fo=fm("%WeakMap%",!0),Lo=fm("%Map%",!0),qA=Wn("WeakMap.prototype.get",!0),KA=Wn("WeakMap.prototype.set",!0),ZA=Wn("WeakMap.prototype.has",!0),JA=Wn("Map.prototype.get",!0),QA=Wn("Map.prototype.set",!0),tS=Wn("Map.prototype.has",!0),ac=function(e,t){for(var r=e,i;(i=r.next)!==null;r=i)if(i.key===t)return r.next=i.next,i.next=e.next,e.next=i,i},eS=function(e,t){var r=ac(e,t);return r&&r.value},rS=function(e,t,r){var i=ac(e,t);i?i.value=r:e.next={key:t,next:e.next,value:r}},iS=function(e,t){return!!ac(e,t)},nS=function(){var t,r,i,n={assert:function(o){if(!n.has(o))throw new jA("Side channel does not contain "+YA(o))},get:function(o){if(Fo&&o&&(typeof o=="object"||typeof o=="function")){if(t)return qA(t,o)}else if(Lo){if(r)return JA(r,o)}else if(i)return eS(i,o)},has:function(o){if(Fo&&o&&(typeof o=="object"||typeof o=="function")){if(t)return ZA(t,o)}else if(Lo){if(r)return tS(r,o)}else if(i)return iS(i,o);return!1},set:function(o,l){Fo&&o&&(typeof o=="object"||typeof o=="function")?(t||(t=new Fo),KA(t,o,l)):Lo?(r||(r=new Lo),QA(r,o,l)):(i||(i={key:{},next:null}),rS(i,o,l))}};return n},sS=String.prototype.replace,oS=/%20/g,Ch={RFC1738:"RFC1738",RFC3986:"RFC3986"},lc={default:Ch.RFC3986,formatters:{RFC1738:function(e){return sS.call(e,oS,"+")},RFC3986:function(e){return String(e)}},RFC1738:Ch.RFC1738,RFC3986:Ch.RFC3986},aS=lc,Ih=Object.prototype.hasOwnProperty,Fi=Array.isArray,br=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),lS=function(t){for(;t.length>1;){var r=t.pop(),i=r.obj[r.prop];if(Fi(i)){for(var n=[],o=0;o<i.length;++o)typeof i[o]<"u"&&n.push(i[o]);r.obj[r.prop]=n}}},dm=function(t,r){for(var i=r&&r.plainObjects?Object.create(null):{},n=0;n<t.length;++n)typeof t[n]<"u"&&(i[n]=t[n]);return i},hS=function e(t,r,i){if(!r)return t;if(typeof r!="object"){if(Fi(t))t.push(r);else if(t&&typeof t=="object")(i&&(i.plainObjects||i.allowPrototypes)||!Ih.call(Object.prototype,r))&&(t[r]=!0);else return[t,r];return t}if(!t||typeof t!="object")return[t].concat(r);var n=t;return Fi(t)&&!Fi(r)&&(n=dm(t,i)),Fi(t)&&Fi(r)?(r.forEach(function(o,l){if(Ih.call(t,l)){var h=t[l];h&&typeof h=="object"&&o&&typeof o=="object"?t[l]=e(h,o,i):t.push(o)}else t[l]=o}),t):Object.keys(r).reduce(function(o,l){var h=r[l];return Ih.call(o,l)?o[l]=e(o[l],h,i):o[l]=h,o},n)},uS=function(t,r){return Object.keys(r).reduce(function(i,n){return i[n]=r[n],i},t)},cS=function(e,t,r){var i=e.replace(/\+/g," ");if(r==="iso-8859-1")return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch{return i}},Rh=1024,fS=function(t,r,i,n,o){if(t.length===0)return t;var l=t;if(typeof t=="symbol"?l=Symbol.prototype.toString.call(t):typeof t!="string"&&(l=String(t)),i==="iso-8859-1")return escape(l).replace(/%u[0-9a-f]{4}/gi,function(v){return"%26%23"+parseInt(v.slice(2),16)+"%3B"});for(var h="",u=0;u<l.length;u+=Rh){for(var f=l.length>=Rh?l.slice(u,u+Rh):l,d=[],g=0;g<f.length;++g){var m=f.charCodeAt(g);if(m===45||m===46||m===95||m===126||m>=48&&m<=57||m>=65&&m<=90||m>=97&&m<=122||o===aS.RFC1738&&(m===40||m===41)){d[d.length]=f.charAt(g);continue}if(m<128){d[d.length]=br[m];continue}if(m<2048){d[d.length]=br[192|m>>6]+br[128|m&63];continue}if(m<55296||m>=57344){d[d.length]=br[224|m>>12]+br[128|m>>6&63]+br[128|m&63];continue}g+=1,m=65536+((m&1023)<<10|f.charCodeAt(g)&1023),d[d.length]=br[240|m>>18]+br[128|m>>12&63]+br[128|m>>6&63]+br[128|m&63]}h+=d.join("")}return h},dS=function(t){for(var r=[{obj:{o:t},prop:"o"}],i=[],n=0;n<r.length;++n)for(var o=r[n],l=o.obj[o.prop],h=Object.keys(l),u=0;u<h.length;++u){var f=h[u],d=l[f];typeof d=="object"&&d!==null&&i.indexOf(d)===-1&&(r.push({obj:l,prop:f}),i.push(d))}return lS(r),t},pS=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},gS=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},mS=function(t,r){return[].concat(t,r)},vS=function(t,r){if(Fi(t)){for(var i=[],n=0;n<t.length;n+=1)i.push(r(t[n]));return i}return r(t)},pm={arrayToObject:dm,assign:uS,combine:mS,compact:dS,decode:cS,encode:fS,isBuffer:gS,isRegExp:pS,maybeMap:vS,merge:hS},gm=nS,aa=pm,Es=lc,_S=Object.prototype.hasOwnProperty,mm={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,r){return t+"["+r+"]"},repeat:function(t){return t}},Tr=Array.isArray,yS=Array.prototype.push,vm=function(e,t){yS.apply(e,Tr(t)?t:[t])},xS=Date.prototype.toISOString,Up=Es.default,he={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:aa.encode,encodeValuesOnly:!1,format:Up,formatter:Es.formatters[Up],indices:!1,serializeDate:function(t){return xS.call(t)},skipNulls:!1,strictNullHandling:!1},bS=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},Ph={},wS=function e(t,r,i,n,o,l,h,u,f,d,g,m,v,y,w,x,A,S){for(var E=t,I=S,D=0,L=!1;(I=I.get(Ph))!==void 0&&!L;){var O=I.get(t);if(D+=1,typeof O<"u"){if(O===D)throw new RangeError("Cyclic object value");L=!0}typeof I.get(Ph)>"u"&&(D=0)}if(typeof d=="function"?E=d(r,E):E instanceof Date?E=v(E):i==="comma"&&Tr(E)&&(E=aa.maybeMap(E,function(H){return H instanceof Date?v(H):H})),E===null){if(l)return f&&!x?f(r,he.encoder,A,"key",y):r;E=""}if(bS(E)||aa.isBuffer(E)){if(f){var F=x?r:f(r,he.encoder,A,"key",y);return[w(F)+"="+w(f(E,he.encoder,A,"value",y))]}return[w(r)+"="+w(String(E))]}var X=[];if(typeof E>"u")return X;var j;if(i==="comma"&&Tr(E))x&&f&&(E=aa.maybeMap(E,f)),j=[{value:E.length>0?E.join(",")||null:void 0}];else if(Tr(d))j=d;else{var z=Object.keys(E);j=g?z.sort(g):z}var K=u?r.replace(/\./g,"%2E"):r,W=n&&Tr(E)&&E.length===1?K+"[]":K;if(o&&Tr(E)&&E.length===0)return W+"[]";for(var k=0;k<j.length;++k){var at=j[k],ft=typeof at=="object"&&typeof at.value<"u"?at.value:E[at];if(!(h&&ft===null)){var Y=m&&u?at.replace(/\./g,"%2E"):at,vt=Tr(E)?typeof i=="function"?i(W,Y):W:W+(m?"."+Y:"["+Y+"]");S.set(t,D);var Ot=gm();Ot.set(Ph,S),vm(X,e(ft,vt,i,n,o,l,h,u,i==="comma"&&x&&Tr(E)?null:f,d,g,m,v,y,w,x,A,Ot))}}return X},ES=function(t){if(!t)return he;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var r=t.charset||he.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=Es.default;if(typeof t.format<"u"){if(!_S.call(Es.formatters,t.format))throw new TypeError("Unknown format option provided.");i=t.format}var n=Es.formatters[i],o=he.filter;(typeof t.filter=="function"||Tr(t.filter))&&(o=t.filter);var l;if(t.arrayFormat in mm?l=t.arrayFormat:"indices"in t?l=t.indices?"indices":"repeat":l=he.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var h=typeof t.allowDots>"u"?t.encodeDotInKeys===!0?!0:he.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:he.addQueryPrefix,allowDots:h,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:he.allowEmptyArrays,arrayFormat:l,charset:r,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:he.charsetSentinel,commaRoundTrip:t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?he.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:he.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:he.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:he.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:he.encodeValuesOnly,filter:o,format:i,formatter:n,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:he.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:he.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:he.strictNullHandling}},TS=function(e,t){var r=e,i=ES(t),n,o;typeof i.filter=="function"?(o=i.filter,r=o("",r)):Tr(i.filter)&&(o=i.filter,n=o);var l=[];if(typeof r!="object"||r===null)return"";var h=mm[i.arrayFormat],u=h==="comma"&&i.commaRoundTrip;n||(n=Object.keys(r)),i.sort&&n.sort(i.sort);for(var f=gm(),d=0;d<n.length;++d){var g=n[d];i.skipNulls&&r[g]===null||vm(l,wS(r[g],g,h,u,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,f))}var m=l.join(i.delimiter),v=i.addQueryPrefix===!0?"?":"";return i.charsetSentinel&&(i.charset==="iso-8859-1"?v+="utf8=%26%2310003%3B&":v+="utf8=%E2%9C%93&"),m.length>0?v+m:""},Bn=pm,bu=Object.prototype.hasOwnProperty,AS=Array.isArray,te={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:Bn.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},SS=function(e){return e.replace(/&#(\d+);/g,function(t,r){return String.fromCharCode(parseInt(r,10))})},_m=function(e,t){return e&&typeof e=="string"&&t.comma&&e.indexOf(",")>-1?e.split(","):e},CS="utf8=%26%2310003%3B",IS="utf8=%E2%9C%93",RS=function(t,r){var i={__proto__:null},n=r.ignoreQueryPrefix?t.replace(/^\?/,""):t,o=r.parameterLimit===1/0?void 0:r.parameterLimit,l=n.split(r.delimiter,o),h=-1,u,f=r.charset;if(r.charsetSentinel)for(u=0;u<l.length;++u)l[u].indexOf("utf8=")===0&&(l[u]===IS?f="utf-8":l[u]===CS&&(f="iso-8859-1"),h=u,u=l.length);for(u=0;u<l.length;++u)if(u!==h){var d=l[u],g=d.indexOf("]="),m=g===-1?d.indexOf("="):g+1,v,y;m===-1?(v=r.decoder(d,te.decoder,f,"key"),y=r.strictNullHandling?null:""):(v=r.decoder(d.slice(0,m),te.decoder,f,"key"),y=Bn.maybeMap(_m(d.slice(m+1),r),function(x){return r.decoder(x,te.decoder,f,"value")})),y&&r.interpretNumericEntities&&f==="iso-8859-1"&&(y=SS(y)),d.indexOf("[]=")>-1&&(y=AS(y)?[y]:y);var w=bu.call(i,v);w&&r.duplicates==="combine"?i[v]=Bn.combine(i[v],y):(!w||r.duplicates==="last")&&(i[v]=y)}return i},PS=function(e,t,r,i){for(var n=i?t:_m(t,r),o=e.length-1;o>=0;--o){var l,h=e[o];if(h==="[]"&&r.parseArrays)l=r.allowEmptyArrays&&n===""?[]:[].concat(n);else{l=r.plainObjects?Object.create(null):{};var u=h.charAt(0)==="["&&h.charAt(h.length-1)==="]"?h.slice(1,-1):h,f=r.decodeDotInKeys?u.replace(/%2E/g,"."):u,d=parseInt(f,10);!r.parseArrays&&f===""?l={0:n}:!isNaN(d)&&h!==f&&String(d)===f&&d>=0&&r.parseArrays&&d<=r.arrayLimit?(l=[],l[d]=n):f!=="__proto__"&&(l[f]=n)}n=l}return n},MS=function(t,r,i,n){if(t){var o=i.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,l=/(\[[^[\]]*])/,h=/(\[[^[\]]*])/g,u=i.depth>0&&l.exec(o),f=u?o.slice(0,u.index):o,d=[];if(f){if(!i.plainObjects&&bu.call(Object.prototype,f)&&!i.allowPrototypes)return;d.push(f)}for(var g=0;i.depth>0&&(u=h.exec(o))!==null&&g<i.depth;){if(g+=1,!i.plainObjects&&bu.call(Object.prototype,u[1].slice(1,-1))&&!i.allowPrototypes)return;d.push(u[1])}return u&&d.push("["+o.slice(u.index)+"]"),PS(d,r,i,n)}},DS=function(t){if(!t)return te;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.decodeDotInKeys<"u"&&typeof t.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(t.decoder!==null&&typeof t.decoder<"u"&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=typeof t.charset>"u"?te.charset:t.charset,i=typeof t.duplicates>"u"?te.duplicates:t.duplicates;if(i!=="combine"&&i!=="first"&&i!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var n=typeof t.allowDots>"u"?t.decodeDotInKeys===!0?!0:te.allowDots:!!t.allowDots;return{allowDots:n,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:te.allowEmptyArrays,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:te.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:te.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:te.arrayLimit,charset:r,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:te.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:te.comma,decodeDotInKeys:typeof t.decodeDotInKeys=="boolean"?t.decodeDotInKeys:te.decodeDotInKeys,decoder:typeof t.decoder=="function"?t.decoder:te.decoder,delimiter:typeof t.delimiter=="string"||Bn.isRegExp(t.delimiter)?t.delimiter:te.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:te.depth,duplicates:i,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:te.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:te.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:te.plainObjects,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:te.strictNullHandling}},BS=function(e,t){var r=DS(t);if(e===""||e===null||typeof e>"u")return r.plainObjects?Object.create(null):{};for(var i=typeof e=="string"?RS(e,r):e,n=r.plainObjects?Object.create(null):{},o=Object.keys(i),l=0;l<o.length;++l){var h=o[l],u=MS(h,i[h],r,typeof e=="string");n=Bn.merge(n,u,r)}return r.allowSparse===!0?n:Bn.compact(n)},OS=TS,FS=BS,LS=lc,NS={formats:LS,parse:FS,stringify:OS},kS=yT;function dr(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var US=/^([a-z0-9.+-]+:)/i,GS=/:[0-9]*$/,WS=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,$S=["<",">",'"',"`"," ","\r",`
`,"	"],HS=["{","}","|","\\","^","`"].concat($S),wu=["'"].concat(HS),Gp=["%","/","?",";","#"].concat(wu),Wp=["/","?","#"],XS=255,$p=/^[+a-z0-9A-Z_-]{0,63}$/,zS=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,VS={javascript:!0,"javascript:":!0},Eu={javascript:!0,"javascript:":!0},Cn={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Tu=NS;function Ga(e,t,r){if(e&&typeof e=="object"&&e instanceof dr)return e;var i=new dr;return i.parse(e,t,r),i}dr.prototype.parse=function(e,t,r){if(typeof e!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var i=e.indexOf("?"),n=i!==-1&&i<e.indexOf("#")?"?":"#",o=e.split(n),l=/\\/g;o[0]=o[0].replace(l,"/"),e=o.join(n);var h=e;if(h=h.trim(),!r&&e.split("#").length===1){var u=WS.exec(h);if(u)return this.path=h,this.href=h,this.pathname=u[1],u[2]?(this.search=u[2],t?this.query=Tu.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var f=US.exec(h);if(f){f=f[0];var d=f.toLowerCase();this.protocol=d,h=h.substr(f.length)}if(r||f||h.match(/^\/\/[^@/]+@[^@/]+/)){var g=h.substr(0,2)==="//";g&&!(f&&Eu[f])&&(h=h.substr(2),this.slashes=!0)}if(!Eu[f]&&(g||f&&!Cn[f])){for(var m=-1,v=0;v<Wp.length;v++){var y=h.indexOf(Wp[v]);y!==-1&&(m===-1||y<m)&&(m=y)}var w,x;m===-1?x=h.lastIndexOf("@"):x=h.lastIndexOf("@",m),x!==-1&&(w=h.slice(0,x),h=h.slice(x+1),this.auth=decodeURIComponent(w)),m=-1;for(var v=0;v<Gp.length;v++){var y=h.indexOf(Gp[v]);y!==-1&&(m===-1||y<m)&&(m=y)}m===-1&&(m=h.length),this.host=h.slice(0,m),h=h.slice(m),this.parseHost(),this.hostname=this.hostname||"";var A=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!A)for(var S=this.hostname.split(/\./),v=0,E=S.length;v<E;v++){var I=S[v];if(I&&!I.match($p)){for(var D="",L=0,O=I.length;L<O;L++)I.charCodeAt(L)>127?D+="x":D+=I[L];if(!D.match($p)){var F=S.slice(0,v),X=S.slice(v+1),j=I.match(zS);j&&(F.push(j[1]),X.unshift(j[2])),X.length&&(h="/"+X.join(".")+h),this.hostname=F.join(".");break}}}this.hostname.length>XS?this.hostname="":this.hostname=this.hostname.toLowerCase(),A||(this.hostname=kS.toASCII(this.hostname));var z=this.port?":"+this.port:"",K=this.hostname||"";this.host=K+z,this.href+=this.host,A&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),h[0]!=="/"&&(h="/"+h))}if(!VS[d])for(var v=0,E=wu.length;v<E;v++){var W=wu[v];if(h.indexOf(W)!==-1){var k=encodeURIComponent(W);k===W&&(k=escape(W)),h=h.split(W).join(k)}}var at=h.indexOf("#");at!==-1&&(this.hash=h.substr(at),h=h.slice(0,at));var ft=h.indexOf("?");if(ft!==-1?(this.search=h.substr(ft),this.query=h.substr(ft+1),t&&(this.query=Tu.parse(this.query)),h=h.slice(0,ft)):t&&(this.search="",this.query={}),h&&(this.pathname=h),Cn[d]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var z=this.pathname||"",Y=this.search||"";this.path=z+Y}return this.href=this.format(),this};function YS(e){return typeof e=="string"&&(e=Ga(e)),e instanceof dr?e.format():dr.prototype.format.call(e)}dr.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",i=this.hash||"",n=!1,o="";this.host?n=e+this.host:this.hostname&&(n=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(o=Tu.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var l=this.search||o&&"?"+o||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||Cn[t])&&n!==!1?(n="//"+(n||""),r&&r.charAt(0)!=="/"&&(r="/"+r)):n||(n=""),i&&i.charAt(0)!=="#"&&(i="#"+i),l&&l.charAt(0)!=="?"&&(l="?"+l),r=r.replace(/[?#]/g,function(h){return encodeURIComponent(h)}),l=l.replace("#","%23"),t+n+r+l+i};function jS(e,t){return Ga(e,!1,!0).resolve(t)}dr.prototype.resolve=function(e){return this.resolveObject(Ga(e,!1,!0)).format()};dr.prototype.resolveObject=function(e){if(typeof e=="string"){var t=new dr;t.parse(e,!1,!0),e=t}for(var r=new dr,i=Object.keys(this),n=0;n<i.length;n++){var o=i[n];r[o]=this[o]}if(r.hash=e.hash,e.href==="")return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),h=0;h<l.length;h++){var u=l[h];u!=="protocol"&&(r[u]=e[u])}return Cn[r.protocol]&&r.hostname&&!r.pathname&&(r.pathname="/",r.path=r.pathname),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!Cn[e.protocol]){for(var f=Object.keys(e),d=0;d<f.length;d++){var g=f[d];r[g]=e[g]}return r.href=r.format(),r}if(r.protocol=e.protocol,!e.host&&!Eu[e.protocol]){for(var E=(e.pathname||"").split("/");E.length&&!(e.host=E.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),E[0]!==""&&E.unshift(""),E.length<2&&E.unshift(""),r.pathname=E.join("/")}else r.pathname=e.pathname;if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var m=r.pathname||"",v=r.search||"";r.path=m+v}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var y=r.pathname&&r.pathname.charAt(0)==="/",w=e.host||e.pathname&&e.pathname.charAt(0)==="/",x=w||y||r.host&&e.pathname,A=x,S=r.pathname&&r.pathname.split("/")||[],E=e.pathname&&e.pathname.split("/")||[],I=r.protocol&&!Cn[r.protocol];if(I&&(r.hostname="",r.port=null,r.host&&(S[0]===""?S[0]=r.host:S.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(E[0]===""?E[0]=e.host:E.unshift(e.host)),e.host=null),x=x&&(E[0]===""||S[0]==="")),w)r.host=e.host||e.host===""?e.host:r.host,r.hostname=e.hostname||e.hostname===""?e.hostname:r.hostname,r.search=e.search,r.query=e.query,S=E;else if(E.length)S||(S=[]),S.pop(),S=S.concat(E),r.search=e.search,r.query=e.query;else if(e.search!=null){if(I){r.host=S.shift(),r.hostname=r.host;var D=r.host&&r.host.indexOf("@")>0?r.host.split("@"):!1;D&&(r.auth=D.shift(),r.hostname=D.shift(),r.host=r.hostname)}return r.search=e.search,r.query=e.query,(r.pathname!==null||r.search!==null)&&(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!S.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var L=S.slice(-1)[0],O=(r.host||e.host||S.length>1)&&(L==="."||L==="..")||L==="",F=0,X=S.length;X>=0;X--)L=S[X],L==="."?S.splice(X,1):L===".."?(S.splice(X,1),F++):F&&(S.splice(X,1),F--);if(!x&&!A)for(;F--;F)S.unshift("..");x&&S[0]!==""&&(!S[0]||S[0].charAt(0)!=="/")&&S.unshift(""),O&&S.join("/").substr(-1)!=="/"&&S.push("");var j=S[0]===""||S[0]&&S[0].charAt(0)==="/";if(I){r.hostname=j?"":S.length?S.shift():"",r.host=r.hostname;var D=r.host&&r.host.indexOf("@")>0?r.host.split("@"):!1;D&&(r.auth=D.shift(),r.hostname=D.shift(),r.host=r.hostname)}return x=x||r.host&&S.length,x&&!j&&S.unshift(""),S.length>0?r.pathname=S.join("/"):(r.pathname=null,r.path=null),(r.pathname!==null||r.search!==null)&&(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r};dr.prototype.parseHost=function(){var e=this.host,t=GS.exec(e);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)};var qS=Ga,KS=jS,ZS=YS;const JS={parse:qS,format:ZS,resolve:KS};function nr(e){if(typeof e!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function fs(e){return e.split("?")[0].split("#")[0]}function QS(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function tC(e,t,r){return e.replace(new RegExp(QS(t),"g"),r)}function eC(e,t){let r="",i=0,n=-1,o=0,l=-1;for(let h=0;h<=e.length;++h){if(h<e.length)l=e.charCodeAt(h);else{if(l===47)break;l=47}if(l===47){if(!(n===h-1||o===1))if(n!==h-1&&o===2){if(r.length<2||i!==2||r.charCodeAt(r.length-1)!==46||r.charCodeAt(r.length-2)!==46){if(r.length>2){const u=r.lastIndexOf("/");if(u!==r.length-1){u===-1?(r="",i=0):(r=r.slice(0,u),i=r.length-1-r.lastIndexOf("/")),n=h,o=0;continue}}else if(r.length===2||r.length===1){r="",i=0,n=h,o=0;continue}}}else r.length>0?r+=`/${e.slice(n+1,h)}`:r=e.slice(n+1,h),i=h-n-1;n=h,o=0}else l===46&&o!==-1?++o:o=-1}return r}const ve={toPosix(e){return tC(e,"\\","/")},isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl(e){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(e)},hasProtocol(e){return/^[^/:]+:\//.test(this.toPosix(e))},getProtocol(e){nr(e),e=this.toPosix(e);let t="";const r=/^file:\/\/\//.exec(e),i=/^[^/:]+:\/\//.exec(e),n=/^[^/:]+:\//.exec(e);if(r||i||n){const o=(r==null?void 0:r[0])||(i==null?void 0:i[0])||(n==null?void 0:n[0]);t=o,e=e.slice(o.length)}return t},toAbsolute(e,t,r){if(this.isDataUrl(e))return e;const i=fs(this.toPosix(t??J.ADAPTER.getBaseUrl())),n=fs(this.toPosix(r??this.rootname(i)));return nr(e),e=this.toPosix(e),e.startsWith("/")?ve.join(n,e.slice(1)):this.isAbsolute(e)?e:this.join(i,e)},normalize(e){if(e=this.toPosix(e),nr(e),e.length===0)return".";let t="";const r=e.startsWith("/");this.hasProtocol(e)&&(t=this.rootname(e),e=e.slice(t.length));const i=e.endsWith("/");return e=eC(e),e.length>0&&i&&(e+="/"),r?`/${e}`:t+e},isAbsolute(e){return nr(e),e=this.toPosix(e),this.hasProtocol(e)?!0:e.startsWith("/")},join(...e){if(e.length===0)return".";let t;for(let r=0;r<e.length;++r){const i=e[r];if(nr(i),i.length>0)if(t===void 0)t=i;else{const n=e[r-1]??"";this.extname(n)?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(e){if(nr(e),e.length===0)return".";e=this.toPosix(e);let t=e.charCodeAt(0);const r=t===47;let i=-1,n=!0;const o=this.getProtocol(e),l=e;e=e.slice(o.length);for(let h=e.length-1;h>=1;--h)if(t=e.charCodeAt(h),t===47){if(!n){i=h;break}}else n=!1;return i===-1?r?"/":this.isUrl(l)?o+e:o:r&&i===1?"//":o+e.slice(0,i)},rootname(e){nr(e),e=this.toPosix(e);let t="";if(e.startsWith("/")?t="/":t=this.getProtocol(e),this.isUrl(e)){const r=e.indexOf("/",t.length);r!==-1?t=e.slice(0,r):t=e,t.endsWith("/")||(t+="/")}return t},basename(e,t){nr(e),t&&nr(t),e=fs(this.toPosix(e));let r=0,i=-1,n=!0,o;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let l=t.length-1,h=-1;for(o=e.length-1;o>=0;--o){const u=e.charCodeAt(o);if(u===47){if(!n){r=o+1;break}}else h===-1&&(n=!1,h=o+1),l>=0&&(u===t.charCodeAt(l)?--l===-1&&(i=o):(l=-1,i=h))}return r===i?i=h:i===-1&&(i=e.length),e.slice(r,i)}for(o=e.length-1;o>=0;--o)if(e.charCodeAt(o)===47){if(!n){r=o+1;break}}else i===-1&&(n=!1,i=o+1);return i===-1?"":e.slice(r,i)},extname(e){nr(e),e=fs(this.toPosix(e));let t=-1,r=0,i=-1,n=!0,o=0;for(let l=e.length-1;l>=0;--l){const h=e.charCodeAt(l);if(h===47){if(!n){r=l+1;break}continue}i===-1&&(n=!1,i=l+1),h===46?t===-1?t=l:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||i===-1||o===0||o===1&&t===i-1&&t===r+1?"":e.slice(t,i)},parse(e){nr(e);const t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;e=fs(this.toPosix(e));let r=e.charCodeAt(0);const i=this.isAbsolute(e);let n;t.root=this.rootname(e),i||this.hasProtocol(e)?n=1:n=0;let o=-1,l=0,h=-1,u=!0,f=e.length-1,d=0;for(;f>=n;--f){if(r=e.charCodeAt(f),r===47){if(!u){l=f+1;break}continue}h===-1&&(u=!1,h=f+1),r===46?o===-1?o=f:d!==1&&(d=1):o!==-1&&(d=-1)}return o===-1||h===-1||d===0||d===1&&o===h-1&&o===l+1?h!==-1&&(l===0&&i?t.base=t.name=e.slice(1,h):t.base=t.name=e.slice(l,h)):(l===0&&i?(t.name=e.slice(1,o),t.base=e.slice(1,h)):(t.name=e.slice(l,o),t.base=e.slice(l,h)),t.ext=e.slice(o,h)),t.dir=this.dirname(e),t},sep:"/",delimiter:":"},Hp={};function Ct(e,t,r=3){if(Hp[t])return;let i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`):(i=i.split(`
`).splice(r).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${e}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`),console.warn(i))),Hp[t]=!0}let Mh;function rC(){return typeof Mh>"u"&&(Mh=function(){var r;const t={stencil:!0,failIfMajorPerformanceCaveat:J.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!J.ADAPTER.getWebGLRenderingContext())return!1;const i=J.ADAPTER.createCanvas();let n=i.getContext("webgl",t)||i.getContext("experimental-webgl",t);const o=!!((r=n==null?void 0:n.getContextAttributes())!=null&&r.stencil);if(n){const l=n.getExtension("WEBGL_lose_context");l&&l.loseContext()}return n=null,o}catch{return!1}}()),Mh}var iC="#f0f8ff",nC="#faebd7",sC="#00ffff",oC="#7fffd4",aC="#f0ffff",lC="#f5f5dc",hC="#ffe4c4",uC="#000000",cC="#ffebcd",fC="#0000ff",dC="#8a2be2",pC="#a52a2a",gC="#deb887",mC="#5f9ea0",vC="#7fff00",_C="#d2691e",yC="#ff7f50",xC="#6495ed",bC="#fff8dc",wC="#dc143c",EC="#00ffff",TC="#00008b",AC="#008b8b",SC="#b8860b",CC="#a9a9a9",IC="#006400",RC="#a9a9a9",PC="#bdb76b",MC="#8b008b",DC="#556b2f",BC="#ff8c00",OC="#9932cc",FC="#8b0000",LC="#e9967a",NC="#8fbc8f",kC="#483d8b",UC="#2f4f4f",GC="#2f4f4f",WC="#00ced1",$C="#9400d3",HC="#ff1493",XC="#00bfff",zC="#696969",VC="#696969",YC="#1e90ff",jC="#b22222",qC="#fffaf0",KC="#228b22",ZC="#ff00ff",JC="#dcdcdc",QC="#f8f8ff",tI="#daa520",eI="#ffd700",rI="#808080",iI="#008000",nI="#adff2f",sI="#808080",oI="#f0fff0",aI="#ff69b4",lI="#cd5c5c",hI="#4b0082",uI="#fffff0",cI="#f0e68c",fI="#fff0f5",dI="#e6e6fa",pI="#7cfc00",gI="#fffacd",mI="#add8e6",vI="#f08080",_I="#e0ffff",yI="#fafad2",xI="#d3d3d3",bI="#90ee90",wI="#d3d3d3",EI="#ffb6c1",TI="#ffa07a",AI="#20b2aa",SI="#87cefa",CI="#778899",II="#778899",RI="#b0c4de",PI="#ffffe0",MI="#00ff00",DI="#32cd32",BI="#faf0e6",OI="#ff00ff",FI="#800000",LI="#66cdaa",NI="#0000cd",kI="#ba55d3",UI="#9370db",GI="#3cb371",WI="#7b68ee",$I="#00fa9a",HI="#48d1cc",XI="#c71585",zI="#191970",VI="#f5fffa",YI="#ffe4e1",jI="#ffe4b5",qI="#ffdead",KI="#000080",ZI="#fdf5e6",JI="#808000",QI="#6b8e23",tR="#ffa500",eR="#ff4500",rR="#da70d6",iR="#eee8aa",nR="#98fb98",sR="#afeeee",oR="#db7093",aR="#ffefd5",lR="#ffdab9",hR="#cd853f",uR="#ffc0cb",cR="#dda0dd",fR="#b0e0e6",dR="#800080",pR="#663399",gR="#ff0000",mR="#bc8f8f",vR="#4169e1",_R="#8b4513",yR="#fa8072",xR="#f4a460",bR="#2e8b57",wR="#fff5ee",ER="#a0522d",TR="#c0c0c0",AR="#87ceeb",SR="#6a5acd",CR="#708090",IR="#708090",RR="#fffafa",PR="#00ff7f",MR="#4682b4",DR="#d2b48c",BR="#008080",OR="#d8bfd8",FR="#ff6347",LR="#40e0d0",NR="#ee82ee",kR="#f5deb3",UR="#ffffff",GR="#f5f5f5",WR="#ffff00",$R="#9acd32",HR={aliceblue:iC,antiquewhite:nC,aqua:sC,aquamarine:oC,azure:aC,beige:lC,bisque:hC,black:uC,blanchedalmond:cC,blue:fC,blueviolet:dC,brown:pC,burlywood:gC,cadetblue:mC,chartreuse:vC,chocolate:_C,coral:yC,cornflowerblue:xC,cornsilk:bC,crimson:wC,cyan:EC,darkblue:TC,darkcyan:AC,darkgoldenrod:SC,darkgray:CC,darkgreen:IC,darkgrey:RC,darkkhaki:PC,darkmagenta:MC,darkolivegreen:DC,darkorange:BC,darkorchid:OC,darkred:FC,darksalmon:LC,darkseagreen:NC,darkslateblue:kC,darkslategray:UC,darkslategrey:GC,darkturquoise:WC,darkviolet:$C,deeppink:HC,deepskyblue:XC,dimgray:zC,dimgrey:VC,dodgerblue:YC,firebrick:jC,floralwhite:qC,forestgreen:KC,fuchsia:ZC,gainsboro:JC,ghostwhite:QC,goldenrod:tI,gold:eI,gray:rI,green:iI,greenyellow:nI,grey:sI,honeydew:oI,hotpink:aI,indianred:lI,indigo:hI,ivory:uI,khaki:cI,lavenderblush:fI,lavender:dI,lawngreen:pI,lemonchiffon:gI,lightblue:mI,lightcoral:vI,lightcyan:_I,lightgoldenrodyellow:yI,lightgray:xI,lightgreen:bI,lightgrey:wI,lightpink:EI,lightsalmon:TI,lightseagreen:AI,lightskyblue:SI,lightslategray:CI,lightslategrey:II,lightsteelblue:RI,lightyellow:PI,lime:MI,limegreen:DI,linen:BI,magenta:OI,maroon:FI,mediumaquamarine:LI,mediumblue:NI,mediumorchid:kI,mediumpurple:UI,mediumseagreen:GI,mediumslateblue:WI,mediumspringgreen:$I,mediumturquoise:HI,mediumvioletred:XI,midnightblue:zI,mintcream:VI,mistyrose:YI,moccasin:jI,navajowhite:qI,navy:KI,oldlace:ZI,olive:JI,olivedrab:QI,orange:tR,orangered:eR,orchid:rR,palegoldenrod:iR,palegreen:nR,paleturquoise:sR,palevioletred:oR,papayawhip:aR,peachpuff:lR,peru:hR,pink:uR,plum:cR,powderblue:fR,purple:dR,rebeccapurple:pR,red:gR,rosybrown:mR,royalblue:vR,saddlebrown:_R,salmon:yR,sandybrown:xR,seagreen:bR,seashell:wR,sienna:ER,silver:TR,skyblue:AR,slateblue:SR,slategray:CR,slategrey:IR,snow:RR,springgreen:PR,steelblue:MR,tan:DR,teal:BR,thistle:OR,tomato:FR,turquoise:LR,violet:NR,wheat:kR,white:UR,whitesmoke:GR,yellow:WR,yellowgreen:$R};function Rs(e,t=[]){return t[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(e&255)/255,t}function ym(e){let t=e.toString(16);return t="000000".substring(0,6-t.length)+t,`#${t}`}function hc(e){if(typeof e=="string"&&(e=HR[e.toLowerCase()]||e,e[0]==="#"&&(e=e.slice(1)),e.length===3)){const[t,r,i]=e;e=t+t+r+r+i+i}return parseInt(e,16)}function XR(){const e=[],t=[];for(let i=0;i<32;i++)e[i]=i,t[i]=i;e[ut.NORMAL_NPM]=ut.NORMAL,e[ut.ADD_NPM]=ut.ADD,e[ut.SCREEN_NPM]=ut.SCREEN,t[ut.NORMAL]=ut.NORMAL_NPM,t[ut.ADD]=ut.ADD_NPM,t[ut.SCREEN]=ut.SCREEN_NPM;const r=[];return r.push(t),r.push(e),r}const xm=XR();function bm(e,t){return xm[t?1:0][e]}function zR(e,t,r,i){return r=r||new Float32Array(4),i||i===void 0?(r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t):(r[0]=e[0],r[1]=e[1],r[2]=e[2]),r[3]=t,r}function uc(e,t){if(t===1)return(t*255<<24)+e;if(t===0)return 0;let r=e>>16&255,i=e>>8&255,n=e&255;return r=r*t+.5|0,i=i*t+.5|0,n=n*t+.5|0,(t*255<<24)+(r<<16)+(i<<8)+n}function wm(e,t,r,i){return r=r||new Float32Array(4),r[0]=(e>>16&255)/255,r[1]=(e>>8&255)/255,r[2]=(e&255)/255,(i||i===void 0)&&(r[0]*=t,r[1]*=t,r[2]*=t),r[3]=t,r}function VR(e,t=null){const r=e*6;if(t=t||new Uint16Array(r),t.length!==r)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${r}`);for(let i=0,n=0;i<r;i+=6,n+=4)t[i+0]=n+0,t[i+1]=n+1,t[i+2]=n+2,t[i+3]=n+0,t[i+4]=n+2,t[i+5]=n+3;return t}function Em(e){if(e.BYTES_PER_ELEMENT===4)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(e.BYTES_PER_ELEMENT===2){if(e instanceof Uint16Array)return"Uint16Array"}else if(e.BYTES_PER_ELEMENT===1&&e instanceof Uint8Array)return"Uint8Array";return null}function wa(e){return e+=e===0?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e+1}function Xp(e){return!(e&e-1)&&!!e}function zp(e){let t=(e>65535?1:0)<<4;e>>>=t;let r=(e>255?1:0)<<3;return e>>>=r,t|=r,r=(e>15?1:0)<<2,e>>>=r,t|=r,r=(e>3?1:0)<<1,e>>>=r,t|=r,t|e>>1}function In(e,t,r){const i=e.length;let n;if(t>=i||r===0)return;r=t+r>i?i-t:r;const o=i-r;for(n=t;n<o;++n)e[n]=e[n+r];e.length=o}function bn(e){return e===0?0:e<0?-1:1}let YR=0;function Xi(){return++YR}const Tm=class{constructor(e,t,r,i){this.left=e,this.top=t,this.right=r,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let Au=Tm;Au.EMPTY=new Tm(0,0,0,0);const Vp={},Er=Object.create(null),si=Object.create(null);class Yp{constructor(t,r,i){this._canvas=J.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||J.RESOLUTION,this.resize(t,r)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,r){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(r*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function jp(e,t,r){for(let i=0,n=4*r*t;i<t;++i,n+=4)if(e[n+3]!==0)return!1;return!0}function qp(e,t,r,i,n){const o=4*t;for(let l=i,h=i*o+4*r;l<=n;++l,h+=o)if(e[h+3]!==0)return!1;return!0}function jR(e){const{width:t,height:r}=e,i=e.getContext("2d",{willReadFrequently:!0});if(i===null)throw new TypeError("Failed to get canvas 2D context");const o=i.getImageData(0,0,t,r).data;let l=0,h=0,u=t-1,f=r-1;for(;h<r&&jp(o,t,h);)++h;if(h===r)return Au.EMPTY;for(;jp(o,t,f);)--f;for(;qp(o,t,l,h,f);)++l;for(;qp(o,t,u,h,f);)--u;return++u,++f,new Au(l,h,u,f)}function qR(e){const t=jR(e),{width:r,height:i}=t;let n=null;if(!t.isEmpty()){const o=e.getContext("2d");if(o===null)throw new TypeError("Failed to get canvas 2D context");n=o.getImageData(t.left,t.top,r,i)}return{width:r,height:i,data:n}}let No;function KR(e,t=globalThis.location){if(e.startsWith("data:"))return"";t=t||globalThis.location,No||(No=document.createElement("a")),No.href=e;const r=JS.parse(No.href),i=!r.port&&t.port===""||r.port===t.port;return r.hostname!==t.hostname||!i||r.protocol!==t.protocol?"anonymous":""}function fi(e,t=1){var i;const r=(i=J.RETINA_PREFIX)==null?void 0:i.exec(e);return r?parseFloat(r[1]):t}var Z=(e=>(e.Renderer="renderer",e.Application="application",e.RendererSystem="renderer-webgl-system",e.RendererPlugin="renderer-webgl-plugin",e.CanvasRendererSystem="renderer-canvas-system",e.CanvasRendererPlugin="renderer-canvas-plugin",e.Asset="asset",e.LoadParser="load-parser",e.ResolveParser="resolve-parser",e.CacheParser="cache-parser",e.DetectionParser="detection-parser",e))(Z||{});const Su=e=>{if(typeof e=="function"||typeof e=="object"&&e.extension){if(!e.extension)throw new Error("Extension class must have an extension object");e={...typeof e.extension!="object"?{type:e.extension}:e.extension,ref:e}}if(typeof e=="object")e={...e};else throw new Error("Invalid extension type");return typeof e.type=="string"&&(e.type=[e.type]),e},Kp=(e,t)=>Su(e).priority??t,nt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...e){return e.map(Su).forEach(t=>{t.type.forEach(r=>{var i,n;return(n=(i=this._removeHandlers)[r])==null?void 0:n.call(i,t)})}),this},add(...e){return e.map(Su).forEach(t=>{t.type.forEach(r=>{const i=this._addHandlers,n=this._queue;i[r]?i[r](t):(n[r]=n[r]||[],n[r].push(t))})}),this},handle(e,t,r){const i=this._addHandlers,n=this._removeHandlers;if(i[e]||n[e])throw new Error(`Extension type ${e} already has a handler`);i[e]=t,n[e]=r;const o=this._queue;return o[e]&&(o[e].forEach(l=>t(l)),delete o[e]),this},handleByMap(e,t){return this.handle(e,r=>{t[r.name]=r.ref},r=>{delete t[r.name]})},handleByList(e,t,r=-1){return this.handle(e,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((n,o)=>Kp(o,r)-Kp(n,r)))},i=>{const n=t.indexOf(i.ref);n!==-1&&t.splice(n,1)})}};class Cu{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const ZR=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function JR(e){let t="";for(let r=0;r<e;++r)r>0&&(t+=`
else `),r<e-1&&(t+=`if(test == ${r}.0){}`);return t}function QR(e,t){if(e===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const r=t.createShader(t.FRAGMENT_SHADER);for(;;){const i=ZR.replace(/%forloop%/gi,JR(e));if(t.shaderSource(r,i),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))e=e/2|0;else break}return e}const Dh=0,Bh=1,Oh=2,Fh=3,Lh=4,Nh=5;class qr{constructor(){this.data=0,this.blendMode=ut.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Dh)}set blend(t){!!(this.data&1<<Dh)!==t&&(this.data^=1<<Dh)}get offsets(){return!!(this.data&1<<Bh)}set offsets(t){!!(this.data&1<<Bh)!==t&&(this.data^=1<<Bh)}get culling(){return!!(this.data&1<<Oh)}set culling(t){!!(this.data&1<<Oh)!==t&&(this.data^=1<<Oh)}get depthTest(){return!!(this.data&1<<Fh)}set depthTest(t){!!(this.data&1<<Fh)!==t&&(this.data^=1<<Fh)}get depthMask(){return!!(this.data&1<<Nh)}set depthMask(t){!!(this.data&1<<Nh)!==t&&(this.data^=1<<Nh)}get clockwiseFrontFace(){return!!(this.data&1<<Lh)}set clockwiseFrontFace(t){!!(this.data&1<<Lh)!==t&&(this.data^=1<<Lh)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==ut.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new qr;return t.depthTest=!1,t.blend=!0,t}}const Iu=[];function Am(e,t){if(!e)return null;let r="";if(typeof e=="string"){const i=/\.(\w{3,4})(?:$|\?|#)/i.exec(e);i&&(r=i[1].toLowerCase())}for(let i=Iu.length-1;i>=0;--i){const n=Iu[i];if(n.test&&n.test(e,r))return new n(e,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class pr{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,r,i,n,o,l,h,u){if(arguments.length>8)throw new Error("max arguments reached");const{name:f,items:d}=this;this._aliasCount++;for(let g=0,m=d.length;g<m;g++)d[g][f](t,r,i,n,o,l,h,u);return d===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const r=this.items.indexOf(t);return r!==-1&&(this.ensureNonAliasedItems(),this.items.splice(r,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(pr.prototype,{dispatch:{value:pr.prototype.emit},run:{value:pr.prototype.emit}});class Ps{constructor(t=0,r=0){this._width=t,this._height=r,this.destroyed=!1,this.internal=!1,this.onResize=new pr("setRealSize"),this.onUpdate=new pr("update"),this.onError=new pr("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,r){(t!==this._width||r!==this._height)&&(this._width=t,this._height=r,this.onResize.emit(t,r))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,r,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,r){return!1}}class Ns extends Ps{constructor(t,r){const{width:i,height:n}=r||{};if(!i||!n)throw new Error("BufferResource width or height invalid");super(i,n),this.data=t}upload(t,r,i){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===mr.UNPACK);const o=r.realWidth,l=r.realHeight;return i.width===o&&i.height===l?n.texSubImage2D(r.target,0,0,0,o,l,r.format,i.type,this.data):(i.width=o,i.height=l,n.texImage2D(r.target,0,i.internalFormat,o,l,0,r.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const tP={scaleMode:zr.NEAREST,format:V.RGBA,alphaMode:mr.NPM},vn=class extends Os{constructor(e=null,t=null){super(),t=Object.assign({},vn.defaultOptions,t);const{alphaMode:r,mipmap:i,anisotropicLevel:n,scaleMode:o,width:l,height:h,wrapMode:u,format:f,type:d,target:g,resolution:m,resourceOptions:v}=t;e&&!(e instanceof Ps)&&(e=Am(e,v),e.internal=!0),this.resolution=m||J.RESOLUTION,this.width=Math.round((l||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=i,this.anisotropicLevel=n,this._wrapMode=u,this._scaleMode=o,this.format=f,this.type=d,this.target=g,this.alphaMode=r,this.uid=Xi(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=l>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let r;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,r=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,r=!0),r&&this.dirtyStyleId++,this}setSize(e,t,r){return r=r||this.resolution,this.setRealSize(e*r,t*r,r)}setRealSize(e,t,r){return this.resolution=r||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Xp(this.realWidth)&&Xp(this.realHeight)}setResolution(e){const t=this.resolution;return t===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT(),this)}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete si[this.cacheId],delete Er[this.cacheId],this.cacheId=null),this.dispose(),vn.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,t,r=J.STRICT_TEXTURE_CACHE){const i=typeof e=="string";let n=null;if(i)n=e;else{if(!e._pixiId){const l=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${l}_${Xi()}`}n=e._pixiId}let o=si[n];if(i&&r&&!o)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return o||(o=new vn(e,t),o.cacheId=n,vn.addToCache(o,n)),o}static fromBuffer(e,t,r,i){e=e||new Float32Array(t*r*4);const n=new Ns(e,{width:t,height:r}),o=e instanceof Float32Array?st.FLOAT:st.UNSIGNED_BYTE;return new vn(n,Object.assign({},tP,i||{width:t,height:r,type:o}))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),si[t]&&si[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),si[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=si[e];if(t){const r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete si[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete si[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};let pt=vn;pt.defaultOptions={mipmap:Dr.POW2,anisotropicLevel:0,scaleMode:zr.LINEAR,wrapMode:ci.CLAMP,alphaMode:mr.UNPACK,target:An.TEXTURE_2D,format:V.RGBA,type:st.UNSIGNED_BYTE};pt._globalBatch=0;class Ru{constructor(){this.texArray=null,this.blend=0,this.type=Rr.TRIANGLES,this.start=0,this.size=0,this.data=null}}let eP=0;class re{constructor(t,r=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=r,this.id=eP++,this.disposeRunner=new pr("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Pr.ELEMENT_ARRAY_BUFFER:Pr.ARRAY_BUFFER}get index(){return this.type===Pr.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new re(t)}}class Ea{constructor(t,r=0,i=!1,n=st.FLOAT,o,l,h,u=1){this.buffer=t,this.size=r,this.normalized=i,this.type=n,this.stride=o,this.start=l,this.instance=h,this.divisor=u}destroy(){this.buffer=null}static from(t,r,i,n,o){return new Ea(t,r,i,n,o)}}const rP={Float32Array,Uint32Array,Int32Array,Uint8Array};function iP(e,t){let r=0,i=0;const n={};for(let u=0;u<e.length;u++)i+=t[u],r+=e[u].length;const o=new ArrayBuffer(r*4);let l=null,h=0;for(let u=0;u<e.length;u++){const f=t[u],d=e[u],g=Em(d);n[g]||(n[g]=new rP[g](o)),l=n[g];for(let m=0;m<d.length;m++){const v=(m/f|0)*i+h,y=m%f;l[v+y]=d[m]}h+=f}return new Float32Array(o)}const Zp={5126:4,5123:2,5121:1};let nP=0;const sP={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class di{constructor(t=[],r={}){this.buffers=t,this.indexBuffer=null,this.attributes=r,this.glVertexArrayObjects={},this.id=nP++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new pr("disposeGeometry"),this.refCount=0}addAttribute(t,r,i=0,n=!1,o,l,h,u=!1){if(!r)throw new Error("You must pass a buffer when creating an attribute");r instanceof re||(r instanceof Array&&(r=new Float32Array(r)),r=new re(r));const f=t.split("|");if(f.length>1){for(let g=0;g<f.length;g++)this.addAttribute(f[g],r,i,n,o);return this}let d=this.buffers.indexOf(r);return d===-1&&(this.buffers.push(r),d=this.buffers.length-1),this.attributes[t]=new Ea(d,i,n,o,l,h,u),this.instanced=this.instanced||u,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof re||(t instanceof Array&&(t=new Uint16Array(t)),t=new re(t)),t.type=Pr.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],r=[],i=new re;let n;for(n in this.attributes){const o=this.attributes[n],l=this.buffers[o.buffer];t.push(l.data),r.push(o.size*Zp[o.type]/4),o.buffer=0}for(i.data=iP(t,r),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const r=this.attributes[t];return this.buffers[r.buffer].data.length/(r.stride/4||r.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new di;for(let r=0;r<this.buffers.length;r++)t.buffers[r]=new re(this.buffers[r].data.slice(0));for(const r in this.attributes){const i=this.attributes[r];t.attributes[r]=new Ea(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Pr.ELEMENT_ARRAY_BUFFER),t}static merge(t){const r=new di,i=[],n=[],o=[];let l;for(let h=0;h<t.length;h++){l=t[h];for(let u=0;u<l.buffers.length;u++)n[u]=n[u]||0,n[u]+=l.buffers[u].data.length,o[u]=0}for(let h=0;h<l.buffers.length;h++)i[h]=new sP[Em(l.buffers[h].data)](n[h]),r.buffers[h]=new re(i[h]);for(let h=0;h<t.length;h++){l=t[h];for(let u=0;u<l.buffers.length;u++)i[u].set(l.buffers[u].data,o[u]),o[u]+=l.buffers[u].data.length}if(r.attributes=l.attributes,l.indexBuffer){r.indexBuffer=r.buffers[l.buffers.indexOf(l.indexBuffer)],r.indexBuffer.type=Pr.ELEMENT_ARRAY_BUFFER;let h=0,u=0,f=0,d=0;for(let g=0;g<l.buffers.length;g++)if(l.buffers[g]!==l.indexBuffer){d=g;break}for(const g in l.attributes){const m=l.attributes[g];(m.buffer|0)===d&&(u+=m.size*Zp[m.type]/4)}for(let g=0;g<t.length;g++){const m=t[g].indexBuffer.data;for(let v=0;v<m.length;v++)r.indexBuffer.data[v+f]+=h;h+=t[g].buffers[d].data.length/u,f+=m.length}}return r}}class Sm extends di{constructor(t=!1){super(),this._buffer=new re(null,t,!1),this._indexBuffer=new re(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,st.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,st.FLOAT).addAttribute("aColor",this._buffer,4,!0,st.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,st.FLOAT).addIndex(this._indexBuffer)}}const Ta=Math.PI*2,oP=180/Math.PI,aP=Math.PI/180;var me=(e=>(e[e.POLY=0]="POLY",e[e.RECT=1]="RECT",e[e.CIRC=2]="CIRC",e[e.ELIP=3]="ELIP",e[e.RREC=4]="RREC",e))(me||{});class St{constructor(t=0,r=0){this.x=0,this.y=0,this.x=t,this.y=r}clone(){return new St(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,r=t){return this.x=t,this.y=r,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const ko=[new St,new St,new St,new St];class Tt{constructor(t=0,r=0,i=0,n=0){this.x=Number(t),this.y=Number(r),this.width=Number(i),this.height=Number(n),this.type=me.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Tt(0,0,0,0)}clone(){return new Tt(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,r){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&r>=this.y&&r<this.y+this.height}intersects(t,r){if(!r){const F=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=F)return!1;const j=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>j}const i=this.left,n=this.right,o=this.top,l=this.bottom;if(n<=i||l<=o)return!1;const h=ko[0].set(t.left,t.top),u=ko[1].set(t.left,t.bottom),f=ko[2].set(t.right,t.top),d=ko[3].set(t.right,t.bottom);if(f.x<=h.x||u.y<=h.y)return!1;const g=Math.sign(r.a*r.d-r.b*r.c);if(g===0||(r.apply(h,h),r.apply(u,u),r.apply(f,f),r.apply(d,d),Math.max(h.x,u.x,f.x,d.x)<=i||Math.min(h.x,u.x,f.x,d.x)>=n||Math.max(h.y,u.y,f.y,d.y)<=o||Math.min(h.y,u.y,f.y,d.y)>=l))return!1;const m=g*(u.y-h.y),v=g*(h.x-u.x),y=m*i+v*o,w=m*n+v*o,x=m*i+v*l,A=m*n+v*l;if(Math.max(y,w,x,A)<=m*h.x+v*h.y||Math.min(y,w,x,A)>=m*d.x+v*d.y)return!1;const S=g*(h.y-f.y),E=g*(f.x-h.x),I=S*i+E*o,D=S*n+E*o,L=S*i+E*l,O=S*n+E*l;return!(Math.max(I,D,L,O)<=S*h.x+E*h.y||Math.min(I,D,L,O)>=S*d.x+E*d.y)}pad(t=0,r=t){return this.x-=t,this.y-=r,this.width+=t*2,this.height+=r*2,this}fit(t){const r=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),o=Math.min(this.y+this.height,t.y+t.height);return this.x=r,this.width=Math.max(i-r,0),this.y=n,this.height=Math.max(o-n,0),this}ceil(t=1,r=.001){const i=Math.ceil((this.x+this.width-r)*t)/t,n=Math.ceil((this.y+this.height-r)*t)/t;return this.x=Math.floor((this.x+r)*t)/t,this.y=Math.floor((this.y+r)*t)/t,this.width=i-this.x,this.height=n-this.y,this}enlarge(t){const r=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),o=Math.max(this.y+this.height,t.y+t.height);return this.x=r,this.width=i-r,this.y=n,this.height=o-n,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class cc{constructor(t=0,r=0,i=0){this.x=t,this.y=r,this.radius=i,this.type=me.CIRC}clone(){return new cc(this.x,this.y,this.radius)}contains(t,r){if(this.radius<=0)return!1;const i=this.radius*this.radius;let n=this.x-t,o=this.y-r;return n*=n,o*=o,n+o<=i}getBounds(){return new Tt(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class fc{constructor(t=0,r=0,i=0,n=0){this.x=t,this.y=r,this.width=i,this.height=n,this.type=me.ELIP}clone(){return new fc(this.x,this.y,this.width,this.height)}contains(t,r){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,n=(r-this.y)/this.height;return i*=i,n*=n,i+n<=1}getBounds(){return new Tt(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Rn{constructor(...t){let r=Array.isArray(t[0])?t[0]:t;if(typeof r[0]!="number"){const i=[];for(let n=0,o=r.length;n<o;n++)i.push(r[n].x,r[n].y);r=i}this.points=r,this.type=me.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),r=new Rn(t);return r.closeStroke=this.closeStroke,r}contains(t,r){let i=!1;const n=this.points.length/2;for(let o=0,l=n-1;o<n;l=o++){const h=this.points[o*2],u=this.points[o*2+1],f=this.points[l*2],d=this.points[l*2+1];u>r!=d>r&&t<(f-h)*((r-u)/(d-u))+h&&(i=!i)}return i}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((t,r)=>`${t}, ${r}`,"")}]`}}class dc{constructor(t=0,r=0,i=0,n=0,o=20){this.x=t,this.y=r,this.width=i,this.height=n,this.radius=o,this.type=me.RREC}clone(){return new dc(this.x,this.y,this.width,this.height,this.radius)}contains(t,r){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&r>=this.y&&r<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(r>=this.y+i&&r<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let n=t-(this.x+i),o=r-(this.y+i);const l=i*i;if(n*n+o*o<=l||(n=t-(this.x+this.width-i),n*n+o*o<=l)||(o=r-(this.y+this.height-i),n*n+o*o<=l)||(n=t-(this.x+i),n*n+o*o<=l))return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class $t{constructor(t=1,r=0,i=0,n=1,o=0,l=0){this.array=null,this.a=t,this.b=r,this.c=i,this.d=n,this.tx=o,this.ty=l}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,r,i,n,o,l){return this.a=t,this.b=r,this.c=i,this.d=n,this.tx=o,this.ty=l,this}toArray(t,r){this.array||(this.array=new Float32Array(9));const i=r||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,r){r=r||new St;const i=t.x,n=t.y;return r.x=this.a*i+this.c*n+this.tx,r.y=this.b*i+this.d*n+this.ty,r}applyInverse(t,r){r=r||new St;const i=1/(this.a*this.d+this.c*-this.b),n=t.x,o=t.y;return r.x=this.d*i*n+-this.c*i*o+(this.ty*this.c-this.tx*this.d)*i,r.y=this.a*i*o+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,r}translate(t,r){return this.tx+=t,this.ty+=r,this}scale(t,r){return this.a*=t,this.d*=r,this.c*=t,this.b*=r,this.tx*=t,this.ty*=r,this}rotate(t){const r=Math.cos(t),i=Math.sin(t),n=this.a,o=this.c,l=this.tx;return this.a=n*r-this.b*i,this.b=n*i+this.b*r,this.c=o*r-this.d*i,this.d=o*i+this.d*r,this.tx=l*r-this.ty*i,this.ty=l*i+this.ty*r,this}append(t){const r=this.a,i=this.b,n=this.c,o=this.d;return this.a=t.a*r+t.b*n,this.b=t.a*i+t.b*o,this.c=t.c*r+t.d*n,this.d=t.c*i+t.d*o,this.tx=t.tx*r+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*o+this.ty,this}setTransform(t,r,i,n,o,l,h,u,f){return this.a=Math.cos(h+f)*o,this.b=Math.sin(h+f)*o,this.c=-Math.sin(h-u)*l,this.d=Math.cos(h-u)*l,this.tx=t-(i*this.a+n*this.c),this.ty=r-(i*this.b+n*this.d),this}prepend(t){const r=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const i=this.a,n=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=r*t.a+this.ty*t.c+t.tx,this.ty=r*t.b+this.ty*t.d+t.ty,this}decompose(t){const r=this.a,i=this.b,n=this.c,o=this.d,l=t.pivot,h=-Math.atan2(-n,o),u=Math.atan2(i,r),f=Math.abs(h+u);return f<1e-5||Math.abs(Ta-f)<1e-5?(t.rotation=u,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=h,t.skew.y=u),t.scale.x=Math.sqrt(r*r+i*i),t.scale.y=Math.sqrt(n*n+o*o),t.position.x=this.tx+(l.x*r+l.y*n),t.position.y=this.ty+(l.x*i+l.y*o),t}invert(){const t=this.a,r=this.b,i=this.c,n=this.d,o=this.tx,l=t*n-r*i;return this.a=n/l,this.b=-r/l,this.c=-i/l,this.d=t/l,this.tx=(i*this.ty-n*o)/l,this.ty=-(t*this.ty-r*o)/l,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new $t;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new $t}static get TEMP_MATRIX(){return new $t}}const Pi=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Mi=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Di=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Bi=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Pu=[],Cm=[],Uo=Math.sign;function lP(){for(let e=0;e<16;e++){const t=[];Pu.push(t);for(let r=0;r<16;r++){const i=Uo(Pi[e]*Pi[r]+Di[e]*Mi[r]),n=Uo(Mi[e]*Pi[r]+Bi[e]*Mi[r]),o=Uo(Pi[e]*Di[r]+Di[e]*Bi[r]),l=Uo(Mi[e]*Di[r]+Bi[e]*Bi[r]);for(let h=0;h<16;h++)if(Pi[h]===i&&Mi[h]===n&&Di[h]===o&&Bi[h]===l){t.push(h);break}}}for(let e=0;e<16;e++){const t=new $t;t.set(Pi[e],Mi[e],Di[e],Bi[e],0,0),Cm.push(t)}}lP();const Xt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:e=>Pi[e],uY:e=>Mi[e],vX:e=>Di[e],vY:e=>Bi[e],inv:e=>e&8?e&15:-e&7,add:(e,t)=>Pu[e][t],sub:(e,t)=>Pu[e][Xt.inv(t)],rotate180:e=>e^4,isVertical:e=>(e&3)===2,byDirection:(e,t)=>Math.abs(e)*2<=Math.abs(t)?t>=0?Xt.S:Xt.N:Math.abs(t)*2<=Math.abs(e)?e>0?Xt.E:Xt.W:t>0?e>0?Xt.SE:Xt.SW:e>0?Xt.NE:Xt.NW,matrixAppendRotationInv:(e,t,r=0,i=0)=>{const n=Cm[Xt.inv(t)];n.tx=r,n.ty=i,e.append(n)}};class ui{constructor(t,r,i=0,n=0){this._x=i,this._y=n,this.cb=t,this.scope=r}clone(t=this.cb,r=this.scope){return new ui(t,r,this._x,this._y)}set(t=0,r=t){return(this._x!==t||this._y!==r)&&(this._x=t,this._y=r,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const Im=class{constructor(){this.worldTransform=new $t,this.localTransform=new $t,this.position=new ui(this.onChange,this,0,0),this.scale=new ui(this.onChange,this,1,1),this.pivot=new ui(this.onChange,this,0,0),this.skew=new ui(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(e){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){const r=e.worldTransform,i=this.worldTransform;i.a=t.a*r.a+t.b*r.c,i.b=t.a*r.b+t.b*r.d,i.c=t.c*r.a+t.d*r.c,i.d=t.c*r.b+t.d*r.d,i.tx=t.tx*r.a+t.ty*r.c+r.tx,i.ty=t.tx*r.b+t.ty*r.d+r.ty,this._parentID=e._worldID,this._worldID++}}setFromMatrix(e){e.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())}};let pc=Im;pc.IDENTITY=new Im;var hP=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,uP=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Jp(e,t,r){const i=e.createShader(t);return e.shaderSource(i,r),e.compileShader(i),i}function kh(e){const t=new Array(e);for(let r=0;r<t.length;r++)t[r]=!1;return t}function Rm(e,t){switch(e){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return kh(2*t);case"bvec3":return kh(3*t);case"bvec4":return kh(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Pn=[{test:e=>e.type==="float"&&e.size===1&&!e.isArray,code:e=>`
            if(uv["${e}"] !== ud["${e}"].value)
            {
                ud["${e}"].value = uv["${e}"]
                gl.uniform1f(ud["${e}"].location, uv["${e}"])
            }
            `},{test:(e,t)=>(e.type==="sampler2D"||e.type==="samplerCube"||e.type==="sampler2DArray")&&e.size===1&&!e.isArray&&(t==null||t.castToBaseTexture!==void 0),code:e=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${e}"], t);

            if(ud["${e}"].value !== t)
            {
                ud["${e}"].value = t;
                gl.uniform1i(ud["${e}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(e,t)=>e.type==="mat3"&&e.size===1&&!e.isArray&&t.a!==void 0,code:e=>`
            gl.uniformMatrix3fv(ud["${e}"].location, false, uv["${e}"].toArray(true));
            `,codeUbo:e=>`
                var ${e}_matrix = uv.${e}.toArray(true);

                data[offset] = ${e}_matrix[0];
                data[offset+1] = ${e}_matrix[1];
                data[offset+2] = ${e}_matrix[2];
        
                data[offset + 4] = ${e}_matrix[3];
                data[offset + 5] = ${e}_matrix[4];
                data[offset + 6] = ${e}_matrix[5];
        
                data[offset + 8] = ${e}_matrix[6];
                data[offset + 9] = ${e}_matrix[7];
                data[offset + 10] = ${e}_matrix[8];
            `},{test:(e,t)=>e.type==="vec2"&&e.size===1&&!e.isArray&&t.x!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${e}"].location, v.x, v.y);
                }`,codeUbo:e=>`
                v = uv.${e};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:e=>e.type==="vec2"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${e}"].location, v[0], v[1]);
                }
            `},{test:(e,t)=>e.type==="vec4"&&e.size===1&&!e.isArray&&t.width!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${e}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:e=>e.type==="vec4"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${e}"].location, v[0], v[1], v[2], v[3])
                }`}],cP={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},fP={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function dP(e,t){var i;const r=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const n in e.uniforms){const o=t[n];if(!o){(i=e.uniforms[n])!=null&&i.group&&(e.uniforms[n].ubo?r.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');
                    `):r.push(`
                        renderer.shader.syncUniformGroup(uv.${n}, syncData);
                    `));continue}const l=e.uniforms[n];let h=!1;for(let u=0;u<Pn.length;u++)if(Pn[u].test(o,l)){r.push(Pn[u].code(n,l)),h=!0;break}if(!h){const f=(o.size===1&&!o.isArray?cP:fP)[o.type].replace("location",`ud["${n}"].location`);r.push(`
            cu = ud["${n}"];
            cv = cu.value;
            v = uv["${n}"];
            ${f};`)}}return new Function("ud","uv","renderer","syncData",r.join(`
`))}const Pm={};let dn=Pm;function pP(){if(dn===Pm||dn!=null&&dn.isContextLost()){const e=J.ADAPTER.createCanvas();let t;J.PREFER_ENV>=Yi.WEBGL2&&(t=e.getContext("webgl2",{})),t||(t=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),dn=t}return dn}let Go;function gP(){if(!Go){Go=Ze.MEDIUM;const e=pP();e&&e.getShaderPrecisionFormat&&(Go=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision?Ze.HIGH:Ze.MEDIUM)}return Go}function Qp(e,t){const r=e.getShaderSource(t).split(`
`).map((f,d)=>`${d}: ${f}`),i=e.getShaderInfoLog(t),n=i.split(`
`),o={},l=n.map(f=>parseFloat(f.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(f=>f&&!o[f]?(o[f]=!0,!0):!1),h=[""];l.forEach(f=>{r[f-1]=`%c${r[f-1]}%c`,h.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const u=r.join(`
`);h[0]=u,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...h),console.groupEnd()}function mP(e,t,r,i){e.getProgramParameter(t,e.LINK_STATUS)||(e.getShaderParameter(r,e.COMPILE_STATUS)||Qp(e,r),e.getShaderParameter(i,e.COMPILE_STATUS)||Qp(e,i),console.error("PixiJS Error: Could not initialize shader."),e.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(t)))}const vP={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Mm(e){return vP[e]}let Wo=null;const tg={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Dm(e,t){if(!Wo){const r=Object.keys(tg);Wo={};for(let i=0;i<r.length;++i){const n=r[i];Wo[e[n]]=tg[n]}}return Wo[t]}function eg(e,t,r){if(e.substring(0,9)!=="precision"){let i=t;return t===Ze.HIGH&&r!==Ze.HIGH&&(i=Ze.MEDIUM),`precision ${i} float;
${e}`}else if(r!==Ze.HIGH&&e.substring(0,15)==="precision highp")return e.replace("precision highp","precision mediump");return e}let ds;function _P(){if(typeof ds=="boolean")return ds;try{ds=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{ds=!1}return ds}let yP=0;const $o={},_n=class{constructor(e,t,r="pixi-shader",i={}){this.extra={},this.id=yP++,this.vertexSrc=e||_n.defaultVertexSrc,this.fragmentSrc=t||_n.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=i,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),$o[r]?($o[r]++,r+=`-${$o[r]}`):$o[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=eg(this.vertexSrc,_n.defaultVertexPrecision,Ze.HIGH),this.fragmentSrc=eg(this.fragmentSrc,_n.defaultFragmentPrecision,gP())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return uP}static get defaultFragmentSrc(){return hP}static from(e,t,r){const i=e+t;let n=Vp[i];return n||(Vp[i]=n=new _n(e,t,r)),n}};let cr=_n;cr.defaultVertexPrecision=Ze.HIGH;cr.defaultFragmentPrecision=Vr.apple.device?Ze.HIGH:Ze.MEDIUM;let xP=0;class gr{constructor(t,r,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=xP++,this.static=!!r,this.ubo=!!i,t instanceof re?(this.buffer=t,this.buffer.type=Pr.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new re(new Float32Array(1)),this.buffer.type=Pr.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,r,i){if(!this.ubo)this.uniforms[t]=new gr(r,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,r,i){return new gr(t,r,i)}static uboFrom(t,r){return new gr(t,r??!0,!0)}}class Mr{constructor(t,r){this.uniformBindCount=0,this.program=t,r?r instanceof gr?this.uniformGroup=r:this.uniformGroup=new gr(r):this.uniformGroup=new gr({}),this.disposeRunner=new pr("disposeShader")}checkUniformExists(t,r){if(r.uniforms[t])return!0;for(const i in r.uniforms){const n=r.uniforms[i];if(n.group&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,r,i){const n=cr.from(t,r);return new Mr(n,i)}}class bP{constructor(t,r){if(this.vertexSrc=t,this.fragTemplate=r,this.programCache={},this.defaultGroupCache={},!r.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!r.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const i=new Int32Array(t);for(let o=0;o<t;o++)i[o]=o;this.defaultGroupCache[t]=gr.from({uSamplers:i},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${t}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new cr(this.vertexSrc,n)}const r={tint:new Float32Array([1,1,1,1]),translationMatrix:new $t,default:this.defaultGroupCache[t]};return new Mr(this.programCache[t],r)}generateSampleSrc(t){let r="";r+=`
`,r+=`
`;for(let i=0;i<t;i++)i>0&&(r+=`
else `),i<t-1&&(r+=`if(vTextureId < ${i}.5)`),r+=`
{`,r+=`
	color = texture2D(uSamplers[${i}], vTextureCoord);`,r+=`
}`;return r+=`
`,r+=`
`,r}}class Mu{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function wP(){return!Vr.apple.device}function EP(e){let t=!0;const r=J.ADAPTER.getNavigator();if(Vr.tablet||Vr.phone){if(Vr.apple.device){const i=r.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(t=!1)}if(Vr.android.device){const i=r.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(t=!1)}}return t?e:4}class Wa{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var TP=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,AP=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const or=class extends Wa{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=Sm,this.vertexSize=6,this.state=qr.for2d(),this.size=or.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??EP(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??wP(),this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return Ct("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return AP}static get defaultFragmentTemplate(){return TP}setShaderGenerator({vertex:e=or.defaultVertexSrc,fragment:t=or.defaultFragmentTemplate}={}){this.shaderGenerator=new bP(e,t)}contextChange(){const e=this.renderer.gl;J.PREFER_ENV===Yi.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),or.defaultMaxTextures),this.maxTextures=QR(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:t}=or,r=this.size/4,i=Math.floor(r/this.maxTextures)+1;for(;e.length<r;)e.push(new Ru);for(;t.length<i;)t.push(new Mu);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:t}=this,r=or._textureArrayPool,i=this.renderer.batch,n=this._tempBoundTextures,o=this.renderer.textureGC.count;let l=++pt._globalBatch,h=0,u=r[0],f=0;i.copyBoundTextures(n,t);for(let d=0;d<this._bufferSize;++d){const g=e[d];e[d]=null,g._batchEnabled!==l&&(u.count>=t&&(i.boundArray(u,n,l,t),this.buildDrawCalls(u,f,d),f=d,u=r[++h],++l),g._batchEnabled=l,g.touched=o,u.elements[u.count++]=g)}u.count>0&&(i.boundArray(u,n,l,t),this.buildDrawCalls(u,f,this._bufferSize),++h,++l);for(let d=0;d<n.length;d++)n[d]=null;pt._globalBatch=l}buildDrawCalls(e,t,r){const{_bufferedElements:i,_attributeBuffer:n,_indexBuffer:o,vertexSize:l}=this,h=or._drawCallPool;let u=this._dcIndex,f=this._aIndex,d=this._iIndex,g=h[u];g.start=this._iIndex,g.texArray=e;for(let m=t;m<r;++m){const v=i[m],y=v._texture.baseTexture,w=xm[y.alphaMode?1:0][v.blendMode];i[m]=null,t<m&&g.blend!==w&&(g.size=d-g.start,t=m,g=h[++u],g.texArray=e,g.start=d),this.packInterleavedGeometry(v,n,o,f,d),f+=v.vertexData.length/2*l,d+=v.indices.length,g.blend=w}t<r&&(g.size=d-g.start,++u),this._dcIndex=u,this._aIndex=f,this._iIndex=d}bindAndClearTexArray(e){const t=this.renderer.texture;for(let r=0;r<e.count;r++)t.bind(e.elements[r],e.ids[r]),e.elements[r]=null;e.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:t,_indexBuffer:r}=this;or.canUploadSameBuffer?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:t,state:r}=this.renderer,i=or._drawCallPool;let n=null;for(let o=0;o<e;o++){const{texArray:l,type:h,size:u,start:f,blend:d}=i[o];n!==l&&(n=l,this.bindAndClearTexArray(l)),this.state.blendMode=d,r.set(this.state),t.drawElements(h,u,t.UNSIGNED_SHORT,f*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),or.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=wa(Math.ceil(e/8)),r=zp(t),i=t*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._aBuffers[i];return n||(this._aBuffers[i]=n=new Cu(i*this.vertexSize*4)),n}getIndexBuffer(e){const t=wa(Math.ceil(e/12)),r=zp(t),i=t*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._iBuffers[r];return n||(this._iBuffers[r]=n=new Uint16Array(i)),n}packInterleavedGeometry(e,t,r,i,n){const{uint32View:o,float32View:l}=t,h=i/this.vertexSize,u=e.uvs,f=e.indices,d=e.vertexData,g=e._texture.baseTexture._batchLocation,m=Math.min(e.worldAlpha,1),v=m<1&&e._texture.baseTexture.alphaMode?uc(e._tintRGB,m):e._tintRGB+(m*255<<24);for(let y=0;y<d.length;y+=2)l[i++]=d[y],l[i++]=d[y+1],l[i++]=u[y],l[i++]=u[y+1],o[i++]=v,l[i++]=g;for(let y=0;y<f.length;y++)r[n++]=h+f[y]}};let hr=or;hr.defaultBatchSize=4096;hr.extension={name:"batch",type:Z.RendererPlugin};hr._drawCallPool=[];hr._textureArrayPool=[];nt.add(hr);var SP=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,CP=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const vs=class extends Mr{constructor(e,t,r){const i=cr.from(e||vs.defaultVertexSrc,t||vs.defaultFragmentSrc);super(i,r),this.padding=0,this.resolution=vs.defaultResolution,this.multisample=vs.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new qr}apply(e,t,r,i,n){e.applyFilter(this,t,r,i)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return CP}static get defaultFragmentSrc(){return SP}};let Ae=vs;Ae.defaultResolution=1;Ae.defaultMultisample=se.NONE;class Bm{constructor(){this.clearBeforeRender=!0,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,1],this._backgroundColorString="#000000",this.color=this._backgroundColor,this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender,t.color&&(this.color=typeof t.color=="string"?hc(t.color):t.color),this.alpha=t.alpha}get color(){return this._backgroundColor}set color(t){this._backgroundColor=t,this._backgroundColorString=ym(t),Rs(t,this._backgroundColorRgba)}get alpha(){return this._backgroundColorRgba[3]}set alpha(t){this._backgroundColorRgba[3]=t}get colorRgba(){return this._backgroundColorRgba}get colorString(){return this._backgroundColorString}destroy(){}}Bm.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"background"};nt.add(Bm);class Om{constructor(t){this.renderer=t,this.emptyRenderer=new Wa(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,r){const{boundTextures:i}=this.renderer.texture;for(let n=r-1;n>=0;--n)t[n]=i[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,r,i,n){const{elements:o,ids:l,count:h}=t;let u=0;for(let f=0;f<h;f++){const d=o[f],g=d._batchLocation;if(g>=0&&g<n&&r[g]===d){l[f]=g;continue}for(;u<n;){const m=r[u];if(m&&m._batchEnabled===i&&m._batchLocation===u){u++;continue}l[f]=u,d._batchLocation=u,r[u]=d;break}}}destroy(){this.renderer=null}}Om.extension={type:Z.RendererSystem,name:"batch"};nt.add(Om);let rg=0;class Fm{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=rg++}init(t){if(t.context)this.initFromContext(t.context);else{const r=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:r,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=rg++,this.renderer.runners.contextChange.emit(t);const r=this.renderer.view;r.addEventListener!==void 0&&(r.addEventListener("webglcontextlost",this.handleContextLost,!1),r.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const r=this.createContext(this.renderer.view,t);this.initFromContext(r)}createContext(t,r){let i;if(J.PREFER_ENV>=Yi.WEBGL2&&(i=t.getContext("webgl2",r)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",r)||t.getContext("experimental-webgl",r),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,r={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,r,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,r,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const r=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),r&&!r.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Fm.extension={type:Z.RendererSystem,name:"context"};nt.add(Fm);class IP extends Ns{upload(t,r,i){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===mr.UNPACK);const o=r.realWidth,l=r.realHeight;return i.width===o&&i.height===l?n.texSubImage2D(r.target,0,0,0,o,l,r.format,i.type,this.data):(i.width=o,i.height=l,n.texImage2D(r.target,0,i.internalFormat,o,l,0,r.format,i.type,this.data)),!0}}class Du{constructor(t,r){this.width=Math.round(t||100),this.height=Math.round(r||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new pr("disposeFramebuffer"),this.multisample=se.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,r){return this.colorTextures[t]=r||new pt(null,{scaleMode:zr.NEAREST,resolution:1,mipmap:Dr.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new pt(new IP(null,{width:this.width,height:this.height}),{scaleMode:zr.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Dr.OFF,format:V.DEPTH_COMPONENT,type:st.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,r){if(t=Math.round(t),r=Math.round(r),!(t===this.width&&r===this.height)){this.width=t,this.height=r,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const n=this.colorTextures[i],o=n.resolution;n.setSize(t/o,r/o)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,r/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Lm extends pt{constructor(t={}){if(typeof t=="number"){const r=arguments[0],i=arguments[1],n=arguments[2],o=arguments[3];t={width:r,height:i,scaleMode:n,resolution:o}}t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=se.NONE),super(null,t),this.mipmap=Dr.OFF,this.valid=!0,this.clearColor=[0,0,0,0],this.framebuffer=new Du(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}resize(t,r){this.framebuffer.resize(t*this.resolution,r*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class pi extends Ps{constructor(t){const r=t,i=r.naturalWidth||r.videoWidth||r.width,n=r.naturalHeight||r.videoHeight||r.height;super(i,n),this.source=t,this.noSubImage=!1}static crossOrigin(t,r,i){i===void 0&&!r.startsWith("data:")?t.crossOrigin=KR(r):i!==!1&&(t.crossOrigin=typeof i=="string"?i:"anonymous")}upload(t,r,i,n){const o=t.gl,l=r.realWidth,h=r.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||n.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1&&n.buffered.length===0)return!1;return o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===mr.UNPACK),!this.noSubImage&&r.target===o.TEXTURE_2D&&i.width===l&&i.height===h?o.texSubImage2D(o.TEXTURE_2D,0,0,0,r.format,i.type,n):(i.width=l,i.height=h,o.texImage2D(r.target,0,i.internalFormat,r.format,i.type,n)),!0}update(){if(this.destroyed)return;const t=this.source,r=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(r,i),super.update()}dispose(){this.source=null}}class Nm extends pi{constructor(t,r){if(r=r||{},typeof t=="string"){const i=new Image;pi.crossOrigin(i,t,r.crossorigin),i.src=t,t=i}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(r.createBitmap??J.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof r.alphaMode=="number"?r.alphaMode:null,this.bitmap=null,this._load=null,r.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((r,i)=>{const n=this.source;this.url=n.src;const o=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.resize(n.width,n.height),this._load=null,this.createBitmap?r(this.process()):r(this))};n.complete&&n.src?o():(n.onload=o,n.onerror=l=>{i(l),this.onError.emit(l)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const r=globalThis.createImageBitmap,i=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then(n=>n.blob()).then(n=>r(n,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===mr.UNPACK?"premultiply":"none"})).then(n=>this.destroyed?Promise.reject():(this.bitmap=n,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,r,i){if(typeof this.alphaMode=="number"&&(r.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,r,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,r,i,this.bitmap),!this.preserveBitmap){let n=!0;const o=r._glTextures;for(const l in o){const h=o[l];if(h!==i&&h.dirtyId!==r.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class km{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,r,i){const n=r.width,o=r.height;if(i){const l=t.width/2/n,h=t.height/2/o,u=t.x/n+l,f=t.y/o+h;i=Xt.add(i,Xt.NW),this.x0=u+l*Xt.uX(i),this.y0=f+h*Xt.uY(i),i=Xt.add(i,2),this.x1=u+l*Xt.uX(i),this.y1=f+h*Xt.uY(i),i=Xt.add(i,2),this.x2=u+l*Xt.uX(i),this.y2=f+h*Xt.uY(i),i=Xt.add(i,2),this.x3=u+l*Xt.uX(i),this.y3=f+h*Xt.uY(i)}else this.x0=t.x/n,this.y0=t.y/o,this.x1=(t.x+t.width)/n,this.y1=t.y/o,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/o,this.x3=t.x/n,this.y3=(t.y+t.height)/o;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const ig=new km;function Ho(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}class it extends Os{constructor(t,r,i,n,o,l){if(super(),this.noFrame=!1,r||(this.noFrame=!0,r=new Tt(0,0,1,1)),t instanceof it&&(t=t.baseTexture),this.baseTexture=t,this._frame=r,this.trim=n,this.valid=!1,this._uvs=ig,this.uvMatrix=null,this.orig=i||r,this._rotate=Number(o||0),o===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=l?new St(l.x,l.y):new St(0,0),this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=r:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:r}=this.baseTexture;r!=null&&r.url&&Er[r.url]&&it.removeFromCache(r.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,it.removeFromCache(this),this.textureCacheIds=null}clone(){var n;const t=this._frame.clone(),r=this._frame===this.orig?t:this.orig.clone(),i=new it(this.baseTexture,!this.noFrame&&t,r,(n=this.trim)==null?void 0:n.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===ig&&(this._uvs=new km),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,r={},i=J.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let o=null;if(n)o=t;else if(t instanceof pt){if(!t.cacheId){const h=(r==null?void 0:r.pixiIdPrefix)||"pixiid";t.cacheId=`${h}-${Xi()}`,pt.addToCache(t,t.cacheId)}o=t.cacheId}else{if(!t._pixiId){const h=(r==null?void 0:r.pixiIdPrefix)||"pixiid";t._pixiId=`${h}_${Xi()}`}o=t._pixiId}let l=Er[o];if(n&&i&&!l)throw new Error(`The cacheId "${o}" does not exist in TextureCache.`);return!l&&!(t instanceof pt)?(r.resolution||(r.resolution=fi(t)),l=new it(new pt(t,r)),l.baseTexture.cacheId=o,pt.addToCache(l.baseTexture,o),it.addToCache(l,o)):!l&&t instanceof pt&&(l=new it(t),it.addToCache(l,o)),l}static fromURL(t,r){const i=Object.assign({autoLoad:!1},r==null?void 0:r.resourceOptions),n=it.from(t,Object.assign({resourceOptions:i},r),!1),o=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):o.load().then(()=>Promise.resolve(n))}static fromBuffer(t,r,i,n){return new it(pt.fromBuffer(t,r,i,n))}static fromLoader(t,r,i,n){const o=new pt(t,Object.assign({scaleMode:J.SCALE_MODE,resolution:fi(r)},n)),{resource:l}=o;l instanceof Nm&&(l.url=r);const h=new it(o);return i||(i=r),pt.addToCache(h.baseTexture,i),it.addToCache(h,i),i!==r&&(pt.addToCache(h.baseTexture,r),it.addToCache(h,r)),h.baseTexture.valid?Promise.resolve(h):new Promise(u=>{h.baseTexture.once("loaded",()=>u(h))})}static addToCache(t,r){r&&(t.textureCacheIds.includes(r)||t.textureCacheIds.push(r),Er[r]&&Er[r]!==t&&console.warn(`Texture added to the cache with an id [${r}] that already had an entry`),Er[r]=t)}static removeFromCache(t){if(typeof t=="string"){const r=Er[t];if(r){const i=r.textureCacheIds.indexOf(t);return i>-1&&r.textureCacheIds.splice(i,1),delete Er[t],r}}else if(t!=null&&t.textureCacheIds){for(let r=0;r<t.textureCacheIds.length;++r)Er[t.textureCacheIds[r]]===t&&delete Er[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:r,y:i,width:n,height:o}=t,l=r+n>this.baseTexture.width,h=i+o>this.baseTexture.height;if(l||h){const u=l&&h?"and":"or",f=`X: ${r} + ${n} = ${r+n} > ${this.baseTexture.width}`,d=`Y: ${i} + ${o} = ${i+o} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${f} ${u} ${d}`)}this.valid=n&&o&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return it._EMPTY||(it._EMPTY=new it(new pt),Ho(it._EMPTY),Ho(it._EMPTY.baseTexture)),it._EMPTY}static get WHITE(){if(!it._WHITE){const t=J.ADAPTER.createCanvas(16,16),r=t.getContext("2d");t.width=16,t.height=16,r.fillStyle="white",r.fillRect(0,0,16,16),it._WHITE=new it(pt.from(t)),Ho(it._WHITE),Ho(it._WHITE.baseTexture)}return it._WHITE}}class gi extends it{constructor(t,r){super(t,r),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,r,i=!0){const n=this.baseTexture.resolution,o=Math.round(t*n)/n,l=Math.round(r*n)/n;this.valid=o>0&&l>0,this._frame.width=this.orig.width=o,this._frame.height=this.orig.height=l,i&&this.baseTexture.resize(o,l),this.updateUvs()}setResolution(t){const{baseTexture:r}=this;r.resolution!==t&&(r.setResolution(t),this.resize(r.width,r.height,!1))}static create(t){return new gi(new Lm(t))}}class Um{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,r,i=se.NONE){const n=new Lm(Object.assign({width:t,height:r,resolution:1,multisample:i},this.textureOptions));return new gi(n)}getOptimalTexture(t,r,i=1,n=se.NONE){let o;t=Math.ceil(t*i-1e-6),r=Math.ceil(r*i-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||r!==this._pixelsHeight?(t=wa(t),r=wa(r),o=((t&65535)<<16|r&65535)>>>0,n>1&&(o+=n*4294967296)):o=n>1?-n:-1,this.texturePool[o]||(this.texturePool[o]=[]);let l=this.texturePool[o].pop();return l||(l=this.createTexture(t,r,n)),l.filterPoolKey=o,l.setResolution(i),l}getFilterTexture(t,r,i){const n=this.getOptimalTexture(t.width,t.height,r||t.resolution,i||se.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const r=t.filterPoolKey;t.filterFrame=null,this.texturePool[r].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const r in this.texturePool){const i=this.texturePool[r];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const r in this.texturePool){if(!(Number(r)<0))continue;const i=this.texturePool[r];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0);this.texturePool[r]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Um.SCREEN_KEY=-1;class RP extends di{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Gm extends di{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new re(this.vertices),this.uvBuffer=new re(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,r){let i=0,n=0;return this.uvs[0]=i,this.uvs[1]=n,this.uvs[2]=i+r.width/t.width,this.uvs[3]=n,this.uvs[4]=i+r.width/t.width,this.uvs[5]=n+r.height/t.height,this.uvs[6]=i,this.uvs[7]=n+r.height/t.height,i=r.x,n=r.y,this.vertices[0]=i,this.vertices[1]=n,this.vertices[2]=i+r.width,this.vertices[3]=n,this.vertices[4]=i+r.width,this.vertices[5]=n+r.height,this.vertices[6]=i,this.vertices[7]=n+r.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class PP{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=se.NONE,this.sourceFrame=new Tt,this.destinationFrame=new Tt,this.bindingSourceFrame=new Tt,this.bindingDestinationFrame=new Tt,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Xo=[new St,new St,new St,new St],Uh=new $t;class Wm{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Um,this.statePool=[],this.quad=new RP,this.quadUv=new Gm,this.tempRect=new Tt,this.activeState={},this.globalUniforms=new gr({outputFrame:new Tt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,r){const i=this.renderer,n=this.defaultFilterStack,o=this.statePool.pop()||new PP,l=this.renderer.renderTexture;let h=r[0].resolution,u=r[0].multisample,f=r[0].padding,d=r[0].autoFit,g=r[0].legacy??!0;for(let y=1;y<r.length;y++){const w=r[y];h=Math.min(h,w.resolution),u=Math.min(u,w.multisample),f=this.useMaxPadding?Math.max(f,w.padding):f+w.padding,d=d&&w.autoFit,g=g||(w.legacy??!0)}n.length===1&&(this.defaultFilterStack[0].renderTexture=l.current),n.push(o),o.resolution=h,o.multisample=u,o.legacy=g,o.target=t,o.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),o.sourceFrame.pad(f);const m=this.tempRect.copyFrom(l.sourceFrame);i.projection.transform&&this.transformAABB(Uh.copyFrom(i.projection.transform).invert(),m),d?(o.sourceFrame.fit(m),(o.sourceFrame.width<=0||o.sourceFrame.height<=0)&&(o.sourceFrame.width=0,o.sourceFrame.height=0)):o.sourceFrame.intersects(m)||(o.sourceFrame.width=0,o.sourceFrame.height=0),this.roundFrame(o.sourceFrame,l.current?l.current.resolution:i.resolution,l.sourceFrame,l.destinationFrame,i.projection.transform),o.renderTexture=this.getOptimalFilterTexture(o.sourceFrame.width,o.sourceFrame.height,h,u),o.filters=r,o.destinationFrame.width=o.renderTexture.width,o.destinationFrame.height=o.renderTexture.height;const v=this.tempRect;v.x=0,v.y=0,v.width=o.sourceFrame.width,v.height=o.sourceFrame.height,o.renderTexture.filterFrame=o.sourceFrame,o.bindingSourceFrame.copyFrom(l.sourceFrame),o.bindingDestinationFrame.copyFrom(l.destinationFrame),o.transform=i.projection.transform,i.projection.transform=null,l.bind(o.renderTexture,o.sourceFrame,v),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,r=t.pop(),i=r.filters;this.activeState=r;const n=this.globalUniforms.uniforms;n.outputFrame=r.sourceFrame,n.resolution=r.resolution;const o=n.inputSize,l=n.inputPixel,h=n.inputClamp;if(o[0]=r.destinationFrame.width,o[1]=r.destinationFrame.height,o[2]=1/o[0],o[3]=1/o[1],l[0]=Math.round(o[0]*r.resolution),l[1]=Math.round(o[1]*r.resolution),l[2]=1/l[0],l[3]=1/l[1],h[0]=.5*l[2],h[1]=.5*l[3],h[2]=r.sourceFrame.width*o[2]-.5*l[2],h[3]=r.sourceFrame.height*o[3]-.5*l[3],r.legacy){const f=n.filterArea;f[0]=r.destinationFrame.width,f[1]=r.destinationFrame.height,f[2]=r.sourceFrame.x,f[3]=r.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const u=t[t.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,r.renderTexture,u.renderTexture,Ar.BLEND,r),this.returnFilterTexture(r.renderTexture);else{let f=r.renderTexture,d=this.getOptimalFilterTexture(f.width,f.height,r.resolution);d.filterFrame=f.filterFrame;let g=0;for(g=0;g<i.length-1;++g){g===1&&r.multisample>1&&(d=this.getOptimalFilterTexture(f.width,f.height,r.resolution),d.filterFrame=f.filterFrame),i[g].apply(this,f,d,Ar.CLEAR,r);const m=f;f=d,d=m}i[g].apply(this,f,u.renderTexture,Ar.BLEND,r),g>1&&r.multisample>1&&this.returnFilterTexture(r.renderTexture),this.returnFilterTexture(f),this.returnFilterTexture(d)}r.clear(),this.statePool.push(r)}bindAndClear(t,r=Ar.CLEAR){const{renderTexture:i,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t!=null&&t.filterFrame){const l=this.tempRect;l.x=0,l.y=0,l.width=t.filterFrame.width,l.height=t.filterFrame.height,i.bind(t,t.filterFrame,l)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const o=n.stateId&1||this.forceClear;(r===Ar.CLEAR||r===Ar.BLIT&&o)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,r,i,n){const o=this.renderer;o.state.set(t.state),this.bindAndClear(i,n),t.uniforms.uSampler=r,t.uniforms.filterGlobals=this.globalUniforms,o.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(r._frame,r.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(Rr.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(Rr.TRIANGLE_STRIP))}calculateSpriteMatrix(t,r){const{sourceFrame:i,destinationFrame:n}=this.activeState,{orig:o}=r._texture,l=t.set(n.width,0,0,n.height,i.x,i.y),h=r.worldTransform.copyTo($t.TEMP_MATRIX);return h.invert(),l.prepend(h),l.scale(1/o.width,1/o.height),l.translate(r.anchor.x,r.anchor.y),l}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,r,i=1,n=se.NONE){return this.texturePool.getOptimalTexture(t,r,i,n)}getFilterTexture(t,r,i){if(typeof t=="number"){const o=t;t=r,r=o}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,r||t.resolution,i||se.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,r){const i=Xo[0],n=Xo[1],o=Xo[2],l=Xo[3];i.set(r.left,r.top),n.set(r.left,r.bottom),o.set(r.right,r.top),l.set(r.right,r.bottom),t.apply(i,i),t.apply(n,n),t.apply(o,o),t.apply(l,l);const h=Math.min(i.x,n.x,o.x,l.x),u=Math.min(i.y,n.y,o.y,l.y),f=Math.max(i.x,n.x,o.x,l.x),d=Math.max(i.y,n.y,o.y,l.y);r.x=h,r.y=u,r.width=f-h,r.height=d-u}roundFrame(t,r,i,n,o){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(o){const{a:l,b:h,c:u,d:f}=o;if((Math.abs(h)>1e-4||Math.abs(u)>1e-4)&&(Math.abs(l)>1e-4||Math.abs(f)>1e-4))return}o=o?Uh.copyFrom(o):Uh.identity(),o.translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.transformAABB(o,t),t.ceil(r),this.transformAABB(o.invert(),t)}}}Wm.extension={type:Z.RendererSystem,name:"filter"};nt.add(Wm);class MP{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=se.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const DP=new Tt;class $m{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Du(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Tt,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let r=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;J.PREFER_ENV===Yi.WEBGL_LEGACY&&(r=null,i=null),r?t.drawBuffers=n=>r.drawBuffersWEBGL(n):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,r,i=0){const{gl:n}=this;if(t){const o=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,o.framebuffer)),o.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,o.mipLevel=i),o.dirtyId!==t.dirtyId&&(o.dirtyId=t.dirtyId,o.dirtyFormat!==t.dirtyFormat?(o.dirtyFormat=t.dirtyFormat,o.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):o.dirtySize!==t.dirtySize&&(o.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let l=0;l<t.colorTextures.length;l++){const h=t.colorTextures[l];this.renderer.texture.unbind(h.parentTextureArray||h)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),r){const l=r.width>>i,h=r.height>>i,u=l/r.width;this.setViewport(r.x*u,r.y*u,l,h)}else{const l=t.width>>i,h=t.height>>i;this.setViewport(0,0,l,h)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),r?this.setViewport(r.x,r.y,r.width,r.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,r,i,n){const o=this.viewport;t=Math.round(t),r=Math.round(r),i=Math.round(i),n=Math.round(n),(o.width!==i||o.height!==n||o.x!==t||o.y!==r)&&(o.x=t,o.y=r,o.width=i,o.height=n,this.gl.viewport(t,r,i,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,r,i,n,o=uu.COLOR|uu.DEPTH){const{gl:l}=this;l.clearColor(t,r,i,n),l.clear(o)}initFramebuffer(t){const{gl:r}=this,i=new MP(r.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){const{gl:r}=this,i=t.glFramebuffers[this.CONTEXT_UID];i.stencil&&(r.bindRenderbuffer(r.RENDERBUFFER,i.stencil),i.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,r.DEPTH24_STENCIL8,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t.width,t.height));const n=t.colorTextures;let o=n.length;r.drawBuffers||(o=Math.min(o,1));for(let l=0;l<o;l++){const h=n[l],u=h.parentTextureArray||h;this.renderer.texture.bind(u,0),l===0&&i.msaaBuffer&&(r.bindRenderbuffer(r.RENDERBUFFER,i.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,r){const{gl:i}=this,n=t.glFramebuffers[this.CONTEXT_UID],o=t.colorTextures;let l=o.length;i.drawBuffers||(l=Math.min(l,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||i.createRenderbuffer():n.msaaBuffer&&(i.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const h=[];for(let u=0;u<l;u++){const f=o[u],d=f.parentTextureArray||f;this.renderer.texture.bind(d,0),u===0&&n.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,n.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,d._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+u,f.target,d._glTextures[this.CONTEXT_UID].texture,r),h.push(i.COLOR_ATTACHMENT0+u))}if(h.length>1&&i.drawBuffers(h),t.depthTexture&&this.writeDepthTexture){const f=t.depthTexture;this.renderer.texture.bind(f,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,f._glTextures[this.CONTEXT_UID].texture,r)}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(n.stencil=n.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,n.stencil),n.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,n.stencil)):n.stencil&&(i.deleteRenderbuffer(n.stencil),n.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:r}=this;let i=se.NONE;if(t<=1||r===null)return i;for(let n=0;n<r.length;n++)if(r[n]<=t){i=r[n];break}return i===1&&(i=se.NONE),i}blit(t,r,i){const{current:n,renderer:o,gl:l,CONTEXT_UID:h}=this;if(o.context.webGLVersion!==2||!n)return;const u=n.glFramebuffers[h];if(!u)return;if(!t){if(!u.msaaBuffer)return;const d=n.colorTextures[0];if(!d)return;u.blitFramebuffer||(u.blitFramebuffer=new Du(n.width,n.height),u.blitFramebuffer.addColorTexture(0,d)),t=u.blitFramebuffer,t.colorTextures[0]!==d&&(t.colorTextures[0]=d,t.dirtyId++,t.dirtyFormat++),(t.width!==n.width||t.height!==n.height)&&(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}r||(r=DP,r.width=n.width,r.height=n.height),i||(i=r);const f=r.width===i.width&&r.height===i.height;this.bind(t),l.bindFramebuffer(l.READ_FRAMEBUFFER,u.framebuffer),l.blitFramebuffer(r.left,r.top,r.right,r.bottom,i.left,i.top,i.right,i.bottom,l.COLOR_BUFFER_BIT,f?l.NEAREST:l.LINEAR)}disposeFramebuffer(t,r){const i=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];const o=this.managedFramebuffers.indexOf(t);o>=0&&this.managedFramebuffers.splice(o,1),t.disposeRunner.remove(this),r||(n.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&n.deleteRenderbuffer(i.msaaBuffer),i.stencil&&n.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&i.blitFramebuffer.dispose()}disposeAll(t){const r=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<r.length;i++)this.disposeFramebuffer(r[i],t)}forceStencil(){const t=this.current;if(!t)return;const r=t.glFramebuffers[this.CONTEXT_UID];if(!r||r.stencil)return;t.stencil=!0;const i=t.width,n=t.height,o=this.gl,l=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,l),r.msaaBuffer?o.renderbufferStorageMultisample(o.RENDERBUFFER,r.multisample,o.DEPTH24_STENCIL8,i,n):o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,i,n),r.stencil=l,o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,l)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Tt}destroy(){this.renderer=null}}$m.extension={type:Z.RendererSystem,name:"framebuffer"};nt.add($m);const Gh={5126:4,5123:2,5121:1};class Hm{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,r=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,r.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;J.PREFER_ENV===Yi.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=()=>i.createVertexArrayOES(),t.bindVertexArray=n=>i.bindVertexArrayOES(n),t.deleteVertexArray=n=>i.deleteVertexArrayOES(n)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(r.webGLVersion!==2){const i=t.getExtension("ANGLE_instanced_arrays");i?(t.vertexAttribDivisor=(n,o)=>i.vertexAttribDivisorANGLE(n,o),t.drawElementsInstanced=(n,o,l,h,u)=>i.drawElementsInstancedANGLE(n,o,l,h,u),t.drawArraysInstanced=(n,o,l,h)=>i.drawArraysInstancedANGLE(n,o,l,h)):this.hasInstance=!1}this.canUseUInt32ElementIndex=r.webGLVersion===2||!!r.extensions.uint32ElementIndex}bind(t,r){r=r||this.renderer.shader.shader;const{gl:i}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],o=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},o=!0);const l=n[r.program.id]||this.initGeometryVao(t,r,o);this._activeGeometry=t,this._activeVao!==l&&(this._activeVao=l,this.hasVao?i.bindVertexArray(l):this.activateVao(t,r.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,r=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){const n=t.buffers[i];r.update(n)}}checkCompatibility(t,r){const i=t.attributes,n=r.attributeData;for(const o in n)if(!i[o])throw new Error(`shader and geometry incompatible, geometry missing the "${o}" attribute`)}getSignature(t,r){const i=t.attributes,n=r.attributeData,o=["g",t.id];for(const l in i)n[l]&&o.push(l,n[l].location);return o.join("-")}initGeometryVao(t,r,i=!0){const n=this.gl,o=this.CONTEXT_UID,l=this.renderer.buffer,h=r.program;h.glPrograms[o]||this.renderer.shader.generateProgram(r),this.checkCompatibility(t,h);const u=this.getSignature(t,h),f=t.glVertexArrayObjects[this.CONTEXT_UID];let d=f[u];if(d)return f[h.id]=d,d;const g=t.buffers,m=t.attributes,v={},y={};for(const w in g)v[w]=0,y[w]=0;for(const w in m)!m[w].size&&h.attributeData[w]?m[w].size=h.attributeData[w].size:m[w].size||console.warn(`PIXI Geometry attribute '${w}' size cannot be determined (likely the bound shader does not have the attribute)`),v[m[w].buffer]+=m[w].size*Gh[m[w].type];for(const w in m){const x=m[w],A=x.size;x.stride===void 0&&(v[x.buffer]===A*Gh[x.type]?x.stride=0:x.stride=v[x.buffer]),x.start===void 0&&(x.start=y[x.buffer],y[x.buffer]+=A*Gh[x.type])}d=n.createVertexArray(),n.bindVertexArray(d);for(let w=0;w<g.length;w++){const x=g[w];l.bind(x),i&&x._glBuffers[o].refCount++}return this.activateVao(t,h),f[h.id]=d,f[u]=d,n.bindVertexArray(null),l.unbind(Pr.ARRAY_BUFFER),d}disposeGeometry(t,r){var h;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,o=t.buffers,l=(h=this.renderer)==null?void 0:h.buffer;if(t.disposeRunner.remove(this),!!i){if(l)for(let u=0;u<o.length;u++){const f=o[u]._glBuffers[this.CONTEXT_UID];f&&(f.refCount--,f.refCount===0&&!r&&l.dispose(o[u],r))}if(!r){for(const u in i)if(u[0]==="g"){const f=i[u];this._activeVao===f&&this.unbind(),n.deleteVertexArray(f)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const r=Object.keys(this.managedGeometries);for(let i=0;i<r.length;i++)this.disposeGeometry(this.managedGeometries[r[i]],t)}activateVao(t,r){const i=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,l=t.buffers,h=t.attributes;t.indexBuffer&&o.bind(t.indexBuffer);let u=null;for(const f in h){const d=h[f],g=l[d.buffer],m=g._glBuffers[n];if(r.attributeData[f]){u!==m&&(o.bind(g),u=m);const v=r.attributeData[f].location;if(i.enableVertexAttribArray(v),i.vertexAttribPointer(v,d.size,d.type||i.FLOAT,d.normalized,d.stride,d.start),d.instance)if(this.hasInstance)i.vertexAttribDivisor(v,d.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,r,i,n){const{gl:o}=this,l=this._activeGeometry;if(l.indexBuffer){const h=l.indexBuffer.data.BYTES_PER_ELEMENT,u=h===2?o.UNSIGNED_SHORT:o.UNSIGNED_INT;h===2||h===4&&this.canUseUInt32ElementIndex?l.instanced?o.drawElementsInstanced(t,r||l.indexBuffer.data.length,u,(i||0)*h,n||1):o.drawElements(t,r||l.indexBuffer.data.length,u,(i||0)*h):console.warn("unsupported index buffer type: uint32")}else l.instanced?o.drawArraysInstanced(t,i,r||l.getSize(),n||1):o.drawArrays(t,i,r||l.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Hm.extension={type:Z.RendererSystem,name:"geometry"};nt.add(Hm);const ng=new $t;class Xm{constructor(t,r){this._texture=t,this.mapCoord=new $t,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof r>"u"?.5:r,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,r){r===void 0&&(r=t);const i=this.mapCoord;for(let n=0;n<t.length;n+=2){const o=t[n],l=t[n+1];r[n]=o*i.a+l*i.c+i.tx,r[n+1]=o*i.b+l*i.d+i.ty}return r}update(t){const r=this._texture;if(!r||!r.valid||!t&&this._textureID===r._updateID)return!1;this._textureID=r._updateID,this._updateID++;const i=r._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const n=r.orig,o=r.trim;o&&(ng.set(n.width/o.width,0,0,n.height/o.height,-o.x/o.width,-o.y/o.height),this.mapCoord.append(ng));const l=r.baseTexture,h=this.uClampFrame,u=this.clampMargin/l.resolution,f=this.clampOffset;return h[0]=(r._frame.x+u+f)/l.width,h[1]=(r._frame.y+u+f)/l.height,h[2]=(r._frame.x+r._frame.width-u+f)/l.width,h[3]=(r._frame.y+r._frame.height-u+f)/l.height,this.uClampOffset[0]=f/l.realWidth,this.uClampOffset[1]=f/l.realHeight,this.isSimple=r._frame.width===l.width&&r._frame.height===l.height&&r.rotate===0,!0}}var BP=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,OP=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class FP extends Ae{constructor(t,r,i){let n=null;typeof t!="string"&&r===void 0&&i===void 0&&(n=t,t=void 0,r=void 0,i=void 0),super(t||OP,r||BP,i),this.maskSprite=n,this.maskMatrix=new $t}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,r,i,n){const o=this._maskSprite,l=o._texture;l.valid&&(l.uvMatrix||(l.uvMatrix=new Xm(l,0)),l.uvMatrix.update(),this.uniforms.npmAlpha=l.baseTexture.alphaMode?0:1,this.uniforms.mask=l,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,o).prepend(l.uvMatrix.mapCoord),this.uniforms.alpha=o.worldAlpha,this.uniforms.maskClamp=l.uvMatrix.uClampFrame,t.applyFilter(this,r,i,n))}}class LP{constructor(t=null){this.type=ue.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=J.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=ue.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class zm{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,r){let i=r;if(!i.isMaskData){const o=this.maskDataPool.pop()||new LP;o.pooled=!0,o.maskObject=r,i=o}const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(n),i._colorMask=n?n._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==ue.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case ue.SCISSOR:this.renderer.scissor.push(i);break;case ue.STENCIL:this.renderer.stencil.push(i);break;case ue.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case ue.COLOR:this.pushColorMask(i);break}i.type===ue.SPRITE&&this.maskStack.push(i)}pop(t){const r=this.maskStack.pop();if(!(!r||r._target!==t)){if(r.enabled)switch(r.type){case ue.SCISSOR:this.renderer.scissor.pop(r);break;case ue.STENCIL:this.renderer.stencil.pop(r.maskObject);break;case ue.SPRITE:this.popSpriteMask(r);break;case ue.COLOR:this.popColorMask(r);break}if(r.reset(),r.pooled&&this.maskDataPool.push(r),this.maskStack.length!==0){const i=this.maskStack[this.maskStack.length-1];i.type===ue.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(t){const r=t.maskObject;r?r.isSprite?t.type=ue.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=ue.SCISSOR:t.type=ue.STENCIL:t.type=ue.COLOR}pushSpriteMask(t){const{maskObject:r}=t,i=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new FP]));const o=this.renderer,l=o.renderTexture;let h,u;if(l.current){const d=l.current;h=t.resolution||d.resolution,u=t.multisample??d.multisample}else h=t.resolution||o.resolution,u=t.multisample??o.multisample;n[0].resolution=h,n[0].multisample=u,n[0].maskSprite=r;const f=i.filterArea;i.filterArea=r.getBounds(!0),o.filter.push(i,n),i.filterArea=f,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const r=t._colorMask,i=t._colorMask=r&t.colorMask;i!==r&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(t){const r=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==r&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}}zm.extension={type:Z.RendererSystem,name:"mask"};nt.add(zm);class Vm{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:r}=this.renderer,i=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==i&&(n===0?r.disable(this.glConst):(r.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const sg=new $t,og=[],la=class extends Vm{constructor(e){super(e),this.glConst=J.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:r}=e,{renderer:i}=this,n=i.renderTexture,o=r.getBounds(!0,og.pop()??new Tt);this.roundFrameToPixels(o,n.current?n.current.resolution:i.resolution,n.sourceFrame,n.destinationFrame,i.projection.transform),t&&o.fit(t),e._scissorRectLocal=o}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:r,c:i,d:n}=e;return(Math.abs(r)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4)}testScissor(e){const{maskObject:t}=e;if(!t.isFastRect||!t.isFastRect()||la.isMatrixRotated(t.worldTransform)||la.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const r=e._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(e,t,r,i,n){la.isMatrixRotated(n)||(n=n?sg.copyFrom(n):sg.identity(),n.translate(-r.x,-r.y).scale(i.width/r.width,i.height/r.height).translate(i.x,i.y),this.renderer.filter.transformAABB(n,e),e.fit(i),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&og.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=e.y:t=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};let Ym=la;Ym.extension={type:Z.RendererSystem,name:"scissor"};nt.add(Ym);class jm extends Vm{constructor(t){super(t),this.glConst=J.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const r=t.maskObject,{gl:i}=this.renderer,n=t._stencilCounter;n===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;const o=t._colorMask;o!==0&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,n,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),r.renderable=!0,r.render(this.renderer),this.renderer.batch.flush(),r.renderable=!1,o!==0&&(t._colorMask=o,i.colorMask((o&1)!==0,(o&2)!==0,(o&4)!==0,(o&8)!==0)),this._useCurrent()}pop(t){const r=this.renderer.gl;if(this.getStackLength()===0)r.disable(r.STENCIL_TEST);else{const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,n=i?i._colorMask:15;n!==0&&(i._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilOp(r.KEEP,r.KEEP,r.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(i._colorMask=n,r.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}jm.extension={type:Z.RendererSystem,name:"stencil"};nt.add(jm);class qm{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return Ct("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return Ct("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return Ct("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(t){for(const r in t)this.plugins[r]=new t[r](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}qm.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"_plugin"};nt.add(qm);class Km{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new $t,this.transform=null}update(t,r,i,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=r||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,n),this.transform&&this.projectionMatrix.append(this.transform);const o=this.renderer;o.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,o.globalUniforms.update(),o.shader.shader&&o.shader.syncUniformGroup(o.shader.shader.uniforms.globals)}calculateProjection(t,r,i,n){const o=this.projectionMatrix,l=n?-1:1;o.identity(),o.a=1/r.width*2,o.d=l*(1/r.height*2),o.tx=-1-r.x*o.a,o.ty=-l-r.y*o.d}setTransform(t){}destroy(){this.renderer=null}}Km.extension={type:Z.RendererSystem,name:"projection"};nt.add(Km);const NP=new pc;class Zm{constructor(t){this.renderer=t,this._tempMatrix=new $t}generateTexture(t,r){const{region:i,...n}=r||{},o=i||t.getLocalBounds(null,!0);o.width===0&&(o.width=1),o.height===0&&(o.height=1);const l=gi.create({width:o.width,height:o.height,...n});this._tempMatrix.tx=-o.x,this._tempMatrix.ty=-o.y;const h=t.transform;return t.transform=NP,this.renderer.render(t,{renderTexture:l,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=h,l}destroy(){}}Zm.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"textureGenerator"};nt.add(Zm);const Ii=new Tt,ps=new Tt;class Jm{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Tt,this.destinationFrame=new Tt,this.viewportFrame=new Tt}bind(t=null,r,i){const n=this.renderer;this.current=t;let o,l,h;t?(o=t.baseTexture,h=o.resolution,r||(Ii.width=t.frame.width,Ii.height=t.frame.height,r=Ii),i||(ps.x=t.frame.x,ps.y=t.frame.y,ps.width=r.width,ps.height=r.height,i=ps),l=o.framebuffer):(h=n.resolution,r||(Ii.width=n._view.screen.width,Ii.height=n._view.screen.height,r=Ii),i||(i=Ii,i.width=r.width,i.height=r.height));const u=this.viewportFrame;u.x=i.x*h,u.y=i.y*h,u.width=i.width*h,u.height=i.height*h,t||(u.y=n.view.height-(u.y+u.height)),u.ceil(),this.renderer.framebuffer.bind(l,u),this.renderer.projection.update(i,r,h,!l),t?this.renderer.mask.setMaskStack(o.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(r),this.destinationFrame.copyFrom(i)}clear(t,r){this.current?t=t||this.current.baseTexture.clearColor:t=t||this.renderer.background.colorRgba;const i=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer._view.screen,o=i.width!==n.width||i.height!==n.height;if(o){let{x:l,y:h,width:u,height:f}=this.viewportFrame;l=Math.round(l),h=Math.round(h),u=Math.round(u),f=Math.round(f),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,h,u,f)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],r),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Jm.extension={type:Z.RendererSystem,name:"renderTexture"};nt.add(Jm);class kP{constructor(t,r){this.program=t,this.uniformData=r,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function UP(e,t){const r={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){const o=t.getActiveAttrib(e,n);if(o.name.startsWith("gl_"))continue;const l=Dm(t,o.type),h={type:l,name:o.name,size:Mm(l),location:t.getAttribLocation(e,o.name)};r[o.name]=h}return r}function GP(e,t){const r={},i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let n=0;n<i;n++){const o=t.getActiveUniform(e,n),l=o.name.replace(/\[.*?\]$/,""),h=!!o.name.match(/\[.*?\]$/),u=Dm(t,o.type);r[l]={name:l,index:n,type:u,size:o.size,isArray:h,value:Rm(u,o.size)}}return r}function WP(e,t){var u;const r=Jp(e,e.VERTEX_SHADER,t.vertexSrc),i=Jp(e,e.FRAGMENT_SHADER,t.fragmentSrc),n=e.createProgram();e.attachShader(n,r),e.attachShader(n,i);const o=(u=t.extra)==null?void 0:u.transformFeedbackVaryings;if(o&&(typeof e.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):e.transformFeedbackVaryings(n,o.names,o.bufferMode==="separate"?e.SEPARATE_ATTRIBS:e.INTERLEAVED_ATTRIBS)),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)||mP(e,n,r,i),t.attributeData=UP(n,e),t.uniformData=GP(n,e),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const f=Object.keys(t.attributeData);f.sort((d,g)=>d>g?1:-1);for(let d=0;d<f.length;d++)t.attributeData[f[d]].location=d,e.bindAttribLocation(n,d,f[d]);e.linkProgram(n)}e.deleteShader(r),e.deleteShader(i);const l={};for(const f in t.uniformData){const d=t.uniformData[f];l[f]={location:e.getUniformLocation(n,f),value:Rm(d.type,d.size)}}return new kP(n,l)}function $P(e,t,r,i,n){r.buffer.update(n)}const HP={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Qm={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function XP(e){const t=e.map(o=>({data:o,offset:0,dataLen:0,dirty:0}));let r=0,i=0,n=0;for(let o=0;o<t.length;o++){const l=t[o];if(r=Qm[l.data.type],l.data.size>1&&(r=Math.max(r,16)*l.data.size),l.dataLen=r,i%r!==0&&i<16){const h=i%r%16;i+=h,n+=h}i+r>16?(n=Math.ceil(n/16)*16,l.offset=n,n+=r,i=r):(l.offset=n,i+=r,n+=r)}return n=Math.ceil(n/16)*16,{uboElements:t,size:n}}function zP(e,t){const r=[];for(const i in e)t[i]&&r.push(t[i]);return r.sort((i,n)=>i.index-n.index),r}function VP(e,t){if(!e.autoManage)return{size:0,syncFunc:$P};const r=zP(e.uniforms,t),{uboElements:i,size:n}=XP(r),o=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let l=0;l<i.length;l++){const h=i[l],u=e.uniforms[h.data.name],f=h.data.name;let d=!1;for(let g=0;g<Pn.length;g++){const m=Pn[g];if(m.codeUbo&&m.test(h.data,u)){o.push(`offset = ${h.offset/4};`,Pn[g].codeUbo(h.data.name,u)),d=!0;break}}if(!d)if(h.data.size>1){const g=Mm(h.data.type),m=Math.max(Qm[h.data.type]/16,1),v=g/m,y=(4-v%4)%4;o.push(`
                cv = ud.${f}.value;
                v = uv.${f};
                offset = ${h.offset/4};

                t = 0;

                for(var i=0; i < ${h.data.size*m}; i++)
                {
                    for(var j = 0; j < ${v}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${y};
                }

                `)}else{const g=HP[h.data.type];o.push(`
                cv = ud.${f}.value;
                v = uv.${f};
                offset = ${h.offset/4};
                ${g};
                `)}}return o.push(`
       renderer.buffer.update(buffer);
    `),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",o.join(`
`))}}let YP=0;const zo={textureCount:0,uboCount:0};class tv{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=YP++}systemCheck(){if(!_P())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,r){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const i=t.program,n=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(n.program)),r||(zo.textureCount=0,zo.uboCount=0,this.syncUniformGroup(t.uniformGroup,zo)),n}setUniforms(t){const r=this.shader.program,i=r.glPrograms[this.renderer.CONTEXT_UID];r.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,r){const i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,r))}syncUniforms(t,r,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(r.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){const r=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[r]||(this.cache[r]=dP(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[r],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,r){const i=this.getGlProgram();if(!t.static||t.dirtyId!==0||!i.uniformGroups[t.id]){t.dirtyId=0;const n=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,r);t.buffer.update(),n(i.uniformData,t.uniforms,this.renderer,zo,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[r])}createSyncBufferGroup(t,r,i){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const o=this.gl.getUniformBlockIndex(r.program,i);r.uniformBufferBindings[i]=this.shader.uniformBindCount,n.uniformBlockBinding(r.program,o,this.shader.uniformBindCount),this.shader.uniformBindCount++;const l=this.getSignature(t,this.shader.program.uniformData,"ubo");let h=this._uboCache[l];if(h||(h=this._uboCache[l]=VP(t,this.shader.program.uniformData)),t.autoManage){const u=new Float32Array(h.size/4);t.buffer.update(u)}return r.uniformGroups[t.id]=h.syncFunc,r.uniformGroups[t.id]}getSignature(t,r,i){const n=t.uniforms,o=[`${i}-`];for(const l in n)o.push(l),r[l]&&o.push(r[l].type);return o.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const r=this.gl,i=t.program,n=WP(r,i);return i.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}tv.extension={type:Z.RendererSystem,name:"shader"};nt.add(tv);class ev{constructor(t){this.renderer=t}run(t){const r=this.renderer;r.emitWithCustomOptions(r.runners.init,t),t.hello&&console.log(`PixiJS 7.1.0 - ${r.rendererLogId} - https://pixijs.com`),r.resize(this.renderer.screen.width,this.renderer.screen.height)}destroy(){}}ev.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"startup"};nt.add(ev);function jP(e,t=[]){return t[ut.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.ADD]=[e.ONE,e.ONE],t[ut.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.NONE]=[0,0],t[ut.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[ut.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[ut.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[ut.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[ut.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[ut.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[ut.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[ut.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[ut.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[ut.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t}const qP=0,KP=1,ZP=2,JP=3,QP=4,tM=5,Bu=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=ut.NONE,this._blendEq=!1,this.map=[],this.map[qP]=this.setBlend,this.map[KP]=this.setOffset,this.map[ZP]=this.setCullFace,this.map[JP]=this.setDepthTest,this.map[QP]=this.setFrontFace,this.map[tM]=this.setDepthMask,this.checks=[],this.defaultState=new qr,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=jP(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,r=0;for(;t;)t&1&&this.map[r].call(this,!!(e.data&1<<r)),t=t>>1,r++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this.updateCheck(Bu.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(Bu.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],r=this.gl;t.length===2?r.blendFunc(t[0],t[1]):r.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,r.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const r=this.checks.indexOf(e);t&&r===-1?this.checks.push(e):!t&&r!==-1&&this.checks.splice(r,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let rv=Bu;rv.extension={type:Z.RendererSystem,name:"state"};nt.add(rv);class eM extends Os{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const r=(t.priority??[]).filter(n=>t.systems[n]),i=[...r,...Object.keys(t.systems).filter(n=>!r.includes(n))];for(const n of i)this.addSystem(t.systems[n],n)}addRunners(...t){t.forEach(r=>{this.runners[r]=new pr(r)})}addSystem(t,r){const i=new t(this);if(this[r])throw new Error(`Whoops! The name "${r}" is already in use`);this[r]=i,this._systemsHash[r]=i;for(const n in this.runners)this.runners[n].add(i);return this}emitWithCustomOptions(t,r){const i=Object.keys(this._systemsHash);t.items.forEach(n=>{const o=i.find(l=>this._systemsHash[l]===n);n[t.name](r[o])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const ha=class{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=ha.defaultMaxIdle,this.checkCountMax=ha.defaultCheckCountMax,this.mode=ha.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==tc.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let r=!1;for(let i=0;i<t.length;i++){const n=t[i];!n.framebuffer&&this.count-n.touched>this.maxIdle&&(e.destroyTexture(n,!0),t[i]=null,r=!0)}if(r){let i=0;for(let n=0;n<t.length;n++)t[n]!==null&&(t[i++]=t[n]);t.length=i}}unload(e){const t=this.renderer.texture,r=e._texture;r&&!r.framebuffer&&t.destroyTexture(r);for(let i=e.children.length-1;i>=0;i--)this.unload(e.children[i])}destroy(){this.renderer=null}};let ur=ha;ur.defaultMode=tc.AUTO;ur.defaultMaxIdle=60*60;ur.defaultCheckCountMax=60*10;ur.extension={type:Z.RendererSystem,name:"textureGC"};nt.add(ur);class Wh{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=st.UNSIGNED_BYTE,this.internalFormat=V.RGBA,this.samplerType=0}}function rM(e){let t;return"WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?t={[st.UNSIGNED_BYTE]:{[V.RGBA]:e.RGBA8,[V.RGB]:e.RGB8,[V.RG]:e.RG8,[V.RED]:e.R8,[V.RGBA_INTEGER]:e.RGBA8UI,[V.RGB_INTEGER]:e.RGB8UI,[V.RG_INTEGER]:e.RG8UI,[V.RED_INTEGER]:e.R8UI,[V.ALPHA]:e.ALPHA,[V.LUMINANCE]:e.LUMINANCE,[V.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[st.BYTE]:{[V.RGBA]:e.RGBA8_SNORM,[V.RGB]:e.RGB8_SNORM,[V.RG]:e.RG8_SNORM,[V.RED]:e.R8_SNORM,[V.RGBA_INTEGER]:e.RGBA8I,[V.RGB_INTEGER]:e.RGB8I,[V.RG_INTEGER]:e.RG8I,[V.RED_INTEGER]:e.R8I},[st.UNSIGNED_SHORT]:{[V.RGBA_INTEGER]:e.RGBA16UI,[V.RGB_INTEGER]:e.RGB16UI,[V.RG_INTEGER]:e.RG16UI,[V.RED_INTEGER]:e.R16UI,[V.DEPTH_COMPONENT]:e.DEPTH_COMPONENT16},[st.SHORT]:{[V.RGBA_INTEGER]:e.RGBA16I,[V.RGB_INTEGER]:e.RGB16I,[V.RG_INTEGER]:e.RG16I,[V.RED_INTEGER]:e.R16I},[st.UNSIGNED_INT]:{[V.RGBA_INTEGER]:e.RGBA32UI,[V.RGB_INTEGER]:e.RGB32UI,[V.RG_INTEGER]:e.RG32UI,[V.RED_INTEGER]:e.R32UI,[V.DEPTH_COMPONENT]:e.DEPTH_COMPONENT24},[st.INT]:{[V.RGBA_INTEGER]:e.RGBA32I,[V.RGB_INTEGER]:e.RGB32I,[V.RG_INTEGER]:e.RG32I,[V.RED_INTEGER]:e.R32I},[st.FLOAT]:{[V.RGBA]:e.RGBA32F,[V.RGB]:e.RGB32F,[V.RG]:e.RG32F,[V.RED]:e.R32F,[V.DEPTH_COMPONENT]:e.DEPTH_COMPONENT32F},[st.HALF_FLOAT]:{[V.RGBA]:e.RGBA16F,[V.RGB]:e.RGB16F,[V.RG]:e.RG16F,[V.RED]:e.R16F},[st.UNSIGNED_SHORT_5_6_5]:{[V.RGB]:e.RGB565},[st.UNSIGNED_SHORT_4_4_4_4]:{[V.RGBA]:e.RGBA4},[st.UNSIGNED_SHORT_5_5_5_1]:{[V.RGBA]:e.RGB5_A1},[st.UNSIGNED_INT_2_10_10_10_REV]:{[V.RGBA]:e.RGB10_A2,[V.RGBA_INTEGER]:e.RGB10_A2UI},[st.UNSIGNED_INT_10F_11F_11F_REV]:{[V.RGB]:e.R11F_G11F_B10F},[st.UNSIGNED_INT_5_9_9_9_REV]:{[V.RGB]:e.RGB9_E5},[st.UNSIGNED_INT_24_8]:{[V.DEPTH_STENCIL]:e.DEPTH24_STENCIL8},[st.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[V.DEPTH_STENCIL]:e.DEPTH32F_STENCIL8}}:t={[st.UNSIGNED_BYTE]:{[V.RGBA]:e.RGBA,[V.RGB]:e.RGB,[V.ALPHA]:e.ALPHA,[V.LUMINANCE]:e.LUMINANCE,[V.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[st.UNSIGNED_SHORT_5_6_5]:{[V.RGB]:e.RGB},[st.UNSIGNED_SHORT_4_4_4_4]:{[V.RGBA]:e.RGBA},[st.UNSIGNED_SHORT_5_5_5_1]:{[V.RGBA]:e.RGBA}},t}class iv{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new pt,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=rM(t);const r=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=r;for(let n=0;n<r;n++)this.boundTextures[n]=null;this.emptyTextures={};const i=new Wh(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Wh(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(t,r=0){const{gl:i}=this;if(t=t==null?void 0:t.castToBaseTexture(),t!=null&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[r]!==t&&(this.currentLocation!==r&&(this.currentLocation=r,i.activeTexture(i.TEXTURE0+r)),i.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==r&&(this.currentLocation=r,i.activeTexture(i.TEXTURE0+r)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[r]=t}else this.currentLocation!==r&&(this.currentLocation=r,i.activeTexture(i.TEXTURE0+r)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[r]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:r,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let n=0;n<i.length;n++)i[n]===this.unknownTexture&&this.bind(null,n)}for(let n=0;n<i.length;n++)i[n]===t&&(this.currentLocation!==n&&(r.activeTexture(r.TEXTURE0+n),this.currentLocation=n),r.bindTexture(t.target,this.emptyTextures[t.target].texture),i[n]=null)}ensureSamplerType(t){const{boundTextures:r,hasIntegerTextures:i,CONTEXT_UID:n}=this;if(i)for(let o=t-1;o>=0;--o){const l=r[o];l&&l._glTextures[n].samplerType!==cu.FLOAT&&this.renderer.texture.unbind(l)}}initTexture(t){const r=new Wh(this.gl.createTexture());return r.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=r,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),r}initTextureType(t,r){var i;r.internalFormat=((i=this.internalFormats[t.type])==null?void 0:i[t.format])??t.format,this.webGLVersion===2&&t.type===st.HALF_FLOAT?r.type=this.gl.HALF_FLOAT:r.type=t.type}updateTexture(t){var n;const r=t._glTextures[this.CONTEXT_UID];if(!r)return;const i=this.renderer;if(this.initTextureType(t,r),(n=t.resource)!=null&&n.upload(i,t,r))r.samplerType!==cu.FLOAT&&(this.hasIntegerTextures=!0);else{const o=t.realWidth,l=t.realHeight,h=i.gl;(r.width!==o||r.height!==l||r.dirtyId<0)&&(r.width=o,r.height=l,h.texImage2D(t.target,0,r.internalFormat,o,l,0,t.format,r.type,null))}t.dirtyStyleId!==r.dirtyStyleId&&this.updateTextureStyle(t),r.dirtyId=t.dirtyId}destroyTexture(t,r){const{gl:i}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!r)){const n=this.managedTextures.indexOf(t);n!==-1&&In(this.managedTextures,n,1)}}updateTextureStyle(t){var i;const r=t._glTextures[this.CONTEXT_UID];r&&((t.mipmap===Dr.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?r.mipmap=!1:r.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?r.wrapMode=ci.CLAMP:r.wrapMode=t.wrapMode,(i=t.resource)!=null&&i.style(this.renderer,t,r)||this.setStyle(t,r),r.dirtyStyleId=t.dirtyStyleId)}setStyle(t,r){const i=this.gl;if(r.mipmap&&t.mipmap!==Dr.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,r.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,r.wrapMode),r.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===zr.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const n=this.renderer.context.extensions.anisotropicFiltering;if(n&&t.anisotropicLevel>0&&t.scaleMode===zr.LINEAR){const o=Math.min(t.anisotropicLevel,i.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,o)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===zr.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===zr.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}iv.extension={type:Z.RendererSystem,name:"texture"};nt.add(iv);class nv{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:r,CONTEXT_UID:i}=this,n=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,r){const{gl:i,renderer:n}=this;r&&n.shader.bind(r),i.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:r,renderer:i,CONTEXT_UID:n}=this,o=r.createTransformFeedback();t._glTransformFeedbacks[n]=o,r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,o);for(let l=0;l<t.buffers.length;l++){const h=t.buffers[l];h&&(i.buffer.update(h),h._glBuffers[n].refCount++,r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,l,h._glBuffers[n].buffer||null))}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),o}disposeTransformFeedback(t,r){const i=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const o=this.renderer.buffer;if(o)for(let l=0;l<t.buffers.length;l++){const h=t.buffers[l];if(!h)continue;const u=h._glBuffers[this.CONTEXT_UID];u&&(u.refCount--,u.refCount===0&&!r&&o.dispose(h,r))}i&&(r||n.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}nv.extension={type:Z.RendererSystem,name:"transformFeedback"};nt.add(nv);class sv{constructor(t){this.renderer=t}init(t){this.screen=new Tt(0,0,t.width,t.height),this.element=t.view||J.ADAPTER.createCanvas(),this.resolution=t.resolution||J.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,r){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(r*this.resolution);const i=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=i,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",i,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var r;t&&((r=this.element.parentNode)==null||r.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}sv.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"_view"};nt.add(sv);J.PREFER_ENV=Yi.WEBGL2;J.STRICT_TEXTURE_CACHE=!1;Object.defineProperties(J,{WRAP_MODE:{get(){return pt.defaultOptions.wrapMode},set(e){Ct("7.1.0","settings.WRAP_MODE is deprecated, use BaseTeture.defaultOptions.wrapMode"),pt.defaultOptions.wrapMode=e}},SCALE_MODE:{get(){return pt.defaultOptions.scaleMode},set(e){Ct("7.1.0","settings.SCALE_MODE is deprecated, use BaseTeture.defaultOptions.scaleMode"),pt.defaultOptions.scaleMode=e}},MIPMAP_TEXTURES:{get(){return pt.defaultOptions.mipmap},set(e){Ct("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTeture.defaultOptions.mipmap"),pt.defaultOptions.mipmap=e}},ANISOTROPIC_LEVEL:{get(){return pt.defaultOptions.anisotropicLevel},set(e){Ct("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTeture.defaultOptions.anisotropicLevel"),pt.defaultOptions.anisotropicLevel=e}},FILTER_RESOLUTION:{get(){return Ct("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Ae.defaultResolution},set(e){Ae.defaultResolution=e}},FILTER_MULTISAMPLE:{get(){return Ct("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Ae.defaultMultisample},set(e){Ae.defaultMultisample=e}},SPRITE_MAX_TEXTURES:{get(){return hr.defaultMaxTextures},set(e){Ct("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),hr.defaultMaxTextures=e}},SPRITE_BATCH_SIZE:{get(){return hr.defaultBatchSize},set(e){Ct("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),hr.defaultBatchSize=e}},CAN_UPLOAD_SAME_BUFFER:{get(){return hr.canUploadSameBuffer},set(e){Ct("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),hr.canUploadSameBuffer=e}},GC_MODE:{get(){return ur.defaultMode},set(e){Ct("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),ur.defaultMode=e}},GC_MAX_IDLE:{get(){return ur.defaultMaxIdle},set(e){Ct("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),ur.defaultMaxIdle=e}},GC_MAX_CHECK_COUNT:{get(){return ur.defaultCheckCountMax},set(e){Ct("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),ur.defaultCheckCountMax=e}},PRECISION_VERTEX:{get(){return cr.defaultVertexPrecision},set(e){Ct("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),cr.defaultVertexPrecision=e}},PRECISION_FRAGMENT:{get(){return cr.defaultFragmentPrecision},set(e){Ct("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),cr.defaultFragmentPrecision=e}}});var On=(e=>(e[e.HIGH=25]="HIGH",e[e.NORMAL=0]="NORMAL",e[e.LOW=-25]="LOW",e[e.UTILITY=-50]="UTILITY",e))(On||{});class $h{constructor(t,r=null,i=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=r,this.priority=i,this.once=n}match(t,r=null){return this.fn===t&&this.context===r}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const r=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),r}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const r=this.next;return this.next=t?null:r,this.previous=null,r}}const ke=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new $h(null,null,1/0),this.deltaMS=1/ke.targetFPMS,this.elapsedMS=1/ke.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,r=On.NORMAL){return this._addListener(new $h(e,t,r))}addOnce(e,t,r=On.NORMAL){return this._addListener(new $h(e,t,r,!0))}_addListener(e){let t=this._head.next,r=this._head;if(!t)e.connect(r);else{for(;t;){if(e.priority>t.priority){e.connect(r);break}r=t,t=t.next}e.previous||e.connect(r)}return this._startIfPossible(),this}remove(e,t){let r=this._head.next;for(;r;)r.match(e,t)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const n=e-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=e-n%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*ke.targetFPMS;const r=this._head;let i=r.next;for(;i;)i=i.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),r=Math.min(Math.max(0,t)/1e3,ke.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!ke._shared){const e=ke._shared=new ke;e.autoStart=!0,e._protected=!0}return ke._shared}static get system(){if(!ke._system){const e=ke._system=new ke;e.autoStart=!0,e._protected=!0}return ke._system}};let Me=ke;Me.targetFPMS=.06;Object.defineProperties(J,{TARGET_FPMS:{get(){return Me.targetFPMS},set(e){Ct("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Me.targetFPMS=e}}});class ov{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(r){this._ticker&&this._ticker.remove(this.render,this),this._ticker=r,r&&r.add(this.render,this,On.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Me.shared:new Me,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}ov.extension=Z.Application;nt.add(ov);const av=[];nt.handleByList(Z.Renderer,av);function iM(e){for(const t of av)if(t.test(e))return new t(e);throw new Error("Unable to auto-detect a suitable renderer.")}var nM=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,sM=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const oM=nM,lv=sM;class hv{constructor(t){this.renderer=t}contextChange(t){let r;if(this.renderer.context.webGLVersion===1){const i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),r=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{const i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),r=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}r>=se.HIGH?this.multisample=se.HIGH:r>=se.MEDIUM?this.multisample=se.MEDIUM:r>=se.LOW?this.multisample=se.LOW:this.multisample=se.NONE}destroy(){}}hv.extension={type:Z.RendererSystem,name:"_multisample"};nt.add(hv);class aM{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class uv{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:r,CONTEXT_UID:i}=this,n=t._glBuffers[i]||this.createGLBuffer(t);r.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:r}=this;r.bindBuffer(t,null)}bindBufferBase(t,r){const{gl:i,CONTEXT_UID:n}=this;if(this.boundBufferBases[r]!==t){const o=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[r]=t,i.bindBufferBase(i.UNIFORM_BUFFER,r,o.buffer)}}bindBufferRange(t,r,i){const{gl:n,CONTEXT_UID:o}=this;i=i||0;const l=t._glBuffers[o]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,r||0,l.buffer,i*256,256)}update(t){const{gl:r,CONTEXT_UID:i}=this,n=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,r.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)r.bufferSubData(t.type,0,t.data);else{const o=t.static?r.STATIC_DRAW:r.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,r.bufferData(t.type,t.data,o)}}dispose(t,r){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const i=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),i&&(r||n.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const r=Object.keys(this.managedBuffers);for(let i=0;i<r.length;i++)this.dispose(this.managedBuffers[r[i]],t)}createGLBuffer(t){const{CONTEXT_UID:r,gl:i}=this;return t._glBuffers[r]=new aM(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[r]}}uv.extension={type:Z.RendererSystem,name:"buffer"};nt.add(uv);class cv{constructor(t){this.renderer=t}render(t,r){const i=this.renderer;let n,o,l,h;if(r&&(n=r.renderTexture,o=r.clear,l=r.transform,h=r.skipUpdateTransform),this.renderingToScreen=!n,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=l,!i.context.isLost){if(n||(this.lastObjectRendered=t),!h){const u=t.enableTempParent();t.updateTransform(),t.disableTempParent(u)}i.renderTexture.bind(n),i.batch.currentRenderer.start(),(o??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),n&&(r.blit&&i.framebuffer.blit(),n.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}cv.extension={type:Z.RendererSystem,name:"objectRenderer"};nt.add(cv);const Ou=class extends eM{constructor(e){super(),e=Object.assign({},J.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new gr({projectionMatrix:new $t},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Ou.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in e&&(Ct("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&e.useContextAlpha!=="notMultiplied",e.backgroundAlpha=e.useContextAlpha===!1?1:e.backgroundAlpha);const r={hello:e.hello,_plugin:Ou.__plugins,background:{alpha:e.backgroundAlpha,color:e.background??e.backgroundColor,clearBeforeRender:e.clearBeforeRender},_view:{height:e.height,width:e.width,autoDensity:e.autoDensity,resolution:e.resolution,view:e.view},context:{antialias:e.antialias,context:e.context,powerPreference:e.powerPreference,premultipliedAlpha:e.premultipliedAlpha,preserveDrawingBuffer:e.preserveDrawingBuffer}};this.startup.run(r),this.options=e}static test(e){return e!=null&&e.forceCanvas?!1:rC()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Ct("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Ct("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Ct("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Ct("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){Ct("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return Ct("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.color}set backgroundAlpha(e){Ct("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return Ct("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};let $n=Ou;$n.extension={type:Z.Renderer,priority:1};$n.__plugins={};$n.__systems={};nt.handleByMap(Z.RendererPlugin,$n.__plugins);nt.handleByMap(Z.RendererSystem,$n.__systems);nt.add($n);class fv extends Ps{constructor(t,r){const{width:i,height:n}=r||{};super(i,n),this.items=[],this.itemDirtyIds=[];for(let o=0;o<t;o++){const l=new pt;this.items.push(l),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,r){for(let i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof Ps?this.addResourceAt(t[i],i):this.addResourceAt(Am(t[i],r),i))}dispose(){for(let t=0,r=this.length;t<r;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,r){if(!this.items[r])throw new Error(`Index ${r} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[r].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let r=0;r<this.length;r++)this.items[r].parentTextureArray=t,this.items[r].on("update",t.update,t)}unbind(t){super.unbind(t);for(let r=0;r<this.length;r++)this.items[r].parentTextureArray=null,this.items[r].off("update",t.update,t)}load(){if(this._load)return this._load;const r=this.items.map(i=>i.resource).filter(i=>i).map(i=>i.load());return this._load=Promise.all(r).then(()=>{const{realWidth:i,realHeight:n}=this.items[0];return this.resize(i,n),Promise.resolve(this)}),this._load}}class lM extends fv{constructor(t,r){const{width:i,height:n}=r||{};let o,l;Array.isArray(t)?(o=t,l=t.length):l=t,super(l,{width:i,height:n}),o&&this.initFromArray(o,r)}addBaseTextureAt(t,r){if(t.resource)this.addResourceAt(t.resource,r);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=An.TEXTURE_2D_ARRAY}upload(t,r,i){const{length:n,itemDirtyIds:o,items:l}=this,{gl:h}=t;i.dirtyId<0&&h.texImage3D(h.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,n,0,r.format,i.type,null);for(let u=0;u<n;u++){const f=l[u];o[u]<f.dirtyId&&(o[u]=f.dirtyId,f.valid&&h.texSubImage3D(h.TEXTURE_2D_ARRAY,0,0,0,u,f.resource.width,f.resource.height,1,r.format,i.type,f.resource.source))}return!0}}class hM extends pi{constructor(t){super(t)}static test(t){const{OffscreenCanvas:r}=globalThis;return r&&t instanceof r?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const _s=class extends fv{constructor(e,t){const{width:r,height:i,autoLoad:n,linkBaseTexture:o}=t||{};if(e&&e.length!==_s.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:r,height:i});for(let l=0;l<_s.SIDES;l++)this.items[l].target=An.TEXTURE_CUBE_MAP_POSITIVE_X+l;this.linkBaseTexture=o!==!1,e&&this.initFromArray(e,t),n!==!1&&this.load()}bind(e){super.bind(e),e.target=An.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,r){if(r===void 0&&(r=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=An.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(e,t,r){const i=this.itemDirtyIds;for(let n=0;n<_s.SIDES;n++){const o=this.items[n];(i[n]<o.dirtyId||r.dirtyId<t.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(e,o,r),i[n]=o.dirtyId):i[n]<-1&&(e.gl.texImage2D(o.target,0,r.internalFormat,t.realWidth,t.realHeight,0,t.format,r.type,null),i[n]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===_s.SIDES}};let dv=_s;dv.SIDES=6;class wn extends pi{constructor(t,r){var i=(...n)=>{super(...n)};r=r||{},typeof t=="string"?(i(wn.EMPTY),this.url=t):(i(t),this.url=null),this.crossOrigin=r.crossOrigin??!0,this.alphaMode=typeof r.alphaMode=="number"?r.alphaMode:null,this._load=null,r.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,r)=>{if(this.url===null){t(this);return}try{const i=await J.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await i.blob();if(this.destroyed)return;const o=await createImageBitmap(n,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===mr.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=o,this.update(),t(this)}catch(i){if(this.destroyed)return;r(i),this.onError.emit(i)}}),this._load)}upload(t,r,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(r.alphaMode=this.alphaMode),super.upload(t,r,i)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return wn._EMPTY=wn._EMPTY??J.ADAPTER.createCanvas(0,0),wn._EMPTY}}const ua=class extends pi{constructor(e,t){t=t||{},super(J.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(e=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),e(this)},ua.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const e=new Image;pi.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,r=e.height;if(!t||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let i=t*this.scale,n=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(i=this._overrideWidth||this._overrideHeight/r*t,n=this._overrideHeight||this._overrideWidth/t*r),i=Math.round(i),n=Math.round(n);const o=this.source;o.width=i,o.height=n,o._pixiId=`canvas_${Xi()}`,o.getContext("2d").drawImage(e,0,0,t,r,0,0,i,n),this._resolve(),this._resolve=null}}static getSize(e){const t=ua.SVG_SIZE.exec(e),r={};return t&&(r[t[1]]=Math.round(parseFloat(t[3])),r[t[5]]=Math.round(parseFloat(t[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,t){return t==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&ua.SVG_XML.test(e)}};let Ms=ua;Ms.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;Ms.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const Fu=class extends pi{constructor(e,t){if(t=t||{},!(e instanceof HTMLVideoElement)){const r=document.createElement("video");r.setAttribute("preload","auto"),r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline",""),typeof e=="string"&&(e=[e]);const i=e[0].src||e[0];pi.crossOrigin(r,i,t.crossorigin);for(let n=0;n<e.length;++n){const o=document.createElement("source");let{src:l,mime:h}=e[n];l=l||e[n];const u=l.split("?").shift().toLowerCase(),f=u.slice(u.lastIndexOf(".")+1);h=h||Fu.MIME_TYPES[f]||`video/${f}`,o.src=l,o.type=h,r.appendChild(o)}e=r}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),t.autoLoad!==!1&&this.load()}update(e=0){if(!this.destroyed){const t=Me.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Me.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Me.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(e.videoWidth,e.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._isConnectedToTicker&&(Me.shared.remove(this.update,this),this._isConnectedToTicker=!1);const e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(Me.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Me.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e)}static test(e,t){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||Fu.TYPES.includes(t)}};let gc=Fu;gc.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];gc.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};Iu.push(wn,Nm,hM,gc,Ms,Ns,dv,lM);class Aa{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Tt.EMPTY:(t=t||new Tt(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,r){const{a:i,b:n,c:o,d:l,tx:h,ty:u}=t,f=i*r.x+o*r.y+h,d=n*r.x+l*r.y+u;this.minX=Math.min(this.minX,f),this.maxX=Math.max(this.maxX,f),this.minY=Math.min(this.minY,d),this.maxY=Math.max(this.maxY,d)}addQuad(t){let r=this.minX,i=this.minY,n=this.maxX,o=this.maxY,l=t[0],h=t[1];r=l<r?l:r,i=h<i?h:i,n=l>n?l:n,o=h>o?h:o,l=t[2],h=t[3],r=l<r?l:r,i=h<i?h:i,n=l>n?l:n,o=h>o?h:o,l=t[4],h=t[5],r=l<r?l:r,i=h<i?h:i,n=l>n?l:n,o=h>o?h:o,l=t[6],h=t[7],r=l<r?l:r,i=h<i?h:i,n=l>n?l:n,o=h>o?h:o,this.minX=r,this.minY=i,this.maxX=n,this.maxY=o}addFrame(t,r,i,n,o){this.addFrameMatrix(t.worldTransform,r,i,n,o)}addFrameMatrix(t,r,i,n,o){const l=t.a,h=t.b,u=t.c,f=t.d,d=t.tx,g=t.ty;let m=this.minX,v=this.minY,y=this.maxX,w=this.maxY,x=l*r+u*i+d,A=h*r+f*i+g;m=x<m?x:m,v=A<v?A:v,y=x>y?x:y,w=A>w?A:w,x=l*n+u*i+d,A=h*n+f*i+g,m=x<m?x:m,v=A<v?A:v,y=x>y?x:y,w=A>w?A:w,x=l*r+u*o+d,A=h*r+f*o+g,m=x<m?x:m,v=A<v?A:v,y=x>y?x:y,w=A>w?A:w,x=l*n+u*o+d,A=h*n+f*o+g,m=x<m?x:m,v=A<v?A:v,y=x>y?x:y,w=A>w?A:w,this.minX=m,this.minY=v,this.maxX=y,this.maxY=w}addVertexData(t,r,i){let n=this.minX,o=this.minY,l=this.maxX,h=this.maxY;for(let u=r;u<i;u+=2){const f=t[u],d=t[u+1];n=f<n?f:n,o=d<o?d:o,l=f>l?f:l,h=d>h?d:h}this.minX=n,this.minY=o,this.maxX=l,this.maxY=h}addVertices(t,r,i,n){this.addVerticesMatrix(t.worldTransform,r,i,n)}addVerticesMatrix(t,r,i,n,o=0,l=o){const h=t.a,u=t.b,f=t.c,d=t.d,g=t.tx,m=t.ty;let v=this.minX,y=this.minY,w=this.maxX,x=this.maxY;for(let A=i;A<n;A+=2){const S=r[A],E=r[A+1],I=h*S+f*E+g,D=d*E+u*S+m;v=Math.min(v,I-o),w=Math.max(w,I+o),y=Math.min(y,D-l),x=Math.max(x,D+l)}this.minX=v,this.minY=y,this.maxX=w,this.maxY=x}addBounds(t){const r=this.minX,i=this.minY,n=this.maxX,o=this.maxY;this.minX=t.minX<r?t.minX:r,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>o?t.maxY:o}addBoundsMask(t,r){const i=t.minX>r.minX?t.minX:r.minX,n=t.minY>r.minY?t.minY:r.minY,o=t.maxX<r.maxX?t.maxX:r.maxX,l=t.maxY<r.maxY?t.maxY:r.maxY;if(i<=o&&n<=l){const h=this.minX,u=this.minY,f=this.maxX,d=this.maxY;this.minX=i<h?i:h,this.minY=n<u?n:u,this.maxX=o>f?o:f,this.maxY=l>d?l:d}}addBoundsMatrix(t,r){this.addFrameMatrix(r,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,r){const i=t.minX>r.x?t.minX:r.x,n=t.minY>r.y?t.minY:r.y,o=t.maxX<r.x+r.width?t.maxX:r.x+r.width,l=t.maxY<r.y+r.height?t.maxY:r.y+r.height;if(i<=o&&n<=l){const h=this.minX,u=this.minY,f=this.maxX,d=this.maxY;this.minX=i<h?i:h,this.minY=n<u?n:u,this.maxX=o>f?o:f,this.maxY=l>d?l:d}}pad(t=0,r=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=r,this.maxY+=r)}addFramePad(t,r,i,n,o,l){t-=o,r-=l,i+=o,n+=l,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<r?this.minY:r,this.maxY=this.maxY>n?this.maxY:n}}class Vt extends Os{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new pc,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Aa,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const r=Object.keys(t);for(let i=0;i<r.length;++i){const n=r[i];Object.defineProperty(Vt.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,r){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),r||(this._boundsRect||(this._boundsRect=new Tt),r=this._boundsRect),this._bounds.getRectangle(r)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Tt),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Aa);const r=this.transform,i=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,o=this._boundsID;this._bounds=this._localBounds;const l=this.getBounds(!1,t);return this.parent=i,this.transform=r,this._bounds=n,this._bounds.updateID+=this._boundsID-o,l}toGlobal(t,r,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,r)}toLocal(t,r,i,n){return r&&(t=r.toGlobal(t,i,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,r=0,i=1,n=1,o=0,l=0,h=0,u=0,f=0){return this.position.x=t,this.position.y=r,this.scale.x=i||1,this.scale.y=n||1,this.rotation=o,this.skew.x=l,this.skew.y=h,this.pivot.x=u,this.pivot.y=f,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new uM),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*oP}set angle(t){this.transform.rotation=t*aP}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount--,r._maskRefCount===0&&(r.renderable=!0,r.isMask=!1))}if(this._mask=t,this._mask){const r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount===0&&(r.renderable=!1,r.isMask=!0),r._maskRefCount++)}}}}class uM extends Vt{constructor(){super(...arguments),this.sortDirty=null}}Vt.prototype.displayObjectUpdateTransform=Vt.prototype.updateTransform;const cM=new $t;function fM(e,t){return e.zIndex===t.zIndex?e._lastSortedIndex-t._lastSortedIndex:e.zIndex-t.zIndex}const Lu=class extends Vt{constructor(){super(),this.children=[],this.sortableChildren=Lu.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const r=this.getChildIndex(e),i=this.getChildIndex(t);this.children[r]=t,this.children[i]=e,this.onChildrenChange(r<i?r:i)}getChildIndex(e){const t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(e);In(this.children,r,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],r=this.children.indexOf(t);if(r===-1)return null;t.parent=null,t.transform._parentID=-1,In(this.children,r,1),this._boundsID++,this.onChildrenChange(r),t.emit("removed",this),this.emit("childRemoved",t,this,r)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,In(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const r=e,i=t,n=i-r;let o;if(n>0&&n<=i){o=this.children.splice(r,n);for(let l=0;l<o.length;++l)o[l].parent=null,o[l].transform&&(o[l].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let l=0;l<o.length;++l)o[l].emit("removed",this),this.emit("childRemoved",o[l],this,l);return o}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,r=this.children.length;t<r;++t){const i=this.children[t];i._lastSortedIndex=t,!e&&i.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(fM),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const r=this.children[e];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(t._bounds,r._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const r=super.getLocalBounds(e);if(!t)for(let i=0,n=this.children.length;i<n;++i){const o=this.children[i];o.visible&&o.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(e){const t=e.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let r,i;this.cullArea?(r=this.cullArea,i=this.worldTransform):this._render!==Lu.prototype._render&&(r=this.getBounds(!0));const n=e.projection.transform;if(n&&(i?(i=cM.copyFrom(i),i.prepend(n)):i=n),r&&t.intersects(r,i))this._render(e);else if(this.cullArea)return;for(let o=0,l=this.children.length;o<l;++o){const h=this.children[o],u=h.cullable;h.cullable=u||!this.cullArea,h.render(e),h.cullable=u}}render(e){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(t=this.filters)!=null&&t.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let r=0,i=this.children.length;r<i;++r)this.children[r].render(e)}}renderAdvanced(e){var n,o,l;const t=this.filters,r=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let h=0;h<t.length;h++)t[h].enabled&&this._enabledFilters.push(t[h])}const i=t&&((n=this._enabledFilters)==null?void 0:n.length)||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==ue.NONE));if(i&&e.batch.flush(),t&&((o=this._enabledFilters)!=null&&o.length)&&e.filter.push(this,this._enabledFilters),r&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let h=0,u=this.children.length;h<u;++h)this.children[h].render(e)}i&&e.batch.flush(),r&&e.mask.pop(this),t&&((l=this._enabledFilters)!=null&&l.length)&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t=typeof e=="boolean"?e:e==null?void 0:e.children,r=this.removeChildren(0,this.children.length);if(t)for(let i=0;i<r.length;++i)r[i].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}};let Ge=Lu;Ge.defaultSortableChildren=!1;Ge.prototype.containerUpdateTransform=Ge.prototype.updateTransform;Object.defineProperties(J,{SORTABLE_CHILDREN:{get(){return Ge.defaultSortableChildren},set(e){Ct("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Ge.defaultSortableChildren=e}}});const gs=new St,dM=new Uint16Array([0,1,2,0,2,3]);class Hn extends Ge{constructor(t){super(),this._anchor=new ui(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=ut.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||it.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=dM,this.pluginName="batch",this.isSprite=!0,this._roundPixels=J.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=bn(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=bn(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const r=this.transform.worldTransform,i=r.a,n=r.b,o=r.c,l=r.d,h=r.tx,u=r.ty,f=this.vertexData,d=t.trim,g=t.orig,m=this._anchor;let v=0,y=0,w=0,x=0;if(d?(y=d.x-m._x*g.width,v=y+d.width,x=d.y-m._y*g.height,w=x+d.height):(y=-m._x*g.width,v=y+g.width,x=-m._y*g.height,w=x+g.height),f[0]=i*y+o*x+h,f[1]=l*x+n*y+u,f[2]=i*v+o*x+h,f[3]=l*x+n*v+u,f[4]=i*v+o*w+h,f[5]=l*w+n*v+u,f[6]=i*y+o*w+h,f[7]=l*w+n*y+u,this._roundPixels){const A=J.RESOLUTION;for(let S=0;S<f.length;++S)f[S]=Math.round(f[S]*A)/A}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,r=this.vertexTrimmedData,i=t.orig,n=this._anchor,o=this.transform.worldTransform,l=o.a,h=o.b,u=o.c,f=o.d,d=o.tx,g=o.ty,m=-n._x*i.width,v=m+i.width,y=-n._y*i.height,w=y+i.height;r[0]=l*m+u*y+d,r[1]=f*y+h*m+g,r[2]=l*v+u*y+d,r[3]=f*y+h*v+g,r[4]=l*v+u*w+d,r[5]=f*w+h*v+g,r[6]=l*m+u*w+d,r[7]=f*w+h*m+g}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,r=this._texture.orig;!t||t.width===r.width&&t.height===r.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new Aa),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Tt),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,gs);const r=this._texture.orig.width,i=this._texture.orig.height,n=-r*this.anchor.x;let o=0;return gs.x>=n&&gs.x<n+r&&(o=-i*this.anchor.y,gs.y>=o&&gs.y<o+i)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const i=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!i)}this._texture=null}static from(t,r){const i=t instanceof it?t:it.from(t,r);return new Hn(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const r=bn(this.scale.x)||1;this.scale.x=r*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const r=bn(this.scale.y)||1;this.scale.y=r*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tint}set tint(t){this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16)}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||it.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const pv=new $t;Vt.prototype._cacheAsBitmap=!1;Vt.prototype._cacheData=null;Vt.prototype._cacheAsBitmapResolution=null;Vt.prototype._cacheAsBitmapMultisample=null;class pM{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Vt.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(e){e!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(e){e!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(e){if(this._cacheAsBitmap===e)return;this._cacheAsBitmap=e;let t;e?(this._cacheData||(this._cacheData=new pM),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});Vt.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))};Vt.prototype._initCachedDisplayObject=function(t){var m,v;if((m=this._cacheData)!=null&&m.sprite)return;const r=this.alpha;this.alpha=1,t.batch.flush();const i=this.getLocalBounds(null,!0).clone();if((v=this.filters)!=null&&v.length){const y=this.filters[0].padding;i.pad(y)}i.ceil(J.RESOLUTION);const n=t.renderTexture.current,o=t.renderTexture.sourceFrame.clone(),l=t.renderTexture.destinationFrame.clone(),h=t.projection.transform,u=gi.create({width:i.width,height:i.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),f=`cacheAsBitmap_${Xi()}`;this._cacheData.textureCacheId=f,pt.addToCache(u.baseTexture,f),it.addToCache(u,f);const d=this.transform.localTransform.copyTo(pv).invert().translate(-i.x,-i.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:u,clear:!0,transform:d,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=h,t.renderTexture.bind(n,o,l),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const g=new Hn(u);g.transform.worldTransform=this.transform.worldTransform,g.anchor.x=-(i.x/i.width),g.anchor.y=-(i.y/i.height),g.alpha=r,g._bounds=this._bounds,this._cacheData.sprite=g,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=g.containsPoint.bind(g)};Vt.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))};Vt.prototype._initCachedDisplayObjectCanvas=function(t){var d;if((d=this._cacheData)!=null&&d.sprite)return;const r=this.getLocalBounds(null,!0),i=this.alpha;this.alpha=1;const n=t.canvasContext.activeContext,o=t._projTransform;r.ceil(J.RESOLUTION);const l=gi.create({width:r.width,height:r.height}),h=`cacheAsBitmap_${Xi()}`;this._cacheData.textureCacheId=h,pt.addToCache(l.baseTexture,h),it.addToCache(l,h);const u=pv;this.transform.localTransform.copyTo(u),u.invert(),u.tx-=r.x,u.ty-=r.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:l,clear:!0,transform:u,skipUpdateTransform:!1}),t.canvasContext.activeContext=n,t._projTransform=o,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const f=new Hn(l);f.transform.worldTransform=this.transform.worldTransform,f.anchor.x=-(r.x/r.width),f.anchor.y=-(r.y/r.height),f.alpha=i,f._bounds=this._bounds,this._cacheData.sprite=f,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=f.containsPoint.bind(f)};Vt.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};Vt.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};Vt.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,pt.removeFromCache(this._cacheData.textureCacheId),it.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};Vt.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)};Vt.prototype.name=null;Ge.prototype.getChildByName=function(t,r){for(let i=0,n=this.children.length;i<n;i++)if(this.children[i].name===t)return this.children[i];if(r)for(let i=0,n=this.children.length;i<n;i++){const o=this.children[i];if(!o.getChildByName)continue;const l=o.getChildByName(t,!0);if(l)return l}return null};Vt.prototype.getGlobalPosition=function(t=new St,r=!1){return this.parent?this.parent.toGlobal(this.position,t,r):(t.x=this.position.x,t.y=this.position.y),t};var gM=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class mM extends Ae{constructor(t=1){super(oM,gM,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const vM={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},_M=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function yM(e){const t=vM[e],r=t.length;let i=_M,n="";const o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let l;for(let h=0;h<e;h++){let u=o.replace("%index%",h.toString());l=h,h>=r&&(l=e-h-1),u=u.replace("%value%",t[l].toString()),n+=u,n+=`
`}return i=i.replace("%blur%",n),i=i.replace("%size%",e.toString()),i}const xM=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function bM(e,t){const r=Math.ceil(e/2);let i=xM,n="",o;t?o="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":o="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let l=0;l<e;l++){let h=o.replace("%index%",l.toString());h=h.replace("%sampleIndex%",`${l-(r-1)}.0`),n+=h,n+=`
`}return i=i.replace("%blur%",n),i=i.replace("%size%",e.toString()),i}class Nu extends Ae{constructor(t,r=8,i=4,n=J.FILTER_RESOLUTION,o=5){const l=bM(o,t),h=yM(o);super(l,h),this.horizontal=t,this.resolution=n,this._quality=0,this.quality=i,this.blur=r}apply(t,r,i,n){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/r.width):this.uniforms.strength=1/i.height*(i.height/r.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/r.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/r.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,r,i,n);else{const o=t.getFilterTexture(),l=t.renderer;let h=r,u=o;this.state.blend=!1,t.applyFilter(this,h,u,Ar.CLEAR);for(let f=1;f<this.passes-1;f++){t.bindAndClear(h,Ar.BLIT),this.uniforms.uSampler=u;const d=u;u=h,h=d,l.shader.bind(this),l.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,u,i,n),t.returnFilterTexture(o)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class wM extends Ae{constructor(t=8,r=4,i=Ae.defaultResolution,n=5){super(),this.blurXFilter=new Nu(!0,t,r,i,n),this.blurYFilter=new Nu(!1,t,r,i,n),this.resolution=i,this.quality=r,this.blur=t,this.repeatEdgePixels=!1}apply(t,r,i,n){const o=Math.abs(this.blurXFilter.strength),l=Math.abs(this.blurYFilter.strength);if(o&&l){const h=t.getFilterTexture();this.blurXFilter.apply(t,r,h,Ar.CLEAR),this.blurYFilter.apply(t,h,i,n),t.returnFilterTexture(h)}else l?this.blurYFilter.apply(t,r,i,n):this.blurXFilter.apply(t,r,i,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var EM=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class ku extends Ae{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(lv,EM,t),this.alpha=1}_loadMatrix(t,r=!1){let i=t;r&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,r,i){return t[0]=r[0]*i[0]+r[1]*i[5]+r[2]*i[10]+r[3]*i[15],t[1]=r[0]*i[1]+r[1]*i[6]+r[2]*i[11]+r[3]*i[16],t[2]=r[0]*i[2]+r[1]*i[7]+r[2]*i[12]+r[3]*i[17],t[3]=r[0]*i[3]+r[1]*i[8]+r[2]*i[13]+r[3]*i[18],t[4]=r[0]*i[4]+r[1]*i[9]+r[2]*i[14]+r[3]*i[19]+r[4],t[5]=r[5]*i[0]+r[6]*i[5]+r[7]*i[10]+r[8]*i[15],t[6]=r[5]*i[1]+r[6]*i[6]+r[7]*i[11]+r[8]*i[16],t[7]=r[5]*i[2]+r[6]*i[7]+r[7]*i[12]+r[8]*i[17],t[8]=r[5]*i[3]+r[6]*i[8]+r[7]*i[13]+r[8]*i[18],t[9]=r[5]*i[4]+r[6]*i[9]+r[7]*i[14]+r[8]*i[19]+r[9],t[10]=r[10]*i[0]+r[11]*i[5]+r[12]*i[10]+r[13]*i[15],t[11]=r[10]*i[1]+r[11]*i[6]+r[12]*i[11]+r[13]*i[16],t[12]=r[10]*i[2]+r[11]*i[7]+r[12]*i[12]+r[13]*i[17],t[13]=r[10]*i[3]+r[11]*i[8]+r[12]*i[13]+r[13]*i[18],t[14]=r[10]*i[4]+r[11]*i[9]+r[12]*i[14]+r[13]*i[19]+r[14],t[15]=r[15]*i[0]+r[16]*i[5]+r[17]*i[10]+r[18]*i[15],t[16]=r[15]*i[1]+r[16]*i[6]+r[17]*i[11]+r[18]*i[16],t[17]=r[15]*i[2]+r[16]*i[7]+r[17]*i[12]+r[18]*i[17],t[18]=r[15]*i[3]+r[16]*i[8]+r[17]*i[13]+r[18]*i[18],t[19]=r[15]*i[4]+r[16]*i[9]+r[17]*i[14]+r[18]*i[19]+r[19],t}_colorMatrix(t){const r=new Float32Array(t);return r[4]/=255,r[9]/=255,r[14]/=255,r[19]/=255,r}brightness(t,r){const i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,r)}tint(t,r){const i=t>>16&255,n=t>>8&255,o=t&255,l=[i/255,0,0,0,0,0,n/255,0,0,0,0,0,o/255,0,0,0,0,0,1,0];this._loadMatrix(l,r)}greyscale(t,r){const i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,r)}blackAndWhite(t){const r=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(r,t)}hue(t,r){t=(t||0)/180*Math.PI;const i=Math.cos(t),n=Math.sin(t),o=Math.sqrt,l=1/3,h=o(l),u=i+(1-i)*l,f=l*(1-i)-h*n,d=l*(1-i)+h*n,g=l*(1-i)+h*n,m=i+l*(1-i),v=l*(1-i)-h*n,y=l*(1-i)-h*n,w=l*(1-i)+h*n,x=i+l*(1-i),A=[u,f,d,0,0,g,m,v,0,0,y,w,x,0,0,0,0,0,1,0];this._loadMatrix(A,r)}contrast(t,r){const i=(t||0)+1,n=-.5*(i-1),o=[i,0,0,0,n,0,i,0,0,n,0,0,i,0,n,0,0,0,1,0];this._loadMatrix(o,r)}saturate(t=0,r){const i=t*2/3+1,n=(i-1)*-.5,o=[i,n,n,0,0,n,i,n,0,0,n,n,i,0,0,0,0,0,1,0];this._loadMatrix(o,r)}desaturate(){this.saturate(-1)}negative(t){const r=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(r,t)}sepia(t){const r=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(r,t)}technicolor(t){const r=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(r,t)}polaroid(t){const r=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(r,t)}toBGR(t){const r=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(r,t)}kodachrome(t){const r=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(r,t)}browni(t){const r=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(r,t)}vintage(t){const r=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(r,t)}colorTone(t,r,i,n,o){t=t||.2,r=r||.15,i=i||16770432,n=n||3375104;const l=(i>>16&255)/255,h=(i>>8&255)/255,u=(i&255)/255,f=(n>>16&255)/255,d=(n>>8&255)/255,g=(n&255)/255,m=[.3,.59,.11,0,0,l,h,u,t,0,f,d,g,r,0,l-f,h-d,u-g,0,0];this._loadMatrix(m,o)}night(t,r){t=t||.1;const i=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(i,r)}predator(t,r){const i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,r)}lsd(t){const r=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(r,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}ku.prototype.grayscale=ku.prototype.greyscale;var TM=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,AM=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class SM extends Ae{constructor(t,r){const i=new $t;t.renderable=!1,super(AM,TM,{mapSampler:t._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=i,r==null&&(r=20),this.scale=new St(r,r)}apply(t,r,i,n){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const o=this.maskSprite.worldTransform,l=Math.sqrt(o.a*o.a+o.b*o.b),h=Math.sqrt(o.c*o.c+o.d*o.d);l!==0&&h!==0&&(this.uniforms.rotation[0]=o.a/l,this.uniforms.rotation[1]=o.b/l,this.uniforms.rotation[2]=o.c/h,this.uniforms.rotation[3]=o.d/h),t.applyFilter(this,r,i,n)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var CM=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,IM=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class RM extends Ae{constructor(){super(IM,CM)}}var PM=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class MM extends Ae{constructor(t=.5,r=Math.random()){super(lv,PM,{uNoise:0,uSeed:0}),this.noise=t,this.seed=r}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const ag={AlphaFilter:mM,BlurFilter:wM,BlurFilterPass:Nu,ColorMatrixFilter:ku,DisplacementFilter:SM,FXAAFilter:RM,NoiseFilter:MM};Object.entries(ag).forEach(([e,t])=>{Object.defineProperty(ag,e,{get(){return Ct("7.1.0",`filters.${e} has moved to ${e}`),t}})});class ks{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=ks.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new St,this.page=new St,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,r,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,r,i,n,o){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Sa extends ks{constructor(){super(...arguments),this.client=new St,this.movement=new St,this.offset=new St,this.global=new St,this.screen=new St}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,r,i,n,o,l,h,u,f,d,g,m,v,y,w){throw new Error("Method not implemented.")}}class ar extends Sa{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Uu extends Sa{constructor(){super(...arguments),this.DOM_DELTA_LINE=0,this.DOM_DELTA_PAGE=1,this.DOM_DELTA_PIXEL=2}}const DM=2048,BM=new St,Hh=new St;class OM{constructor(t){this.dispatch=new Os,this.moveOnAll=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,r){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:r,priority:0}),this.mappingTable[t].sort((i,n)=>i.priority-n.priority)}dispatchEvent(t,r){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,r),this.dispatch.emit(r||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const r=this.mappingTable[t.type];if(r)for(let i=0,n=r.length;i<n;i++)r[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,r){const i=this.hitTestRecursive(this.rootTarget,this.rootTarget.interactive,BM.set(t,r),this.hitTestFn,this.hitPruneFn);return i&&i[0]}propagate(t,r){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,o=i.length-1;n<o;n++)if(t.currentTarget=i[n],this.notifyTarget(t,r),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,r),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let n=i.length-2;n>=0;n--)if(t.currentTarget=i[n],this.notifyTarget(t,r),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,r,i=this.rootTarget){t.eventPhase=t.BUBBLING_PHASE;const n=i.children;if(n)for(let o=0;o<n.length;o++)this.all(t,r,n[o]);t.currentTarget=i,this.notifyTarget(t,r)}propagationPath(t){const r=[t];for(let i=0;i<DM&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");r.push(t.parent),t=t.parent}return r.reverse(),r}hitTestRecursive(t,r,i,n,o){if(!t||!t.visible||o(t,i))return null;if(t.interactiveChildren&&t.children){const l=t.children;for(let h=l.length-1;h>=0;h--){const u=l[h],f=this.hitTestRecursive(u,r||u.interactive,i,n,o);if(f){if(f.length>0&&!f[f.length-1].parent)continue;return(f.length>0||t.interactive)&&f.push(t),f}}}return r&&n(t,i)?t.interactive?[t]:[]:null}hitPruneFn(t,r){var i;if(t.hitArea&&(t.worldTransform.applyInverse(r,Hh),!t.hitArea.contains(Hh.x,Hh.y)))return!0;if(t._mask){const n=t._mask.isMaskData?t._mask.maskObject:t._mask;if(n&&!((i=n.containsPoint)!=null&&i.call(n,r)))return!0}return!1}hitTestFn(t,r){return t.hitArea?!0:t.containsPoint?t.containsPoint(r):!1}notifyTarget(t,r){var o,l;r=r??t.type;const i=`on${r}`;(l=(o=t.currentTarget)[i])==null||l.call(o,t);const n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${r}capture`:r;this.notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,r)}mapPointerDown(t){if(!(t instanceof ar)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerdown"),r.pointerType==="touch")this.dispatchEvent(r,"touchstart");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const n=r.button===2;this.dispatchEvent(r,n?"rightdown":"mousedown")}const i=this.trackingData(t.pointerId);i.pressTargetsByButton[t.button]=r.composedPath(),this.freeEvent(r)}mapPointerMove(t){var h;if(!(t instanceof ar)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.createPointerEvent(t),i=r.pointerType==="mouse"||r.pointerType==="pen",n=this.trackingData(t.pointerId),o=this.findMountedTarget(n.overTargets);if(n.overTargets&&o!==r.target){const u=t.type==="mousemove"?"mouseout":"pointerout",f=this.createPointerEvent(t,u,o);if(this.dispatchEvent(f,"pointerout"),i&&this.dispatchEvent(f,"mouseout"),!r.composedPath().includes(o)){const d=this.createPointerEvent(t,"pointerleave",o);for(d.eventPhase=d.AT_TARGET;d.target&&!r.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),i&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(f)}if(o!==r.target){const u=t.type==="mousemove"?"mouseover":"pointerover",f=this.clonePointerEvent(r,u);this.dispatchEvent(f,"pointerover"),i&&this.dispatchEvent(f,"mouseover");let d=o==null?void 0:o.parent;for(;d&&d!==this.rootTarget.parent&&d!==r.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const m=this.clonePointerEvent(r,"pointerenter");for(m.eventPhase=m.AT_TARGET;m.target&&m.target!==o&&m.target!==this.rootTarget.parent;)m.currentTarget=m.target,this.notifyTarget(m),i&&this.notifyTarget(m,"mouseenter"),m.target=m.target.parent;this.freeEvent(m)}this.freeEvent(f)}const l=this.moveOnAll?"all":"dispatchEvent";this[l](r,"pointermove"),r.pointerType==="touch"&&this[l](r,"touchmove"),i&&(this[l](r,"mousemove"),this.cursor=(h=r.target)==null?void 0:h.cursor),n.overTargets=r.composedPath(),this.freeEvent(r)}mapPointerOver(t){var l;if(!(t instanceof ar)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.trackingData(t.pointerId),i=this.createPointerEvent(t),n=i.pointerType==="mouse"||i.pointerType==="pen";this.dispatchEvent(i,"pointerover"),n&&this.dispatchEvent(i,"mouseover"),i.pointerType==="mouse"&&(this.cursor=(l=i.target)==null?void 0:l.cursor);const o=this.clonePointerEvent(i,"pointerenter");for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),n&&this.notifyTarget(o,"mouseenter"),o.target=o.target.parent;r.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(o)}mapPointerOut(t){if(!(t instanceof ar)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.trackingData(t.pointerId);if(r.overTargets){const i=t.pointerType==="mouse"||t.pointerType==="pen",n=this.findMountedTarget(r.overTargets),o=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(o),i&&this.dispatchEvent(o,"mouseout");const l=this.createPointerEvent(t,"pointerleave",n);for(l.eventPhase=l.AT_TARGET;l.target&&l.target!==this.rootTarget.parent;)l.currentTarget=l.target,this.notifyTarget(l),i&&this.notifyTarget(l,"mouseleave"),l.target=l.target.parent;r.overTargets=null,this.freeEvent(o),this.freeEvent(l)}this.cursor=null}mapPointerUp(t){if(!(t instanceof ar)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const h=i.button===2;this.dispatchEvent(i,h?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),o=this.findMountedTarget(n.pressTargetsByButton[t.button]);let l=o;if(o&&!i.composedPath().includes(o)){let h=o;for(;h&&!i.composedPath().includes(h);){if(i.currentTarget=h,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const u=i.button===2;this.notifyTarget(i,u?"rightupoutside":"mouseupoutside")}h=h.parent}delete n.pressTargetsByButton[t.button],l=h}if(l){const h=this.clonePointerEvent(i,"click");h.target=l,h.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:h.target,timeStamp:r});const u=n.clicksByButton[t.button];u.target===h.target&&r-u.timeStamp<200?++u.clickCount:u.clickCount=1,u.target=h.target,u.timeStamp=r,h.detail=u.clickCount,h.pointerType==="mouse"?this.dispatchEvent(h,"click"):h.pointerType==="touch"&&this.dispatchEvent(h,"tap"),this.dispatchEvent(h,"pointertap"),this.freeEvent(h)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof ar)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.trackingData(t.pointerId),i=this.findMountedTarget(r.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(i){let o=i;for(;o;)n.currentTarget=o,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch"?this.notifyTarget(n,"touchendoutside"):(n.pointerType==="mouse"||n.pointerType==="pen")&&this.notifyTarget(n,n.button===2?"rightupoutside":"mouseupoutside"),o=o.parent;delete r.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof Uu)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const r=this.createWheelEvent(t);this.dispatchEvent(r),this.freeEvent(r)}findMountedTarget(t){if(!t)return null;let r=t[0];for(let i=1;i<t.length&&t[i].parent===r;i++)r=t[i];return r}createPointerEvent(t,r,i){const n=this.allocateEvent(ar);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=i??this.hitTest(n.global.x,n.global.y),typeof r=="string"&&(n.type=r),n}createWheelEvent(t){const r=this.allocateEvent(Uu);return this.copyWheelData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t,r.target=this.hitTest(r.global.x,r.global.y),r}clonePointerEvent(t,r){const i=this.allocateEvent(ar);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=r??i.type,i}copyWheelData(t,r){r.deltaMode=t.deltaMode,r.deltaX=t.deltaX,r.deltaY=t.deltaY,r.deltaZ=t.deltaZ}copyPointerData(t,r){t instanceof ar&&r instanceof ar&&(r.pointerId=t.pointerId,r.width=t.width,r.height=t.height,r.isPrimary=t.isPrimary,r.pointerType=t.pointerType,r.pressure=t.pressure,r.tangentialPressure=t.tangentialPressure,r.tiltX=t.tiltX,r.tiltY=t.tiltY,r.twist=t.twist)}copyMouseData(t,r){t instanceof Sa&&r instanceof Sa&&(r.altKey=t.altKey,r.button=t.button,r.buttons=t.buttons,r.client.copyFrom(t.client),r.ctrlKey=t.ctrlKey,r.metaKey=t.metaKey,r.movement.copyFrom(t.movement),r.screen.copyFrom(t.screen),r.global.copyFrom(t.global))}copyData(t,r){r.isTrusted=t.isTrusted,r.srcElement=t.srcElement,r.timeStamp=performance.now(),r.type=t.type,r.detail=t.detail,r.view=t.view,r.which=t.which,r.layer.copyFrom(t.layer),r.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const r=this.eventPool.get(t).pop()||new t(this);return r.eventPhase=r.NONE,r.currentTarget=null,r.path=null,r.target=null,r}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const r=t.constructor;this.eventPool.has(r)||this.eventPool.set(r,[]),this.eventPool.get(r).push(t)}notifyListeners(t,r){const i=t.currentTarget._events[r];if(i)if("fn"in i)i.fn.call(i.context,t);else for(let n=0,o=i.length;n<o&&!t.propagationImmediatelyStopped;n++)i[n].fn.call(i[n].context,t)}}const FM=1,LM={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class gv{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new OM(null),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new ar(null),this.rootWheelEvent=new Uu(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}init(){const{view:t,resolution:r}=this.renderer;this.setTargetElement(t),this.resolution=r}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let r=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(r=!1),this.currentCursor===t)return;this.currentCursor=t;const i=this.cursorStyles[t];if(i)switch(typeof i){case"string":r&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":r&&Object.assign(this.domElement.style,i);break}else r&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}onPointerDown(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const r=this.normalizeToPointerData(t);this.autoPreventDefault&&r[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let i=0,n=r.length;i<n;i++){const o=r[i],l=this.bootstrapEvent(this.rootPointerEvent,o);this.rootBoundary.mapEvent(l)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const r=this.normalizeToPointerData(t);for(let i=0,n=r.length;i<n;i++){const o=this.bootstrapEvent(this.rootPointerEvent,r[i]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;let r=t.target;t.composedPath&&t.composedPath().length>0&&(r=t.composedPath()[0]);const i=r!==this.domElement?"outside":"",n=this.normalizeToPointerData(t);for(let o=0,l=n.length;o<l;o++){const h=this.bootstrapEvent(this.rootPointerEvent,n[o]);h.type+=i,this.rootBoundary.mapEvent(h)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const r=this.normalizeToPointerData(t);for(let i=0,n=r.length;i<n;i++){const o=this.bootstrapEvent(this.rootPointerEvent,r[i]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){const r=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(r)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,r,i){let n;this.domElement.parentElement?n=this.domElement.getBoundingClientRect():n={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const o=1/this.resolution;t.x=(r-n.left)*(this.domElement.width/n.width)*o,t.y=(i-n.top)*(this.domElement.height/n.height)*o}normalizeToPointerData(t){const r=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,n=t.changedTouches.length;i<n;i++){const o=t.changedTouches[i];typeof o.button>"u"&&(o.button=0),typeof o.buttons>"u"&&(o.buttons=1),typeof o.isPrimary>"u"&&(o.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof o.width>"u"&&(o.width=o.radiusX||1),typeof o.height>"u"&&(o.height=o.radiusY||1),typeof o.tiltX>"u"&&(o.tiltX=0),typeof o.tiltY>"u"&&(o.tiltY=0),typeof o.pointerType>"u"&&(o.pointerType="touch"),typeof o.pointerId>"u"&&(o.pointerId=o.identifier||0),typeof o.pressure>"u"&&(o.pressure=o.force||.5),typeof o.twist>"u"&&(o.twist=0),typeof o.tangentialPressure>"u"&&(o.tangentialPressure=0),typeof o.layerX>"u"&&(o.layerX=o.offsetX=o.clientX),typeof o.layerY>"u"&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,o.type=t.type,r.push(o)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const i=t;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=FM),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,r.push(i)}else r.push(t);return r}normalizeWheelEvent(t){const r=this.rootWheelEvent;return this.transferMouseData(r,t),r.deltaX=t.deltaX,r.deltaY=t.deltaY,r.deltaZ=t.deltaZ,r.deltaMode=t.deltaMode,this.mapPositionToPoint(r.screen,t.clientX,t.clientY),r.global.copyFrom(r.screen),r.offset.copyFrom(r.screen),r.nativeEvent=t,r.type=t.type,r}bootstrapEvent(t,r){return t.originalEvent=null,t.nativeEvent=r,t.pointerId=r.pointerId,t.width=r.width,t.height=r.height,t.isPrimary=r.isPrimary,t.pointerType=r.pointerType,t.pressure=r.pressure,t.tangentialPressure=r.tangentialPressure,t.tiltX=r.tiltX,t.tiltY=r.tiltY,t.twist=r.twist,this.transferMouseData(t,r),this.mapPositionToPoint(t.screen,r.clientX,r.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=r.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=LM[t.type]||t.type),t}transferMouseData(t,r){t.isTrusted=r.isTrusted,t.srcElement=r.srcElement,t.timeStamp=performance.now(),t.type=r.type,t.altKey=r.altKey,t.button=r.button,t.buttons=r.buttons,t.client.x=r.clientX,t.client.y=r.clientY,t.ctrlKey=r.ctrlKey,t.metaKey=r.metaKey,t.movement.x=r.movementX,t.movement.y=r.movementY,t.page.x=r.pageX,t.page.y=r.pageY,t.relatedTarget=null,t.shiftKey=r.shiftKey}}gv.extension={name:"events",type:[Z.RendererSystem,Z.CanvasRendererSystem]};nt.add(gv);const NM={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,ontouchstart:null,onwheel:null,interactive:!1,interactiveChildren:!0,hitArea:null,addEventListener(e,t,r){const i=typeof r=="boolean"&&r||typeof r=="object"&&r.capture,n=typeof t=="function"?void 0:t;e=i?`${e}capture`:e,t=typeof t=="function"?t:t.handleEvent,this.on(e,t,n)},removeEventListener(e,t,r){const i=typeof r=="boolean"&&r||typeof r=="object"&&r.capture,n=typeof t=="function"?void 0:t;e=i?`${e}capture`:e,t=typeof t=="function"?t:t.handleEvent,this.off(e,t,n)},dispatchEvent(e){if(!(e instanceof ks))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return e.defaultPrevented=!1,e.path=null,e.target=this,e.manager.dispatchEvent(e),!e.defaultPrevented}};Vt.mixin(NM);const kM={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Vt.mixin(kM);const UM=9,Vo=100,GM=0,WM=0,lg=2,hg=1,$M=-1e3,HM=-1e3,XM=2;class mv{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Vr.tablet||Vr.phone)&&this.createTouchHook();const r=document.createElement("div");r.style.width=`${Vo}px`,r.style.height=`${Vo}px`,r.style.position="absolute",r.style.top=`${GM}px`,r.style.left=`${WM}px`,r.style.zIndex=lg.toString(),this.div=r,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${hg}px`,t.style.height=`${hg}px`,t.style.position="absolute",t.style.top=`${$M}px`,t.style.left=`${HM}px`,t.style.zIndex=XM.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const r=t.children;if(r)for(let i=0;i<r.length;i++)this.updateAccessibleObjects(r[i])}update(){const t=performance.now();if(Vr.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:r,y:i,width:n,height:o}=this.renderer.view.getBoundingClientRect(),{width:l,height:h,resolution:u}=this.renderer,f=n/l*u,d=o/h*u;let g=this.div;g.style.left=`${r}px`,g.style.top=`${i}px`,g.style.width=`${l}px`,g.style.height=`${h}px`;for(let m=0;m<this.children.length;m++){const v=this.children[m];if(v.renderId!==this.renderId)v._accessibleActive=!1,In(this.children,m,1),this.div.removeChild(v._accessibleDiv),this.pool.push(v._accessibleDiv),v._accessibleDiv=null,m--;else{g=v._accessibleDiv;let y=v.hitArea;const w=v.worldTransform;v.hitArea?(g.style.left=`${(w.tx+y.x*w.a)*f}px`,g.style.top=`${(w.ty+y.y*w.d)*d}px`,g.style.width=`${y.width*w.a*f}px`,g.style.height=`${y.height*w.d*d}px`):(y=v.getBounds(),this.capHitArea(y),g.style.left=`${y.x*f}px`,g.style.top=`${y.y*d}px`,g.style.width=`${y.width*f}px`,g.style.height=`${y.height*d}px`,g.title!==v.accessibleTitle&&v.accessibleTitle!==null&&(g.title=v.accessibleTitle),g.getAttribute("aria-label")!==v.accessibleHint&&v.accessibleHint!==null&&g.setAttribute("aria-label",v.accessibleHint)),(v.accessibleTitle!==g.title||v.tabIndex!==g.tabIndex)&&(g.title=v.accessibleTitle,g.tabIndex=v.tabIndex,this.debug&&this.updateDebugHTML(g))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:r,height:i}=this.renderer;t.x+t.width>r&&(t.width=r-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let r=this.pool.pop();r||(r=document.createElement("button"),r.style.width=`${Vo}px`,r.style.height=`${Vo}px`,r.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",r.style.position="absolute",r.style.zIndex=lg.toString(),r.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?r.setAttribute("aria-live","off"):r.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?r.setAttribute("aria-relevant","additions"):r.setAttribute("aria-relevant","text"),r.addEventListener("click",this._onClick.bind(this)),r.addEventListener("focus",this._onFocus.bind(this)),r.addEventListener("focusout",this._onFocusOut.bind(this))),r.style.pointerEvents=t.accessiblePointerEvents,r.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?r.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(r.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&r.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(r),t._accessibleActive=!0,t._accessibleDiv=r,r.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,r){const{displayObject:i}=t.target,n=this.renderer.events.rootBoundary,o=Object.assign(new ks(n),{target:i});n.rootTarget=this.renderer.lastObjectRendered,r.forEach(l=>n.dispatchEvent(o,l))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===UM&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}mv.extension={name:"accessibility",type:[Z.RendererPlugin,Z.CanvasRendererPlugin]};nt.add(mv);const Gu=class{constructor(e){this.stage=new Ge,e=Object.assign({forceCanvas:!1},e),this.renderer=iM(e),Gu._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(e,t){const r=Gu._plugins.slice(0);r.reverse(),r.forEach(i=>{i.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};let mc=Gu;mc._plugins=[];nt.handleByList(Z.Application,mc._plugins);class vv{static init(t){Object.defineProperty(this,"resizeTo",{set(r){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=r,r&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let r,i;if(this._resizeTo===globalThis.window)r=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:o}=this._resizeTo;r=n,i=o}this.renderer.resize(r,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}vv.extension=Z.Application;nt.add(vv);const ug={loader:Z.LoadParser,resolver:Z.ResolveParser,cache:Z.CacheParser,detection:Z.DetectionParser};nt.handle(Z.Asset,e=>{const t=e.ref;Object.entries(ug).filter(([r])=>!!t[r]).forEach(([r,i])=>nt.add(Object.assign(t[r],{extension:t[r].extension??i})))},e=>{const t=e.ref;Object.keys(ug).filter(r=>!!t[r]).forEach(r=>nt.remove(t[r]))});class zM{constructor(t,r=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=r}add(t){t.forEach(r=>{this._assetList.push(r)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],r=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<r;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function _v(e,t){if(Array.isArray(t)){for(const r of t)if(e.startsWith(`data:${r}`))return!0;return!1}return e.startsWith(`data:${t}`)}function $a(e,t){const r=e.split("?")[0],i=ve.extname(r).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const Yr=(e,t)=>(Array.isArray(e)||(e=[e]),t?e.map(r=>typeof r=="string"?t(r):r):e);function yv(e,t,r,i,n){const o=t[r];for(let l=0;l<o.length;l++){const h=o[l];r<t.length-1?yv(e.replace(i[r],h),t,r+1,i,n):n.push(e.replace(i[r],h))}}function VM(e){const t=/\{(.*?)\}/g,r=e.match(t),i=[];if(r){const n=[];r.forEach(o=>{const l=o.substring(1,o.length-1).split(",");n.push(l)}),yv(e,n,0,r,i)}else i.push(e);return i}const Ca=e=>!Array.isArray(e);class YM{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const r=this._cache.get(t);return r||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),r}set(t,r){const i=Yr(t);let n;for(let h=0;h<this.parsers.length;h++){const u=this.parsers[h];if(u.test(r)){n=u.getCacheableAssets(i,r);break}}n||(n={},i.forEach(h=>{n[h]=r}));const o=Object.keys(n),l={cacheKeys:o,keys:i};if(i.forEach(h=>{this._cacheMap.set(h,l)}),o.forEach(h=>{this._cache.has(h)&&this._cache.get(h)!==r&&console.warn("[Cache] already has key:",h),this._cache.set(h,n[h])}),r instanceof it){const h=r;i.forEach(u=>{h.baseTexture!==it.EMPTY.baseTexture&&pt.addToCache(h.baseTexture,u),it.addToCache(h,u)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const r=this._cacheMap.get(t);r.cacheKeys.forEach(n=>{this._cache.delete(n)}),r.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const ms=new YM;class jM{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(t,r){const i={promise:null,parser:null};return i.promise=(async()=>{var o,l;let n=null;for(let h=0;h<this.parsers.length;h++){const u=this.parsers[h];if(u.load&&((o=u.test)!=null&&o.call(u,t,r,this))){n=await u.load(t,r,this),i.parser=u;break}}if(!i.parser)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has being added`),null;for(let h=0;h<this.parsers.length;h++){const u=this.parsers[h];u.parse&&u.parse&&await((l=u.testParse)==null?void 0:l.call(u,n,r,this))&&(n=await u.parse(n,r,this)||n,i.parser=u)}return n})(),i}async load(t,r){let i=0;const n={},o=Ca(t),l=Yr(t,f=>({src:f})),h=l.length,u=l.map(async f=>{const d=ve.toAbsolute(f.src);if(!n[f.src])try{this.promiseCache[d]||(this.promiseCache[d]=this._getLoadPromiseAndParser(d,f)),n[f.src]=await this.promiseCache[d].promise,r&&r(++i/h)}catch(g){throw delete this.promiseCache[d],delete n[f.src],new Error(`[Loader.load] Failed to load ${d}.
${g}`)}});return await Promise.all(u),o?n[l[0].src]:n}async unload(t){const i=Yr(t,n=>({src:n})).map(async n=>{var h,u;const o=ve.toAbsolute(n.src),l=this.promiseCache[o];if(l){const f=await l.promise;(u=(h=l.parser)==null?void 0:h.unload)==null||u.call(h,f,n,this),delete this.promiseCache[o]}});await Promise.all(i)}get parsers(){return this._parsers}}var Br=(e=>(e[e.Low=0]="Low",e[e.Normal=1]="Normal",e[e.High=2]="High",e))(Br||{});const qM={extension:{type:Z.LoadParser,priority:Br.Low},test(e){return ve.extname(e).toLowerCase()===".json"},async load(e){return await(await J.ADAPTER.fetch(e)).json()}};nt.add(qM);const KM={extension:{type:Z.LoadParser,priority:Br.Low},test(e){return ve.extname(e).toLowerCase()===".txt"},async load(e){return await(await J.ADAPTER.fetch(e)).text()}};nt.add(KM);const ZM=["normal","bold","100","200","300","400","500","600","700","800","900"],JM=[".ttf",".otf",".woff",".woff2"],QM=["font/ttf","font/otf","font/woff","font/woff2"];function tD(e){const t=ve.extname(e);return ve.basename(e,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ")}const eD={extension:{type:Z.LoadParser,priority:Br.Low},test(e){return _v(e,QM)||$a(e,JM)},async load(e,t){var i,n,o;if(!globalThis.navigator.onLine)throw new Error("[loadWebFont] Cannot load font - navigator is offline");const r=J.ADAPTER.getFontFaceSet();if(r){const l=[],h=((i=t.data)==null?void 0:i.family)??tD(e),u=((o=(n=t.data)==null?void 0:n.weights)==null?void 0:o.filter(d=>ZM.includes(d)))??["normal"],f=t.data??{};for(let d=0;d<u.length;d++){const g=u[d],m=new FontFace(h,`url(${encodeURI(e)})`,{...f,weight:g});await m.load(),r.add(m),l.push(m)}return l.length===1?l[0]:l}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach(t=>J.ADAPTER.getFontFaceSet().delete(t))}};nt.add(eD);let cg=0,Xh;const rD="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",iD={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${rD}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},nD={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let zh;class sD{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const r=URL.createObjectURL(new Blob([iD.code],{type:"application/javascript"})),i=new Worker(r);i.addEventListener("message",n=>{i.terminate(),URL.revokeObjectURL(r),t(n.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){Xh===void 0&&(Xh=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Xh&&(zh||(zh=URL.createObjectURL(new Blob([nD.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(zh),t.addEventListener("message",r=>{this.complete(r.data),this.returnWorker(r.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,r){await this._initWorkers();const i=new Promise((n,o)=>{this.queue.push({id:t,arguments:r,resolve:n,reject:o})});return this.next(),i}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const r=this.queue.pop(),i=r.id;this.resolveHash[cg]={resolve:r.resolve,reject:r.reject},t.postMessage({data:r.arguments,uuid:cg++,id:i})}}const fg=new sD;function Ha(e,t,r){const i=new it(e);return i.baseTexture.on("dispose",()=>{delete t.promiseCache[r]}),i}const oD=[".jpeg",".jpg",".png",".webp",".avif"],aD=["image/jpeg","image/png","image/webp","image/avif"];async function lD(e){const t=await J.ADAPTER.fetch(e);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${t.status} ${t.statusText}`);const r=await t.blob();return await createImageBitmap(r)}const Ds={extension:{type:Z.LoadParser,priority:Br.High},config:{preferWorkers:!0},test(e){return _v(e,aD)||$a(e,oD)},async load(e,t,r){let i=null;globalThis.createImageBitmap?this.config.preferWorkers&&await fg.isImageBitmapSupported()?i=await fg.loadImageBitmap(e):i=await lD(e):i=await new Promise(o=>{i=new Image,i.crossOrigin="anonymous",i.src=e,i.complete?o(i):i.onload=()=>{o(i)}});const n=new pt(i,{resolution:fi(e),...t.data});return n.resource.src=e,Ha(n,r,e)},unload(e){e.destroy(!0)}};nt.add(Ds);const hD={extension:{type:Z.LoadParser,priority:Br.High},test(e){return ve.extname(e).toLowerCase()===".svg"},async testParse(e){return Ms.test(e)},async parse(e,t,r){var l,h,u;const i=new Ms(e,(l=t==null?void 0:t.data)==null?void 0:l.resourceOptions),n=new pt(i,{resolution:fi(e),...t==null?void 0:t.data});n.resource.src=e;const o=Ha(n,r,e);return(u=(h=t==null?void 0:t.data)==null?void 0:h.resourceOptions)!=null&&u.autoLoad||await i.load(),o},async load(e,t){return(await J.ADAPTER.fetch(e)).text()},unload:Ds.unload};nt.add(hD);class uD{constructor(){this._bundleIdConnector="-",this._createBundleAssetId=(t,r)=>`${t}${this._bundleIdConnector}${r}`,this._extractAssetIdFromBundle=(t,r)=>r.replace(`${t}${this._bundleIdConnector}`,""),this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(r=>{this._preferredOrder.push(r),r.priority||(r.priority=Object.keys(r.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this._preferredOrder=[],this._resolverHash={},this._assetMap={},this._rootPath=null,this._basePath=null,this._manifest=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const r=t;this._defaultSearchParams=Object.keys(r).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(r[i])}`).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(r=>{this.addBundle(r.name,r.assets)})}addBundle(t,r){const i=[];Array.isArray(r)?r.forEach(n=>{if(typeof n.name=="string"){const o=this._createBundleAssetId(t,n.name);i.push(o),this.add([n.name,o],n.srcs)}else{const o=n.name.map(l=>this._createBundleAssetId(t,l));o.forEach(l=>{i.push(l)}),this.add([...n.name,...o],n.srcs)}}):Object.keys(r).forEach(n=>{i.push(this._createBundleAssetId(t,n)),this.add([n,this._createBundleAssetId(t,n)],r[n])}),this._bundles[t]=i}add(t,r,i){const n=Yr(t);n.forEach(l=>{this._assetMap[l]&&console.warn(`[Resolver] already has key: ${l} overwriting`)}),Array.isArray(r)||(typeof r=="string"?r=VM(r):r=[r]);const o=r.map(l=>{let h=l;if(typeof l=="string"){let u=!1;for(let f=0;f<this._parsers.length;f++){const d=this._parsers[f];if(d.test(l)){h=d.parse(l),u=!0;break}}u||(h={src:l})}return h.format||(h.format=h.src.split(".").pop()),h.alias||(h.alias=n),(this._basePath||this._rootPath)&&(h.src=ve.toAbsolute(h.src,this._basePath,this._rootPath)),h.src=this._appendDefaultSearchParams(h.src),h.data=h.data??i,h});n.forEach(l=>{this._assetMap[l]=o})}resolveBundle(t){const r=Ca(t);t=Yr(t);const i={};return t.forEach(n=>{const o=this._bundles[n];if(o){const l=this.resolve(o),h={};for(const u in l){const f=l[u];h[this._extractAssetIdFromBundle(n,u)]=f}i[n]=h}}),r?i[t[0]]:i}resolveUrl(t){const r=this.resolve(t);if(typeof t!="string"){const i={};for(const n in r)i[n]=r[n].src;return i}return r.src}resolve(t){const r=Ca(t);t=Yr(t);const i={};return t.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let o=this._assetMap[n];const l=this._getPreferredOrder(o),h=o[0];l==null||l.priority.forEach(u=>{l.params[u].forEach(f=>{const d=o.filter(g=>g[u]?g[u]===f:!1);d.length&&(o=d)})}),this._resolverHash[n]=o[0]??h}else{let o=n;(this._basePath||this._rootPath)&&(o=ve.toAbsolute(o,this._basePath,this._rootPath)),o=this._appendDefaultSearchParams(o),this._resolverHash[n]={src:o}}i[n]=this._resolverHash[n]}),r?i[t[0]]:i}_getPreferredOrder(t){for(let r=0;r<t.length;r++){const i=t[0],n=this._preferredOrder.find(o=>o.params.format.includes(i.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const r=/\?/.test(t)?"&":"?";return`${t}${r}${this._defaultSearchParams}`}}class cD{constructor(){this._detections=[],this._initialized=!1,this.resolver=new uD,this.loader=new jM,this.cache=ms,this._backgroundLoader=new zM(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var o,l,h;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let u=t.manifest;typeof u=="string"&&(u=await this.load(u)),this.resolver.addManifest(u)}const r=((o=t.texturePreference)==null?void 0:o.resolution)??1,i=typeof r=="number"?[r]:r;let n=[];if((l=t.texturePreference)!=null&&l.format){const u=(h=t.texturePreference)==null?void 0:h.format;n=typeof u=="string"?[u]:u;for(const f of this._detections)await f.test()||(n=await f.remove(n))}else for(const u of this._detections)await u.test()&&(n=await u.add(n));this.resolver.prefer({params:{format:n,resolution:i}})}add(t,r,i){this.resolver.add(t,r,i)}async load(t,r){this._initialized||await this.init();const i=Ca(t),n=Yr(t).map(h=>typeof h!="string"?(this.resolver.add(h.src,h),h.src):h),o=this.resolver.resolve(n),l=await this._mapLoadToResolve(o,r);return i?l[n[0]]:l}addBundle(t,r){this.resolver.addBundle(t,r)}async loadBundle(t,r){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);const n=this.resolver.resolveBundle(t),o={},l=Object.keys(n);let h=0,u=0;const f=()=>{r==null||r(++h/u)},d=l.map(g=>{const m=n[g];return u+=Object.keys(m).length,this._mapLoadToResolve(m,f).then(v=>{o[g]=v})});return await Promise.all(d),i?o[t[0]]:o}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const r=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(r))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const r=this.resolver.resolveBundle(t);Object.values(r).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return ms.get(t);const r={};for(let i=0;i<t.length;i++)r[i]=ms.get(t[i]);return r}async _mapLoadToResolve(t,r){const i=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const o=await this.loader.load(i,r);this._backgroundLoader.active=!0;const l={};return i.forEach((h,u)=>{const f=o[h.src],d=[h.src];h.alias&&d.push(...h.alias),l[n[u]]=f,ms.set(d,f)}),l}async unload(t){this._initialized||await this.init();const r=Yr(t).map(n=>typeof n!="string"?n.src:n),i=this.resolver.resolve(r);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=Yr(t);const r=this.resolver.resolveBundle(t),i=Object.keys(r).map(n=>this._unloadFromResolved(r[n]));await Promise.all(i)}async _unloadFromResolved(t){const r=Object.values(t);r.forEach(i=>{ms.remove(i.src)}),await this.loader.unload(r)}get detections(){return this._detections}get preferWorkers(){return Ds.config.preferWorkers}set preferWorkers(t){Ds.config.preferWorkers=t}}const Li=new cD;nt.handleByList(Z.LoadParser,Li.loader.parsers).handleByList(Z.ResolveParser,Li.resolver.parsers).handleByList(Z.CacheParser,Li.cache.parsers).handleByList(Z.DetectionParser,Li.detections);const fD={extension:Z.CacheParser,test:e=>Array.isArray(e)&&e.every(t=>t instanceof it),getCacheableAssets:(e,t)=>{const r={};return e.forEach(i=>{t.forEach((n,o)=>{r[i+(o===0?"":o+1)]=n})}),r}};nt.add(fD);const dD={extension:{type:Z.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await J.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then(r=>r.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"avif"],remove:async e=>e.filter(t=>t!=="avif")};nt.add(dD);const pD={extension:{type:Z.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await J.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then(r=>r.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"webp"],remove:async e=>e.filter(t=>t!=="webp")};nt.add(pD);const dg=["png","jpg","jpeg"],gD={extension:{type:Z.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...dg],remove:async e=>e.filter(t=>!dg.includes(t))};nt.add(gD);const mD={extension:Z.ResolveParser,test:Ds.test,parse:e=>{var t;return{resolution:parseFloat(((t=J.RETINA_PREFIX.exec(e))==null?void 0:t[1])??"1"),format:e.split(".").pop(),src:e}}};nt.add(mD);var Ue=(e=>(e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e))(Ue||{});const Ia={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let Xr,yn;function pg(){yn={s3tc:Xr.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Xr.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Xr.getExtension("WEBGL_compressed_texture_etc"),etc1:Xr.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Xr.getExtension("WEBGL_compressed_texture_pvrtc")||Xr.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Xr.getExtension("WEBGL_compressed_texture_atc"),astc:Xr.getExtension("WEBGL_compressed_texture_astc")}}const vD={extension:{type:Z.DetectionParser,priority:2},test:async()=>{const t=J.ADAPTER.createCanvas().getContext("webgl");return t?(Xr=t,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async e=>{yn||pg();const t=[];for(const r in yn)yn[r]&&t.push(r);return[...t,...e]},remove:async e=>(yn||pg(),e.filter(t=>!(t in yn)))};nt.add(vD);class _D extends Ns{constructor(t,r={width:1,height:1,autoLoad:!0}){let i,n;typeof t=="string"?(i=t,n=new Uint8Array):(i=null,n=t),super(n,r),this.origin=i,this.buffer=n?new Cu(n):null,this.origin&&r.autoLoad!==!1&&this.load(),n!=null&&n.length&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}async load(){const i=await(await(await fetch(this.origin)).blob()).arrayBuffer();return this.data=new Uint32Array(i),this.buffer=new Cu(i),this.loaded=!0,this.onBlobLoaded(i),this.update(),this}}class $i extends _D{constructor(t,r){super(t,r),this.format=r.format,this.levels=r.levels||1,this._width=r.width,this._height=r.height,this._extension=$i._formatToExtension(this.format),(r.levelBuffers||this.buffer)&&(this._levelBuffers=r.levelBuffers||$i._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,r,i){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let l=0,h=this.levels;l<h;l++){const{levelID:u,levelWidth:f,levelHeight:d,levelBuffer:g}=this._levelBuffers[l];n.compressedTexImage2D(n.TEXTURE_2D,u,this.format,f,d,0,g)}return!0}onBlobLoaded(){this._levelBuffers=$i._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,r,i,n,o,l,h){const u=new Array(i);let f=t.byteOffset,d=l,g=h,m=d+n-1&~(n-1),v=g+o-1&~(o-1),y=m*v*Ia[r];for(let w=0;w<i;w++)u[w]={levelID:w,levelWidth:i>1?d:m,levelHeight:i>1?g:v,levelBuffer:new Uint8Array(t.buffer,f,y)},f+=y,d=d>>1||1,g=g>>1||1,m=d+n-1&~(n-1),v=g+o-1&~(o-1),y=m*v*Ia[r];return u}}const Vh=4,Yo=124,yD=32,gg=20,xD=542327876,jo={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},bD={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},qo={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},wD=1,ED=2,TD=4,AD=64,SD=512,CD=131072,ID=827611204,RD=861165636,PD=894720068,MD=808540228,DD=4,BD={[ID]:Ue.COMPRESSED_RGBA_S3TC_DXT1_EXT,[RD]:Ue.COMPRESSED_RGBA_S3TC_DXT3_EXT,[PD]:Ue.COMPRESSED_RGBA_S3TC_DXT5_EXT},OD={70:Ue.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:Ue.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:Ue.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:Ue.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:Ue.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:Ue.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:Ue.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:Ue.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:Ue.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function FD(e){const t=new Uint32Array(e);if(t[0]!==xD)throw new Error("Invalid DDS file magic word");const i=new Uint32Array(e,0,Yo/Uint32Array.BYTES_PER_ELEMENT),n=i[jo.HEIGHT],o=i[jo.WIDTH],l=i[jo.MIPMAP_COUNT],h=new Uint32Array(e,jo.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,yD/Uint32Array.BYTES_PER_ELEMENT),u=h[wD];if(u&TD){const f=h[bD.FOURCC];if(f!==MD){const E=BD[f],I=Vh+Yo,D=new Uint8Array(e,I);return[new $i(D,{format:E,width:o,height:n,levels:l})]}const d=Vh+Yo,g=new Uint32Array(t.buffer,d,gg/Uint32Array.BYTES_PER_ELEMENT),m=g[qo.DXGI_FORMAT],v=g[qo.RESOURCE_DIMENSION],y=g[qo.MISC_FLAG],w=g[qo.ARRAY_SIZE],x=OD[m];if(x===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${m}`);if(y===DD)throw new Error("DDSParser does not support cubemap textures");if(v===6)throw new Error("DDSParser does not supported 3D texture data");const A=new Array,S=Vh+Yo+gg;if(w===1)A.push(new Uint8Array(e,S));else{const E=Ia[x];let I=0,D=o,L=n;for(let F=0;F<l;F++){const X=Math.max(1,D+3&-4),j=Math.max(1,L+3&-4),z=X*j*E;I+=z,D=D>>>1,L=L>>>1}let O=S;for(let F=0;F<w;F++)A.push(new Uint8Array(e,O,I)),O+=I}return A.map(E=>new $i(E,{format:x,width:o,height:n,levels:l}))}throw u&AD?new Error("DDSParser does not support uncompressed texture data."):u&SD?new Error("DDSParser does not supported YUV uncompressed texture data."):u&CD?new Error("DDSParser does not support single-channel (lumninance) texture data!"):u&ED?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const mg=[171,75,84,88,32,49,49,187,13,10,26,10],LD=67305985,sr={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Wu=64,vg={[st.UNSIGNED_BYTE]:1,[st.UNSIGNED_SHORT]:2,[st.INT]:4,[st.UNSIGNED_INT]:4,[st.FLOAT]:4,[st.HALF_FLOAT]:8},ND={[V.RGBA]:4,[V.RGB]:3,[V.RG]:2,[V.RED]:1,[V.LUMINANCE]:1,[V.LUMINANCE_ALPHA]:2,[V.ALPHA]:1},kD={[st.UNSIGNED_SHORT_4_4_4_4]:2,[st.UNSIGNED_SHORT_5_5_5_1]:2,[st.UNSIGNED_SHORT_5_6_5]:2};function UD(e,t,r=!1){const i=new DataView(t);if(!GD(e,i))return null;const n=i.getUint32(sr.ENDIANNESS,!0)===LD,o=i.getUint32(sr.GL_TYPE,n),l=i.getUint32(sr.GL_FORMAT,n),h=i.getUint32(sr.GL_INTERNAL_FORMAT,n),u=i.getUint32(sr.PIXEL_WIDTH,n),f=i.getUint32(sr.PIXEL_HEIGHT,n)||1,d=i.getUint32(sr.PIXEL_DEPTH,n)||1,g=i.getUint32(sr.NUMBER_OF_ARRAY_ELEMENTS,n)||1,m=i.getUint32(sr.NUMBER_OF_FACES,n),v=i.getUint32(sr.NUMBER_OF_MIPMAP_LEVELS,n),y=i.getUint32(sr.BYTES_OF_KEY_VALUE_DATA,n);if(f===0||d!==1)throw new Error("Only 2D textures are supported");if(m!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(g!==1)throw new Error("WebGL does not support array textures");const w=4,x=4,A=u+3&-4,S=f+3&-4,E=new Array(g);let I=u*f;o===0&&(I=A*S);let D;if(o!==0?vg[o]?D=vg[o]*ND[l]:D=kD[o]:D=Ia[h],D===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const L=r?$D(i,y,n):null;let F=I*D,X=u,j=f,z=A,K=S,W=Wu+y;for(let k=0;k<v;k++){const at=i.getUint32(W,n);let ft=W+4;for(let Y=0;Y<g;Y++){let vt=E[Y];vt||(vt=E[Y]=new Array(v)),vt[k]={levelID:k,levelWidth:v>1||o!==0?X:z,levelHeight:v>1||o!==0?j:K,levelBuffer:new Uint8Array(t,ft,F)},ft+=F}W+=at+4,W=W%4!==0?W+4-W%4:W,X=X>>1||1,j=j>>1||1,z=X+w-1&~(w-1),K=j+x-1&~(x-1),F=z*K*D}return o!==0?{uncompressed:E.map(k=>{let at=k[0].levelBuffer,ft=!1;return o===st.FLOAT?at=new Float32Array(k[0].levelBuffer.buffer,k[0].levelBuffer.byteOffset,k[0].levelBuffer.byteLength/4):o===st.UNSIGNED_INT?(ft=!0,at=new Uint32Array(k[0].levelBuffer.buffer,k[0].levelBuffer.byteOffset,k[0].levelBuffer.byteLength/4)):o===st.INT&&(ft=!0,at=new Int32Array(k[0].levelBuffer.buffer,k[0].levelBuffer.byteOffset,k[0].levelBuffer.byteLength/4)),{resource:new Ns(at,{width:k[0].levelWidth,height:k[0].levelHeight}),type:o,format:ft?WD(l):l}}),kvData:L}:{compressed:E.map(k=>new $i(null,{format:h,width:u,height:f,levels:v,levelBuffers:k})),kvData:L}}function GD(e,t){for(let r=0;r<mg.length;r++)if(t.getUint8(r)!==mg[r])return console.error(`${e} is not a valid *.ktx file!`),!1;return!0}function WD(e){switch(e){case V.RGBA:return V.RGBA_INTEGER;case V.RGB:return V.RGB_INTEGER;case V.RG:return V.RG_INTEGER;case V.RED:return V.RED_INTEGER;default:return e}}function $D(e,t,r){const i=new Map;let n=0;for(;n<t;){const o=e.getUint32(Wu+n,r),l=Wu+n+4,h=3-(o+3)%4;if(o===0||o>t-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let u=0;for(;u<o&&e.getUint8(l+u)!==0;u++);if(u===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const f=new TextDecoder().decode(new Uint8Array(e.buffer,l,u)),d=new DataView(e.buffer,l+u+1,o-u-1);i.set(f,d),n+=4+o+h}return i}const HD={extension:{type:Z.LoadParser,priority:Br.High},test(e){return $a(e,".dds")},async load(e,t,r){const n=await(await J.ADAPTER.fetch(e)).arrayBuffer(),l=FD(n).map(h=>{const u=new pt(h,{mipmap:Dr.OFF,alphaMode:mr.NO_PREMULTIPLIED_ALPHA,resolution:fi(e),...t.data});return Ha(u,r,e)});return l.length===1?l[0]:l},unload(e){Array.isArray(e)?e.forEach(t=>t.destroy(!0)):e.destroy(!0)}};nt.add(HD);const XD={extension:{type:Z.LoadParser,priority:Br.High},test(e){return $a(e,".ktx")},async load(e,t,r){const n=await(await J.ADAPTER.fetch(e)).arrayBuffer(),{compressed:o,uncompressed:l,kvData:h}=UD(e,n),u=o??l,f={mipmap:Dr.OFF,alphaMode:mr.NO_PREMULTIPLIED_ALPHA,resolution:fi(e),...t.data},d=u.map(g=>{u===l&&Object.assign(f,{type:g.type,format:g.format});const m=new pt(g,f);return m.ktxKeyValueData=h,Ha(m,r,e)});return d.length===1?d[0]:d},unload(e){Array.isArray(e)?e.forEach(t=>t.destroy(!0)):e.destroy(!0)}};nt.add(XD);const zD={extension:Z.ResolveParser,test:e=>{const r=e.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(r)},parse:e=>{var i,n;if(e.split("?")[0].split(".").pop()==="ktx"){const o=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(o.some(l=>e.endsWith(l)))return{resolution:parseFloat(((i=J.RETINA_PREFIX.exec(e))==null?void 0:i[1])??"1"),format:o.find(l=>e.endsWith(l)),src:e}}return{resolution:parseFloat(((n=J.RETINA_PREFIX.exec(e))==null?void 0:n[1])??"1"),format:e.split(".").pop(),src:e}}};nt.add(zD);const _g=new Tt,yg=4,$u=class{constructor(e){this.renderer=e}async image(e,t,r){const i=new Image;return i.src=await this.base64(e,t,r),i}async base64(e,t,r){const i=this.canvas(e);if(i.toDataURL!==void 0)return i.toDataURL(t,r);if(i.convertToBlob!==void 0){const n=await i.convertToBlob({type:t,quality:r});return await new Promise(o=>{const l=new FileReader;l.onload=()=>o(l.result),l.readAsDataURL(n)})}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")}canvas(e,t){const r=this.renderer;let i,n=!1,o,l=!1;e&&(e instanceof gi?o=e:(o=this.renderer.generateTexture(e),l=!0)),o?(i=o.baseTexture.resolution,t=t??o.frame,n=!1,r.renderTexture.bind(o)):(i=r.resolution,t||(t=_g,t.width=r.width,t.height=r.height),n=!0,r.renderTexture.bind(null));const h=Math.round(t.width*i),u=Math.round(t.height*i);let f=new Yp(h,u,1);const d=new Uint8Array(yg*h*u),g=r.gl;g.readPixels(Math.round(t.x*i),Math.round(t.y*i),h,u,g.RGBA,g.UNSIGNED_BYTE,d);const m=f.context.getImageData(0,0,h,u);if($u.arrayPostDivide(d,m.data),f.context.putImageData(m,0,0),n){const v=new Yp(f.width,f.height,1);v.context.scale(1,-1),v.context.drawImage(f.canvas,0,-u),f.destroy(),f=v}return l&&o.destroy(!0),f.canvas}pixels(e,t){const r=this.renderer;let i,n,o=!1;e&&(e instanceof gi?n=e:(n=this.renderer.generateTexture(e),o=!0)),n?(i=n.baseTexture.resolution,t=t??n.frame,r.renderTexture.bind(n)):(i=r.resolution,t||(t=_g,t.width=r.width,t.height=r.height),r.renderTexture.bind(null));const l=Math.round(t.width*i),h=Math.round(t.height*i),u=new Uint8Array(yg*l*h),f=r.gl;return f.readPixels(Math.round(t.x*i),Math.round(t.y*i),l,h,f.RGBA,f.UNSIGNED_BYTE,u),o&&n.destroy(!0),$u.arrayPostDivide(u,u),u}destroy(){this.renderer=null}static arrayPostDivide(e,t){for(let r=0;r<e.length;r+=4){const i=t[r+3]=e[r+3];i!==0?(t[r]=Math.round(Math.min(e[r]*255/i,255)),t[r+1]=Math.round(Math.min(e[r+1]*255/i,255)),t[r+2]=Math.round(Math.min(e[r+2]*255/i,255))):(t[r]=e[r],t[r+1]=e[r+1],t[r+2]=e[r+2])}}};let xv=$u;xv.extension={name:"extract",type:Z.RendererSystem};nt.add(xv);const Ra={build(e){const t=e.points;let r,i,n,o,l,h;if(e.type===me.CIRC){const y=e.shape;r=y.x,i=y.y,l=h=y.radius,n=o=0}else if(e.type===me.ELIP){const y=e.shape;r=y.x,i=y.y,l=y.width,h=y.height,n=o=0}else{const y=e.shape,w=y.width/2,x=y.height/2;r=y.x+w,i=y.y+x,l=h=Math.max(0,Math.min(y.radius,Math.min(w,x))),n=w-l,o=x-h}if(!(l>=0&&h>=0&&n>=0&&o>=0)){t.length=0;return}const u=Math.ceil(2.3*Math.sqrt(l+h)),f=u*8+(n?4:0)+(o?4:0);if(t.length=f,f===0)return;if(u===0){t.length=8,t[0]=t[6]=r+n,t[1]=t[3]=i+o,t[2]=t[4]=r-n,t[5]=t[7]=i-o;return}let d=0,g=u*4+(n?2:0)+2,m=g,v=f;{const y=n+l,w=o,x=r+y,A=r-y,S=i+w;if(t[d++]=x,t[d++]=S,t[--g]=S,t[--g]=A,o){const E=i-w;t[m++]=A,t[m++]=E,t[--v]=E,t[--v]=x}}for(let y=1;y<u;y++){const w=Math.PI/2*(y/u),x=n+Math.cos(w)*l,A=o+Math.sin(w)*h,S=r+x,E=r-x,I=i+A,D=i-A;t[d++]=S,t[d++]=I,t[--g]=I,t[--g]=E,t[m++]=E,t[m++]=D,t[--v]=D,t[--v]=S}{const y=n,w=o+h,x=r+y,A=r-y,S=i+w,E=i-w;t[d++]=x,t[d++]=S,t[--v]=E,t[--v]=x,n&&(t[d++]=A,t[d++]=S,t[--v]=E,t[--v]=A)}},triangulate(e,t){const r=e.points,i=t.points,n=t.indices;if(r.length===0)return;let o=i.length/2;const l=o;let h,u;if(e.type!==me.RREC){const d=e.shape;h=d.x,u=d.y}else{const d=e.shape;h=d.x+d.width/2,u=d.y+d.height/2}const f=e.matrix;i.push(e.matrix?f.a*h+f.c*u+f.tx:h,e.matrix?f.b*h+f.d*u+f.ty:u),o++,i.push(r[0],r[1]);for(let d=2;d<r.length;d+=2)i.push(r[d],r[d+1]),n.push(o++,l,o);n.push(l+1,l,o)}};function xg(e,t=!1){const r=e.length;if(r<6)return;let i=0;for(let n=0,o=e[r-2],l=e[r-1];n<r;n+=2){const h=e[n],u=e[n+1];i+=(h-o)*(u+l),o=h,l=u}if(!t&&i>0||t&&i<=0){const n=r/2;for(let o=n+n%2;o<r;o+=2){const l=r-o-2,h=r-o-1,u=o,f=o+1;[e[l],e[u]]=[e[u],e[l]],[e[h],e[f]]=[e[f],e[h]]}}}const bv={build(e){e.points=e.shape.points.slice()},triangulate(e,t){let r=e.points;const i=e.holes,n=t.points,o=t.indices;if(r.length>=6){xg(r,!1);const l=[];for(let f=0;f<i.length;f++){const d=i[f];xg(d.points,!0),l.push(r.length/2),r=r.concat(d.points)}const h=_T(r,l,2);if(!h)return;const u=n.length/2;for(let f=0;f<h.length;f+=3)o.push(h[f]+u),o.push(h[f+1]+u),o.push(h[f+2]+u);for(let f=0;f<r.length;f++)n.push(r[f])}}},VD={build(e){const t=e.shape,r=t.x,i=t.y,n=t.width,o=t.height,l=e.points;l.length=0,n>=0&&o>=0&&l.push(r,i,r+n,i,r+n,i+o,r,i+o)},triangulate(e,t){const r=e.points,i=t.points;if(r.length===0)return;const n=i.length/2;i.push(r[0],r[1],r[2],r[3],r[6],r[7],r[4],r[5]),t.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},YD={build(e){Ra.build(e)},triangulate(e,t){Ra.triangulate(e,t)}};var ai=(e=>(e.MITER="miter",e.BEVEL="bevel",e.ROUND="round",e))(ai||{}),Ni=(e=>(e.BUTT="butt",e.ROUND="round",e.SQUARE="square",e))(Ni||{});const Fn={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(e,t=20){if(!this.adaptive||!e||isNaN(e))return t;let r=Math.ceil(e/this.maxLength);return r<this.minSegments?r=this.minSegments:r>this.maxSegments&&(r=this.maxSegments),r}};class bg{static curveTo(t,r,i,n,o,l){const h=l[l.length-2],f=l[l.length-1]-r,d=h-t,g=n-r,m=i-t,v=Math.abs(f*m-d*g);if(v<1e-8||o===0)return(l[l.length-2]!==t||l[l.length-1]!==r)&&l.push(t,r),null;const y=f*f+d*d,w=g*g+m*m,x=f*g+d*m,A=o*Math.sqrt(y)/v,S=o*Math.sqrt(w)/v,E=A*x/y,I=S*x/w,D=A*m+S*d,L=A*g+S*f,O=d*(S+E),F=f*(S+E),X=m*(A+I),j=g*(A+I),z=Math.atan2(F-L,O-D),K=Math.atan2(j-L,X-D);return{cx:D+t,cy:L+r,radius:o,startAngle:z,endAngle:K,anticlockwise:d*g>m*f}}static arc(t,r,i,n,o,l,h,u,f){const d=h-l,g=Fn._segmentsCount(Math.abs(d)*o,Math.ceil(Math.abs(d)/Ta)*40),m=d/(g*2),v=m*2,y=Math.cos(m),w=Math.sin(m),x=g-1,A=x%1/x;for(let S=0;S<=x;++S){const E=S+A*S,I=m+l+v*E,D=Math.cos(I),L=-Math.sin(I);f.push((y*D+w*L)*o+i,(y*-L+w*D)*o+n)}}}class jD{constructor(){this.reset()}begin(t,r,i){this.reset(),this.style=t,this.start=r,this.attribStart=i}end(t,r){this.attribSize=r-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class vc{static curveLength(t,r,i,n,o,l,h,u){let d=0,g=0,m=0,v=0,y=0,w=0,x=0,A=0,S=0,E=0,I=0,D=t,L=r;for(let O=1;O<=10;++O)g=O/10,m=g*g,v=m*g,y=1-g,w=y*y,x=w*y,A=x*t+3*w*g*i+3*y*m*o+v*h,S=x*r+3*w*g*n+3*y*m*l+v*u,E=D-A,I=L-S,D=A,L=S,d+=Math.sqrt(E*E+I*I);return d}static curveTo(t,r,i,n,o,l,h){const u=h[h.length-2],f=h[h.length-1];h.length-=2;const d=Fn._segmentsCount(vc.curveLength(u,f,t,r,i,n,o,l));let g=0,m=0,v=0,y=0,w=0;h.push(u,f);for(let x=1,A=0;x<=d;++x)A=x/d,g=1-A,m=g*g,v=m*g,y=A*A,w=y*A,h.push(v*u+3*m*A*t+3*g*y*i+w*o,v*f+3*m*A*r+3*g*y*n+w*l)}}function wg(e,t,r,i,n,o,l,h){const u=e-r*n,f=t-i*n,d=e+r*o,g=t+i*o;let m,v;l?(m=i,v=-r):(m=-i,v=r);const y=u+m,w=f+v,x=d+m,A=g+v;return h.push(y,w),h.push(x,A),2}function Ri(e,t,r,i,n,o,l,h){const u=r-e,f=i-t;let d=Math.atan2(u,f),g=Math.atan2(n-e,o-t);h&&d<g?d+=Math.PI*2:!h&&d>g&&(g+=Math.PI*2);let m=d;const v=g-d,y=Math.abs(v),w=Math.sqrt(u*u+f*f),x=(15*y*Math.sqrt(w)/Math.PI>>0)+1,A=v/x;if(m+=A,h){l.push(e,t),l.push(r,i);for(let S=1,E=m;S<x;S++,E+=A)l.push(e,t),l.push(e+Math.sin(E)*w,t+Math.cos(E)*w);l.push(e,t),l.push(n,o)}else{l.push(r,i),l.push(e,t);for(let S=1,E=m;S<x;S++,E+=A)l.push(e+Math.sin(E)*w,t+Math.cos(E)*w),l.push(e,t);l.push(n,o),l.push(e,t)}return x*2}function qD(e,t){const r=e.shape;let i=e.points||r.points.slice();const n=t.closePointEps;if(i.length===0)return;const o=e.lineStyle,l=new St(i[0],i[1]),h=new St(i[i.length-2],i[i.length-1]),u=r.type!==me.POLY||r.closeStroke,f=Math.abs(l.x-h.x)<n&&Math.abs(l.y-h.y)<n;if(u){i=i.slice(),f&&(i.pop(),i.pop(),h.set(i[i.length-2],i[i.length-1]));const Y=(l.x+h.x)*.5,vt=(h.y+l.y)*.5;i.unshift(Y,vt),i.push(Y,vt)}const d=t.points,g=i.length/2;let m=i.length;const v=d.length/2,y=o.width/2,w=y*y,x=o.miterLimit*o.miterLimit;let A=i[0],S=i[1],E=i[2],I=i[3],D=0,L=0,O=-(S-I),F=A-E,X=0,j=0,z=Math.sqrt(O*O+F*F);O/=z,F/=z,O*=y,F*=y;const K=o.alignment,W=(1-K)*2,k=K*2;u||(o.cap===Ni.ROUND?m+=Ri(A-O*(W-k)*.5,S-F*(W-k)*.5,A-O*W,S-F*W,A+O*k,S+F*k,d,!0)+2:o.cap===Ni.SQUARE&&(m+=wg(A,S,O,F,W,k,!0,d))),d.push(A-O*W,S-F*W),d.push(A+O*k,S+F*k);for(let Y=1;Y<g-1;++Y){A=i[(Y-1)*2],S=i[(Y-1)*2+1],E=i[Y*2],I=i[Y*2+1],D=i[(Y+1)*2],L=i[(Y+1)*2+1],O=-(S-I),F=A-E,z=Math.sqrt(O*O+F*F),O/=z,F/=z,O*=y,F*=y,X=-(I-L),j=E-D,z=Math.sqrt(X*X+j*j),X/=z,j/=z,X*=y,j*=y;const vt=E-A,Ot=S-I,H=E-D,rt=L-I,bt=vt*H+Ot*rt,Rt=Ot*H-rt*vt,Mt=Rt<0;if(Math.abs(Rt)<.001*Math.abs(bt)){d.push(E-O*W,I-F*W),d.push(E+O*k,I+F*k),bt>=0&&(o.join===ai.ROUND?m+=Ri(E,I,E-O*W,I-F*W,E-X*W,I-j*W,d,!1)+4:m+=2,d.push(E-X*k,I-j*k),d.push(E+X*W,I+j*W));continue}const Nt=(-O+A)*(-F+I)-(-O+E)*(-F+S),kt=(-X+D)*(-j+I)-(-X+E)*(-j+L),ie=(vt*kt-H*Nt)/Rt,Yt=(rt*Nt-Ot*kt)/Rt,ne=(ie-E)*(ie-E)+(Yt-I)*(Yt-I),oe=E+(ie-E)*W,Dt=I+(Yt-I)*W,Ut=E-(ie-E)*k,jt=I-(Yt-I)*k,qt=Math.min(vt*vt+Ot*Ot,H*H+rt*rt),_e=Mt?W:k,vi=qt+_e*_e*w;ne<=vi?o.join===ai.BEVEL||ne/w>x?(Mt?(d.push(oe,Dt),d.push(E+O*k,I+F*k),d.push(oe,Dt),d.push(E+X*k,I+j*k)):(d.push(E-O*W,I-F*W),d.push(Ut,jt),d.push(E-X*W,I-j*W),d.push(Ut,jt)),m+=2):o.join===ai.ROUND?Mt?(d.push(oe,Dt),d.push(E+O*k,I+F*k),m+=Ri(E,I,E+O*k,I+F*k,E+X*k,I+j*k,d,!0)+4,d.push(oe,Dt),d.push(E+X*k,I+j*k)):(d.push(E-O*W,I-F*W),d.push(Ut,jt),m+=Ri(E,I,E-O*W,I-F*W,E-X*W,I-j*W,d,!1)+4,d.push(E-X*W,I-j*W),d.push(Ut,jt)):(d.push(oe,Dt),d.push(Ut,jt)):(d.push(E-O*W,I-F*W),d.push(E+O*k,I+F*k),o.join===ai.ROUND?Mt?m+=Ri(E,I,E+O*k,I+F*k,E+X*k,I+j*k,d,!0)+2:m+=Ri(E,I,E-O*W,I-F*W,E-X*W,I-j*W,d,!1)+2:o.join===ai.MITER&&ne/w<=x&&(Mt?(d.push(Ut,jt),d.push(Ut,jt)):(d.push(oe,Dt),d.push(oe,Dt)),m+=2),d.push(E-X*W,I-j*W),d.push(E+X*k,I+j*k),m+=2)}A=i[(g-2)*2],S=i[(g-2)*2+1],E=i[(g-1)*2],I=i[(g-1)*2+1],O=-(S-I),F=A-E,z=Math.sqrt(O*O+F*F),O/=z,F/=z,O*=y,F*=y,d.push(E-O*W,I-F*W),d.push(E+O*k,I+F*k),u||(o.cap===Ni.ROUND?m+=Ri(E-O*(W-k)*.5,I-F*(W-k)*.5,E-O*W,I-F*W,E+O*k,I+F*k,d,!1)+2:o.cap===Ni.SQUARE&&(m+=wg(E,I,O,F,W,k,!1,d)));const at=t.indices,ft=Fn.epsilon*Fn.epsilon;for(let Y=v;Y<m+v-2;++Y)A=d[Y*2],S=d[Y*2+1],E=d[(Y+1)*2],I=d[(Y+1)*2+1],D=d[(Y+2)*2],L=d[(Y+2)*2+1],!(Math.abs(A*(I-L)+E*(L-S)+D*(S-I))<ft)&&at.push(Y,Y+1,Y+2)}function KD(e,t){let r=0;const i=e.shape,n=e.points||i.points,o=i.type!==me.POLY||i.closeStroke;if(n.length===0)return;const l=t.points,h=t.indices,u=n.length/2,f=l.length/2;let d=f;for(l.push(n[0],n[1]),r=1;r<u;r++)l.push(n[r*2],n[r*2+1]),h.push(d,d+1),d++;o&&h.push(d,f)}function Eg(e,t){e.lineStyle.native?KD(e,t):qD(e,t)}class _c{static curveLength(t,r,i,n,o,l){const h=t-2*i+o,u=r-2*n+l,f=2*i-2*t,d=2*n-2*r,g=4*(h*h+u*u),m=4*(h*f+u*d),v=f*f+d*d,y=2*Math.sqrt(g+m+v),w=Math.sqrt(g),x=2*g*w,A=2*Math.sqrt(v),S=m/w;return(x*y+w*m*(y-A)+(4*v*g-m*m)*Math.log((2*w+S+y)/(S+A)))/(4*x)}static curveTo(t,r,i,n,o){const l=o[o.length-2],h=o[o.length-1],u=Fn._segmentsCount(_c.curveLength(l,h,t,r,i,n));let f=0,d=0;for(let g=1;g<=u;++g){const m=g/u;f=l+(t-l)*m,d=h+(r-h)*m,o.push(f+(t+(i-t)*m-f)*m,d+(r+(n-r)*m-d)*m)}}}const Yh={[me.POLY]:bv,[me.CIRC]:Ra,[me.ELIP]:Ra,[me.RECT]:VD,[me.RREC]:YD},Tg=[],Ko=[];class Pa{constructor(t,r=null,i=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=r,this.matrix=n,this.type=t.type}clone(){return new Pa(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const pn=new St,wv=class extends Sm{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Aa,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),Ko.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),Tg.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,r=null,i=null){const n=new Pa(e,t,r,i);return this.graphicsData.push(n),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const r=new Pa(e,null,null,t),i=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=i.lineStyle,i.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let r=0;r<t.length;++r){const i=t[r];if(i.fillStyle.visible&&i.shape&&(i.matrix?i.matrix.applyInverse(e,pn):pn.copyFrom(e),i.shape.contains(pn.x,pn.y))){let n=!1;if(i.holes){for(let o=0;o<i.holes.length;o++)if(i.holes[o].shape.contains(pn.x,pn.y)){n=!0;break}}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let r=null,i=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],i=r.style);for(let h=this.shapeIndex;h<t.length;h++){this.shapeIndex++;const u=t[h],f=u.fillStyle,d=u.lineStyle;Yh[u.type].build(u),u.matrix&&this.transformPoints(u.points,u.matrix),(f.visible||d.visible)&&this.processHoles(u.holes);for(let m=0;m<2;m++){const v=m===0?f:d;if(!v.visible)continue;const y=v.texture.baseTexture,w=this.indices.length,x=this.points.length/2;y.wrapMode=ci.REPEAT,m===0?this.processFill(u):this.processLine(u);const A=this.points.length/2-x;A!==0&&(r&&!this._compareStyles(i,v)&&(r.end(w,x),r=null),r||(r=Tg.pop()||new jD,r.begin(v,w,x),this.batches.push(r),i=v),this.addUvs(this.points,e,v.texture,x,A,v.matrix))}}const n=this.indices.length,o=this.points.length/2;if(r&&r.end(n,o),this.batches.length===0){this.batchable=!0;return}const l=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&l===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=l?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const r=this.graphicsData[e],i=r.fillStyle,n=r.lineStyle;if(i&&!i.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,r=e.length;t<r;t++){const i=e[t];for(let n=0;n<i.size;n++){const o=i.start+n;this.indicesUint16[o]=this.indicesUint16[o]-i.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<wv.BATCHABLE_SIZE*2}buildDrawCalls(){let e=++pt._globalBatch;for(let d=0;d<this.drawCalls.length;d++)this.drawCalls[d].texArray.clear(),Ko.push(this.drawCalls[d]);this.drawCalls.length=0;const t=this.colors,r=this.textureIds;let i=Ko.pop();i||(i=new Ru,i.texArray=new Mu),i.texArray.count=0,i.start=0,i.size=0,i.type=Rr.TRIANGLES;let n=0,o=null,l=0,h=!1,u=Rr.TRIANGLES,f=0;this.drawCalls.push(i);for(let d=0;d<this.batches.length;d++){const g=this.batches[d],m=8,v=g.style,y=v.texture.baseTexture;h!==!!v.native&&(h=!!v.native,u=h?Rr.LINES:Rr.TRIANGLES,o=null,n=m,e++),o!==y&&(o=y,y._batchEnabled!==e&&(n===m&&(e++,n=0,i.size>0&&(i=Ko.pop(),i||(i=new Ru,i.texArray=new Mu),this.drawCalls.push(i)),i.start=f,i.size=0,i.texArray.count=0,i.type=u),y.touched=1,y._batchEnabled=e,y._batchLocation=n,y.wrapMode=ci.REPEAT,i.texArray.elements[i.texArray.count++]=y,n++)),i.size+=g.size,f+=g.size,l=y._batchLocation,this.addColors(t,v.color,v.alpha,g.attribSize,g.attribStart),this.addTextureIds(r,l,g.attribSize,g.attribStart)}pt._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,r=this.colors,i=this.textureIds,n=new ArrayBuffer(e.length*3*4),o=new Float32Array(n),l=new Uint32Array(n);let h=0;for(let u=0;u<e.length/2;u++)o[h++]=e[u*2],o[h++]=e[u*2+1],o[h++]=t[u*2],o[h++]=t[u*2+1],l[h++]=r[u],o[h++]=i[u];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?bv.triangulate(e,this):Yh[e.type].triangulate(e,this)}processLine(e){Eg(e,this);for(let t=0;t<e.holes.length;t++)Eg(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const r=e[t];Yh[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let r=0;r<e.length/2;r++){const i=e[r*2],n=e[r*2+1];e[r*2]=t.a*i+t.c*n+t.tx,e[r*2+1]=t.b*i+t.d*n+t.ty}}addColors(e,t,r,i,n=0){const o=(t>>16)+(t&65280)+((t&255)<<16),l=uc(o,r);e.length=Math.max(e.length,n+i);for(let h=0;h<i;h++)e[n+h]=l}addTextureIds(e,t,r,i=0){e.length=Math.max(e.length,i+r);for(let n=0;n<r;n++)e[i+n]=t}addUvs(e,t,r,i,n,o=null){let l=0;const h=t.length,u=r.frame;for(;l<n;){let d=e[(i+l)*2],g=e[(i+l)*2+1];if(o){const m=o.a*d+o.c*g+o.tx;g=o.b*d+o.d*g+o.ty,d=m}l++,t.push(d/u.width,g/u.height)}const f=r.baseTexture;(u.width<f.width||u.height<f.height)&&this.adjustUvs(t,r,h,n)}adjustUvs(e,t,r,i){const n=t.baseTexture,o=1e-6,l=r+i*2,h=t.frame,u=h.width/n.width,f=h.height/n.height;let d=h.x/h.width,g=h.y/h.height,m=Math.floor(e[r]+o),v=Math.floor(e[r+1]+o);for(let y=r+2;y<l;y+=2)m=Math.min(m,Math.floor(e[y]+o)),v=Math.min(v,Math.floor(e[y+1]+o));d-=m,g-=v;for(let y=r;y<l;y+=2)e[y]=(e[y]+d)*u,e[y+1]=(e[y+1]+g)*f}};let Ev=wv;Ev.BATCHABLE_SIZE=100;class Xa{constructor(){this.color=16777215,this.alpha=1,this.texture=it.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Xa;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=it.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class yc extends Xa{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Ni.BUTT,this.join=ai.MITER,this.miterLimit=10}clone(){const t=new yc;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const ZD=new Float32Array(3),jh={},ca=class extends Ge{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Xa,this._lineStyle=new yc,this._matrix=null,this._holeMode=!1,this.state=qr.for2d(),this._geometry=e||new Ev,this._geometry.refCount++,this._transformID=-1,this.tint=16777215,this.blendMode=ut.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new ca(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tint}set tint(e){this._tint=e}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,r=1,i=.5,n=!1){return typeof e=="number"&&(e={width:e,color:t,alpha:r,alignment:i,native:n}),this.lineTextureStyle(e)}lineTextureStyle(e){e=Object.assign({width:0,texture:it.WHITE,color:e!=null&&e.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:Ni.BUTT,join:ai.MITER,miterLimit:10},e),this.currentPath&&this.startPoly();const t=e.width>0&&e.alpha>0;return t?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:t},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new Rn,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new Rn,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const r=this.currentPath.points,i=r[r.length-2],n=r[r.length-1];return(i!==e||n!==t)&&r.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,r,i){this._initCurve();const n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),_c.curveTo(e,t,r,i,n),this}bezierCurveTo(e,t,r,i,n,o){return this._initCurve(),vc.curveTo(e,t,r,i,n,o,this.currentPath.points),this}arcTo(e,t,r,i,n){this._initCurve(e,t);const o=this.currentPath.points,l=bg.curveTo(e,t,r,i,n,o);if(l){const{cx:h,cy:u,radius:f,startAngle:d,endAngle:g,anticlockwise:m}=l;this.arc(h,u,f,d,g,m)}return this}arc(e,t,r,i,n,o=!1){if(i===n)return this;if(!o&&n<=i?n+=Ta:o&&i<=n&&(i+=Ta),n-i===0)return this;const h=e+Math.cos(i)*r,u=t+Math.sin(i)*r,f=this._geometry.closePointEps;let d=this.currentPath?this.currentPath.points:null;if(d){const g=Math.abs(d[d.length-2]-h),m=Math.abs(d[d.length-1]-u);g<f&&m<f||d.push(h,u)}else this.moveTo(h,u),d=this.currentPath.points;return bg.arc(h,u,e,t,r,i,n,o,d),this}beginFill(e=0,t=1){return this.beginTextureFill({texture:it.WHITE,color:e,alpha:t})}beginTextureFill(e){e=Object.assign({texture:it.WHITE,color:16777215,alpha:1,matrix:null},e),this.currentPath&&this.startPoly();const t=e.alpha>0;return t?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:t},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,r,i){return this.drawShape(new Tt(e,t,r,i))}drawRoundedRect(e,t,r,i,n){return this.drawShape(new dc(e,t,r,i,n))}drawCircle(e,t,r){return this.drawShape(new cc(e,t,r))}drawEllipse(e,t,r,i){return this.drawShape(new fc(e,t,r,i))}drawPolygon(...e){let t,r=!0;const i=e[0];i.points?(r=i.closeStroke,t=i.points):Array.isArray(e[0])?t=e[0]:t=e;const n=new Rn(t);return n.closeStroke=r,this.drawShape(n),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return e.length===1&&e[0].shape.type===me.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,r=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(e.points);for(let i=0;i<r;i++){const n=e.batches[i],o=n.style.color,l=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),h=new Float32Array(e.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),u=new Uint16Array(e.indicesUint16.buffer,n.start*2,n.size),f={vertexData:l,blendMode:t,indices:u,uvs:h,_batchRGB:Rs(o),_tintRGB:o,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[i]=f}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,r=this.batches.length;t<r;t++){const i=this.batches[t];i.worldAlpha=this.worldAlpha*i.alpha,e.plugins[this.pluginName].render(i)}}}_renderDirect(e){const t=this._resolveDirectShader(e),r=this._geometry,i=this.tint,n=this.worldAlpha,o=t.uniforms,l=r.drawCalls;o.translationMatrix=this.transform.worldTransform,o.tint[0]=(i>>16&255)/255*n,o.tint[1]=(i>>8&255)/255*n,o.tint[2]=(i&255)/255*n,o.tint[3]=n,e.shader.bind(t),e.geometry.bind(r,t),e.state.set(this.state);for(let h=0,u=l.length;h<u;h++)this._renderDrawCallDirect(e,r.drawCalls[h])}_renderDrawCallDirect(e,t){const{texArray:r,type:i,size:n,start:o}=t,l=r.count;for(let h=0;h<l;h++)e.texture.bind(r.elements[h],h);e.geometry.draw(i,n,o)}_resolveDirectShader(e){let t=this.shader;const r=this.pluginName;if(!t){if(!jh[r]){const{maxTextures:i}=e.plugins[r],n=new Int32Array(i);for(let h=0;h<i;h++)n[h]=h;const o={tint:new Float32Array([1,1,1,1]),translationMatrix:new $t,default:gr.from({uSamplers:n},!0)},l=e.plugins[r]._shader.program;jh[r]=new Mr(l,o)}t=jh[r]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:r,maxX:i,maxY:n}=e.bounds;this._bounds.addFrame(this.transform,t,r,i,n)}containsPoint(e){return this.worldTransform.applyInverse(e,ca._TEMP_POINT),this._geometry.containsPoint(ca._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;const e=Rs(this.tint,ZD);for(let t=0;t<this.batches.length;t++){const r=this.batches[t],i=r._batchRGB,n=e[0]*i[0]*255,o=e[1]*i[1]*255,l=e[2]*i[2]*255,h=(n<<16)+(o<<8)+(l|0);r._tintRGB=(h>>16)+(h&65280)+((h&255)<<16)}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,r=t.a,i=t.b,n=t.c,o=t.d,l=t.tx,h=t.ty,u=this._geometry.points,f=this.vertexData;let d=0;for(let g=0;g<u.length;g+=2){const m=u[g],v=u[g+1];f[d++]=r*m+n*v+l,f[d++]=o*v+i*m+h}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};let za=ca;za.curves=Fn;za._TEMP_POINT=new St;class JD{constructor(t,r){this.uvBuffer=t,this.uvMatrix=r,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const r=this.uvBuffer.data;(!this.data||this.data.length!==r.length)&&(this.data=new Float32Array(r.length)),this.uvMatrix.multiplyUvs(r,this.data),this._updateID++}}const qh=new St,Ag=new Rn,Tv=class extends Ge{constructor(e,t,r,i=Rr.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=r||qr.for2d(),this.drawMode=i,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=J.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(e){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Rr.TRIANGLES&&t.length<Tv.BATCHABLE_SIZE*2?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;const i=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[i]),e.plugins[i].render(this)}calculateVertices(){const t=this.geometry.buffers[0],r=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==r.length&&(this.vertexData=new Float32Array(r.length));const n=this.transform.worldTransform,o=n.a,l=n.b,h=n.c,u=n.d,f=n.tx,d=n.ty,g=this.vertexData;for(let m=0;m<g.length/2;m++){const v=r[m*2],y=r[m*2+1];g[m*2]=o*v+h*y+f,g[m*2+1]=l*v+u*y+d}if(this._roundPixels){const m=J.RESOLUTION;for(let v=0;v<g.length;++v)g[v]=Math.round(g[v]*m)/m}this.vertexDirty=i}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new JD(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,qh);const t=this.geometry.getBuffer("aVertexPosition").data,r=Ag.points,i=this.geometry.getIndex().data,n=i.length,o=this.drawMode===4?3:1;for(let l=0;l+2<n;l+=o){const h=i[l]*2,u=i[l+1]*2,f=i[l+2]*2;if(r[0]=t[h],r[1]=t[h+1],r[2]=t[u],r[3]=t[u+1],r[4]=t[f],r[5]=t[f+1],Ag.contains(qh.x,qh.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let Hu=Tv;Hu.BATCHABLE_SIZE=100;class QD extends di{constructor(t,r,i){super();const n=new re(t),o=new re(r,!0),l=new re(i,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,st.FLOAT).addAttribute("aTextureCoord",o,2,!1,st.FLOAT).addIndex(l),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var tB=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,eB=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class Sg extends Mr{constructor(t,r){const i={uSampler:t,alpha:1,uTextureMatrix:$t.IDENTITY,uColor:new Float32Array([1,1,1,1])};r=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},r),r.uniforms&&Object.assign(i,r.uniforms),super(r.program||cr.from(eB,tB),i),this._colorDirty=!1,this.uvMatrix=new Xm(t),this.batchable=r.program===void 0,this.pluginName=r.pluginName,this.tint=r.tint,this.alpha=r.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16),this._colorDirty=!0)}get tint(){return this._tint}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture;wm(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Cg{constructor(t,r,i){this.geometry=new di,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<t.length;++n){let o=t[n];o={attributeName:o.attributeName,size:o.size,uploadFunction:o.uploadFunction,type:o.type||st.FLOAT,offset:o.offset},r[n]?this.dynamicProperties.push(o):this.staticProperties.push(o)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let r=0;this.indexBuffer=new re(VR(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let l=0;l<this.dynamicProperties.length;++l){const h=this.dynamicProperties[l];h.offset=r,r+=h.size,this.dynamicStride+=h.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new re(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let l=0;l<this.staticProperties.length;++l){const h=this.staticProperties[l];h.offset=n,n+=h.size,this.staticStride+=h.size}const o=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(o),this.staticDataUint32=new Uint32Array(o),this.staticBuffer=new re(this.staticData,!0,!1);for(let l=0;l<this.dynamicProperties.length;++l){const h=this.dynamicProperties[l];t.addAttribute(h.attributeName,this.dynamicBuffer,0,h.type===st.UNSIGNED_BYTE,h.type,this.dynamicStride*4,h.offset*4)}for(let l=0;l<this.staticProperties.length;++l){const h=this.staticProperties[l];t.addAttribute(h.attributeName,this.staticBuffer,0,h.type===st.UNSIGNED_BYTE,h.type,this.staticStride*4,h.offset*4)}}uploadDynamic(t,r,i){for(let n=0;n<this.dynamicProperties.length;n++){const o=this.dynamicProperties[n];o.uploadFunction(t,r,i,o.type===st.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,o.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,r,i){for(let n=0;n<this.staticProperties.length;n++){const o=this.staticProperties[n];o.uploadFunction(t,r,i,o.type===st.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,o.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var rB=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,iB=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class Av extends Wa{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new $t,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:st.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Mr.from(iB,rB,{}),this.state=qr.for2d()}render(t){const r=t.children,i=t._maxSize,n=t._batchSize,o=this.renderer;let l=r.length;if(l===0)return;l>i&&!t.autoResize&&(l=i);let h=t._buffers;h||(h=t._buffers=this.generateBuffers(t));const u=r[0]._texture.baseTexture,f=u.alphaMode>0;this.state.blendMode=bm(t.blendMode,f),o.state.set(this.state);const d=o.gl,g=t.worldTransform.copyTo(this.tempMatrix);g.prepend(o.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=g.toArray(!0),this.shader.uniforms.uColor=zR(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,f),this.shader.uniforms.uSampler=u,this.renderer.shader.bind(this.shader);let m=!1;for(let v=0,y=0;v<l;v+=n,y+=1){let w=l-v;w>n&&(w=n),y>=h.length&&h.push(this._generateOneMoreBuffer(t));const x=h[y];x.uploadDynamic(r,v,w);const A=t._bufferUpdateIDs[y]||0;m=m||x._updateID<A,m&&(x._updateID=t._updateID,x.uploadStatic(r,v,w)),o.geometry.bind(x.geometry),d.drawElements(d.TRIANGLES,w*6,d.UNSIGNED_SHORT,0)}}generateBuffers(t){const r=[],i=t._maxSize,n=t._batchSize,o=t._properties;for(let l=0;l<i;l+=n)r.push(new Cg(this.properties,o,n));return r}_generateOneMoreBuffer(t){const r=t._batchSize,i=t._properties;return new Cg(this.properties,i,r)}uploadVertices(t,r,i,n,o,l){let h=0,u=0,f=0,d=0;for(let g=0;g<i;++g){const m=t[r+g],v=m._texture,y=m.scale.x,w=m.scale.y,x=v.trim,A=v.orig;x?(u=x.x-m.anchor.x*A.width,h=u+x.width,d=x.y-m.anchor.y*A.height,f=d+x.height):(h=A.width*(1-m.anchor.x),u=A.width*-m.anchor.x,f=A.height*(1-m.anchor.y),d=A.height*-m.anchor.y),n[l]=u*y,n[l+1]=d*w,n[l+o]=h*y,n[l+o+1]=d*w,n[l+o*2]=h*y,n[l+o*2+1]=f*w,n[l+o*3]=u*y,n[l+o*3+1]=f*w,l+=o*4}}uploadPosition(t,r,i,n,o,l){for(let h=0;h<i;h++){const u=t[r+h].position;n[l]=u.x,n[l+1]=u.y,n[l+o]=u.x,n[l+o+1]=u.y,n[l+o*2]=u.x,n[l+o*2+1]=u.y,n[l+o*3]=u.x,n[l+o*3+1]=u.y,l+=o*4}}uploadRotation(t,r,i,n,o,l){for(let h=0;h<i;h++){const u=t[r+h].rotation;n[l]=u,n[l+o]=u,n[l+o*2]=u,n[l+o*3]=u,l+=o*4}}uploadUvs(t,r,i,n,o,l){for(let h=0;h<i;++h){const u=t[r+h]._texture._uvs;u?(n[l]=u.x0,n[l+1]=u.y0,n[l+o]=u.x1,n[l+o+1]=u.y1,n[l+o*2]=u.x2,n[l+o*2+1]=u.y2,n[l+o*3]=u.x3,n[l+o*3+1]=u.y3,l+=o*4):(n[l]=0,n[l+1]=0,n[l+o]=0,n[l+o+1]=0,n[l+o*2]=0,n[l+o*2+1]=0,n[l+o*3]=0,n[l+o*3+1]=0,l+=o*4)}}uploadTint(t,r,i,n,o,l){for(let h=0;h<i;++h){const u=t[r+h],f=u._texture.baseTexture.alphaMode>0,d=u.alpha,g=d<1&&f?uc(u._tintRGB,d):u._tintRGB+(d*255<<24);n[l]=g,n[l+o]=g,n[l+o*2]=g,n[l+o*3]=g,l+=o*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Av.extension={name:"particle",type:Z.RendererPlugin};nt.add(Av);var Va=(e=>(e[e.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",e[e.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",e))(Va||{});const Zo={willReadFrequently:!0},et=class{static get experimentalLetterSpacingSupported(){let e=et._experimentalLetterSpacingSupported;if(e!==void 0){const t=J.ADAPTER.getCanvasRenderingContext2D().prototype;e=et._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,r,i,n,o,l,h,u){this.text=e,this.style=t,this.width=r,this.height=i,this.lines=n,this.lineWidths=o,this.lineHeight=l,this.maxLineWidth=h,this.fontProperties=u}static measureText(e,t,r,i=et._canvas){r=r??t.wordWrap;const n=t.toFontString(),o=et.measureFont(n);o.fontSize===0&&(o.fontSize=t.fontSize,o.ascent=t.fontSize);const l=i.getContext("2d",Zo);l.font=n;const u=(r?et.wordWrap(e,t,i):e).split(/(?:\r\n|\r|\n)/),f=new Array(u.length);let d=0;for(let y=0;y<u.length;y++){const w=et._measureText(u[y],t.letterSpacing,l);f[y]=w,d=Math.max(d,w)}let g=d+t.strokeThickness;t.dropShadow&&(g+=t.dropShadowDistance);const m=t.lineHeight||o.fontSize+t.strokeThickness;let v=Math.max(m,o.fontSize+t.strokeThickness*2)+(u.length-1)*(m+t.leading);return t.dropShadow&&(v+=t.dropShadowDistance),new et(e,t,g,v,u,f,m+t.leading,d,o)}static _measureText(e,t,r){let i=!1;et.experimentalLetterSpacingSupported&&(et.experimentalLetterSpacing?(r.letterSpacing=`${t}px`,r.textLetterSpacing=`${t}px`,i=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let n=r.measureText(e).width;return n>0&&(i?n-=t:n+=(et.graphemeSegmenter(e).length-1)*t),n}static wordWrap(e,t,r=et._canvas){const i=r.getContext("2d",Zo);let n=0,o="",l="";const h=Object.create(null),{letterSpacing:u,whiteSpace:f}=t,d=et.collapseSpaces(f),g=et.collapseNewlines(f);let m=!d;const v=t.wordWrapWidth+u,y=et.tokenize(e);for(let w=0;w<y.length;w++){let x=y[w];if(et.isNewline(x)){if(!g){l+=et.addLine(o),m=!d,o="",n=0;continue}x=" "}if(d){const S=et.isBreakingSpace(x),E=et.isBreakingSpace(o[o.length-1]);if(S&&E)continue}const A=et.getFromCache(x,u,h,i);if(A>v)if(o!==""&&(l+=et.addLine(o),o="",n=0),et.canBreakWords(x,t.breakWords)){const S=et.wordWrapSplit(x);for(let E=0;E<S.length;E++){let I=S[E],D=I,L=1;for(;S[E+L];){const F=S[E+L];if(!et.canBreakChars(D,F,x,E,t.breakWords))I+=F;else break;D=F,L++}E+=L-1;const O=et.getFromCache(I,u,h,i);O+n>v&&(l+=et.addLine(o),m=!1,o="",n=0),o+=I,n+=O}}else{o.length>0&&(l+=et.addLine(o),o="",n=0);const S=w===y.length-1;l+=et.addLine(x,!S),m=!1,o="",n=0}else A+n>v&&(m=!1,l+=et.addLine(o),o="",n=0),(o.length>0||!et.isBreakingSpace(x)||m)&&(o+=x,n+=A)}return l+=et.addLine(o,!1),l}static addLine(e,t=!0){return e=et.trimRight(e),e=t?`${e}
`:e,e}static getFromCache(e,t,r,i){let n=r[e];return typeof n!="number"&&(n=et._measureText(e,t,i)+t,r[e]=n),n}static collapseSpaces(e){return e==="normal"||e==="pre-line"}static collapseNewlines(e){return e==="normal"}static trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){const r=e[t];if(!et.isBreakingSpace(r))break;e=e.slice(0,-1)}return e}static isNewline(e){return typeof e!="string"?!1:et._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return typeof e!="string"?!1:et._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const t=[];let r="";if(typeof e!="string")return t;for(let i=0;i<e.length;i++){const n=e[i],o=e[i+1];if(et.isBreakingSpace(n,o)||et.isNewline(n)){r!==""&&(t.push(r),r=""),t.push(n);continue}r+=n}return r!==""&&t.push(r),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,r,i,n){return!0}static wordWrapSplit(e){return et.graphemeSegmenter(e)}static measureFont(e){if(et._fonts[e])return et._fonts[e];const t={ascent:0,descent:0,fontSize:0},r=et._canvas,i=et._context;i.font=e;const n=et.METRICS_STRING+et.BASELINE_SYMBOL,o=Math.ceil(i.measureText(n).width);let l=Math.ceil(i.measureText(et.BASELINE_SYMBOL).width);const h=Math.ceil(et.HEIGHT_MULTIPLIER*l);if(l=l*et.BASELINE_MULTIPLIER|0,o===0||h===0)return et._fonts[e]=t,t;r.width=o,r.height=h,i.fillStyle="#f00",i.fillRect(0,0,o,h),i.font=e,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(n,0,l);const u=i.getImageData(0,0,o,h).data,f=u.length,d=o*4;let g=0,m=0,v=!1;for(g=0;g<l;++g){for(let y=0;y<d;y+=4)if(u[m+y]!==255){v=!0;break}if(!v)m+=d;else break}for(t.ascent=l-g,m=f-d,v=!1,g=h;g>l;--g){for(let y=0;y<d;y+=4)if(u[m+y]!==255){v=!0;break}if(!v)m-=d;else break}return t.descent=g-l,t.fontSize=t.ascent+t.descent,et._fonts[e]=t,t}static clearMetrics(e=""){e?delete et._fonts[e]:et._fonts={}}static get _canvas(){if(!et.__canvas){let e;try{const t=new OffscreenCanvas(0,0),r=t.getContext("2d",Zo);if(r!=null&&r.measureText)return et.__canvas=t,t;e=J.ADAPTER.createCanvas()}catch{e=J.ADAPTER.createCanvas()}e.width=e.height=10,et.__canvas=e}return et.__canvas}static get _context(){return et.__context||(et.__context=et._canvas.getContext("2d",Zo)),et.__context}};let ge=et;ge.METRICS_STRING="|ÉqÅ";ge.BASELINE_SYMBOL="M";ge.BASELINE_MULTIPLIER=1.4;ge.HEIGHT_MULTIPLIER=2;ge.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const e=new Intl.Segmenter;return t=>[...e.segment(t)].map(r=>r.segment)}return e=>[...e]})();ge.experimentalLetterSpacing=!1;ge._fonts={};ge._newlines=[10,13];ge._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const nB=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],ys=class{constructor(e){this.styleID=0,this.reset(),Zh(this,e,e)}clone(){const e={};return Zh(e,this,ys.defaultStyle),new ys(e)}reset(){Zh(this,ys.defaultStyle,ys.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=Kh(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=Kh(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){sB(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=Kh(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let r=t.length-1;r>=0;r--){let i=t[r].trim();!/([\"\'])[^\'\"]+\1/.test(i)&&!nB.includes(i)&&(i=`"${i}"`),t[r]=i}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};let zi=ys;zi.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Va.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};function Ig(e){return typeof e=="number"?ym(e):(typeof e=="string"&&e.startsWith("0x")&&(e=e.replace("0x","#")),e)}function Kh(e){if(Array.isArray(e)){for(let t=0;t<e.length;++t)e[t]=Ig(e[t]);return e}else return Ig(e)}function sB(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}function Zh(e,t,r){for(const i in r)Array.isArray(t[i])?e[i]=t[i].slice():e[i]=t[i]}const oB={texture:!0,children:!1,baseTexture:!0},Xu=class extends Hn{constructor(e,t,r){let i=!1;r||(r=J.ADAPTER.createCanvas(),i=!0),r.width=3,r.height=3;const n=it.from(r);n.orig=new Tt,n.trim=new Tt,super(n),this._ownCanvas=i,this.canvas=r,this.context=r.getContext("2d",{willReadFrequently:!0}),this._resolution=Xu.defaultResolution??J.RESOLUTION,this._autoResolution=Xu.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return ge.experimentalLetterSpacing}static set experimentalLetterSpacing(e){Ct("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),ge.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const r=this.context,i=ge.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=i.width,o=i.height,l=i.lines,h=i.lineHeight,u=i.lineWidths,f=i.maxLineWidth,d=i.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+t.padding*2)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=t.strokeThickness,r.textBaseline=t.textBaseline,r.lineJoin=t.lineJoin,r.miterLimit=t.miterLimit;let g,m;const v=t.dropShadow?2:1;for(let y=0;y<v;++y){const w=t.dropShadow&&y===0,x=w?Math.ceil(Math.max(1,o)+t.padding*2):0,A=x*this._resolution;if(w){r.fillStyle="black",r.strokeStyle="black";const E=t.dropShadowColor,I=Rs(typeof E=="number"?E:hc(E)),D=t.dropShadowBlur*this._resolution,L=t.dropShadowDistance*this._resolution;r.shadowColor=`rgba(${I[0]*255},${I[1]*255},${I[2]*255},${t.dropShadowAlpha})`,r.shadowBlur=D,r.shadowOffsetX=Math.cos(t.dropShadowAngle)*L,r.shadowOffsetY=Math.sin(t.dropShadowAngle)*L+A}else r.fillStyle=this._generateFillStyle(t,l,i),r.strokeStyle=t.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;let S=(h-d.fontSize)/2;h-d.fontSize<0&&(S=0);for(let E=0;E<l.length;E++)g=t.strokeThickness/2,m=t.strokeThickness/2+E*h+d.ascent+S,t.align==="right"?g+=f-u[E]:t.align==="center"&&(g+=(f-u[E])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(l[E],g+t.padding,m+t.padding-x,!0),t.fill&&this.drawLetterSpacing(l[E],g+t.padding,m+t.padding-x)}this.updateTexture()}drawLetterSpacing(e,t,r,i=!1){const o=this._style.letterSpacing;let l=!1;if(ge.experimentalLetterSpacingSupported&&(ge.experimentalLetterSpacing?(this.context.letterSpacing=`${o}px`,this.context.textLetterSpacing=`${o}px`,l=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),o===0||l){i?this.context.strokeText(e,t,r):this.context.fillText(e,t,r);return}let h=t;const u=ge.graphemeSegmenter(e);let f=this.context.measureText(e).width,d=0;for(let g=0;g<u.length;++g){const m=u[g];i?this.context.strokeText(m,h,r):this.context.fillText(m,h,r);let v="";for(let y=g+1;y<u.length;++y)v+=u[y];d=this.context.measureText(v).width,h+=f-d+o,f=d}}updateTexture(){const e=this.canvas;if(this._style.trim){const o=qR(e);o.data&&(e.width=o.width,e.height=o.height,this.context.putImageData(o.data,0,0))}const t=this._texture,r=this._style,i=r.trim?0:r.padding,n=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-i,t.trim.y=-i,t.orig.width=t._frame.width-i*2,t.orig.height=t._frame.height-i*2,this._onTextureUpdate(),n.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),this._textureID===-1&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,r){const i=e.fill;if(Array.isArray(i)){if(i.length===1)return i[0]}else return i;let n;const o=e.dropShadow?e.dropShadowDistance:0,l=e.padding||0,h=this.canvas.width/this._resolution-o-l*2,u=this.canvas.height/this._resolution-o-l*2,f=i.slice(),d=e.fillGradientStops.slice();if(!d.length){const g=f.length+1;for(let m=1;m<g;++m)d.push(m/g)}if(f.unshift(i[0]),d.unshift(0),f.push(i[i.length-1]),d.push(1),e.fillGradientType===Va.LINEAR_VERTICAL){n=this.context.createLinearGradient(h/2,l,h/2,u+l);const g=r.fontProperties.fontSize+e.strokeThickness;for(let m=0;m<t.length;m++){const v=r.lineHeight*(m-1)+g,y=r.lineHeight*m;let w=y;m>0&&v>y&&(w=(y+v)/2);const x=y+g,A=r.lineHeight*(m+1);let S=x;m+1<t.length&&A<x&&(S=(x+A)/2);const E=(S-w)/u;for(let I=0;I<f.length;I++){let D=0;typeof d[I]=="number"?D=d[I]:D=I/f.length;let L=Math.min(1,Math.max(0,w/u+D*E));L=Number(L.toFixed(5)),n.addColorStop(L,f[I])}}}else{n=this.context.createLinearGradient(l,u/2,h+l,u/2);const g=f.length+1;let m=1;for(let v=0;v<f.length;v++){let y;typeof d[v]=="number"?y=d[v]:y=m/g,n.addColorStop(y,f[v]),m++}}return n}destroy(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},oB,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=bn(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=bn(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},e instanceof zi?this._style=e:this._style=new zi(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};let xc=Xu;xc.defaultAutoResolution=!0;class aB{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function lB(e,t){var i;let r=!1;if((i=e==null?void 0:e._textures)!=null&&i.length){for(let n=0;n<e._textures.length;n++)if(e._textures[n]instanceof it){const o=e._textures[n].baseTexture;t.includes(o)||(t.push(o),r=!0)}}return r}function hB(e,t){if(e.baseTexture instanceof pt){const r=e.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function uB(e,t){if(e._texture&&e._texture instanceof it){const r=e._texture.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function cB(e,t){return t instanceof xc?(t.updateText(!0),!0):!1}function fB(e,t){if(t instanceof zi){const r=t.toFontString();return ge.measureFont(r),!0}return!1}function dB(e,t){if(e instanceof xc){t.includes(e.style)||t.push(e.style),t.includes(e)||t.push(e);const r=e._texture.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function pB(e,t){return e instanceof zi?(t.includes(e)||t.push(e),!0):!1}const Sv=class{constructor(e){this.limiter=new aB(Sv.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(dB),this.registerFindHook(pB),this.registerFindHook(lB),this.registerFindHook(hB),this.registerFindHook(uB),this.registerUploadHook(cB),this.registerUploadHook(fB)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,Me.system.addOnce(this.tick,this,On.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed){for(let r=0,i=this.uploadHooks.length;r<i;r++)if(this.uploadHooks[r](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)Me.system.addOnce(this.tick,this,On.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,r=e.length;t<r;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,r=this.addHooks.length;t<r&&!this.addHooks[t](e,this.queue);t++);if(e instanceof Ge)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&Me.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let Ma=Sv;Ma.uploadsPerFrame=4;Object.defineProperties(J,{UPLOADS_PER_FRAME:{get(){return Ma.uploadsPerFrame},set(e){Ct("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Ma.uploadsPerFrame=e}}});function Cv(e,t){return t instanceof pt?(t._glTextures[e.CONTEXT_UID]||e.texture.bind(t),!0):!1}function gB(e,t){if(!(t instanceof za))return!1;const{geometry:r}=t;t.finishPoly(),r.updateBatches();const{batches:i}=r;for(let n=0;n<i.length;n++){const{texture:o}=i[n].style;o&&Cv(e,o.baseTexture)}return r.batchable||e.geometry.bind(r,t._resolveDirectShader(e)),!0}function mB(e,t){return e instanceof za?(t.push(e),!0):!1}class Iv extends Ma{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(mB),this.registerUploadHook(Cv),this.registerUploadHook(gB)}}Iv.extension={name:"prepare",type:Z.RendererSystem};nt.add(Iv);var vB=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,_B=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,yB=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,Rg=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,xB=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const Jo=new $t;class Rv extends Wa{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Gm,this.state=qr.for2d()}contextChange(){const t=this.renderer,r={globals:t.globalUniforms};this.simpleShader=Mr.from(Rg,xB,r),this.shader=t.context.webGLVersion>1?Mr.from(_B,vB,r):Mr.from(Rg,yB,r)}render(t){const r=this.renderer,i=this.quad;let n=i.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const o=t.uvRespectAnchor?t.anchor.x:0,l=t.uvRespectAnchor?t.anchor.y:0;n=i.uvs,n[0]=n[6]=-o,n[1]=n[3]=-l,n[2]=n[4]=1-o,n[5]=n[7]=1-l,i.invalidate();const h=t._texture,u=h.baseTexture,f=u.alphaMode>0,d=t.tileTransform.localTransform,g=t.uvMatrix;let m=u.isPowerOfTwo&&h.frame.width===u.width&&h.frame.height===u.height;m&&(u._glTextures[r.CONTEXT_UID]?m=u.wrapMode!==ci.CLAMP:u.wrapMode===ci.CLAMP&&(u.wrapMode=ci.REPEAT));const v=m?this.simpleShader:this.shader,y=h.width,w=h.height,x=t._width,A=t._height;Jo.set(d.a*y/x,d.b*y/A,d.c*w/x,d.d*w/A,d.tx/x,d.ty/A),Jo.invert(),m?Jo.prepend(g.mapCoord):(v.uniforms.uMapCoord=g.mapCoord.toArray(!0),v.uniforms.uClampFrame=g.uClampFrame,v.uniforms.uClampOffset=g.uClampOffset),v.uniforms.uTransform=Jo.toArray(!0),v.uniforms.uColor=wm(t.tint,t.worldAlpha,v.uniforms.uColor,f),v.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),v.uniforms.uSampler=h,r.shader.bind(v),r.geometry.bind(i),this.state.blendMode=bm(t.blendMode,f),r.state.set(this.state),r.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Rv.extension={name:"tilingSprite",type:Z.RendererPlugin};nt.add(Rv);const xs=class{constructor(e,t,r=null){this.linkedSheets=[],this._texture=e instanceof it?e:null,this.baseTexture=e instanceof pt?e:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;const i=this.baseTexture.resource;this.resolution=this._updateResolution(r||(i?i.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:t}=this.data.meta;let r=fi(e,null);return r===null&&(r=parseFloat(t??"1")),r!==1&&this.baseTexture.setResolution(r),r}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=xs.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e;const r=xs.BATCH_SIZE;for(;t-e<r&&t<this._frameKeys.length;){const i=this._frameKeys[t],n=this._frames[i],o=n.frame;if(o){let l=null,h=null;const u=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,f=new Tt(0,0,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution);n.rotated?l=new Tt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):l=new Tt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(h=new Tt(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[i]=new it(this.baseTexture,l,f,h,n.rotated?2:0,n.anchor),it.addToCache(this.textures[i],i)}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let r=0;r<e[t].length;r++){const i=e[t][r];this.animations[t].push(this.textures[i])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*xs.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*xs.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){var t;for(const r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let zu=xs;zu.BATCH_SIZE=1e3;const bB=["jpg","png","jpeg","avif","webp"];function Pv(e,t,r){const i={};if(e.forEach(n=>{i[n]=t}),Object.keys(t.textures).forEach(n=>{i[n]=t.textures[n]}),!r){const n=ve.dirname(e[0]);t.linkedSheets.forEach((o,l)=>{const h=Pv([`${n}/${t.data.meta.related_multi_packs[l]}`],o,!0);Object.assign(i,h)})}return i}const wB={extension:Z.Asset,cache:{test:e=>e instanceof zu,getCacheableAssets:(e,t)=>Pv(e,t,!1)},resolver:{test:e=>{const r=e.split("?")[0].split("."),i=r.pop(),n=r.pop();return i==="json"&&bB.includes(n)},parse:e=>{var r;const t=e.split(".");return{resolution:parseFloat(((r=J.RETINA_PREFIX.exec(e))==null?void 0:r[1])??"1"),format:t[t.length-2],src:e}}},loader:{extension:{type:Z.LoadParser,priority:Br.Normal},async testParse(e,t){return ve.extname(t.src).toLowerCase()===".json"&&!!e.frames},async parse(e,t,r){var f,d;let i=ve.dirname(t.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");const n=i+e.meta.image,l=(await r.load([n]))[n],h=new zu(l.baseTexture,e,t.src);await h.parse();const u=(f=e==null?void 0:e.meta)==null?void 0:f.related_multi_packs;if(Array.isArray(u)){const g=[];for(const v of u){if(typeof v!="string")continue;const y=i+v;(d=t.data)!=null&&d.ignoreMultiPack||g.push(r.load({src:y,data:{ignoreMultiPack:!0}}))}const m=await Promise.all(g);h.linkedSheets=m,m.forEach(v=>{v.linkedSheets=[h].concat(h.linkedSheets.filter(y=>y!==v))})}return h},unload(e){e.destroy(!0)}}};nt.add(wB);class Da{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class fa{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const r=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const o in r){const l=r[o].match(/^[a-z]+/gm)[0],h=r[o].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),u={};for(const f in h){const d=h[f].split("="),g=d[0],m=d[1].replace(/"/gm,""),v=parseFloat(m),y=isNaN(v)?m:v;u[g]=y}i[l].push(u)}const n=new Da;return i.info.forEach(o=>n.info.push({face:o.face,size:parseInt(o.size,10)})),i.common.forEach(o=>n.common.push({lineHeight:parseInt(o.lineHeight,10)})),i.page.forEach(o=>n.page.push({id:parseInt(o.id,10),file:o.file})),i.char.forEach(o=>n.char.push({id:parseInt(o.id,10),page:parseInt(o.page,10),x:parseInt(o.x,10),y:parseInt(o.y,10),width:parseInt(o.width,10),height:parseInt(o.height,10),xoffset:parseInt(o.xoffset,10),yoffset:parseInt(o.yoffset,10),xadvance:parseInt(o.xadvance,10)})),i.kerning.forEach(o=>n.kerning.push({first:parseInt(o.first,10),second:parseInt(o.second,10),amount:parseInt(o.amount,10)})),i.distanceField.forEach(o=>n.distanceField.push({distanceRange:parseInt(o.distanceRange,10),fieldType:o.fieldType})),n}}class Vu{static test(t){const r=t;return"getElementsByTagName"in r&&r.getElementsByTagName("page").length&&r.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const r=new Da,i=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),o=t.getElementsByTagName("page"),l=t.getElementsByTagName("char"),h=t.getElementsByTagName("kerning"),u=t.getElementsByTagName("distanceField");for(let f=0;f<i.length;f++)r.info.push({face:i[f].getAttribute("face"),size:parseInt(i[f].getAttribute("size"),10)});for(let f=0;f<n.length;f++)r.common.push({lineHeight:parseInt(n[f].getAttribute("lineHeight"),10)});for(let f=0;f<o.length;f++)r.page.push({id:parseInt(o[f].getAttribute("id"),10)||0,file:o[f].getAttribute("file")});for(let f=0;f<l.length;f++){const d=l[f];r.char.push({id:parseInt(d.getAttribute("id"),10),page:parseInt(d.getAttribute("page"),10)||0,x:parseInt(d.getAttribute("x"),10),y:parseInt(d.getAttribute("y"),10),width:parseInt(d.getAttribute("width"),10),height:parseInt(d.getAttribute("height"),10),xoffset:parseInt(d.getAttribute("xoffset"),10),yoffset:parseInt(d.getAttribute("yoffset"),10),xadvance:parseInt(d.getAttribute("xadvance"),10)})}for(let f=0;f<h.length;f++)r.kerning.push({first:parseInt(h[f].getAttribute("first"),10),second:parseInt(h[f].getAttribute("second"),10),amount:parseInt(h[f].getAttribute("amount"),10)});for(let f=0;f<u.length;f++)r.distanceField.push({fieldType:u[f].getAttribute("fieldType"),distanceRange:parseInt(u[f].getAttribute("distanceRange"),10)});return r}}class Yu{static test(t){return typeof t=="string"&&t.includes("<font>")?Vu.test(J.ADAPTER.parseXML(t)):!1}static parse(t){return Vu.parse(J.ADAPTER.parseXML(t))}}const Jh=[fa,Vu,Yu];function EB(e){for(let t=0;t<Jh.length;t++)if(Jh[t].test(e))return Jh[t];return null}function TB(e,t,r,i,n,o){const l=r.fill;if(Array.isArray(l)){if(l.length===1)return l[0]}else return l;let h;const u=r.dropShadow?r.dropShadowDistance:0,f=r.padding||0,d=e.width/i-u-f*2,g=e.height/i-u-f*2,m=l.slice(),v=r.fillGradientStops.slice();if(!v.length){const y=m.length+1;for(let w=1;w<y;++w)v.push(w/y)}if(m.unshift(l[0]),v.unshift(0),m.push(l[l.length-1]),v.push(1),r.fillGradientType===Va.LINEAR_VERTICAL){h=t.createLinearGradient(d/2,f,d/2,g+f);let y=0;const x=(o.fontProperties.fontSize+r.strokeThickness)/g;for(let A=0;A<n.length;A++){const S=o.lineHeight*A;for(let E=0;E<m.length;E++){let I=0;typeof v[E]=="number"?I=v[E]:I=E/m.length;const D=S/g+I*x;let L=Math.max(y,D);L=Math.min(L,1),h.addColorStop(L,m[E]),y=L}}}else{h=t.createLinearGradient(f,g/2,d+f,g/2);const y=m.length+1;let w=1;for(let x=0;x<m.length;x++){let A;typeof v[x]=="number"?A=v[x]:A=w/y,h.addColorStop(A,m[x]),w++}}return h}function AB(e,t,r,i,n,o,l){const h=r.text,u=r.fontProperties;t.translate(i,n),t.scale(o,o);const f=l.strokeThickness/2,d=-(l.strokeThickness/2);if(t.font=l.toFontString(),t.lineWidth=l.strokeThickness,t.textBaseline=l.textBaseline,t.lineJoin=l.lineJoin,t.miterLimit=l.miterLimit,t.fillStyle=TB(e,t,l,o,[h],r),t.strokeStyle=l.stroke,l.dropShadow){const g=l.dropShadowColor,m=Rs(typeof g=="number"?g:hc(g)),v=l.dropShadowBlur*o,y=l.dropShadowDistance*o;t.shadowColor=`rgba(${m[0]*255},${m[1]*255},${m[2]*255},${l.dropShadowAlpha})`,t.shadowBlur=v,t.shadowOffsetX=Math.cos(l.dropShadowAngle)*y,t.shadowOffsetY=Math.sin(l.dropShadowAngle)*y}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;l.stroke&&l.strokeThickness&&t.strokeText(h,f,d+r.lineHeight-u.descent),l.fill&&t.fillText(h,f,d+r.lineHeight-u.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function da(e){return e.codePointAt?e.codePointAt(0):e.charCodeAt(0)}function Mv(e){return Array.from?Array.from(e):e.split("")}function SB(e){typeof e=="string"&&(e=[e]);const t=[];for(let r=0,i=e.length;r<i;r++){const n=e[r];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const o=n[0].charCodeAt(0),l=n[1].charCodeAt(0);if(l<o)throw new Error("[BitmapFont]: Invalid character range.");for(let h=o,u=l;h<=u;h++)t.push(String.fromCharCode(h))}else t.push(...Mv(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const lr=class{constructor(e,t,r){var f;const[i]=e.info,[n]=e.common,[o]=e.page,[l]=e.distanceField,h=fi(o.file),u={};this._ownsTextures=r,this.font=i.face,this.size=i.size,this.lineHeight=n.lineHeight/h,this.chars={},this.pageTextures=u;for(let d=0;d<e.page.length;d++){const{id:g,file:m}=e.page[d];u[g]=t instanceof Array?t[d]:t[m],l!=null&&l.fieldType&&l.fieldType!=="none"&&(u[g].baseTexture.alphaMode=mr.NO_PREMULTIPLIED_ALPHA,u[g].baseTexture.mipmap=Dr.OFF)}for(let d=0;d<e.char.length;d++){const{id:g,page:m}=e.char[d];let{x:v,y,width:w,height:x,xoffset:A,yoffset:S,xadvance:E}=e.char[d];v/=h,y/=h,w/=h,x/=h,A/=h,S/=h,E/=h;const I=new Tt(v+u[m].frame.x/h,y+u[m].frame.y/h,w,x);this.chars[g]={xOffset:A,yOffset:S,xAdvance:E,kerning:{},texture:new it(u[m].baseTexture,I),page:m}}for(let d=0;d<e.kerning.length;d++){let{first:g,second:m,amount:v}=e.kerning[d];g/=h,m/=h,v/=h,this.chars[m]&&(this.chars[m].kerning[g]=v)}this.distanceFieldRange=l==null?void 0:l.distanceRange,this.distanceFieldType=((f=l==null?void 0:l.fieldType)==null?void 0:f.toLowerCase())??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(e,t,r){let i;if(e instanceof Da)i=e;else{const o=EB(e);if(!o)throw new Error("Unrecognized data format for font.");i=o.parse(e)}t instanceof it&&(t=[t]);const n=new lr(i,t,r);return lr.available[n.font]=n,n}static uninstall(e){const t=lr.available[e];if(!t)throw new Error(`No font found named '${e}'`);t.destroy(),delete lr.available[e]}static from(e,t,r){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:i,padding:n,resolution:o,textureWidth:l,textureHeight:h,...u}=Object.assign({},lr.defaultOptions,r),f=SB(i),d=t instanceof zi?t:new zi(t),g=l,m=new Da;m.info[0]={face:d.fontFamily,size:d.fontSize},m.common[0]={lineHeight:d.fontSize};let v=0,y=0,w,x,A,S=0;const E=[];for(let D=0;D<f.length;D++){w||(w=J.ADAPTER.createCanvas(),w.width=l,w.height=h,x=w.getContext("2d"),A=new pt(w,{resolution:o,...u}),E.push(new it(A)),m.page.push({id:E.length-1,file:""}));const L=f[D],O=ge.measureText(L,d,!1,w),F=O.width,X=Math.ceil(O.height),j=Math.ceil((d.fontStyle==="italic"?2:1)*F);if(y>=h-X*o){if(y===0)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${L}')`);--D,w=null,x=null,A=null,y=0,v=0,S=0;continue}if(S=Math.max(X+O.fontProperties.descent,S),j*o+v>=g){if(v===0)throw new Error(`[BitmapFont] textureWidth ${l}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${L}')`);--D,y+=S*o,y=Math.ceil(y),v=0,S=0;continue}AB(w,x,O,v,y,o,d);const z=da(O.text);m.char.push({id:z,page:E.length-1,x:v/o,y:y/o,width:j,height:X,xoffset:0,yoffset:0,xadvance:Math.ceil(F-(d.dropShadow?d.dropShadowDistance:0)-(d.stroke?d.strokeThickness:0))}),v+=(j+2*n)*o,v=Math.ceil(v)}for(let D=0,L=f.length;D<L;D++){const O=f[D];for(let F=0;F<L;F++){const X=f[F],j=x.measureText(O).width,z=x.measureText(X).width,W=x.measureText(O+X).width-(j+z);W&&m.kerning.push({first:da(O),second:da(X),amount:W})}}const I=new lr(m,E,!0);return lr.available[e]!==void 0&&lr.uninstall(e),lr.available[e]=I,I}};let Pe=lr;Pe.ALPHA=[["a","z"],["A","Z"]," "];Pe.NUMERIC=[["0","9"]];Pe.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];Pe.ASCII=[[" ","~"]];Pe.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:lr.ALPHANUMERIC};Pe.available={};var CB=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r
\r
}\r
`,IB=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const Pg=[],Mg=[],Dg=[],Dv=class extends Ge{constructor(e,t={}){super(),this._tint=16777215;const{align:r,tint:i,maxWidth:n,letterSpacing:o,fontName:l,fontSize:h}=Object.assign({},Dv.styleDefaults,t);if(!Pe.available[l])throw new Error(`Missing BitmapFont "${l}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=r,this._tint=i,this._font=void 0,this._fontName=l,this._fontSize=h,this.text=e,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new ui(()=>{this.dirty=!0},this,0,0),this._roundPixels=J.ROUND_PIXELS,this.dirty=!0,this._resolution=J.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var j;const e=Pe.available[this._fontName],t=this.fontSize,r=t/e.size,i=new St,n=[],o=[],l=[],h=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",u=Mv(h),f=this._maxWidth*e.size/t,d=e.distanceFieldType==="none"?Pg:Mg;let g=null,m=0,v=0,y=0,w=-1,x=0,A=0,S=0,E=0;for(let z=0;z<u.length;z++){const K=u[z],W=da(K);if(/(?:\s)/.test(K)&&(w=z,x=m,E++),K==="\r"||K===`
`){o.push(m),l.push(-1),v=Math.max(v,m),++y,++A,i.x=0,i.y+=e.lineHeight,g=null,E=0;continue}const k=e.chars[W];if(!k)continue;g&&k.kerning[g]&&(i.x+=k.kerning[g]);const at=Dg.pop()||{texture:it.EMPTY,line:0,charCode:0,prevSpaces:0,position:new St};at.texture=k.texture,at.line=y,at.charCode=W,at.position.x=i.x+k.xOffset+this._letterSpacing/2,at.position.y=i.y+k.yOffset,at.prevSpaces=E,n.push(at),m=at.position.x+Math.max(k.xAdvance-k.xOffset,k.texture.orig.width),i.x+=k.xAdvance+this._letterSpacing,S=Math.max(S,k.yOffset+k.texture.height),g=W,w!==-1&&f>0&&i.x>f&&(++A,In(n,1+w-A,1+z-w),z=w,w=-1,o.push(x),l.push(n.length>0?n[n.length-1].prevSpaces:0),v=Math.max(v,x),y++,i.x=0,i.y+=e.lineHeight,g=null,E=0)}const I=u[u.length-1];I!=="\r"&&I!==`
`&&(/(?:\s)/.test(I)&&(m=x),o.push(m),v=Math.max(v,m),l.push(-1));const D=[];for(let z=0;z<=y;z++){let K=0;this._align==="right"?K=v-o[z]:this._align==="center"?K=(v-o[z])/2:this._align==="justify"&&(K=l[z]<0?0:(v-o[z])/l[z]),D.push(K)}const L=n.length,O={},F=[],X=this._activePagesMeshData;d.push(...X);for(let z=0;z<L;z++){const K=n[z].texture,W=K.baseTexture.uid;if(!O[W]){let k=d.pop();if(!k){const ft=new QD;let Y,vt;e.distanceFieldType==="none"?(Y=new Sg(it.EMPTY),vt=ut.NORMAL):(Y=new Sg(it.EMPTY,{program:cr.from(IB,CB),uniforms:{uFWidth:0}}),vt=ut.NORMAL_NPM);const Ot=new Hu(ft,Y);Ot.blendMode=vt,k={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:Ot,vertices:null,uvs:null,indices:null}}k.index=0,k.indexCount=0,k.vertexCount=0,k.uvsCount=0,k.total=0;const{_textureCache:at}=this;at[W]=at[W]||new it(K.baseTexture),k.mesh.texture=at[W],k.mesh.tint=this._tint,F.push(k),O[W]=k}O[W].total++}for(let z=0;z<X.length;z++)F.includes(X[z])||this.removeChild(X[z].mesh);for(let z=0;z<F.length;z++)F[z].mesh.parent!==this&&this.addChild(F[z].mesh);this._activePagesMeshData=F;for(const z in O){const K=O[z],W=K.total;if(!(((j=K.indices)==null?void 0:j.length)>6*W)||K.vertices.length<Hu.BATCHABLE_SIZE*2)K.vertices=new Float32Array(4*2*W),K.uvs=new Float32Array(4*2*W),K.indices=new Uint16Array(6*W);else{const k=K.total,at=K.vertices;for(let ft=k*4*2;ft<at.length;ft++)at[ft]=0}K.mesh.size=6*W}for(let z=0;z<L;z++){const K=n[z];let W=K.position.x+D[K.line]*(this._align==="justify"?K.prevSpaces:1);this._roundPixels&&(W=Math.round(W));const k=W*r,at=K.position.y*r,ft=K.texture,Y=O[ft.baseTexture.uid],vt=ft.frame,Ot=ft._uvs,H=Y.index++;Y.indices[H*6+0]=0+H*4,Y.indices[H*6+1]=1+H*4,Y.indices[H*6+2]=2+H*4,Y.indices[H*6+3]=0+H*4,Y.indices[H*6+4]=2+H*4,Y.indices[H*6+5]=3+H*4,Y.vertices[H*8+0]=k,Y.vertices[H*8+1]=at,Y.vertices[H*8+2]=k+vt.width*r,Y.vertices[H*8+3]=at,Y.vertices[H*8+4]=k+vt.width*r,Y.vertices[H*8+5]=at+vt.height*r,Y.vertices[H*8+6]=k,Y.vertices[H*8+7]=at+vt.height*r,Y.uvs[H*8+0]=Ot.x0,Y.uvs[H*8+1]=Ot.y0,Y.uvs[H*8+2]=Ot.x1,Y.uvs[H*8+3]=Ot.y1,Y.uvs[H*8+4]=Ot.x2,Y.uvs[H*8+5]=Ot.y2,Y.uvs[H*8+6]=Ot.x3,Y.uvs[H*8+7]=Ot.y3}this._textWidth=v*r,this._textHeight=(i.y+e.lineHeight)*r;for(const z in O){const K=O[z];if(this.anchor.x!==0||this.anchor.y!==0){let ft=0;const Y=this._textWidth*this.anchor.x,vt=this._textHeight*this.anchor.y;for(let Ot=0;Ot<K.total;Ot++)K.vertices[ft++]-=Y,K.vertices[ft++]-=vt,K.vertices[ft++]-=Y,K.vertices[ft++]-=vt,K.vertices[ft++]-=Y,K.vertices[ft++]-=vt,K.vertices[ft++]-=Y,K.vertices[ft++]-=vt}this._maxLineHeight=S*r;const W=K.mesh.geometry.getBuffer("aVertexPosition"),k=K.mesh.geometry.getBuffer("aTextureCoord"),at=K.mesh.geometry.getIndex();W.data=K.vertices,k.data=K.uvs,at.data=K.indices,W.update(),k.update(),at.update()}for(let z=0;z<n.length;z++)Dg.push(n[z]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:r,size:i}=Pe.available[this._fontName];if(r!=="none"){const{a:n,b:o,c:l,d:h}=this.worldTransform,u=Math.sqrt(n*n+o*o),f=Math.sqrt(l*l+h*h),d=(Math.abs(u)+Math.abs(f))/2,g=this.fontSize/i,m=e._view.resolution;for(const v of this._activePagesMeshData)v.mesh.shader.uniforms.uFWidth=d*t*g*m}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=Pe.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tint}set tint(e){if(this._tint!==e){this._tint=e;for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!Pe.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??Pe.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,i=Pe.available[this._fontName].distanceFieldType==="none"?Pg:Mg;i.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],i.filter(n=>t[n.mesh.texture.baseTexture.uid]).forEach(n=>{n.mesh.texture=it.EMPTY});for(const n in t)t[n].destroy(),delete t[n];this._font=null,this._textureCache=null,super.destroy(e)}};let RB=Dv;RB.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const PB=[".xml",".fnt"],MB={extension:{type:Z.LoadParser,priority:Br.Normal},test(e){return PB.includes(ve.extname(e).toLowerCase())},async testParse(e){return fa.test(e)||Yu.test(e)},async parse(e,t,r){const i=fa.test(e)?fa.parse(e):Yu.parse(e),{src:n}=t,{page:o}=i,l=[];for(let f=0;f<o.length;++f){const d=o[f].file,g=ve.join(ve.dirname(n),d);l.push(g)}const h=await r.load(l),u=l.map(f=>h[f]);return Pe.install(i,u,!0)},async load(e,t){return(await J.ADAPTER.fetch(e)).text()},unload(e){e.destroy()}};nt.add(MB);const DB={A:"menlo-bold-0.png",B:"menlo-bold-1.png",C:"menlo-bold-2.png",D:"menlo-bold-3.png",E:"menlo-bold-4.png",F:"menlo-bold-5.png",G:"menlo-bold-6.png",H:"menlo-bold-7.png",I:"menlo-bold-8.png",J:"menlo-bold-9.png",K:"menlo-bold-10.png",L:"menlo-bold-11.png",M:"menlo-bold-12.png",N:"menlo-bold-13.png",O:"menlo-bold-14.png",P:"menlo-bold-15.png",Q:"menlo-bold-16.png",R:"menlo-bold-17.png",S:"menlo-bold-18.png",T:"menlo-bold-19.png",U:"menlo-bold-20.png",V:"menlo-bold-21.png",W:"menlo-bold-22.png",X:"menlo-bold-23.png",Y:"menlo-bold-24.png",Z:"menlo-bold-25.png",a:"menlo-bold-26.png",b:"menlo-bold-27.png",c:"menlo-bold-28.png",d:"menlo-bold-29.png",e:"menlo-bold-30.png",f:"menlo-bold-31.png",g:"menlo-bold-32.png",h:"menlo-bold-33.png",i:"menlo-bold-34.png",j:"menlo-bold-35.png",k:"menlo-bold-36.png",l:"menlo-bold-37.png",m:"menlo-bold-38.png",n:"menlo-bold-39.png",o:"menlo-bold-40.png",p:"menlo-bold-41.png",q:"menlo-bold-42.png",r:"menlo-bold-43.png",s:"menlo-bold-44.png",t:"menlo-bold-45.png",u:"menlo-bold-46.png",v:"menlo-bold-47.png",w:"menlo-bold-48.png",x:"menlo-bold-49.png",y:"menlo-bold-50.png",z:"menlo-bold-51.png",0:"menlo-bold-52.png",1:"menlo-bold-53.png",2:"menlo-bold-54.png",3:"menlo-bold-55.png",4:"menlo-bold-56.png",5:"menlo-bold-57.png",6:"menlo-bold-58.png",7:"menlo-bold-59.png",8:"menlo-bold-60.png",9:"menlo-bold-61.png","!":"menlo-bold-62.png","@":"menlo-bold-63.png","#":"menlo-bold-64.png",$:"menlo-bold-65.png","%":"menlo-bold-66.png","^":"menlo-bold-67.png","&":"menlo-bold-68.png","*":"menlo-bold-69.png","(":"menlo-bold-70.png",")":"menlo-bold-71.png","-":"menlo-bold-72.png",_:"menlo-bold-73.png","=":"menlo-bold-74.png","+":"menlo-bold-75.png",",":"menlo-bold-76.png",".":"menlo-bold-77.png","<":"menlo-bold-78.png",">":"menlo-bold-79.png","/":"menlo-bold-80.png","?":"menlo-bold-81.png",";":"menlo-bold-82.png",":":"menlo-bold-83.png",'"':"menlo-bold-84.png","'":"menlo-bold-85.png","[":"menlo-bold-86.png","]":"menlo-bold-87.png","{":"menlo-bold-88.png","}":"menlo-bold-89.png","\\":"menlo-bold-90.png","|":"menlo-bold-91.png","`":"menlo-bold-92.png","~":"menlo-bold-93.png","•":"menlo-bold-94.png"},BB={A:"menlo-bold-half-0.png",B:"menlo-bold-half-1.png",C:"menlo-bold-half-2.png",D:"menlo-bold-half-3.png",E:"menlo-bold-half-4.png",F:"menlo-bold-half-5.png",G:"menlo-bold-half-6.png",H:"menlo-bold-half-7.png",I:"menlo-bold-half-8.png",J:"menlo-bold-half-9.png",K:"menlo-bold-half-10.png",L:"menlo-bold-half-11.png",M:"menlo-bold-half-12.png",N:"menlo-bold-half-13.png",O:"menlo-bold-half-14.png",P:"menlo-bold-half-15.png",Q:"menlo-bold-half-16.png",R:"menlo-bold-half-17.png",S:"menlo-bold-half-18.png",T:"menlo-bold-half-19.png",U:"menlo-bold-half-20.png",V:"menlo-bold-half-21.png",W:"menlo-bold-half-22.png",X:"menlo-bold-half-23.png",Y:"menlo-bold-half-24.png",Z:"menlo-bold-half-25.png",a:"menlo-bold-half-26.png",b:"menlo-bold-half-27.png",c:"menlo-bold-half-28.png",d:"menlo-bold-half-29.png",e:"menlo-bold-half-30.png",f:"menlo-bold-half-31.png",g:"menlo-bold-half-32.png",h:"menlo-bold-half-33.png",i:"menlo-bold-half-34.png",j:"menlo-bold-half-35.png",k:"menlo-bold-half-36.png",l:"menlo-bold-half-37.png",m:"menlo-bold-half-38.png",n:"menlo-bold-half-39.png",o:"menlo-bold-half-40.png",p:"menlo-bold-half-41.png",q:"menlo-bold-half-42.png",r:"menlo-bold-half-43.png",s:"menlo-bold-half-44.png",t:"menlo-bold-half-45.png",u:"menlo-bold-half-46.png",v:"menlo-bold-half-47.png",w:"menlo-bold-half-48.png",x:"menlo-bold-half-49.png",y:"menlo-bold-half-50.png",z:"menlo-bold-half-51.png",0:"menlo-bold-half-52.png",1:"menlo-bold-half-53.png",2:"menlo-bold-half-54.png",3:"menlo-bold-half-55.png",4:"menlo-bold-half-56.png",5:"menlo-bold-half-57.png",6:"menlo-bold-half-58.png",7:"menlo-bold-half-59.png",8:"menlo-bold-half-60.png",9:"menlo-bold-half-61.png","!":"menlo-bold-half-62.png","@":"menlo-bold-half-63.png","#":"menlo-bold-half-64.png",$:"menlo-bold-half-65.png","%":"menlo-bold-half-66.png","^":"menlo-bold-half-67.png","&":"menlo-bold-half-68.png","*":"menlo-bold-half-69.png","(":"menlo-bold-half-70.png",")":"menlo-bold-half-71.png","-":"menlo-bold-half-72.png",_:"menlo-bold-half-73.png","=":"menlo-bold-half-74.png","+":"menlo-bold-half-75.png",",":"menlo-bold-half-76.png",".":"menlo-bold-half-77.png","<":"menlo-bold-half-78.png",">":"menlo-bold-half-79.png","/":"menlo-bold-half-80.png","?":"menlo-bold-half-81.png",";":"menlo-bold-half-82.png",":":"menlo-bold-half-83.png",'"':"menlo-bold-half-84.png","'":"menlo-bold-half-85.png","[":"menlo-bold-half-86.png","]":"menlo-bold-half-87.png","{":"menlo-bold-half-88.png","}":"menlo-bold-half-89.png","\\":"menlo-bold-half-90.png","|":"menlo-bold-half-91.png","`":"menlo-bold-half-92.png","~":"menlo-bold-half-93.png","•":"menlo-bold-half-94.png"};let Bv;const Ov={width:100,height:46},li=window.innerWidth/Ov.width,OB=(e,t,r)=>{const i=Math.trunc(e/li),n=Math.trunc(t/li);return`${i},${n},${r}`},ki={};async function FB(e){Bv=new mc({view:e,width:window.innerWidth,height:li*Ov.height,autoDensity:!0,resolution:window.devicePixelRatio||1}),await LB()}const LB=async()=>(ki.ascii=await Li.load("/forcecrusher/fonts/menlo-bold.json"),ki.text=await Li.load("/forcecrusher/fonts/menlo-bold-half.json"),ki.tile=await Li.load("/forcecrusher/tile.png"),ki),NB=e=>ki.ascii.textures[DB[e]],kB=e=>ki.text.textures[BB[e]],UB=()=>ki.tile;class wr{constructor(t){Zt(this,"x",0);Zt(this,"y",0);Zt(this,"halfWidth",!1);Zt(this,"width");Zt(this,"height");Zt(this,"layers",[]);Zt(this,"sprites",[]);Zt(this,"tileSets",[]);Zt(this,"tints",[]);Zt(this,"alphas",[]);Zt(this,"visible",!0);Zt(this,"_getTexture",t=>{const{tileSet:r,char:i}=t;return r==="ascii"?NB(i):r==="text"?kB(i):UB()});Zt(this,"_createSprite",t=>{const{char:r,width:i,height:n,layer:o,x:l,y:h,tileSet:u,tint:f=16777215,alpha:d=1}=t,g=this._getTexture({tileSet:u,char:r});let m=new Hn(g);m.width=this.halfWidth?i/2:i,m.height=n,m.x=this.halfWidth?l*(i/2):l*i,m.y=h*n,m.tint=f,m.alpha=d,this.sprites[o][h][l]=m,this.layers[o].addChild(m)});Zt(this,"updateCell",t=>(Object.keys(t).forEach(r=>{const{char:i,tint:n,alpha:o,tileSet:l,x:h,y:u}=t[r];this.updateSprite({char:i,tint:n,alpha:o,tileSet:l,x:h,y:u,layer:parseInt(r)})}),this));Zt(this,"updateSprite",async t=>{const{char:r="",layer:i,x:n,y:o,tileSet:l="text",tint:h,alpha:u}=t,f=this.sprites[i][o][n];if(f)return f.texture=this._getTexture({tileSet:l,char:r}),h&&(f.tint=h),typeof u<"u"&&(f.alpha=u),this});Zt(this,"updateRows",t=>(t.forEach((r,i)=>{r.forEach((n,o)=>{this.clearRow(o,i),this.updateRow({...n,layer:o,y:i})})}),this));Zt(this,"updateRow",t=>{const{string:r="",layer:i=0,x:n,y:o,tileSet:l,tint:h,alpha:u}=t;return[...r].forEach((d,g)=>this.updateSprite({char:d,layer:i||0,x:n||0+g,y:o||0,tileSet:l||this.tileSets[i],tint:h||this.tints[i],alpha:u||this.alphas[i]})),(l||this.tileSets[i])==="tile"&&Ci.times(this.width,d=>{this.updateSprite({layer:i,x:n||0+d,y:o||0,tileSet:l||this.tileSets[i],tint:h||this.tints[i],alpha:u||this.alphas[i]})}),this});Zt(this,"clearRow",(t,r)=>{const i=new Array(this.width+1).join(" ");this.updateRow({string:i,layer:t,y:r})});Zt(this,"clearView",()=>{let t=0;this.layers.forEach(()=>{Ci.times(this.height,r=>{this.clearRow(t,r)}),t+=1})});Zt(this,"show",()=>{this.visible=!0,this.layers.forEach(t=>t.visible=this.visible)});Zt(this,"hide",()=>{this.visible=!1,this.layers.forEach(t=>t.visible=this.visible)});return this.width=t.width,this.height=t.height,this.tileSets=t.tileSets,this.tints=t.tints,this.alphas=t.alphas,this.halfWidth=this.tileSets.includes("text"),this.visible=t.visible,Ci.times(t.layers,()=>this.layers.push(new Ge)),this.layers.forEach(r=>{const i=this.halfWidth?t.x*(li/2):t.x*li,n=t.y*li;r.x=i,r.y=n,r.interactiveChildren=!1,r.visible=this.visible,Bv.stage.addChild(r)}),Ci.times(t.layers,()=>this.sprites.push(Array.from(Array(this.height),()=>Array.from(Array(this.width))))),Ci.times(t.layers,r=>{Ci.times(this.height,i=>{Ci.times(this.width,async n=>{this._createSprite({char:"",width:li,height:li,layer:r,x:n,y:i,tileSet:t.tileSets[r],tint:t.tints[r],alpha:t.alphas[r]})})})}),this}}var Fv={exports:{}},bc={};Object.defineProperty(bc,"__esModule",{value:!0});function ju(e,t){t=e.length;for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function GB(e){if(Array.isArray(e))return ju(e)}function WB(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Lv(e,t){if(e){if(typeof e=="string")return ju(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ju(e,t)}}function $B(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function HB(e){return GB(e)||WB(e)||Lv(e)||$B()}function XB(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Lv(e))||t){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(u){throw u},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,l=!1,h;return{s:function(){r=r.call(e)},n:function(){var u=r.next();return o=u.done,u},e:function(u){l=!0,h=u},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(l)throw h}}}}function zB(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function VB(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Nv(e){var t=VB(e,"string");return typeof t=="symbol"?t:String(t)}function YB(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Nv(i.key),i)}}function jB(e,t,r){return t&&YB(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function qB(e,t,r){return t=Nv(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var KB=function(){function e(){zB(this,e),qB(this,"subscribers",new Set)}return jB(e,[{key:"onSubscribe",get:function(){return this._onSubscribe||(this._onSubscribe=new e),this._onSubscribe}},{key:"onUnsubscribe",get:function(){return this._onUnsubscribe||(this._onUnsubscribe=new e),this._onUnsubscribe}},{key:"subscribe",value:function(r){var i,n=this;return this.subscribers.add(r),(i=this._onSubscribe)===null||i===void 0||i.emit(r),function(){return n.unsubscribe(r)}}},{key:"unsubscribe",value:function(r){var i;this.subscribers.delete(r),(i=this._onUnsubscribe)===null||i===void 0||i.emit(r)}},{key:"clear",value:function(){if(this._onUnsubscribe){var r=XB(this.subscribers),i;try{for(r.s();!(i=r.n()).done;){var n=i.value;this._onUnsubscribe.emit(n)}}catch(o){r.e(o)}finally{r.f()}}this.subscribers.clear()}},{key:"emit",value:function(){for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];this.subscribers.forEach(function(o){return o.apply(void 0,i)})}},{key:"emitAsync",value:function(){for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return Promise.all(HB(this.subscribers).map(function(o){return o.apply(void 0,i)}))}}]),e}();bc.Event=KB;Fv.exports=bc;var Bg=Fv.exports;function Og(e,t){t=e.length;for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function ZB(e,t){if(e){if(typeof e=="string")return Og(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Og(e,t)}}function JB(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ZB(e))||t){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(u){throw u},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,l=!1,h;return{s:function(){r=r.call(e)},n:function(){var u=r.next();return o=u.done,u},e:function(u){l=!0,h=u},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(l)throw h}}}}function QB(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tO(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function kv(e){var t=tO(e,"string");return typeof t=="symbol"?t:String(t)}function eO(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,kv(i.key),i)}}function rO(e,t,r){return t&&eO(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Qo(e,t,r){return t=kv(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Uv;Uv=Symbol.iterator;var Gv=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];QB(this,e),Qo(this,"_version",0),Qo(this,"onEntityAdded",new Bg.Event),Qo(this,"onEntityRemoved",new Bg.Event),Qo(this,"entityPositions",new Map),this._entities=t,this.add=this.add.bind(this),this.remove=this.remove.bind(this);for(var r=0;r<t.length;r++)this.entityPositions.set(t[r],r)}return rO(e,[{key:"version",get:function(){return this._version}},{key:"entities",get:function(){return this._entities}},{key:Uv,value:function(){var r=this,i=this._entities.length,n={value:void 0,done:!1};return{next:function(){return n.value=r._entities[--i],n.done=i<0,n}}}},{key:"size",get:function(){return this.entities.length}},{key:"first",get:function(){return this.entities[0]}},{key:"has",value:function(r){return this.entityPositions.has(r)}},{key:"add",value:function(r){return r&&!this.has(r)&&(this.entities.push(r),this.entityPositions.set(r,this.entities.length-1),this._version++,this.onEntityAdded.emit(r)),r}},{key:"remove",value:function(r){if(this.has(r)){this.onEntityRemoved.emit(r);var i=this.entityPositions.get(r);this.entityPositions.delete(r);var n=this.entities[this.entities.length-1];n!==r&&(this.entities[i]=n,this.entityPositions.set(n,i)),this.entities.pop(),this._version++}return r}},{key:"clear",value:function(){var r=JB(this),i;try{for(r.s();!(i=r.n()).done;){var n=i.value;this.remove(n)}}catch(o){r.e(o)}finally{r.f()}}}]),e}(),Fg=new WeakMap,Lg=0,iO=function(t){var r=Fg.get(t);return r!==void 0?r:(Fg.set(t,Lg),Lg++)};function nO(){var e=new Array;function t(n){e.push(n)}function r(){e.length=0}function i(){e.forEach(function(n){return n()}),r()}return t.clear=r,t.flush=i,t}function qu(e,t){t=e.length;for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function sO(e){if(Array.isArray(e))return qu(e)}function oO(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Wv(e,t){if(e){if(typeof e=="string")return qu(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qu(e,t)}}function aO(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ts(e){return sO(e)||oO(e)||Wv(e)||aO()}function Vi(e){return Vi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Vi(e)}function lO(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=Vi(e),e!==null););return e}function As(){return typeof Reflect<"u"&&Reflect.get?As=Reflect.get.bind():As=function(t,r,i){var n=lO(t,r);if(n){var o=Object.getOwnPropertyDescriptor(n,r);return o.get?o.get.call(arguments.length<3?t:i):o.value}},As.apply(this,arguments)}function Ku(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Wv(e))||t){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(u){throw u},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,l=!1,h;return{s:function(){r=r.call(e)},n:function(){var u=r.next();return o=u.done,u},e:function(u){l=!0,h=u},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(l)throw h}}}}function hO(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function $v(e){var t=hO(e,"string");return typeof t=="symbol"?t:String(t)}function En(e,t,r){return t=$v(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ng(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function Oi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ng(Object(r),!0).forEach(function(i){En(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ng(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Hv(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function uO(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,$v(i.key),i)}}function Xv(e,t,r){return t&&uO(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Tn(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zu(e,t){return Zu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,n){return i.__proto__=n,i},Zu(e,t)}function zv(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Zu(e,t)}function cO(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function fO(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Tn(e)}function Vv(e){var t=cO();return function(){var i=Vi(e),n;if(t){var o=Vi(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return fO(this,n)}}var Yv,dO=function(e){zv(r,e);var t=Vv(r);function r(){var i,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return Hv(this,r),i=t.call(this,n),En(Tn(i),"queries",new Set),En(Tn(i),"entityToId",new Map),En(Tn(i),"idToEntity",new Map),En(Tn(i),"nextId",0),i.onEntityAdded.subscribe(function(o){i.reindex(o)}),i.onEntityRemoved.subscribe(function(o){if(i.queries.forEach(function(h){return h.remove(o)}),i.entityToId.has(o)){var l=i.entityToId.get(o);i.idToEntity.delete(l),i.entityToId.delete(o)}}),i}return Xv(r,[{key:"update",value:function(i){function n(o,l,h){return i.apply(this,arguments)}return n.toString=function(){return i.toString()},n}(function(i,n,o){if(typeof n=="function"){var l=n(i);l&&Object.assign(i,l)}else typeof n=="string"?i[n]=o:n&&Object.assign(i,n);return this.reindex(i),i})},{key:"addComponent",value:function(n,o,l){n[o]===void 0&&(n[o]=l,this.reindex(n))}},{key:"removeComponent",value:function(n,o){if(n[o]!==void 0){if(this.has(n)){var l=Oi({},n);delete l[o],this.reindex(n,l)}delete n[o]}}},{key:"query",value:function(n){var o=mO(n),l=jv(o),h=Ku(this.queries),u;try{for(h.s();!(u=h.n()).done;){var f=u.value;if(f.key===l)return f}}catch(g){h.e(g)}finally{h.f()}var d=new pO(this,o);return this.queries.add(d),d}},{key:"with",value:function(){for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return this.query({with:o,without:[],predicates:[]})}},{key:"without",value:function(){for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return this.query({with:[],without:o,predicates:[]})}},{key:"where",value:function(n){return this.query({with:[],without:[],predicates:[n]})}},{key:"reindex",value:function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:n;if(this.has(n)){var l=Ku(this.queries),h;try{for(l.s();!(h=l.n()).done;){var u=h.value;u.evaluate(n,o)}}catch(f){l.e(f)}finally{l.f()}}}},{key:"id",value:function(n){if(this.has(n)){if(!this.entityToId.has(n)){var o=this.nextId++;this.entityToId.set(n,o),this.idToEntity.set(o,n)}return this.entityToId.get(n)}}},{key:"entity",value:function(n){return this.idToEntity.get(n)}}]),r}(Gv);Yv=Symbol.iterator;var pO=function(e){zv(r,e);var t=Vv(r);function r(i,n){var o;return Hv(this,r),o=t.call(this),En(Tn(o),"_isConnected",!1),o.world=i,o.config=n,o.key=jv(n),o.onEntityAdded.onSubscribe.subscribe(function(){return o.connect()}),o.onEntityRemoved.onSubscribe.subscribe(function(){return o.connect()}),o}return Xv(r,[{key:"isConnected",get:function(){return this._isConnected}},{key:"entities",get:function(){return this._isConnected||this.connect(),As(Vi(r.prototype),"entities",this)}},{key:Yv,value:function(){return this._isConnected||this.connect(),As(Vi(r.prototype),Symbol.iterator,this).call(this)}},{key:"connect",value:function(){if(!this._isConnected){this._isConnected=!0;var n=Ku(this.world),o;try{for(n.s();!(o=n.n()).done;){var l=o.value;this.evaluate(l)}}catch(h){n.e(h)}finally{n.f()}}return this}},{key:"disconnect",value:function(){return this._isConnected=!1,this}},{key:"with",value:function(){for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return this.world.query(Oi(Oi({},this.config),{},{with:[].concat(Ts(this.config.with),o)}))}},{key:"without",value:function(){for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return this.world.query(Oi(Oi({},this.config),{},{without:[].concat(Ts(this.config.without),o)}))}},{key:"where",value:function(n){return this.world.query(Oi(Oi({},this.config),{},{predicates:[].concat(Ts(this.config.predicates),[n])}))}},{key:"want",value:function(n){return this.config.with.every(function(o){return n[o]!==void 0})&&this.config.without.every(function(o){return n[o]===void 0})&&this.config.predicates.every(function(o){return o(n)})}},{key:"evaluate",value:function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:n;if(this.isConnected){var l=this.want(o),h=this.has(n);l&&!h?this.add(n):!l&&h&&this.remove(n)}}}]),r}(Gv),kg=function(t){return Ts(new Set(t.sort().filter(function(r){return!!r&&r!==""})))};function gO(e){return Ts(new Set(e))}function mO(e){return{with:kg(e.with),without:kg(e.without),predicates:gO(e.predicates)}}function jv(e){return"".concat(e.with.join(","),":").concat(e.without.join(","),":").concat(e.predicates.map(function(t){return iO(t)}).join(","))}nO();const xt=new dO;var wc={exports:{}};wc.exports;(function(e){(function(){var t,r,i,n,o,l,h,u,f,d,g,m,v,y,w;i=Math.floor,d=Math.min,r=function(x,A){return x<A?-1:x>A?1:0},f=function(x,A,S,E,I){var D;if(S==null&&(S=0),I==null&&(I=r),S<0)throw new Error("lo must be non-negative");for(E==null&&(E=x.length);S<E;)D=i((S+E)/2),I(A,x[D])<0?E=D:S=D+1;return[].splice.apply(x,[S,S-S].concat(A)),A},l=function(x,A,S){return S==null&&(S=r),x.push(A),y(x,0,x.length-1,S)},o=function(x,A){var S,E;return A==null&&(A=r),S=x.pop(),x.length?(E=x[0],x[0]=S,w(x,0,A)):E=S,E},u=function(x,A,S){var E;return S==null&&(S=r),E=x[0],x[0]=A,w(x,0,S),E},h=function(x,A,S){var E;return S==null&&(S=r),x.length&&S(x[0],A)<0&&(E=[x[0],A],A=E[0],x[0]=E[1],w(x,0,S)),A},n=function(x,A){var S,E,I,D,L,O;for(A==null&&(A=r),D=(function(){O=[];for(var F=0,X=i(x.length/2);0<=X?F<X:F>X;0<=X?F++:F--)O.push(F);return O}).apply(this).reverse(),L=[],E=0,I=D.length;E<I;E++)S=D[E],L.push(w(x,S,A));return L},v=function(x,A,S){var E;if(S==null&&(S=r),E=x.indexOf(A),E!==-1)return y(x,0,E,S),w(x,E,S)},g=function(x,A,S){var E,I,D,L,O;if(S==null&&(S=r),I=x.slice(0,A),!I.length)return I;for(n(I,S),O=x.slice(A),D=0,L=O.length;D<L;D++)E=O[D],h(I,E,S);return I.sort(S).reverse()},m=function(x,A,S){var E,I,D,L,O,F,X,j,z;if(S==null&&(S=r),A*10<=x.length){if(D=x.slice(0,A).sort(S),!D.length)return D;for(I=D[D.length-1],X=x.slice(A),L=0,F=X.length;L<F;L++)E=X[L],S(E,I)<0&&(f(D,E,0,null,S),D.pop(),I=D[D.length-1]);return D}for(n(x,S),z=[],O=0,j=d(A,x.length);0<=j?O<j:O>j;0<=j?++O:--O)z.push(o(x,S));return z},y=function(x,A,S,E){var I,D,L;for(E==null&&(E=r),I=x[S];S>A;){if(L=S-1>>1,D=x[L],E(I,D)<0){x[S]=D,S=L;continue}break}return x[S]=I},w=function(x,A,S){var E,I,D,L,O;for(S==null&&(S=r),I=x.length,O=A,D=x[A],E=2*A+1;E<I;)L=E+1,L<I&&!(S(x[E],x[L])<0)&&(E=L),x[A]=x[E],A=E,E=2*A+1;return x[A]=D,y(x,O,A,S)},t=function(){x.push=l,x.pop=o,x.replace=u,x.pushpop=h,x.heapify=n,x.updateItem=v,x.nlargest=g,x.nsmallest=m;function x(A){this.cmp=A??r,this.nodes=[]}return x.prototype.push=function(A){return l(this.nodes,A,this.cmp)},x.prototype.pop=function(){return o(this.nodes,this.cmp)},x.prototype.peek=function(){return this.nodes[0]},x.prototype.contains=function(A){return this.nodes.indexOf(A)!==-1},x.prototype.replace=function(A){return u(this.nodes,A,this.cmp)},x.prototype.pushpop=function(A){return h(this.nodes,A,this.cmp)},x.prototype.heapify=function(){return n(this.nodes,this.cmp)},x.prototype.updateItem=function(A){return v(this.nodes,A,this.cmp)},x.prototype.clear=function(){return this.nodes=[]},x.prototype.empty=function(){return this.nodes.length===0},x.prototype.size=function(){return this.nodes.length},x.prototype.clone=function(){var A;return A=new x,A.nodes=this.nodes.slice(0),A},x.prototype.toArray=function(){return this.nodes.slice(0)},x.prototype.insert=x.prototype.push,x.prototype.top=x.prototype.peek,x.prototype.front=x.prototype.peek,x.prototype.has=x.prototype.contains,x.prototype.copy=x.prototype.clone,x}(),e!==null&&e.exports?e.exports=t:window.Heap=t}).call(Cr)})(wc);var vO=wc.exports,Ya=vO;function _O(e,t,r){this.x=e,this.y=t,this.walkable=r===void 0?!0:r}var Ec=_O,yO={Always:1,Never:2,IfAtMostOneObstacle:3,OnlyWhenNoObstacles:4},Je=yO,qv=Ec,ta=Je;function jr(e,t,r){var i;typeof e!="object"?i=e:(t=e.length,i=e[0].length,r=e),this.width=i,this.height=t,this.nodes=this._buildNodes(i,t,r)}jr.prototype._buildNodes=function(e,t,r){var i,n,o=new Array(t);for(i=0;i<t;++i)for(o[i]=new Array(e),n=0;n<e;++n)o[i][n]=new qv(n,i);if(r===void 0)return o;if(r.length!==t||r[0].length!==e)throw new Error("Matrix size does not fit");for(i=0;i<t;++i)for(n=0;n<e;++n)r[i][n]&&(o[i][n].walkable=!1);return o};jr.prototype.getNodeAt=function(e,t){return this.nodes[t][e]};jr.prototype.isWalkableAt=function(e,t){return this.isInside(e,t)&&this.nodes[t][e].walkable};jr.prototype.isInside=function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height};jr.prototype.setWalkableAt=function(e,t,r){this.nodes[t][e].walkable=r};jr.prototype.getNeighbors=function(e,t){var r=e.x,i=e.y,n=[],o=!1,l=!1,h=!1,u=!1,f=!1,d=!1,g=!1,m=!1,v=this.nodes;if(this.isWalkableAt(r,i-1)&&(n.push(v[i-1][r]),o=!0),this.isWalkableAt(r+1,i)&&(n.push(v[i][r+1]),h=!0),this.isWalkableAt(r,i+1)&&(n.push(v[i+1][r]),f=!0),this.isWalkableAt(r-1,i)&&(n.push(v[i][r-1]),g=!0),t===ta.Never)return n;if(t===ta.OnlyWhenNoObstacles)l=g&&o,u=o&&h,d=h&&f,m=f&&g;else if(t===ta.IfAtMostOneObstacle)l=g||o,u=o||h,d=h||f,m=f||g;else if(t===ta.Always)l=!0,u=!0,d=!0,m=!0;else throw new Error("Incorrect value of diagonalMovement");return l&&this.isWalkableAt(r-1,i-1)&&n.push(v[i-1][r-1]),u&&this.isWalkableAt(r+1,i-1)&&n.push(v[i-1][r+1]),d&&this.isWalkableAt(r+1,i+1)&&n.push(v[i+1][r+1]),m&&this.isWalkableAt(r-1,i+1)&&n.push(v[i+1][r-1]),n};jr.prototype.clone=function(){var e,t,r=this.width,i=this.height,n=this.nodes,o=new jr(r,i),l=new Array(i);for(e=0;e<i;++e)for(l[e]=new Array(r),t=0;t<r;++t)l[e][t]=new qv(t,e,n[e][t].walkable);return o.nodes=l,o};var xO=jr,We={};function Ju(e){for(var t=[[e.x,e.y]];e.parent;)e=e.parent,t.push([e.x,e.y]);return t.reverse()}We.backtrace=Ju;function bO(e,t){var r=Ju(e),i=Ju(t);return r.concat(i.reverse())}We.biBacktrace=bO;function wO(e){var t,r=0,i,n,o,l;for(t=1;t<e.length;++t)i=e[t-1],n=e[t],o=i[0]-n[0],l=i[1]-n[1],r+=Math.sqrt(o*o+l*l);return r}We.pathLength=wO;function Tc(e,t,r,i){var n=Math.abs,o=[],l,h,u,f,d,g;for(u=n(r-e),f=n(i-t),l=e<r?1:-1,h=t<i?1:-1,d=u-f;o.push([e,t]),!(e===r&&t===i);)g=2*d,g>-f&&(d=d-f,e=e+l),g<u&&(d=d+u,t=t+h);return o}We.interpolate=Tc;function EO(e){var t=[],r=e.length,i,n,o,l,h,u;if(r<2)return t;for(h=0;h<r-1;++h)for(i=e[h],n=e[h+1],o=Tc(i[0],i[1],n[0],n[1]),l=o.length,u=0;u<l-1;++u)t.push(o[u]);return t.push(e[r-1]),t}We.expandPath=EO;function TO(e,t){var r=t.length,i=t[0][0],n=t[0][1],o=t[r-1][0],l=t[r-1][1],h,u,f,d,g,m,v,y,w,x,A;for(h=i,u=n,g=[[h,u]],m=2;m<r;++m){for(y=t[m],f=y[0],d=y[1],w=Tc(h,u,f,d),A=!1,v=1;v<w.length;++v)if(x=w[v],!e.isWalkableAt(x[0],x[1])){A=!0;break}A&&(lastValidCoord=t[m-1],g.push(lastValidCoord),h=lastValidCoord[0],u=lastValidCoord[1])}return g.push([o,l]),g}We.smoothenPath=TO;function AO(e){if(e.length<3)return e;var t=[],r=e[0][0],i=e[0][1],n=e[1][0],o=e[1][1],l=n-r,h=o-i,u,f,d,g,m,v;for(m=Math.sqrt(l*l+h*h),l/=m,h/=m,t.push([r,i]),v=2;v<e.length;v++)u=n,f=o,d=l,g=h,n=e[v][0],o=e[v][1],l=n-u,h=o-f,m=Math.sqrt(l*l+h*h),l/=m,h/=m,(l!==d||h!==g)&&t.push([u,f]);return t.push([n,o]),t}We.compressPath=AO;var Us={manhattan:function(e,t){return e+t},euclidean:function(e,t){return Math.sqrt(e*e+t*t)},octile:function(e,t){var r=Math.SQRT2-1;return e<t?r*e+t:r*t+e},chebyshev:function(e,t){return Math.max(e,t)}},SO=Ya,CO=We,Qh=Us,ea=Je;function Kv(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.heuristic=e.heuristic||Qh.manhattan,this.weight=e.weight||1,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=ea.OnlyWhenNoObstacles:this.diagonalMovement=ea.IfAtMostOneObstacle:this.diagonalMovement=ea.Never),this.diagonalMovement===ea.Never?this.heuristic=e.heuristic||Qh.manhattan:this.heuristic=e.heuristic||Qh.octile}Kv.prototype.findPath=function(e,t,r,i,n){var o=new SO(function(D,L){return D.f-L.f}),l=n.getNodeAt(e,t),h=n.getNodeAt(r,i),u=this.heuristic,f=this.diagonalMovement,d=this.weight,g=Math.abs,m=Math.SQRT2,v,y,w,x,A,S,E,I;for(l.g=0,l.f=0,o.push(l),l.opened=!0;!o.empty();){if(v=o.pop(),v.closed=!0,v===h)return CO.backtrace(h);for(y=n.getNeighbors(v,f),x=0,A=y.length;x<A;++x)w=y[x],!w.closed&&(S=w.x,E=w.y,I=v.g+(S-v.x===0||E-v.y===0?1:m),(!w.opened||I<w.g)&&(w.g=I,w.h=w.h||d*u(g(S-r),g(E-i)),w.f=w.g+w.h,w.parent=v,w.opened?o.updateItem(w):(o.push(w),w.opened=!0)))}return[]};var Ac=Kv,Zv=Ac;function Ba(e){Zv.call(this,e);var t=this.heuristic;this.heuristic=function(r,i){return t(r,i)*1e6}}Ba.prototype=new Zv;Ba.prototype.constructor=Ba;var IO=Ba,RO=We,tu=Je;function Jv(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=tu.OnlyWhenNoObstacles:this.diagonalMovement=tu.IfAtMostOneObstacle:this.diagonalMovement=tu.Never)}Jv.prototype.findPath=function(e,t,r,i,n){var o=[],l=this.diagonalMovement,h=n.getNodeAt(e,t),u=n.getNodeAt(r,i),f,d,g,m,v;for(o.push(h),h.opened=!0;o.length;){if(g=o.shift(),g.closed=!0,g===u)return RO.backtrace(u);for(f=n.getNeighbors(g,l),m=0,v=f.length;m<v;++m)d=f[m],!(d.closed||d.opened)&&(o.push(d),d.opened=!0,d.parent=g)}return[]};var PO=Jv,Qv=Ac;function Oa(e){Qv.call(this,e),this.heuristic=function(t,r){return 0}}Oa.prototype=new Qv;Oa.prototype.constructor=Oa;var MO=Oa,Ug=Ya,Gg=We,eu=Us,ra=Je;function t_(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.heuristic=e.heuristic||eu.manhattan,this.weight=e.weight||1,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=ra.OnlyWhenNoObstacles:this.diagonalMovement=ra.IfAtMostOneObstacle:this.diagonalMovement=ra.Never),this.diagonalMovement===ra.Never?this.heuristic=e.heuristic||eu.manhattan:this.heuristic=e.heuristic||eu.octile}t_.prototype.findPath=function(e,t,r,i,n){var o=function(X,j){return X.f-j.f},l=new Ug(o),h=new Ug(o),u=n.getNodeAt(e,t),f=n.getNodeAt(r,i),d=this.heuristic,g=this.diagonalMovement,m=this.weight,v=Math.abs,y=Math.SQRT2,w,x,A,S,E,I,D,L,O=1,F=2;for(u.g=0,u.f=0,l.push(u),u.opened=O,f.g=0,f.f=0,h.push(f),f.opened=F;!l.empty()&&!h.empty();){for(w=l.pop(),w.closed=!0,x=n.getNeighbors(w,g),S=0,E=x.length;S<E;++S)if(A=x[S],!A.closed){if(A.opened===F)return Gg.biBacktrace(w,A);I=A.x,D=A.y,L=w.g+(I-w.x===0||D-w.y===0?1:y),(!A.opened||L<A.g)&&(A.g=L,A.h=A.h||m*d(v(I-r),v(D-i)),A.f=A.g+A.h,A.parent=w,A.opened?l.updateItem(A):(l.push(A),A.opened=O))}for(w=h.pop(),w.closed=!0,x=n.getNeighbors(w,g),S=0,E=x.length;S<E;++S)if(A=x[S],!A.closed){if(A.opened===O)return Gg.biBacktrace(A,w);I=A.x,D=A.y,L=w.g+(I-w.x===0||D-w.y===0?1:y),(!A.opened||L<A.g)&&(A.g=L,A.h=A.h||m*d(v(I-e),v(D-t)),A.f=A.g+A.h,A.parent=w,A.opened?h.updateItem(A):(h.push(A),A.opened=F))}}return[]};var Sc=t_,e_=Sc;function Fa(e){e_.call(this,e);var t=this.heuristic;this.heuristic=function(r,i){return t(r,i)*1e6}}Fa.prototype=new e_;Fa.prototype.constructor=Fa;var DO=Fa,Wg=We,ru=Je;function r_(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=ru.OnlyWhenNoObstacles:this.diagonalMovement=ru.IfAtMostOneObstacle:this.diagonalMovement=ru.Never)}r_.prototype.findPath=function(e,t,r,i,n){var o=n.getNodeAt(e,t),l=n.getNodeAt(r,i),h=[],u=[],f,d,g,m=this.diagonalMovement,v=0,y=1,w,x;for(h.push(o),o.opened=!0,o.by=v,u.push(l),l.opened=!0,l.by=y;h.length&&u.length;){for(g=h.shift(),g.closed=!0,f=n.getNeighbors(g,m),w=0,x=f.length;w<x;++w)if(d=f[w],!d.closed){if(d.opened){if(d.by===y)return Wg.biBacktrace(g,d);continue}h.push(d),d.parent=g,d.opened=!0,d.by=v}for(g=u.shift(),g.closed=!0,f=n.getNeighbors(g,m),w=0,x=f.length;w<x;++w)if(d=f[w],!d.closed){if(d.opened){if(d.by===v)return Wg.biBacktrace(d,g);continue}u.push(d),d.parent=g,d.opened=!0,d.by=y}}return[]};var BO=r_,i_=Sc;function La(e){i_.call(this,e),this.heuristic=function(t,r){return 0}}La.prototype=new i_;La.prototype.constructor=La;var OO=La,iu=Us,$g=Ec,ia=Je;function n_(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.heuristic=e.heuristic||iu.manhattan,this.weight=e.weight||1,this.trackRecursion=e.trackRecursion||!1,this.timeLimit=e.timeLimit||1/0,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=ia.OnlyWhenNoObstacles:this.diagonalMovement=ia.IfAtMostOneObstacle:this.diagonalMovement=ia.Never),this.diagonalMovement===ia.Never?this.heuristic=e.heuristic||iu.manhattan:this.heuristic=e.heuristic||iu.octile}n_.prototype.findPath=function(e,t,r,i,n){var o=new Date().getTime(),l=(function(w,x){return this.heuristic(Math.abs(x.x-w.x),Math.abs(x.y-w.y))}).bind(this),h=function(w,x){return w.x===x.x||w.y===x.y?1:Math.SQRT2},u=(function(w,x,A,S,E){if(this.timeLimit>0&&new Date().getTime()-o>this.timeLimit*1e3)return 1/0;var I=x+l(w,d)*this.weight;if(I>A)return I;if(w==d)return S[E]=[w.x,w.y],w;var D,L,O,F,X=n.getNeighbors(w,this.diagonalMovement);for(O=0,D=1/0;F=X[O];++O){if(this.trackRecursion&&(F.retainCount=F.retainCount+1||1,F.tested!==!0&&(F.tested=!0)),L=u(F,x+h(w,F),A,S,E+1),L instanceof $g)return S[E]=[w.x,w.y],L;this.trackRecursion&&--F.retainCount===0&&(F.tested=!1),L<D&&(D=L)}return D}).bind(this),f=n.getNodeAt(e,t),d=n.getNodeAt(r,i),g=l(f,d),m,v,y;for(m=0;;++m){if(v=[],y=u(f,0,g,v,0),y===1/0)return[];if(y instanceof $g)return v;g=y}return[]};var FO=n_,LO=Ya,Hg=We,s_=Us;function Cc(e){e=e||{},this.heuristic=e.heuristic||s_.manhattan,this.trackJumpRecursion=e.trackJumpRecursion||!1}Cc.prototype.findPath=function(e,t,r,i,n){var o=this.openList=new LO(function(f,d){return f.f-d.f}),l=this.startNode=n.getNodeAt(e,t),h=this.endNode=n.getNodeAt(r,i),u;for(this.grid=n,l.g=0,l.f=0,o.push(l),l.opened=!0;!o.empty();){if(u=o.pop(),u.closed=!0,u===h)return Hg.expandPath(Hg.backtrace(h));this._identifySuccessors(u)}return[]};Cc.prototype._identifySuccessors=function(e){var t=this.grid,r=this.heuristic,i=this.openList,n=this.endNode.x,o=this.endNode.y,l,h,u,f,d,g=e.x,m=e.y,v,y,w,x,A,S=Math.abs;for(l=this._findNeighbors(e),f=0,d=l.length;f<d;++f)if(h=l[f],u=this._jump(h[0],h[1],g,m),u){if(v=u[0],y=u[1],A=t.getNodeAt(v,y),A.closed)continue;w=s_.octile(S(v-g),S(y-m)),x=e.g+w,(!A.opened||x<A.g)&&(A.g=x,A.h=A.h||r(S(v-n),S(y-o)),A.f=A.g+A.h,A.parent=e,A.opened?i.updateItem(A):(i.push(A),A.opened=!0))}};var ja=Cc,o_=ja,NO=Je;function Ln(e){o_.call(this,e)}Ln.prototype=new o_;Ln.prototype.constructor=Ln;Ln.prototype._jump=function(e,t,r,i){var n=this.grid,o=e-r,l=t-i;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0){if(n.isWalkableAt(e,t-1)&&!n.isWalkableAt(e-o,t-1)||n.isWalkableAt(e,t+1)&&!n.isWalkableAt(e-o,t+1))return[e,t]}else if(l!==0){if(n.isWalkableAt(e-1,t)&&!n.isWalkableAt(e-1,t-l)||n.isWalkableAt(e+1,t)&&!n.isWalkableAt(e+1,t-l))return[e,t];if(this._jump(e+1,t,e,t)||this._jump(e-1,t,e,t))return[e,t]}else throw new Error("Only horizontal and vertical movements are allowed");return this._jump(e+o,t+l,e,t)};Ln.prototype._findNeighbors=function(e){var t=e.parent,r=e.x,i=e.y,n=this.grid,o,l,h,u,f=[],d,g,m,v;if(t)o=t.x,l=t.y,h=(r-o)/Math.max(Math.abs(r-o),1),u=(i-l)/Math.max(Math.abs(i-l),1),h!==0?(n.isWalkableAt(r,i-1)&&f.push([r,i-1]),n.isWalkableAt(r,i+1)&&f.push([r,i+1]),n.isWalkableAt(r+h,i)&&f.push([r+h,i])):u!==0&&(n.isWalkableAt(r-1,i)&&f.push([r-1,i]),n.isWalkableAt(r+1,i)&&f.push([r+1,i]),n.isWalkableAt(r,i+u)&&f.push([r,i+u]));else for(d=n.getNeighbors(e,NO.Never),m=0,v=d.length;m<v;++m)g=d[m],f.push([g.x,g.y]);return f};var kO=Ln,a_=ja,UO=Je;function Nn(e){a_.call(this,e)}Nn.prototype=new a_;Nn.prototype.constructor=Nn;Nn.prototype._jump=function(e,t,r,i){var n=this.grid,o=e-r,l=t-i;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0&&l!==0){if(n.isWalkableAt(e-o,t+l)&&!n.isWalkableAt(e-o,t)||n.isWalkableAt(e+o,t-l)&&!n.isWalkableAt(e,t-l))return[e,t];if(this._jump(e+o,t,e,t)||this._jump(e,t+l,e,t))return[e,t]}else if(o!==0){if(n.isWalkableAt(e+o,t+1)&&!n.isWalkableAt(e,t+1)||n.isWalkableAt(e+o,t-1)&&!n.isWalkableAt(e,t-1))return[e,t]}else if(n.isWalkableAt(e+1,t+l)&&!n.isWalkableAt(e+1,t)||n.isWalkableAt(e-1,t+l)&&!n.isWalkableAt(e-1,t))return[e,t];return this._jump(e+o,t+l,e,t)};Nn.prototype._findNeighbors=function(e){var t=e.parent,r=e.x,i=e.y,n=this.grid,o,l,h,u,f=[],d,g,m,v;if(t)o=t.x,l=t.y,h=(r-o)/Math.max(Math.abs(r-o),1),u=(i-l)/Math.max(Math.abs(i-l),1),h!==0&&u!==0?(n.isWalkableAt(r,i+u)&&f.push([r,i+u]),n.isWalkableAt(r+h,i)&&f.push([r+h,i]),n.isWalkableAt(r+h,i+u)&&f.push([r+h,i+u]),n.isWalkableAt(r-h,i)||f.push([r-h,i+u]),n.isWalkableAt(r,i-u)||f.push([r+h,i-u])):h===0?(n.isWalkableAt(r,i+u)&&f.push([r,i+u]),n.isWalkableAt(r+1,i)||f.push([r+1,i+u]),n.isWalkableAt(r-1,i)||f.push([r-1,i+u])):(n.isWalkableAt(r+h,i)&&f.push([r+h,i]),n.isWalkableAt(r,i+1)||f.push([r+h,i+1]),n.isWalkableAt(r,i-1)||f.push([r+h,i-1]));else for(d=n.getNeighbors(e,UO.Always),m=0,v=d.length;m<v;++m)g=d[m],f.push([g.x,g.y]);return f};var GO=Nn,l_=ja,WO=Je;function kn(e){l_.call(this,e)}kn.prototype=new l_;kn.prototype.constructor=kn;kn.prototype._jump=function(e,t,r,i){var n=this.grid,o=e-r,l=t-i;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0&&l!==0){if(this._jump(e+o,t,e,t)||this._jump(e,t+l,e,t))return[e,t]}else if(o!==0){if(n.isWalkableAt(e,t-1)&&!n.isWalkableAt(e-o,t-1)||n.isWalkableAt(e,t+1)&&!n.isWalkableAt(e-o,t+1))return[e,t]}else if(l!==0&&(n.isWalkableAt(e-1,t)&&!n.isWalkableAt(e-1,t-l)||n.isWalkableAt(e+1,t)&&!n.isWalkableAt(e+1,t-l)))return[e,t];return n.isWalkableAt(e+o,t)&&n.isWalkableAt(e,t+l)?this._jump(e+o,t+l,e,t):null};kn.prototype._findNeighbors=function(e){var t=e.parent,r=e.x,i=e.y,n=this.grid,o,l,h,u,f=[],d,g,m,v;if(t)if(o=t.x,l=t.y,h=(r-o)/Math.max(Math.abs(r-o),1),u=(i-l)/Math.max(Math.abs(i-l),1),h!==0&&u!==0)n.isWalkableAt(r,i+u)&&f.push([r,i+u]),n.isWalkableAt(r+h,i)&&f.push([r+h,i]),n.isWalkableAt(r,i+u)&&n.isWalkableAt(r+h,i)&&f.push([r+h,i+u]);else{var y;if(h!==0){y=n.isWalkableAt(r+h,i);var w=n.isWalkableAt(r,i+1),x=n.isWalkableAt(r,i-1);y&&(f.push([r+h,i]),w&&f.push([r+h,i+1]),x&&f.push([r+h,i-1])),w&&f.push([r,i+1]),x&&f.push([r,i-1])}else if(u!==0){y=n.isWalkableAt(r,i+u);var A=n.isWalkableAt(r+1,i),S=n.isWalkableAt(r-1,i);y&&(f.push([r,i+u]),A&&f.push([r+1,i+u]),S&&f.push([r-1,i+u])),A&&f.push([r+1,i]),S&&f.push([r-1,i])}}else for(d=n.getNeighbors(e,WO.OnlyWhenNoObstacles),m=0,v=d.length;m<v;++m)g=d[m],f.push([g.x,g.y]);return f};var $O=kn,h_=ja,HO=Je;function Un(e){h_.call(this,e)}Un.prototype=new h_;Un.prototype.constructor=Un;Un.prototype._jump=function(e,t,r,i){var n=this.grid,o=e-r,l=t-i;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0&&l!==0){if(n.isWalkableAt(e-o,t+l)&&!n.isWalkableAt(e-o,t)||n.isWalkableAt(e+o,t-l)&&!n.isWalkableAt(e,t-l))return[e,t];if(this._jump(e+o,t,e,t)||this._jump(e,t+l,e,t))return[e,t]}else if(o!==0){if(n.isWalkableAt(e+o,t+1)&&!n.isWalkableAt(e,t+1)||n.isWalkableAt(e+o,t-1)&&!n.isWalkableAt(e,t-1))return[e,t]}else if(n.isWalkableAt(e+1,t+l)&&!n.isWalkableAt(e+1,t)||n.isWalkableAt(e-1,t+l)&&!n.isWalkableAt(e-1,t))return[e,t];return n.isWalkableAt(e+o,t)||n.isWalkableAt(e,t+l)?this._jump(e+o,t+l,e,t):null};Un.prototype._findNeighbors=function(e){var t=e.parent,r=e.x,i=e.y,n=this.grid,o,l,h,u,f=[],d,g,m,v;if(t)o=t.x,l=t.y,h=(r-o)/Math.max(Math.abs(r-o),1),u=(i-l)/Math.max(Math.abs(i-l),1),h!==0&&u!==0?(n.isWalkableAt(r,i+u)&&f.push([r,i+u]),n.isWalkableAt(r+h,i)&&f.push([r+h,i]),(n.isWalkableAt(r,i+u)||n.isWalkableAt(r+h,i))&&f.push([r+h,i+u]),!n.isWalkableAt(r-h,i)&&n.isWalkableAt(r,i+u)&&f.push([r-h,i+u]),!n.isWalkableAt(r,i-u)&&n.isWalkableAt(r+h,i)&&f.push([r+h,i-u])):h===0?n.isWalkableAt(r,i+u)&&(f.push([r,i+u]),n.isWalkableAt(r+1,i)||f.push([r+1,i+u]),n.isWalkableAt(r-1,i)||f.push([r-1,i+u])):n.isWalkableAt(r+h,i)&&(f.push([r+h,i]),n.isWalkableAt(r,i+1)||f.push([r+h,i+1]),n.isWalkableAt(r,i-1)||f.push([r+h,i-1]));else for(d=n.getNeighbors(e,HO.IfAtMostOneObstacle),m=0,v=d.length;m<v;++m)g=d[m],f.push([g.x,g.y]);return f};var XO=Un,nu=Je,zO=kO,VO=GO,YO=$O,jO=XO;function qO(e){return e=e||{},e.diagonalMovement===nu.Never?new zO(e):e.diagonalMovement===nu.Always?new VO(e):e.diagonalMovement===nu.OnlyWhenNoObstacles?new YO(e):new jO(e)}var KO=qO,ZO={Heap:Ya,Node:Ec,Grid:xO,Util:We,DiagonalMovement:Je,Heuristic:Us,AStarFinder:Ac,BestFirstFinder:IO,BreadthFirstFinder:PO,DijkstraFinder:MO,BiAStarFinder:Sc,BiBestFirstFinder:DO,BiBreadthFirstFinder:BO,BiDijkstraFinder:OO,IDAStarFinder:FO,JumpPointFinder:KO},JO=ZO;const Xg=Na(JO),QO=xt.with("position"),tF=(e,t)=>{const{width:r,height:i}=ee().views.map,n=new Xg.Grid(r,i);for(const h of QO)if(h.blocking&&!h.pathThrough){const{x:u,y:f}=h.position;n.setWalkableAt(u,f,!1)}return n.setWalkableAt(e.x,e.y,!0),n.setWalkableAt(t.x,t.y,!0),new Xg.AStarFinder({}).findPath(e.x,e.y,t.x,t.y,n)},eF=xt.with("pc","position"),rF=xt.with("ai","position"),iF=()=>{const[e]=eF.entities;for(const t of rF){const r=tF(t.position,e.position);if(r[1]){const i={x:r[1][0],y:r[1][1],z:t.position.z};xt.addComponent(t,"tryMove",i)}}},Gs=e=>`${e.x},${e.y},${e.z}`,zg=(e,t)=>{const{x:r,y:i,z:n,width:o,height:l,hasWalls:h}=e,u={},f=r,d=r+o,g=i,m=i+l;if(h)for(let y=g+1;y<m-1;y++)for(let w=f+1;w<d-1;w++)u[`${w},${y},${n}`]={x:w,y,z:n,...t};else for(let y=g;y<m;y++)for(let w=f;w<d;w++)u[`${w},${y},${n}`]={x:w,y,z:n,...t};const v={x:Math.round((f+d)/2),y:Math.round((g+m)/2),z:n};return{x1:f,x2:d,y1:g,y2:m,z:n,center:v,hasWalls:h,tiles:u,width:o,height:l}},nF=(e,t)=>e.x1<=t.x2&&e.x2>=t.x1&&e.y1<=t.y2&&e.y2>=t.y1,sF=(e,t)=>{const r=Math.pow(t.x-e.x,2),i=Math.pow(t.y-e.y,2);return Math.floor(Math.sqrt(r+i))},oF=[{xx:1,xy:0,yx:0,yy:1},{xx:1,xy:0,yx:0,yy:-1},{xx:-1,xy:0,yx:0,yy:1},{xx:-1,xy:0,yx:0,yy:-1},{xx:0,xy:1,yx:1,yy:0},{xx:0,xy:1,yx:-1,yy:0},{xx:0,xy:-1,yx:1,yy:0},{xx:0,xy:-1,yx:-1,yy:0}];function aF(e,t,r,i,n){const{x:o,y:l,z:h}=i,u=new Set,f=new Set;for(const v of e)v.position.z===h&&f.add(Gs(v.position));const d=(v,y)=>{const w=`${v},${y},${h}`;return!!f.has(w)},g=(v,y)=>u.add(`${v},${y},${h}`);function m(v,y,w,x,A,S,E){let I=0;if(x<A)return;let D=!1;for(let L=w;L<E&&!D;L++){let O=-L;for(let F=-L;F<=0;F++){let X=v+F*S.xx+O*S.xy,j=y+F*S.yx+O*S.yy,z=(F-.5)/(O+.5),K=(F+.5)/(O-.5);if(!(!(X>=0&&j>=0&&X<t&&j<r)||x<K)){if(A>z)break;if(Math.sqrt(F*F+O*O)<=E&&g(X,j),D)if(d(X,j)){I=K;continue}else D=!1,x=I;else d(X,j)&&L<E&&(D=!0,m(v,y,L+1,x,z,S,E),I=K)}}}}g(o,l);for(let v of oF)m(o,l,1,1,0,v,n);return{fov:u}}const lF=xt.with("inFov","position"),hF=xt.with("opaque","position"),uF=xt.with("pc","position"),cF=xt.with("appearance","position"),pa=()=>{let e;for(const r of uF)e=r;if(!e)return;const t=aF(hF,74,39,e.position,10);for(const r of lF)xt.removeComponent(r,"inFov");for(const r of cF)t.fov.has(Gs(r.position))&&(xt.addComponent(r,"inFov",!0),xt.addComponent(r,"revealed",!0))},fF=e=>{console.log(JSON.parse(JSON.stringify(e)))},Qu=e=>{fr(t=>t.log.push(e))},dF=xt.with("position","tryMove"),pF=xt.with("blocking","position"),Vg=()=>{for(const e of dF){const{position:t,tryMove:r}=e;let i=!1;for(const n of pF)if(n.position.x===r.x&&n.position.y===r.y){xt.removeComponent(e,"tryMove"),n.health?(n.health.current-=5,e.pc&&Qu(`${n.name} attacked by ${e.name} for 5hp`)):e.pc&&Qu(`${e.name} blocked by ${n.name}`),i=!0;break}i||(t.x=r.x,t.y=r.y,t.z=r.z,xt.removeComponent(e,"tryMove"))}},gn=(e,t)=>{let r=e;if(r.length>t){const i=r.length-(t-3);r=r.substring(0,r.length-i).trim().concat("...")}return r},gF=e=>e<4?(100-(5-e)*7)/100:1,su=xt.with("position","appearance","layer100"),ou=xt.with("position","appearance","layer200"),au=xt.with("position","appearance","layer300"),lu=xt.with("position","appearance","layer400"),mF=xt.with("inFov","legendable","position","appearance","name"),vF=xt.with("pc","position"),Ke=(e,t,r)=>{const{appearance:i,position:n}=t;if(!i||!n)return;const{char:o,tint:l,tileSet:h}=i,{x:u,y:f}=n;e==null||e.updateCell({0:{char:o,tint:65280,alpha:0,tileSet:"tile",x:u,y:f},1:{char:o,tint:l,alpha:r,tileSet:h,x:u,y:f}})},ga=()=>{const e=ee().views.map;if(!e)return;for(const r of su)r.inFov&&Ke(e,r,1);for(const r of ou)r.inFov&&Ke(e,r,1);for(const r of au)r.inFov&&Ke(e,r,1);for(const r of lu)r.inFov&&Ke(e,r,1);for(const r of su)!r.inFov&&r.revealed&&Ke(e,r,.35);for(const r of ou)!r.inFov&&r.revealed&&Ke(e,r,.35);for(const r of au)!r.inFov&&r.revealed&&Ke(e,r,.35);for(const r of lu)!r.inFov&&r.revealed&&Ke(e,r,.35);if(window.skulltooth.debug){for(const r of su)Ke(e,r,1);for(const r of ou)Ke(e,r,1);for(const r of au)Ke(e,r,1);for(const r of lu)Ke(e,r,1)}{const r=ee().views.senses,i=ee().senses,n=r.width-1;r==null||r.updateRows([[{string:gn(i.feel,n)}],[{string:gn(i.see,n)}],[{string:gn(i.hear,n)}],[{string:gn(i.smell,n)}],[{string:gn(i.taste,n)}]])}{const r=ee().views.legend;if(r){const i=[],[n]=vF;for(const l of mF)i.push(l);i.sort(l=>sF(n.position,l.position)),r==null||r.clearView();const o=[];i.forEach(l=>{const h=l.appearance.char,u=l.name,f=`${h} ${u}`;o.push([{string:f}])}),r==null||r.updateRows(o)}}{const r=ee().views.log;if(r){const i=ee().log,n=i.slice(Math.max(i.length-5,0)),o=r.width-1;r==null||r.updateRows(n.map((l,h)=>[{string:gn(l,o),alpha:gF(h)}]))}}const t=ee().views.controls;if(t){let r="(arrows/hjkl)Move (i)Inventory";ee().gameState===Ui.INVENTORY&&(r="(i/escape)Return to Game (d)Drop (c)Consume"),t==null||t.updateRows([[],[{string:r}]])}},_F=["ArrowLeft","ArrowDown","ArrowUp","ArrowRight","h","j","k","l"],yF=xt.with("pc"),Yg=()=>{const{userInput:e,gameState:t}=ee();if(!e)return fr(i=>{i.userInput=null});const{key:r}=e;if(t===Ui.GAME&&(r==="i"&&fr(i=>i.gameState=Ui.INVENTORY),_F.includes(r))){for(const i of yF)if(i!=null&&i.position){const{x:n,y:o,z:l}=i.position;if(r==="h"||r==="ArrowLeft"){const h={x:n-1,y:o,z:l};xt.addComponent(i,"tryMove",h)}if(r==="j"||r==="ArrowDown"){const h={x:n,y:o+1,z:l};xt.addComponent(i,"tryMove",h)}if(r==="k"||r==="ArrowUp"){const h={x:n,y:o-1,z:l};xt.addComponent(i,"tryMove",h)}if(r==="l"||r==="ArrowRight"){const h={x:n+1,y:o,z:l};xt.addComponent(i,"tryMove",h)}}}t===Ui.INVENTORY&&(r==="i"||r==="Escape")&&fr(i=>i.gameState=Ui.GAME),fr(i=>{i.userInput=null})};var Xn=(e=>(e.default="?",e.floor="•",e.owlbear="F",e.player="@",e.potion="!",e.rat="r",e.rock="*",e.wall="#",e))(Xn||{}),zn=(e=>(e[e.default=65399]="default",e[e.floor=3355443]="floor",e[e.owlbear=11027200]="owlbear",e[e.player=16777215]="player",e[e.potion=14329120]="potion",e[e.rat=14047863]="rat",e[e.rock=8355711]="rock",e[e.wall=8421504]="wall",e))(zn||{});const qa={appearance:{char:Xn.default,tint:zn.default,tileSet:"ascii"},position:{x:0,y:0,z:0},name:"default"},u_={layer100:!0},c_={health:{max:1,current:1},blocking:!0,layer300:!0},xF={...qa,...c_,appearance:{char:Xn.player,tint:zn.player,tileSet:"ascii"},health:{max:10,current:10},legendable:!0,name:"player",pc:!0},bF={...qa,...u_,appearance:{char:Xn.wall,tint:zn.wall,tileSet:"ascii"},blocking:!0,opaque:!0,name:"wall"},wF={...qa,...u_,appearance:{char:Xn.floor,tint:zn.floor,tileSet:"ascii"},name:"floor"},EF={...qa,...c_,ai:!0,appearance:{char:Xn.rat,tint:zn.rat,tileSet:"ascii"},health:{max:1,current:1},legendable:!0,name:"rat",pathThrough:!0};function TF(e,t){const r={},i=Math.min(e.x,t.x),n=Math.max(e.x,t.x)+1;let o=i;for(;o<n;){const l={...t,x:o};r[Gs(l)]={...l,sprite:"FLOOR"},o++}return r}function AF(e,t){const r={},i=Math.min(e.y,t.y),n=Math.max(e.y,t.y)+1;let o=i;for(;o<n;){const l={...e,y:o};r[Gs(l)]={...l,sprite:"FLOOR"},o++}return r}const SF=e=>{const{pos:t,width:r,height:i,minRoomSize:n=6,maxRoomSize:o=12,maxRoomCount:l=30}=e,{x:h,y:u,z:f}=t,d={...zg({x:h,y:u,z:f,width:r,height:i,hasWalls:!1},{sprite:"WALL"}),rooms:[]};let g={};Ir.times(l,()=>{let y=Ir.random(n,o),w=Ir.random(n,o),x=Ir.random(h,r+h-y-1),A=Ir.random(u,i+u-w-1);const S=zg({x,y:A,z:f,width:y,height:w,hasWalls:!0},{sprite:"FLOOR"});d.rooms.some(E=>nF(E,S))||(d.rooms.push(S),g={...g,...S.tiles})});let m=null,v={};for(let y of d.rooms)m&&(v={...v,...TF(y.center,m.center),...AF(y.center,m.center)}),m=y;return d.tiles={...d.tiles,...g,...v},d},CF=()=>{const e=SF({pos:{x:0,y:0,z:0},width:74,height:39,minRoomSize:8,maxRoomSize:18,maxRoomCount:100}),t=Object.values(e.tiles);for(const r of t){if(r.sprite==="WALL"){const{x:i,y:n,z:o}=r;xt.add({...Ir.cloneDeep(bF),position:{x:i,y:n,z:o}})}if(r.sprite==="FLOOR"){const{x:i,y:n,z:o}=r;xt.add({...Ir.cloneDeep(wF),position:{x:i,y:n,z:o}})}}return e.rooms.forEach((r,i)=>{i&&xt.add({...Ir.cloneDeep(EF),position:r.center})}),e},IF=xt.with("health").without("dead"),jg=()=>{for(const e of IF)e.health.current<=0&&(e.appearance&&(e.appearance.char="%"),xt.removeComponent(e,"ai"),xt.removeComponent(e,"blocking"),xt.removeComponent(e,"layer300"),xt.addComponent(e,"dead",!0),xt.addComponent(e,"layer200",!0),Qu(`${e.name} has died!`),e.pc&&(fr(t=>t.gameState=Ui.GAME_OVER),console.log("Game Over!")))};var Ui=(e=>(e.GAME="GAME",e.GAME_OVER="GAME_OVER",e.INVENTORY="INVENTORY",e.INSPECT="INSPECT",e.TARGET="TARGET",e))(Ui||{});window.skulltooth=window.skulltooth||{};window.skulltooth.debug=!1;const Bs={fps:0,gameState:"GAME",log:["hello world","your adventure begins anew!"],senses:{feel:"You feel nothing.",see:"You see nothing.",hear:"You hear nothing.",smell:"You smell nothing.",taste:"You taste nothing."},turn:"PLAYER",userInput:null,views:{}};window.skulltooth.state=Bs;const fr=e=>{e(Bs)},ee=()=>Bs,RF=async()=>{await FB(document.querySelector("#canvas")),new wr({width:12,height:2,x:0,y:0,layers:2,tileSets:["tile","text"],tints:[16777215,16711799],alphas:[1,1],visible:!0}).updateRows([[{},{string:"skulltooth 2"}],[{tint:16711799},{string:"forcecrusher",tint:16777215}]]);const e=new wr({width:25,height:42,x:0,y:2,layers:1,tileSets:["text"],tints:[16711799],alphas:[1],visible:!0}),t=new wr({width:74,height:5,x:26,y:0,layers:1,tileSets:["text"],tints:[15658734],alphas:[1],visible:!0}),r=new wr({width:74,height:5,x:100,y:0,layers:1,tileSets:["text"],tints:[16711799],alphas:[1],visible:!0}),i=new wr({width:74,height:39,x:13,y:5,layers:3,tileSets:["tile","ascii","tile"],tints:[0,0,0],alphas:[1,1,0],visible:!0}),n=new wr({width:12,height:1,x:0,y:44,layers:1,tileSets:["text"],tints:[14540253],alphas:[1],visible:!0}).updateRows([[{string:"FPS: calc..."}]]);new wr({width:12,height:1,x:0,y:45,layers:1,tileSets:["text"],tints:[16777215],alphas:[1],visible:!0}).updateRows([[{string:"TAG: e842764"}]]);const o=new wr({width:148,height:2,x:26,y:44,layers:1,tileSets:["text"],tints:[15658734],alphas:[1],visible:!0}),l=new wr({width:100,height:44,x:0,y:0,layers:1,tileSets:["tile"],tints:[1118481],alphas:[.75],visible:!1}),h=new wr({width:148,height:39,x:26,y:5,layers:2,tileSets:["text","text"],tints:[1118481,16777215],alphas:[1],visible:!1});fr(g=>{g.views.fps=n,g.views.map=i,g.views.log=t,g.views.senses=r,g.views.legend=e,g.views.inventory=h,g.views.menuUnderlay=l,g.views.controls=o});const f=CF().rooms[0].center,d=xt.add(xF);d.position.x=f.x,d.position.y=f.y,d.position.z=f.z,pa(),ga(),f_(),document.addEventListener("keydown",g=>{fr(m=>{m.userInput=g})}),document.addEventListener("mousedown",g=>{const m=g.x-Bs.views.map.layers[0].x,v=g.layerY-Bs.views.map.layers[0].y,w=OB(m,v,0);if(window.skulltooth.debug===!0){const x=xt.with("position");for(const A of x)w===Gs(A.position)&&(console.log(w),fF(A))}})};let hu=0,na=Date.now(),sa=[];function f_(){var e;requestAnimationFrame(f_),ee().gameState==="INVENTORY"&&ee().userInput&&ee().turn==="PLAYER"&&(Yg(),pa(),ga()),ee().gameState==="GAME"&&(ee().userInput&&ee().turn==="PLAYER"&&(Yg(),Vg(),jg(),pa(),ga(),ee().gameState==="GAME"&&fr(t=>{t.turn="WORLD"})),ee().turn==="WORLD"&&(iF(),Vg(),jg(),pa(),ga(),fr(t=>{t.turn="PLAYER"}))),na||(na=Date.now()),Date.now()-na>1e3&&(sa.unshift(hu),sa.length>3&&sa.pop(),isNaN(ee().fps)||(e=ee().views.fps)==null||e.updateRow({string:`FPS: ${ee().fps}     `,layer:0,x:0,y:0,tileSet:"text"}),na=Date.now(),hu=0),fr(t=>t.fps=Math.round(Ir.mean(sa))),hu++}RF();
