var VE=Object.defineProperty;var jE=(e,t,r)=>t in e?VE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Zt=(e,t,r)=>(jE(e,typeof t!="symbol"?t+"":t,r),r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();var Sr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ba(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function YE(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:function(){return e[i]}})}),r}var fa={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */fa.exports;(function(e,t){(function(){var r,i="4.17.21",n=200,o="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",h="Invalid `variable` option passed into `_.template`",u="__lodash_hash_undefined__",f=500,d="__lodash_placeholder__",g=1,m=2,v=4,y=1,w=2,x=1,A=2,S=4,E=8,I=16,D=32,L=64,O=128,F=256,X=512,Y=30,z="...",K=800,W=16,k=1,at=2,ft=3,j=1/0,vt=9007199254740991,Ot=17976931348623157e292,H=NaN,rt=4294967295,xt=rt-1,Pt=rt>>>1,Mt=[["ary",O],["bind",x],["bindKey",A],["curry",E],["curryRight",I],["flip",X],["partial",D],["partialRight",L],["rearg",F]],Nt="[object Arguments]",kt="[object Array]",re="[object AsyncFunction]",jt="[object Boolean]",ie="[object Date]",se="[object DOMException]",Dt="[object Error]",Ut="[object Function]",Yt="[object GeneratorFunction]",qt="[object Map]",ve="[object Number]",vi="[object Null]",mr="[object Object]",Sc="[object Promise]",u_="[object Proxy]",Xn="[object RegExp]",Je="[object Set]",zn="[object String]",Us="[object Symbol]",c_="[object Undefined]",Vn="[object WeakMap]",f_="[object WeakSet]",jn="[object ArrayBuffer]",ji="[object DataView]",Va="[object Float32Array]",ja="[object Float64Array]",Ya="[object Int8Array]",qa="[object Int16Array]",Ka="[object Int32Array]",Za="[object Uint8Array]",Ja="[object Uint8ClampedArray]",Qa="[object Uint16Array]",tl="[object Uint32Array]",d_=/\b__p \+= '';/g,p_=/\b(__p \+=) '' \+/g,g_=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Cc=/&(?:amp|lt|gt|quot|#39);/g,Ic=/[&<>"']/g,m_=RegExp(Cc.source),v_=RegExp(Ic.source),__=/<%-([\s\S]+?)%>/g,y_=/<%([\s\S]+?)%>/g,Pc=/<%=([\s\S]+?)%>/g,x_=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,b_=/^\w*$/,w_=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,el=/[\\^$.*+?()[\]{}|]/g,E_=RegExp(el.source),rl=/^\s+/,T_=/\s/,A_=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,S_=/\{\n\/\* \[wrapped with (.+)\] \*/,C_=/,? & /,I_=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,P_=/[()=,{}\[\]\/\s]/,R_=/\\(\\)?/g,M_=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Rc=/\w*$/,D_=/^[-+]0x[0-9a-f]+$/i,B_=/^0b[01]+$/i,O_=/^\[object .+?Constructor\]$/,F_=/^0o[0-7]+$/i,L_=/^(?:0|[1-9]\d*)$/,N_=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Gs=/($^)/,k_=/['\n\r\u2028\u2029\\]/g,Ws="\\ud800-\\udfff",U_="\\u0300-\\u036f",G_="\\ufe20-\\ufe2f",W_="\\u20d0-\\u20ff",Mc=U_+G_+W_,Dc="\\u2700-\\u27bf",Bc="a-z\\xdf-\\xf6\\xf8-\\xff",$_="\\xac\\xb1\\xd7\\xf7",H_="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",X_="\\u2000-\\u206f",z_=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Oc="A-Z\\xc0-\\xd6\\xd8-\\xde",Fc="\\ufe0e\\ufe0f",Lc=$_+H_+X_+z_,il="['’]",V_="["+Ws+"]",Nc="["+Lc+"]",$s="["+Mc+"]",kc="\\d+",j_="["+Dc+"]",Uc="["+Bc+"]",Gc="[^"+Ws+Lc+kc+Dc+Bc+Oc+"]",nl="\\ud83c[\\udffb-\\udfff]",Y_="(?:"+$s+"|"+nl+")",Wc="[^"+Ws+"]",sl="(?:\\ud83c[\\udde6-\\uddff]){2}",ol="[\\ud800-\\udbff][\\udc00-\\udfff]",Yi="["+Oc+"]",$c="\\u200d",Hc="(?:"+Uc+"|"+Gc+")",q_="(?:"+Yi+"|"+Gc+")",Xc="(?:"+il+"(?:d|ll|m|re|s|t|ve))?",zc="(?:"+il+"(?:D|LL|M|RE|S|T|VE))?",Vc=Y_+"?",jc="["+Fc+"]?",K_="(?:"+$c+"(?:"+[Wc,sl,ol].join("|")+")"+jc+Vc+")*",Z_="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",J_="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Yc=jc+Vc+K_,Q_="(?:"+[j_,sl,ol].join("|")+")"+Yc,ty="(?:"+[Wc+$s+"?",$s,sl,ol,V_].join("|")+")",ey=RegExp(il,"g"),ry=RegExp($s,"g"),al=RegExp(nl+"(?="+nl+")|"+ty+Yc,"g"),iy=RegExp([Yi+"?"+Uc+"+"+Xc+"(?="+[Nc,Yi,"$"].join("|")+")",q_+"+"+zc+"(?="+[Nc,Yi+Hc,"$"].join("|")+")",Yi+"?"+Hc+"+"+Xc,Yi+"+"+zc,J_,Z_,kc,Q_].join("|"),"g"),ny=RegExp("["+$c+Ws+Mc+Fc+"]"),sy=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,oy=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ay=-1,Gt={};Gt[Va]=Gt[ja]=Gt[Ya]=Gt[qa]=Gt[Ka]=Gt[Za]=Gt[Ja]=Gt[Qa]=Gt[tl]=!0,Gt[Nt]=Gt[kt]=Gt[jn]=Gt[jt]=Gt[ji]=Gt[ie]=Gt[Dt]=Gt[Ut]=Gt[qt]=Gt[ve]=Gt[mr]=Gt[Xn]=Gt[Je]=Gt[zn]=Gt[Vn]=!1;var Lt={};Lt[Nt]=Lt[kt]=Lt[jn]=Lt[ji]=Lt[jt]=Lt[ie]=Lt[Va]=Lt[ja]=Lt[Ya]=Lt[qa]=Lt[Ka]=Lt[qt]=Lt[ve]=Lt[mr]=Lt[Xn]=Lt[Je]=Lt[zn]=Lt[Us]=Lt[Za]=Lt[Ja]=Lt[Qa]=Lt[tl]=!0,Lt[Dt]=Lt[Ut]=Lt[Vn]=!1;var ly={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},hy={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},uy={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},cy={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},fy=parseFloat,dy=parseInt,qc=typeof Sr=="object"&&Sr&&Sr.Object===Object&&Sr,py=typeof self=="object"&&self&&self.Object===Object&&self,fe=qc||py||Function("return this")(),ll=t&&!t.nodeType&&t,_i=ll&&!0&&e&&!e.nodeType&&e,Kc=_i&&_i.exports===ll,hl=Kc&&qc.process,We=function(){try{var R=_i&&_i.require&&_i.require("util").types;return R||hl&&hl.binding&&hl.binding("util")}catch{}}(),Zc=We&&We.isArrayBuffer,Jc=We&&We.isDate,Qc=We&&We.isMap,tf=We&&We.isRegExp,ef=We&&We.isSet,rf=We&&We.isTypedArray;function Me(R,N,B){switch(B.length){case 0:return R.call(N);case 1:return R.call(N,B[0]);case 2:return R.call(N,B[0],B[1]);case 3:return R.call(N,B[0],B[1],B[2])}return R.apply(N,B)}function gy(R,N,B,Q){for(var ct=-1,It=R==null?0:R.length;++ct<It;){var oe=R[ct];N(Q,oe,B(oe),R)}return Q}function $e(R,N){for(var B=-1,Q=R==null?0:R.length;++B<Q&&N(R[B],B,R)!==!1;);return R}function my(R,N){for(var B=R==null?0:R.length;B--&&N(R[B],B,R)!==!1;);return R}function nf(R,N){for(var B=-1,Q=R==null?0:R.length;++B<Q;)if(!N(R[B],B,R))return!1;return!0}function qr(R,N){for(var B=-1,Q=R==null?0:R.length,ct=0,It=[];++B<Q;){var oe=R[B];N(oe,B,R)&&(It[ct++]=oe)}return It}function Hs(R,N){var B=R==null?0:R.length;return!!B&&qi(R,N,0)>-1}function ul(R,N,B){for(var Q=-1,ct=R==null?0:R.length;++Q<ct;)if(B(N,R[Q]))return!0;return!1}function Wt(R,N){for(var B=-1,Q=R==null?0:R.length,ct=Array(Q);++B<Q;)ct[B]=N(R[B],B,R);return ct}function Kr(R,N){for(var B=-1,Q=N.length,ct=R.length;++B<Q;)R[ct+B]=N[B];return R}function cl(R,N,B,Q){var ct=-1,It=R==null?0:R.length;for(Q&&It&&(B=R[++ct]);++ct<It;)B=N(B,R[ct],ct,R);return B}function vy(R,N,B,Q){var ct=R==null?0:R.length;for(Q&&ct&&(B=R[--ct]);ct--;)B=N(B,R[ct],ct,R);return B}function fl(R,N){for(var B=-1,Q=R==null?0:R.length;++B<Q;)if(N(R[B],B,R))return!0;return!1}var _y=dl("length");function yy(R){return R.split("")}function xy(R){return R.match(I_)||[]}function sf(R,N,B){var Q;return B(R,function(ct,It,oe){if(N(ct,It,oe))return Q=It,!1}),Q}function Xs(R,N,B,Q){for(var ct=R.length,It=B+(Q?1:-1);Q?It--:++It<ct;)if(N(R[It],It,R))return It;return-1}function qi(R,N,B){return N===N?Dy(R,N,B):Xs(R,of,B)}function by(R,N,B,Q){for(var ct=B-1,It=R.length;++ct<It;)if(Q(R[ct],N))return ct;return-1}function of(R){return R!==R}function af(R,N){var B=R==null?0:R.length;return B?gl(R,N)/B:H}function dl(R){return function(N){return N==null?r:N[R]}}function pl(R){return function(N){return R==null?r:R[N]}}function lf(R,N,B,Q,ct){return ct(R,function(It,oe,Ft){B=Q?(Q=!1,It):N(B,It,oe,Ft)}),B}function wy(R,N){var B=R.length;for(R.sort(N);B--;)R[B]=R[B].value;return R}function gl(R,N){for(var B,Q=-1,ct=R.length;++Q<ct;){var It=N(R[Q]);It!==r&&(B=B===r?It:B+It)}return B}function ml(R,N){for(var B=-1,Q=Array(R);++B<R;)Q[B]=N(B);return Q}function Ey(R,N){return Wt(N,function(B){return[B,R[B]]})}function hf(R){return R&&R.slice(0,df(R)+1).replace(rl,"")}function De(R){return function(N){return R(N)}}function vl(R,N){return Wt(N,function(B){return R[B]})}function Yn(R,N){return R.has(N)}function uf(R,N){for(var B=-1,Q=R.length;++B<Q&&qi(N,R[B],0)>-1;);return B}function cf(R,N){for(var B=R.length;B--&&qi(N,R[B],0)>-1;);return B}function Ty(R,N){for(var B=R.length,Q=0;B--;)R[B]===N&&++Q;return Q}var Ay=pl(ly),Sy=pl(hy);function Cy(R){return"\\"+cy[R]}function Iy(R,N){return R==null?r:R[N]}function Ki(R){return ny.test(R)}function Py(R){return sy.test(R)}function Ry(R){for(var N,B=[];!(N=R.next()).done;)B.push(N.value);return B}function _l(R){var N=-1,B=Array(R.size);return R.forEach(function(Q,ct){B[++N]=[ct,Q]}),B}function ff(R,N){return function(B){return R(N(B))}}function Zr(R,N){for(var B=-1,Q=R.length,ct=0,It=[];++B<Q;){var oe=R[B];(oe===N||oe===d)&&(R[B]=d,It[ct++]=B)}return It}function zs(R){var N=-1,B=Array(R.size);return R.forEach(function(Q){B[++N]=Q}),B}function My(R){var N=-1,B=Array(R.size);return R.forEach(function(Q){B[++N]=[Q,Q]}),B}function Dy(R,N,B){for(var Q=B-1,ct=R.length;++Q<ct;)if(R[Q]===N)return Q;return-1}function By(R,N,B){for(var Q=B+1;Q--;)if(R[Q]===N)return Q;return Q}function Zi(R){return Ki(R)?Fy(R):_y(R)}function Qe(R){return Ki(R)?Ly(R):yy(R)}function df(R){for(var N=R.length;N--&&T_.test(R.charAt(N)););return N}var Oy=pl(uy);function Fy(R){for(var N=al.lastIndex=0;al.test(R);)++N;return N}function Ly(R){return R.match(al)||[]}function Ny(R){return R.match(iy)||[]}var ky=function R(N){N=N==null?fe:Ji.defaults(fe.Object(),N,Ji.pick(fe,oy));var B=N.Array,Q=N.Date,ct=N.Error,It=N.Function,oe=N.Math,Ft=N.Object,yl=N.RegExp,Uy=N.String,He=N.TypeError,Vs=B.prototype,Gy=It.prototype,Qi=Ft.prototype,js=N["__core-js_shared__"],Ys=Gy.toString,Bt=Qi.hasOwnProperty,Wy=0,pf=function(){var s=/[^.]+$/.exec(js&&js.keys&&js.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""}(),qs=Qi.toString,$y=Ys.call(Ft),Hy=fe._,Xy=yl("^"+Ys.call(Bt).replace(el,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ks=Kc?N.Buffer:r,Jr=N.Symbol,Zs=N.Uint8Array,gf=Ks?Ks.allocUnsafe:r,Js=ff(Ft.getPrototypeOf,Ft),mf=Ft.create,vf=Qi.propertyIsEnumerable,Qs=Vs.splice,_f=Jr?Jr.isConcatSpreadable:r,qn=Jr?Jr.iterator:r,yi=Jr?Jr.toStringTag:r,to=function(){try{var s=Ti(Ft,"defineProperty");return s({},"",{}),s}catch{}}(),zy=N.clearTimeout!==fe.clearTimeout&&N.clearTimeout,Vy=Q&&Q.now!==fe.Date.now&&Q.now,jy=N.setTimeout!==fe.setTimeout&&N.setTimeout,eo=oe.ceil,ro=oe.floor,xl=Ft.getOwnPropertySymbols,Yy=Ks?Ks.isBuffer:r,yf=N.isFinite,qy=Vs.join,Ky=ff(Ft.keys,Ft),ae=oe.max,_e=oe.min,Zy=Q.now,Jy=N.parseInt,xf=oe.random,Qy=Vs.reverse,bl=Ti(N,"DataView"),Kn=Ti(N,"Map"),wl=Ti(N,"Promise"),tn=Ti(N,"Set"),Zn=Ti(N,"WeakMap"),Jn=Ti(Ft,"create"),io=Zn&&new Zn,en={},t0=Ai(bl),e0=Ai(Kn),r0=Ai(wl),i0=Ai(tn),n0=Ai(Zn),no=Jr?Jr.prototype:r,Qn=no?no.valueOf:r,bf=no?no.toString:r;function b(s){if(Kt(s)&&!dt(s)&&!(s instanceof bt)){if(s instanceof Xe)return s;if(Bt.call(s,"__wrapped__"))return wd(s)}return new Xe(s)}var rn=function(){function s(){}return function(a){if(!Ht(a))return{};if(mf)return mf(a);s.prototype=a;var c=new s;return s.prototype=r,c}}();function so(){}function Xe(s,a){this.__wrapped__=s,this.__actions__=[],this.__chain__=!!a,this.__index__=0,this.__values__=r}b.templateSettings={escape:__,evaluate:y_,interpolate:Pc,variable:"",imports:{_:b}},b.prototype=so.prototype,b.prototype.constructor=b,Xe.prototype=rn(so.prototype),Xe.prototype.constructor=Xe;function bt(s){this.__wrapped__=s,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=rt,this.__views__=[]}function s0(){var s=new bt(this.__wrapped__);return s.__actions__=Ae(this.__actions__),s.__dir__=this.__dir__,s.__filtered__=this.__filtered__,s.__iteratees__=Ae(this.__iteratees__),s.__takeCount__=this.__takeCount__,s.__views__=Ae(this.__views__),s}function o0(){if(this.__filtered__){var s=new bt(this);s.__dir__=-1,s.__filtered__=!0}else s=this.clone(),s.__dir__*=-1;return s}function a0(){var s=this.__wrapped__.value(),a=this.__dir__,c=dt(s),p=a<0,_=c?s.length:0,T=yx(0,_,this.__views__),C=T.start,P=T.end,M=P-C,U=p?P:C-1,G=this.__iteratees__,$=G.length,q=0,tt=_e(M,this.__takeCount__);if(!c||!p&&_==M&&tt==M)return zf(s,this.__actions__);var lt=[];t:for(;M--&&q<tt;){U+=a;for(var mt=-1,ht=s[U];++mt<$;){var yt=G[mt],Tt=yt.iteratee,Fe=yt.type,Ee=Tt(ht);if(Fe==at)ht=Ee;else if(!Ee){if(Fe==k)continue t;break t}}lt[q++]=ht}return lt}bt.prototype=rn(so.prototype),bt.prototype.constructor=bt;function xi(s){var a=-1,c=s==null?0:s.length;for(this.clear();++a<c;){var p=s[a];this.set(p[0],p[1])}}function l0(){this.__data__=Jn?Jn(null):{},this.size=0}function h0(s){var a=this.has(s)&&delete this.__data__[s];return this.size-=a?1:0,a}function u0(s){var a=this.__data__;if(Jn){var c=a[s];return c===u?r:c}return Bt.call(a,s)?a[s]:r}function c0(s){var a=this.__data__;return Jn?a[s]!==r:Bt.call(a,s)}function f0(s,a){var c=this.__data__;return this.size+=this.has(s)?0:1,c[s]=Jn&&a===r?u:a,this}xi.prototype.clear=l0,xi.prototype.delete=h0,xi.prototype.get=u0,xi.prototype.has=c0,xi.prototype.set=f0;function Br(s){var a=-1,c=s==null?0:s.length;for(this.clear();++a<c;){var p=s[a];this.set(p[0],p[1])}}function d0(){this.__data__=[],this.size=0}function p0(s){var a=this.__data__,c=oo(a,s);if(c<0)return!1;var p=a.length-1;return c==p?a.pop():Qs.call(a,c,1),--this.size,!0}function g0(s){var a=this.__data__,c=oo(a,s);return c<0?r:a[c][1]}function m0(s){return oo(this.__data__,s)>-1}function v0(s,a){var c=this.__data__,p=oo(c,s);return p<0?(++this.size,c.push([s,a])):c[p][1]=a,this}Br.prototype.clear=d0,Br.prototype.delete=p0,Br.prototype.get=g0,Br.prototype.has=m0,Br.prototype.set=v0;function Or(s){var a=-1,c=s==null?0:s.length;for(this.clear();++a<c;){var p=s[a];this.set(p[0],p[1])}}function _0(){this.size=0,this.__data__={hash:new xi,map:new(Kn||Br),string:new xi}}function y0(s){var a=yo(this,s).delete(s);return this.size-=a?1:0,a}function x0(s){return yo(this,s).get(s)}function b0(s){return yo(this,s).has(s)}function w0(s,a){var c=yo(this,s),p=c.size;return c.set(s,a),this.size+=c.size==p?0:1,this}Or.prototype.clear=_0,Or.prototype.delete=y0,Or.prototype.get=x0,Or.prototype.has=b0,Or.prototype.set=w0;function bi(s){var a=-1,c=s==null?0:s.length;for(this.__data__=new Or;++a<c;)this.add(s[a])}function E0(s){return this.__data__.set(s,u),this}function T0(s){return this.__data__.has(s)}bi.prototype.add=bi.prototype.push=E0,bi.prototype.has=T0;function tr(s){var a=this.__data__=new Br(s);this.size=a.size}function A0(){this.__data__=new Br,this.size=0}function S0(s){var a=this.__data__,c=a.delete(s);return this.size=a.size,c}function C0(s){return this.__data__.get(s)}function I0(s){return this.__data__.has(s)}function P0(s,a){var c=this.__data__;if(c instanceof Br){var p=c.__data__;if(!Kn||p.length<n-1)return p.push([s,a]),this.size=++c.size,this;c=this.__data__=new Or(p)}return c.set(s,a),this.size=c.size,this}tr.prototype.clear=A0,tr.prototype.delete=S0,tr.prototype.get=C0,tr.prototype.has=I0,tr.prototype.set=P0;function wf(s,a){var c=dt(s),p=!c&&Si(s),_=!c&&!p&&ii(s),T=!c&&!p&&!_&&an(s),C=c||p||_||T,P=C?ml(s.length,Uy):[],M=P.length;for(var U in s)(a||Bt.call(s,U))&&!(C&&(U=="length"||_&&(U=="offset"||U=="parent")||T&&(U=="buffer"||U=="byteLength"||U=="byteOffset")||kr(U,M)))&&P.push(U);return P}function Ef(s){var a=s.length;return a?s[Bl(0,a-1)]:r}function R0(s,a){return xo(Ae(s),wi(a,0,s.length))}function M0(s){return xo(Ae(s))}function El(s,a,c){(c!==r&&!er(s[a],c)||c===r&&!(a in s))&&Fr(s,a,c)}function ts(s,a,c){var p=s[a];(!(Bt.call(s,a)&&er(p,c))||c===r&&!(a in s))&&Fr(s,a,c)}function oo(s,a){for(var c=s.length;c--;)if(er(s[c][0],a))return c;return-1}function D0(s,a,c,p){return Qr(s,function(_,T,C){a(p,_,c(_),C)}),p}function Tf(s,a){return s&&_r(a,ue(a),s)}function B0(s,a){return s&&_r(a,Ce(a),s)}function Fr(s,a,c){a=="__proto__"&&to?to(s,a,{configurable:!0,enumerable:!0,value:c,writable:!0}):s[a]=c}function Tl(s,a){for(var c=-1,p=a.length,_=B(p),T=s==null;++c<p;)_[c]=T?r:nh(s,a[c]);return _}function wi(s,a,c){return s===s&&(c!==r&&(s=s<=c?s:c),a!==r&&(s=s>=a?s:a)),s}function ze(s,a,c,p,_,T){var C,P=a&g,M=a&m,U=a&v;if(c&&(C=_?c(s,p,_,T):c(s)),C!==r)return C;if(!Ht(s))return s;var G=dt(s);if(G){if(C=bx(s),!P)return Ae(s,C)}else{var $=ye(s),q=$==Ut||$==Yt;if(ii(s))return Yf(s,P);if($==mr||$==Nt||q&&!_){if(C=M||q?{}:dd(s),!P)return M?ux(s,B0(C,s)):hx(s,Tf(C,s))}else{if(!Lt[$])return _?s:{};C=wx(s,$,P)}}T=new tr;var tt=T.get(s);if(tt)return tt;T.set(s,C),$d(s)?s.forEach(function(ht){C.add(ze(ht,a,c,ht,s,T))}):Gd(s)&&s.forEach(function(ht,yt){C.set(yt,ze(ht,a,c,yt,s,T))});var lt=U?M?Xl:Hl:M?Ce:ue,mt=G?r:lt(s);return $e(mt||s,function(ht,yt){mt&&(yt=ht,ht=s[yt]),ts(C,yt,ze(ht,a,c,yt,s,T))}),C}function O0(s){var a=ue(s);return function(c){return Af(c,s,a)}}function Af(s,a,c){var p=c.length;if(s==null)return!p;for(s=Ft(s);p--;){var _=c[p],T=a[_],C=s[_];if(C===r&&!(_ in s)||!T(C))return!1}return!0}function Sf(s,a,c){if(typeof s!="function")throw new He(l);return as(function(){s.apply(r,c)},a)}function es(s,a,c,p){var _=-1,T=Hs,C=!0,P=s.length,M=[],U=a.length;if(!P)return M;c&&(a=Wt(a,De(c))),p?(T=ul,C=!1):a.length>=n&&(T=Yn,C=!1,a=new bi(a));t:for(;++_<P;){var G=s[_],$=c==null?G:c(G);if(G=p||G!==0?G:0,C&&$===$){for(var q=U;q--;)if(a[q]===$)continue t;M.push(G)}else T(a,$,p)||M.push(G)}return M}var Qr=Qf(vr),Cf=Qf(Sl,!0);function F0(s,a){var c=!0;return Qr(s,function(p,_,T){return c=!!a(p,_,T),c}),c}function ao(s,a,c){for(var p=-1,_=s.length;++p<_;){var T=s[p],C=a(T);if(C!=null&&(P===r?C===C&&!Oe(C):c(C,P)))var P=C,M=T}return M}function L0(s,a,c,p){var _=s.length;for(c=gt(c),c<0&&(c=-c>_?0:_+c),p=p===r||p>_?_:gt(p),p<0&&(p+=_),p=c>p?0:Xd(p);c<p;)s[c++]=a;return s}function If(s,a){var c=[];return Qr(s,function(p,_,T){a(p,_,T)&&c.push(p)}),c}function de(s,a,c,p,_){var T=-1,C=s.length;for(c||(c=Tx),_=[];++T<C;){var P=s[T];a>0&&c(P)?a>1?de(P,a-1,c,p,_):Kr(_,P):p||(_[_.length]=P)}return _}var Al=td(),Pf=td(!0);function vr(s,a){return s&&Al(s,a,ue)}function Sl(s,a){return s&&Pf(s,a,ue)}function lo(s,a){return qr(a,function(c){return Ur(s[c])})}function Ei(s,a){a=ei(a,s);for(var c=0,p=a.length;s!=null&&c<p;)s=s[yr(a[c++])];return c&&c==p?s:r}function Rf(s,a,c){var p=a(s);return dt(s)?p:Kr(p,c(s))}function be(s){return s==null?s===r?c_:vi:yi&&yi in Ft(s)?_x(s):Mx(s)}function Cl(s,a){return s>a}function N0(s,a){return s!=null&&Bt.call(s,a)}function k0(s,a){return s!=null&&a in Ft(s)}function U0(s,a,c){return s>=_e(a,c)&&s<ae(a,c)}function Il(s,a,c){for(var p=c?ul:Hs,_=s[0].length,T=s.length,C=T,P=B(T),M=1/0,U=[];C--;){var G=s[C];C&&a&&(G=Wt(G,De(a))),M=_e(G.length,M),P[C]=!c&&(a||_>=120&&G.length>=120)?new bi(C&&G):r}G=s[0];var $=-1,q=P[0];t:for(;++$<_&&U.length<M;){var tt=G[$],lt=a?a(tt):tt;if(tt=c||tt!==0?tt:0,!(q?Yn(q,lt):p(U,lt,c))){for(C=T;--C;){var mt=P[C];if(!(mt?Yn(mt,lt):p(s[C],lt,c)))continue t}q&&q.push(lt),U.push(tt)}}return U}function G0(s,a,c,p){return vr(s,function(_,T,C){a(p,c(_),T,C)}),p}function rs(s,a,c){a=ei(a,s),s=vd(s,a);var p=s==null?s:s[yr(je(a))];return p==null?r:Me(p,s,c)}function Mf(s){return Kt(s)&&be(s)==Nt}function W0(s){return Kt(s)&&be(s)==jn}function $0(s){return Kt(s)&&be(s)==ie}function is(s,a,c,p,_){return s===a?!0:s==null||a==null||!Kt(s)&&!Kt(a)?s!==s&&a!==a:H0(s,a,c,p,is,_)}function H0(s,a,c,p,_,T){var C=dt(s),P=dt(a),M=C?kt:ye(s),U=P?kt:ye(a);M=M==Nt?mr:M,U=U==Nt?mr:U;var G=M==mr,$=U==mr,q=M==U;if(q&&ii(s)){if(!ii(a))return!1;C=!0,G=!1}if(q&&!G)return T||(T=new tr),C||an(s)?ud(s,a,c,p,_,T):mx(s,a,M,c,p,_,T);if(!(c&y)){var tt=G&&Bt.call(s,"__wrapped__"),lt=$&&Bt.call(a,"__wrapped__");if(tt||lt){var mt=tt?s.value():s,ht=lt?a.value():a;return T||(T=new tr),_(mt,ht,c,p,T)}}return q?(T||(T=new tr),vx(s,a,c,p,_,T)):!1}function X0(s){return Kt(s)&&ye(s)==qt}function Pl(s,a,c,p){var _=c.length,T=_,C=!p;if(s==null)return!T;for(s=Ft(s);_--;){var P=c[_];if(C&&P[2]?P[1]!==s[P[0]]:!(P[0]in s))return!1}for(;++_<T;){P=c[_];var M=P[0],U=s[M],G=P[1];if(C&&P[2]){if(U===r&&!(M in s))return!1}else{var $=new tr;if(p)var q=p(U,G,M,s,a,$);if(!(q===r?is(G,U,y|w,p,$):q))return!1}}return!0}function Df(s){if(!Ht(s)||Sx(s))return!1;var a=Ur(s)?Xy:O_;return a.test(Ai(s))}function z0(s){return Kt(s)&&be(s)==Xn}function V0(s){return Kt(s)&&ye(s)==Je}function j0(s){return Kt(s)&&So(s.length)&&!!Gt[be(s)]}function Bf(s){return typeof s=="function"?s:s==null?Ie:typeof s=="object"?dt(s)?Lf(s[0],s[1]):Ff(s):ep(s)}function Rl(s){if(!os(s))return Ky(s);var a=[];for(var c in Ft(s))Bt.call(s,c)&&c!="constructor"&&a.push(c);return a}function Y0(s){if(!Ht(s))return Rx(s);var a=os(s),c=[];for(var p in s)p=="constructor"&&(a||!Bt.call(s,p))||c.push(p);return c}function Ml(s,a){return s<a}function Of(s,a){var c=-1,p=Se(s)?B(s.length):[];return Qr(s,function(_,T,C){p[++c]=a(_,T,C)}),p}function Ff(s){var a=Vl(s);return a.length==1&&a[0][2]?gd(a[0][0],a[0][1]):function(c){return c===s||Pl(c,s,a)}}function Lf(s,a){return Yl(s)&&pd(a)?gd(yr(s),a):function(c){var p=nh(c,s);return p===r&&p===a?sh(c,s):is(a,p,y|w)}}function ho(s,a,c,p,_){s!==a&&Al(a,function(T,C){if(_||(_=new tr),Ht(T))q0(s,a,C,c,ho,p,_);else{var P=p?p(Kl(s,C),T,C+"",s,a,_):r;P===r&&(P=T),El(s,C,P)}},Ce)}function q0(s,a,c,p,_,T,C){var P=Kl(s,c),M=Kl(a,c),U=C.get(M);if(U){El(s,c,U);return}var G=T?T(P,M,c+"",s,a,C):r,$=G===r;if($){var q=dt(M),tt=!q&&ii(M),lt=!q&&!tt&&an(M);G=M,q||tt||lt?dt(P)?G=P:Jt(P)?G=Ae(P):tt?($=!1,G=Yf(M,!0)):lt?($=!1,G=qf(M,!0)):G=[]:ls(M)||Si(M)?(G=P,Si(P)?G=zd(P):(!Ht(P)||Ur(P))&&(G=dd(M))):$=!1}$&&(C.set(M,G),_(G,M,p,T,C),C.delete(M)),El(s,c,G)}function Nf(s,a){var c=s.length;if(c)return a+=a<0?c:0,kr(a,c)?s[a]:r}function kf(s,a,c){a.length?a=Wt(a,function(T){return dt(T)?function(C){return Ei(C,T.length===1?T[0]:T)}:T}):a=[Ie];var p=-1;a=Wt(a,De(ot()));var _=Of(s,function(T,C,P){var M=Wt(a,function(U){return U(T)});return{criteria:M,index:++p,value:T}});return wy(_,function(T,C){return lx(T,C,c)})}function K0(s,a){return Uf(s,a,function(c,p){return sh(s,p)})}function Uf(s,a,c){for(var p=-1,_=a.length,T={};++p<_;){var C=a[p],P=Ei(s,C);c(P,C)&&ns(T,ei(C,s),P)}return T}function Z0(s){return function(a){return Ei(a,s)}}function Dl(s,a,c,p){var _=p?by:qi,T=-1,C=a.length,P=s;for(s===a&&(a=Ae(a)),c&&(P=Wt(s,De(c)));++T<C;)for(var M=0,U=a[T],G=c?c(U):U;(M=_(P,G,M,p))>-1;)P!==s&&Qs.call(P,M,1),Qs.call(s,M,1);return s}function Gf(s,a){for(var c=s?a.length:0,p=c-1;c--;){var _=a[c];if(c==p||_!==T){var T=_;kr(_)?Qs.call(s,_,1):Ll(s,_)}}return s}function Bl(s,a){return s+ro(xf()*(a-s+1))}function J0(s,a,c,p){for(var _=-1,T=ae(eo((a-s)/(c||1)),0),C=B(T);T--;)C[p?T:++_]=s,s+=c;return C}function Ol(s,a){var c="";if(!s||a<1||a>vt)return c;do a%2&&(c+=s),a=ro(a/2),a&&(s+=s);while(a);return c}function _t(s,a){return Zl(md(s,a,Ie),s+"")}function Q0(s){return Ef(ln(s))}function tx(s,a){var c=ln(s);return xo(c,wi(a,0,c.length))}function ns(s,a,c,p){if(!Ht(s))return s;a=ei(a,s);for(var _=-1,T=a.length,C=T-1,P=s;P!=null&&++_<T;){var M=yr(a[_]),U=c;if(M==="__proto__"||M==="constructor"||M==="prototype")return s;if(_!=C){var G=P[M];U=p?p(G,M,P):r,U===r&&(U=Ht(G)?G:kr(a[_+1])?[]:{})}ts(P,M,U),P=P[M]}return s}var Wf=io?function(s,a){return io.set(s,a),s}:Ie,ex=to?function(s,a){return to(s,"toString",{configurable:!0,enumerable:!1,value:ah(a),writable:!0})}:Ie;function rx(s){return xo(ln(s))}function Ve(s,a,c){var p=-1,_=s.length;a<0&&(a=-a>_?0:_+a),c=c>_?_:c,c<0&&(c+=_),_=a>c?0:c-a>>>0,a>>>=0;for(var T=B(_);++p<_;)T[p]=s[p+a];return T}function ix(s,a){var c;return Qr(s,function(p,_,T){return c=a(p,_,T),!c}),!!c}function uo(s,a,c){var p=0,_=s==null?p:s.length;if(typeof a=="number"&&a===a&&_<=Pt){for(;p<_;){var T=p+_>>>1,C=s[T];C!==null&&!Oe(C)&&(c?C<=a:C<a)?p=T+1:_=T}return _}return Fl(s,a,Ie,c)}function Fl(s,a,c,p){var _=0,T=s==null?0:s.length;if(T===0)return 0;a=c(a);for(var C=a!==a,P=a===null,M=Oe(a),U=a===r;_<T;){var G=ro((_+T)/2),$=c(s[G]),q=$!==r,tt=$===null,lt=$===$,mt=Oe($);if(C)var ht=p||lt;else U?ht=lt&&(p||q):P?ht=lt&&q&&(p||!tt):M?ht=lt&&q&&!tt&&(p||!mt):tt||mt?ht=!1:ht=p?$<=a:$<a;ht?_=G+1:T=G}return _e(T,xt)}function $f(s,a){for(var c=-1,p=s.length,_=0,T=[];++c<p;){var C=s[c],P=a?a(C):C;if(!c||!er(P,M)){var M=P;T[_++]=C===0?0:C}}return T}function Hf(s){return typeof s=="number"?s:Oe(s)?H:+s}function Be(s){if(typeof s=="string")return s;if(dt(s))return Wt(s,Be)+"";if(Oe(s))return bf?bf.call(s):"";var a=s+"";return a=="0"&&1/s==-j?"-0":a}function ti(s,a,c){var p=-1,_=Hs,T=s.length,C=!0,P=[],M=P;if(c)C=!1,_=ul;else if(T>=n){var U=a?null:px(s);if(U)return zs(U);C=!1,_=Yn,M=new bi}else M=a?[]:P;t:for(;++p<T;){var G=s[p],$=a?a(G):G;if(G=c||G!==0?G:0,C&&$===$){for(var q=M.length;q--;)if(M[q]===$)continue t;a&&M.push($),P.push(G)}else _(M,$,c)||(M!==P&&M.push($),P.push(G))}return P}function Ll(s,a){return a=ei(a,s),s=vd(s,a),s==null||delete s[yr(je(a))]}function Xf(s,a,c,p){return ns(s,a,c(Ei(s,a)),p)}function co(s,a,c,p){for(var _=s.length,T=p?_:-1;(p?T--:++T<_)&&a(s[T],T,s););return c?Ve(s,p?0:T,p?T+1:_):Ve(s,p?T+1:0,p?_:T)}function zf(s,a){var c=s;return c instanceof bt&&(c=c.value()),cl(a,function(p,_){return _.func.apply(_.thisArg,Kr([p],_.args))},c)}function Nl(s,a,c){var p=s.length;if(p<2)return p?ti(s[0]):[];for(var _=-1,T=B(p);++_<p;)for(var C=s[_],P=-1;++P<p;)P!=_&&(T[_]=es(T[_]||C,s[P],a,c));return ti(de(T,1),a,c)}function Vf(s,a,c){for(var p=-1,_=s.length,T=a.length,C={};++p<_;){var P=p<T?a[p]:r;c(C,s[p],P)}return C}function kl(s){return Jt(s)?s:[]}function Ul(s){return typeof s=="function"?s:Ie}function ei(s,a){return dt(s)?s:Yl(s,a)?[s]:bd(Rt(s))}var nx=_t;function ri(s,a,c){var p=s.length;return c=c===r?p:c,!a&&c>=p?s:Ve(s,a,c)}var jf=zy||function(s){return fe.clearTimeout(s)};function Yf(s,a){if(a)return s.slice();var c=s.length,p=gf?gf(c):new s.constructor(c);return s.copy(p),p}function Gl(s){var a=new s.constructor(s.byteLength);return new Zs(a).set(new Zs(s)),a}function sx(s,a){var c=a?Gl(s.buffer):s.buffer;return new s.constructor(c,s.byteOffset,s.byteLength)}function ox(s){var a=new s.constructor(s.source,Rc.exec(s));return a.lastIndex=s.lastIndex,a}function ax(s){return Qn?Ft(Qn.call(s)):{}}function qf(s,a){var c=a?Gl(s.buffer):s.buffer;return new s.constructor(c,s.byteOffset,s.length)}function Kf(s,a){if(s!==a){var c=s!==r,p=s===null,_=s===s,T=Oe(s),C=a!==r,P=a===null,M=a===a,U=Oe(a);if(!P&&!U&&!T&&s>a||T&&C&&M&&!P&&!U||p&&C&&M||!c&&M||!_)return 1;if(!p&&!T&&!U&&s<a||U&&c&&_&&!p&&!T||P&&c&&_||!C&&_||!M)return-1}return 0}function lx(s,a,c){for(var p=-1,_=s.criteria,T=a.criteria,C=_.length,P=c.length;++p<C;){var M=Kf(_[p],T[p]);if(M){if(p>=P)return M;var U=c[p];return M*(U=="desc"?-1:1)}}return s.index-a.index}function Zf(s,a,c,p){for(var _=-1,T=s.length,C=c.length,P=-1,M=a.length,U=ae(T-C,0),G=B(M+U),$=!p;++P<M;)G[P]=a[P];for(;++_<C;)($||_<T)&&(G[c[_]]=s[_]);for(;U--;)G[P++]=s[_++];return G}function Jf(s,a,c,p){for(var _=-1,T=s.length,C=-1,P=c.length,M=-1,U=a.length,G=ae(T-P,0),$=B(G+U),q=!p;++_<G;)$[_]=s[_];for(var tt=_;++M<U;)$[tt+M]=a[M];for(;++C<P;)(q||_<T)&&($[tt+c[C]]=s[_++]);return $}function Ae(s,a){var c=-1,p=s.length;for(a||(a=B(p));++c<p;)a[c]=s[c];return a}function _r(s,a,c,p){var _=!c;c||(c={});for(var T=-1,C=a.length;++T<C;){var P=a[T],M=p?p(c[P],s[P],P,c,s):r;M===r&&(M=s[P]),_?Fr(c,P,M):ts(c,P,M)}return c}function hx(s,a){return _r(s,jl(s),a)}function ux(s,a){return _r(s,cd(s),a)}function fo(s,a){return function(c,p){var _=dt(c)?gy:D0,T=a?a():{};return _(c,s,ot(p,2),T)}}function nn(s){return _t(function(a,c){var p=-1,_=c.length,T=_>1?c[_-1]:r,C=_>2?c[2]:r;for(T=s.length>3&&typeof T=="function"?(_--,T):r,C&&we(c[0],c[1],C)&&(T=_<3?r:T,_=1),a=Ft(a);++p<_;){var P=c[p];P&&s(a,P,p,T)}return a})}function Qf(s,a){return function(c,p){if(c==null)return c;if(!Se(c))return s(c,p);for(var _=c.length,T=a?_:-1,C=Ft(c);(a?T--:++T<_)&&p(C[T],T,C)!==!1;);return c}}function td(s){return function(a,c,p){for(var _=-1,T=Ft(a),C=p(a),P=C.length;P--;){var M=C[s?P:++_];if(c(T[M],M,T)===!1)break}return a}}function cx(s,a,c){var p=a&x,_=ss(s);function T(){var C=this&&this!==fe&&this instanceof T?_:s;return C.apply(p?c:this,arguments)}return T}function ed(s){return function(a){a=Rt(a);var c=Ki(a)?Qe(a):r,p=c?c[0]:a.charAt(0),_=c?ri(c,1).join(""):a.slice(1);return p[s]()+_}}function sn(s){return function(a){return cl(Qd(Jd(a).replace(ey,"")),s,"")}}function ss(s){return function(){var a=arguments;switch(a.length){case 0:return new s;case 1:return new s(a[0]);case 2:return new s(a[0],a[1]);case 3:return new s(a[0],a[1],a[2]);case 4:return new s(a[0],a[1],a[2],a[3]);case 5:return new s(a[0],a[1],a[2],a[3],a[4]);case 6:return new s(a[0],a[1],a[2],a[3],a[4],a[5]);case 7:return new s(a[0],a[1],a[2],a[3],a[4],a[5],a[6])}var c=rn(s.prototype),p=s.apply(c,a);return Ht(p)?p:c}}function fx(s,a,c){var p=ss(s);function _(){for(var T=arguments.length,C=B(T),P=T,M=on(_);P--;)C[P]=arguments[P];var U=T<3&&C[0]!==M&&C[T-1]!==M?[]:Zr(C,M);if(T-=U.length,T<c)return od(s,a,po,_.placeholder,r,C,U,r,r,c-T);var G=this&&this!==fe&&this instanceof _?p:s;return Me(G,this,C)}return _}function rd(s){return function(a,c,p){var _=Ft(a);if(!Se(a)){var T=ot(c,3);a=ue(a),c=function(P){return T(_[P],P,_)}}var C=s(a,c,p);return C>-1?_[T?a[C]:C]:r}}function id(s){return Nr(function(a){var c=a.length,p=c,_=Xe.prototype.thru;for(s&&a.reverse();p--;){var T=a[p];if(typeof T!="function")throw new He(l);if(_&&!C&&_o(T)=="wrapper")var C=new Xe([],!0)}for(p=C?p:c;++p<c;){T=a[p];var P=_o(T),M=P=="wrapper"?zl(T):r;M&&ql(M[0])&&M[1]==(O|E|D|F)&&!M[4].length&&M[9]==1?C=C[_o(M[0])].apply(C,M[3]):C=T.length==1&&ql(T)?C[P]():C.thru(T)}return function(){var U=arguments,G=U[0];if(C&&U.length==1&&dt(G))return C.plant(G).value();for(var $=0,q=c?a[$].apply(this,U):G;++$<c;)q=a[$].call(this,q);return q}})}function po(s,a,c,p,_,T,C,P,M,U){var G=a&O,$=a&x,q=a&A,tt=a&(E|I),lt=a&X,mt=q?r:ss(s);function ht(){for(var yt=arguments.length,Tt=B(yt),Fe=yt;Fe--;)Tt[Fe]=arguments[Fe];if(tt)var Ee=on(ht),Le=Ty(Tt,Ee);if(p&&(Tt=Zf(Tt,p,_,tt)),T&&(Tt=Jf(Tt,T,C,tt)),yt-=Le,tt&&yt<U){var Qt=Zr(Tt,Ee);return od(s,a,po,ht.placeholder,c,Tt,Qt,P,M,U-yt)}var rr=$?c:this,Wr=q?rr[s]:s;return yt=Tt.length,P?Tt=Dx(Tt,P):lt&&yt>1&&Tt.reverse(),G&&M<yt&&(Tt.length=M),this&&this!==fe&&this instanceof ht&&(Wr=mt||ss(Wr)),Wr.apply(rr,Tt)}return ht}function nd(s,a){return function(c,p){return G0(c,s,a(p),{})}}function go(s,a){return function(c,p){var _;if(c===r&&p===r)return a;if(c!==r&&(_=c),p!==r){if(_===r)return p;typeof c=="string"||typeof p=="string"?(c=Be(c),p=Be(p)):(c=Hf(c),p=Hf(p)),_=s(c,p)}return _}}function Wl(s){return Nr(function(a){return a=Wt(a,De(ot())),_t(function(c){var p=this;return s(a,function(_){return Me(_,p,c)})})})}function mo(s,a){a=a===r?" ":Be(a);var c=a.length;if(c<2)return c?Ol(a,s):a;var p=Ol(a,eo(s/Zi(a)));return Ki(a)?ri(Qe(p),0,s).join(""):p.slice(0,s)}function dx(s,a,c,p){var _=a&x,T=ss(s);function C(){for(var P=-1,M=arguments.length,U=-1,G=p.length,$=B(G+M),q=this&&this!==fe&&this instanceof C?T:s;++U<G;)$[U]=p[U];for(;M--;)$[U++]=arguments[++P];return Me(q,_?c:this,$)}return C}function sd(s){return function(a,c,p){return p&&typeof p!="number"&&we(a,c,p)&&(c=p=r),a=Gr(a),c===r?(c=a,a=0):c=Gr(c),p=p===r?a<c?1:-1:Gr(p),J0(a,c,p,s)}}function vo(s){return function(a,c){return typeof a=="string"&&typeof c=="string"||(a=Ye(a),c=Ye(c)),s(a,c)}}function od(s,a,c,p,_,T,C,P,M,U){var G=a&E,$=G?C:r,q=G?r:C,tt=G?T:r,lt=G?r:T;a|=G?D:L,a&=~(G?L:D),a&S||(a&=~(x|A));var mt=[s,a,_,tt,$,lt,q,P,M,U],ht=c.apply(r,mt);return ql(s)&&_d(ht,mt),ht.placeholder=p,yd(ht,s,a)}function $l(s){var a=oe[s];return function(c,p){if(c=Ye(c),p=p==null?0:_e(gt(p),292),p&&yf(c)){var _=(Rt(c)+"e").split("e"),T=a(_[0]+"e"+(+_[1]+p));return _=(Rt(T)+"e").split("e"),+(_[0]+"e"+(+_[1]-p))}return a(c)}}var px=tn&&1/zs(new tn([,-0]))[1]==j?function(s){return new tn(s)}:uh;function ad(s){return function(a){var c=ye(a);return c==qt?_l(a):c==Je?My(a):Ey(a,s(a))}}function Lr(s,a,c,p,_,T,C,P){var M=a&A;if(!M&&typeof s!="function")throw new He(l);var U=p?p.length:0;if(U||(a&=~(D|L),p=_=r),C=C===r?C:ae(gt(C),0),P=P===r?P:gt(P),U-=_?_.length:0,a&L){var G=p,$=_;p=_=r}var q=M?r:zl(s),tt=[s,a,c,p,_,G,$,T,C,P];if(q&&Px(tt,q),s=tt[0],a=tt[1],c=tt[2],p=tt[3],_=tt[4],P=tt[9]=tt[9]===r?M?0:s.length:ae(tt[9]-U,0),!P&&a&(E|I)&&(a&=~(E|I)),!a||a==x)var lt=cx(s,a,c);else a==E||a==I?lt=fx(s,a,P):(a==D||a==(x|D))&&!_.length?lt=dx(s,a,c,p):lt=po.apply(r,tt);var mt=q?Wf:_d;return yd(mt(lt,tt),s,a)}function ld(s,a,c,p){return s===r||er(s,Qi[c])&&!Bt.call(p,c)?a:s}function hd(s,a,c,p,_,T){return Ht(s)&&Ht(a)&&(T.set(a,s),ho(s,a,r,hd,T),T.delete(a)),s}function gx(s){return ls(s)?r:s}function ud(s,a,c,p,_,T){var C=c&y,P=s.length,M=a.length;if(P!=M&&!(C&&M>P))return!1;var U=T.get(s),G=T.get(a);if(U&&G)return U==a&&G==s;var $=-1,q=!0,tt=c&w?new bi:r;for(T.set(s,a),T.set(a,s);++$<P;){var lt=s[$],mt=a[$];if(p)var ht=C?p(mt,lt,$,a,s,T):p(lt,mt,$,s,a,T);if(ht!==r){if(ht)continue;q=!1;break}if(tt){if(!fl(a,function(yt,Tt){if(!Yn(tt,Tt)&&(lt===yt||_(lt,yt,c,p,T)))return tt.push(Tt)})){q=!1;break}}else if(!(lt===mt||_(lt,mt,c,p,T))){q=!1;break}}return T.delete(s),T.delete(a),q}function mx(s,a,c,p,_,T,C){switch(c){case ji:if(s.byteLength!=a.byteLength||s.byteOffset!=a.byteOffset)return!1;s=s.buffer,a=a.buffer;case jn:return!(s.byteLength!=a.byteLength||!T(new Zs(s),new Zs(a)));case jt:case ie:case ve:return er(+s,+a);case Dt:return s.name==a.name&&s.message==a.message;case Xn:case zn:return s==a+"";case qt:var P=_l;case Je:var M=p&y;if(P||(P=zs),s.size!=a.size&&!M)return!1;var U=C.get(s);if(U)return U==a;p|=w,C.set(s,a);var G=ud(P(s),P(a),p,_,T,C);return C.delete(s),G;case Us:if(Qn)return Qn.call(s)==Qn.call(a)}return!1}function vx(s,a,c,p,_,T){var C=c&y,P=Hl(s),M=P.length,U=Hl(a),G=U.length;if(M!=G&&!C)return!1;for(var $=M;$--;){var q=P[$];if(!(C?q in a:Bt.call(a,q)))return!1}var tt=T.get(s),lt=T.get(a);if(tt&&lt)return tt==a&&lt==s;var mt=!0;T.set(s,a),T.set(a,s);for(var ht=C;++$<M;){q=P[$];var yt=s[q],Tt=a[q];if(p)var Fe=C?p(Tt,yt,q,a,s,T):p(yt,Tt,q,s,a,T);if(!(Fe===r?yt===Tt||_(yt,Tt,c,p,T):Fe)){mt=!1;break}ht||(ht=q=="constructor")}if(mt&&!ht){var Ee=s.constructor,Le=a.constructor;Ee!=Le&&"constructor"in s&&"constructor"in a&&!(typeof Ee=="function"&&Ee instanceof Ee&&typeof Le=="function"&&Le instanceof Le)&&(mt=!1)}return T.delete(s),T.delete(a),mt}function Nr(s){return Zl(md(s,r,Ad),s+"")}function Hl(s){return Rf(s,ue,jl)}function Xl(s){return Rf(s,Ce,cd)}var zl=io?function(s){return io.get(s)}:uh;function _o(s){for(var a=s.name+"",c=en[a],p=Bt.call(en,a)?c.length:0;p--;){var _=c[p],T=_.func;if(T==null||T==s)return _.name}return a}function on(s){var a=Bt.call(b,"placeholder")?b:s;return a.placeholder}function ot(){var s=b.iteratee||lh;return s=s===lh?Bf:s,arguments.length?s(arguments[0],arguments[1]):s}function yo(s,a){var c=s.__data__;return Ax(a)?c[typeof a=="string"?"string":"hash"]:c.map}function Vl(s){for(var a=ue(s),c=a.length;c--;){var p=a[c],_=s[p];a[c]=[p,_,pd(_)]}return a}function Ti(s,a){var c=Iy(s,a);return Df(c)?c:r}function _x(s){var a=Bt.call(s,yi),c=s[yi];try{s[yi]=r;var p=!0}catch{}var _=qs.call(s);return p&&(a?s[yi]=c:delete s[yi]),_}var jl=xl?function(s){return s==null?[]:(s=Ft(s),qr(xl(s),function(a){return vf.call(s,a)}))}:ch,cd=xl?function(s){for(var a=[];s;)Kr(a,jl(s)),s=Js(s);return a}:ch,ye=be;(bl&&ye(new bl(new ArrayBuffer(1)))!=ji||Kn&&ye(new Kn)!=qt||wl&&ye(wl.resolve())!=Sc||tn&&ye(new tn)!=Je||Zn&&ye(new Zn)!=Vn)&&(ye=function(s){var a=be(s),c=a==mr?s.constructor:r,p=c?Ai(c):"";if(p)switch(p){case t0:return ji;case e0:return qt;case r0:return Sc;case i0:return Je;case n0:return Vn}return a});function yx(s,a,c){for(var p=-1,_=c.length;++p<_;){var T=c[p],C=T.size;switch(T.type){case"drop":s+=C;break;case"dropRight":a-=C;break;case"take":a=_e(a,s+C);break;case"takeRight":s=ae(s,a-C);break}}return{start:s,end:a}}function xx(s){var a=s.match(S_);return a?a[1].split(C_):[]}function fd(s,a,c){a=ei(a,s);for(var p=-1,_=a.length,T=!1;++p<_;){var C=yr(a[p]);if(!(T=s!=null&&c(s,C)))break;s=s[C]}return T||++p!=_?T:(_=s==null?0:s.length,!!_&&So(_)&&kr(C,_)&&(dt(s)||Si(s)))}function bx(s){var a=s.length,c=new s.constructor(a);return a&&typeof s[0]=="string"&&Bt.call(s,"index")&&(c.index=s.index,c.input=s.input),c}function dd(s){return typeof s.constructor=="function"&&!os(s)?rn(Js(s)):{}}function wx(s,a,c){var p=s.constructor;switch(a){case jn:return Gl(s);case jt:case ie:return new p(+s);case ji:return sx(s,c);case Va:case ja:case Ya:case qa:case Ka:case Za:case Ja:case Qa:case tl:return qf(s,c);case qt:return new p;case ve:case zn:return new p(s);case Xn:return ox(s);case Je:return new p;case Us:return ax(s)}}function Ex(s,a){var c=a.length;if(!c)return s;var p=c-1;return a[p]=(c>1?"& ":"")+a[p],a=a.join(c>2?", ":" "),s.replace(A_,`{
/* [wrapped with `+a+`] */
`)}function Tx(s){return dt(s)||Si(s)||!!(_f&&s&&s[_f])}function kr(s,a){var c=typeof s;return a=a??vt,!!a&&(c=="number"||c!="symbol"&&L_.test(s))&&s>-1&&s%1==0&&s<a}function we(s,a,c){if(!Ht(c))return!1;var p=typeof a;return(p=="number"?Se(c)&&kr(a,c.length):p=="string"&&a in c)?er(c[a],s):!1}function Yl(s,a){if(dt(s))return!1;var c=typeof s;return c=="number"||c=="symbol"||c=="boolean"||s==null||Oe(s)?!0:b_.test(s)||!x_.test(s)||a!=null&&s in Ft(a)}function Ax(s){var a=typeof s;return a=="string"||a=="number"||a=="symbol"||a=="boolean"?s!=="__proto__":s===null}function ql(s){var a=_o(s),c=b[a];if(typeof c!="function"||!(a in bt.prototype))return!1;if(s===c)return!0;var p=zl(c);return!!p&&s===p[0]}function Sx(s){return!!pf&&pf in s}var Cx=js?Ur:fh;function os(s){var a=s&&s.constructor,c=typeof a=="function"&&a.prototype||Qi;return s===c}function pd(s){return s===s&&!Ht(s)}function gd(s,a){return function(c){return c==null?!1:c[s]===a&&(a!==r||s in Ft(c))}}function Ix(s){var a=To(s,function(p){return c.size===f&&c.clear(),p}),c=a.cache;return a}function Px(s,a){var c=s[1],p=a[1],_=c|p,T=_<(x|A|O),C=p==O&&c==E||p==O&&c==F&&s[7].length<=a[8]||p==(O|F)&&a[7].length<=a[8]&&c==E;if(!(T||C))return s;p&x&&(s[2]=a[2],_|=c&x?0:S);var P=a[3];if(P){var M=s[3];s[3]=M?Zf(M,P,a[4]):P,s[4]=M?Zr(s[3],d):a[4]}return P=a[5],P&&(M=s[5],s[5]=M?Jf(M,P,a[6]):P,s[6]=M?Zr(s[5],d):a[6]),P=a[7],P&&(s[7]=P),p&O&&(s[8]=s[8]==null?a[8]:_e(s[8],a[8])),s[9]==null&&(s[9]=a[9]),s[0]=a[0],s[1]=_,s}function Rx(s){var a=[];if(s!=null)for(var c in Ft(s))a.push(c);return a}function Mx(s){return qs.call(s)}function md(s,a,c){return a=ae(a===r?s.length-1:a,0),function(){for(var p=arguments,_=-1,T=ae(p.length-a,0),C=B(T);++_<T;)C[_]=p[a+_];_=-1;for(var P=B(a+1);++_<a;)P[_]=p[_];return P[a]=c(C),Me(s,this,P)}}function vd(s,a){return a.length<2?s:Ei(s,Ve(a,0,-1))}function Dx(s,a){for(var c=s.length,p=_e(a.length,c),_=Ae(s);p--;){var T=a[p];s[p]=kr(T,c)?_[T]:r}return s}function Kl(s,a){if(!(a==="constructor"&&typeof s[a]=="function")&&a!="__proto__")return s[a]}var _d=xd(Wf),as=jy||function(s,a){return fe.setTimeout(s,a)},Zl=xd(ex);function yd(s,a,c){var p=a+"";return Zl(s,Ex(p,Bx(xx(p),c)))}function xd(s){var a=0,c=0;return function(){var p=Zy(),_=W-(p-c);if(c=p,_>0){if(++a>=K)return arguments[0]}else a=0;return s.apply(r,arguments)}}function xo(s,a){var c=-1,p=s.length,_=p-1;for(a=a===r?p:a;++c<a;){var T=Bl(c,_),C=s[T];s[T]=s[c],s[c]=C}return s.length=a,s}var bd=Ix(function(s){var a=[];return s.charCodeAt(0)===46&&a.push(""),s.replace(w_,function(c,p,_,T){a.push(_?T.replace(R_,"$1"):p||c)}),a});function yr(s){if(typeof s=="string"||Oe(s))return s;var a=s+"";return a=="0"&&1/s==-j?"-0":a}function Ai(s){if(s!=null){try{return Ys.call(s)}catch{}try{return s+""}catch{}}return""}function Bx(s,a){return $e(Mt,function(c){var p="_."+c[0];a&c[1]&&!Hs(s,p)&&s.push(p)}),s.sort()}function wd(s){if(s instanceof bt)return s.clone();var a=new Xe(s.__wrapped__,s.__chain__);return a.__actions__=Ae(s.__actions__),a.__index__=s.__index__,a.__values__=s.__values__,a}function Ox(s,a,c){(c?we(s,a,c):a===r)?a=1:a=ae(gt(a),0);var p=s==null?0:s.length;if(!p||a<1)return[];for(var _=0,T=0,C=B(eo(p/a));_<p;)C[T++]=Ve(s,_,_+=a);return C}function Fx(s){for(var a=-1,c=s==null?0:s.length,p=0,_=[];++a<c;){var T=s[a];T&&(_[p++]=T)}return _}function Lx(){var s=arguments.length;if(!s)return[];for(var a=B(s-1),c=arguments[0],p=s;p--;)a[p-1]=arguments[p];return Kr(dt(c)?Ae(c):[c],de(a,1))}var Nx=_t(function(s,a){return Jt(s)?es(s,de(a,1,Jt,!0)):[]}),kx=_t(function(s,a){var c=je(a);return Jt(c)&&(c=r),Jt(s)?es(s,de(a,1,Jt,!0),ot(c,2)):[]}),Ux=_t(function(s,a){var c=je(a);return Jt(c)&&(c=r),Jt(s)?es(s,de(a,1,Jt,!0),r,c):[]});function Gx(s,a,c){var p=s==null?0:s.length;return p?(a=c||a===r?1:gt(a),Ve(s,a<0?0:a,p)):[]}function Wx(s,a,c){var p=s==null?0:s.length;return p?(a=c||a===r?1:gt(a),a=p-a,Ve(s,0,a<0?0:a)):[]}function $x(s,a){return s&&s.length?co(s,ot(a,3),!0,!0):[]}function Hx(s,a){return s&&s.length?co(s,ot(a,3),!0):[]}function Xx(s,a,c,p){var _=s==null?0:s.length;return _?(c&&typeof c!="number"&&we(s,a,c)&&(c=0,p=_),L0(s,a,c,p)):[]}function Ed(s,a,c){var p=s==null?0:s.length;if(!p)return-1;var _=c==null?0:gt(c);return _<0&&(_=ae(p+_,0)),Xs(s,ot(a,3),_)}function Td(s,a,c){var p=s==null?0:s.length;if(!p)return-1;var _=p-1;return c!==r&&(_=gt(c),_=c<0?ae(p+_,0):_e(_,p-1)),Xs(s,ot(a,3),_,!0)}function Ad(s){var a=s==null?0:s.length;return a?de(s,1):[]}function zx(s){var a=s==null?0:s.length;return a?de(s,j):[]}function Vx(s,a){var c=s==null?0:s.length;return c?(a=a===r?1:gt(a),de(s,a)):[]}function jx(s){for(var a=-1,c=s==null?0:s.length,p={};++a<c;){var _=s[a];p[_[0]]=_[1]}return p}function Sd(s){return s&&s.length?s[0]:r}function Yx(s,a,c){var p=s==null?0:s.length;if(!p)return-1;var _=c==null?0:gt(c);return _<0&&(_=ae(p+_,0)),qi(s,a,_)}function qx(s){var a=s==null?0:s.length;return a?Ve(s,0,-1):[]}var Kx=_t(function(s){var a=Wt(s,kl);return a.length&&a[0]===s[0]?Il(a):[]}),Zx=_t(function(s){var a=je(s),c=Wt(s,kl);return a===je(c)?a=r:c.pop(),c.length&&c[0]===s[0]?Il(c,ot(a,2)):[]}),Jx=_t(function(s){var a=je(s),c=Wt(s,kl);return a=typeof a=="function"?a:r,a&&c.pop(),c.length&&c[0]===s[0]?Il(c,r,a):[]});function Qx(s,a){return s==null?"":qy.call(s,a)}function je(s){var a=s==null?0:s.length;return a?s[a-1]:r}function tb(s,a,c){var p=s==null?0:s.length;if(!p)return-1;var _=p;return c!==r&&(_=gt(c),_=_<0?ae(p+_,0):_e(_,p-1)),a===a?By(s,a,_):Xs(s,of,_,!0)}function eb(s,a){return s&&s.length?Nf(s,gt(a)):r}var rb=_t(Cd);function Cd(s,a){return s&&s.length&&a&&a.length?Dl(s,a):s}function ib(s,a,c){return s&&s.length&&a&&a.length?Dl(s,a,ot(c,2)):s}function nb(s,a,c){return s&&s.length&&a&&a.length?Dl(s,a,r,c):s}var sb=Nr(function(s,a){var c=s==null?0:s.length,p=Tl(s,a);return Gf(s,Wt(a,function(_){return kr(_,c)?+_:_}).sort(Kf)),p});function ob(s,a){var c=[];if(!(s&&s.length))return c;var p=-1,_=[],T=s.length;for(a=ot(a,3);++p<T;){var C=s[p];a(C,p,s)&&(c.push(C),_.push(p))}return Gf(s,_),c}function Jl(s){return s==null?s:Qy.call(s)}function ab(s,a,c){var p=s==null?0:s.length;return p?(c&&typeof c!="number"&&we(s,a,c)?(a=0,c=p):(a=a==null?0:gt(a),c=c===r?p:gt(c)),Ve(s,a,c)):[]}function lb(s,a){return uo(s,a)}function hb(s,a,c){return Fl(s,a,ot(c,2))}function ub(s,a){var c=s==null?0:s.length;if(c){var p=uo(s,a);if(p<c&&er(s[p],a))return p}return-1}function cb(s,a){return uo(s,a,!0)}function fb(s,a,c){return Fl(s,a,ot(c,2),!0)}function db(s,a){var c=s==null?0:s.length;if(c){var p=uo(s,a,!0)-1;if(er(s[p],a))return p}return-1}function pb(s){return s&&s.length?$f(s):[]}function gb(s,a){return s&&s.length?$f(s,ot(a,2)):[]}function mb(s){var a=s==null?0:s.length;return a?Ve(s,1,a):[]}function vb(s,a,c){return s&&s.length?(a=c||a===r?1:gt(a),Ve(s,0,a<0?0:a)):[]}function _b(s,a,c){var p=s==null?0:s.length;return p?(a=c||a===r?1:gt(a),a=p-a,Ve(s,a<0?0:a,p)):[]}function yb(s,a){return s&&s.length?co(s,ot(a,3),!1,!0):[]}function xb(s,a){return s&&s.length?co(s,ot(a,3)):[]}var bb=_t(function(s){return ti(de(s,1,Jt,!0))}),wb=_t(function(s){var a=je(s);return Jt(a)&&(a=r),ti(de(s,1,Jt,!0),ot(a,2))}),Eb=_t(function(s){var a=je(s);return a=typeof a=="function"?a:r,ti(de(s,1,Jt,!0),r,a)});function Tb(s){return s&&s.length?ti(s):[]}function Ab(s,a){return s&&s.length?ti(s,ot(a,2)):[]}function Sb(s,a){return a=typeof a=="function"?a:r,s&&s.length?ti(s,r,a):[]}function Ql(s){if(!(s&&s.length))return[];var a=0;return s=qr(s,function(c){if(Jt(c))return a=ae(c.length,a),!0}),ml(a,function(c){return Wt(s,dl(c))})}function Id(s,a){if(!(s&&s.length))return[];var c=Ql(s);return a==null?c:Wt(c,function(p){return Me(a,r,p)})}var Cb=_t(function(s,a){return Jt(s)?es(s,a):[]}),Ib=_t(function(s){return Nl(qr(s,Jt))}),Pb=_t(function(s){var a=je(s);return Jt(a)&&(a=r),Nl(qr(s,Jt),ot(a,2))}),Rb=_t(function(s){var a=je(s);return a=typeof a=="function"?a:r,Nl(qr(s,Jt),r,a)}),Mb=_t(Ql);function Db(s,a){return Vf(s||[],a||[],ts)}function Bb(s,a){return Vf(s||[],a||[],ns)}var Ob=_t(function(s){var a=s.length,c=a>1?s[a-1]:r;return c=typeof c=="function"?(s.pop(),c):r,Id(s,c)});function Pd(s){var a=b(s);return a.__chain__=!0,a}function Fb(s,a){return a(s),s}function bo(s,a){return a(s)}var Lb=Nr(function(s){var a=s.length,c=a?s[0]:0,p=this.__wrapped__,_=function(T){return Tl(T,s)};return a>1||this.__actions__.length||!(p instanceof bt)||!kr(c)?this.thru(_):(p=p.slice(c,+c+(a?1:0)),p.__actions__.push({func:bo,args:[_],thisArg:r}),new Xe(p,this.__chain__).thru(function(T){return a&&!T.length&&T.push(r),T}))});function Nb(){return Pd(this)}function kb(){return new Xe(this.value(),this.__chain__)}function Ub(){this.__values__===r&&(this.__values__=Hd(this.value()));var s=this.__index__>=this.__values__.length,a=s?r:this.__values__[this.__index__++];return{done:s,value:a}}function Gb(){return this}function Wb(s){for(var a,c=this;c instanceof so;){var p=wd(c);p.__index__=0,p.__values__=r,a?_.__wrapped__=p:a=p;var _=p;c=c.__wrapped__}return _.__wrapped__=s,a}function $b(){var s=this.__wrapped__;if(s instanceof bt){var a=s;return this.__actions__.length&&(a=new bt(this)),a=a.reverse(),a.__actions__.push({func:bo,args:[Jl],thisArg:r}),new Xe(a,this.__chain__)}return this.thru(Jl)}function Hb(){return zf(this.__wrapped__,this.__actions__)}var Xb=fo(function(s,a,c){Bt.call(s,c)?++s[c]:Fr(s,c,1)});function zb(s,a,c){var p=dt(s)?nf:F0;return c&&we(s,a,c)&&(a=r),p(s,ot(a,3))}function Vb(s,a){var c=dt(s)?qr:If;return c(s,ot(a,3))}var jb=rd(Ed),Yb=rd(Td);function qb(s,a){return de(wo(s,a),1)}function Kb(s,a){return de(wo(s,a),j)}function Zb(s,a,c){return c=c===r?1:gt(c),de(wo(s,a),c)}function Rd(s,a){var c=dt(s)?$e:Qr;return c(s,ot(a,3))}function Md(s,a){var c=dt(s)?my:Cf;return c(s,ot(a,3))}var Jb=fo(function(s,a,c){Bt.call(s,c)?s[c].push(a):Fr(s,c,[a])});function Qb(s,a,c,p){s=Se(s)?s:ln(s),c=c&&!p?gt(c):0;var _=s.length;return c<0&&(c=ae(_+c,0)),Co(s)?c<=_&&s.indexOf(a,c)>-1:!!_&&qi(s,a,c)>-1}var t1=_t(function(s,a,c){var p=-1,_=typeof a=="function",T=Se(s)?B(s.length):[];return Qr(s,function(C){T[++p]=_?Me(a,C,c):rs(C,a,c)}),T}),e1=fo(function(s,a,c){Fr(s,c,a)});function wo(s,a){var c=dt(s)?Wt:Of;return c(s,ot(a,3))}function r1(s,a,c,p){return s==null?[]:(dt(a)||(a=a==null?[]:[a]),c=p?r:c,dt(c)||(c=c==null?[]:[c]),kf(s,a,c))}var i1=fo(function(s,a,c){s[c?0:1].push(a)},function(){return[[],[]]});function n1(s,a,c){var p=dt(s)?cl:lf,_=arguments.length<3;return p(s,ot(a,4),c,_,Qr)}function s1(s,a,c){var p=dt(s)?vy:lf,_=arguments.length<3;return p(s,ot(a,4),c,_,Cf)}function o1(s,a){var c=dt(s)?qr:If;return c(s,Ao(ot(a,3)))}function a1(s){var a=dt(s)?Ef:Q0;return a(s)}function l1(s,a,c){(c?we(s,a,c):a===r)?a=1:a=gt(a);var p=dt(s)?R0:tx;return p(s,a)}function h1(s){var a=dt(s)?M0:rx;return a(s)}function u1(s){if(s==null)return 0;if(Se(s))return Co(s)?Zi(s):s.length;var a=ye(s);return a==qt||a==Je?s.size:Rl(s).length}function c1(s,a,c){var p=dt(s)?fl:ix;return c&&we(s,a,c)&&(a=r),p(s,ot(a,3))}var f1=_t(function(s,a){if(s==null)return[];var c=a.length;return c>1&&we(s,a[0],a[1])?a=[]:c>2&&we(a[0],a[1],a[2])&&(a=[a[0]]),kf(s,de(a,1),[])}),Eo=Vy||function(){return fe.Date.now()};function d1(s,a){if(typeof a!="function")throw new He(l);return s=gt(s),function(){if(--s<1)return a.apply(this,arguments)}}function Dd(s,a,c){return a=c?r:a,a=s&&a==null?s.length:a,Lr(s,O,r,r,r,r,a)}function Bd(s,a){var c;if(typeof a!="function")throw new He(l);return s=gt(s),function(){return--s>0&&(c=a.apply(this,arguments)),s<=1&&(a=r),c}}var th=_t(function(s,a,c){var p=x;if(c.length){var _=Zr(c,on(th));p|=D}return Lr(s,p,a,c,_)}),Od=_t(function(s,a,c){var p=x|A;if(c.length){var _=Zr(c,on(Od));p|=D}return Lr(a,p,s,c,_)});function Fd(s,a,c){a=c?r:a;var p=Lr(s,E,r,r,r,r,r,a);return p.placeholder=Fd.placeholder,p}function Ld(s,a,c){a=c?r:a;var p=Lr(s,I,r,r,r,r,r,a);return p.placeholder=Ld.placeholder,p}function Nd(s,a,c){var p,_,T,C,P,M,U=0,G=!1,$=!1,q=!0;if(typeof s!="function")throw new He(l);a=Ye(a)||0,Ht(c)&&(G=!!c.leading,$="maxWait"in c,T=$?ae(Ye(c.maxWait)||0,a):T,q="trailing"in c?!!c.trailing:q);function tt(Qt){var rr=p,Wr=_;return p=_=r,U=Qt,C=s.apply(Wr,rr),C}function lt(Qt){return U=Qt,P=as(yt,a),G?tt(Qt):C}function mt(Qt){var rr=Qt-M,Wr=Qt-U,rp=a-rr;return $?_e(rp,T-Wr):rp}function ht(Qt){var rr=Qt-M,Wr=Qt-U;return M===r||rr>=a||rr<0||$&&Wr>=T}function yt(){var Qt=Eo();if(ht(Qt))return Tt(Qt);P=as(yt,mt(Qt))}function Tt(Qt){return P=r,q&&p?tt(Qt):(p=_=r,C)}function Fe(){P!==r&&jf(P),U=0,p=M=_=P=r}function Ee(){return P===r?C:Tt(Eo())}function Le(){var Qt=Eo(),rr=ht(Qt);if(p=arguments,_=this,M=Qt,rr){if(P===r)return lt(M);if($)return jf(P),P=as(yt,a),tt(M)}return P===r&&(P=as(yt,a)),C}return Le.cancel=Fe,Le.flush=Ee,Le}var p1=_t(function(s,a){return Sf(s,1,a)}),g1=_t(function(s,a,c){return Sf(s,Ye(a)||0,c)});function m1(s){return Lr(s,X)}function To(s,a){if(typeof s!="function"||a!=null&&typeof a!="function")throw new He(l);var c=function(){var p=arguments,_=a?a.apply(this,p):p[0],T=c.cache;if(T.has(_))return T.get(_);var C=s.apply(this,p);return c.cache=T.set(_,C)||T,C};return c.cache=new(To.Cache||Or),c}To.Cache=Or;function Ao(s){if(typeof s!="function")throw new He(l);return function(){var a=arguments;switch(a.length){case 0:return!s.call(this);case 1:return!s.call(this,a[0]);case 2:return!s.call(this,a[0],a[1]);case 3:return!s.call(this,a[0],a[1],a[2])}return!s.apply(this,a)}}function v1(s){return Bd(2,s)}var _1=nx(function(s,a){a=a.length==1&&dt(a[0])?Wt(a[0],De(ot())):Wt(de(a,1),De(ot()));var c=a.length;return _t(function(p){for(var _=-1,T=_e(p.length,c);++_<T;)p[_]=a[_].call(this,p[_]);return Me(s,this,p)})}),eh=_t(function(s,a){var c=Zr(a,on(eh));return Lr(s,D,r,a,c)}),kd=_t(function(s,a){var c=Zr(a,on(kd));return Lr(s,L,r,a,c)}),y1=Nr(function(s,a){return Lr(s,F,r,r,r,a)});function x1(s,a){if(typeof s!="function")throw new He(l);return a=a===r?a:gt(a),_t(s,a)}function b1(s,a){if(typeof s!="function")throw new He(l);return a=a==null?0:ae(gt(a),0),_t(function(c){var p=c[a],_=ri(c,0,a);return p&&Kr(_,p),Me(s,this,_)})}function w1(s,a,c){var p=!0,_=!0;if(typeof s!="function")throw new He(l);return Ht(c)&&(p="leading"in c?!!c.leading:p,_="trailing"in c?!!c.trailing:_),Nd(s,a,{leading:p,maxWait:a,trailing:_})}function E1(s){return Dd(s,1)}function T1(s,a){return eh(Ul(a),s)}function A1(){if(!arguments.length)return[];var s=arguments[0];return dt(s)?s:[s]}function S1(s){return ze(s,v)}function C1(s,a){return a=typeof a=="function"?a:r,ze(s,v,a)}function I1(s){return ze(s,g|v)}function P1(s,a){return a=typeof a=="function"?a:r,ze(s,g|v,a)}function R1(s,a){return a==null||Af(s,a,ue(a))}function er(s,a){return s===a||s!==s&&a!==a}var M1=vo(Cl),D1=vo(function(s,a){return s>=a}),Si=Mf(function(){return arguments}())?Mf:function(s){return Kt(s)&&Bt.call(s,"callee")&&!vf.call(s,"callee")},dt=B.isArray,B1=Zc?De(Zc):W0;function Se(s){return s!=null&&So(s.length)&&!Ur(s)}function Jt(s){return Kt(s)&&Se(s)}function O1(s){return s===!0||s===!1||Kt(s)&&be(s)==jt}var ii=Yy||fh,F1=Jc?De(Jc):$0;function L1(s){return Kt(s)&&s.nodeType===1&&!ls(s)}function N1(s){if(s==null)return!0;if(Se(s)&&(dt(s)||typeof s=="string"||typeof s.splice=="function"||ii(s)||an(s)||Si(s)))return!s.length;var a=ye(s);if(a==qt||a==Je)return!s.size;if(os(s))return!Rl(s).length;for(var c in s)if(Bt.call(s,c))return!1;return!0}function k1(s,a){return is(s,a)}function U1(s,a,c){c=typeof c=="function"?c:r;var p=c?c(s,a):r;return p===r?is(s,a,r,c):!!p}function rh(s){if(!Kt(s))return!1;var a=be(s);return a==Dt||a==se||typeof s.message=="string"&&typeof s.name=="string"&&!ls(s)}function G1(s){return typeof s=="number"&&yf(s)}function Ur(s){if(!Ht(s))return!1;var a=be(s);return a==Ut||a==Yt||a==re||a==u_}function Ud(s){return typeof s=="number"&&s==gt(s)}function So(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=vt}function Ht(s){var a=typeof s;return s!=null&&(a=="object"||a=="function")}function Kt(s){return s!=null&&typeof s=="object"}var Gd=Qc?De(Qc):X0;function W1(s,a){return s===a||Pl(s,a,Vl(a))}function $1(s,a,c){return c=typeof c=="function"?c:r,Pl(s,a,Vl(a),c)}function H1(s){return Wd(s)&&s!=+s}function X1(s){if(Cx(s))throw new ct(o);return Df(s)}function z1(s){return s===null}function V1(s){return s==null}function Wd(s){return typeof s=="number"||Kt(s)&&be(s)==ve}function ls(s){if(!Kt(s)||be(s)!=mr)return!1;var a=Js(s);if(a===null)return!0;var c=Bt.call(a,"constructor")&&a.constructor;return typeof c=="function"&&c instanceof c&&Ys.call(c)==$y}var ih=tf?De(tf):z0;function j1(s){return Ud(s)&&s>=-vt&&s<=vt}var $d=ef?De(ef):V0;function Co(s){return typeof s=="string"||!dt(s)&&Kt(s)&&be(s)==zn}function Oe(s){return typeof s=="symbol"||Kt(s)&&be(s)==Us}var an=rf?De(rf):j0;function Y1(s){return s===r}function q1(s){return Kt(s)&&ye(s)==Vn}function K1(s){return Kt(s)&&be(s)==f_}var Z1=vo(Ml),J1=vo(function(s,a){return s<=a});function Hd(s){if(!s)return[];if(Se(s))return Co(s)?Qe(s):Ae(s);if(qn&&s[qn])return Ry(s[qn]());var a=ye(s),c=a==qt?_l:a==Je?zs:ln;return c(s)}function Gr(s){if(!s)return s===0?s:0;if(s=Ye(s),s===j||s===-j){var a=s<0?-1:1;return a*Ot}return s===s?s:0}function gt(s){var a=Gr(s),c=a%1;return a===a?c?a-c:a:0}function Xd(s){return s?wi(gt(s),0,rt):0}function Ye(s){if(typeof s=="number")return s;if(Oe(s))return H;if(Ht(s)){var a=typeof s.valueOf=="function"?s.valueOf():s;s=Ht(a)?a+"":a}if(typeof s!="string")return s===0?s:+s;s=hf(s);var c=B_.test(s);return c||F_.test(s)?dy(s.slice(2),c?2:8):D_.test(s)?H:+s}function zd(s){return _r(s,Ce(s))}function Q1(s){return s?wi(gt(s),-vt,vt):s===0?s:0}function Rt(s){return s==null?"":Be(s)}var tw=nn(function(s,a){if(os(a)||Se(a)){_r(a,ue(a),s);return}for(var c in a)Bt.call(a,c)&&ts(s,c,a[c])}),Vd=nn(function(s,a){_r(a,Ce(a),s)}),Io=nn(function(s,a,c,p){_r(a,Ce(a),s,p)}),ew=nn(function(s,a,c,p){_r(a,ue(a),s,p)}),rw=Nr(Tl);function iw(s,a){var c=rn(s);return a==null?c:Tf(c,a)}var nw=_t(function(s,a){s=Ft(s);var c=-1,p=a.length,_=p>2?a[2]:r;for(_&&we(a[0],a[1],_)&&(p=1);++c<p;)for(var T=a[c],C=Ce(T),P=-1,M=C.length;++P<M;){var U=C[P],G=s[U];(G===r||er(G,Qi[U])&&!Bt.call(s,U))&&(s[U]=T[U])}return s}),sw=_t(function(s){return s.push(r,hd),Me(jd,r,s)});function ow(s,a){return sf(s,ot(a,3),vr)}function aw(s,a){return sf(s,ot(a,3),Sl)}function lw(s,a){return s==null?s:Al(s,ot(a,3),Ce)}function hw(s,a){return s==null?s:Pf(s,ot(a,3),Ce)}function uw(s,a){return s&&vr(s,ot(a,3))}function cw(s,a){return s&&Sl(s,ot(a,3))}function fw(s){return s==null?[]:lo(s,ue(s))}function dw(s){return s==null?[]:lo(s,Ce(s))}function nh(s,a,c){var p=s==null?r:Ei(s,a);return p===r?c:p}function pw(s,a){return s!=null&&fd(s,a,N0)}function sh(s,a){return s!=null&&fd(s,a,k0)}var gw=nd(function(s,a,c){a!=null&&typeof a.toString!="function"&&(a=qs.call(a)),s[a]=c},ah(Ie)),mw=nd(function(s,a,c){a!=null&&typeof a.toString!="function"&&(a=qs.call(a)),Bt.call(s,a)?s[a].push(c):s[a]=[c]},ot),vw=_t(rs);function ue(s){return Se(s)?wf(s):Rl(s)}function Ce(s){return Se(s)?wf(s,!0):Y0(s)}function _w(s,a){var c={};return a=ot(a,3),vr(s,function(p,_,T){Fr(c,a(p,_,T),p)}),c}function yw(s,a){var c={};return a=ot(a,3),vr(s,function(p,_,T){Fr(c,_,a(p,_,T))}),c}var xw=nn(function(s,a,c){ho(s,a,c)}),jd=nn(function(s,a,c,p){ho(s,a,c,p)}),bw=Nr(function(s,a){var c={};if(s==null)return c;var p=!1;a=Wt(a,function(T){return T=ei(T,s),p||(p=T.length>1),T}),_r(s,Xl(s),c),p&&(c=ze(c,g|m|v,gx));for(var _=a.length;_--;)Ll(c,a[_]);return c});function ww(s,a){return Yd(s,Ao(ot(a)))}var Ew=Nr(function(s,a){return s==null?{}:K0(s,a)});function Yd(s,a){if(s==null)return{};var c=Wt(Xl(s),function(p){return[p]});return a=ot(a),Uf(s,c,function(p,_){return a(p,_[0])})}function Tw(s,a,c){a=ei(a,s);var p=-1,_=a.length;for(_||(_=1,s=r);++p<_;){var T=s==null?r:s[yr(a[p])];T===r&&(p=_,T=c),s=Ur(T)?T.call(s):T}return s}function Aw(s,a,c){return s==null?s:ns(s,a,c)}function Sw(s,a,c,p){return p=typeof p=="function"?p:r,s==null?s:ns(s,a,c,p)}var qd=ad(ue),Kd=ad(Ce);function Cw(s,a,c){var p=dt(s),_=p||ii(s)||an(s);if(a=ot(a,4),c==null){var T=s&&s.constructor;_?c=p?new T:[]:Ht(s)?c=Ur(T)?rn(Js(s)):{}:c={}}return(_?$e:vr)(s,function(C,P,M){return a(c,C,P,M)}),c}function Iw(s,a){return s==null?!0:Ll(s,a)}function Pw(s,a,c){return s==null?s:Xf(s,a,Ul(c))}function Rw(s,a,c,p){return p=typeof p=="function"?p:r,s==null?s:Xf(s,a,Ul(c),p)}function ln(s){return s==null?[]:vl(s,ue(s))}function Mw(s){return s==null?[]:vl(s,Ce(s))}function Dw(s,a,c){return c===r&&(c=a,a=r),c!==r&&(c=Ye(c),c=c===c?c:0),a!==r&&(a=Ye(a),a=a===a?a:0),wi(Ye(s),a,c)}function Bw(s,a,c){return a=Gr(a),c===r?(c=a,a=0):c=Gr(c),s=Ye(s),U0(s,a,c)}function Ow(s,a,c){if(c&&typeof c!="boolean"&&we(s,a,c)&&(a=c=r),c===r&&(typeof a=="boolean"?(c=a,a=r):typeof s=="boolean"&&(c=s,s=r)),s===r&&a===r?(s=0,a=1):(s=Gr(s),a===r?(a=s,s=0):a=Gr(a)),s>a){var p=s;s=a,a=p}if(c||s%1||a%1){var _=xf();return _e(s+_*(a-s+fy("1e-"+((_+"").length-1))),a)}return Bl(s,a)}var Fw=sn(function(s,a,c){return a=a.toLowerCase(),s+(c?Zd(a):a)});function Zd(s){return oh(Rt(s).toLowerCase())}function Jd(s){return s=Rt(s),s&&s.replace(N_,Ay).replace(ry,"")}function Lw(s,a,c){s=Rt(s),a=Be(a);var p=s.length;c=c===r?p:wi(gt(c),0,p);var _=c;return c-=a.length,c>=0&&s.slice(c,_)==a}function Nw(s){return s=Rt(s),s&&v_.test(s)?s.replace(Ic,Sy):s}function kw(s){return s=Rt(s),s&&E_.test(s)?s.replace(el,"\\$&"):s}var Uw=sn(function(s,a,c){return s+(c?"-":"")+a.toLowerCase()}),Gw=sn(function(s,a,c){return s+(c?" ":"")+a.toLowerCase()}),Ww=ed("toLowerCase");function $w(s,a,c){s=Rt(s),a=gt(a);var p=a?Zi(s):0;if(!a||p>=a)return s;var _=(a-p)/2;return mo(ro(_),c)+s+mo(eo(_),c)}function Hw(s,a,c){s=Rt(s),a=gt(a);var p=a?Zi(s):0;return a&&p<a?s+mo(a-p,c):s}function Xw(s,a,c){s=Rt(s),a=gt(a);var p=a?Zi(s):0;return a&&p<a?mo(a-p,c)+s:s}function zw(s,a,c){return c||a==null?a=0:a&&(a=+a),Jy(Rt(s).replace(rl,""),a||0)}function Vw(s,a,c){return(c?we(s,a,c):a===r)?a=1:a=gt(a),Ol(Rt(s),a)}function jw(){var s=arguments,a=Rt(s[0]);return s.length<3?a:a.replace(s[1],s[2])}var Yw=sn(function(s,a,c){return s+(c?"_":"")+a.toLowerCase()});function qw(s,a,c){return c&&typeof c!="number"&&we(s,a,c)&&(a=c=r),c=c===r?rt:c>>>0,c?(s=Rt(s),s&&(typeof a=="string"||a!=null&&!ih(a))&&(a=Be(a),!a&&Ki(s))?ri(Qe(s),0,c):s.split(a,c)):[]}var Kw=sn(function(s,a,c){return s+(c?" ":"")+oh(a)});function Zw(s,a,c){return s=Rt(s),c=c==null?0:wi(gt(c),0,s.length),a=Be(a),s.slice(c,c+a.length)==a}function Jw(s,a,c){var p=b.templateSettings;c&&we(s,a,c)&&(a=r),s=Rt(s),a=Io({},a,p,ld);var _=Io({},a.imports,p.imports,ld),T=ue(_),C=vl(_,T),P,M,U=0,G=a.interpolate||Gs,$="__p += '",q=yl((a.escape||Gs).source+"|"+G.source+"|"+(G===Pc?M_:Gs).source+"|"+(a.evaluate||Gs).source+"|$","g"),tt="//# sourceURL="+(Bt.call(a,"sourceURL")?(a.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ay+"]")+`
`;s.replace(q,function(ht,yt,Tt,Fe,Ee,Le){return Tt||(Tt=Fe),$+=s.slice(U,Le).replace(k_,Cy),yt&&(P=!0,$+=`' +
__e(`+yt+`) +
'`),Ee&&(M=!0,$+=`';
`+Ee+`;
__p += '`),Tt&&($+=`' +
((__t = (`+Tt+`)) == null ? '' : __t) +
'`),U=Le+ht.length,ht}),$+=`';
`;var lt=Bt.call(a,"variable")&&a.variable;if(!lt)$=`with (obj) {
`+$+`
}
`;else if(P_.test(lt))throw new ct(h);$=(M?$.replace(d_,""):$).replace(p_,"$1").replace(g_,"$1;"),$="function("+(lt||"obj")+`) {
`+(lt?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(P?", __e = _.escape":"")+(M?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+$+`return __p
}`;var mt=tp(function(){return It(T,tt+"return "+$).apply(r,C)});if(mt.source=$,rh(mt))throw mt;return mt}function Qw(s){return Rt(s).toLowerCase()}function tE(s){return Rt(s).toUpperCase()}function eE(s,a,c){if(s=Rt(s),s&&(c||a===r))return hf(s);if(!s||!(a=Be(a)))return s;var p=Qe(s),_=Qe(a),T=uf(p,_),C=cf(p,_)+1;return ri(p,T,C).join("")}function rE(s,a,c){if(s=Rt(s),s&&(c||a===r))return s.slice(0,df(s)+1);if(!s||!(a=Be(a)))return s;var p=Qe(s),_=cf(p,Qe(a))+1;return ri(p,0,_).join("")}function iE(s,a,c){if(s=Rt(s),s&&(c||a===r))return s.replace(rl,"");if(!s||!(a=Be(a)))return s;var p=Qe(s),_=uf(p,Qe(a));return ri(p,_).join("")}function nE(s,a){var c=Y,p=z;if(Ht(a)){var _="separator"in a?a.separator:_;c="length"in a?gt(a.length):c,p="omission"in a?Be(a.omission):p}s=Rt(s);var T=s.length;if(Ki(s)){var C=Qe(s);T=C.length}if(c>=T)return s;var P=c-Zi(p);if(P<1)return p;var M=C?ri(C,0,P).join(""):s.slice(0,P);if(_===r)return M+p;if(C&&(P+=M.length-P),ih(_)){if(s.slice(P).search(_)){var U,G=M;for(_.global||(_=yl(_.source,Rt(Rc.exec(_))+"g")),_.lastIndex=0;U=_.exec(G);)var $=U.index;M=M.slice(0,$===r?P:$)}}else if(s.indexOf(Be(_),P)!=P){var q=M.lastIndexOf(_);q>-1&&(M=M.slice(0,q))}return M+p}function sE(s){return s=Rt(s),s&&m_.test(s)?s.replace(Cc,Oy):s}var oE=sn(function(s,a,c){return s+(c?" ":"")+a.toUpperCase()}),oh=ed("toUpperCase");function Qd(s,a,c){return s=Rt(s),a=c?r:a,a===r?Py(s)?Ny(s):xy(s):s.match(a)||[]}var tp=_t(function(s,a){try{return Me(s,r,a)}catch(c){return rh(c)?c:new ct(c)}}),aE=Nr(function(s,a){return $e(a,function(c){c=yr(c),Fr(s,c,th(s[c],s))}),s});function lE(s){var a=s==null?0:s.length,c=ot();return s=a?Wt(s,function(p){if(typeof p[1]!="function")throw new He(l);return[c(p[0]),p[1]]}):[],_t(function(p){for(var _=-1;++_<a;){var T=s[_];if(Me(T[0],this,p))return Me(T[1],this,p)}})}function hE(s){return O0(ze(s,g))}function ah(s){return function(){return s}}function uE(s,a){return s==null||s!==s?a:s}var cE=id(),fE=id(!0);function Ie(s){return s}function lh(s){return Bf(typeof s=="function"?s:ze(s,g))}function dE(s){return Ff(ze(s,g))}function pE(s,a){return Lf(s,ze(a,g))}var gE=_t(function(s,a){return function(c){return rs(c,s,a)}}),mE=_t(function(s,a){return function(c){return rs(s,c,a)}});function hh(s,a,c){var p=ue(a),_=lo(a,p);c==null&&!(Ht(a)&&(_.length||!p.length))&&(c=a,a=s,s=this,_=lo(a,ue(a)));var T=!(Ht(c)&&"chain"in c)||!!c.chain,C=Ur(s);return $e(_,function(P){var M=a[P];s[P]=M,C&&(s.prototype[P]=function(){var U=this.__chain__;if(T||U){var G=s(this.__wrapped__),$=G.__actions__=Ae(this.__actions__);return $.push({func:M,args:arguments,thisArg:s}),G.__chain__=U,G}return M.apply(s,Kr([this.value()],arguments))})}),s}function vE(){return fe._===this&&(fe._=Hy),this}function uh(){}function _E(s){return s=gt(s),_t(function(a){return Nf(a,s)})}var yE=Wl(Wt),xE=Wl(nf),bE=Wl(fl);function ep(s){return Yl(s)?dl(yr(s)):Z0(s)}function wE(s){return function(a){return s==null?r:Ei(s,a)}}var EE=sd(),TE=sd(!0);function ch(){return[]}function fh(){return!1}function AE(){return{}}function SE(){return""}function CE(){return!0}function IE(s,a){if(s=gt(s),s<1||s>vt)return[];var c=rt,p=_e(s,rt);a=ot(a),s-=rt;for(var _=ml(p,a);++c<s;)a(c);return _}function PE(s){return dt(s)?Wt(s,yr):Oe(s)?[s]:Ae(bd(Rt(s)))}function RE(s){var a=++Wy;return Rt(s)+a}var ME=go(function(s,a){return s+a},0),DE=$l("ceil"),BE=go(function(s,a){return s/a},1),OE=$l("floor");function FE(s){return s&&s.length?ao(s,Ie,Cl):r}function LE(s,a){return s&&s.length?ao(s,ot(a,2),Cl):r}function NE(s){return af(s,Ie)}function kE(s,a){return af(s,ot(a,2))}function UE(s){return s&&s.length?ao(s,Ie,Ml):r}function GE(s,a){return s&&s.length?ao(s,ot(a,2),Ml):r}var WE=go(function(s,a){return s*a},1),$E=$l("round"),HE=go(function(s,a){return s-a},0);function XE(s){return s&&s.length?gl(s,Ie):0}function zE(s,a){return s&&s.length?gl(s,ot(a,2)):0}return b.after=d1,b.ary=Dd,b.assign=tw,b.assignIn=Vd,b.assignInWith=Io,b.assignWith=ew,b.at=rw,b.before=Bd,b.bind=th,b.bindAll=aE,b.bindKey=Od,b.castArray=A1,b.chain=Pd,b.chunk=Ox,b.compact=Fx,b.concat=Lx,b.cond=lE,b.conforms=hE,b.constant=ah,b.countBy=Xb,b.create=iw,b.curry=Fd,b.curryRight=Ld,b.debounce=Nd,b.defaults=nw,b.defaultsDeep=sw,b.defer=p1,b.delay=g1,b.difference=Nx,b.differenceBy=kx,b.differenceWith=Ux,b.drop=Gx,b.dropRight=Wx,b.dropRightWhile=$x,b.dropWhile=Hx,b.fill=Xx,b.filter=Vb,b.flatMap=qb,b.flatMapDeep=Kb,b.flatMapDepth=Zb,b.flatten=Ad,b.flattenDeep=zx,b.flattenDepth=Vx,b.flip=m1,b.flow=cE,b.flowRight=fE,b.fromPairs=jx,b.functions=fw,b.functionsIn=dw,b.groupBy=Jb,b.initial=qx,b.intersection=Kx,b.intersectionBy=Zx,b.intersectionWith=Jx,b.invert=gw,b.invertBy=mw,b.invokeMap=t1,b.iteratee=lh,b.keyBy=e1,b.keys=ue,b.keysIn=Ce,b.map=wo,b.mapKeys=_w,b.mapValues=yw,b.matches=dE,b.matchesProperty=pE,b.memoize=To,b.merge=xw,b.mergeWith=jd,b.method=gE,b.methodOf=mE,b.mixin=hh,b.negate=Ao,b.nthArg=_E,b.omit=bw,b.omitBy=ww,b.once=v1,b.orderBy=r1,b.over=yE,b.overArgs=_1,b.overEvery=xE,b.overSome=bE,b.partial=eh,b.partialRight=kd,b.partition=i1,b.pick=Ew,b.pickBy=Yd,b.property=ep,b.propertyOf=wE,b.pull=rb,b.pullAll=Cd,b.pullAllBy=ib,b.pullAllWith=nb,b.pullAt=sb,b.range=EE,b.rangeRight=TE,b.rearg=y1,b.reject=o1,b.remove=ob,b.rest=x1,b.reverse=Jl,b.sampleSize=l1,b.set=Aw,b.setWith=Sw,b.shuffle=h1,b.slice=ab,b.sortBy=f1,b.sortedUniq=pb,b.sortedUniqBy=gb,b.split=qw,b.spread=b1,b.tail=mb,b.take=vb,b.takeRight=_b,b.takeRightWhile=yb,b.takeWhile=xb,b.tap=Fb,b.throttle=w1,b.thru=bo,b.toArray=Hd,b.toPairs=qd,b.toPairsIn=Kd,b.toPath=PE,b.toPlainObject=zd,b.transform=Cw,b.unary=E1,b.union=bb,b.unionBy=wb,b.unionWith=Eb,b.uniq=Tb,b.uniqBy=Ab,b.uniqWith=Sb,b.unset=Iw,b.unzip=Ql,b.unzipWith=Id,b.update=Pw,b.updateWith=Rw,b.values=ln,b.valuesIn=Mw,b.without=Cb,b.words=Qd,b.wrap=T1,b.xor=Ib,b.xorBy=Pb,b.xorWith=Rb,b.zip=Mb,b.zipObject=Db,b.zipObjectDeep=Bb,b.zipWith=Ob,b.entries=qd,b.entriesIn=Kd,b.extend=Vd,b.extendWith=Io,hh(b,b),b.add=ME,b.attempt=tp,b.camelCase=Fw,b.capitalize=Zd,b.ceil=DE,b.clamp=Dw,b.clone=S1,b.cloneDeep=I1,b.cloneDeepWith=P1,b.cloneWith=C1,b.conformsTo=R1,b.deburr=Jd,b.defaultTo=uE,b.divide=BE,b.endsWith=Lw,b.eq=er,b.escape=Nw,b.escapeRegExp=kw,b.every=zb,b.find=jb,b.findIndex=Ed,b.findKey=ow,b.findLast=Yb,b.findLastIndex=Td,b.findLastKey=aw,b.floor=OE,b.forEach=Rd,b.forEachRight=Md,b.forIn=lw,b.forInRight=hw,b.forOwn=uw,b.forOwnRight=cw,b.get=nh,b.gt=M1,b.gte=D1,b.has=pw,b.hasIn=sh,b.head=Sd,b.identity=Ie,b.includes=Qb,b.indexOf=Yx,b.inRange=Bw,b.invoke=vw,b.isArguments=Si,b.isArray=dt,b.isArrayBuffer=B1,b.isArrayLike=Se,b.isArrayLikeObject=Jt,b.isBoolean=O1,b.isBuffer=ii,b.isDate=F1,b.isElement=L1,b.isEmpty=N1,b.isEqual=k1,b.isEqualWith=U1,b.isError=rh,b.isFinite=G1,b.isFunction=Ur,b.isInteger=Ud,b.isLength=So,b.isMap=Gd,b.isMatch=W1,b.isMatchWith=$1,b.isNaN=H1,b.isNative=X1,b.isNil=V1,b.isNull=z1,b.isNumber=Wd,b.isObject=Ht,b.isObjectLike=Kt,b.isPlainObject=ls,b.isRegExp=ih,b.isSafeInteger=j1,b.isSet=$d,b.isString=Co,b.isSymbol=Oe,b.isTypedArray=an,b.isUndefined=Y1,b.isWeakMap=q1,b.isWeakSet=K1,b.join=Qx,b.kebabCase=Uw,b.last=je,b.lastIndexOf=tb,b.lowerCase=Gw,b.lowerFirst=Ww,b.lt=Z1,b.lte=J1,b.max=FE,b.maxBy=LE,b.mean=NE,b.meanBy=kE,b.min=UE,b.minBy=GE,b.stubArray=ch,b.stubFalse=fh,b.stubObject=AE,b.stubString=SE,b.stubTrue=CE,b.multiply=WE,b.nth=eb,b.noConflict=vE,b.noop=uh,b.now=Eo,b.pad=$w,b.padEnd=Hw,b.padStart=Xw,b.parseInt=zw,b.random=Ow,b.reduce=n1,b.reduceRight=s1,b.repeat=Vw,b.replace=jw,b.result=Tw,b.round=$E,b.runInContext=R,b.sample=a1,b.size=u1,b.snakeCase=Yw,b.some=c1,b.sortedIndex=lb,b.sortedIndexBy=hb,b.sortedIndexOf=ub,b.sortedLastIndex=cb,b.sortedLastIndexBy=fb,b.sortedLastIndexOf=db,b.startCase=Kw,b.startsWith=Zw,b.subtract=HE,b.sum=XE,b.sumBy=zE,b.template=Jw,b.times=IE,b.toFinite=Gr,b.toInteger=gt,b.toLength=Xd,b.toLower=Qw,b.toNumber=Ye,b.toSafeInteger=Q1,b.toString=Rt,b.toUpper=tE,b.trim=eE,b.trimEnd=rE,b.trimStart=iE,b.truncate=nE,b.unescape=sE,b.uniqueId=RE,b.upperCase=oE,b.upperFirst=oh,b.each=Rd,b.eachRight=Md,b.first=Sd,hh(b,function(){var s={};return vr(b,function(a,c){Bt.call(b.prototype,c)||(s[c]=a)}),s}(),{chain:!1}),b.VERSION=i,$e(["bind","bindKey","curry","curryRight","partial","partialRight"],function(s){b[s].placeholder=b}),$e(["drop","take"],function(s,a){bt.prototype[s]=function(c){c=c===r?1:ae(gt(c),0);var p=this.__filtered__&&!a?new bt(this):this.clone();return p.__filtered__?p.__takeCount__=_e(c,p.__takeCount__):p.__views__.push({size:_e(c,rt),type:s+(p.__dir__<0?"Right":"")}),p},bt.prototype[s+"Right"]=function(c){return this.reverse()[s](c).reverse()}}),$e(["filter","map","takeWhile"],function(s,a){var c=a+1,p=c==k||c==ft;bt.prototype[s]=function(_){var T=this.clone();return T.__iteratees__.push({iteratee:ot(_,3),type:c}),T.__filtered__=T.__filtered__||p,T}}),$e(["head","last"],function(s,a){var c="take"+(a?"Right":"");bt.prototype[s]=function(){return this[c](1).value()[0]}}),$e(["initial","tail"],function(s,a){var c="drop"+(a?"":"Right");bt.prototype[s]=function(){return this.__filtered__?new bt(this):this[c](1)}}),bt.prototype.compact=function(){return this.filter(Ie)},bt.prototype.find=function(s){return this.filter(s).head()},bt.prototype.findLast=function(s){return this.reverse().find(s)},bt.prototype.invokeMap=_t(function(s,a){return typeof s=="function"?new bt(this):this.map(function(c){return rs(c,s,a)})}),bt.prototype.reject=function(s){return this.filter(Ao(ot(s)))},bt.prototype.slice=function(s,a){s=gt(s);var c=this;return c.__filtered__&&(s>0||a<0)?new bt(c):(s<0?c=c.takeRight(-s):s&&(c=c.drop(s)),a!==r&&(a=gt(a),c=a<0?c.dropRight(-a):c.take(a-s)),c)},bt.prototype.takeRightWhile=function(s){return this.reverse().takeWhile(s).reverse()},bt.prototype.toArray=function(){return this.take(rt)},vr(bt.prototype,function(s,a){var c=/^(?:filter|find|map|reject)|While$/.test(a),p=/^(?:head|last)$/.test(a),_=b[p?"take"+(a=="last"?"Right":""):a],T=p||/^find/.test(a);_&&(b.prototype[a]=function(){var C=this.__wrapped__,P=p?[1]:arguments,M=C instanceof bt,U=P[0],G=M||dt(C),$=function(yt){var Tt=_.apply(b,Kr([yt],P));return p&&q?Tt[0]:Tt};G&&c&&typeof U=="function"&&U.length!=1&&(M=G=!1);var q=this.__chain__,tt=!!this.__actions__.length,lt=T&&!q,mt=M&&!tt;if(!T&&G){C=mt?C:new bt(this);var ht=s.apply(C,P);return ht.__actions__.push({func:bo,args:[$],thisArg:r}),new Xe(ht,q)}return lt&&mt?s.apply(this,P):(ht=this.thru($),lt?p?ht.value()[0]:ht.value():ht)})}),$e(["pop","push","shift","sort","splice","unshift"],function(s){var a=Vs[s],c=/^(?:push|sort|unshift)$/.test(s)?"tap":"thru",p=/^(?:pop|shift)$/.test(s);b.prototype[s]=function(){var _=arguments;if(p&&!this.__chain__){var T=this.value();return a.apply(dt(T)?T:[],_)}return this[c](function(C){return a.apply(dt(C)?C:[],_)})}}),vr(bt.prototype,function(s,a){var c=b[a];if(c){var p=c.name+"";Bt.call(en,p)||(en[p]=[]),en[p].push({name:a,func:c})}}),en[po(r,A).name]=[{name:"wrapper",func:r}],bt.prototype.clone=s0,bt.prototype.reverse=o0,bt.prototype.value=a0,b.prototype.at=Lb,b.prototype.chain=Nb,b.prototype.commit=kb,b.prototype.next=Ub,b.prototype.plant=Wb,b.prototype.reverse=$b,b.prototype.toJSON=b.prototype.valueOf=b.prototype.value=Hb,b.prototype.first=b.prototype.head,qn&&(b.prototype[qn]=Gb),b},Ji=ky();_i?((_i.exports=Ji)._=Ji,ll._=Ji):fe._=Ji}).call(Sr)})(fa,fa.exports);var Cr=fa.exports;const Ci=Ba(Cr);var Vi=(e=>(e[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2",e))(Vi||{}),ou=(e=>(e[e.COLOR=16384]="COLOR",e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL",e))(ou||{}),ut=(e=>(e[e.NORMAL=0]="NORMAL",e[e.ADD=1]="ADD",e[e.MULTIPLY=2]="MULTIPLY",e[e.SCREEN=3]="SCREEN",e[e.OVERLAY=4]="OVERLAY",e[e.DARKEN=5]="DARKEN",e[e.LIGHTEN=6]="LIGHTEN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.COLOR_BURN=8]="COLOR_BURN",e[e.HARD_LIGHT=9]="HARD_LIGHT",e[e.SOFT_LIGHT=10]="SOFT_LIGHT",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.EXCLUSION=12]="EXCLUSION",e[e.HUE=13]="HUE",e[e.SATURATION=14]="SATURATION",e[e.COLOR=15]="COLOR",e[e.LUMINOSITY=16]="LUMINOSITY",e[e.NORMAL_NPM=17]="NORMAL_NPM",e[e.ADD_NPM=18]="ADD_NPM",e[e.SCREEN_NPM=19]="SCREEN_NPM",e[e.NONE=20]="NONE",e[e.SRC_OVER=0]="SRC_OVER",e[e.SRC_IN=21]="SRC_IN",e[e.SRC_OUT=22]="SRC_OUT",e[e.SRC_ATOP=23]="SRC_ATOP",e[e.DST_OVER=24]="DST_OVER",e[e.DST_IN=25]="DST_IN",e[e.DST_OUT=26]="DST_OUT",e[e.DST_ATOP=27]="DST_ATOP",e[e.ERASE=26]="ERASE",e[e.SUBTRACT=28]="SUBTRACT",e[e.XOR=29]="XOR",e))(ut||{}),Ir=(e=>(e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e))(Ir||{}),V=(e=>(e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e))(V||{}),En=(e=>(e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e))(En||{}),st=(e=>(e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT",e))(st||{}),au=(e=>(e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT",e[e.UINT=2]="UINT",e))(au||{}),Xr=(e=>(e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e))(Xr||{}),ui=(e=>(e[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e))(ui||{}),Mr=(e=>(e[e.OFF=0]="OFF",e[e.POW2=1]="POW2",e[e.ON=2]="ON",e[e.ON_MANUAL=3]="ON_MANUAL",e))(Mr||{}),gr=(e=>(e[e.NPM=0]="NPM",e[e.UNPACK=1]="UNPACK",e[e.PMA=2]="PMA",e[e.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",e[e.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",e[e.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",e))(gr||{}),Tr=(e=>(e[e.NO=0]="NO",e[e.YES=1]="YES",e[e.AUTO=2]="AUTO",e[e.BLEND=0]="BLEND",e[e.CLEAR=1]="CLEAR",e[e.BLIT=2]="BLIT",e))(Tr||{}),Zu=(e=>(e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL",e))(Zu||{}),Ke=(e=>(e.LOW="lowp",e.MEDIUM="mediump",e.HIGH="highp",e))(Ke||{}),he=(e=>(e[e.NONE=0]="NONE",e[e.SCISSOR=1]="SCISSOR",e[e.STENCIL=2]="STENCIL",e[e.SPRITE=3]="SPRITE",e[e.COLOR=4]="COLOR",e))(he||{}),ne=(e=>(e[e.NONE=0]="NONE",e[e.LOW=2]="LOW",e[e.MEDIUM=4]="MEDIUM",e[e.HIGH=8]="HIGH",e))(ne||{}),Pr=(e=>(e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e))(Pr||{});const qE={createCanvas:(e,t)=>{const r=document.createElement("canvas");return r.width=e,r.height=t,r},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(e,t)=>fetch(e,t),parseXML:e=>new DOMParser().parseFromString(e,"text/xml")},J={ADAPTER:qE,RESOLUTION:1,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,premultipliedAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1,hello:!1},CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var dh=/iPhone/i,ip=/iPod/i,np=/iPad/i,sp=/\biOS-universal(?:.+)Mac\b/i,ph=/\bAndroid(?:.+)Mobile\b/i,op=/Android/i,hn=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Po=/Silk/i,$r=/Windows Phone/i,ap=/\bWindows(?:.+)ARM\b/i,lp=/BlackBerry/i,hp=/BB10/i,up=/Opera Mini/i,cp=/\b(CriOS|Chrome)(?:.+)Mobile/i,fp=/Mobile(?:.+)Firefox\b/i,dp=function(e){return typeof e<"u"&&e.platform==="MacIntel"&&typeof e.maxTouchPoints=="number"&&e.maxTouchPoints>1&&typeof MSStream>"u"};function KE(e){return function(t){return t.test(e)}}function ZE(e){var t={userAgent:"",platform:"",maxTouchPoints:0};!e&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof e=="string"?t.userAgent=e:e&&e.userAgent&&(t={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0});var r=t.userAgent,i=r.split("[FBAN");typeof i[1]<"u"&&(r=i[0]),i=r.split("Twitter"),typeof i[1]<"u"&&(r=i[0]);var n=KE(r),o={apple:{phone:n(dh)&&!n($r),ipod:n(ip),tablet:!n(dh)&&(n(np)||dp(t))&&!n($r),universal:n(sp),device:(n(dh)||n(ip)||n(np)||n(sp)||dp(t))&&!n($r)},amazon:{phone:n(hn),tablet:!n(hn)&&n(Po),device:n(hn)||n(Po)},android:{phone:!n($r)&&n(hn)||!n($r)&&n(ph),tablet:!n($r)&&!n(hn)&&!n(ph)&&(n(Po)||n(op)),device:!n($r)&&(n(hn)||n(Po)||n(ph)||n(op))||n(/\bokhttp\b/i)},windows:{phone:n($r),tablet:n(ap),device:n($r)||n(ap)},other:{blackberry:n(lp),blackberry10:n(hp),opera:n(up),firefox:n(fp),chrome:n(cp),device:n(lp)||n(hp)||n(up)||n(fp)||n(cp)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}const zr=ZE(globalThis.navigator);J.RETINA_PREFIX=/@([0-9\.]+)x/;J.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Vg={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(r=!1));function n(u,f,d){this.fn=u,this.context=f,this.once=d||!1}function o(u,f,d,g,m){if(typeof d!="function")throw new TypeError("The listener must be a function");var v=new n(d,g||u,m),y=r?r+f:f;return u._events[y]?u._events[y].fn?u._events[y]=[u._events[y],v]:u._events[y].push(v):(u._events[y]=v,u._eventsCount++),u}function l(u,f){--u._eventsCount===0?u._events=new i:delete u._events[f]}function h(){this._events=new i,this._eventsCount=0}h.prototype.eventNames=function(){var f=[],d,g;if(this._eventsCount===0)return f;for(g in d=this._events)t.call(d,g)&&f.push(r?g.slice(1):g);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(d)):f},h.prototype.listeners=function(f){var d=r?r+f:f,g=this._events[d];if(!g)return[];if(g.fn)return[g.fn];for(var m=0,v=g.length,y=new Array(v);m<v;m++)y[m]=g[m].fn;return y},h.prototype.listenerCount=function(f){var d=r?r+f:f,g=this._events[d];return g?g.fn?1:g.length:0},h.prototype.emit=function(f,d,g,m,v,y){var w=r?r+f:f;if(!this._events[w])return!1;var x=this._events[w],A=arguments.length,S,E;if(x.fn){switch(x.once&&this.removeListener(f,x.fn,void 0,!0),A){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,d),!0;case 3:return x.fn.call(x.context,d,g),!0;case 4:return x.fn.call(x.context,d,g,m),!0;case 5:return x.fn.call(x.context,d,g,m,v),!0;case 6:return x.fn.call(x.context,d,g,m,v,y),!0}for(E=1,S=new Array(A-1);E<A;E++)S[E-1]=arguments[E];x.fn.apply(x.context,S)}else{var I=x.length,D;for(E=0;E<I;E++)switch(x[E].once&&this.removeListener(f,x[E].fn,void 0,!0),A){case 1:x[E].fn.call(x[E].context);break;case 2:x[E].fn.call(x[E].context,d);break;case 3:x[E].fn.call(x[E].context,d,g);break;case 4:x[E].fn.call(x[E].context,d,g,m);break;default:if(!S)for(D=1,S=new Array(A-1);D<A;D++)S[D-1]=arguments[D];x[E].fn.apply(x[E].context,S)}}return!0},h.prototype.on=function(f,d,g){return o(this,f,d,g,!1)},h.prototype.once=function(f,d,g){return o(this,f,d,g,!0)},h.prototype.removeListener=function(f,d,g,m){var v=r?r+f:f;if(!this._events[v])return this;if(!d)return l(this,v),this;var y=this._events[v];if(y.fn)y.fn===d&&(!m||y.once)&&(!g||y.context===g)&&l(this,v);else{for(var w=0,x=[],A=y.length;w<A;w++)(y[w].fn!==d||m&&!y[w].once||g&&y[w].context!==g)&&x.push(y[w]);x.length?this._events[v]=x.length===1?x[0]:x:l(this,v)}return this},h.prototype.removeAllListeners=function(f){var d;return f?(d=r?r+f:f,this._events[d]&&l(this,d)):(this._events=new i,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=r,h.EventEmitter=h,e.exports=h})(Vg);var JE=Vg.exports;const Ds=Ba(JE);var Ju={exports:{}};Ju.exports=Oa;Ju.exports.default=Oa;function Oa(e,t,r){r=r||2;var i=t&&t.length,n=i?t[0]*r:e.length,o=jg(e,0,n,r,!0),l=[];if(!o||o.next===o.prev)return l;var h,u,f,d,g,m,v;if(i&&(o=iT(e,t,o,r)),e.length>80*r){h=f=e[0],u=d=e[1];for(var y=r;y<n;y+=r)g=e[y],m=e[y+1],g<h&&(h=g),m<u&&(u=m),g>f&&(f=g),m>d&&(d=m);v=Math.max(f-h,d-u),v=v!==0?32767/v:0}return Ts(o,l,r,h,u,v,0),l}function jg(e,t,r,i,n){var o,l;if(n===uu(e,t,r,i)>0)for(o=t;o<r;o+=i)l=pp(o,e[o],e[o+1],l);else for(o=r-i;o>=t;o-=i)l=pp(o,e[o],e[o+1],l);return l&&Fa(l,l.next)&&(Ss(l),l=l.next),l}function $i(e,t){if(!e)return e;t||(t=e);var r=e,i;do if(i=!1,!r.steiner&&(Fa(r,r.next)||zt(r.prev,r,r.next)===0)){if(Ss(r),r=t=r.prev,r===r.next)break;i=!0}else r=r.next;while(i||r!==t);return t}function Ts(e,t,r,i,n,o,l){if(e){!l&&o&&lT(e,i,n,o);for(var h=e,u,f;e.prev!==e.next;){if(u=e.prev,f=e.next,o?tT(e,i,n,o):QE(e)){t.push(u.i/r|0),t.push(e.i/r|0),t.push(f.i/r|0),Ss(e),e=f.next,h=f.next;continue}if(e=f,e===h){l?l===1?(e=eT($i(e),t,r),Ts(e,t,r,i,n,o,2)):l===2&&rT(e,t,r,i,n,o):Ts($i(e),t,r,i,n,o,1);break}}}}function QE(e){var t=e.prev,r=e,i=e.next;if(zt(t,r,i)>=0)return!1;for(var n=t.x,o=r.x,l=i.x,h=t.y,u=r.y,f=i.y,d=n<o?n<l?n:l:o<l?o:l,g=h<u?h<f?h:f:u<f?u:f,m=n>o?n>l?n:l:o>l?o:l,v=h>u?h>f?h:f:u>f?u:f,y=i.next;y!==t;){if(y.x>=d&&y.x<=m&&y.y>=g&&y.y<=v&&_n(n,h,o,u,l,f,y.x,y.y)&&zt(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function tT(e,t,r,i){var n=e.prev,o=e,l=e.next;if(zt(n,o,l)>=0)return!1;for(var h=n.x,u=o.x,f=l.x,d=n.y,g=o.y,m=l.y,v=h<u?h<f?h:f:u<f?u:f,y=d<g?d<m?d:m:g<m?g:m,w=h>u?h>f?h:f:u>f?u:f,x=d>g?d>m?d:m:g>m?g:m,A=lu(v,y,t,r,i),S=lu(w,x,t,r,i),E=e.prevZ,I=e.nextZ;E&&E.z>=A&&I&&I.z<=S;){if(E.x>=v&&E.x<=w&&E.y>=y&&E.y<=x&&E!==n&&E!==l&&_n(h,d,u,g,f,m,E.x,E.y)&&zt(E.prev,E,E.next)>=0||(E=E.prevZ,I.x>=v&&I.x<=w&&I.y>=y&&I.y<=x&&I!==n&&I!==l&&_n(h,d,u,g,f,m,I.x,I.y)&&zt(I.prev,I,I.next)>=0))return!1;I=I.nextZ}for(;E&&E.z>=A;){if(E.x>=v&&E.x<=w&&E.y>=y&&E.y<=x&&E!==n&&E!==l&&_n(h,d,u,g,f,m,E.x,E.y)&&zt(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;I&&I.z<=S;){if(I.x>=v&&I.x<=w&&I.y>=y&&I.y<=x&&I!==n&&I!==l&&_n(h,d,u,g,f,m,I.x,I.y)&&zt(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function eT(e,t,r){var i=e;do{var n=i.prev,o=i.next.next;!Fa(n,o)&&Yg(n,i,i.next,o)&&As(n,o)&&As(o,n)&&(t.push(n.i/r|0),t.push(i.i/r|0),t.push(o.i/r|0),Ss(i),Ss(i.next),i=e=o),i=i.next}while(i!==e);return $i(i)}function rT(e,t,r,i,n,o){var l=e;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&cT(l,h)){var u=qg(l,h);l=$i(l,l.next),u=$i(u,u.next),Ts(l,t,r,i,n,o,0),Ts(u,t,r,i,n,o,0);return}h=h.next}l=l.next}while(l!==e)}function iT(e,t,r,i){var n=[],o,l,h,u,f;for(o=0,l=t.length;o<l;o++)h=t[o]*i,u=o<l-1?t[o+1]*i:e.length,f=jg(e,h,u,i,!1),f===f.next&&(f.steiner=!0),n.push(uT(f));for(n.sort(nT),o=0;o<n.length;o++)r=sT(n[o],r);return r}function nT(e,t){return e.x-t.x}function sT(e,t){var r=oT(e,t);if(!r)return t;var i=qg(r,e);return $i(i,i.next),$i(r,r.next)}function oT(e,t){var r=t,i=e.x,n=e.y,o=-1/0,l;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var h=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(h<=i&&h>o&&(o=h,l=r.x<r.next.x?r:r.next,h===i))return l}r=r.next}while(r!==t);if(!l)return null;var u=l,f=l.x,d=l.y,g=1/0,m;r=l;do i>=r.x&&r.x>=f&&i!==r.x&&_n(n<d?i:o,n,f,d,n<d?o:i,n,r.x,r.y)&&(m=Math.abs(n-r.y)/(i-r.x),As(r,e)&&(m<g||m===g&&(r.x>l.x||r.x===l.x&&aT(l,r)))&&(l=r,g=m)),r=r.next;while(r!==u);return l}function aT(e,t){return zt(e.prev,e,t.prev)<0&&zt(t.next,e,e.next)<0}function lT(e,t,r,i){var n=e;do n.z===0&&(n.z=lu(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,hT(n)}function hT(e){var t,r,i,n,o,l,h,u,f=1;do{for(r=e,e=null,o=null,l=0;r;){for(l++,i=r,h=0,t=0;t<f&&(h++,i=i.nextZ,!!i);t++);for(u=f;h>0||u>0&&i;)h!==0&&(u===0||!i||r.z<=i.z)?(n=r,r=r.nextZ,h--):(n=i,i=i.nextZ,u--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;r=i}o.nextZ=null,f*=2}while(l>1);return e}function lu(e,t,r,i,n){return e=(e-r)*n|0,t=(t-i)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function uT(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function _n(e,t,r,i,n,o,l,h){return(n-l)*(t-h)>=(e-l)*(o-h)&&(e-l)*(i-h)>=(r-l)*(t-h)&&(r-l)*(o-h)>=(n-l)*(i-h)}function cT(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!fT(e,t)&&(As(e,t)&&As(t,e)&&dT(e,t)&&(zt(e.prev,e,t.prev)||zt(e,t.prev,t))||Fa(e,t)&&zt(e.prev,e,e.next)>0&&zt(t.prev,t,t.next)>0)}function zt(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Fa(e,t){return e.x===t.x&&e.y===t.y}function Yg(e,t,r,i){var n=Mo(zt(e,t,r)),o=Mo(zt(e,t,i)),l=Mo(zt(r,i,e)),h=Mo(zt(r,i,t));return!!(n!==o&&l!==h||n===0&&Ro(e,r,t)||o===0&&Ro(e,i,t)||l===0&&Ro(r,e,i)||h===0&&Ro(r,t,i))}function Ro(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Mo(e){return e>0?1:e<0?-1:0}function fT(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Yg(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function As(e,t){return zt(e.prev,e,e.next)<0?zt(e,t,e.next)>=0&&zt(e,e.prev,t)>=0:zt(e,t,e.prev)<0||zt(e,e.next,t)<0}function dT(e,t){var r=e,i=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==e);return i}function qg(e,t){var r=new hu(e.i,e.x,e.y),i=new hu(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function pp(e,t,r,i){var n=new hu(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Ss(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function hu(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Oa.deviation=function(e,t,r,i){var n=t&&t.length,o=n?t[0]*r:e.length,l=Math.abs(uu(e,0,o,r));if(n)for(var h=0,u=t.length;h<u;h++){var f=t[h]*r,d=h<u-1?t[h+1]*r:e.length;l-=Math.abs(uu(e,f,d,r))}var g=0;for(h=0;h<i.length;h+=3){var m=i[h]*r,v=i[h+1]*r,y=i[h+2]*r;g+=Math.abs((e[m]-e[y])*(e[v+1]-e[m+1])-(e[m]-e[v])*(e[y+1]-e[m+1]))}return l===0&&g===0?0:Math.abs((g-l)/l)};function uu(e,t,r,i){for(var n=0,o=t,l=r-i;o<r;o+=i)n+=(e[l]-e[o])*(e[o+1]+e[l+1]),l=o;return n}Oa.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var l=0;l<t;l++)r.vertices.push(e[n][o][l]);n>0&&(i+=e[n-1].length,r.holes.push(i))}return r};var pT=Ju.exports;const gT=Ba(pT);var da={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */da.exports;(function(e,t){(function(r){var i=t&&!t.nodeType&&t,n=e&&!e.nodeType&&e,o=typeof Sr=="object"&&Sr;(o.global===o||o.window===o||o.self===o)&&(r=o);var l,h=2147483647,u=36,f=1,d=26,g=38,m=700,v=72,y=128,w="-",x=/^xn--/,A=/[^\x20-\x7E]/,S=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},I=u-f,D=Math.floor,L=String.fromCharCode,O;function F(H){throw new RangeError(E[H])}function X(H,rt){for(var xt=H.length,Pt=[];xt--;)Pt[xt]=rt(H[xt]);return Pt}function Y(H,rt){var xt=H.split("@"),Pt="";xt.length>1&&(Pt=xt[0]+"@",H=xt[1]),H=H.replace(S,".");var Mt=H.split("."),Nt=X(Mt,rt).join(".");return Pt+Nt}function z(H){for(var rt=[],xt=0,Pt=H.length,Mt,Nt;xt<Pt;)Mt=H.charCodeAt(xt++),Mt>=55296&&Mt<=56319&&xt<Pt?(Nt=H.charCodeAt(xt++),(Nt&64512)==56320?rt.push(((Mt&1023)<<10)+(Nt&1023)+65536):(rt.push(Mt),xt--)):rt.push(Mt);return rt}function K(H){return X(H,function(rt){var xt="";return rt>65535&&(rt-=65536,xt+=L(rt>>>10&1023|55296),rt=56320|rt&1023),xt+=L(rt),xt}).join("")}function W(H){return H-48<10?H-22:H-65<26?H-65:H-97<26?H-97:u}function k(H,rt){return H+22+75*(H<26)-((rt!=0)<<5)}function at(H,rt,xt){var Pt=0;for(H=xt?D(H/m):H>>1,H+=D(H/rt);H>I*d>>1;Pt+=u)H=D(H/I);return D(Pt+(I+1)*H/(H+g))}function ft(H){var rt=[],xt=H.length,Pt,Mt=0,Nt=y,kt=v,re,jt,ie,se,Dt,Ut,Yt,qt,ve;for(re=H.lastIndexOf(w),re<0&&(re=0),jt=0;jt<re;++jt)H.charCodeAt(jt)>=128&&F("not-basic"),rt.push(H.charCodeAt(jt));for(ie=re>0?re+1:0;ie<xt;){for(se=Mt,Dt=1,Ut=u;ie>=xt&&F("invalid-input"),Yt=W(H.charCodeAt(ie++)),(Yt>=u||Yt>D((h-Mt)/Dt))&&F("overflow"),Mt+=Yt*Dt,qt=Ut<=kt?f:Ut>=kt+d?d:Ut-kt,!(Yt<qt);Ut+=u)ve=u-qt,Dt>D(h/ve)&&F("overflow"),Dt*=ve;Pt=rt.length+1,kt=at(Mt-se,Pt,se==0),D(Mt/Pt)>h-Nt&&F("overflow"),Nt+=D(Mt/Pt),Mt%=Pt,rt.splice(Mt++,0,Nt)}return K(rt)}function j(H){var rt,xt,Pt,Mt,Nt,kt,re,jt,ie,se,Dt,Ut=[],Yt,qt,ve,vi;for(H=z(H),Yt=H.length,rt=y,xt=0,Nt=v,kt=0;kt<Yt;++kt)Dt=H[kt],Dt<128&&Ut.push(L(Dt));for(Pt=Mt=Ut.length,Mt&&Ut.push(w);Pt<Yt;){for(re=h,kt=0;kt<Yt;++kt)Dt=H[kt],Dt>=rt&&Dt<re&&(re=Dt);for(qt=Pt+1,re-rt>D((h-xt)/qt)&&F("overflow"),xt+=(re-rt)*qt,rt=re,kt=0;kt<Yt;++kt)if(Dt=H[kt],Dt<rt&&++xt>h&&F("overflow"),Dt==rt){for(jt=xt,ie=u;se=ie<=Nt?f:ie>=Nt+d?d:ie-Nt,!(jt<se);ie+=u)vi=jt-se,ve=u-se,Ut.push(L(k(se+vi%ve,0))),jt=D(vi/ve);Ut.push(L(k(jt,0))),Nt=at(xt,qt,Pt==Mt),xt=0,++Pt}++xt,++rt}return Ut.join("")}function vt(H){return Y(H,function(rt){return x.test(rt)?ft(rt.slice(4).toLowerCase()):rt})}function Ot(H){return Y(H,function(rt){return A.test(rt)?"xn--"+j(rt):rt})}if(l={version:"1.4.1",ucs2:{decode:z,encode:K},decode:ft,encode:j,toASCII:Ot,toUnicode:vt},i&&n)if(e.exports==i)n.exports=l;else for(O in l)l.hasOwnProperty(O)&&(i[O]=l[O]);else r.punycode=l})(Sr)})(da,da.exports);var mT=da.exports,vT=Error,_T=EvalError,yT=RangeError,xT=ReferenceError,Kg=SyntaxError,Bs=TypeError,bT=URIError,wT=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},r=Symbol("test"),i=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var n=42;t[r]=n;for(r in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==r||!Object.prototype.propertyIsEnumerable.call(t,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var l=Object.getOwnPropertyDescriptor(t,r);if(l.value!==n||l.enumerable!==!0)return!1}return!0},gp=typeof Symbol<"u"&&Symbol,ET=wT,TT=function(){return typeof gp!="function"||typeof Symbol!="function"||typeof gp("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:ET()},gh={__proto__:null,foo:{}},AT=Object,ST=function(){return{__proto__:gh}.foo===gh.foo&&!(gh instanceof AT)},CT="Function.prototype.bind called on incompatible ",IT=Object.prototype.toString,PT=Math.max,RT="[object Function]",mp=function(t,r){for(var i=[],n=0;n<t.length;n+=1)i[n]=t[n];for(var o=0;o<r.length;o+=1)i[o+t.length]=r[o];return i},MT=function(t,r){for(var i=[],n=r,o=0;n<t.length;n+=1,o+=1)i[o]=t[n];return i},DT=function(e,t){for(var r="",i=0;i<e.length;i+=1)r+=e[i],i+1<e.length&&(r+=t);return r},BT=function(t){var r=this;if(typeof r!="function"||IT.apply(r)!==RT)throw new TypeError(CT+r);for(var i=MT(arguments,1),n,o=function(){if(this instanceof n){var d=r.apply(this,mp(i,arguments));return Object(d)===d?d:this}return r.apply(t,mp(i,arguments))},l=PT(0,r.length-i.length),h=[],u=0;u<l;u++)h[u]="$"+u;if(n=Function("binder","return function ("+DT(h,",")+"){ return binder.apply(this,arguments); }")(o),r.prototype){var f=function(){};f.prototype=r.prototype,n.prototype=new f,f.prototype=null}return n},OT=BT,Qu=Function.prototype.bind||OT,FT=Function.prototype.call,LT=Object.prototype.hasOwnProperty,NT=Qu,kT=NT.call(FT,LT),wt,UT=vT,GT=_T,WT=yT,$T=xT,Pn=Kg,Tn=Bs,HT=bT,Zg=Function,mh=function(e){try{return Zg('"use strict"; return ('+e+").constructor;")()}catch{}},Ui=Object.getOwnPropertyDescriptor;if(Ui)try{Ui({},"")}catch{Ui=null}var vh=function(){throw new Tn},XT=Ui?function(){try{return arguments.callee,vh}catch{try{return Ui(arguments,"callee").get}catch{return vh}}}():vh,un=TT(),zT=ST(),ce=Object.getPrototypeOf||(zT?function(e){return e.__proto__}:null),pn={},VT=typeof Uint8Array>"u"||!ce?wt:ce(Uint8Array),Gi={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?wt:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?wt:ArrayBuffer,"%ArrayIteratorPrototype%":un&&ce?ce([][Symbol.iterator]()):wt,"%AsyncFromSyncIteratorPrototype%":wt,"%AsyncFunction%":pn,"%AsyncGenerator%":pn,"%AsyncGeneratorFunction%":pn,"%AsyncIteratorPrototype%":pn,"%Atomics%":typeof Atomics>"u"?wt:Atomics,"%BigInt%":typeof BigInt>"u"?wt:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?wt:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?wt:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?wt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":UT,"%eval%":eval,"%EvalError%":GT,"%Float32Array%":typeof Float32Array>"u"?wt:Float32Array,"%Float64Array%":typeof Float64Array>"u"?wt:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?wt:FinalizationRegistry,"%Function%":Zg,"%GeneratorFunction%":pn,"%Int8Array%":typeof Int8Array>"u"?wt:Int8Array,"%Int16Array%":typeof Int16Array>"u"?wt:Int16Array,"%Int32Array%":typeof Int32Array>"u"?wt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":un&&ce?ce(ce([][Symbol.iterator]())):wt,"%JSON%":typeof JSON=="object"?JSON:wt,"%Map%":typeof Map>"u"?wt:Map,"%MapIteratorPrototype%":typeof Map>"u"||!un||!ce?wt:ce(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?wt:Promise,"%Proxy%":typeof Proxy>"u"?wt:Proxy,"%RangeError%":WT,"%ReferenceError%":$T,"%Reflect%":typeof Reflect>"u"?wt:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?wt:Set,"%SetIteratorPrototype%":typeof Set>"u"||!un||!ce?wt:ce(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?wt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":un&&ce?ce(""[Symbol.iterator]()):wt,"%Symbol%":un?Symbol:wt,"%SyntaxError%":Pn,"%ThrowTypeError%":XT,"%TypedArray%":VT,"%TypeError%":Tn,"%Uint8Array%":typeof Uint8Array>"u"?wt:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?wt:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?wt:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?wt:Uint32Array,"%URIError%":HT,"%WeakMap%":typeof WeakMap>"u"?wt:WeakMap,"%WeakRef%":typeof WeakRef>"u"?wt:WeakRef,"%WeakSet%":typeof WeakSet>"u"?wt:WeakSet};if(ce)try{null.error}catch(e){var jT=ce(ce(e));Gi["%Error.prototype%"]=jT}var YT=function e(t){var r;if(t==="%AsyncFunction%")r=mh("async function () {}");else if(t==="%GeneratorFunction%")r=mh("function* () {}");else if(t==="%AsyncGeneratorFunction%")r=mh("async function* () {}");else if(t==="%AsyncGenerator%"){var i=e("%AsyncGeneratorFunction%");i&&(r=i.prototype)}else if(t==="%AsyncIteratorPrototype%"){var n=e("%AsyncGenerator%");n&&ce&&(r=ce(n.prototype))}return Gi[t]=r,r},vp={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Os=Qu,pa=kT,qT=Os.call(Function.call,Array.prototype.concat),KT=Os.call(Function.apply,Array.prototype.splice),_p=Os.call(Function.call,String.prototype.replace),ga=Os.call(Function.call,String.prototype.slice),ZT=Os.call(Function.call,RegExp.prototype.exec),JT=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,QT=/\\(\\)?/g,tA=function(t){var r=ga(t,0,1),i=ga(t,-1);if(r==="%"&&i!=="%")throw new Pn("invalid intrinsic syntax, expected closing `%`");if(i==="%"&&r!=="%")throw new Pn("invalid intrinsic syntax, expected opening `%`");var n=[];return _p(t,JT,function(o,l,h,u){n[n.length]=h?_p(u,QT,"$1"):l||o}),n},eA=function(t,r){var i=t,n;if(pa(vp,i)&&(n=vp[i],i="%"+n[0]+"%"),pa(Gi,i)){var o=Gi[i];if(o===pn&&(o=YT(i)),typeof o>"u"&&!r)throw new Tn("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:n,name:i,value:o}}throw new Pn("intrinsic "+t+" does not exist!")},kn=function(t,r){if(typeof t!="string"||t.length===0)throw new Tn("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof r!="boolean")throw new Tn('"allowMissing" argument must be a boolean');if(ZT(/^%?[^%]*%?$/,t)===null)throw new Pn("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=tA(t),n=i.length>0?i[0]:"",o=eA("%"+n+"%",r),l=o.name,h=o.value,u=!1,f=o.alias;f&&(n=f[0],KT(i,qT([0,1],f)));for(var d=1,g=!0;d<i.length;d+=1){var m=i[d],v=ga(m,0,1),y=ga(m,-1);if((v==='"'||v==="'"||v==="`"||y==='"'||y==="'"||y==="`")&&v!==y)throw new Pn("property names with quotes must have matching quotes");if((m==="constructor"||!g)&&(u=!0),n+="."+m,l="%"+n+"%",pa(Gi,l))h=Gi[l];else if(h!=null){if(!(m in h)){if(!r)throw new Tn("base intrinsic for "+t+" exists, but the property is not available.");return}if(Ui&&d+1>=i.length){var w=Ui(h,m);g=!!w,g&&"get"in w&&!("originalValue"in w.get)?h=w.get:h=h[m]}else g=pa(h,m),h=h[m];g&&!u&&(Gi[l]=h)}}return h},Jg={exports:{}},_h,yp;function tc(){if(yp)return _h;yp=1;var e=kn,t=e("%Object.defineProperty%",!0)||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return _h=t,_h}var rA=kn,na=rA("%Object.getOwnPropertyDescriptor%",!0);if(na)try{na([],"length")}catch{na=null}var Qg=na,xp=tc(),iA=Kg,cn=Bs,bp=Qg,nA=function(t,r,i){if(!t||typeof t!="object"&&typeof t!="function")throw new cn("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new cn("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new cn("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new cn("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new cn("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new cn("`loose`, if provided, must be a boolean");var n=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,l=arguments.length>5?arguments[5]:null,h=arguments.length>6?arguments[6]:!1,u=!!bp&&bp(t,r);if(xp)xp(t,r,{configurable:l===null&&u?u.configurable:!l,enumerable:n===null&&u?u.enumerable:!n,value:i,writable:o===null&&u?u.writable:!o});else if(h||!n&&!o&&!l)t[r]=i;else throw new iA("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},cu=tc(),tm=function(){return!!cu};tm.hasArrayLengthDefineBug=function(){if(!cu)return null;try{return cu([],"length",{value:1}).length!==1}catch{return!0}};var sA=tm,oA=kn,wp=nA,aA=sA(),Ep=Qg,Tp=Bs,lA=oA("%Math.floor%"),hA=function(t,r){if(typeof t!="function")throw new Tp("`fn` is not a function");if(typeof r!="number"||r<0||r>4294967295||lA(r)!==r)throw new Tp("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],n=!0,o=!0;if("length"in t&&Ep){var l=Ep(t,"length");l&&!l.configurable&&(n=!1),l&&!l.writable&&(o=!1)}return(n||o||!i)&&(aA?wp(t,"length",r,!0,!0):wp(t,"length",r)),t};(function(e){var t=Qu,r=kn,i=hA,n=Bs,o=r("%Function.prototype.apply%"),l=r("%Function.prototype.call%"),h=r("%Reflect.apply%",!0)||t.call(l,o),u=tc(),f=r("%Math.max%");e.exports=function(m){if(typeof m!="function")throw new n("a function is required");var v=h(t,l,arguments);return i(v,1+f(0,m.length-(arguments.length-1)),!0)};var d=function(){return h(t,o,arguments)};u?u(e.exports,"apply",{value:d}):e.exports.apply=d})(Jg);var uA=Jg.exports,em=kn,rm=uA,cA=rm(em("String.prototype.indexOf")),fA=function(t,r){var i=em(t,!!r);return typeof i=="function"&&cA(t,".prototype.")>-1?rm(i):i};const dA={},pA=Object.freeze(Object.defineProperty({__proto__:null,default:dA},Symbol.toStringTag,{value:"Module"})),gA=YE(pA);var ec=typeof Map=="function"&&Map.prototype,yh=Object.getOwnPropertyDescriptor&&ec?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,ma=ec&&yh&&typeof yh.get=="function"?yh.get:null,Ap=ec&&Map.prototype.forEach,rc=typeof Set=="function"&&Set.prototype,xh=Object.getOwnPropertyDescriptor&&rc?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,va=rc&&xh&&typeof xh.get=="function"?xh.get:null,Sp=rc&&Set.prototype.forEach,mA=typeof WeakMap=="function"&&WeakMap.prototype,ys=mA?WeakMap.prototype.has:null,vA=typeof WeakSet=="function"&&WeakSet.prototype,xs=vA?WeakSet.prototype.has:null,_A=typeof WeakRef=="function"&&WeakRef.prototype,Cp=_A?WeakRef.prototype.deref:null,yA=Boolean.prototype.valueOf,xA=Object.prototype.toString,bA=Function.prototype.toString,wA=String.prototype.match,ic=String.prototype.slice,li=String.prototype.replace,EA=String.prototype.toUpperCase,Ip=String.prototype.toLowerCase,im=RegExp.prototype.test,Pp=Array.prototype.concat,Ar=Array.prototype.join,TA=Array.prototype.slice,Rp=Math.floor,fu=typeof BigInt=="function"?BigInt.prototype.valueOf:null,bh=Object.getOwnPropertySymbols,du=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Rn=typeof Symbol=="function"&&typeof Symbol.iterator=="object",xe=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Rn||!0)?Symbol.toStringTag:null,nm=Object.prototype.propertyIsEnumerable,Mp=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function Dp(e,t){if(e===1/0||e===-1/0||e!==e||e&&e>-1e3&&e<1e3||im.call(/e/,t))return t;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof e=="number"){var i=e<0?-Rp(-e):Rp(e);if(i!==e){var n=String(i),o=ic.call(t,n.length+1);return li.call(n,r,"$&_")+"."+li.call(li.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return li.call(t,r,"$&_")}var pu=gA,Bp=pu.custom,Op=om(Bp)?Bp:null,AA=function e(t,r,i,n){var o=r||{};if(si(o,"quoteStyle")&&o.quoteStyle!=="single"&&o.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(si(o,"maxStringLength")&&(typeof o.maxStringLength=="number"?o.maxStringLength<0&&o.maxStringLength!==1/0:o.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var l=si(o,"customInspect")?o.customInspect:!0;if(typeof l!="boolean"&&l!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(si(o,"indent")&&o.indent!==null&&o.indent!=="	"&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(si(o,"numericSeparator")&&typeof o.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var h=o.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return lm(t,o);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var u=String(t);return h?Dp(t,u):u}if(typeof t=="bigint"){var f=String(t)+"n";return h?Dp(t,f):f}var d=typeof o.depth>"u"?5:o.depth;if(typeof i>"u"&&(i=0),i>=d&&d>0&&typeof t=="object")return gu(t)?"[Array]":"[Object]";var g=HA(o,i);if(typeof n>"u")n=[];else if(am(n,t)>=0)return"[Circular]";function m(W,k,at){if(k&&(n=TA.call(n),n.push(k)),at){var ft={depth:o.depth};return si(o,"quoteStyle")&&(ft.quoteStyle=o.quoteStyle),e(W,ft,i+1,n)}return e(W,o,i+1,n)}if(typeof t=="function"&&!Fp(t)){var v=OA(t),y=Do(t,m);return"[Function"+(v?": "+v:" (anonymous)")+"]"+(y.length>0?" { "+Ar.call(y,", ")+" }":"")}if(om(t)){var w=Rn?li.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):du.call(t);return typeof t=="object"&&!Rn?hs(w):w}if(GA(t)){for(var x="<"+Ip.call(String(t.nodeName)),A=t.attributes||[],S=0;S<A.length;S++)x+=" "+A[S].name+"="+sm(SA(A[S].value),"double",o);return x+=">",t.childNodes&&t.childNodes.length&&(x+="..."),x+="</"+Ip.call(String(t.nodeName))+">",x}if(gu(t)){if(t.length===0)return"[]";var E=Do(t,m);return g&&!$A(E)?"["+mu(E,g)+"]":"[ "+Ar.call(E,", ")+" ]"}if(IA(t)){var I=Do(t,m);return!("cause"in Error.prototype)&&"cause"in t&&!nm.call(t,"cause")?"{ ["+String(t)+"] "+Ar.call(Pp.call("[cause]: "+m(t.cause),I),", ")+" }":I.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+Ar.call(I,", ")+" }"}if(typeof t=="object"&&l){if(Op&&typeof t[Op]=="function"&&pu)return pu(t,{depth:d-i});if(l!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(FA(t)){var D=[];return Ap&&Ap.call(t,function(W,k){D.push(m(k,t,!0)+" => "+m(W,t))}),Lp("Map",ma.call(t),D,g)}if(kA(t)){var L=[];return Sp&&Sp.call(t,function(W){L.push(m(W,t))}),Lp("Set",va.call(t),L,g)}if(LA(t))return wh("WeakMap");if(UA(t))return wh("WeakSet");if(NA(t))return wh("WeakRef");if(RA(t))return hs(m(Number(t)));if(DA(t))return hs(m(fu.call(t)));if(MA(t))return hs(yA.call(t));if(PA(t))return hs(m(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(t===Sr)return"{ [object globalThis] }";if(!CA(t)&&!Fp(t)){var O=Do(t,m),F=Mp?Mp(t)===Object.prototype:t instanceof Object||t.constructor===Object,X=t instanceof Object?"":"null prototype",Y=!F&&xe&&Object(t)===t&&xe in t?ic.call(mi(t),8,-1):X?"Object":"",z=F||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",K=z+(Y||X?"["+Ar.call(Pp.call([],Y||[],X||[]),": ")+"] ":"");return O.length===0?K+"{}":g?K+"{"+mu(O,g)+"}":K+"{ "+Ar.call(O,", ")+" }"}return String(t)};function sm(e,t,r){var i=(r.quoteStyle||t)==="double"?'"':"'";return i+e+i}function SA(e){return li.call(String(e),/"/g,"&quot;")}function gu(e){return mi(e)==="[object Array]"&&(!xe||!(typeof e=="object"&&xe in e))}function CA(e){return mi(e)==="[object Date]"&&(!xe||!(typeof e=="object"&&xe in e))}function Fp(e){return mi(e)==="[object RegExp]"&&(!xe||!(typeof e=="object"&&xe in e))}function IA(e){return mi(e)==="[object Error]"&&(!xe||!(typeof e=="object"&&xe in e))}function PA(e){return mi(e)==="[object String]"&&(!xe||!(typeof e=="object"&&xe in e))}function RA(e){return mi(e)==="[object Number]"&&(!xe||!(typeof e=="object"&&xe in e))}function MA(e){return mi(e)==="[object Boolean]"&&(!xe||!(typeof e=="object"&&xe in e))}function om(e){if(Rn)return e&&typeof e=="object"&&e instanceof Symbol;if(typeof e=="symbol")return!0;if(!e||typeof e!="object"||!du)return!1;try{return du.call(e),!0}catch{}return!1}function DA(e){if(!e||typeof e!="object"||!fu)return!1;try{return fu.call(e),!0}catch{}return!1}var BA=Object.prototype.hasOwnProperty||function(e){return e in this};function si(e,t){return BA.call(e,t)}function mi(e){return xA.call(e)}function OA(e){if(e.name)return e.name;var t=wA.call(bA.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}function am(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1}function FA(e){if(!ma||!e||typeof e!="object")return!1;try{ma.call(e);try{va.call(e)}catch{return!0}return e instanceof Map}catch{}return!1}function LA(e){if(!ys||!e||typeof e!="object")return!1;try{ys.call(e,ys);try{xs.call(e,xs)}catch{return!0}return e instanceof WeakMap}catch{}return!1}function NA(e){if(!Cp||!e||typeof e!="object")return!1;try{return Cp.call(e),!0}catch{}return!1}function kA(e){if(!va||!e||typeof e!="object")return!1;try{va.call(e);try{ma.call(e)}catch{return!0}return e instanceof Set}catch{}return!1}function UA(e){if(!xs||!e||typeof e!="object")return!1;try{xs.call(e,xs);try{ys.call(e,ys)}catch{return!0}return e instanceof WeakSet}catch{}return!1}function GA(e){return!e||typeof e!="object"?!1:typeof HTMLElement<"u"&&e instanceof HTMLElement?!0:typeof e.nodeName=="string"&&typeof e.getAttribute=="function"}function lm(e,t){if(e.length>t.maxStringLength){var r=e.length-t.maxStringLength,i="... "+r+" more character"+(r>1?"s":"");return lm(ic.call(e,0,t.maxStringLength),t)+i}var n=li.call(li.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,WA);return sm(n,"single",t)}function WA(e){var t=e.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return r?"\\"+r:"\\x"+(t<16?"0":"")+EA.call(t.toString(16))}function hs(e){return"Object("+e+")"}function wh(e){return e+" { ? }"}function Lp(e,t,r,i){var n=i?mu(r,i):Ar.call(r,", ");return e+" ("+t+") {"+n+"}"}function $A(e){for(var t=0;t<e.length;t++)if(am(e[t],`
`)>=0)return!1;return!0}function HA(e,t){var r;if(e.indent==="	")r="	";else if(typeof e.indent=="number"&&e.indent>0)r=Ar.call(Array(e.indent+1)," ");else return null;return{base:r,prev:Ar.call(Array(t+1),r)}}function mu(e,t){if(e.length===0)return"";var r=`
`+t.prev+t.base;return r+Ar.call(e,","+r)+`
`+t.prev}function Do(e,t){var r=gu(e),i=[];if(r){i.length=e.length;for(var n=0;n<e.length;n++)i[n]=si(e,n)?t(e[n],e):""}var o=typeof bh=="function"?bh(e):[],l;if(Rn){l={};for(var h=0;h<o.length;h++)l["$"+o[h]]=o[h]}for(var u in e)si(e,u)&&(r&&String(Number(u))===u&&u<e.length||Rn&&l["$"+u]instanceof Symbol||(im.call(/[^\w$]/,u)?i.push(t(u,e)+": "+t(e[u],e)):i.push(u+": "+t(e[u],e))));if(typeof bh=="function")for(var f=0;f<o.length;f++)nm.call(e,o[f])&&i.push("["+t(o[f])+"]: "+t(e[o[f]],e));return i}var hm=kn,Un=fA,XA=AA,zA=Bs,Bo=hm("%WeakMap%",!0),Oo=hm("%Map%",!0),VA=Un("WeakMap.prototype.get",!0),jA=Un("WeakMap.prototype.set",!0),YA=Un("WeakMap.prototype.has",!0),qA=Un("Map.prototype.get",!0),KA=Un("Map.prototype.set",!0),ZA=Un("Map.prototype.has",!0),nc=function(e,t){for(var r=e,i;(i=r.next)!==null;r=i)if(i.key===t)return r.next=i.next,i.next=e.next,e.next=i,i},JA=function(e,t){var r=nc(e,t);return r&&r.value},QA=function(e,t,r){var i=nc(e,t);i?i.value=r:e.next={key:t,next:e.next,value:r}},tS=function(e,t){return!!nc(e,t)},eS=function(){var t,r,i,n={assert:function(o){if(!n.has(o))throw new zA("Side channel does not contain "+XA(o))},get:function(o){if(Bo&&o&&(typeof o=="object"||typeof o=="function")){if(t)return VA(t,o)}else if(Oo){if(r)return qA(r,o)}else if(i)return JA(i,o)},has:function(o){if(Bo&&o&&(typeof o=="object"||typeof o=="function")){if(t)return YA(t,o)}else if(Oo){if(r)return ZA(r,o)}else if(i)return tS(i,o);return!1},set:function(o,l){Bo&&o&&(typeof o=="object"||typeof o=="function")?(t||(t=new Bo),jA(t,o,l)):Oo?(r||(r=new Oo),KA(r,o,l)):(i||(i={key:{},next:null}),QA(i,o,l))}};return n},rS=String.prototype.replace,iS=/%20/g,Eh={RFC1738:"RFC1738",RFC3986:"RFC3986"},sc={default:Eh.RFC3986,formatters:{RFC1738:function(e){return rS.call(e,iS,"+")},RFC3986:function(e){return String(e)}},RFC1738:Eh.RFC1738,RFC3986:Eh.RFC3986},nS=sc,Th=Object.prototype.hasOwnProperty,Fi=Array.isArray,xr=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),sS=function(t){for(;t.length>1;){var r=t.pop(),i=r.obj[r.prop];if(Fi(i)){for(var n=[],o=0;o<i.length;++o)typeof i[o]<"u"&&n.push(i[o]);r.obj[r.prop]=n}}},um=function(t,r){for(var i=r&&r.plainObjects?Object.create(null):{},n=0;n<t.length;++n)typeof t[n]<"u"&&(i[n]=t[n]);return i},oS=function e(t,r,i){if(!r)return t;if(typeof r!="object"){if(Fi(t))t.push(r);else if(t&&typeof t=="object")(i&&(i.plainObjects||i.allowPrototypes)||!Th.call(Object.prototype,r))&&(t[r]=!0);else return[t,r];return t}if(!t||typeof t!="object")return[t].concat(r);var n=t;return Fi(t)&&!Fi(r)&&(n=um(t,i)),Fi(t)&&Fi(r)?(r.forEach(function(o,l){if(Th.call(t,l)){var h=t[l];h&&typeof h=="object"&&o&&typeof o=="object"?t[l]=e(h,o,i):t.push(o)}else t[l]=o}),t):Object.keys(r).reduce(function(o,l){var h=r[l];return Th.call(o,l)?o[l]=e(o[l],h,i):o[l]=h,o},n)},aS=function(t,r){return Object.keys(r).reduce(function(i,n){return i[n]=r[n],i},t)},lS=function(e,t,r){var i=e.replace(/\+/g," ");if(r==="iso-8859-1")return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch{return i}},Ah=1024,hS=function(t,r,i,n,o){if(t.length===0)return t;var l=t;if(typeof t=="symbol"?l=Symbol.prototype.toString.call(t):typeof t!="string"&&(l=String(t)),i==="iso-8859-1")return escape(l).replace(/%u[0-9a-f]{4}/gi,function(v){return"%26%23"+parseInt(v.slice(2),16)+"%3B"});for(var h="",u=0;u<l.length;u+=Ah){for(var f=l.length>=Ah?l.slice(u,u+Ah):l,d=[],g=0;g<f.length;++g){var m=f.charCodeAt(g);if(m===45||m===46||m===95||m===126||m>=48&&m<=57||m>=65&&m<=90||m>=97&&m<=122||o===nS.RFC1738&&(m===40||m===41)){d[d.length]=f.charAt(g);continue}if(m<128){d[d.length]=xr[m];continue}if(m<2048){d[d.length]=xr[192|m>>6]+xr[128|m&63];continue}if(m<55296||m>=57344){d[d.length]=xr[224|m>>12]+xr[128|m>>6&63]+xr[128|m&63];continue}g+=1,m=65536+((m&1023)<<10|f.charCodeAt(g)&1023),d[d.length]=xr[240|m>>18]+xr[128|m>>12&63]+xr[128|m>>6&63]+xr[128|m&63]}h+=d.join("")}return h},uS=function(t){for(var r=[{obj:{o:t},prop:"o"}],i=[],n=0;n<r.length;++n)for(var o=r[n],l=o.obj[o.prop],h=Object.keys(l),u=0;u<h.length;++u){var f=h[u],d=l[f];typeof d=="object"&&d!==null&&i.indexOf(d)===-1&&(r.push({obj:l,prop:f}),i.push(d))}return sS(r),t},cS=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},fS=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},dS=function(t,r){return[].concat(t,r)},pS=function(t,r){if(Fi(t)){for(var i=[],n=0;n<t.length;n+=1)i.push(r(t[n]));return i}return r(t)},cm={arrayToObject:um,assign:aS,combine:dS,compact:uS,decode:lS,encode:hS,isBuffer:fS,isRegExp:cS,maybeMap:pS,merge:oS},fm=eS,sa=cm,bs=sc,gS=Object.prototype.hasOwnProperty,dm={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,r){return t+"["+r+"]"},repeat:function(t){return t}},Er=Array.isArray,mS=Array.prototype.push,pm=function(e,t){mS.apply(e,Er(t)?t:[t])},vS=Date.prototype.toISOString,Np=bs.default,le={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:sa.encode,encodeValuesOnly:!1,format:Np,formatter:bs.formatters[Np],indices:!1,serializeDate:function(t){return vS.call(t)},skipNulls:!1,strictNullHandling:!1},_S=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},Sh={},yS=function e(t,r,i,n,o,l,h,u,f,d,g,m,v,y,w,x,A,S){for(var E=t,I=S,D=0,L=!1;(I=I.get(Sh))!==void 0&&!L;){var O=I.get(t);if(D+=1,typeof O<"u"){if(O===D)throw new RangeError("Cyclic object value");L=!0}typeof I.get(Sh)>"u"&&(D=0)}if(typeof d=="function"?E=d(r,E):E instanceof Date?E=v(E):i==="comma"&&Er(E)&&(E=sa.maybeMap(E,function(H){return H instanceof Date?v(H):H})),E===null){if(l)return f&&!x?f(r,le.encoder,A,"key",y):r;E=""}if(_S(E)||sa.isBuffer(E)){if(f){var F=x?r:f(r,le.encoder,A,"key",y);return[w(F)+"="+w(f(E,le.encoder,A,"value",y))]}return[w(r)+"="+w(String(E))]}var X=[];if(typeof E>"u")return X;var Y;if(i==="comma"&&Er(E))x&&f&&(E=sa.maybeMap(E,f)),Y=[{value:E.length>0?E.join(",")||null:void 0}];else if(Er(d))Y=d;else{var z=Object.keys(E);Y=g?z.sort(g):z}var K=u?r.replace(/\./g,"%2E"):r,W=n&&Er(E)&&E.length===1?K+"[]":K;if(o&&Er(E)&&E.length===0)return W+"[]";for(var k=0;k<Y.length;++k){var at=Y[k],ft=typeof at=="object"&&typeof at.value<"u"?at.value:E[at];if(!(h&&ft===null)){var j=m&&u?at.replace(/\./g,"%2E"):at,vt=Er(E)?typeof i=="function"?i(W,j):W:W+(m?"."+j:"["+j+"]");S.set(t,D);var Ot=fm();Ot.set(Sh,S),pm(X,e(ft,vt,i,n,o,l,h,u,i==="comma"&&x&&Er(E)?null:f,d,g,m,v,y,w,x,A,Ot))}}return X},xS=function(t){if(!t)return le;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var r=t.charset||le.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=bs.default;if(typeof t.format<"u"){if(!gS.call(bs.formatters,t.format))throw new TypeError("Unknown format option provided.");i=t.format}var n=bs.formatters[i],o=le.filter;(typeof t.filter=="function"||Er(t.filter))&&(o=t.filter);var l;if(t.arrayFormat in dm?l=t.arrayFormat:"indices"in t?l=t.indices?"indices":"repeat":l=le.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var h=typeof t.allowDots>"u"?t.encodeDotInKeys===!0?!0:le.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:le.addQueryPrefix,allowDots:h,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:le.allowEmptyArrays,arrayFormat:l,charset:r,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:le.charsetSentinel,commaRoundTrip:t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?le.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:le.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:le.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:le.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:le.encodeValuesOnly,filter:o,format:i,formatter:n,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:le.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:le.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:le.strictNullHandling}},bS=function(e,t){var r=e,i=xS(t),n,o;typeof i.filter=="function"?(o=i.filter,r=o("",r)):Er(i.filter)&&(o=i.filter,n=o);var l=[];if(typeof r!="object"||r===null)return"";var h=dm[i.arrayFormat],u=h==="comma"&&i.commaRoundTrip;n||(n=Object.keys(r)),i.sort&&n.sort(i.sort);for(var f=fm(),d=0;d<n.length;++d){var g=n[d];i.skipNulls&&r[g]===null||pm(l,yS(r[g],g,h,u,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,f))}var m=l.join(i.delimiter),v=i.addQueryPrefix===!0?"?":"";return i.charsetSentinel&&(i.charset==="iso-8859-1"?v+="utf8=%26%2310003%3B&":v+="utf8=%E2%9C%93&"),m.length>0?v+m:""},Mn=cm,vu=Object.prototype.hasOwnProperty,wS=Array.isArray,te={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:Mn.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},ES=function(e){return e.replace(/&#(\d+);/g,function(t,r){return String.fromCharCode(parseInt(r,10))})},gm=function(e,t){return e&&typeof e=="string"&&t.comma&&e.indexOf(",")>-1?e.split(","):e},TS="utf8=%26%2310003%3B",AS="utf8=%E2%9C%93",SS=function(t,r){var i={__proto__:null},n=r.ignoreQueryPrefix?t.replace(/^\?/,""):t,o=r.parameterLimit===1/0?void 0:r.parameterLimit,l=n.split(r.delimiter,o),h=-1,u,f=r.charset;if(r.charsetSentinel)for(u=0;u<l.length;++u)l[u].indexOf("utf8=")===0&&(l[u]===AS?f="utf-8":l[u]===TS&&(f="iso-8859-1"),h=u,u=l.length);for(u=0;u<l.length;++u)if(u!==h){var d=l[u],g=d.indexOf("]="),m=g===-1?d.indexOf("="):g+1,v,y;m===-1?(v=r.decoder(d,te.decoder,f,"key"),y=r.strictNullHandling?null:""):(v=r.decoder(d.slice(0,m),te.decoder,f,"key"),y=Mn.maybeMap(gm(d.slice(m+1),r),function(x){return r.decoder(x,te.decoder,f,"value")})),y&&r.interpretNumericEntities&&f==="iso-8859-1"&&(y=ES(y)),d.indexOf("[]=")>-1&&(y=wS(y)?[y]:y);var w=vu.call(i,v);w&&r.duplicates==="combine"?i[v]=Mn.combine(i[v],y):(!w||r.duplicates==="last")&&(i[v]=y)}return i},CS=function(e,t,r,i){for(var n=i?t:gm(t,r),o=e.length-1;o>=0;--o){var l,h=e[o];if(h==="[]"&&r.parseArrays)l=r.allowEmptyArrays&&n===""?[]:[].concat(n);else{l=r.plainObjects?Object.create(null):{};var u=h.charAt(0)==="["&&h.charAt(h.length-1)==="]"?h.slice(1,-1):h,f=r.decodeDotInKeys?u.replace(/%2E/g,"."):u,d=parseInt(f,10);!r.parseArrays&&f===""?l={0:n}:!isNaN(d)&&h!==f&&String(d)===f&&d>=0&&r.parseArrays&&d<=r.arrayLimit?(l=[],l[d]=n):f!=="__proto__"&&(l[f]=n)}n=l}return n},IS=function(t,r,i,n){if(t){var o=i.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,l=/(\[[^[\]]*])/,h=/(\[[^[\]]*])/g,u=i.depth>0&&l.exec(o),f=u?o.slice(0,u.index):o,d=[];if(f){if(!i.plainObjects&&vu.call(Object.prototype,f)&&!i.allowPrototypes)return;d.push(f)}for(var g=0;i.depth>0&&(u=h.exec(o))!==null&&g<i.depth;){if(g+=1,!i.plainObjects&&vu.call(Object.prototype,u[1].slice(1,-1))&&!i.allowPrototypes)return;d.push(u[1])}return u&&d.push("["+o.slice(u.index)+"]"),CS(d,r,i,n)}},PS=function(t){if(!t)return te;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.decodeDotInKeys<"u"&&typeof t.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(t.decoder!==null&&typeof t.decoder<"u"&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=typeof t.charset>"u"?te.charset:t.charset,i=typeof t.duplicates>"u"?te.duplicates:t.duplicates;if(i!=="combine"&&i!=="first"&&i!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var n=typeof t.allowDots>"u"?t.decodeDotInKeys===!0?!0:te.allowDots:!!t.allowDots;return{allowDots:n,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:te.allowEmptyArrays,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:te.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:te.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:te.arrayLimit,charset:r,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:te.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:te.comma,decodeDotInKeys:typeof t.decodeDotInKeys=="boolean"?t.decodeDotInKeys:te.decodeDotInKeys,decoder:typeof t.decoder=="function"?t.decoder:te.decoder,delimiter:typeof t.delimiter=="string"||Mn.isRegExp(t.delimiter)?t.delimiter:te.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:te.depth,duplicates:i,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:te.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:te.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:te.plainObjects,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:te.strictNullHandling}},RS=function(e,t){var r=PS(t);if(e===""||e===null||typeof e>"u")return r.plainObjects?Object.create(null):{};for(var i=typeof e=="string"?SS(e,r):e,n=r.plainObjects?Object.create(null):{},o=Object.keys(i),l=0;l<o.length;++l){var h=o[l],u=IS(h,i[h],r,typeof e=="string");n=Mn.merge(n,u,r)}return r.allowSparse===!0?n:Mn.compact(n)},MS=bS,DS=RS,BS=sc,OS={formats:BS,parse:DS,stringify:MS},FS=mT;function fr(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var LS=/^([a-z0-9.+-]+:)/i,NS=/:[0-9]*$/,kS=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,US=["<",">",'"',"`"," ","\r",`
`,"	"],GS=["{","}","|","\\","^","`"].concat(US),_u=["'"].concat(GS),kp=["%","/","?",";","#"].concat(_u),Up=["/","?","#"],WS=255,Gp=/^[+a-z0-9A-Z_-]{0,63}$/,$S=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,HS={javascript:!0,"javascript:":!0},yu={javascript:!0,"javascript:":!0},An={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},xu=OS;function La(e,t,r){if(e&&typeof e=="object"&&e instanceof fr)return e;var i=new fr;return i.parse(e,t,r),i}fr.prototype.parse=function(e,t,r){if(typeof e!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var i=e.indexOf("?"),n=i!==-1&&i<e.indexOf("#")?"?":"#",o=e.split(n),l=/\\/g;o[0]=o[0].replace(l,"/"),e=o.join(n);var h=e;if(h=h.trim(),!r&&e.split("#").length===1){var u=kS.exec(h);if(u)return this.path=h,this.href=h,this.pathname=u[1],u[2]?(this.search=u[2],t?this.query=xu.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var f=LS.exec(h);if(f){f=f[0];var d=f.toLowerCase();this.protocol=d,h=h.substr(f.length)}if(r||f||h.match(/^\/\/[^@/]+@[^@/]+/)){var g=h.substr(0,2)==="//";g&&!(f&&yu[f])&&(h=h.substr(2),this.slashes=!0)}if(!yu[f]&&(g||f&&!An[f])){for(var m=-1,v=0;v<Up.length;v++){var y=h.indexOf(Up[v]);y!==-1&&(m===-1||y<m)&&(m=y)}var w,x;m===-1?x=h.lastIndexOf("@"):x=h.lastIndexOf("@",m),x!==-1&&(w=h.slice(0,x),h=h.slice(x+1),this.auth=decodeURIComponent(w)),m=-1;for(var v=0;v<kp.length;v++){var y=h.indexOf(kp[v]);y!==-1&&(m===-1||y<m)&&(m=y)}m===-1&&(m=h.length),this.host=h.slice(0,m),h=h.slice(m),this.parseHost(),this.hostname=this.hostname||"";var A=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!A)for(var S=this.hostname.split(/\./),v=0,E=S.length;v<E;v++){var I=S[v];if(I&&!I.match(Gp)){for(var D="",L=0,O=I.length;L<O;L++)I.charCodeAt(L)>127?D+="x":D+=I[L];if(!D.match(Gp)){var F=S.slice(0,v),X=S.slice(v+1),Y=I.match($S);Y&&(F.push(Y[1]),X.unshift(Y[2])),X.length&&(h="/"+X.join(".")+h),this.hostname=F.join(".");break}}}this.hostname.length>WS?this.hostname="":this.hostname=this.hostname.toLowerCase(),A||(this.hostname=FS.toASCII(this.hostname));var z=this.port?":"+this.port:"",K=this.hostname||"";this.host=K+z,this.href+=this.host,A&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),h[0]!=="/"&&(h="/"+h))}if(!HS[d])for(var v=0,E=_u.length;v<E;v++){var W=_u[v];if(h.indexOf(W)!==-1){var k=encodeURIComponent(W);k===W&&(k=escape(W)),h=h.split(W).join(k)}}var at=h.indexOf("#");at!==-1&&(this.hash=h.substr(at),h=h.slice(0,at));var ft=h.indexOf("?");if(ft!==-1?(this.search=h.substr(ft),this.query=h.substr(ft+1),t&&(this.query=xu.parse(this.query)),h=h.slice(0,ft)):t&&(this.search="",this.query={}),h&&(this.pathname=h),An[d]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var z=this.pathname||"",j=this.search||"";this.path=z+j}return this.href=this.format(),this};function XS(e){return typeof e=="string"&&(e=La(e)),e instanceof fr?e.format():fr.prototype.format.call(e)}fr.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",i=this.hash||"",n=!1,o="";this.host?n=e+this.host:this.hostname&&(n=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(o=xu.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var l=this.search||o&&"?"+o||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||An[t])&&n!==!1?(n="//"+(n||""),r&&r.charAt(0)!=="/"&&(r="/"+r)):n||(n=""),i&&i.charAt(0)!=="#"&&(i="#"+i),l&&l.charAt(0)!=="?"&&(l="?"+l),r=r.replace(/[?#]/g,function(h){return encodeURIComponent(h)}),l=l.replace("#","%23"),t+n+r+l+i};function zS(e,t){return La(e,!1,!0).resolve(t)}fr.prototype.resolve=function(e){return this.resolveObject(La(e,!1,!0)).format()};fr.prototype.resolveObject=function(e){if(typeof e=="string"){var t=new fr;t.parse(e,!1,!0),e=t}for(var r=new fr,i=Object.keys(this),n=0;n<i.length;n++){var o=i[n];r[o]=this[o]}if(r.hash=e.hash,e.href==="")return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),h=0;h<l.length;h++){var u=l[h];u!=="protocol"&&(r[u]=e[u])}return An[r.protocol]&&r.hostname&&!r.pathname&&(r.pathname="/",r.path=r.pathname),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!An[e.protocol]){for(var f=Object.keys(e),d=0;d<f.length;d++){var g=f[d];r[g]=e[g]}return r.href=r.format(),r}if(r.protocol=e.protocol,!e.host&&!yu[e.protocol]){for(var E=(e.pathname||"").split("/");E.length&&!(e.host=E.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),E[0]!==""&&E.unshift(""),E.length<2&&E.unshift(""),r.pathname=E.join("/")}else r.pathname=e.pathname;if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var m=r.pathname||"",v=r.search||"";r.path=m+v}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var y=r.pathname&&r.pathname.charAt(0)==="/",w=e.host||e.pathname&&e.pathname.charAt(0)==="/",x=w||y||r.host&&e.pathname,A=x,S=r.pathname&&r.pathname.split("/")||[],E=e.pathname&&e.pathname.split("/")||[],I=r.protocol&&!An[r.protocol];if(I&&(r.hostname="",r.port=null,r.host&&(S[0]===""?S[0]=r.host:S.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(E[0]===""?E[0]=e.host:E.unshift(e.host)),e.host=null),x=x&&(E[0]===""||S[0]==="")),w)r.host=e.host||e.host===""?e.host:r.host,r.hostname=e.hostname||e.hostname===""?e.hostname:r.hostname,r.search=e.search,r.query=e.query,S=E;else if(E.length)S||(S=[]),S.pop(),S=S.concat(E),r.search=e.search,r.query=e.query;else if(e.search!=null){if(I){r.host=S.shift(),r.hostname=r.host;var D=r.host&&r.host.indexOf("@")>0?r.host.split("@"):!1;D&&(r.auth=D.shift(),r.hostname=D.shift(),r.host=r.hostname)}return r.search=e.search,r.query=e.query,(r.pathname!==null||r.search!==null)&&(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!S.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var L=S.slice(-1)[0],O=(r.host||e.host||S.length>1)&&(L==="."||L==="..")||L==="",F=0,X=S.length;X>=0;X--)L=S[X],L==="."?S.splice(X,1):L===".."?(S.splice(X,1),F++):F&&(S.splice(X,1),F--);if(!x&&!A)for(;F--;F)S.unshift("..");x&&S[0]!==""&&(!S[0]||S[0].charAt(0)!=="/")&&S.unshift(""),O&&S.join("/").substr(-1)!=="/"&&S.push("");var Y=S[0]===""||S[0]&&S[0].charAt(0)==="/";if(I){r.hostname=Y?"":S.length?S.shift():"",r.host=r.hostname;var D=r.host&&r.host.indexOf("@")>0?r.host.split("@"):!1;D&&(r.auth=D.shift(),r.hostname=D.shift(),r.host=r.hostname)}return x=x||r.host&&S.length,x&&!Y&&S.unshift(""),S.length>0?r.pathname=S.join("/"):(r.pathname=null,r.path=null),(r.pathname!==null||r.search!==null)&&(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r};fr.prototype.parseHost=function(){var e=this.host,t=NS.exec(e);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)};var VS=La,jS=zS,YS=XS;const qS={parse:VS,format:YS,resolve:jS};function ir(e){if(typeof e!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function us(e){return e.split("?")[0].split("#")[0]}function KS(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ZS(e,t,r){return e.replace(new RegExp(KS(t),"g"),r)}function JS(e,t){let r="",i=0,n=-1,o=0,l=-1;for(let h=0;h<=e.length;++h){if(h<e.length)l=e.charCodeAt(h);else{if(l===47)break;l=47}if(l===47){if(!(n===h-1||o===1))if(n!==h-1&&o===2){if(r.length<2||i!==2||r.charCodeAt(r.length-1)!==46||r.charCodeAt(r.length-2)!==46){if(r.length>2){const u=r.lastIndexOf("/");if(u!==r.length-1){u===-1?(r="",i=0):(r=r.slice(0,u),i=r.length-1-r.lastIndexOf("/")),n=h,o=0;continue}}else if(r.length===2||r.length===1){r="",i=0,n=h,o=0;continue}}}else r.length>0?r+=`/${e.slice(n+1,h)}`:r=e.slice(n+1,h),i=h-n-1;n=h,o=0}else l===46&&o!==-1?++o:o=-1}return r}const me={toPosix(e){return ZS(e,"\\","/")},isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl(e){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(e)},hasProtocol(e){return/^[^/:]+:\//.test(this.toPosix(e))},getProtocol(e){ir(e),e=this.toPosix(e);let t="";const r=/^file:\/\/\//.exec(e),i=/^[^/:]+:\/\//.exec(e),n=/^[^/:]+:\//.exec(e);if(r||i||n){const o=(r==null?void 0:r[0])||(i==null?void 0:i[0])||(n==null?void 0:n[0]);t=o,e=e.slice(o.length)}return t},toAbsolute(e,t,r){if(this.isDataUrl(e))return e;const i=us(this.toPosix(t??J.ADAPTER.getBaseUrl())),n=us(this.toPosix(r??this.rootname(i)));return ir(e),e=this.toPosix(e),e.startsWith("/")?me.join(n,e.slice(1)):this.isAbsolute(e)?e:this.join(i,e)},normalize(e){if(e=this.toPosix(e),ir(e),e.length===0)return".";let t="";const r=e.startsWith("/");this.hasProtocol(e)&&(t=this.rootname(e),e=e.slice(t.length));const i=e.endsWith("/");return e=JS(e),e.length>0&&i&&(e+="/"),r?`/${e}`:t+e},isAbsolute(e){return ir(e),e=this.toPosix(e),this.hasProtocol(e)?!0:e.startsWith("/")},join(...e){if(e.length===0)return".";let t;for(let r=0;r<e.length;++r){const i=e[r];if(ir(i),i.length>0)if(t===void 0)t=i;else{const n=e[r-1]??"";this.extname(n)?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(e){if(ir(e),e.length===0)return".";e=this.toPosix(e);let t=e.charCodeAt(0);const r=t===47;let i=-1,n=!0;const o=this.getProtocol(e),l=e;e=e.slice(o.length);for(let h=e.length-1;h>=1;--h)if(t=e.charCodeAt(h),t===47){if(!n){i=h;break}}else n=!1;return i===-1?r?"/":this.isUrl(l)?o+e:o:r&&i===1?"//":o+e.slice(0,i)},rootname(e){ir(e),e=this.toPosix(e);let t="";if(e.startsWith("/")?t="/":t=this.getProtocol(e),this.isUrl(e)){const r=e.indexOf("/",t.length);r!==-1?t=e.slice(0,r):t=e,t.endsWith("/")||(t+="/")}return t},basename(e,t){ir(e),t&&ir(t),e=us(this.toPosix(e));let r=0,i=-1,n=!0,o;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let l=t.length-1,h=-1;for(o=e.length-1;o>=0;--o){const u=e.charCodeAt(o);if(u===47){if(!n){r=o+1;break}}else h===-1&&(n=!1,h=o+1),l>=0&&(u===t.charCodeAt(l)?--l===-1&&(i=o):(l=-1,i=h))}return r===i?i=h:i===-1&&(i=e.length),e.slice(r,i)}for(o=e.length-1;o>=0;--o)if(e.charCodeAt(o)===47){if(!n){r=o+1;break}}else i===-1&&(n=!1,i=o+1);return i===-1?"":e.slice(r,i)},extname(e){ir(e),e=us(this.toPosix(e));let t=-1,r=0,i=-1,n=!0,o=0;for(let l=e.length-1;l>=0;--l){const h=e.charCodeAt(l);if(h===47){if(!n){r=l+1;break}continue}i===-1&&(n=!1,i=l+1),h===46?t===-1?t=l:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||i===-1||o===0||o===1&&t===i-1&&t===r+1?"":e.slice(t,i)},parse(e){ir(e);const t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;e=us(this.toPosix(e));let r=e.charCodeAt(0);const i=this.isAbsolute(e);let n;t.root=this.rootname(e),i||this.hasProtocol(e)?n=1:n=0;let o=-1,l=0,h=-1,u=!0,f=e.length-1,d=0;for(;f>=n;--f){if(r=e.charCodeAt(f),r===47){if(!u){l=f+1;break}continue}h===-1&&(u=!1,h=f+1),r===46?o===-1?o=f:d!==1&&(d=1):o!==-1&&(d=-1)}return o===-1||h===-1||d===0||d===1&&o===h-1&&o===l+1?h!==-1&&(l===0&&i?t.base=t.name=e.slice(1,h):t.base=t.name=e.slice(l,h)):(l===0&&i?(t.name=e.slice(1,o),t.base=e.slice(1,h)):(t.name=e.slice(l,o),t.base=e.slice(l,h)),t.ext=e.slice(o,h)),t.dir=this.dirname(e),t},sep:"/",delimiter:":"},Wp={};function Ct(e,t,r=3){if(Wp[t])return;let i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`):(i=i.split(`
`).splice(r).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${e}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`),console.warn(i))),Wp[t]=!0}let Ch;function QS(){return typeof Ch>"u"&&(Ch=function(){var r;const t={stencil:!0,failIfMajorPerformanceCaveat:J.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!J.ADAPTER.getWebGLRenderingContext())return!1;const i=J.ADAPTER.createCanvas();let n=i.getContext("webgl",t)||i.getContext("experimental-webgl",t);const o=!!((r=n==null?void 0:n.getContextAttributes())!=null&&r.stencil);if(n){const l=n.getExtension("WEBGL_lose_context");l&&l.loseContext()}return n=null,o}catch{return!1}}()),Ch}var tC="#f0f8ff",eC="#faebd7",rC="#00ffff",iC="#7fffd4",nC="#f0ffff",sC="#f5f5dc",oC="#ffe4c4",aC="#000000",lC="#ffebcd",hC="#0000ff",uC="#8a2be2",cC="#a52a2a",fC="#deb887",dC="#5f9ea0",pC="#7fff00",gC="#d2691e",mC="#ff7f50",vC="#6495ed",_C="#fff8dc",yC="#dc143c",xC="#00ffff",bC="#00008b",wC="#008b8b",EC="#b8860b",TC="#a9a9a9",AC="#006400",SC="#a9a9a9",CC="#bdb76b",IC="#8b008b",PC="#556b2f",RC="#ff8c00",MC="#9932cc",DC="#8b0000",BC="#e9967a",OC="#8fbc8f",FC="#483d8b",LC="#2f4f4f",NC="#2f4f4f",kC="#00ced1",UC="#9400d3",GC="#ff1493",WC="#00bfff",$C="#696969",HC="#696969",XC="#1e90ff",zC="#b22222",VC="#fffaf0",jC="#228b22",YC="#ff00ff",qC="#dcdcdc",KC="#f8f8ff",ZC="#daa520",JC="#ffd700",QC="#808080",tI="#008000",eI="#adff2f",rI="#808080",iI="#f0fff0",nI="#ff69b4",sI="#cd5c5c",oI="#4b0082",aI="#fffff0",lI="#f0e68c",hI="#fff0f5",uI="#e6e6fa",cI="#7cfc00",fI="#fffacd",dI="#add8e6",pI="#f08080",gI="#e0ffff",mI="#fafad2",vI="#d3d3d3",_I="#90ee90",yI="#d3d3d3",xI="#ffb6c1",bI="#ffa07a",wI="#20b2aa",EI="#87cefa",TI="#778899",AI="#778899",SI="#b0c4de",CI="#ffffe0",II="#00ff00",PI="#32cd32",RI="#faf0e6",MI="#ff00ff",DI="#800000",BI="#66cdaa",OI="#0000cd",FI="#ba55d3",LI="#9370db",NI="#3cb371",kI="#7b68ee",UI="#00fa9a",GI="#48d1cc",WI="#c71585",$I="#191970",HI="#f5fffa",XI="#ffe4e1",zI="#ffe4b5",VI="#ffdead",jI="#000080",YI="#fdf5e6",qI="#808000",KI="#6b8e23",ZI="#ffa500",JI="#ff4500",QI="#da70d6",tP="#eee8aa",eP="#98fb98",rP="#afeeee",iP="#db7093",nP="#ffefd5",sP="#ffdab9",oP="#cd853f",aP="#ffc0cb",lP="#dda0dd",hP="#b0e0e6",uP="#800080",cP="#663399",fP="#ff0000",dP="#bc8f8f",pP="#4169e1",gP="#8b4513",mP="#fa8072",vP="#f4a460",_P="#2e8b57",yP="#fff5ee",xP="#a0522d",bP="#c0c0c0",wP="#87ceeb",EP="#6a5acd",TP="#708090",AP="#708090",SP="#fffafa",CP="#00ff7f",IP="#4682b4",PP="#d2b48c",RP="#008080",MP="#d8bfd8",DP="#ff6347",BP="#40e0d0",OP="#ee82ee",FP="#f5deb3",LP="#ffffff",NP="#f5f5f5",kP="#ffff00",UP="#9acd32",GP={aliceblue:tC,antiquewhite:eC,aqua:rC,aquamarine:iC,azure:nC,beige:sC,bisque:oC,black:aC,blanchedalmond:lC,blue:hC,blueviolet:uC,brown:cC,burlywood:fC,cadetblue:dC,chartreuse:pC,chocolate:gC,coral:mC,cornflowerblue:vC,cornsilk:_C,crimson:yC,cyan:xC,darkblue:bC,darkcyan:wC,darkgoldenrod:EC,darkgray:TC,darkgreen:AC,darkgrey:SC,darkkhaki:CC,darkmagenta:IC,darkolivegreen:PC,darkorange:RC,darkorchid:MC,darkred:DC,darksalmon:BC,darkseagreen:OC,darkslateblue:FC,darkslategray:LC,darkslategrey:NC,darkturquoise:kC,darkviolet:UC,deeppink:GC,deepskyblue:WC,dimgray:$C,dimgrey:HC,dodgerblue:XC,firebrick:zC,floralwhite:VC,forestgreen:jC,fuchsia:YC,gainsboro:qC,ghostwhite:KC,goldenrod:ZC,gold:JC,gray:QC,green:tI,greenyellow:eI,grey:rI,honeydew:iI,hotpink:nI,indianred:sI,indigo:oI,ivory:aI,khaki:lI,lavenderblush:hI,lavender:uI,lawngreen:cI,lemonchiffon:fI,lightblue:dI,lightcoral:pI,lightcyan:gI,lightgoldenrodyellow:mI,lightgray:vI,lightgreen:_I,lightgrey:yI,lightpink:xI,lightsalmon:bI,lightseagreen:wI,lightskyblue:EI,lightslategray:TI,lightslategrey:AI,lightsteelblue:SI,lightyellow:CI,lime:II,limegreen:PI,linen:RI,magenta:MI,maroon:DI,mediumaquamarine:BI,mediumblue:OI,mediumorchid:FI,mediumpurple:LI,mediumseagreen:NI,mediumslateblue:kI,mediumspringgreen:UI,mediumturquoise:GI,mediumvioletred:WI,midnightblue:$I,mintcream:HI,mistyrose:XI,moccasin:zI,navajowhite:VI,navy:jI,oldlace:YI,olive:qI,olivedrab:KI,orange:ZI,orangered:JI,orchid:QI,palegoldenrod:tP,palegreen:eP,paleturquoise:rP,palevioletred:iP,papayawhip:nP,peachpuff:sP,peru:oP,pink:aP,plum:lP,powderblue:hP,purple:uP,rebeccapurple:cP,red:fP,rosybrown:dP,royalblue:pP,saddlebrown:gP,salmon:mP,sandybrown:vP,seagreen:_P,seashell:yP,sienna:xP,silver:bP,skyblue:wP,slateblue:EP,slategray:TP,slategrey:AP,snow:SP,springgreen:CP,steelblue:IP,tan:PP,teal:RP,thistle:MP,tomato:DP,turquoise:BP,violet:OP,wheat:FP,white:LP,whitesmoke:NP,yellow:kP,yellowgreen:UP};function Cs(e,t=[]){return t[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(e&255)/255,t}function mm(e){let t=e.toString(16);return t="000000".substring(0,6-t.length)+t,`#${t}`}function oc(e){if(typeof e=="string"&&(e=GP[e.toLowerCase()]||e,e[0]==="#"&&(e=e.slice(1)),e.length===3)){const[t,r,i]=e;e=t+t+r+r+i+i}return parseInt(e,16)}function WP(){const e=[],t=[];for(let i=0;i<32;i++)e[i]=i,t[i]=i;e[ut.NORMAL_NPM]=ut.NORMAL,e[ut.ADD_NPM]=ut.ADD,e[ut.SCREEN_NPM]=ut.SCREEN,t[ut.NORMAL]=ut.NORMAL_NPM,t[ut.ADD]=ut.ADD_NPM,t[ut.SCREEN]=ut.SCREEN_NPM;const r=[];return r.push(t),r.push(e),r}const vm=WP();function _m(e,t){return vm[t?1:0][e]}function $P(e,t,r,i){return r=r||new Float32Array(4),i||i===void 0?(r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t):(r[0]=e[0],r[1]=e[1],r[2]=e[2]),r[3]=t,r}function ac(e,t){if(t===1)return(t*255<<24)+e;if(t===0)return 0;let r=e>>16&255,i=e>>8&255,n=e&255;return r=r*t+.5|0,i=i*t+.5|0,n=n*t+.5|0,(t*255<<24)+(r<<16)+(i<<8)+n}function ym(e,t,r,i){return r=r||new Float32Array(4),r[0]=(e>>16&255)/255,r[1]=(e>>8&255)/255,r[2]=(e&255)/255,(i||i===void 0)&&(r[0]*=t,r[1]*=t,r[2]*=t),r[3]=t,r}function HP(e,t=null){const r=e*6;if(t=t||new Uint16Array(r),t.length!==r)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${r}`);for(let i=0,n=0;i<r;i+=6,n+=4)t[i+0]=n+0,t[i+1]=n+1,t[i+2]=n+2,t[i+3]=n+0,t[i+4]=n+2,t[i+5]=n+3;return t}function xm(e){if(e.BYTES_PER_ELEMENT===4)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(e.BYTES_PER_ELEMENT===2){if(e instanceof Uint16Array)return"Uint16Array"}else if(e.BYTES_PER_ELEMENT===1&&e instanceof Uint8Array)return"Uint8Array";return null}function _a(e){return e+=e===0?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e+1}function $p(e){return!(e&e-1)&&!!e}function Hp(e){let t=(e>65535?1:0)<<4;e>>>=t;let r=(e>255?1:0)<<3;return e>>>=r,t|=r,r=(e>15?1:0)<<2,e>>>=r,t|=r,r=(e>3?1:0)<<1,e>>>=r,t|=r,t|e>>1}function Sn(e,t,r){const i=e.length;let n;if(t>=i||r===0)return;r=t+r>i?i-t:r;const o=i-r;for(n=t;n<o;++n)e[n]=e[n+r];e.length=o}function yn(e){return e===0?0:e<0?-1:1}let XP=0;function Hi(){return++XP}const bm=class{constructor(e,t,r,i){this.left=e,this.top=t,this.right=r,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let bu=bm;bu.EMPTY=new bm(0,0,0,0);const Xp={},wr=Object.create(null),ni=Object.create(null);class zp{constructor(t,r,i){this._canvas=J.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||J.RESOLUTION,this.resize(t,r)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,r){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(r*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function Vp(e,t,r){for(let i=0,n=4*r*t;i<t;++i,n+=4)if(e[n+3]!==0)return!1;return!0}function jp(e,t,r,i,n){const o=4*t;for(let l=i,h=i*o+4*r;l<=n;++l,h+=o)if(e[h+3]!==0)return!1;return!0}function zP(e){const{width:t,height:r}=e,i=e.getContext("2d",{willReadFrequently:!0});if(i===null)throw new TypeError("Failed to get canvas 2D context");const o=i.getImageData(0,0,t,r).data;let l=0,h=0,u=t-1,f=r-1;for(;h<r&&Vp(o,t,h);)++h;if(h===r)return bu.EMPTY;for(;Vp(o,t,f);)--f;for(;jp(o,t,l,h,f);)++l;for(;jp(o,t,u,h,f);)--u;return++u,++f,new bu(l,h,u,f)}function VP(e){const t=zP(e),{width:r,height:i}=t;let n=null;if(!t.isEmpty()){const o=e.getContext("2d");if(o===null)throw new TypeError("Failed to get canvas 2D context");n=o.getImageData(t.left,t.top,r,i)}return{width:r,height:i,data:n}}let Fo;function jP(e,t=globalThis.location){if(e.startsWith("data:"))return"";t=t||globalThis.location,Fo||(Fo=document.createElement("a")),Fo.href=e;const r=qS.parse(Fo.href),i=!r.port&&t.port===""||r.port===t.port;return r.hostname!==t.hostname||!i||r.protocol!==t.protocol?"anonymous":""}function fi(e,t=1){var i;const r=(i=J.RETINA_PREFIX)==null?void 0:i.exec(e);return r?parseFloat(r[1]):t}var Z=(e=>(e.Renderer="renderer",e.Application="application",e.RendererSystem="renderer-webgl-system",e.RendererPlugin="renderer-webgl-plugin",e.CanvasRendererSystem="renderer-canvas-system",e.CanvasRendererPlugin="renderer-canvas-plugin",e.Asset="asset",e.LoadParser="load-parser",e.ResolveParser="resolve-parser",e.CacheParser="cache-parser",e.DetectionParser="detection-parser",e))(Z||{});const wu=e=>{if(typeof e=="function"||typeof e=="object"&&e.extension){if(!e.extension)throw new Error("Extension class must have an extension object");e={...typeof e.extension!="object"?{type:e.extension}:e.extension,ref:e}}if(typeof e=="object")e={...e};else throw new Error("Invalid extension type");return typeof e.type=="string"&&(e.type=[e.type]),e},Yp=(e,t)=>wu(e).priority??t,nt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...e){return e.map(wu).forEach(t=>{t.type.forEach(r=>{var i,n;return(n=(i=this._removeHandlers)[r])==null?void 0:n.call(i,t)})}),this},add(...e){return e.map(wu).forEach(t=>{t.type.forEach(r=>{const i=this._addHandlers,n=this._queue;i[r]?i[r](t):(n[r]=n[r]||[],n[r].push(t))})}),this},handle(e,t,r){const i=this._addHandlers,n=this._removeHandlers;if(i[e]||n[e])throw new Error(`Extension type ${e} already has a handler`);i[e]=t,n[e]=r;const o=this._queue;return o[e]&&(o[e].forEach(l=>t(l)),delete o[e]),this},handleByMap(e,t){return this.handle(e,r=>{t[r.name]=r.ref},r=>{delete t[r.name]})},handleByList(e,t,r=-1){return this.handle(e,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((n,o)=>Yp(o,r)-Yp(n,r)))},i=>{const n=t.indexOf(i.ref);n!==-1&&t.splice(n,1)})}};class Eu{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const YP=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function qP(e){let t="";for(let r=0;r<e;++r)r>0&&(t+=`
else `),r<e-1&&(t+=`if(test == ${r}.0){}`);return t}function KP(e,t){if(e===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const r=t.createShader(t.FRAGMENT_SHADER);for(;;){const i=YP.replace(/%forloop%/gi,qP(e));if(t.shaderSource(r,i),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))e=e/2|0;else break}return e}const Ih=0,Ph=1,Rh=2,Mh=3,Dh=4,Bh=5;class Yr{constructor(){this.data=0,this.blendMode=ut.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Ih)}set blend(t){!!(this.data&1<<Ih)!==t&&(this.data^=1<<Ih)}get offsets(){return!!(this.data&1<<Ph)}set offsets(t){!!(this.data&1<<Ph)!==t&&(this.data^=1<<Ph)}get culling(){return!!(this.data&1<<Rh)}set culling(t){!!(this.data&1<<Rh)!==t&&(this.data^=1<<Rh)}get depthTest(){return!!(this.data&1<<Mh)}set depthTest(t){!!(this.data&1<<Mh)!==t&&(this.data^=1<<Mh)}get depthMask(){return!!(this.data&1<<Bh)}set depthMask(t){!!(this.data&1<<Bh)!==t&&(this.data^=1<<Bh)}get clockwiseFrontFace(){return!!(this.data&1<<Dh)}set clockwiseFrontFace(t){!!(this.data&1<<Dh)!==t&&(this.data^=1<<Dh)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==ut.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new Yr;return t.depthTest=!1,t.blend=!0,t}}const Tu=[];function wm(e,t){if(!e)return null;let r="";if(typeof e=="string"){const i=/\.(\w{3,4})(?:$|\?|#)/i.exec(e);i&&(r=i[1].toLowerCase())}for(let i=Tu.length-1;i>=0;--i){const n=Tu[i];if(n.test&&n.test(e,r))return new n(e,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class dr{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,r,i,n,o,l,h,u){if(arguments.length>8)throw new Error("max arguments reached");const{name:f,items:d}=this;this._aliasCount++;for(let g=0,m=d.length;g<m;g++)d[g][f](t,r,i,n,o,l,h,u);return d===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const r=this.items.indexOf(t);return r!==-1&&(this.ensureNonAliasedItems(),this.items.splice(r,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(dr.prototype,{dispatch:{value:dr.prototype.emit},run:{value:dr.prototype.emit}});class Is{constructor(t=0,r=0){this._width=t,this._height=r,this.destroyed=!1,this.internal=!1,this.onResize=new dr("setRealSize"),this.onUpdate=new dr("update"),this.onError=new dr("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,r){(t!==this._width||r!==this._height)&&(this._width=t,this._height=r,this.onResize.emit(t,r))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,r,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,r){return!1}}class Fs extends Is{constructor(t,r){const{width:i,height:n}=r||{};if(!i||!n)throw new Error("BufferResource width or height invalid");super(i,n),this.data=t}upload(t,r,i){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===gr.UNPACK);const o=r.realWidth,l=r.realHeight;return i.width===o&&i.height===l?n.texSubImage2D(r.target,0,0,0,o,l,r.format,i.type,this.data):(i.width=o,i.height=l,n.texImage2D(r.target,0,i.internalFormat,o,l,0,r.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const ZP={scaleMode:Xr.NEAREST,format:V.RGBA,alphaMode:gr.NPM},gn=class extends Ds{constructor(e=null,t=null){super(),t=Object.assign({},gn.defaultOptions,t);const{alphaMode:r,mipmap:i,anisotropicLevel:n,scaleMode:o,width:l,height:h,wrapMode:u,format:f,type:d,target:g,resolution:m,resourceOptions:v}=t;e&&!(e instanceof Is)&&(e=wm(e,v),e.internal=!0),this.resolution=m||J.RESOLUTION,this.width=Math.round((l||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=i,this.anisotropicLevel=n,this._wrapMode=u,this._scaleMode=o,this.format=f,this.type=d,this.target=g,this.alphaMode=r,this.uid=Hi(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=l>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let r;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,r=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,r=!0),r&&this.dirtyStyleId++,this}setSize(e,t,r){return r=r||this.resolution,this.setRealSize(e*r,t*r,r)}setRealSize(e,t,r){return this.resolution=r||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=$p(this.realWidth)&&$p(this.realHeight)}setResolution(e){const t=this.resolution;return t===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT(),this)}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete ni[this.cacheId],delete wr[this.cacheId],this.cacheId=null),this.dispose(),gn.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,t,r=J.STRICT_TEXTURE_CACHE){const i=typeof e=="string";let n=null;if(i)n=e;else{if(!e._pixiId){const l=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${l}_${Hi()}`}n=e._pixiId}let o=ni[n];if(i&&r&&!o)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return o||(o=new gn(e,t),o.cacheId=n,gn.addToCache(o,n)),o}static fromBuffer(e,t,r,i){e=e||new Float32Array(t*r*4);const n=new Fs(e,{width:t,height:r}),o=e instanceof Float32Array?st.FLOAT:st.UNSIGNED_BYTE;return new gn(n,Object.assign({},ZP,i||{width:t,height:r,type:o}))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),ni[t]&&ni[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),ni[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=ni[e];if(t){const r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete ni[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete ni[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};let pt=gn;pt.defaultOptions={mipmap:Mr.POW2,anisotropicLevel:0,scaleMode:Xr.LINEAR,wrapMode:ui.CLAMP,alphaMode:gr.UNPACK,target:En.TEXTURE_2D,format:V.RGBA,type:st.UNSIGNED_BYTE};pt._globalBatch=0;class Au{constructor(){this.texArray=null,this.blend=0,this.type=Ir.TRIANGLES,this.start=0,this.size=0,this.data=null}}let JP=0;class ee{constructor(t,r=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=r,this.id=JP++,this.disposeRunner=new dr("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Pr.ELEMENT_ARRAY_BUFFER:Pr.ARRAY_BUFFER}get index(){return this.type===Pr.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new ee(t)}}class ya{constructor(t,r=0,i=!1,n=st.FLOAT,o,l,h,u=1){this.buffer=t,this.size=r,this.normalized=i,this.type=n,this.stride=o,this.start=l,this.instance=h,this.divisor=u}destroy(){this.buffer=null}static from(t,r,i,n,o){return new ya(t,r,i,n,o)}}const QP={Float32Array,Uint32Array,Int32Array,Uint8Array};function tR(e,t){let r=0,i=0;const n={};for(let u=0;u<e.length;u++)i+=t[u],r+=e[u].length;const o=new ArrayBuffer(r*4);let l=null,h=0;for(let u=0;u<e.length;u++){const f=t[u],d=e[u],g=xm(d);n[g]||(n[g]=new QP[g](o)),l=n[g];for(let m=0;m<d.length;m++){const v=(m/f|0)*i+h,y=m%f;l[v+y]=d[m]}h+=f}return new Float32Array(o)}const qp={5126:4,5123:2,5121:1};let eR=0;const rR={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class di{constructor(t=[],r={}){this.buffers=t,this.indexBuffer=null,this.attributes=r,this.glVertexArrayObjects={},this.id=eR++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new dr("disposeGeometry"),this.refCount=0}addAttribute(t,r,i=0,n=!1,o,l,h,u=!1){if(!r)throw new Error("You must pass a buffer when creating an attribute");r instanceof ee||(r instanceof Array&&(r=new Float32Array(r)),r=new ee(r));const f=t.split("|");if(f.length>1){for(let g=0;g<f.length;g++)this.addAttribute(f[g],r,i,n,o);return this}let d=this.buffers.indexOf(r);return d===-1&&(this.buffers.push(r),d=this.buffers.length-1),this.attributes[t]=new ya(d,i,n,o,l,h,u),this.instanced=this.instanced||u,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof ee||(t instanceof Array&&(t=new Uint16Array(t)),t=new ee(t)),t.type=Pr.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],r=[],i=new ee;let n;for(n in this.attributes){const o=this.attributes[n],l=this.buffers[o.buffer];t.push(l.data),r.push(o.size*qp[o.type]/4),o.buffer=0}for(i.data=tR(t,r),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const r=this.attributes[t];return this.buffers[r.buffer].data.length/(r.stride/4||r.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new di;for(let r=0;r<this.buffers.length;r++)t.buffers[r]=new ee(this.buffers[r].data.slice(0));for(const r in this.attributes){const i=this.attributes[r];t.attributes[r]=new ya(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Pr.ELEMENT_ARRAY_BUFFER),t}static merge(t){const r=new di,i=[],n=[],o=[];let l;for(let h=0;h<t.length;h++){l=t[h];for(let u=0;u<l.buffers.length;u++)n[u]=n[u]||0,n[u]+=l.buffers[u].data.length,o[u]=0}for(let h=0;h<l.buffers.length;h++)i[h]=new rR[xm(l.buffers[h].data)](n[h]),r.buffers[h]=new ee(i[h]);for(let h=0;h<t.length;h++){l=t[h];for(let u=0;u<l.buffers.length;u++)i[u].set(l.buffers[u].data,o[u]),o[u]+=l.buffers[u].data.length}if(r.attributes=l.attributes,l.indexBuffer){r.indexBuffer=r.buffers[l.buffers.indexOf(l.indexBuffer)],r.indexBuffer.type=Pr.ELEMENT_ARRAY_BUFFER;let h=0,u=0,f=0,d=0;for(let g=0;g<l.buffers.length;g++)if(l.buffers[g]!==l.indexBuffer){d=g;break}for(const g in l.attributes){const m=l.attributes[g];(m.buffer|0)===d&&(u+=m.size*qp[m.type]/4)}for(let g=0;g<t.length;g++){const m=t[g].indexBuffer.data;for(let v=0;v<m.length;v++)r.indexBuffer.data[v+f]+=h;h+=t[g].buffers[d].data.length/u,f+=m.length}}return r}}class Em extends di{constructor(t=!1){super(),this._buffer=new ee(null,t,!1),this._indexBuffer=new ee(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,st.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,st.FLOAT).addAttribute("aColor",this._buffer,4,!0,st.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,st.FLOAT).addIndex(this._indexBuffer)}}const xa=Math.PI*2,iR=180/Math.PI,nR=Math.PI/180;var ge=(e=>(e[e.POLY=0]="POLY",e[e.RECT=1]="RECT",e[e.CIRC=2]="CIRC",e[e.ELIP=3]="ELIP",e[e.RREC=4]="RREC",e))(ge||{});class At{constructor(t=0,r=0){this.x=0,this.y=0,this.x=t,this.y=r}clone(){return new At(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,r=t){return this.x=t,this.y=r,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const Lo=[new At,new At,new At,new At];class Et{constructor(t=0,r=0,i=0,n=0){this.x=Number(t),this.y=Number(r),this.width=Number(i),this.height=Number(n),this.type=ge.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Et(0,0,0,0)}clone(){return new Et(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,r){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&r>=this.y&&r<this.y+this.height}intersects(t,r){if(!r){const F=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=F)return!1;const Y=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>Y}const i=this.left,n=this.right,o=this.top,l=this.bottom;if(n<=i||l<=o)return!1;const h=Lo[0].set(t.left,t.top),u=Lo[1].set(t.left,t.bottom),f=Lo[2].set(t.right,t.top),d=Lo[3].set(t.right,t.bottom);if(f.x<=h.x||u.y<=h.y)return!1;const g=Math.sign(r.a*r.d-r.b*r.c);if(g===0||(r.apply(h,h),r.apply(u,u),r.apply(f,f),r.apply(d,d),Math.max(h.x,u.x,f.x,d.x)<=i||Math.min(h.x,u.x,f.x,d.x)>=n||Math.max(h.y,u.y,f.y,d.y)<=o||Math.min(h.y,u.y,f.y,d.y)>=l))return!1;const m=g*(u.y-h.y),v=g*(h.x-u.x),y=m*i+v*o,w=m*n+v*o,x=m*i+v*l,A=m*n+v*l;if(Math.max(y,w,x,A)<=m*h.x+v*h.y||Math.min(y,w,x,A)>=m*d.x+v*d.y)return!1;const S=g*(h.y-f.y),E=g*(f.x-h.x),I=S*i+E*o,D=S*n+E*o,L=S*i+E*l,O=S*n+E*l;return!(Math.max(I,D,L,O)<=S*h.x+E*h.y||Math.min(I,D,L,O)>=S*d.x+E*d.y)}pad(t=0,r=t){return this.x-=t,this.y-=r,this.width+=t*2,this.height+=r*2,this}fit(t){const r=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),o=Math.min(this.y+this.height,t.y+t.height);return this.x=r,this.width=Math.max(i-r,0),this.y=n,this.height=Math.max(o-n,0),this}ceil(t=1,r=.001){const i=Math.ceil((this.x+this.width-r)*t)/t,n=Math.ceil((this.y+this.height-r)*t)/t;return this.x=Math.floor((this.x+r)*t)/t,this.y=Math.floor((this.y+r)*t)/t,this.width=i-this.x,this.height=n-this.y,this}enlarge(t){const r=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),o=Math.max(this.y+this.height,t.y+t.height);return this.x=r,this.width=i-r,this.y=n,this.height=o-n,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class lc{constructor(t=0,r=0,i=0){this.x=t,this.y=r,this.radius=i,this.type=ge.CIRC}clone(){return new lc(this.x,this.y,this.radius)}contains(t,r){if(this.radius<=0)return!1;const i=this.radius*this.radius;let n=this.x-t,o=this.y-r;return n*=n,o*=o,n+o<=i}getBounds(){return new Et(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class hc{constructor(t=0,r=0,i=0,n=0){this.x=t,this.y=r,this.width=i,this.height=n,this.type=ge.ELIP}clone(){return new hc(this.x,this.y,this.width,this.height)}contains(t,r){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,n=(r-this.y)/this.height;return i*=i,n*=n,i+n<=1}getBounds(){return new Et(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Cn{constructor(...t){let r=Array.isArray(t[0])?t[0]:t;if(typeof r[0]!="number"){const i=[];for(let n=0,o=r.length;n<o;n++)i.push(r[n].x,r[n].y);r=i}this.points=r,this.type=ge.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),r=new Cn(t);return r.closeStroke=this.closeStroke,r}contains(t,r){let i=!1;const n=this.points.length/2;for(let o=0,l=n-1;o<n;l=o++){const h=this.points[o*2],u=this.points[o*2+1],f=this.points[l*2],d=this.points[l*2+1];u>r!=d>r&&t<(f-h)*((r-u)/(d-u))+h&&(i=!i)}return i}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((t,r)=>`${t}, ${r}`,"")}]`}}class uc{constructor(t=0,r=0,i=0,n=0,o=20){this.x=t,this.y=r,this.width=i,this.height=n,this.radius=o,this.type=ge.RREC}clone(){return new uc(this.x,this.y,this.width,this.height,this.radius)}contains(t,r){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&r>=this.y&&r<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(r>=this.y+i&&r<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let n=t-(this.x+i),o=r-(this.y+i);const l=i*i;if(n*n+o*o<=l||(n=t-(this.x+this.width-i),n*n+o*o<=l)||(o=r-(this.y+this.height-i),n*n+o*o<=l)||(n=t-(this.x+i),n*n+o*o<=l))return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class $t{constructor(t=1,r=0,i=0,n=1,o=0,l=0){this.array=null,this.a=t,this.b=r,this.c=i,this.d=n,this.tx=o,this.ty=l}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,r,i,n,o,l){return this.a=t,this.b=r,this.c=i,this.d=n,this.tx=o,this.ty=l,this}toArray(t,r){this.array||(this.array=new Float32Array(9));const i=r||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,r){r=r||new At;const i=t.x,n=t.y;return r.x=this.a*i+this.c*n+this.tx,r.y=this.b*i+this.d*n+this.ty,r}applyInverse(t,r){r=r||new At;const i=1/(this.a*this.d+this.c*-this.b),n=t.x,o=t.y;return r.x=this.d*i*n+-this.c*i*o+(this.ty*this.c-this.tx*this.d)*i,r.y=this.a*i*o+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,r}translate(t,r){return this.tx+=t,this.ty+=r,this}scale(t,r){return this.a*=t,this.d*=r,this.c*=t,this.b*=r,this.tx*=t,this.ty*=r,this}rotate(t){const r=Math.cos(t),i=Math.sin(t),n=this.a,o=this.c,l=this.tx;return this.a=n*r-this.b*i,this.b=n*i+this.b*r,this.c=o*r-this.d*i,this.d=o*i+this.d*r,this.tx=l*r-this.ty*i,this.ty=l*i+this.ty*r,this}append(t){const r=this.a,i=this.b,n=this.c,o=this.d;return this.a=t.a*r+t.b*n,this.b=t.a*i+t.b*o,this.c=t.c*r+t.d*n,this.d=t.c*i+t.d*o,this.tx=t.tx*r+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*o+this.ty,this}setTransform(t,r,i,n,o,l,h,u,f){return this.a=Math.cos(h+f)*o,this.b=Math.sin(h+f)*o,this.c=-Math.sin(h-u)*l,this.d=Math.cos(h-u)*l,this.tx=t-(i*this.a+n*this.c),this.ty=r-(i*this.b+n*this.d),this}prepend(t){const r=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const i=this.a,n=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=r*t.a+this.ty*t.c+t.tx,this.ty=r*t.b+this.ty*t.d+t.ty,this}decompose(t){const r=this.a,i=this.b,n=this.c,o=this.d,l=t.pivot,h=-Math.atan2(-n,o),u=Math.atan2(i,r),f=Math.abs(h+u);return f<1e-5||Math.abs(xa-f)<1e-5?(t.rotation=u,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=h,t.skew.y=u),t.scale.x=Math.sqrt(r*r+i*i),t.scale.y=Math.sqrt(n*n+o*o),t.position.x=this.tx+(l.x*r+l.y*n),t.position.y=this.ty+(l.x*i+l.y*o),t}invert(){const t=this.a,r=this.b,i=this.c,n=this.d,o=this.tx,l=t*n-r*i;return this.a=n/l,this.b=-r/l,this.c=-i/l,this.d=t/l,this.tx=(i*this.ty-n*o)/l,this.ty=-(t*this.ty-r*o)/l,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new $t;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new $t}static get TEMP_MATRIX(){return new $t}}const Ri=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Mi=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Di=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Bi=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Su=[],Tm=[],No=Math.sign;function sR(){for(let e=0;e<16;e++){const t=[];Su.push(t);for(let r=0;r<16;r++){const i=No(Ri[e]*Ri[r]+Di[e]*Mi[r]),n=No(Mi[e]*Ri[r]+Bi[e]*Mi[r]),o=No(Ri[e]*Di[r]+Di[e]*Bi[r]),l=No(Mi[e]*Di[r]+Bi[e]*Bi[r]);for(let h=0;h<16;h++)if(Ri[h]===i&&Mi[h]===n&&Di[h]===o&&Bi[h]===l){t.push(h);break}}}for(let e=0;e<16;e++){const t=new $t;t.set(Ri[e],Mi[e],Di[e],Bi[e],0,0),Tm.push(t)}}sR();const Xt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:e=>Ri[e],uY:e=>Mi[e],vX:e=>Di[e],vY:e=>Bi[e],inv:e=>e&8?e&15:-e&7,add:(e,t)=>Su[e][t],sub:(e,t)=>Su[e][Xt.inv(t)],rotate180:e=>e^4,isVertical:e=>(e&3)===2,byDirection:(e,t)=>Math.abs(e)*2<=Math.abs(t)?t>=0?Xt.S:Xt.N:Math.abs(t)*2<=Math.abs(e)?e>0?Xt.E:Xt.W:t>0?e>0?Xt.SE:Xt.SW:e>0?Xt.NE:Xt.NW,matrixAppendRotationInv:(e,t,r=0,i=0)=>{const n=Tm[Xt.inv(t)];n.tx=r,n.ty=i,e.append(n)}};class hi{constructor(t,r,i=0,n=0){this._x=i,this._y=n,this.cb=t,this.scope=r}clone(t=this.cb,r=this.scope){return new hi(t,r,this._x,this._y)}set(t=0,r=t){return(this._x!==t||this._y!==r)&&(this._x=t,this._y=r,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const Am=class{constructor(){this.worldTransform=new $t,this.localTransform=new $t,this.position=new hi(this.onChange,this,0,0),this.scale=new hi(this.onChange,this,1,1),this.pivot=new hi(this.onChange,this,0,0),this.skew=new hi(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(e){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){const r=e.worldTransform,i=this.worldTransform;i.a=t.a*r.a+t.b*r.c,i.b=t.a*r.b+t.b*r.d,i.c=t.c*r.a+t.d*r.c,i.d=t.c*r.b+t.d*r.d,i.tx=t.tx*r.a+t.ty*r.c+r.tx,i.ty=t.tx*r.b+t.ty*r.d+r.ty,this._parentID=e._worldID,this._worldID++}}setFromMatrix(e){e.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())}};let cc=Am;cc.IDENTITY=new Am;var oR=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,aR=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Kp(e,t,r){const i=e.createShader(t);return e.shaderSource(i,r),e.compileShader(i),i}function Oh(e){const t=new Array(e);for(let r=0;r<t.length;r++)t[r]=!1;return t}function Sm(e,t){switch(e){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Oh(2*t);case"bvec3":return Oh(3*t);case"bvec4":return Oh(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const In=[{test:e=>e.type==="float"&&e.size===1&&!e.isArray,code:e=>`
            if(uv["${e}"] !== ud["${e}"].value)
            {
                ud["${e}"].value = uv["${e}"]
                gl.uniform1f(ud["${e}"].location, uv["${e}"])
            }
            `},{test:(e,t)=>(e.type==="sampler2D"||e.type==="samplerCube"||e.type==="sampler2DArray")&&e.size===1&&!e.isArray&&(t==null||t.castToBaseTexture!==void 0),code:e=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${e}"], t);

            if(ud["${e}"].value !== t)
            {
                ud["${e}"].value = t;
                gl.uniform1i(ud["${e}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(e,t)=>e.type==="mat3"&&e.size===1&&!e.isArray&&t.a!==void 0,code:e=>`
            gl.uniformMatrix3fv(ud["${e}"].location, false, uv["${e}"].toArray(true));
            `,codeUbo:e=>`
                var ${e}_matrix = uv.${e}.toArray(true);

                data[offset] = ${e}_matrix[0];
                data[offset+1] = ${e}_matrix[1];
                data[offset+2] = ${e}_matrix[2];
        
                data[offset + 4] = ${e}_matrix[3];
                data[offset + 5] = ${e}_matrix[4];
                data[offset + 6] = ${e}_matrix[5];
        
                data[offset + 8] = ${e}_matrix[6];
                data[offset + 9] = ${e}_matrix[7];
                data[offset + 10] = ${e}_matrix[8];
            `},{test:(e,t)=>e.type==="vec2"&&e.size===1&&!e.isArray&&t.x!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${e}"].location, v.x, v.y);
                }`,codeUbo:e=>`
                v = uv.${e};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:e=>e.type==="vec2"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${e}"].location, v[0], v[1]);
                }
            `},{test:(e,t)=>e.type==="vec4"&&e.size===1&&!e.isArray&&t.width!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${e}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:e=>e.type==="vec4"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${e}"].location, v[0], v[1], v[2], v[3])
                }`}],lR={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},hR={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function uR(e,t){var i;const r=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const n in e.uniforms){const o=t[n];if(!o){(i=e.uniforms[n])!=null&&i.group&&(e.uniforms[n].ubo?r.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');
                    `):r.push(`
                        renderer.shader.syncUniformGroup(uv.${n}, syncData);
                    `));continue}const l=e.uniforms[n];let h=!1;for(let u=0;u<In.length;u++)if(In[u].test(o,l)){r.push(In[u].code(n,l)),h=!0;break}if(!h){const f=(o.size===1&&!o.isArray?lR:hR)[o.type].replace("location",`ud["${n}"].location`);r.push(`
            cu = ud["${n}"];
            cv = cu.value;
            v = uv["${n}"];
            ${f};`)}}return new Function("ud","uv","renderer","syncData",r.join(`
`))}const Cm={};let fn=Cm;function cR(){if(fn===Cm||fn!=null&&fn.isContextLost()){const e=J.ADAPTER.createCanvas();let t;J.PREFER_ENV>=Vi.WEBGL2&&(t=e.getContext("webgl2",{})),t||(t=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),fn=t}return fn}let ko;function fR(){if(!ko){ko=Ke.MEDIUM;const e=cR();e&&e.getShaderPrecisionFormat&&(ko=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision?Ke.HIGH:Ke.MEDIUM)}return ko}function Zp(e,t){const r=e.getShaderSource(t).split(`
`).map((f,d)=>`${d}: ${f}`),i=e.getShaderInfoLog(t),n=i.split(`
`),o={},l=n.map(f=>parseFloat(f.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(f=>f&&!o[f]?(o[f]=!0,!0):!1),h=[""];l.forEach(f=>{r[f-1]=`%c${r[f-1]}%c`,h.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const u=r.join(`
`);h[0]=u,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...h),console.groupEnd()}function dR(e,t,r,i){e.getProgramParameter(t,e.LINK_STATUS)||(e.getShaderParameter(r,e.COMPILE_STATUS)||Zp(e,r),e.getShaderParameter(i,e.COMPILE_STATUS)||Zp(e,i),console.error("PixiJS Error: Could not initialize shader."),e.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(t)))}const pR={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Im(e){return pR[e]}let Uo=null;const Jp={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Pm(e,t){if(!Uo){const r=Object.keys(Jp);Uo={};for(let i=0;i<r.length;++i){const n=r[i];Uo[e[n]]=Jp[n]}}return Uo[t]}function Qp(e,t,r){if(e.substring(0,9)!=="precision"){let i=t;return t===Ke.HIGH&&r!==Ke.HIGH&&(i=Ke.MEDIUM),`precision ${i} float;
${e}`}else if(r!==Ke.HIGH&&e.substring(0,15)==="precision highp")return e.replace("precision highp","precision mediump");return e}let cs;function gR(){if(typeof cs=="boolean")return cs;try{cs=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{cs=!1}return cs}let mR=0;const Go={},mn=class{constructor(e,t,r="pixi-shader",i={}){this.extra={},this.id=mR++,this.vertexSrc=e||mn.defaultVertexSrc,this.fragmentSrc=t||mn.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=i,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),Go[r]?(Go[r]++,r+=`-${Go[r]}`):Go[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=Qp(this.vertexSrc,mn.defaultVertexPrecision,Ke.HIGH),this.fragmentSrc=Qp(this.fragmentSrc,mn.defaultFragmentPrecision,fR())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return aR}static get defaultFragmentSrc(){return oR}static from(e,t,r){const i=e+t;let n=Xp[i];return n||(Xp[i]=n=new mn(e,t,r)),n}};let cr=mn;cr.defaultVertexPrecision=Ke.HIGH;cr.defaultFragmentPrecision=zr.apple.device?Ke.HIGH:Ke.MEDIUM;let vR=0;class pr{constructor(t,r,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=vR++,this.static=!!r,this.ubo=!!i,t instanceof ee?(this.buffer=t,this.buffer.type=Pr.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new ee(new Float32Array(1)),this.buffer.type=Pr.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,r,i){if(!this.ubo)this.uniforms[t]=new pr(r,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,r,i){return new pr(t,r,i)}static uboFrom(t,r){return new pr(t,r??!0,!0)}}class Rr{constructor(t,r){this.uniformBindCount=0,this.program=t,r?r instanceof pr?this.uniformGroup=r:this.uniformGroup=new pr(r):this.uniformGroup=new pr({}),this.disposeRunner=new dr("disposeShader")}checkUniformExists(t,r){if(r.uniforms[t])return!0;for(const i in r.uniforms){const n=r.uniforms[i];if(n.group&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,r,i){const n=cr.from(t,r);return new Rr(n,i)}}class _R{constructor(t,r){if(this.vertexSrc=t,this.fragTemplate=r,this.programCache={},this.defaultGroupCache={},!r.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!r.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const i=new Int32Array(t);for(let o=0;o<t;o++)i[o]=o;this.defaultGroupCache[t]=pr.from({uSamplers:i},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${t}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new cr(this.vertexSrc,n)}const r={tint:new Float32Array([1,1,1,1]),translationMatrix:new $t,default:this.defaultGroupCache[t]};return new Rr(this.programCache[t],r)}generateSampleSrc(t){let r="";r+=`
`,r+=`
`;for(let i=0;i<t;i++)i>0&&(r+=`
else `),i<t-1&&(r+=`if(vTextureId < ${i}.5)`),r+=`
{`,r+=`
	color = texture2D(uSamplers[${i}], vTextureCoord);`,r+=`
}`;return r+=`
`,r+=`
`,r}}class Cu{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function yR(){return!zr.apple.device}function xR(e){let t=!0;const r=J.ADAPTER.getNavigator();if(zr.tablet||zr.phone){if(zr.apple.device){const i=r.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(t=!1)}if(zr.android.device){const i=r.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(t=!1)}}return t?e:4}class Na{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var bR=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,wR=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const sr=class extends Na{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=Em,this.vertexSize=6,this.state=Yr.for2d(),this.size=sr.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??xR(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??yR(),this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return Ct("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return wR}static get defaultFragmentTemplate(){return bR}setShaderGenerator({vertex:e=sr.defaultVertexSrc,fragment:t=sr.defaultFragmentTemplate}={}){this.shaderGenerator=new _R(e,t)}contextChange(){const e=this.renderer.gl;J.PREFER_ENV===Vi.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),sr.defaultMaxTextures),this.maxTextures=KP(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:t}=sr,r=this.size/4,i=Math.floor(r/this.maxTextures)+1;for(;e.length<r;)e.push(new Au);for(;t.length<i;)t.push(new Cu);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:t}=this,r=sr._textureArrayPool,i=this.renderer.batch,n=this._tempBoundTextures,o=this.renderer.textureGC.count;let l=++pt._globalBatch,h=0,u=r[0],f=0;i.copyBoundTextures(n,t);for(let d=0;d<this._bufferSize;++d){const g=e[d];e[d]=null,g._batchEnabled!==l&&(u.count>=t&&(i.boundArray(u,n,l,t),this.buildDrawCalls(u,f,d),f=d,u=r[++h],++l),g._batchEnabled=l,g.touched=o,u.elements[u.count++]=g)}u.count>0&&(i.boundArray(u,n,l,t),this.buildDrawCalls(u,f,this._bufferSize),++h,++l);for(let d=0;d<n.length;d++)n[d]=null;pt._globalBatch=l}buildDrawCalls(e,t,r){const{_bufferedElements:i,_attributeBuffer:n,_indexBuffer:o,vertexSize:l}=this,h=sr._drawCallPool;let u=this._dcIndex,f=this._aIndex,d=this._iIndex,g=h[u];g.start=this._iIndex,g.texArray=e;for(let m=t;m<r;++m){const v=i[m],y=v._texture.baseTexture,w=vm[y.alphaMode?1:0][v.blendMode];i[m]=null,t<m&&g.blend!==w&&(g.size=d-g.start,t=m,g=h[++u],g.texArray=e,g.start=d),this.packInterleavedGeometry(v,n,o,f,d),f+=v.vertexData.length/2*l,d+=v.indices.length,g.blend=w}t<r&&(g.size=d-g.start,++u),this._dcIndex=u,this._aIndex=f,this._iIndex=d}bindAndClearTexArray(e){const t=this.renderer.texture;for(let r=0;r<e.count;r++)t.bind(e.elements[r],e.ids[r]),e.elements[r]=null;e.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:t,_indexBuffer:r}=this;sr.canUploadSameBuffer?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:t,state:r}=this.renderer,i=sr._drawCallPool;let n=null;for(let o=0;o<e;o++){const{texArray:l,type:h,size:u,start:f,blend:d}=i[o];n!==l&&(n=l,this.bindAndClearTexArray(l)),this.state.blendMode=d,r.set(this.state),t.drawElements(h,u,t.UNSIGNED_SHORT,f*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),sr.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=_a(Math.ceil(e/8)),r=Hp(t),i=t*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._aBuffers[i];return n||(this._aBuffers[i]=n=new Eu(i*this.vertexSize*4)),n}getIndexBuffer(e){const t=_a(Math.ceil(e/12)),r=Hp(t),i=t*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._iBuffers[r];return n||(this._iBuffers[r]=n=new Uint16Array(i)),n}packInterleavedGeometry(e,t,r,i,n){const{uint32View:o,float32View:l}=t,h=i/this.vertexSize,u=e.uvs,f=e.indices,d=e.vertexData,g=e._texture.baseTexture._batchLocation,m=Math.min(e.worldAlpha,1),v=m<1&&e._texture.baseTexture.alphaMode?ac(e._tintRGB,m):e._tintRGB+(m*255<<24);for(let y=0;y<d.length;y+=2)l[i++]=d[y],l[i++]=d[y+1],l[i++]=u[y],l[i++]=u[y+1],o[i++]=v,l[i++]=g;for(let y=0;y<f.length;y++)r[n++]=h+f[y]}};let hr=sr;hr.defaultBatchSize=4096;hr.extension={name:"batch",type:Z.RendererPlugin};hr._drawCallPool=[];hr._textureArrayPool=[];nt.add(hr);var ER=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,TR=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const gs=class extends Rr{constructor(e,t,r){const i=cr.from(e||gs.defaultVertexSrc,t||gs.defaultFragmentSrc);super(i,r),this.padding=0,this.resolution=gs.defaultResolution,this.multisample=gs.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Yr}apply(e,t,r,i,n){e.applyFilter(this,t,r,i)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return TR}static get defaultFragmentSrc(){return ER}};let Te=gs;Te.defaultResolution=1;Te.defaultMultisample=ne.NONE;class Rm{constructor(){this.clearBeforeRender=!0,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,1],this._backgroundColorString="#000000",this.color=this._backgroundColor,this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender,t.color&&(this.color=typeof t.color=="string"?oc(t.color):t.color),this.alpha=t.alpha}get color(){return this._backgroundColor}set color(t){this._backgroundColor=t,this._backgroundColorString=mm(t),Cs(t,this._backgroundColorRgba)}get alpha(){return this._backgroundColorRgba[3]}set alpha(t){this._backgroundColorRgba[3]=t}get colorRgba(){return this._backgroundColorRgba}get colorString(){return this._backgroundColorString}destroy(){}}Rm.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"background"};nt.add(Rm);class Mm{constructor(t){this.renderer=t,this.emptyRenderer=new Na(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,r){const{boundTextures:i}=this.renderer.texture;for(let n=r-1;n>=0;--n)t[n]=i[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,r,i,n){const{elements:o,ids:l,count:h}=t;let u=0;for(let f=0;f<h;f++){const d=o[f],g=d._batchLocation;if(g>=0&&g<n&&r[g]===d){l[f]=g;continue}for(;u<n;){const m=r[u];if(m&&m._batchEnabled===i&&m._batchLocation===u){u++;continue}l[f]=u,d._batchLocation=u,r[u]=d;break}}}destroy(){this.renderer=null}}Mm.extension={type:Z.RendererSystem,name:"batch"};nt.add(Mm);let tg=0;class Dm{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=tg++}init(t){if(t.context)this.initFromContext(t.context);else{const r=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:r,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=tg++,this.renderer.runners.contextChange.emit(t);const r=this.renderer.view;r.addEventListener!==void 0&&(r.addEventListener("webglcontextlost",this.handleContextLost,!1),r.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const r=this.createContext(this.renderer.view,t);this.initFromContext(r)}createContext(t,r){let i;if(J.PREFER_ENV>=Vi.WEBGL2&&(i=t.getContext("webgl2",r)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",r)||t.getContext("experimental-webgl",r),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,r={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,r,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,r,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const r=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),r&&!r.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Dm.extension={type:Z.RendererSystem,name:"context"};nt.add(Dm);class AR extends Fs{upload(t,r,i){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===gr.UNPACK);const o=r.realWidth,l=r.realHeight;return i.width===o&&i.height===l?n.texSubImage2D(r.target,0,0,0,o,l,r.format,i.type,this.data):(i.width=o,i.height=l,n.texImage2D(r.target,0,i.internalFormat,o,l,0,r.format,i.type,this.data)),!0}}class Iu{constructor(t,r){this.width=Math.round(t||100),this.height=Math.round(r||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new dr("disposeFramebuffer"),this.multisample=ne.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,r){return this.colorTextures[t]=r||new pt(null,{scaleMode:Xr.NEAREST,resolution:1,mipmap:Mr.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new pt(new AR(null,{width:this.width,height:this.height}),{scaleMode:Xr.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Mr.OFF,format:V.DEPTH_COMPONENT,type:st.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,r){if(t=Math.round(t),r=Math.round(r),!(t===this.width&&r===this.height)){this.width=t,this.height=r,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const n=this.colorTextures[i],o=n.resolution;n.setSize(t/o,r/o)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,r/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Bm extends pt{constructor(t={}){if(typeof t=="number"){const r=arguments[0],i=arguments[1],n=arguments[2],o=arguments[3];t={width:r,height:i,scaleMode:n,resolution:o}}t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=ne.NONE),super(null,t),this.mipmap=Mr.OFF,this.valid=!0,this.clearColor=[0,0,0,0],this.framebuffer=new Iu(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}resize(t,r){this.framebuffer.resize(t*this.resolution,r*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class pi extends Is{constructor(t){const r=t,i=r.naturalWidth||r.videoWidth||r.width,n=r.naturalHeight||r.videoHeight||r.height;super(i,n),this.source=t,this.noSubImage=!1}static crossOrigin(t,r,i){i===void 0&&!r.startsWith("data:")?t.crossOrigin=jP(r):i!==!1&&(t.crossOrigin=typeof i=="string"?i:"anonymous")}upload(t,r,i,n){const o=t.gl,l=r.realWidth,h=r.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||n.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1&&n.buffered.length===0)return!1;return o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===gr.UNPACK),!this.noSubImage&&r.target===o.TEXTURE_2D&&i.width===l&&i.height===h?o.texSubImage2D(o.TEXTURE_2D,0,0,0,r.format,i.type,n):(i.width=l,i.height=h,o.texImage2D(r.target,0,i.internalFormat,r.format,i.type,n)),!0}update(){if(this.destroyed)return;const t=this.source,r=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(r,i),super.update()}dispose(){this.source=null}}class Om extends pi{constructor(t,r){if(r=r||{},typeof t=="string"){const i=new Image;pi.crossOrigin(i,t,r.crossorigin),i.src=t,t=i}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(r.createBitmap??J.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof r.alphaMode=="number"?r.alphaMode:null,this.bitmap=null,this._load=null,r.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((r,i)=>{const n=this.source;this.url=n.src;const o=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.resize(n.width,n.height),this._load=null,this.createBitmap?r(this.process()):r(this))};n.complete&&n.src?o():(n.onload=o,n.onerror=l=>{i(l),this.onError.emit(l)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const r=globalThis.createImageBitmap,i=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then(n=>n.blob()).then(n=>r(n,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===gr.UNPACK?"premultiply":"none"})).then(n=>this.destroyed?Promise.reject():(this.bitmap=n,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,r,i){if(typeof this.alphaMode=="number"&&(r.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,r,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,r,i,this.bitmap),!this.preserveBitmap){let n=!0;const o=r._glTextures;for(const l in o){const h=o[l];if(h!==i&&h.dirtyId!==r.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class Fm{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,r,i){const n=r.width,o=r.height;if(i){const l=t.width/2/n,h=t.height/2/o,u=t.x/n+l,f=t.y/o+h;i=Xt.add(i,Xt.NW),this.x0=u+l*Xt.uX(i),this.y0=f+h*Xt.uY(i),i=Xt.add(i,2),this.x1=u+l*Xt.uX(i),this.y1=f+h*Xt.uY(i),i=Xt.add(i,2),this.x2=u+l*Xt.uX(i),this.y2=f+h*Xt.uY(i),i=Xt.add(i,2),this.x3=u+l*Xt.uX(i),this.y3=f+h*Xt.uY(i)}else this.x0=t.x/n,this.y0=t.y/o,this.x1=(t.x+t.width)/n,this.y1=t.y/o,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/o,this.x3=t.x/n,this.y3=(t.y+t.height)/o;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const eg=new Fm;function Wo(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}class it extends Ds{constructor(t,r,i,n,o,l){if(super(),this.noFrame=!1,r||(this.noFrame=!0,r=new Et(0,0,1,1)),t instanceof it&&(t=t.baseTexture),this.baseTexture=t,this._frame=r,this.trim=n,this.valid=!1,this._uvs=eg,this.uvMatrix=null,this.orig=i||r,this._rotate=Number(o||0),o===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=l?new At(l.x,l.y):new At(0,0),this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=r:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:r}=this.baseTexture;r!=null&&r.url&&wr[r.url]&&it.removeFromCache(r.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,it.removeFromCache(this),this.textureCacheIds=null}clone(){var n;const t=this._frame.clone(),r=this._frame===this.orig?t:this.orig.clone(),i=new it(this.baseTexture,!this.noFrame&&t,r,(n=this.trim)==null?void 0:n.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===eg&&(this._uvs=new Fm),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,r={},i=J.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let o=null;if(n)o=t;else if(t instanceof pt){if(!t.cacheId){const h=(r==null?void 0:r.pixiIdPrefix)||"pixiid";t.cacheId=`${h}-${Hi()}`,pt.addToCache(t,t.cacheId)}o=t.cacheId}else{if(!t._pixiId){const h=(r==null?void 0:r.pixiIdPrefix)||"pixiid";t._pixiId=`${h}_${Hi()}`}o=t._pixiId}let l=wr[o];if(n&&i&&!l)throw new Error(`The cacheId "${o}" does not exist in TextureCache.`);return!l&&!(t instanceof pt)?(r.resolution||(r.resolution=fi(t)),l=new it(new pt(t,r)),l.baseTexture.cacheId=o,pt.addToCache(l.baseTexture,o),it.addToCache(l,o)):!l&&t instanceof pt&&(l=new it(t),it.addToCache(l,o)),l}static fromURL(t,r){const i=Object.assign({autoLoad:!1},r==null?void 0:r.resourceOptions),n=it.from(t,Object.assign({resourceOptions:i},r),!1),o=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):o.load().then(()=>Promise.resolve(n))}static fromBuffer(t,r,i,n){return new it(pt.fromBuffer(t,r,i,n))}static fromLoader(t,r,i,n){const o=new pt(t,Object.assign({scaleMode:J.SCALE_MODE,resolution:fi(r)},n)),{resource:l}=o;l instanceof Om&&(l.url=r);const h=new it(o);return i||(i=r),pt.addToCache(h.baseTexture,i),it.addToCache(h,i),i!==r&&(pt.addToCache(h.baseTexture,r),it.addToCache(h,r)),h.baseTexture.valid?Promise.resolve(h):new Promise(u=>{h.baseTexture.once("loaded",()=>u(h))})}static addToCache(t,r){r&&(t.textureCacheIds.includes(r)||t.textureCacheIds.push(r),wr[r]&&wr[r]!==t&&console.warn(`Texture added to the cache with an id [${r}] that already had an entry`),wr[r]=t)}static removeFromCache(t){if(typeof t=="string"){const r=wr[t];if(r){const i=r.textureCacheIds.indexOf(t);return i>-1&&r.textureCacheIds.splice(i,1),delete wr[t],r}}else if(t!=null&&t.textureCacheIds){for(let r=0;r<t.textureCacheIds.length;++r)wr[t.textureCacheIds[r]]===t&&delete wr[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:r,y:i,width:n,height:o}=t,l=r+n>this.baseTexture.width,h=i+o>this.baseTexture.height;if(l||h){const u=l&&h?"and":"or",f=`X: ${r} + ${n} = ${r+n} > ${this.baseTexture.width}`,d=`Y: ${i} + ${o} = ${i+o} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${f} ${u} ${d}`)}this.valid=n&&o&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return it._EMPTY||(it._EMPTY=new it(new pt),Wo(it._EMPTY),Wo(it._EMPTY.baseTexture)),it._EMPTY}static get WHITE(){if(!it._WHITE){const t=J.ADAPTER.createCanvas(16,16),r=t.getContext("2d");t.width=16,t.height=16,r.fillStyle="white",r.fillRect(0,0,16,16),it._WHITE=new it(pt.from(t)),Wo(it._WHITE),Wo(it._WHITE.baseTexture)}return it._WHITE}}class gi extends it{constructor(t,r){super(t,r),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,r,i=!0){const n=this.baseTexture.resolution,o=Math.round(t*n)/n,l=Math.round(r*n)/n;this.valid=o>0&&l>0,this._frame.width=this.orig.width=o,this._frame.height=this.orig.height=l,i&&this.baseTexture.resize(o,l),this.updateUvs()}setResolution(t){const{baseTexture:r}=this;r.resolution!==t&&(r.setResolution(t),this.resize(r.width,r.height,!1))}static create(t){return new gi(new Bm(t))}}class Lm{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,r,i=ne.NONE){const n=new Bm(Object.assign({width:t,height:r,resolution:1,multisample:i},this.textureOptions));return new gi(n)}getOptimalTexture(t,r,i=1,n=ne.NONE){let o;t=Math.ceil(t*i-1e-6),r=Math.ceil(r*i-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||r!==this._pixelsHeight?(t=_a(t),r=_a(r),o=((t&65535)<<16|r&65535)>>>0,n>1&&(o+=n*4294967296)):o=n>1?-n:-1,this.texturePool[o]||(this.texturePool[o]=[]);let l=this.texturePool[o].pop();return l||(l=this.createTexture(t,r,n)),l.filterPoolKey=o,l.setResolution(i),l}getFilterTexture(t,r,i){const n=this.getOptimalTexture(t.width,t.height,r||t.resolution,i||ne.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const r=t.filterPoolKey;t.filterFrame=null,this.texturePool[r].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const r in this.texturePool){const i=this.texturePool[r];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const r in this.texturePool){if(!(Number(r)<0))continue;const i=this.texturePool[r];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0);this.texturePool[r]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Lm.SCREEN_KEY=-1;class SR extends di{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Nm extends di{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new ee(this.vertices),this.uvBuffer=new ee(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,r){let i=0,n=0;return this.uvs[0]=i,this.uvs[1]=n,this.uvs[2]=i+r.width/t.width,this.uvs[3]=n,this.uvs[4]=i+r.width/t.width,this.uvs[5]=n+r.height/t.height,this.uvs[6]=i,this.uvs[7]=n+r.height/t.height,i=r.x,n=r.y,this.vertices[0]=i,this.vertices[1]=n,this.vertices[2]=i+r.width,this.vertices[3]=n,this.vertices[4]=i+r.width,this.vertices[5]=n+r.height,this.vertices[6]=i,this.vertices[7]=n+r.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class CR{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=ne.NONE,this.sourceFrame=new Et,this.destinationFrame=new Et,this.bindingSourceFrame=new Et,this.bindingDestinationFrame=new Et,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const $o=[new At,new At,new At,new At],Fh=new $t;class km{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Lm,this.statePool=[],this.quad=new SR,this.quadUv=new Nm,this.tempRect=new Et,this.activeState={},this.globalUniforms=new pr({outputFrame:new Et,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,r){const i=this.renderer,n=this.defaultFilterStack,o=this.statePool.pop()||new CR,l=this.renderer.renderTexture;let h=r[0].resolution,u=r[0].multisample,f=r[0].padding,d=r[0].autoFit,g=r[0].legacy??!0;for(let y=1;y<r.length;y++){const w=r[y];h=Math.min(h,w.resolution),u=Math.min(u,w.multisample),f=this.useMaxPadding?Math.max(f,w.padding):f+w.padding,d=d&&w.autoFit,g=g||(w.legacy??!0)}n.length===1&&(this.defaultFilterStack[0].renderTexture=l.current),n.push(o),o.resolution=h,o.multisample=u,o.legacy=g,o.target=t,o.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),o.sourceFrame.pad(f);const m=this.tempRect.copyFrom(l.sourceFrame);i.projection.transform&&this.transformAABB(Fh.copyFrom(i.projection.transform).invert(),m),d?(o.sourceFrame.fit(m),(o.sourceFrame.width<=0||o.sourceFrame.height<=0)&&(o.sourceFrame.width=0,o.sourceFrame.height=0)):o.sourceFrame.intersects(m)||(o.sourceFrame.width=0,o.sourceFrame.height=0),this.roundFrame(o.sourceFrame,l.current?l.current.resolution:i.resolution,l.sourceFrame,l.destinationFrame,i.projection.transform),o.renderTexture=this.getOptimalFilterTexture(o.sourceFrame.width,o.sourceFrame.height,h,u),o.filters=r,o.destinationFrame.width=o.renderTexture.width,o.destinationFrame.height=o.renderTexture.height;const v=this.tempRect;v.x=0,v.y=0,v.width=o.sourceFrame.width,v.height=o.sourceFrame.height,o.renderTexture.filterFrame=o.sourceFrame,o.bindingSourceFrame.copyFrom(l.sourceFrame),o.bindingDestinationFrame.copyFrom(l.destinationFrame),o.transform=i.projection.transform,i.projection.transform=null,l.bind(o.renderTexture,o.sourceFrame,v),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,r=t.pop(),i=r.filters;this.activeState=r;const n=this.globalUniforms.uniforms;n.outputFrame=r.sourceFrame,n.resolution=r.resolution;const o=n.inputSize,l=n.inputPixel,h=n.inputClamp;if(o[0]=r.destinationFrame.width,o[1]=r.destinationFrame.height,o[2]=1/o[0],o[3]=1/o[1],l[0]=Math.round(o[0]*r.resolution),l[1]=Math.round(o[1]*r.resolution),l[2]=1/l[0],l[3]=1/l[1],h[0]=.5*l[2],h[1]=.5*l[3],h[2]=r.sourceFrame.width*o[2]-.5*l[2],h[3]=r.sourceFrame.height*o[3]-.5*l[3],r.legacy){const f=n.filterArea;f[0]=r.destinationFrame.width,f[1]=r.destinationFrame.height,f[2]=r.sourceFrame.x,f[3]=r.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const u=t[t.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,r.renderTexture,u.renderTexture,Tr.BLEND,r),this.returnFilterTexture(r.renderTexture);else{let f=r.renderTexture,d=this.getOptimalFilterTexture(f.width,f.height,r.resolution);d.filterFrame=f.filterFrame;let g=0;for(g=0;g<i.length-1;++g){g===1&&r.multisample>1&&(d=this.getOptimalFilterTexture(f.width,f.height,r.resolution),d.filterFrame=f.filterFrame),i[g].apply(this,f,d,Tr.CLEAR,r);const m=f;f=d,d=m}i[g].apply(this,f,u.renderTexture,Tr.BLEND,r),g>1&&r.multisample>1&&this.returnFilterTexture(r.renderTexture),this.returnFilterTexture(f),this.returnFilterTexture(d)}r.clear(),this.statePool.push(r)}bindAndClear(t,r=Tr.CLEAR){const{renderTexture:i,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t!=null&&t.filterFrame){const l=this.tempRect;l.x=0,l.y=0,l.width=t.filterFrame.width,l.height=t.filterFrame.height,i.bind(t,t.filterFrame,l)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const o=n.stateId&1||this.forceClear;(r===Tr.CLEAR||r===Tr.BLIT&&o)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,r,i,n){const o=this.renderer;o.state.set(t.state),this.bindAndClear(i,n),t.uniforms.uSampler=r,t.uniforms.filterGlobals=this.globalUniforms,o.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(r._frame,r.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(Ir.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(Ir.TRIANGLE_STRIP))}calculateSpriteMatrix(t,r){const{sourceFrame:i,destinationFrame:n}=this.activeState,{orig:o}=r._texture,l=t.set(n.width,0,0,n.height,i.x,i.y),h=r.worldTransform.copyTo($t.TEMP_MATRIX);return h.invert(),l.prepend(h),l.scale(1/o.width,1/o.height),l.translate(r.anchor.x,r.anchor.y),l}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,r,i=1,n=ne.NONE){return this.texturePool.getOptimalTexture(t,r,i,n)}getFilterTexture(t,r,i){if(typeof t=="number"){const o=t;t=r,r=o}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,r||t.resolution,i||ne.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,r){const i=$o[0],n=$o[1],o=$o[2],l=$o[3];i.set(r.left,r.top),n.set(r.left,r.bottom),o.set(r.right,r.top),l.set(r.right,r.bottom),t.apply(i,i),t.apply(n,n),t.apply(o,o),t.apply(l,l);const h=Math.min(i.x,n.x,o.x,l.x),u=Math.min(i.y,n.y,o.y,l.y),f=Math.max(i.x,n.x,o.x,l.x),d=Math.max(i.y,n.y,o.y,l.y);r.x=h,r.y=u,r.width=f-h,r.height=d-u}roundFrame(t,r,i,n,o){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(o){const{a:l,b:h,c:u,d:f}=o;if((Math.abs(h)>1e-4||Math.abs(u)>1e-4)&&(Math.abs(l)>1e-4||Math.abs(f)>1e-4))return}o=o?Fh.copyFrom(o):Fh.identity(),o.translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.transformAABB(o,t),t.ceil(r),this.transformAABB(o.invert(),t)}}}km.extension={type:Z.RendererSystem,name:"filter"};nt.add(km);class IR{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=ne.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const PR=new Et;class Um{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Iu(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Et,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let r=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;J.PREFER_ENV===Vi.WEBGL_LEGACY&&(r=null,i=null),r?t.drawBuffers=n=>r.drawBuffersWEBGL(n):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,r,i=0){const{gl:n}=this;if(t){const o=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,o.framebuffer)),o.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,o.mipLevel=i),o.dirtyId!==t.dirtyId&&(o.dirtyId=t.dirtyId,o.dirtyFormat!==t.dirtyFormat?(o.dirtyFormat=t.dirtyFormat,o.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):o.dirtySize!==t.dirtySize&&(o.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let l=0;l<t.colorTextures.length;l++){const h=t.colorTextures[l];this.renderer.texture.unbind(h.parentTextureArray||h)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),r){const l=r.width>>i,h=r.height>>i,u=l/r.width;this.setViewport(r.x*u,r.y*u,l,h)}else{const l=t.width>>i,h=t.height>>i;this.setViewport(0,0,l,h)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),r?this.setViewport(r.x,r.y,r.width,r.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,r,i,n){const o=this.viewport;t=Math.round(t),r=Math.round(r),i=Math.round(i),n=Math.round(n),(o.width!==i||o.height!==n||o.x!==t||o.y!==r)&&(o.x=t,o.y=r,o.width=i,o.height=n,this.gl.viewport(t,r,i,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,r,i,n,o=ou.COLOR|ou.DEPTH){const{gl:l}=this;l.clearColor(t,r,i,n),l.clear(o)}initFramebuffer(t){const{gl:r}=this,i=new IR(r.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){const{gl:r}=this,i=t.glFramebuffers[this.CONTEXT_UID];i.stencil&&(r.bindRenderbuffer(r.RENDERBUFFER,i.stencil),i.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,r.DEPTH24_STENCIL8,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t.width,t.height));const n=t.colorTextures;let o=n.length;r.drawBuffers||(o=Math.min(o,1));for(let l=0;l<o;l++){const h=n[l],u=h.parentTextureArray||h;this.renderer.texture.bind(u,0),l===0&&i.msaaBuffer&&(r.bindRenderbuffer(r.RENDERBUFFER,i.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,r){const{gl:i}=this,n=t.glFramebuffers[this.CONTEXT_UID],o=t.colorTextures;let l=o.length;i.drawBuffers||(l=Math.min(l,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||i.createRenderbuffer():n.msaaBuffer&&(i.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const h=[];for(let u=0;u<l;u++){const f=o[u],d=f.parentTextureArray||f;this.renderer.texture.bind(d,0),u===0&&n.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,n.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,d._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+u,f.target,d._glTextures[this.CONTEXT_UID].texture,r),h.push(i.COLOR_ATTACHMENT0+u))}if(h.length>1&&i.drawBuffers(h),t.depthTexture&&this.writeDepthTexture){const f=t.depthTexture;this.renderer.texture.bind(f,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,f._glTextures[this.CONTEXT_UID].texture,r)}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(n.stencil=n.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,n.stencil),n.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,n.stencil)):n.stencil&&(i.deleteRenderbuffer(n.stencil),n.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:r}=this;let i=ne.NONE;if(t<=1||r===null)return i;for(let n=0;n<r.length;n++)if(r[n]<=t){i=r[n];break}return i===1&&(i=ne.NONE),i}blit(t,r,i){const{current:n,renderer:o,gl:l,CONTEXT_UID:h}=this;if(o.context.webGLVersion!==2||!n)return;const u=n.glFramebuffers[h];if(!u)return;if(!t){if(!u.msaaBuffer)return;const d=n.colorTextures[0];if(!d)return;u.blitFramebuffer||(u.blitFramebuffer=new Iu(n.width,n.height),u.blitFramebuffer.addColorTexture(0,d)),t=u.blitFramebuffer,t.colorTextures[0]!==d&&(t.colorTextures[0]=d,t.dirtyId++,t.dirtyFormat++),(t.width!==n.width||t.height!==n.height)&&(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}r||(r=PR,r.width=n.width,r.height=n.height),i||(i=r);const f=r.width===i.width&&r.height===i.height;this.bind(t),l.bindFramebuffer(l.READ_FRAMEBUFFER,u.framebuffer),l.blitFramebuffer(r.left,r.top,r.right,r.bottom,i.left,i.top,i.right,i.bottom,l.COLOR_BUFFER_BIT,f?l.NEAREST:l.LINEAR)}disposeFramebuffer(t,r){const i=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];const o=this.managedFramebuffers.indexOf(t);o>=0&&this.managedFramebuffers.splice(o,1),t.disposeRunner.remove(this),r||(n.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&n.deleteRenderbuffer(i.msaaBuffer),i.stencil&&n.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&i.blitFramebuffer.dispose()}disposeAll(t){const r=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<r.length;i++)this.disposeFramebuffer(r[i],t)}forceStencil(){const t=this.current;if(!t)return;const r=t.glFramebuffers[this.CONTEXT_UID];if(!r||r.stencil)return;t.stencil=!0;const i=t.width,n=t.height,o=this.gl,l=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,l),r.msaaBuffer?o.renderbufferStorageMultisample(o.RENDERBUFFER,r.multisample,o.DEPTH24_STENCIL8,i,n):o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,i,n),r.stencil=l,o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,l)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Et}destroy(){this.renderer=null}}Um.extension={type:Z.RendererSystem,name:"framebuffer"};nt.add(Um);const Lh={5126:4,5123:2,5121:1};class Gm{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,r=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,r.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;J.PREFER_ENV===Vi.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=()=>i.createVertexArrayOES(),t.bindVertexArray=n=>i.bindVertexArrayOES(n),t.deleteVertexArray=n=>i.deleteVertexArrayOES(n)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(r.webGLVersion!==2){const i=t.getExtension("ANGLE_instanced_arrays");i?(t.vertexAttribDivisor=(n,o)=>i.vertexAttribDivisorANGLE(n,o),t.drawElementsInstanced=(n,o,l,h,u)=>i.drawElementsInstancedANGLE(n,o,l,h,u),t.drawArraysInstanced=(n,o,l,h)=>i.drawArraysInstancedANGLE(n,o,l,h)):this.hasInstance=!1}this.canUseUInt32ElementIndex=r.webGLVersion===2||!!r.extensions.uint32ElementIndex}bind(t,r){r=r||this.renderer.shader.shader;const{gl:i}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],o=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},o=!0);const l=n[r.program.id]||this.initGeometryVao(t,r,o);this._activeGeometry=t,this._activeVao!==l&&(this._activeVao=l,this.hasVao?i.bindVertexArray(l):this.activateVao(t,r.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,r=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){const n=t.buffers[i];r.update(n)}}checkCompatibility(t,r){const i=t.attributes,n=r.attributeData;for(const o in n)if(!i[o])throw new Error(`shader and geometry incompatible, geometry missing the "${o}" attribute`)}getSignature(t,r){const i=t.attributes,n=r.attributeData,o=["g",t.id];for(const l in i)n[l]&&o.push(l,n[l].location);return o.join("-")}initGeometryVao(t,r,i=!0){const n=this.gl,o=this.CONTEXT_UID,l=this.renderer.buffer,h=r.program;h.glPrograms[o]||this.renderer.shader.generateProgram(r),this.checkCompatibility(t,h);const u=this.getSignature(t,h),f=t.glVertexArrayObjects[this.CONTEXT_UID];let d=f[u];if(d)return f[h.id]=d,d;const g=t.buffers,m=t.attributes,v={},y={};for(const w in g)v[w]=0,y[w]=0;for(const w in m)!m[w].size&&h.attributeData[w]?m[w].size=h.attributeData[w].size:m[w].size||console.warn(`PIXI Geometry attribute '${w}' size cannot be determined (likely the bound shader does not have the attribute)`),v[m[w].buffer]+=m[w].size*Lh[m[w].type];for(const w in m){const x=m[w],A=x.size;x.stride===void 0&&(v[x.buffer]===A*Lh[x.type]?x.stride=0:x.stride=v[x.buffer]),x.start===void 0&&(x.start=y[x.buffer],y[x.buffer]+=A*Lh[x.type])}d=n.createVertexArray(),n.bindVertexArray(d);for(let w=0;w<g.length;w++){const x=g[w];l.bind(x),i&&x._glBuffers[o].refCount++}return this.activateVao(t,h),f[h.id]=d,f[u]=d,n.bindVertexArray(null),l.unbind(Pr.ARRAY_BUFFER),d}disposeGeometry(t,r){var h;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,o=t.buffers,l=(h=this.renderer)==null?void 0:h.buffer;if(t.disposeRunner.remove(this),!!i){if(l)for(let u=0;u<o.length;u++){const f=o[u]._glBuffers[this.CONTEXT_UID];f&&(f.refCount--,f.refCount===0&&!r&&l.dispose(o[u],r))}if(!r){for(const u in i)if(u[0]==="g"){const f=i[u];this._activeVao===f&&this.unbind(),n.deleteVertexArray(f)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const r=Object.keys(this.managedGeometries);for(let i=0;i<r.length;i++)this.disposeGeometry(this.managedGeometries[r[i]],t)}activateVao(t,r){const i=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,l=t.buffers,h=t.attributes;t.indexBuffer&&o.bind(t.indexBuffer);let u=null;for(const f in h){const d=h[f],g=l[d.buffer],m=g._glBuffers[n];if(r.attributeData[f]){u!==m&&(o.bind(g),u=m);const v=r.attributeData[f].location;if(i.enableVertexAttribArray(v),i.vertexAttribPointer(v,d.size,d.type||i.FLOAT,d.normalized,d.stride,d.start),d.instance)if(this.hasInstance)i.vertexAttribDivisor(v,d.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,r,i,n){const{gl:o}=this,l=this._activeGeometry;if(l.indexBuffer){const h=l.indexBuffer.data.BYTES_PER_ELEMENT,u=h===2?o.UNSIGNED_SHORT:o.UNSIGNED_INT;h===2||h===4&&this.canUseUInt32ElementIndex?l.instanced?o.drawElementsInstanced(t,r||l.indexBuffer.data.length,u,(i||0)*h,n||1):o.drawElements(t,r||l.indexBuffer.data.length,u,(i||0)*h):console.warn("unsupported index buffer type: uint32")}else l.instanced?o.drawArraysInstanced(t,i,r||l.getSize(),n||1):o.drawArrays(t,i,r||l.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Gm.extension={type:Z.RendererSystem,name:"geometry"};nt.add(Gm);const rg=new $t;class Wm{constructor(t,r){this._texture=t,this.mapCoord=new $t,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof r>"u"?.5:r,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,r){r===void 0&&(r=t);const i=this.mapCoord;for(let n=0;n<t.length;n+=2){const o=t[n],l=t[n+1];r[n]=o*i.a+l*i.c+i.tx,r[n+1]=o*i.b+l*i.d+i.ty}return r}update(t){const r=this._texture;if(!r||!r.valid||!t&&this._textureID===r._updateID)return!1;this._textureID=r._updateID,this._updateID++;const i=r._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const n=r.orig,o=r.trim;o&&(rg.set(n.width/o.width,0,0,n.height/o.height,-o.x/o.width,-o.y/o.height),this.mapCoord.append(rg));const l=r.baseTexture,h=this.uClampFrame,u=this.clampMargin/l.resolution,f=this.clampOffset;return h[0]=(r._frame.x+u+f)/l.width,h[1]=(r._frame.y+u+f)/l.height,h[2]=(r._frame.x+r._frame.width-u+f)/l.width,h[3]=(r._frame.y+r._frame.height-u+f)/l.height,this.uClampOffset[0]=f/l.realWidth,this.uClampOffset[1]=f/l.realHeight,this.isSimple=r._frame.width===l.width&&r._frame.height===l.height&&r.rotate===0,!0}}var RR=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,MR=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class DR extends Te{constructor(t,r,i){let n=null;typeof t!="string"&&r===void 0&&i===void 0&&(n=t,t=void 0,r=void 0,i=void 0),super(t||MR,r||RR,i),this.maskSprite=n,this.maskMatrix=new $t}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,r,i,n){const o=this._maskSprite,l=o._texture;l.valid&&(l.uvMatrix||(l.uvMatrix=new Wm(l,0)),l.uvMatrix.update(),this.uniforms.npmAlpha=l.baseTexture.alphaMode?0:1,this.uniforms.mask=l,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,o).prepend(l.uvMatrix.mapCoord),this.uniforms.alpha=o.worldAlpha,this.uniforms.maskClamp=l.uvMatrix.uClampFrame,t.applyFilter(this,r,i,n))}}class BR{constructor(t=null){this.type=he.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=J.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=he.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class $m{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,r){let i=r;if(!i.isMaskData){const o=this.maskDataPool.pop()||new BR;o.pooled=!0,o.maskObject=r,i=o}const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(n),i._colorMask=n?n._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==he.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case he.SCISSOR:this.renderer.scissor.push(i);break;case he.STENCIL:this.renderer.stencil.push(i);break;case he.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case he.COLOR:this.pushColorMask(i);break}i.type===he.SPRITE&&this.maskStack.push(i)}pop(t){const r=this.maskStack.pop();if(!(!r||r._target!==t)){if(r.enabled)switch(r.type){case he.SCISSOR:this.renderer.scissor.pop(r);break;case he.STENCIL:this.renderer.stencil.pop(r.maskObject);break;case he.SPRITE:this.popSpriteMask(r);break;case he.COLOR:this.popColorMask(r);break}if(r.reset(),r.pooled&&this.maskDataPool.push(r),this.maskStack.length!==0){const i=this.maskStack[this.maskStack.length-1];i.type===he.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(t){const r=t.maskObject;r?r.isSprite?t.type=he.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=he.SCISSOR:t.type=he.STENCIL:t.type=he.COLOR}pushSpriteMask(t){const{maskObject:r}=t,i=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new DR]));const o=this.renderer,l=o.renderTexture;let h,u;if(l.current){const d=l.current;h=t.resolution||d.resolution,u=t.multisample??d.multisample}else h=t.resolution||o.resolution,u=t.multisample??o.multisample;n[0].resolution=h,n[0].multisample=u,n[0].maskSprite=r;const f=i.filterArea;i.filterArea=r.getBounds(!0),o.filter.push(i,n),i.filterArea=f,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const r=t._colorMask,i=t._colorMask=r&t.colorMask;i!==r&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(t){const r=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==r&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}}$m.extension={type:Z.RendererSystem,name:"mask"};nt.add($m);class Hm{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:r}=this.renderer,i=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==i&&(n===0?r.disable(this.glConst):(r.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const ig=new $t,ng=[],oa=class extends Hm{constructor(e){super(e),this.glConst=J.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:r}=e,{renderer:i}=this,n=i.renderTexture,o=r.getBounds(!0,ng.pop()??new Et);this.roundFrameToPixels(o,n.current?n.current.resolution:i.resolution,n.sourceFrame,n.destinationFrame,i.projection.transform),t&&o.fit(t),e._scissorRectLocal=o}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:r,c:i,d:n}=e;return(Math.abs(r)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4)}testScissor(e){const{maskObject:t}=e;if(!t.isFastRect||!t.isFastRect()||oa.isMatrixRotated(t.worldTransform)||oa.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const r=e._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(e,t,r,i,n){oa.isMatrixRotated(n)||(n=n?ig.copyFrom(n):ig.identity(),n.translate(-r.x,-r.y).scale(i.width/r.width,i.height/r.height).translate(i.x,i.y),this.renderer.filter.transformAABB(n,e),e.fit(i),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&ng.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=e.y:t=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};let Xm=oa;Xm.extension={type:Z.RendererSystem,name:"scissor"};nt.add(Xm);class zm extends Hm{constructor(t){super(t),this.glConst=J.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const r=t.maskObject,{gl:i}=this.renderer,n=t._stencilCounter;n===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;const o=t._colorMask;o!==0&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,n,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),r.renderable=!0,r.render(this.renderer),this.renderer.batch.flush(),r.renderable=!1,o!==0&&(t._colorMask=o,i.colorMask((o&1)!==0,(o&2)!==0,(o&4)!==0,(o&8)!==0)),this._useCurrent()}pop(t){const r=this.renderer.gl;if(this.getStackLength()===0)r.disable(r.STENCIL_TEST);else{const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,n=i?i._colorMask:15;n!==0&&(i._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilOp(r.KEEP,r.KEEP,r.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(i._colorMask=n,r.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}zm.extension={type:Z.RendererSystem,name:"stencil"};nt.add(zm);class Vm{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return Ct("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return Ct("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return Ct("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(t){for(const r in t)this.plugins[r]=new t[r](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}Vm.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"_plugin"};nt.add(Vm);class jm{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new $t,this.transform=null}update(t,r,i,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=r||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,n),this.transform&&this.projectionMatrix.append(this.transform);const o=this.renderer;o.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,o.globalUniforms.update(),o.shader.shader&&o.shader.syncUniformGroup(o.shader.shader.uniforms.globals)}calculateProjection(t,r,i,n){const o=this.projectionMatrix,l=n?-1:1;o.identity(),o.a=1/r.width*2,o.d=l*(1/r.height*2),o.tx=-1-r.x*o.a,o.ty=-l-r.y*o.d}setTransform(t){}destroy(){this.renderer=null}}jm.extension={type:Z.RendererSystem,name:"projection"};nt.add(jm);const OR=new cc;class Ym{constructor(t){this.renderer=t,this._tempMatrix=new $t}generateTexture(t,r){const{region:i,...n}=r||{},o=i||t.getLocalBounds(null,!0);o.width===0&&(o.width=1),o.height===0&&(o.height=1);const l=gi.create({width:o.width,height:o.height,...n});this._tempMatrix.tx=-o.x,this._tempMatrix.ty=-o.y;const h=t.transform;return t.transform=OR,this.renderer.render(t,{renderTexture:l,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=h,l}destroy(){}}Ym.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"textureGenerator"};nt.add(Ym);const Ii=new Et,fs=new Et;class qm{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Et,this.destinationFrame=new Et,this.viewportFrame=new Et}bind(t=null,r,i){const n=this.renderer;this.current=t;let o,l,h;t?(o=t.baseTexture,h=o.resolution,r||(Ii.width=t.frame.width,Ii.height=t.frame.height,r=Ii),i||(fs.x=t.frame.x,fs.y=t.frame.y,fs.width=r.width,fs.height=r.height,i=fs),l=o.framebuffer):(h=n.resolution,r||(Ii.width=n._view.screen.width,Ii.height=n._view.screen.height,r=Ii),i||(i=Ii,i.width=r.width,i.height=r.height));const u=this.viewportFrame;u.x=i.x*h,u.y=i.y*h,u.width=i.width*h,u.height=i.height*h,t||(u.y=n.view.height-(u.y+u.height)),u.ceil(),this.renderer.framebuffer.bind(l,u),this.renderer.projection.update(i,r,h,!l),t?this.renderer.mask.setMaskStack(o.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(r),this.destinationFrame.copyFrom(i)}clear(t,r){this.current?t=t||this.current.baseTexture.clearColor:t=t||this.renderer.background.colorRgba;const i=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer._view.screen,o=i.width!==n.width||i.height!==n.height;if(o){let{x:l,y:h,width:u,height:f}=this.viewportFrame;l=Math.round(l),h=Math.round(h),u=Math.round(u),f=Math.round(f),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,h,u,f)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],r),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}qm.extension={type:Z.RendererSystem,name:"renderTexture"};nt.add(qm);class FR{constructor(t,r){this.program=t,this.uniformData=r,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function LR(e,t){const r={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){const o=t.getActiveAttrib(e,n);if(o.name.startsWith("gl_"))continue;const l=Pm(t,o.type),h={type:l,name:o.name,size:Im(l),location:t.getAttribLocation(e,o.name)};r[o.name]=h}return r}function NR(e,t){const r={},i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let n=0;n<i;n++){const o=t.getActiveUniform(e,n),l=o.name.replace(/\[.*?\]$/,""),h=!!o.name.match(/\[.*?\]$/),u=Pm(t,o.type);r[l]={name:l,index:n,type:u,size:o.size,isArray:h,value:Sm(u,o.size)}}return r}function kR(e,t){var u;const r=Kp(e,e.VERTEX_SHADER,t.vertexSrc),i=Kp(e,e.FRAGMENT_SHADER,t.fragmentSrc),n=e.createProgram();e.attachShader(n,r),e.attachShader(n,i);const o=(u=t.extra)==null?void 0:u.transformFeedbackVaryings;if(o&&(typeof e.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):e.transformFeedbackVaryings(n,o.names,o.bufferMode==="separate"?e.SEPARATE_ATTRIBS:e.INTERLEAVED_ATTRIBS)),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)||dR(e,n,r,i),t.attributeData=LR(n,e),t.uniformData=NR(n,e),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const f=Object.keys(t.attributeData);f.sort((d,g)=>d>g?1:-1);for(let d=0;d<f.length;d++)t.attributeData[f[d]].location=d,e.bindAttribLocation(n,d,f[d]);e.linkProgram(n)}e.deleteShader(r),e.deleteShader(i);const l={};for(const f in t.uniformData){const d=t.uniformData[f];l[f]={location:e.getUniformLocation(n,f),value:Sm(d.type,d.size)}}return new FR(n,l)}function UR(e,t,r,i,n){r.buffer.update(n)}const GR={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Km={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function WR(e){const t=e.map(o=>({data:o,offset:0,dataLen:0,dirty:0}));let r=0,i=0,n=0;for(let o=0;o<t.length;o++){const l=t[o];if(r=Km[l.data.type],l.data.size>1&&(r=Math.max(r,16)*l.data.size),l.dataLen=r,i%r!==0&&i<16){const h=i%r%16;i+=h,n+=h}i+r>16?(n=Math.ceil(n/16)*16,l.offset=n,n+=r,i=r):(l.offset=n,i+=r,n+=r)}return n=Math.ceil(n/16)*16,{uboElements:t,size:n}}function $R(e,t){const r=[];for(const i in e)t[i]&&r.push(t[i]);return r.sort((i,n)=>i.index-n.index),r}function HR(e,t){if(!e.autoManage)return{size:0,syncFunc:UR};const r=$R(e.uniforms,t),{uboElements:i,size:n}=WR(r),o=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let l=0;l<i.length;l++){const h=i[l],u=e.uniforms[h.data.name],f=h.data.name;let d=!1;for(let g=0;g<In.length;g++){const m=In[g];if(m.codeUbo&&m.test(h.data,u)){o.push(`offset = ${h.offset/4};`,In[g].codeUbo(h.data.name,u)),d=!0;break}}if(!d)if(h.data.size>1){const g=Im(h.data.type),m=Math.max(Km[h.data.type]/16,1),v=g/m,y=(4-v%4)%4;o.push(`
                cv = ud.${f}.value;
                v = uv.${f};
                offset = ${h.offset/4};

                t = 0;

                for(var i=0; i < ${h.data.size*m}; i++)
                {
                    for(var j = 0; j < ${v}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${y};
                }

                `)}else{const g=GR[h.data.type];o.push(`
                cv = ud.${f}.value;
                v = uv.${f};
                offset = ${h.offset/4};
                ${g};
                `)}}return o.push(`
       renderer.buffer.update(buffer);
    `),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",o.join(`
`))}}let XR=0;const Ho={textureCount:0,uboCount:0};class Zm{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=XR++}systemCheck(){if(!gR())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,r){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const i=t.program,n=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(n.program)),r||(Ho.textureCount=0,Ho.uboCount=0,this.syncUniformGroup(t.uniformGroup,Ho)),n}setUniforms(t){const r=this.shader.program,i=r.glPrograms[this.renderer.CONTEXT_UID];r.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,r){const i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,r))}syncUniforms(t,r,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(r.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){const r=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[r]||(this.cache[r]=uR(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[r],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,r){const i=this.getGlProgram();if(!t.static||t.dirtyId!==0||!i.uniformGroups[t.id]){t.dirtyId=0;const n=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,r);t.buffer.update(),n(i.uniformData,t.uniforms,this.renderer,Ho,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[r])}createSyncBufferGroup(t,r,i){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const o=this.gl.getUniformBlockIndex(r.program,i);r.uniformBufferBindings[i]=this.shader.uniformBindCount,n.uniformBlockBinding(r.program,o,this.shader.uniformBindCount),this.shader.uniformBindCount++;const l=this.getSignature(t,this.shader.program.uniformData,"ubo");let h=this._uboCache[l];if(h||(h=this._uboCache[l]=HR(t,this.shader.program.uniformData)),t.autoManage){const u=new Float32Array(h.size/4);t.buffer.update(u)}return r.uniformGroups[t.id]=h.syncFunc,r.uniformGroups[t.id]}getSignature(t,r,i){const n=t.uniforms,o=[`${i}-`];for(const l in n)o.push(l),r[l]&&o.push(r[l].type);return o.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const r=this.gl,i=t.program,n=kR(r,i);return i.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Zm.extension={type:Z.RendererSystem,name:"shader"};nt.add(Zm);class Jm{constructor(t){this.renderer=t}run(t){const r=this.renderer;r.emitWithCustomOptions(r.runners.init,t),t.hello&&console.log(`PixiJS 7.1.0 - ${r.rendererLogId} - https://pixijs.com`),r.resize(this.renderer.screen.width,this.renderer.screen.height)}destroy(){}}Jm.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"startup"};nt.add(Jm);function zR(e,t=[]){return t[ut.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.ADD]=[e.ONE,e.ONE],t[ut.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.NONE]=[0,0],t[ut.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[ut.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ut.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[ut.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[ut.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[ut.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[ut.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[ut.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[ut.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[ut.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[ut.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t}const VR=0,jR=1,YR=2,qR=3,KR=4,ZR=5,Pu=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=ut.NONE,this._blendEq=!1,this.map=[],this.map[VR]=this.setBlend,this.map[jR]=this.setOffset,this.map[YR]=this.setCullFace,this.map[qR]=this.setDepthTest,this.map[KR]=this.setFrontFace,this.map[ZR]=this.setDepthMask,this.checks=[],this.defaultState=new Yr,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=zR(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,r=0;for(;t;)t&1&&this.map[r].call(this,!!(e.data&1<<r)),t=t>>1,r++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this.updateCheck(Pu.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(Pu.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],r=this.gl;t.length===2?r.blendFunc(t[0],t[1]):r.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,r.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const r=this.checks.indexOf(e);t&&r===-1?this.checks.push(e):!t&&r!==-1&&this.checks.splice(r,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let Qm=Pu;Qm.extension={type:Z.RendererSystem,name:"state"};nt.add(Qm);class JR extends Ds{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const r=(t.priority??[]).filter(n=>t.systems[n]),i=[...r,...Object.keys(t.systems).filter(n=>!r.includes(n))];for(const n of i)this.addSystem(t.systems[n],n)}addRunners(...t){t.forEach(r=>{this.runners[r]=new dr(r)})}addSystem(t,r){const i=new t(this);if(this[r])throw new Error(`Whoops! The name "${r}" is already in use`);this[r]=i,this._systemsHash[r]=i;for(const n in this.runners)this.runners[n].add(i);return this}emitWithCustomOptions(t,r){const i=Object.keys(this._systemsHash);t.items.forEach(n=>{const o=i.find(l=>this._systemsHash[l]===n);n[t.name](r[o])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const aa=class{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=aa.defaultMaxIdle,this.checkCountMax=aa.defaultCheckCountMax,this.mode=aa.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==Zu.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let r=!1;for(let i=0;i<t.length;i++){const n=t[i];!n.framebuffer&&this.count-n.touched>this.maxIdle&&(e.destroyTexture(n,!0),t[i]=null,r=!0)}if(r){let i=0;for(let n=0;n<t.length;n++)t[n]!==null&&(t[i++]=t[n]);t.length=i}}unload(e){const t=this.renderer.texture,r=e._texture;r&&!r.framebuffer&&t.destroyTexture(r);for(let i=e.children.length-1;i>=0;i--)this.unload(e.children[i])}destroy(){this.renderer=null}};let ur=aa;ur.defaultMode=Zu.AUTO;ur.defaultMaxIdle=60*60;ur.defaultCheckCountMax=60*10;ur.extension={type:Z.RendererSystem,name:"textureGC"};nt.add(ur);class Nh{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=st.UNSIGNED_BYTE,this.internalFormat=V.RGBA,this.samplerType=0}}function QR(e){let t;return"WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?t={[st.UNSIGNED_BYTE]:{[V.RGBA]:e.RGBA8,[V.RGB]:e.RGB8,[V.RG]:e.RG8,[V.RED]:e.R8,[V.RGBA_INTEGER]:e.RGBA8UI,[V.RGB_INTEGER]:e.RGB8UI,[V.RG_INTEGER]:e.RG8UI,[V.RED_INTEGER]:e.R8UI,[V.ALPHA]:e.ALPHA,[V.LUMINANCE]:e.LUMINANCE,[V.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[st.BYTE]:{[V.RGBA]:e.RGBA8_SNORM,[V.RGB]:e.RGB8_SNORM,[V.RG]:e.RG8_SNORM,[V.RED]:e.R8_SNORM,[V.RGBA_INTEGER]:e.RGBA8I,[V.RGB_INTEGER]:e.RGB8I,[V.RG_INTEGER]:e.RG8I,[V.RED_INTEGER]:e.R8I},[st.UNSIGNED_SHORT]:{[V.RGBA_INTEGER]:e.RGBA16UI,[V.RGB_INTEGER]:e.RGB16UI,[V.RG_INTEGER]:e.RG16UI,[V.RED_INTEGER]:e.R16UI,[V.DEPTH_COMPONENT]:e.DEPTH_COMPONENT16},[st.SHORT]:{[V.RGBA_INTEGER]:e.RGBA16I,[V.RGB_INTEGER]:e.RGB16I,[V.RG_INTEGER]:e.RG16I,[V.RED_INTEGER]:e.R16I},[st.UNSIGNED_INT]:{[V.RGBA_INTEGER]:e.RGBA32UI,[V.RGB_INTEGER]:e.RGB32UI,[V.RG_INTEGER]:e.RG32UI,[V.RED_INTEGER]:e.R32UI,[V.DEPTH_COMPONENT]:e.DEPTH_COMPONENT24},[st.INT]:{[V.RGBA_INTEGER]:e.RGBA32I,[V.RGB_INTEGER]:e.RGB32I,[V.RG_INTEGER]:e.RG32I,[V.RED_INTEGER]:e.R32I},[st.FLOAT]:{[V.RGBA]:e.RGBA32F,[V.RGB]:e.RGB32F,[V.RG]:e.RG32F,[V.RED]:e.R32F,[V.DEPTH_COMPONENT]:e.DEPTH_COMPONENT32F},[st.HALF_FLOAT]:{[V.RGBA]:e.RGBA16F,[V.RGB]:e.RGB16F,[V.RG]:e.RG16F,[V.RED]:e.R16F},[st.UNSIGNED_SHORT_5_6_5]:{[V.RGB]:e.RGB565},[st.UNSIGNED_SHORT_4_4_4_4]:{[V.RGBA]:e.RGBA4},[st.UNSIGNED_SHORT_5_5_5_1]:{[V.RGBA]:e.RGB5_A1},[st.UNSIGNED_INT_2_10_10_10_REV]:{[V.RGBA]:e.RGB10_A2,[V.RGBA_INTEGER]:e.RGB10_A2UI},[st.UNSIGNED_INT_10F_11F_11F_REV]:{[V.RGB]:e.R11F_G11F_B10F},[st.UNSIGNED_INT_5_9_9_9_REV]:{[V.RGB]:e.RGB9_E5},[st.UNSIGNED_INT_24_8]:{[V.DEPTH_STENCIL]:e.DEPTH24_STENCIL8},[st.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[V.DEPTH_STENCIL]:e.DEPTH32F_STENCIL8}}:t={[st.UNSIGNED_BYTE]:{[V.RGBA]:e.RGBA,[V.RGB]:e.RGB,[V.ALPHA]:e.ALPHA,[V.LUMINANCE]:e.LUMINANCE,[V.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[st.UNSIGNED_SHORT_5_6_5]:{[V.RGB]:e.RGB},[st.UNSIGNED_SHORT_4_4_4_4]:{[V.RGBA]:e.RGBA},[st.UNSIGNED_SHORT_5_5_5_1]:{[V.RGBA]:e.RGBA}},t}class tv{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new pt,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=QR(t);const r=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=r;for(let n=0;n<r;n++)this.boundTextures[n]=null;this.emptyTextures={};const i=new Nh(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Nh(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(t,r=0){const{gl:i}=this;if(t=t==null?void 0:t.castToBaseTexture(),t!=null&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[r]!==t&&(this.currentLocation!==r&&(this.currentLocation=r,i.activeTexture(i.TEXTURE0+r)),i.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==r&&(this.currentLocation=r,i.activeTexture(i.TEXTURE0+r)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[r]=t}else this.currentLocation!==r&&(this.currentLocation=r,i.activeTexture(i.TEXTURE0+r)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[r]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:r,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let n=0;n<i.length;n++)i[n]===this.unknownTexture&&this.bind(null,n)}for(let n=0;n<i.length;n++)i[n]===t&&(this.currentLocation!==n&&(r.activeTexture(r.TEXTURE0+n),this.currentLocation=n),r.bindTexture(t.target,this.emptyTextures[t.target].texture),i[n]=null)}ensureSamplerType(t){const{boundTextures:r,hasIntegerTextures:i,CONTEXT_UID:n}=this;if(i)for(let o=t-1;o>=0;--o){const l=r[o];l&&l._glTextures[n].samplerType!==au.FLOAT&&this.renderer.texture.unbind(l)}}initTexture(t){const r=new Nh(this.gl.createTexture());return r.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=r,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),r}initTextureType(t,r){var i;r.internalFormat=((i=this.internalFormats[t.type])==null?void 0:i[t.format])??t.format,this.webGLVersion===2&&t.type===st.HALF_FLOAT?r.type=this.gl.HALF_FLOAT:r.type=t.type}updateTexture(t){var n;const r=t._glTextures[this.CONTEXT_UID];if(!r)return;const i=this.renderer;if(this.initTextureType(t,r),(n=t.resource)!=null&&n.upload(i,t,r))r.samplerType!==au.FLOAT&&(this.hasIntegerTextures=!0);else{const o=t.realWidth,l=t.realHeight,h=i.gl;(r.width!==o||r.height!==l||r.dirtyId<0)&&(r.width=o,r.height=l,h.texImage2D(t.target,0,r.internalFormat,o,l,0,t.format,r.type,null))}t.dirtyStyleId!==r.dirtyStyleId&&this.updateTextureStyle(t),r.dirtyId=t.dirtyId}destroyTexture(t,r){const{gl:i}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!r)){const n=this.managedTextures.indexOf(t);n!==-1&&Sn(this.managedTextures,n,1)}}updateTextureStyle(t){var i;const r=t._glTextures[this.CONTEXT_UID];r&&((t.mipmap===Mr.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?r.mipmap=!1:r.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?r.wrapMode=ui.CLAMP:r.wrapMode=t.wrapMode,(i=t.resource)!=null&&i.style(this.renderer,t,r)||this.setStyle(t,r),r.dirtyStyleId=t.dirtyStyleId)}setStyle(t,r){const i=this.gl;if(r.mipmap&&t.mipmap!==Mr.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,r.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,r.wrapMode),r.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===Xr.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const n=this.renderer.context.extensions.anisotropicFiltering;if(n&&t.anisotropicLevel>0&&t.scaleMode===Xr.LINEAR){const o=Math.min(t.anisotropicLevel,i.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,o)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===Xr.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===Xr.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}tv.extension={type:Z.RendererSystem,name:"texture"};nt.add(tv);class ev{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:r,CONTEXT_UID:i}=this,n=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,r){const{gl:i,renderer:n}=this;r&&n.shader.bind(r),i.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:r,renderer:i,CONTEXT_UID:n}=this,o=r.createTransformFeedback();t._glTransformFeedbacks[n]=o,r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,o);for(let l=0;l<t.buffers.length;l++){const h=t.buffers[l];h&&(i.buffer.update(h),h._glBuffers[n].refCount++,r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,l,h._glBuffers[n].buffer||null))}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),o}disposeTransformFeedback(t,r){const i=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const o=this.renderer.buffer;if(o)for(let l=0;l<t.buffers.length;l++){const h=t.buffers[l];if(!h)continue;const u=h._glBuffers[this.CONTEXT_UID];u&&(u.refCount--,u.refCount===0&&!r&&o.dispose(h,r))}i&&(r||n.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}ev.extension={type:Z.RendererSystem,name:"transformFeedback"};nt.add(ev);class rv{constructor(t){this.renderer=t}init(t){this.screen=new Et(0,0,t.width,t.height),this.element=t.view||J.ADAPTER.createCanvas(),this.resolution=t.resolution||J.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,r){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(r*this.resolution);const i=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=i,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",i,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var r;t&&((r=this.element.parentNode)==null||r.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}rv.extension={type:[Z.RendererSystem,Z.CanvasRendererSystem],name:"_view"};nt.add(rv);J.PREFER_ENV=Vi.WEBGL2;J.STRICT_TEXTURE_CACHE=!1;Object.defineProperties(J,{WRAP_MODE:{get(){return pt.defaultOptions.wrapMode},set(e){Ct("7.1.0","settings.WRAP_MODE is deprecated, use BaseTeture.defaultOptions.wrapMode"),pt.defaultOptions.wrapMode=e}},SCALE_MODE:{get(){return pt.defaultOptions.scaleMode},set(e){Ct("7.1.0","settings.SCALE_MODE is deprecated, use BaseTeture.defaultOptions.scaleMode"),pt.defaultOptions.scaleMode=e}},MIPMAP_TEXTURES:{get(){return pt.defaultOptions.mipmap},set(e){Ct("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTeture.defaultOptions.mipmap"),pt.defaultOptions.mipmap=e}},ANISOTROPIC_LEVEL:{get(){return pt.defaultOptions.anisotropicLevel},set(e){Ct("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTeture.defaultOptions.anisotropicLevel"),pt.defaultOptions.anisotropicLevel=e}},FILTER_RESOLUTION:{get(){return Ct("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Te.defaultResolution},set(e){Te.defaultResolution=e}},FILTER_MULTISAMPLE:{get(){return Ct("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Te.defaultMultisample},set(e){Te.defaultMultisample=e}},SPRITE_MAX_TEXTURES:{get(){return hr.defaultMaxTextures},set(e){Ct("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),hr.defaultMaxTextures=e}},SPRITE_BATCH_SIZE:{get(){return hr.defaultBatchSize},set(e){Ct("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),hr.defaultBatchSize=e}},CAN_UPLOAD_SAME_BUFFER:{get(){return hr.canUploadSameBuffer},set(e){Ct("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),hr.canUploadSameBuffer=e}},GC_MODE:{get(){return ur.defaultMode},set(e){Ct("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),ur.defaultMode=e}},GC_MAX_IDLE:{get(){return ur.defaultMaxIdle},set(e){Ct("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),ur.defaultMaxIdle=e}},GC_MAX_CHECK_COUNT:{get(){return ur.defaultCheckCountMax},set(e){Ct("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),ur.defaultCheckCountMax=e}},PRECISION_VERTEX:{get(){return cr.defaultVertexPrecision},set(e){Ct("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),cr.defaultVertexPrecision=e}},PRECISION_FRAGMENT:{get(){return cr.defaultFragmentPrecision},set(e){Ct("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),cr.defaultFragmentPrecision=e}}});var Dn=(e=>(e[e.HIGH=25]="HIGH",e[e.NORMAL=0]="NORMAL",e[e.LOW=-25]="LOW",e[e.UTILITY=-50]="UTILITY",e))(Dn||{});class kh{constructor(t,r=null,i=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=r,this.priority=i,this.once=n}match(t,r=null){return this.fn===t&&this.context===r}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const r=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),r}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const r=this.next;return this.next=t?null:r,this.previous=null,r}}const Ne=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new kh(null,null,1/0),this.deltaMS=1/Ne.targetFPMS,this.elapsedMS=1/Ne.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,r=Dn.NORMAL){return this._addListener(new kh(e,t,r))}addOnce(e,t,r=Dn.NORMAL){return this._addListener(new kh(e,t,r,!0))}_addListener(e){let t=this._head.next,r=this._head;if(!t)e.connect(r);else{for(;t;){if(e.priority>t.priority){e.connect(r);break}r=t,t=t.next}e.previous||e.connect(r)}return this._startIfPossible(),this}remove(e,t){let r=this._head.next;for(;r;)r.match(e,t)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const n=e-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=e-n%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*Ne.targetFPMS;const r=this._head;let i=r.next;for(;i;)i=i.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),r=Math.min(Math.max(0,t)/1e3,Ne.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!Ne._shared){const e=Ne._shared=new Ne;e.autoStart=!0,e._protected=!0}return Ne._shared}static get system(){if(!Ne._system){const e=Ne._system=new Ne;e.autoStart=!0,e._protected=!0}return Ne._system}};let Re=Ne;Re.targetFPMS=.06;Object.defineProperties(J,{TARGET_FPMS:{get(){return Re.targetFPMS},set(e){Ct("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Re.targetFPMS=e}}});class iv{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(r){this._ticker&&this._ticker.remove(this.render,this),this._ticker=r,r&&r.add(this.render,this,Dn.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Re.shared:new Re,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}iv.extension=Z.Application;nt.add(iv);const nv=[];nt.handleByList(Z.Renderer,nv);function tM(e){for(const t of nv)if(t.test(e))return new t(e);throw new Error("Unable to auto-detect a suitable renderer.")}var eM=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,rM=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const iM=eM,sv=rM;class ov{constructor(t){this.renderer=t}contextChange(t){let r;if(this.renderer.context.webGLVersion===1){const i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),r=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{const i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),r=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}r>=ne.HIGH?this.multisample=ne.HIGH:r>=ne.MEDIUM?this.multisample=ne.MEDIUM:r>=ne.LOW?this.multisample=ne.LOW:this.multisample=ne.NONE}destroy(){}}ov.extension={type:Z.RendererSystem,name:"_multisample"};nt.add(ov);class nM{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class av{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:r,CONTEXT_UID:i}=this,n=t._glBuffers[i]||this.createGLBuffer(t);r.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:r}=this;r.bindBuffer(t,null)}bindBufferBase(t,r){const{gl:i,CONTEXT_UID:n}=this;if(this.boundBufferBases[r]!==t){const o=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[r]=t,i.bindBufferBase(i.UNIFORM_BUFFER,r,o.buffer)}}bindBufferRange(t,r,i){const{gl:n,CONTEXT_UID:o}=this;i=i||0;const l=t._glBuffers[o]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,r||0,l.buffer,i*256,256)}update(t){const{gl:r,CONTEXT_UID:i}=this,n=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,r.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)r.bufferSubData(t.type,0,t.data);else{const o=t.static?r.STATIC_DRAW:r.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,r.bufferData(t.type,t.data,o)}}dispose(t,r){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const i=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),i&&(r||n.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const r=Object.keys(this.managedBuffers);for(let i=0;i<r.length;i++)this.dispose(this.managedBuffers[r[i]],t)}createGLBuffer(t){const{CONTEXT_UID:r,gl:i}=this;return t._glBuffers[r]=new nM(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[r]}}av.extension={type:Z.RendererSystem,name:"buffer"};nt.add(av);class lv{constructor(t){this.renderer=t}render(t,r){const i=this.renderer;let n,o,l,h;if(r&&(n=r.renderTexture,o=r.clear,l=r.transform,h=r.skipUpdateTransform),this.renderingToScreen=!n,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=l,!i.context.isLost){if(n||(this.lastObjectRendered=t),!h){const u=t.enableTempParent();t.updateTransform(),t.disableTempParent(u)}i.renderTexture.bind(n),i.batch.currentRenderer.start(),(o??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),n&&(r.blit&&i.framebuffer.blit(),n.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}lv.extension={type:Z.RendererSystem,name:"objectRenderer"};nt.add(lv);const Ru=class extends JR{constructor(e){super(),e=Object.assign({},J.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new pr({projectionMatrix:new $t},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Ru.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in e&&(Ct("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&e.useContextAlpha!=="notMultiplied",e.backgroundAlpha=e.useContextAlpha===!1?1:e.backgroundAlpha);const r={hello:e.hello,_plugin:Ru.__plugins,background:{alpha:e.backgroundAlpha,color:e.background??e.backgroundColor,clearBeforeRender:e.clearBeforeRender},_view:{height:e.height,width:e.width,autoDensity:e.autoDensity,resolution:e.resolution,view:e.view},context:{antialias:e.antialias,context:e.context,powerPreference:e.powerPreference,premultipliedAlpha:e.premultipliedAlpha,preserveDrawingBuffer:e.preserveDrawingBuffer}};this.startup.run(r),this.options=e}static test(e){return e!=null&&e.forceCanvas?!1:QS()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Ct("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Ct("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Ct("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Ct("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){Ct("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return Ct("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.color}set backgroundAlpha(e){Ct("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return Ct("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};let Gn=Ru;Gn.extension={type:Z.Renderer,priority:1};Gn.__plugins={};Gn.__systems={};nt.handleByMap(Z.RendererPlugin,Gn.__plugins);nt.handleByMap(Z.RendererSystem,Gn.__systems);nt.add(Gn);class hv extends Is{constructor(t,r){const{width:i,height:n}=r||{};super(i,n),this.items=[],this.itemDirtyIds=[];for(let o=0;o<t;o++){const l=new pt;this.items.push(l),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,r){for(let i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof Is?this.addResourceAt(t[i],i):this.addResourceAt(wm(t[i],r),i))}dispose(){for(let t=0,r=this.length;t<r;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,r){if(!this.items[r])throw new Error(`Index ${r} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[r].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let r=0;r<this.length;r++)this.items[r].parentTextureArray=t,this.items[r].on("update",t.update,t)}unbind(t){super.unbind(t);for(let r=0;r<this.length;r++)this.items[r].parentTextureArray=null,this.items[r].off("update",t.update,t)}load(){if(this._load)return this._load;const r=this.items.map(i=>i.resource).filter(i=>i).map(i=>i.load());return this._load=Promise.all(r).then(()=>{const{realWidth:i,realHeight:n}=this.items[0];return this.resize(i,n),Promise.resolve(this)}),this._load}}class sM extends hv{constructor(t,r){const{width:i,height:n}=r||{};let o,l;Array.isArray(t)?(o=t,l=t.length):l=t,super(l,{width:i,height:n}),o&&this.initFromArray(o,r)}addBaseTextureAt(t,r){if(t.resource)this.addResourceAt(t.resource,r);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=En.TEXTURE_2D_ARRAY}upload(t,r,i){const{length:n,itemDirtyIds:o,items:l}=this,{gl:h}=t;i.dirtyId<0&&h.texImage3D(h.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,n,0,r.format,i.type,null);for(let u=0;u<n;u++){const f=l[u];o[u]<f.dirtyId&&(o[u]=f.dirtyId,f.valid&&h.texSubImage3D(h.TEXTURE_2D_ARRAY,0,0,0,u,f.resource.width,f.resource.height,1,r.format,i.type,f.resource.source))}return!0}}class oM extends pi{constructor(t){super(t)}static test(t){const{OffscreenCanvas:r}=globalThis;return r&&t instanceof r?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const ms=class extends hv{constructor(e,t){const{width:r,height:i,autoLoad:n,linkBaseTexture:o}=t||{};if(e&&e.length!==ms.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:r,height:i});for(let l=0;l<ms.SIDES;l++)this.items[l].target=En.TEXTURE_CUBE_MAP_POSITIVE_X+l;this.linkBaseTexture=o!==!1,e&&this.initFromArray(e,t),n!==!1&&this.load()}bind(e){super.bind(e),e.target=En.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,r){if(r===void 0&&(r=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=En.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(e,t,r){const i=this.itemDirtyIds;for(let n=0;n<ms.SIDES;n++){const o=this.items[n];(i[n]<o.dirtyId||r.dirtyId<t.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(e,o,r),i[n]=o.dirtyId):i[n]<-1&&(e.gl.texImage2D(o.target,0,r.internalFormat,t.realWidth,t.realHeight,0,t.format,r.type,null),i[n]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===ms.SIDES}};let uv=ms;uv.SIDES=6;class xn extends pi{constructor(t,r){var i=(...n)=>{super(...n)};r=r||{},typeof t=="string"?(i(xn.EMPTY),this.url=t):(i(t),this.url=null),this.crossOrigin=r.crossOrigin??!0,this.alphaMode=typeof r.alphaMode=="number"?r.alphaMode:null,this._load=null,r.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,r)=>{if(this.url===null){t(this);return}try{const i=await J.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await i.blob();if(this.destroyed)return;const o=await createImageBitmap(n,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===gr.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=o,this.update(),t(this)}catch(i){if(this.destroyed)return;r(i),this.onError.emit(i)}}),this._load)}upload(t,r,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(r.alphaMode=this.alphaMode),super.upload(t,r,i)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return xn._EMPTY=xn._EMPTY??J.ADAPTER.createCanvas(0,0),xn._EMPTY}}const la=class extends pi{constructor(e,t){t=t||{},super(J.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(e=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),e(this)},la.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const e=new Image;pi.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,r=e.height;if(!t||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let i=t*this.scale,n=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(i=this._overrideWidth||this._overrideHeight/r*t,n=this._overrideHeight||this._overrideWidth/t*r),i=Math.round(i),n=Math.round(n);const o=this.source;o.width=i,o.height=n,o._pixiId=`canvas_${Hi()}`,o.getContext("2d").drawImage(e,0,0,t,r,0,0,i,n),this._resolve(),this._resolve=null}}static getSize(e){const t=la.SVG_SIZE.exec(e),r={};return t&&(r[t[1]]=Math.round(parseFloat(t[3])),r[t[5]]=Math.round(parseFloat(t[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,t){return t==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&la.SVG_XML.test(e)}};let Ps=la;Ps.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;Ps.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const Mu=class extends pi{constructor(e,t){if(t=t||{},!(e instanceof HTMLVideoElement)){const r=document.createElement("video");r.setAttribute("preload","auto"),r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline",""),typeof e=="string"&&(e=[e]);const i=e[0].src||e[0];pi.crossOrigin(r,i,t.crossorigin);for(let n=0;n<e.length;++n){const o=document.createElement("source");let{src:l,mime:h}=e[n];l=l||e[n];const u=l.split("?").shift().toLowerCase(),f=u.slice(u.lastIndexOf(".")+1);h=h||Mu.MIME_TYPES[f]||`video/${f}`,o.src=l,o.type=h,r.appendChild(o)}e=r}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),t.autoLoad!==!1&&this.load()}update(e=0){if(!this.destroyed){const t=Re.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Re.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Re.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(e.videoWidth,e.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._isConnectedToTicker&&(Re.shared.remove(this.update,this),this._isConnectedToTicker=!1);const e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(Re.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Re.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e)}static test(e,t){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||Mu.TYPES.includes(t)}};let fc=Mu;fc.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];fc.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};Tu.push(xn,Om,oM,fc,Ps,Fs,uv,sM);class ba{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Et.EMPTY:(t=t||new Et(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,r){const{a:i,b:n,c:o,d:l,tx:h,ty:u}=t,f=i*r.x+o*r.y+h,d=n*r.x+l*r.y+u;this.minX=Math.min(this.minX,f),this.maxX=Math.max(this.maxX,f),this.minY=Math.min(this.minY,d),this.maxY=Math.max(this.maxY,d)}addQuad(t){let r=this.minX,i=this.minY,n=this.maxX,o=this.maxY,l=t[0],h=t[1];r=l<r?l:r,i=h<i?h:i,n=l>n?l:n,o=h>o?h:o,l=t[2],h=t[3],r=l<r?l:r,i=h<i?h:i,n=l>n?l:n,o=h>o?h:o,l=t[4],h=t[5],r=l<r?l:r,i=h<i?h:i,n=l>n?l:n,o=h>o?h:o,l=t[6],h=t[7],r=l<r?l:r,i=h<i?h:i,n=l>n?l:n,o=h>o?h:o,this.minX=r,this.minY=i,this.maxX=n,this.maxY=o}addFrame(t,r,i,n,o){this.addFrameMatrix(t.worldTransform,r,i,n,o)}addFrameMatrix(t,r,i,n,o){const l=t.a,h=t.b,u=t.c,f=t.d,d=t.tx,g=t.ty;let m=this.minX,v=this.minY,y=this.maxX,w=this.maxY,x=l*r+u*i+d,A=h*r+f*i+g;m=x<m?x:m,v=A<v?A:v,y=x>y?x:y,w=A>w?A:w,x=l*n+u*i+d,A=h*n+f*i+g,m=x<m?x:m,v=A<v?A:v,y=x>y?x:y,w=A>w?A:w,x=l*r+u*o+d,A=h*r+f*o+g,m=x<m?x:m,v=A<v?A:v,y=x>y?x:y,w=A>w?A:w,x=l*n+u*o+d,A=h*n+f*o+g,m=x<m?x:m,v=A<v?A:v,y=x>y?x:y,w=A>w?A:w,this.minX=m,this.minY=v,this.maxX=y,this.maxY=w}addVertexData(t,r,i){let n=this.minX,o=this.minY,l=this.maxX,h=this.maxY;for(let u=r;u<i;u+=2){const f=t[u],d=t[u+1];n=f<n?f:n,o=d<o?d:o,l=f>l?f:l,h=d>h?d:h}this.minX=n,this.minY=o,this.maxX=l,this.maxY=h}addVertices(t,r,i,n){this.addVerticesMatrix(t.worldTransform,r,i,n)}addVerticesMatrix(t,r,i,n,o=0,l=o){const h=t.a,u=t.b,f=t.c,d=t.d,g=t.tx,m=t.ty;let v=this.minX,y=this.minY,w=this.maxX,x=this.maxY;for(let A=i;A<n;A+=2){const S=r[A],E=r[A+1],I=h*S+f*E+g,D=d*E+u*S+m;v=Math.min(v,I-o),w=Math.max(w,I+o),y=Math.min(y,D-l),x=Math.max(x,D+l)}this.minX=v,this.minY=y,this.maxX=w,this.maxY=x}addBounds(t){const r=this.minX,i=this.minY,n=this.maxX,o=this.maxY;this.minX=t.minX<r?t.minX:r,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>o?t.maxY:o}addBoundsMask(t,r){const i=t.minX>r.minX?t.minX:r.minX,n=t.minY>r.minY?t.minY:r.minY,o=t.maxX<r.maxX?t.maxX:r.maxX,l=t.maxY<r.maxY?t.maxY:r.maxY;if(i<=o&&n<=l){const h=this.minX,u=this.minY,f=this.maxX,d=this.maxY;this.minX=i<h?i:h,this.minY=n<u?n:u,this.maxX=o>f?o:f,this.maxY=l>d?l:d}}addBoundsMatrix(t,r){this.addFrameMatrix(r,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,r){const i=t.minX>r.x?t.minX:r.x,n=t.minY>r.y?t.minY:r.y,o=t.maxX<r.x+r.width?t.maxX:r.x+r.width,l=t.maxY<r.y+r.height?t.maxY:r.y+r.height;if(i<=o&&n<=l){const h=this.minX,u=this.minY,f=this.maxX,d=this.maxY;this.minX=i<h?i:h,this.minY=n<u?n:u,this.maxX=o>f?o:f,this.maxY=l>d?l:d}}pad(t=0,r=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=r,this.maxY+=r)}addFramePad(t,r,i,n,o,l){t-=o,r-=l,i+=o,n+=l,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<r?this.minY:r,this.maxY=this.maxY>n?this.maxY:n}}class Vt extends Ds{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new cc,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new ba,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const r=Object.keys(t);for(let i=0;i<r.length;++i){const n=r[i];Object.defineProperty(Vt.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,r){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),r||(this._boundsRect||(this._boundsRect=new Et),r=this._boundsRect),this._bounds.getRectangle(r)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Et),t=this._localBoundsRect),this._localBounds||(this._localBounds=new ba);const r=this.transform,i=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,o=this._boundsID;this._bounds=this._localBounds;const l=this.getBounds(!1,t);return this.parent=i,this.transform=r,this._bounds=n,this._bounds.updateID+=this._boundsID-o,l}toGlobal(t,r,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,r)}toLocal(t,r,i,n){return r&&(t=r.toGlobal(t,i,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,r=0,i=1,n=1,o=0,l=0,h=0,u=0,f=0){return this.position.x=t,this.position.y=r,this.scale.x=i||1,this.scale.y=n||1,this.rotation=o,this.skew.x=l,this.skew.y=h,this.pivot.x=u,this.pivot.y=f,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new aM),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*iR}set angle(t){this.transform.rotation=t*nR}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount--,r._maskRefCount===0&&(r.renderable=!0,r.isMask=!1))}if(this._mask=t,this._mask){const r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount===0&&(r.renderable=!1,r.isMask=!0),r._maskRefCount++)}}}}class aM extends Vt{constructor(){super(...arguments),this.sortDirty=null}}Vt.prototype.displayObjectUpdateTransform=Vt.prototype.updateTransform;const lM=new $t;function hM(e,t){return e.zIndex===t.zIndex?e._lastSortedIndex-t._lastSortedIndex:e.zIndex-t.zIndex}const Du=class extends Vt{constructor(){super(),this.children=[],this.sortableChildren=Du.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const r=this.getChildIndex(e),i=this.getChildIndex(t);this.children[r]=t,this.children[i]=e,this.onChildrenChange(r<i?r:i)}getChildIndex(e){const t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(e);Sn(this.children,r,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],r=this.children.indexOf(t);if(r===-1)return null;t.parent=null,t.transform._parentID=-1,Sn(this.children,r,1),this._boundsID++,this.onChildrenChange(r),t.emit("removed",this),this.emit("childRemoved",t,this,r)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,Sn(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const r=e,i=t,n=i-r;let o;if(n>0&&n<=i){o=this.children.splice(r,n);for(let l=0;l<o.length;++l)o[l].parent=null,o[l].transform&&(o[l].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let l=0;l<o.length;++l)o[l].emit("removed",this),this.emit("childRemoved",o[l],this,l);return o}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,r=this.children.length;t<r;++t){const i=this.children[t];i._lastSortedIndex=t,!e&&i.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(hM),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const r=this.children[e];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(t._bounds,r._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const r=super.getLocalBounds(e);if(!t)for(let i=0,n=this.children.length;i<n;++i){const o=this.children[i];o.visible&&o.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(e){const t=e.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let r,i;this.cullArea?(r=this.cullArea,i=this.worldTransform):this._render!==Du.prototype._render&&(r=this.getBounds(!0));const n=e.projection.transform;if(n&&(i?(i=lM.copyFrom(i),i.prepend(n)):i=n),r&&t.intersects(r,i))this._render(e);else if(this.cullArea)return;for(let o=0,l=this.children.length;o<l;++o){const h=this.children[o],u=h.cullable;h.cullable=u||!this.cullArea,h.render(e),h.cullable=u}}render(e){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(t=this.filters)!=null&&t.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let r=0,i=this.children.length;r<i;++r)this.children[r].render(e)}}renderAdvanced(e){var n,o,l;const t=this.filters,r=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let h=0;h<t.length;h++)t[h].enabled&&this._enabledFilters.push(t[h])}const i=t&&((n=this._enabledFilters)==null?void 0:n.length)||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==he.NONE));if(i&&e.batch.flush(),t&&((o=this._enabledFilters)!=null&&o.length)&&e.filter.push(this,this._enabledFilters),r&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let h=0,u=this.children.length;h<u;++h)this.children[h].render(e)}i&&e.batch.flush(),r&&e.mask.pop(this),t&&((l=this._enabledFilters)!=null&&l.length)&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t=typeof e=="boolean"?e:e==null?void 0:e.children,r=this.removeChildren(0,this.children.length);if(t)for(let i=0;i<r.length;++i)r[i].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}};let Ue=Du;Ue.defaultSortableChildren=!1;Ue.prototype.containerUpdateTransform=Ue.prototype.updateTransform;Object.defineProperties(J,{SORTABLE_CHILDREN:{get(){return Ue.defaultSortableChildren},set(e){Ct("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Ue.defaultSortableChildren=e}}});const ds=new At,uM=new Uint16Array([0,1,2,0,2,3]);class Wn extends Ue{constructor(t){super(),this._anchor=new hi(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=ut.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||it.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=uM,this.pluginName="batch",this.isSprite=!0,this._roundPixels=J.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=yn(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=yn(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const r=this.transform.worldTransform,i=r.a,n=r.b,o=r.c,l=r.d,h=r.tx,u=r.ty,f=this.vertexData,d=t.trim,g=t.orig,m=this._anchor;let v=0,y=0,w=0,x=0;if(d?(y=d.x-m._x*g.width,v=y+d.width,x=d.y-m._y*g.height,w=x+d.height):(y=-m._x*g.width,v=y+g.width,x=-m._y*g.height,w=x+g.height),f[0]=i*y+o*x+h,f[1]=l*x+n*y+u,f[2]=i*v+o*x+h,f[3]=l*x+n*v+u,f[4]=i*v+o*w+h,f[5]=l*w+n*v+u,f[6]=i*y+o*w+h,f[7]=l*w+n*y+u,this._roundPixels){const A=J.RESOLUTION;for(let S=0;S<f.length;++S)f[S]=Math.round(f[S]*A)/A}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,r=this.vertexTrimmedData,i=t.orig,n=this._anchor,o=this.transform.worldTransform,l=o.a,h=o.b,u=o.c,f=o.d,d=o.tx,g=o.ty,m=-n._x*i.width,v=m+i.width,y=-n._y*i.height,w=y+i.height;r[0]=l*m+u*y+d,r[1]=f*y+h*m+g,r[2]=l*v+u*y+d,r[3]=f*y+h*v+g,r[4]=l*v+u*w+d,r[5]=f*w+h*v+g,r[6]=l*m+u*w+d,r[7]=f*w+h*m+g}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,r=this._texture.orig;!t||t.width===r.width&&t.height===r.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new ba),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Et),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,ds);const r=this._texture.orig.width,i=this._texture.orig.height,n=-r*this.anchor.x;let o=0;return ds.x>=n&&ds.x<n+r&&(o=-i*this.anchor.y,ds.y>=o&&ds.y<o+i)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const i=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!i)}this._texture=null}static from(t,r){const i=t instanceof it?t:it.from(t,r);return new Wn(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const r=yn(this.scale.x)||1;this.scale.x=r*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const r=yn(this.scale.y)||1;this.scale.y=r*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tint}set tint(t){this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16)}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||it.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const cv=new $t;Vt.prototype._cacheAsBitmap=!1;Vt.prototype._cacheData=null;Vt.prototype._cacheAsBitmapResolution=null;Vt.prototype._cacheAsBitmapMultisample=null;class cM{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Vt.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(e){e!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(e){e!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(e){if(this._cacheAsBitmap===e)return;this._cacheAsBitmap=e;let t;e?(this._cacheData||(this._cacheData=new cM),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});Vt.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))};Vt.prototype._initCachedDisplayObject=function(t){var m,v;if((m=this._cacheData)!=null&&m.sprite)return;const r=this.alpha;this.alpha=1,t.batch.flush();const i=this.getLocalBounds(null,!0).clone();if((v=this.filters)!=null&&v.length){const y=this.filters[0].padding;i.pad(y)}i.ceil(J.RESOLUTION);const n=t.renderTexture.current,o=t.renderTexture.sourceFrame.clone(),l=t.renderTexture.destinationFrame.clone(),h=t.projection.transform,u=gi.create({width:i.width,height:i.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),f=`cacheAsBitmap_${Hi()}`;this._cacheData.textureCacheId=f,pt.addToCache(u.baseTexture,f),it.addToCache(u,f);const d=this.transform.localTransform.copyTo(cv).invert().translate(-i.x,-i.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:u,clear:!0,transform:d,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=h,t.renderTexture.bind(n,o,l),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const g=new Wn(u);g.transform.worldTransform=this.transform.worldTransform,g.anchor.x=-(i.x/i.width),g.anchor.y=-(i.y/i.height),g.alpha=r,g._bounds=this._bounds,this._cacheData.sprite=g,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=g.containsPoint.bind(g)};Vt.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))};Vt.prototype._initCachedDisplayObjectCanvas=function(t){var d;if((d=this._cacheData)!=null&&d.sprite)return;const r=this.getLocalBounds(null,!0),i=this.alpha;this.alpha=1;const n=t.canvasContext.activeContext,o=t._projTransform;r.ceil(J.RESOLUTION);const l=gi.create({width:r.width,height:r.height}),h=`cacheAsBitmap_${Hi()}`;this._cacheData.textureCacheId=h,pt.addToCache(l.baseTexture,h),it.addToCache(l,h);const u=cv;this.transform.localTransform.copyTo(u),u.invert(),u.tx-=r.x,u.ty-=r.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:l,clear:!0,transform:u,skipUpdateTransform:!1}),t.canvasContext.activeContext=n,t._projTransform=o,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const f=new Wn(l);f.transform.worldTransform=this.transform.worldTransform,f.anchor.x=-(r.x/r.width),f.anchor.y=-(r.y/r.height),f.alpha=i,f._bounds=this._bounds,this._cacheData.sprite=f,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=f.containsPoint.bind(f)};Vt.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};Vt.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};Vt.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,pt.removeFromCache(this._cacheData.textureCacheId),it.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};Vt.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)};Vt.prototype.name=null;Ue.prototype.getChildByName=function(t,r){for(let i=0,n=this.children.length;i<n;i++)if(this.children[i].name===t)return this.children[i];if(r)for(let i=0,n=this.children.length;i<n;i++){const o=this.children[i];if(!o.getChildByName)continue;const l=o.getChildByName(t,!0);if(l)return l}return null};Vt.prototype.getGlobalPosition=function(t=new At,r=!1){return this.parent?this.parent.toGlobal(this.position,t,r):(t.x=this.position.x,t.y=this.position.y),t};var fM=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class dM extends Te{constructor(t=1){super(iM,fM,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const pM={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},gM=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function mM(e){const t=pM[e],r=t.length;let i=gM,n="";const o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let l;for(let h=0;h<e;h++){let u=o.replace("%index%",h.toString());l=h,h>=r&&(l=e-h-1),u=u.replace("%value%",t[l].toString()),n+=u,n+=`
`}return i=i.replace("%blur%",n),i=i.replace("%size%",e.toString()),i}const vM=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function _M(e,t){const r=Math.ceil(e/2);let i=vM,n="",o;t?o="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":o="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let l=0;l<e;l++){let h=o.replace("%index%",l.toString());h=h.replace("%sampleIndex%",`${l-(r-1)}.0`),n+=h,n+=`
`}return i=i.replace("%blur%",n),i=i.replace("%size%",e.toString()),i}class Bu extends Te{constructor(t,r=8,i=4,n=J.FILTER_RESOLUTION,o=5){const l=_M(o,t),h=mM(o);super(l,h),this.horizontal=t,this.resolution=n,this._quality=0,this.quality=i,this.blur=r}apply(t,r,i,n){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/r.width):this.uniforms.strength=1/i.height*(i.height/r.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/r.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/r.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,r,i,n);else{const o=t.getFilterTexture(),l=t.renderer;let h=r,u=o;this.state.blend=!1,t.applyFilter(this,h,u,Tr.CLEAR);for(let f=1;f<this.passes-1;f++){t.bindAndClear(h,Tr.BLIT),this.uniforms.uSampler=u;const d=u;u=h,h=d,l.shader.bind(this),l.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,u,i,n),t.returnFilterTexture(o)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class yM extends Te{constructor(t=8,r=4,i=Te.defaultResolution,n=5){super(),this.blurXFilter=new Bu(!0,t,r,i,n),this.blurYFilter=new Bu(!1,t,r,i,n),this.resolution=i,this.quality=r,this.blur=t,this.repeatEdgePixels=!1}apply(t,r,i,n){const o=Math.abs(this.blurXFilter.strength),l=Math.abs(this.blurYFilter.strength);if(o&&l){const h=t.getFilterTexture();this.blurXFilter.apply(t,r,h,Tr.CLEAR),this.blurYFilter.apply(t,h,i,n),t.returnFilterTexture(h)}else l?this.blurYFilter.apply(t,r,i,n):this.blurXFilter.apply(t,r,i,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var xM=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class Ou extends Te{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(sv,xM,t),this.alpha=1}_loadMatrix(t,r=!1){let i=t;r&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,r,i){return t[0]=r[0]*i[0]+r[1]*i[5]+r[2]*i[10]+r[3]*i[15],t[1]=r[0]*i[1]+r[1]*i[6]+r[2]*i[11]+r[3]*i[16],t[2]=r[0]*i[2]+r[1]*i[7]+r[2]*i[12]+r[3]*i[17],t[3]=r[0]*i[3]+r[1]*i[8]+r[2]*i[13]+r[3]*i[18],t[4]=r[0]*i[4]+r[1]*i[9]+r[2]*i[14]+r[3]*i[19]+r[4],t[5]=r[5]*i[0]+r[6]*i[5]+r[7]*i[10]+r[8]*i[15],t[6]=r[5]*i[1]+r[6]*i[6]+r[7]*i[11]+r[8]*i[16],t[7]=r[5]*i[2]+r[6]*i[7]+r[7]*i[12]+r[8]*i[17],t[8]=r[5]*i[3]+r[6]*i[8]+r[7]*i[13]+r[8]*i[18],t[9]=r[5]*i[4]+r[6]*i[9]+r[7]*i[14]+r[8]*i[19]+r[9],t[10]=r[10]*i[0]+r[11]*i[5]+r[12]*i[10]+r[13]*i[15],t[11]=r[10]*i[1]+r[11]*i[6]+r[12]*i[11]+r[13]*i[16],t[12]=r[10]*i[2]+r[11]*i[7]+r[12]*i[12]+r[13]*i[17],t[13]=r[10]*i[3]+r[11]*i[8]+r[12]*i[13]+r[13]*i[18],t[14]=r[10]*i[4]+r[11]*i[9]+r[12]*i[14]+r[13]*i[19]+r[14],t[15]=r[15]*i[0]+r[16]*i[5]+r[17]*i[10]+r[18]*i[15],t[16]=r[15]*i[1]+r[16]*i[6]+r[17]*i[11]+r[18]*i[16],t[17]=r[15]*i[2]+r[16]*i[7]+r[17]*i[12]+r[18]*i[17],t[18]=r[15]*i[3]+r[16]*i[8]+r[17]*i[13]+r[18]*i[18],t[19]=r[15]*i[4]+r[16]*i[9]+r[17]*i[14]+r[18]*i[19]+r[19],t}_colorMatrix(t){const r=new Float32Array(t);return r[4]/=255,r[9]/=255,r[14]/=255,r[19]/=255,r}brightness(t,r){const i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,r)}tint(t,r){const i=t>>16&255,n=t>>8&255,o=t&255,l=[i/255,0,0,0,0,0,n/255,0,0,0,0,0,o/255,0,0,0,0,0,1,0];this._loadMatrix(l,r)}greyscale(t,r){const i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,r)}blackAndWhite(t){const r=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(r,t)}hue(t,r){t=(t||0)/180*Math.PI;const i=Math.cos(t),n=Math.sin(t),o=Math.sqrt,l=1/3,h=o(l),u=i+(1-i)*l,f=l*(1-i)-h*n,d=l*(1-i)+h*n,g=l*(1-i)+h*n,m=i+l*(1-i),v=l*(1-i)-h*n,y=l*(1-i)-h*n,w=l*(1-i)+h*n,x=i+l*(1-i),A=[u,f,d,0,0,g,m,v,0,0,y,w,x,0,0,0,0,0,1,0];this._loadMatrix(A,r)}contrast(t,r){const i=(t||0)+1,n=-.5*(i-1),o=[i,0,0,0,n,0,i,0,0,n,0,0,i,0,n,0,0,0,1,0];this._loadMatrix(o,r)}saturate(t=0,r){const i=t*2/3+1,n=(i-1)*-.5,o=[i,n,n,0,0,n,i,n,0,0,n,n,i,0,0,0,0,0,1,0];this._loadMatrix(o,r)}desaturate(){this.saturate(-1)}negative(t){const r=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(r,t)}sepia(t){const r=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(r,t)}technicolor(t){const r=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(r,t)}polaroid(t){const r=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(r,t)}toBGR(t){const r=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(r,t)}kodachrome(t){const r=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(r,t)}browni(t){const r=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(r,t)}vintage(t){const r=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(r,t)}colorTone(t,r,i,n,o){t=t||.2,r=r||.15,i=i||16770432,n=n||3375104;const l=(i>>16&255)/255,h=(i>>8&255)/255,u=(i&255)/255,f=(n>>16&255)/255,d=(n>>8&255)/255,g=(n&255)/255,m=[.3,.59,.11,0,0,l,h,u,t,0,f,d,g,r,0,l-f,h-d,u-g,0,0];this._loadMatrix(m,o)}night(t,r){t=t||.1;const i=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(i,r)}predator(t,r){const i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,r)}lsd(t){const r=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(r,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}Ou.prototype.grayscale=Ou.prototype.greyscale;var bM=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,wM=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class EM extends Te{constructor(t,r){const i=new $t;t.renderable=!1,super(wM,bM,{mapSampler:t._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=i,r==null&&(r=20),this.scale=new At(r,r)}apply(t,r,i,n){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const o=this.maskSprite.worldTransform,l=Math.sqrt(o.a*o.a+o.b*o.b),h=Math.sqrt(o.c*o.c+o.d*o.d);l!==0&&h!==0&&(this.uniforms.rotation[0]=o.a/l,this.uniforms.rotation[1]=o.b/l,this.uniforms.rotation[2]=o.c/h,this.uniforms.rotation[3]=o.d/h),t.applyFilter(this,r,i,n)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var TM=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,AM=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class SM extends Te{constructor(){super(AM,TM)}}var CM=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class IM extends Te{constructor(t=.5,r=Math.random()){super(sv,CM,{uNoise:0,uSeed:0}),this.noise=t,this.seed=r}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const sg={AlphaFilter:dM,BlurFilter:yM,BlurFilterPass:Bu,ColorMatrixFilter:Ou,DisplacementFilter:EM,FXAAFilter:SM,NoiseFilter:IM};Object.entries(sg).forEach(([e,t])=>{Object.defineProperty(sg,e,{get(){return Ct("7.1.0",`filters.${e} has moved to ${e}`),t}})});class Ls{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Ls.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new At,this.page=new At,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,r,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,r,i,n,o){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class wa extends Ls{constructor(){super(...arguments),this.client=new At,this.movement=new At,this.offset=new At,this.global=new At,this.screen=new At}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,r,i,n,o,l,h,u,f,d,g,m,v,y,w){throw new Error("Method not implemented.")}}class or extends wa{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Fu extends wa{constructor(){super(...arguments),this.DOM_DELTA_LINE=0,this.DOM_DELTA_PAGE=1,this.DOM_DELTA_PIXEL=2}}const PM=2048,RM=new At,Uh=new At;class MM{constructor(t){this.dispatch=new Ds,this.moveOnAll=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,r){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:r,priority:0}),this.mappingTable[t].sort((i,n)=>i.priority-n.priority)}dispatchEvent(t,r){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,r),this.dispatch.emit(r||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const r=this.mappingTable[t.type];if(r)for(let i=0,n=r.length;i<n;i++)r[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,r){const i=this.hitTestRecursive(this.rootTarget,this.rootTarget.interactive,RM.set(t,r),this.hitTestFn,this.hitPruneFn);return i&&i[0]}propagate(t,r){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,o=i.length-1;n<o;n++)if(t.currentTarget=i[n],this.notifyTarget(t,r),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,r),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let n=i.length-2;n>=0;n--)if(t.currentTarget=i[n],this.notifyTarget(t,r),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,r,i=this.rootTarget){t.eventPhase=t.BUBBLING_PHASE;const n=i.children;if(n)for(let o=0;o<n.length;o++)this.all(t,r,n[o]);t.currentTarget=i,this.notifyTarget(t,r)}propagationPath(t){const r=[t];for(let i=0;i<PM&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");r.push(t.parent),t=t.parent}return r.reverse(),r}hitTestRecursive(t,r,i,n,o){if(!t||!t.visible||o(t,i))return null;if(t.interactiveChildren&&t.children){const l=t.children;for(let h=l.length-1;h>=0;h--){const u=l[h],f=this.hitTestRecursive(u,r||u.interactive,i,n,o);if(f){if(f.length>0&&!f[f.length-1].parent)continue;return(f.length>0||t.interactive)&&f.push(t),f}}}return r&&n(t,i)?t.interactive?[t]:[]:null}hitPruneFn(t,r){var i;if(t.hitArea&&(t.worldTransform.applyInverse(r,Uh),!t.hitArea.contains(Uh.x,Uh.y)))return!0;if(t._mask){const n=t._mask.isMaskData?t._mask.maskObject:t._mask;if(n&&!((i=n.containsPoint)!=null&&i.call(n,r)))return!0}return!1}hitTestFn(t,r){return t.hitArea?!0:t.containsPoint?t.containsPoint(r):!1}notifyTarget(t,r){var o,l;r=r??t.type;const i=`on${r}`;(l=(o=t.currentTarget)[i])==null||l.call(o,t);const n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${r}capture`:r;this.notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,r)}mapPointerDown(t){if(!(t instanceof or)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerdown"),r.pointerType==="touch")this.dispatchEvent(r,"touchstart");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const n=r.button===2;this.dispatchEvent(r,n?"rightdown":"mousedown")}const i=this.trackingData(t.pointerId);i.pressTargetsByButton[t.button]=r.composedPath(),this.freeEvent(r)}mapPointerMove(t){var h;if(!(t instanceof or)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.createPointerEvent(t),i=r.pointerType==="mouse"||r.pointerType==="pen",n=this.trackingData(t.pointerId),o=this.findMountedTarget(n.overTargets);if(n.overTargets&&o!==r.target){const u=t.type==="mousemove"?"mouseout":"pointerout",f=this.createPointerEvent(t,u,o);if(this.dispatchEvent(f,"pointerout"),i&&this.dispatchEvent(f,"mouseout"),!r.composedPath().includes(o)){const d=this.createPointerEvent(t,"pointerleave",o);for(d.eventPhase=d.AT_TARGET;d.target&&!r.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),i&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(f)}if(o!==r.target){const u=t.type==="mousemove"?"mouseover":"pointerover",f=this.clonePointerEvent(r,u);this.dispatchEvent(f,"pointerover"),i&&this.dispatchEvent(f,"mouseover");let d=o==null?void 0:o.parent;for(;d&&d!==this.rootTarget.parent&&d!==r.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const m=this.clonePointerEvent(r,"pointerenter");for(m.eventPhase=m.AT_TARGET;m.target&&m.target!==o&&m.target!==this.rootTarget.parent;)m.currentTarget=m.target,this.notifyTarget(m),i&&this.notifyTarget(m,"mouseenter"),m.target=m.target.parent;this.freeEvent(m)}this.freeEvent(f)}const l=this.moveOnAll?"all":"dispatchEvent";this[l](r,"pointermove"),r.pointerType==="touch"&&this[l](r,"touchmove"),i&&(this[l](r,"mousemove"),this.cursor=(h=r.target)==null?void 0:h.cursor),n.overTargets=r.composedPath(),this.freeEvent(r)}mapPointerOver(t){var l;if(!(t instanceof or)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.trackingData(t.pointerId),i=this.createPointerEvent(t),n=i.pointerType==="mouse"||i.pointerType==="pen";this.dispatchEvent(i,"pointerover"),n&&this.dispatchEvent(i,"mouseover"),i.pointerType==="mouse"&&(this.cursor=(l=i.target)==null?void 0:l.cursor);const o=this.clonePointerEvent(i,"pointerenter");for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),n&&this.notifyTarget(o,"mouseenter"),o.target=o.target.parent;r.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(o)}mapPointerOut(t){if(!(t instanceof or)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.trackingData(t.pointerId);if(r.overTargets){const i=t.pointerType==="mouse"||t.pointerType==="pen",n=this.findMountedTarget(r.overTargets),o=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(o),i&&this.dispatchEvent(o,"mouseout");const l=this.createPointerEvent(t,"pointerleave",n);for(l.eventPhase=l.AT_TARGET;l.target&&l.target!==this.rootTarget.parent;)l.currentTarget=l.target,this.notifyTarget(l),i&&this.notifyTarget(l,"mouseleave"),l.target=l.target.parent;r.overTargets=null,this.freeEvent(o),this.freeEvent(l)}this.cursor=null}mapPointerUp(t){if(!(t instanceof or)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const h=i.button===2;this.dispatchEvent(i,h?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),o=this.findMountedTarget(n.pressTargetsByButton[t.button]);let l=o;if(o&&!i.composedPath().includes(o)){let h=o;for(;h&&!i.composedPath().includes(h);){if(i.currentTarget=h,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const u=i.button===2;this.notifyTarget(i,u?"rightupoutside":"mouseupoutside")}h=h.parent}delete n.pressTargetsByButton[t.button],l=h}if(l){const h=this.clonePointerEvent(i,"click");h.target=l,h.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:h.target,timeStamp:r});const u=n.clicksByButton[t.button];u.target===h.target&&r-u.timeStamp<200?++u.clickCount:u.clickCount=1,u.target=h.target,u.timeStamp=r,h.detail=u.clickCount,h.pointerType==="mouse"?this.dispatchEvent(h,"click"):h.pointerType==="touch"&&this.dispatchEvent(h,"tap"),this.dispatchEvent(h,"pointertap"),this.freeEvent(h)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof or)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.trackingData(t.pointerId),i=this.findMountedTarget(r.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(i){let o=i;for(;o;)n.currentTarget=o,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch"?this.notifyTarget(n,"touchendoutside"):(n.pointerType==="mouse"||n.pointerType==="pen")&&this.notifyTarget(n,n.button===2?"rightupoutside":"mouseupoutside"),o=o.parent;delete r.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof Fu)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const r=this.createWheelEvent(t);this.dispatchEvent(r),this.freeEvent(r)}findMountedTarget(t){if(!t)return null;let r=t[0];for(let i=1;i<t.length&&t[i].parent===r;i++)r=t[i];return r}createPointerEvent(t,r,i){const n=this.allocateEvent(or);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=i??this.hitTest(n.global.x,n.global.y),typeof r=="string"&&(n.type=r),n}createWheelEvent(t){const r=this.allocateEvent(Fu);return this.copyWheelData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t,r.target=this.hitTest(r.global.x,r.global.y),r}clonePointerEvent(t,r){const i=this.allocateEvent(or);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=r??i.type,i}copyWheelData(t,r){r.deltaMode=t.deltaMode,r.deltaX=t.deltaX,r.deltaY=t.deltaY,r.deltaZ=t.deltaZ}copyPointerData(t,r){t instanceof or&&r instanceof or&&(r.pointerId=t.pointerId,r.width=t.width,r.height=t.height,r.isPrimary=t.isPrimary,r.pointerType=t.pointerType,r.pressure=t.pressure,r.tangentialPressure=t.tangentialPressure,r.tiltX=t.tiltX,r.tiltY=t.tiltY,r.twist=t.twist)}copyMouseData(t,r){t instanceof wa&&r instanceof wa&&(r.altKey=t.altKey,r.button=t.button,r.buttons=t.buttons,r.client.copyFrom(t.client),r.ctrlKey=t.ctrlKey,r.metaKey=t.metaKey,r.movement.copyFrom(t.movement),r.screen.copyFrom(t.screen),r.global.copyFrom(t.global))}copyData(t,r){r.isTrusted=t.isTrusted,r.srcElement=t.srcElement,r.timeStamp=performance.now(),r.type=t.type,r.detail=t.detail,r.view=t.view,r.which=t.which,r.layer.copyFrom(t.layer),r.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const r=this.eventPool.get(t).pop()||new t(this);return r.eventPhase=r.NONE,r.currentTarget=null,r.path=null,r.target=null,r}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const r=t.constructor;this.eventPool.has(r)||this.eventPool.set(r,[]),this.eventPool.get(r).push(t)}notifyListeners(t,r){const i=t.currentTarget._events[r];if(i)if("fn"in i)i.fn.call(i.context,t);else for(let n=0,o=i.length;n<o&&!t.propagationImmediatelyStopped;n++)i[n].fn.call(i[n].context,t)}}const DM=1,BM={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class fv{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new MM(null),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new or(null),this.rootWheelEvent=new Fu(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}init(){const{view:t,resolution:r}=this.renderer;this.setTargetElement(t),this.resolution=r}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let r=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(r=!1),this.currentCursor===t)return;this.currentCursor=t;const i=this.cursorStyles[t];if(i)switch(typeof i){case"string":r&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":r&&Object.assign(this.domElement.style,i);break}else r&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}onPointerDown(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const r=this.normalizeToPointerData(t);this.autoPreventDefault&&r[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let i=0,n=r.length;i<n;i++){const o=r[i],l=this.bootstrapEvent(this.rootPointerEvent,o);this.rootBoundary.mapEvent(l)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const r=this.normalizeToPointerData(t);for(let i=0,n=r.length;i<n;i++){const o=this.bootstrapEvent(this.rootPointerEvent,r[i]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;let r=t.target;t.composedPath&&t.composedPath().length>0&&(r=t.composedPath()[0]);const i=r!==this.domElement?"outside":"",n=this.normalizeToPointerData(t);for(let o=0,l=n.length;o<l;o++){const h=this.bootstrapEvent(this.rootPointerEvent,n[o]);h.type+=i,this.rootBoundary.mapEvent(h)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const r=this.normalizeToPointerData(t);for(let i=0,n=r.length;i<n;i++){const o=this.bootstrapEvent(this.rootPointerEvent,r[i]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){const r=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(r)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,r,i){let n;this.domElement.parentElement?n=this.domElement.getBoundingClientRect():n={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const o=1/this.resolution;t.x=(r-n.left)*(this.domElement.width/n.width)*o,t.y=(i-n.top)*(this.domElement.height/n.height)*o}normalizeToPointerData(t){const r=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,n=t.changedTouches.length;i<n;i++){const o=t.changedTouches[i];typeof o.button>"u"&&(o.button=0),typeof o.buttons>"u"&&(o.buttons=1),typeof o.isPrimary>"u"&&(o.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof o.width>"u"&&(o.width=o.radiusX||1),typeof o.height>"u"&&(o.height=o.radiusY||1),typeof o.tiltX>"u"&&(o.tiltX=0),typeof o.tiltY>"u"&&(o.tiltY=0),typeof o.pointerType>"u"&&(o.pointerType="touch"),typeof o.pointerId>"u"&&(o.pointerId=o.identifier||0),typeof o.pressure>"u"&&(o.pressure=o.force||.5),typeof o.twist>"u"&&(o.twist=0),typeof o.tangentialPressure>"u"&&(o.tangentialPressure=0),typeof o.layerX>"u"&&(o.layerX=o.offsetX=o.clientX),typeof o.layerY>"u"&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,o.type=t.type,r.push(o)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const i=t;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=DM),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,r.push(i)}else r.push(t);return r}normalizeWheelEvent(t){const r=this.rootWheelEvent;return this.transferMouseData(r,t),r.deltaX=t.deltaX,r.deltaY=t.deltaY,r.deltaZ=t.deltaZ,r.deltaMode=t.deltaMode,this.mapPositionToPoint(r.screen,t.clientX,t.clientY),r.global.copyFrom(r.screen),r.offset.copyFrom(r.screen),r.nativeEvent=t,r.type=t.type,r}bootstrapEvent(t,r){return t.originalEvent=null,t.nativeEvent=r,t.pointerId=r.pointerId,t.width=r.width,t.height=r.height,t.isPrimary=r.isPrimary,t.pointerType=r.pointerType,t.pressure=r.pressure,t.tangentialPressure=r.tangentialPressure,t.tiltX=r.tiltX,t.tiltY=r.tiltY,t.twist=r.twist,this.transferMouseData(t,r),this.mapPositionToPoint(t.screen,r.clientX,r.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=r.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=BM[t.type]||t.type),t}transferMouseData(t,r){t.isTrusted=r.isTrusted,t.srcElement=r.srcElement,t.timeStamp=performance.now(),t.type=r.type,t.altKey=r.altKey,t.button=r.button,t.buttons=r.buttons,t.client.x=r.clientX,t.client.y=r.clientY,t.ctrlKey=r.ctrlKey,t.metaKey=r.metaKey,t.movement.x=r.movementX,t.movement.y=r.movementY,t.page.x=r.pageX,t.page.y=r.pageY,t.relatedTarget=null,t.shiftKey=r.shiftKey}}fv.extension={name:"events",type:[Z.RendererSystem,Z.CanvasRendererSystem]};nt.add(fv);const OM={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,ontouchstart:null,onwheel:null,interactive:!1,interactiveChildren:!0,hitArea:null,addEventListener(e,t,r){const i=typeof r=="boolean"&&r||typeof r=="object"&&r.capture,n=typeof t=="function"?void 0:t;e=i?`${e}capture`:e,t=typeof t=="function"?t:t.handleEvent,this.on(e,t,n)},removeEventListener(e,t,r){const i=typeof r=="boolean"&&r||typeof r=="object"&&r.capture,n=typeof t=="function"?void 0:t;e=i?`${e}capture`:e,t=typeof t=="function"?t:t.handleEvent,this.off(e,t,n)},dispatchEvent(e){if(!(e instanceof Ls))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return e.defaultPrevented=!1,e.path=null,e.target=this,e.manager.dispatchEvent(e),!e.defaultPrevented}};Vt.mixin(OM);const FM={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Vt.mixin(FM);const LM=9,Xo=100,NM=0,kM=0,og=2,ag=1,UM=-1e3,GM=-1e3,WM=2;class dv{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(zr.tablet||zr.phone)&&this.createTouchHook();const r=document.createElement("div");r.style.width=`${Xo}px`,r.style.height=`${Xo}px`,r.style.position="absolute",r.style.top=`${NM}px`,r.style.left=`${kM}px`,r.style.zIndex=og.toString(),this.div=r,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${ag}px`,t.style.height=`${ag}px`,t.style.position="absolute",t.style.top=`${UM}px`,t.style.left=`${GM}px`,t.style.zIndex=WM.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const r=t.children;if(r)for(let i=0;i<r.length;i++)this.updateAccessibleObjects(r[i])}update(){const t=performance.now();if(zr.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:r,y:i,width:n,height:o}=this.renderer.view.getBoundingClientRect(),{width:l,height:h,resolution:u}=this.renderer,f=n/l*u,d=o/h*u;let g=this.div;g.style.left=`${r}px`,g.style.top=`${i}px`,g.style.width=`${l}px`,g.style.height=`${h}px`;for(let m=0;m<this.children.length;m++){const v=this.children[m];if(v.renderId!==this.renderId)v._accessibleActive=!1,Sn(this.children,m,1),this.div.removeChild(v._accessibleDiv),this.pool.push(v._accessibleDiv),v._accessibleDiv=null,m--;else{g=v._accessibleDiv;let y=v.hitArea;const w=v.worldTransform;v.hitArea?(g.style.left=`${(w.tx+y.x*w.a)*f}px`,g.style.top=`${(w.ty+y.y*w.d)*d}px`,g.style.width=`${y.width*w.a*f}px`,g.style.height=`${y.height*w.d*d}px`):(y=v.getBounds(),this.capHitArea(y),g.style.left=`${y.x*f}px`,g.style.top=`${y.y*d}px`,g.style.width=`${y.width*f}px`,g.style.height=`${y.height*d}px`,g.title!==v.accessibleTitle&&v.accessibleTitle!==null&&(g.title=v.accessibleTitle),g.getAttribute("aria-label")!==v.accessibleHint&&v.accessibleHint!==null&&g.setAttribute("aria-label",v.accessibleHint)),(v.accessibleTitle!==g.title||v.tabIndex!==g.tabIndex)&&(g.title=v.accessibleTitle,g.tabIndex=v.tabIndex,this.debug&&this.updateDebugHTML(g))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:r,height:i}=this.renderer;t.x+t.width>r&&(t.width=r-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let r=this.pool.pop();r||(r=document.createElement("button"),r.style.width=`${Xo}px`,r.style.height=`${Xo}px`,r.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",r.style.position="absolute",r.style.zIndex=og.toString(),r.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?r.setAttribute("aria-live","off"):r.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?r.setAttribute("aria-relevant","additions"):r.setAttribute("aria-relevant","text"),r.addEventListener("click",this._onClick.bind(this)),r.addEventListener("focus",this._onFocus.bind(this)),r.addEventListener("focusout",this._onFocusOut.bind(this))),r.style.pointerEvents=t.accessiblePointerEvents,r.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?r.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(r.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&r.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(r),t._accessibleActive=!0,t._accessibleDiv=r,r.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,r){const{displayObject:i}=t.target,n=this.renderer.events.rootBoundary,o=Object.assign(new Ls(n),{target:i});n.rootTarget=this.renderer.lastObjectRendered,r.forEach(l=>n.dispatchEvent(o,l))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===LM&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}dv.extension={name:"accessibility",type:[Z.RendererPlugin,Z.CanvasRendererPlugin]};nt.add(dv);const Lu=class{constructor(e){this.stage=new Ue,e=Object.assign({forceCanvas:!1},e),this.renderer=tM(e),Lu._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(e,t){const r=Lu._plugins.slice(0);r.reverse(),r.forEach(i=>{i.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};let dc=Lu;dc._plugins=[];nt.handleByList(Z.Application,dc._plugins);class pv{static init(t){Object.defineProperty(this,"resizeTo",{set(r){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=r,r&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let r,i;if(this._resizeTo===globalThis.window)r=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:o}=this._resizeTo;r=n,i=o}this.renderer.resize(r,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}pv.extension=Z.Application;nt.add(pv);const lg={loader:Z.LoadParser,resolver:Z.ResolveParser,cache:Z.CacheParser,detection:Z.DetectionParser};nt.handle(Z.Asset,e=>{const t=e.ref;Object.entries(lg).filter(([r])=>!!t[r]).forEach(([r,i])=>nt.add(Object.assign(t[r],{extension:t[r].extension??i})))},e=>{const t=e.ref;Object.keys(lg).filter(r=>!!t[r]).forEach(r=>nt.remove(t[r]))});class $M{constructor(t,r=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=r}add(t){t.forEach(r=>{this._assetList.push(r)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],r=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<r;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function gv(e,t){if(Array.isArray(t)){for(const r of t)if(e.startsWith(`data:${r}`))return!0;return!1}return e.startsWith(`data:${t}`)}function ka(e,t){const r=e.split("?")[0],i=me.extname(r).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const Vr=(e,t)=>(Array.isArray(e)||(e=[e]),t?e.map(r=>typeof r=="string"?t(r):r):e);function mv(e,t,r,i,n){const o=t[r];for(let l=0;l<o.length;l++){const h=o[l];r<t.length-1?mv(e.replace(i[r],h),t,r+1,i,n):n.push(e.replace(i[r],h))}}function HM(e){const t=/\{(.*?)\}/g,r=e.match(t),i=[];if(r){const n=[];r.forEach(o=>{const l=o.substring(1,o.length-1).split(",");n.push(l)}),mv(e,n,0,r,i)}else i.push(e);return i}const Ea=e=>!Array.isArray(e);class XM{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const r=this._cache.get(t);return r||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),r}set(t,r){const i=Vr(t);let n;for(let h=0;h<this.parsers.length;h++){const u=this.parsers[h];if(u.test(r)){n=u.getCacheableAssets(i,r);break}}n||(n={},i.forEach(h=>{n[h]=r}));const o=Object.keys(n),l={cacheKeys:o,keys:i};if(i.forEach(h=>{this._cacheMap.set(h,l)}),o.forEach(h=>{this._cache.has(h)&&this._cache.get(h)!==r&&console.warn("[Cache] already has key:",h),this._cache.set(h,n[h])}),r instanceof it){const h=r;i.forEach(u=>{h.baseTexture!==it.EMPTY.baseTexture&&pt.addToCache(h.baseTexture,u),it.addToCache(h,u)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const r=this._cacheMap.get(t);r.cacheKeys.forEach(n=>{this._cache.delete(n)}),r.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const ps=new XM;class zM{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(t,r){const i={promise:null,parser:null};return i.promise=(async()=>{var o,l;let n=null;for(let h=0;h<this.parsers.length;h++){const u=this.parsers[h];if(u.load&&((o=u.test)!=null&&o.call(u,t,r,this))){n=await u.load(t,r,this),i.parser=u;break}}if(!i.parser)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has being added`),null;for(let h=0;h<this.parsers.length;h++){const u=this.parsers[h];u.parse&&u.parse&&await((l=u.testParse)==null?void 0:l.call(u,n,r,this))&&(n=await u.parse(n,r,this)||n,i.parser=u)}return n})(),i}async load(t,r){let i=0;const n={},o=Ea(t),l=Vr(t,f=>({src:f})),h=l.length,u=l.map(async f=>{const d=me.toAbsolute(f.src);if(!n[f.src])try{this.promiseCache[d]||(this.promiseCache[d]=this._getLoadPromiseAndParser(d,f)),n[f.src]=await this.promiseCache[d].promise,r&&r(++i/h)}catch(g){throw delete this.promiseCache[d],delete n[f.src],new Error(`[Loader.load] Failed to load ${d}.
${g}`)}});return await Promise.all(u),o?n[l[0].src]:n}async unload(t){const i=Vr(t,n=>({src:n})).map(async n=>{var h,u;const o=me.toAbsolute(n.src),l=this.promiseCache[o];if(l){const f=await l.promise;(u=(h=l.parser)==null?void 0:h.unload)==null||u.call(h,f,n,this),delete this.promiseCache[o]}});await Promise.all(i)}get parsers(){return this._parsers}}var Dr=(e=>(e[e.Low=0]="Low",e[e.Normal=1]="Normal",e[e.High=2]="High",e))(Dr||{});const VM={extension:{type:Z.LoadParser,priority:Dr.Low},test(e){return me.extname(e).toLowerCase()===".json"},async load(e){return await(await J.ADAPTER.fetch(e)).json()}};nt.add(VM);const jM={extension:{type:Z.LoadParser,priority:Dr.Low},test(e){return me.extname(e).toLowerCase()===".txt"},async load(e){return await(await J.ADAPTER.fetch(e)).text()}};nt.add(jM);const YM=["normal","bold","100","200","300","400","500","600","700","800","900"],qM=[".ttf",".otf",".woff",".woff2"],KM=["font/ttf","font/otf","font/woff","font/woff2"];function ZM(e){const t=me.extname(e);return me.basename(e,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ")}const JM={extension:{type:Z.LoadParser,priority:Dr.Low},test(e){return gv(e,KM)||ka(e,qM)},async load(e,t){var i,n,o;if(!globalThis.navigator.onLine)throw new Error("[loadWebFont] Cannot load font - navigator is offline");const r=J.ADAPTER.getFontFaceSet();if(r){const l=[],h=((i=t.data)==null?void 0:i.family)??ZM(e),u=((o=(n=t.data)==null?void 0:n.weights)==null?void 0:o.filter(d=>YM.includes(d)))??["normal"],f=t.data??{};for(let d=0;d<u.length;d++){const g=u[d],m=new FontFace(h,`url(${encodeURI(e)})`,{...f,weight:g});await m.load(),r.add(m),l.push(m)}return l.length===1?l[0]:l}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach(t=>J.ADAPTER.getFontFaceSet().delete(t))}};nt.add(JM);let hg=0,Gh;const QM="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",tD={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${QM}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},eD={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let Wh;class rD{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const r=URL.createObjectURL(new Blob([tD.code],{type:"application/javascript"})),i=new Worker(r);i.addEventListener("message",n=>{i.terminate(),URL.revokeObjectURL(r),t(n.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){Gh===void 0&&(Gh=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Gh&&(Wh||(Wh=URL.createObjectURL(new Blob([eD.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Wh),t.addEventListener("message",r=>{this.complete(r.data),this.returnWorker(r.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,r){await this._initWorkers();const i=new Promise((n,o)=>{this.queue.push({id:t,arguments:r,resolve:n,reject:o})});return this.next(),i}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const r=this.queue.pop(),i=r.id;this.resolveHash[hg]={resolve:r.resolve,reject:r.reject},t.postMessage({data:r.arguments,uuid:hg++,id:i})}}const ug=new rD;function Ua(e,t,r){const i=new it(e);return i.baseTexture.on("dispose",()=>{delete t.promiseCache[r]}),i}const iD=[".jpeg",".jpg",".png",".webp",".avif"],nD=["image/jpeg","image/png","image/webp","image/avif"];async function sD(e){const t=await J.ADAPTER.fetch(e);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${t.status} ${t.statusText}`);const r=await t.blob();return await createImageBitmap(r)}const Rs={extension:{type:Z.LoadParser,priority:Dr.High},config:{preferWorkers:!0},test(e){return gv(e,nD)||ka(e,iD)},async load(e,t,r){let i=null;globalThis.createImageBitmap?this.config.preferWorkers&&await ug.isImageBitmapSupported()?i=await ug.loadImageBitmap(e):i=await sD(e):i=await new Promise(o=>{i=new Image,i.crossOrigin="anonymous",i.src=e,i.complete?o(i):i.onload=()=>{o(i)}});const n=new pt(i,{resolution:fi(e),...t.data});return n.resource.src=e,Ua(n,r,e)},unload(e){e.destroy(!0)}};nt.add(Rs);const oD={extension:{type:Z.LoadParser,priority:Dr.High},test(e){return me.extname(e).toLowerCase()===".svg"},async testParse(e){return Ps.test(e)},async parse(e,t,r){var l,h,u;const i=new Ps(e,(l=t==null?void 0:t.data)==null?void 0:l.resourceOptions),n=new pt(i,{resolution:fi(e),...t==null?void 0:t.data});n.resource.src=e;const o=Ua(n,r,e);return(u=(h=t==null?void 0:t.data)==null?void 0:h.resourceOptions)!=null&&u.autoLoad||await i.load(),o},async load(e,t){return(await J.ADAPTER.fetch(e)).text()},unload:Rs.unload};nt.add(oD);class aD{constructor(){this._bundleIdConnector="-",this._createBundleAssetId=(t,r)=>`${t}${this._bundleIdConnector}${r}`,this._extractAssetIdFromBundle=(t,r)=>r.replace(`${t}${this._bundleIdConnector}`,""),this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(r=>{this._preferredOrder.push(r),r.priority||(r.priority=Object.keys(r.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this._preferredOrder=[],this._resolverHash={},this._assetMap={},this._rootPath=null,this._basePath=null,this._manifest=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const r=t;this._defaultSearchParams=Object.keys(r).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(r[i])}`).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(r=>{this.addBundle(r.name,r.assets)})}addBundle(t,r){const i=[];Array.isArray(r)?r.forEach(n=>{if(typeof n.name=="string"){const o=this._createBundleAssetId(t,n.name);i.push(o),this.add([n.name,o],n.srcs)}else{const o=n.name.map(l=>this._createBundleAssetId(t,l));o.forEach(l=>{i.push(l)}),this.add([...n.name,...o],n.srcs)}}):Object.keys(r).forEach(n=>{i.push(this._createBundleAssetId(t,n)),this.add([n,this._createBundleAssetId(t,n)],r[n])}),this._bundles[t]=i}add(t,r,i){const n=Vr(t);n.forEach(l=>{this._assetMap[l]&&console.warn(`[Resolver] already has key: ${l} overwriting`)}),Array.isArray(r)||(typeof r=="string"?r=HM(r):r=[r]);const o=r.map(l=>{let h=l;if(typeof l=="string"){let u=!1;for(let f=0;f<this._parsers.length;f++){const d=this._parsers[f];if(d.test(l)){h=d.parse(l),u=!0;break}}u||(h={src:l})}return h.format||(h.format=h.src.split(".").pop()),h.alias||(h.alias=n),(this._basePath||this._rootPath)&&(h.src=me.toAbsolute(h.src,this._basePath,this._rootPath)),h.src=this._appendDefaultSearchParams(h.src),h.data=h.data??i,h});n.forEach(l=>{this._assetMap[l]=o})}resolveBundle(t){const r=Ea(t);t=Vr(t);const i={};return t.forEach(n=>{const o=this._bundles[n];if(o){const l=this.resolve(o),h={};for(const u in l){const f=l[u];h[this._extractAssetIdFromBundle(n,u)]=f}i[n]=h}}),r?i[t[0]]:i}resolveUrl(t){const r=this.resolve(t);if(typeof t!="string"){const i={};for(const n in r)i[n]=r[n].src;return i}return r.src}resolve(t){const r=Ea(t);t=Vr(t);const i={};return t.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let o=this._assetMap[n];const l=this._getPreferredOrder(o),h=o[0];l==null||l.priority.forEach(u=>{l.params[u].forEach(f=>{const d=o.filter(g=>g[u]?g[u]===f:!1);d.length&&(o=d)})}),this._resolverHash[n]=o[0]??h}else{let o=n;(this._basePath||this._rootPath)&&(o=me.toAbsolute(o,this._basePath,this._rootPath)),o=this._appendDefaultSearchParams(o),this._resolverHash[n]={src:o}}i[n]=this._resolverHash[n]}),r?i[t[0]]:i}_getPreferredOrder(t){for(let r=0;r<t.length;r++){const i=t[0],n=this._preferredOrder.find(o=>o.params.format.includes(i.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const r=/\?/.test(t)?"&":"?";return`${t}${r}${this._defaultSearchParams}`}}class lD{constructor(){this._detections=[],this._initialized=!1,this.resolver=new aD,this.loader=new zM,this.cache=ps,this._backgroundLoader=new $M(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var o,l,h;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let u=t.manifest;typeof u=="string"&&(u=await this.load(u)),this.resolver.addManifest(u)}const r=((o=t.texturePreference)==null?void 0:o.resolution)??1,i=typeof r=="number"?[r]:r;let n=[];if((l=t.texturePreference)!=null&&l.format){const u=(h=t.texturePreference)==null?void 0:h.format;n=typeof u=="string"?[u]:u;for(const f of this._detections)await f.test()||(n=await f.remove(n))}else for(const u of this._detections)await u.test()&&(n=await u.add(n));this.resolver.prefer({params:{format:n,resolution:i}})}add(t,r,i){this.resolver.add(t,r,i)}async load(t,r){this._initialized||await this.init();const i=Ea(t),n=Vr(t).map(h=>typeof h!="string"?(this.resolver.add(h.src,h),h.src):h),o=this.resolver.resolve(n),l=await this._mapLoadToResolve(o,r);return i?l[n[0]]:l}addBundle(t,r){this.resolver.addBundle(t,r)}async loadBundle(t,r){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);const n=this.resolver.resolveBundle(t),o={},l=Object.keys(n);let h=0,u=0;const f=()=>{r==null||r(++h/u)},d=l.map(g=>{const m=n[g];return u+=Object.keys(m).length,this._mapLoadToResolve(m,f).then(v=>{o[g]=v})});return await Promise.all(d),i?o[t[0]]:o}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const r=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(r))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const r=this.resolver.resolveBundle(t);Object.values(r).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return ps.get(t);const r={};for(let i=0;i<t.length;i++)r[i]=ps.get(t[i]);return r}async _mapLoadToResolve(t,r){const i=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const o=await this.loader.load(i,r);this._backgroundLoader.active=!0;const l={};return i.forEach((h,u)=>{const f=o[h.src],d=[h.src];h.alias&&d.push(...h.alias),l[n[u]]=f,ps.set(d,f)}),l}async unload(t){this._initialized||await this.init();const r=Vr(t).map(n=>typeof n!="string"?n.src:n),i=this.resolver.resolve(r);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=Vr(t);const r=this.resolver.resolveBundle(t),i=Object.keys(r).map(n=>this._unloadFromResolved(r[n]));await Promise.all(i)}async _unloadFromResolved(t){const r=Object.values(t);r.forEach(i=>{ps.remove(i.src)}),await this.loader.unload(r)}get detections(){return this._detections}get preferWorkers(){return Rs.config.preferWorkers}set preferWorkers(t){Rs.config.preferWorkers=t}}const Li=new lD;nt.handleByList(Z.LoadParser,Li.loader.parsers).handleByList(Z.ResolveParser,Li.resolver.parsers).handleByList(Z.CacheParser,Li.cache.parsers).handleByList(Z.DetectionParser,Li.detections);const hD={extension:Z.CacheParser,test:e=>Array.isArray(e)&&e.every(t=>t instanceof it),getCacheableAssets:(e,t)=>{const r={};return e.forEach(i=>{t.forEach((n,o)=>{r[i+(o===0?"":o+1)]=n})}),r}};nt.add(hD);const uD={extension:{type:Z.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await J.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then(r=>r.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"avif"],remove:async e=>e.filter(t=>t!=="avif")};nt.add(uD);const cD={extension:{type:Z.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await J.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then(r=>r.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"webp"],remove:async e=>e.filter(t=>t!=="webp")};nt.add(cD);const cg=["png","jpg","jpeg"],fD={extension:{type:Z.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...cg],remove:async e=>e.filter(t=>!cg.includes(t))};nt.add(fD);const dD={extension:Z.ResolveParser,test:Rs.test,parse:e=>{var t;return{resolution:parseFloat(((t=J.RETINA_PREFIX.exec(e))==null?void 0:t[1])??"1"),format:e.split(".").pop(),src:e}}};nt.add(dD);var ke=(e=>(e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e))(ke||{});const Ta={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let Hr,vn;function fg(){vn={s3tc:Hr.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Hr.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Hr.getExtension("WEBGL_compressed_texture_etc"),etc1:Hr.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Hr.getExtension("WEBGL_compressed_texture_pvrtc")||Hr.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Hr.getExtension("WEBGL_compressed_texture_atc"),astc:Hr.getExtension("WEBGL_compressed_texture_astc")}}const pD={extension:{type:Z.DetectionParser,priority:2},test:async()=>{const t=J.ADAPTER.createCanvas().getContext("webgl");return t?(Hr=t,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async e=>{vn||fg();const t=[];for(const r in vn)vn[r]&&t.push(r);return[...t,...e]},remove:async e=>(vn||fg(),e.filter(t=>!(t in vn)))};nt.add(pD);class gD extends Fs{constructor(t,r={width:1,height:1,autoLoad:!0}){let i,n;typeof t=="string"?(i=t,n=new Uint8Array):(i=null,n=t),super(n,r),this.origin=i,this.buffer=n?new Eu(n):null,this.origin&&r.autoLoad!==!1&&this.load(),n!=null&&n.length&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}async load(){const i=await(await(await fetch(this.origin)).blob()).arrayBuffer();return this.data=new Uint32Array(i),this.buffer=new Eu(i),this.loaded=!0,this.onBlobLoaded(i),this.update(),this}}class Wi extends gD{constructor(t,r){super(t,r),this.format=r.format,this.levels=r.levels||1,this._width=r.width,this._height=r.height,this._extension=Wi._formatToExtension(this.format),(r.levelBuffers||this.buffer)&&(this._levelBuffers=r.levelBuffers||Wi._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,r,i){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let l=0,h=this.levels;l<h;l++){const{levelID:u,levelWidth:f,levelHeight:d,levelBuffer:g}=this._levelBuffers[l];n.compressedTexImage2D(n.TEXTURE_2D,u,this.format,f,d,0,g)}return!0}onBlobLoaded(){this._levelBuffers=Wi._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,r,i,n,o,l,h){const u=new Array(i);let f=t.byteOffset,d=l,g=h,m=d+n-1&~(n-1),v=g+o-1&~(o-1),y=m*v*Ta[r];for(let w=0;w<i;w++)u[w]={levelID:w,levelWidth:i>1?d:m,levelHeight:i>1?g:v,levelBuffer:new Uint8Array(t.buffer,f,y)},f+=y,d=d>>1||1,g=g>>1||1,m=d+n-1&~(n-1),v=g+o-1&~(o-1),y=m*v*Ta[r];return u}}const $h=4,zo=124,mD=32,dg=20,vD=542327876,Vo={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},_D={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},jo={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},yD=1,xD=2,bD=4,wD=64,ED=512,TD=131072,AD=827611204,SD=861165636,CD=894720068,ID=808540228,PD=4,RD={[AD]:ke.COMPRESSED_RGBA_S3TC_DXT1_EXT,[SD]:ke.COMPRESSED_RGBA_S3TC_DXT3_EXT,[CD]:ke.COMPRESSED_RGBA_S3TC_DXT5_EXT},MD={70:ke.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:ke.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:ke.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:ke.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:ke.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:ke.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:ke.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:ke.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:ke.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function DD(e){const t=new Uint32Array(e);if(t[0]!==vD)throw new Error("Invalid DDS file magic word");const i=new Uint32Array(e,0,zo/Uint32Array.BYTES_PER_ELEMENT),n=i[Vo.HEIGHT],o=i[Vo.WIDTH],l=i[Vo.MIPMAP_COUNT],h=new Uint32Array(e,Vo.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,mD/Uint32Array.BYTES_PER_ELEMENT),u=h[yD];if(u&bD){const f=h[_D.FOURCC];if(f!==ID){const E=RD[f],I=$h+zo,D=new Uint8Array(e,I);return[new Wi(D,{format:E,width:o,height:n,levels:l})]}const d=$h+zo,g=new Uint32Array(t.buffer,d,dg/Uint32Array.BYTES_PER_ELEMENT),m=g[jo.DXGI_FORMAT],v=g[jo.RESOURCE_DIMENSION],y=g[jo.MISC_FLAG],w=g[jo.ARRAY_SIZE],x=MD[m];if(x===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${m}`);if(y===PD)throw new Error("DDSParser does not support cubemap textures");if(v===6)throw new Error("DDSParser does not supported 3D texture data");const A=new Array,S=$h+zo+dg;if(w===1)A.push(new Uint8Array(e,S));else{const E=Ta[x];let I=0,D=o,L=n;for(let F=0;F<l;F++){const X=Math.max(1,D+3&-4),Y=Math.max(1,L+3&-4),z=X*Y*E;I+=z,D=D>>>1,L=L>>>1}let O=S;for(let F=0;F<w;F++)A.push(new Uint8Array(e,O,I)),O+=I}return A.map(E=>new Wi(E,{format:x,width:o,height:n,levels:l}))}throw u&wD?new Error("DDSParser does not support uncompressed texture data."):u&ED?new Error("DDSParser does not supported YUV uncompressed texture data."):u&TD?new Error("DDSParser does not support single-channel (lumninance) texture data!"):u&xD?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const pg=[171,75,84,88,32,49,49,187,13,10,26,10],BD=67305985,nr={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Nu=64,gg={[st.UNSIGNED_BYTE]:1,[st.UNSIGNED_SHORT]:2,[st.INT]:4,[st.UNSIGNED_INT]:4,[st.FLOAT]:4,[st.HALF_FLOAT]:8},OD={[V.RGBA]:4,[V.RGB]:3,[V.RG]:2,[V.RED]:1,[V.LUMINANCE]:1,[V.LUMINANCE_ALPHA]:2,[V.ALPHA]:1},FD={[st.UNSIGNED_SHORT_4_4_4_4]:2,[st.UNSIGNED_SHORT_5_5_5_1]:2,[st.UNSIGNED_SHORT_5_6_5]:2};function LD(e,t,r=!1){const i=new DataView(t);if(!ND(e,i))return null;const n=i.getUint32(nr.ENDIANNESS,!0)===BD,o=i.getUint32(nr.GL_TYPE,n),l=i.getUint32(nr.GL_FORMAT,n),h=i.getUint32(nr.GL_INTERNAL_FORMAT,n),u=i.getUint32(nr.PIXEL_WIDTH,n),f=i.getUint32(nr.PIXEL_HEIGHT,n)||1,d=i.getUint32(nr.PIXEL_DEPTH,n)||1,g=i.getUint32(nr.NUMBER_OF_ARRAY_ELEMENTS,n)||1,m=i.getUint32(nr.NUMBER_OF_FACES,n),v=i.getUint32(nr.NUMBER_OF_MIPMAP_LEVELS,n),y=i.getUint32(nr.BYTES_OF_KEY_VALUE_DATA,n);if(f===0||d!==1)throw new Error("Only 2D textures are supported");if(m!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(g!==1)throw new Error("WebGL does not support array textures");const w=4,x=4,A=u+3&-4,S=f+3&-4,E=new Array(g);let I=u*f;o===0&&(I=A*S);let D;if(o!==0?gg[o]?D=gg[o]*OD[l]:D=FD[o]:D=Ta[h],D===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const L=r?UD(i,y,n):null;let F=I*D,X=u,Y=f,z=A,K=S,W=Nu+y;for(let k=0;k<v;k++){const at=i.getUint32(W,n);let ft=W+4;for(let j=0;j<g;j++){let vt=E[j];vt||(vt=E[j]=new Array(v)),vt[k]={levelID:k,levelWidth:v>1||o!==0?X:z,levelHeight:v>1||o!==0?Y:K,levelBuffer:new Uint8Array(t,ft,F)},ft+=F}W+=at+4,W=W%4!==0?W+4-W%4:W,X=X>>1||1,Y=Y>>1||1,z=X+w-1&~(w-1),K=Y+x-1&~(x-1),F=z*K*D}return o!==0?{uncompressed:E.map(k=>{let at=k[0].levelBuffer,ft=!1;return o===st.FLOAT?at=new Float32Array(k[0].levelBuffer.buffer,k[0].levelBuffer.byteOffset,k[0].levelBuffer.byteLength/4):o===st.UNSIGNED_INT?(ft=!0,at=new Uint32Array(k[0].levelBuffer.buffer,k[0].levelBuffer.byteOffset,k[0].levelBuffer.byteLength/4)):o===st.INT&&(ft=!0,at=new Int32Array(k[0].levelBuffer.buffer,k[0].levelBuffer.byteOffset,k[0].levelBuffer.byteLength/4)),{resource:new Fs(at,{width:k[0].levelWidth,height:k[0].levelHeight}),type:o,format:ft?kD(l):l}}),kvData:L}:{compressed:E.map(k=>new Wi(null,{format:h,width:u,height:f,levels:v,levelBuffers:k})),kvData:L}}function ND(e,t){for(let r=0;r<pg.length;r++)if(t.getUint8(r)!==pg[r])return console.error(`${e} is not a valid *.ktx file!`),!1;return!0}function kD(e){switch(e){case V.RGBA:return V.RGBA_INTEGER;case V.RGB:return V.RGB_INTEGER;case V.RG:return V.RG_INTEGER;case V.RED:return V.RED_INTEGER;default:return e}}function UD(e,t,r){const i=new Map;let n=0;for(;n<t;){const o=e.getUint32(Nu+n,r),l=Nu+n+4,h=3-(o+3)%4;if(o===0||o>t-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let u=0;for(;u<o&&e.getUint8(l+u)!==0;u++);if(u===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const f=new TextDecoder().decode(new Uint8Array(e.buffer,l,u)),d=new DataView(e.buffer,l+u+1,o-u-1);i.set(f,d),n+=4+o+h}return i}const GD={extension:{type:Z.LoadParser,priority:Dr.High},test(e){return ka(e,".dds")},async load(e,t,r){const n=await(await J.ADAPTER.fetch(e)).arrayBuffer(),l=DD(n).map(h=>{const u=new pt(h,{mipmap:Mr.OFF,alphaMode:gr.NO_PREMULTIPLIED_ALPHA,resolution:fi(e),...t.data});return Ua(u,r,e)});return l.length===1?l[0]:l},unload(e){Array.isArray(e)?e.forEach(t=>t.destroy(!0)):e.destroy(!0)}};nt.add(GD);const WD={extension:{type:Z.LoadParser,priority:Dr.High},test(e){return ka(e,".ktx")},async load(e,t,r){const n=await(await J.ADAPTER.fetch(e)).arrayBuffer(),{compressed:o,uncompressed:l,kvData:h}=LD(e,n),u=o??l,f={mipmap:Mr.OFF,alphaMode:gr.NO_PREMULTIPLIED_ALPHA,resolution:fi(e),...t.data},d=u.map(g=>{u===l&&Object.assign(f,{type:g.type,format:g.format});const m=new pt(g,f);return m.ktxKeyValueData=h,Ua(m,r,e)});return d.length===1?d[0]:d},unload(e){Array.isArray(e)?e.forEach(t=>t.destroy(!0)):e.destroy(!0)}};nt.add(WD);const $D={extension:Z.ResolveParser,test:e=>{const r=e.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(r)},parse:e=>{var i,n;if(e.split("?")[0].split(".").pop()==="ktx"){const o=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(o.some(l=>e.endsWith(l)))return{resolution:parseFloat(((i=J.RETINA_PREFIX.exec(e))==null?void 0:i[1])??"1"),format:o.find(l=>e.endsWith(l)),src:e}}return{resolution:parseFloat(((n=J.RETINA_PREFIX.exec(e))==null?void 0:n[1])??"1"),format:e.split(".").pop(),src:e}}};nt.add($D);const mg=new Et,vg=4,ku=class{constructor(e){this.renderer=e}async image(e,t,r){const i=new Image;return i.src=await this.base64(e,t,r),i}async base64(e,t,r){const i=this.canvas(e);if(i.toDataURL!==void 0)return i.toDataURL(t,r);if(i.convertToBlob!==void 0){const n=await i.convertToBlob({type:t,quality:r});return await new Promise(o=>{const l=new FileReader;l.onload=()=>o(l.result),l.readAsDataURL(n)})}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")}canvas(e,t){const r=this.renderer;let i,n=!1,o,l=!1;e&&(e instanceof gi?o=e:(o=this.renderer.generateTexture(e),l=!0)),o?(i=o.baseTexture.resolution,t=t??o.frame,n=!1,r.renderTexture.bind(o)):(i=r.resolution,t||(t=mg,t.width=r.width,t.height=r.height),n=!0,r.renderTexture.bind(null));const h=Math.round(t.width*i),u=Math.round(t.height*i);let f=new zp(h,u,1);const d=new Uint8Array(vg*h*u),g=r.gl;g.readPixels(Math.round(t.x*i),Math.round(t.y*i),h,u,g.RGBA,g.UNSIGNED_BYTE,d);const m=f.context.getImageData(0,0,h,u);if(ku.arrayPostDivide(d,m.data),f.context.putImageData(m,0,0),n){const v=new zp(f.width,f.height,1);v.context.scale(1,-1),v.context.drawImage(f.canvas,0,-u),f.destroy(),f=v}return l&&o.destroy(!0),f.canvas}pixels(e,t){const r=this.renderer;let i,n,o=!1;e&&(e instanceof gi?n=e:(n=this.renderer.generateTexture(e),o=!0)),n?(i=n.baseTexture.resolution,t=t??n.frame,r.renderTexture.bind(n)):(i=r.resolution,t||(t=mg,t.width=r.width,t.height=r.height),r.renderTexture.bind(null));const l=Math.round(t.width*i),h=Math.round(t.height*i),u=new Uint8Array(vg*l*h),f=r.gl;return f.readPixels(Math.round(t.x*i),Math.round(t.y*i),l,h,f.RGBA,f.UNSIGNED_BYTE,u),o&&n.destroy(!0),ku.arrayPostDivide(u,u),u}destroy(){this.renderer=null}static arrayPostDivide(e,t){for(let r=0;r<e.length;r+=4){const i=t[r+3]=e[r+3];i!==0?(t[r]=Math.round(Math.min(e[r]*255/i,255)),t[r+1]=Math.round(Math.min(e[r+1]*255/i,255)),t[r+2]=Math.round(Math.min(e[r+2]*255/i,255))):(t[r]=e[r],t[r+1]=e[r+1],t[r+2]=e[r+2])}}};let vv=ku;vv.extension={name:"extract",type:Z.RendererSystem};nt.add(vv);const Aa={build(e){const t=e.points;let r,i,n,o,l,h;if(e.type===ge.CIRC){const y=e.shape;r=y.x,i=y.y,l=h=y.radius,n=o=0}else if(e.type===ge.ELIP){const y=e.shape;r=y.x,i=y.y,l=y.width,h=y.height,n=o=0}else{const y=e.shape,w=y.width/2,x=y.height/2;r=y.x+w,i=y.y+x,l=h=Math.max(0,Math.min(y.radius,Math.min(w,x))),n=w-l,o=x-h}if(!(l>=0&&h>=0&&n>=0&&o>=0)){t.length=0;return}const u=Math.ceil(2.3*Math.sqrt(l+h)),f=u*8+(n?4:0)+(o?4:0);if(t.length=f,f===0)return;if(u===0){t.length=8,t[0]=t[6]=r+n,t[1]=t[3]=i+o,t[2]=t[4]=r-n,t[5]=t[7]=i-o;return}let d=0,g=u*4+(n?2:0)+2,m=g,v=f;{const y=n+l,w=o,x=r+y,A=r-y,S=i+w;if(t[d++]=x,t[d++]=S,t[--g]=S,t[--g]=A,o){const E=i-w;t[m++]=A,t[m++]=E,t[--v]=E,t[--v]=x}}for(let y=1;y<u;y++){const w=Math.PI/2*(y/u),x=n+Math.cos(w)*l,A=o+Math.sin(w)*h,S=r+x,E=r-x,I=i+A,D=i-A;t[d++]=S,t[d++]=I,t[--g]=I,t[--g]=E,t[m++]=E,t[m++]=D,t[--v]=D,t[--v]=S}{const y=n,w=o+h,x=r+y,A=r-y,S=i+w,E=i-w;t[d++]=x,t[d++]=S,t[--v]=E,t[--v]=x,n&&(t[d++]=A,t[d++]=S,t[--v]=E,t[--v]=A)}},triangulate(e,t){const r=e.points,i=t.points,n=t.indices;if(r.length===0)return;let o=i.length/2;const l=o;let h,u;if(e.type!==ge.RREC){const d=e.shape;h=d.x,u=d.y}else{const d=e.shape;h=d.x+d.width/2,u=d.y+d.height/2}const f=e.matrix;i.push(e.matrix?f.a*h+f.c*u+f.tx:h,e.matrix?f.b*h+f.d*u+f.ty:u),o++,i.push(r[0],r[1]);for(let d=2;d<r.length;d+=2)i.push(r[d],r[d+1]),n.push(o++,l,o);n.push(l+1,l,o)}};function _g(e,t=!1){const r=e.length;if(r<6)return;let i=0;for(let n=0,o=e[r-2],l=e[r-1];n<r;n+=2){const h=e[n],u=e[n+1];i+=(h-o)*(u+l),o=h,l=u}if(!t&&i>0||t&&i<=0){const n=r/2;for(let o=n+n%2;o<r;o+=2){const l=r-o-2,h=r-o-1,u=o,f=o+1;[e[l],e[u]]=[e[u],e[l]],[e[h],e[f]]=[e[f],e[h]]}}}const _v={build(e){e.points=e.shape.points.slice()},triangulate(e,t){let r=e.points;const i=e.holes,n=t.points,o=t.indices;if(r.length>=6){_g(r,!1);const l=[];for(let f=0;f<i.length;f++){const d=i[f];_g(d.points,!0),l.push(r.length/2),r=r.concat(d.points)}const h=gT(r,l,2);if(!h)return;const u=n.length/2;for(let f=0;f<h.length;f+=3)o.push(h[f]+u),o.push(h[f+1]+u),o.push(h[f+2]+u);for(let f=0;f<r.length;f++)n.push(r[f])}}},HD={build(e){const t=e.shape,r=t.x,i=t.y,n=t.width,o=t.height,l=e.points;l.length=0,n>=0&&o>=0&&l.push(r,i,r+n,i,r+n,i+o,r,i+o)},triangulate(e,t){const r=e.points,i=t.points;if(r.length===0)return;const n=i.length/2;i.push(r[0],r[1],r[2],r[3],r[6],r[7],r[4],r[5]),t.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},XD={build(e){Aa.build(e)},triangulate(e,t){Aa.triangulate(e,t)}};var oi=(e=>(e.MITER="miter",e.BEVEL="bevel",e.ROUND="round",e))(oi||{}),Ni=(e=>(e.BUTT="butt",e.ROUND="round",e.SQUARE="square",e))(Ni||{});const Bn={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(e,t=20){if(!this.adaptive||!e||isNaN(e))return t;let r=Math.ceil(e/this.maxLength);return r<this.minSegments?r=this.minSegments:r>this.maxSegments&&(r=this.maxSegments),r}};class yg{static curveTo(t,r,i,n,o,l){const h=l[l.length-2],f=l[l.length-1]-r,d=h-t,g=n-r,m=i-t,v=Math.abs(f*m-d*g);if(v<1e-8||o===0)return(l[l.length-2]!==t||l[l.length-1]!==r)&&l.push(t,r),null;const y=f*f+d*d,w=g*g+m*m,x=f*g+d*m,A=o*Math.sqrt(y)/v,S=o*Math.sqrt(w)/v,E=A*x/y,I=S*x/w,D=A*m+S*d,L=A*g+S*f,O=d*(S+E),F=f*(S+E),X=m*(A+I),Y=g*(A+I),z=Math.atan2(F-L,O-D),K=Math.atan2(Y-L,X-D);return{cx:D+t,cy:L+r,radius:o,startAngle:z,endAngle:K,anticlockwise:d*g>m*f}}static arc(t,r,i,n,o,l,h,u,f){const d=h-l,g=Bn._segmentsCount(Math.abs(d)*o,Math.ceil(Math.abs(d)/xa)*40),m=d/(g*2),v=m*2,y=Math.cos(m),w=Math.sin(m),x=g-1,A=x%1/x;for(let S=0;S<=x;++S){const E=S+A*S,I=m+l+v*E,D=Math.cos(I),L=-Math.sin(I);f.push((y*D+w*L)*o+i,(y*-L+w*D)*o+n)}}}class zD{constructor(){this.reset()}begin(t,r,i){this.reset(),this.style=t,this.start=r,this.attribStart=i}end(t,r){this.attribSize=r-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class pc{static curveLength(t,r,i,n,o,l,h,u){let d=0,g=0,m=0,v=0,y=0,w=0,x=0,A=0,S=0,E=0,I=0,D=t,L=r;for(let O=1;O<=10;++O)g=O/10,m=g*g,v=m*g,y=1-g,w=y*y,x=w*y,A=x*t+3*w*g*i+3*y*m*o+v*h,S=x*r+3*w*g*n+3*y*m*l+v*u,E=D-A,I=L-S,D=A,L=S,d+=Math.sqrt(E*E+I*I);return d}static curveTo(t,r,i,n,o,l,h){const u=h[h.length-2],f=h[h.length-1];h.length-=2;const d=Bn._segmentsCount(pc.curveLength(u,f,t,r,i,n,o,l));let g=0,m=0,v=0,y=0,w=0;h.push(u,f);for(let x=1,A=0;x<=d;++x)A=x/d,g=1-A,m=g*g,v=m*g,y=A*A,w=y*A,h.push(v*u+3*m*A*t+3*g*y*i+w*o,v*f+3*m*A*r+3*g*y*n+w*l)}}function xg(e,t,r,i,n,o,l,h){const u=e-r*n,f=t-i*n,d=e+r*o,g=t+i*o;let m,v;l?(m=i,v=-r):(m=-i,v=r);const y=u+m,w=f+v,x=d+m,A=g+v;return h.push(y,w),h.push(x,A),2}function Pi(e,t,r,i,n,o,l,h){const u=r-e,f=i-t;let d=Math.atan2(u,f),g=Math.atan2(n-e,o-t);h&&d<g?d+=Math.PI*2:!h&&d>g&&(g+=Math.PI*2);let m=d;const v=g-d,y=Math.abs(v),w=Math.sqrt(u*u+f*f),x=(15*y*Math.sqrt(w)/Math.PI>>0)+1,A=v/x;if(m+=A,h){l.push(e,t),l.push(r,i);for(let S=1,E=m;S<x;S++,E+=A)l.push(e,t),l.push(e+Math.sin(E)*w,t+Math.cos(E)*w);l.push(e,t),l.push(n,o)}else{l.push(r,i),l.push(e,t);for(let S=1,E=m;S<x;S++,E+=A)l.push(e+Math.sin(E)*w,t+Math.cos(E)*w),l.push(e,t);l.push(n,o),l.push(e,t)}return x*2}function VD(e,t){const r=e.shape;let i=e.points||r.points.slice();const n=t.closePointEps;if(i.length===0)return;const o=e.lineStyle,l=new At(i[0],i[1]),h=new At(i[i.length-2],i[i.length-1]),u=r.type!==ge.POLY||r.closeStroke,f=Math.abs(l.x-h.x)<n&&Math.abs(l.y-h.y)<n;if(u){i=i.slice(),f&&(i.pop(),i.pop(),h.set(i[i.length-2],i[i.length-1]));const j=(l.x+h.x)*.5,vt=(h.y+l.y)*.5;i.unshift(j,vt),i.push(j,vt)}const d=t.points,g=i.length/2;let m=i.length;const v=d.length/2,y=o.width/2,w=y*y,x=o.miterLimit*o.miterLimit;let A=i[0],S=i[1],E=i[2],I=i[3],D=0,L=0,O=-(S-I),F=A-E,X=0,Y=0,z=Math.sqrt(O*O+F*F);O/=z,F/=z,O*=y,F*=y;const K=o.alignment,W=(1-K)*2,k=K*2;u||(o.cap===Ni.ROUND?m+=Pi(A-O*(W-k)*.5,S-F*(W-k)*.5,A-O*W,S-F*W,A+O*k,S+F*k,d,!0)+2:o.cap===Ni.SQUARE&&(m+=xg(A,S,O,F,W,k,!0,d))),d.push(A-O*W,S-F*W),d.push(A+O*k,S+F*k);for(let j=1;j<g-1;++j){A=i[(j-1)*2],S=i[(j-1)*2+1],E=i[j*2],I=i[j*2+1],D=i[(j+1)*2],L=i[(j+1)*2+1],O=-(S-I),F=A-E,z=Math.sqrt(O*O+F*F),O/=z,F/=z,O*=y,F*=y,X=-(I-L),Y=E-D,z=Math.sqrt(X*X+Y*Y),X/=z,Y/=z,X*=y,Y*=y;const vt=E-A,Ot=S-I,H=E-D,rt=L-I,xt=vt*H+Ot*rt,Pt=Ot*H-rt*vt,Mt=Pt<0;if(Math.abs(Pt)<.001*Math.abs(xt)){d.push(E-O*W,I-F*W),d.push(E+O*k,I+F*k),xt>=0&&(o.join===oi.ROUND?m+=Pi(E,I,E-O*W,I-F*W,E-X*W,I-Y*W,d,!1)+4:m+=2,d.push(E-X*k,I-Y*k),d.push(E+X*W,I+Y*W));continue}const Nt=(-O+A)*(-F+I)-(-O+E)*(-F+S),kt=(-X+D)*(-Y+I)-(-X+E)*(-Y+L),re=(vt*kt-H*Nt)/Pt,jt=(rt*Nt-Ot*kt)/Pt,ie=(re-E)*(re-E)+(jt-I)*(jt-I),se=E+(re-E)*W,Dt=I+(jt-I)*W,Ut=E-(re-E)*k,Yt=I-(jt-I)*k,qt=Math.min(vt*vt+Ot*Ot,H*H+rt*rt),ve=Mt?W:k,vi=qt+ve*ve*w;ie<=vi?o.join===oi.BEVEL||ie/w>x?(Mt?(d.push(se,Dt),d.push(E+O*k,I+F*k),d.push(se,Dt),d.push(E+X*k,I+Y*k)):(d.push(E-O*W,I-F*W),d.push(Ut,Yt),d.push(E-X*W,I-Y*W),d.push(Ut,Yt)),m+=2):o.join===oi.ROUND?Mt?(d.push(se,Dt),d.push(E+O*k,I+F*k),m+=Pi(E,I,E+O*k,I+F*k,E+X*k,I+Y*k,d,!0)+4,d.push(se,Dt),d.push(E+X*k,I+Y*k)):(d.push(E-O*W,I-F*W),d.push(Ut,Yt),m+=Pi(E,I,E-O*W,I-F*W,E-X*W,I-Y*W,d,!1)+4,d.push(E-X*W,I-Y*W),d.push(Ut,Yt)):(d.push(se,Dt),d.push(Ut,Yt)):(d.push(E-O*W,I-F*W),d.push(E+O*k,I+F*k),o.join===oi.ROUND?Mt?m+=Pi(E,I,E+O*k,I+F*k,E+X*k,I+Y*k,d,!0)+2:m+=Pi(E,I,E-O*W,I-F*W,E-X*W,I-Y*W,d,!1)+2:o.join===oi.MITER&&ie/w<=x&&(Mt?(d.push(Ut,Yt),d.push(Ut,Yt)):(d.push(se,Dt),d.push(se,Dt)),m+=2),d.push(E-X*W,I-Y*W),d.push(E+X*k,I+Y*k),m+=2)}A=i[(g-2)*2],S=i[(g-2)*2+1],E=i[(g-1)*2],I=i[(g-1)*2+1],O=-(S-I),F=A-E,z=Math.sqrt(O*O+F*F),O/=z,F/=z,O*=y,F*=y,d.push(E-O*W,I-F*W),d.push(E+O*k,I+F*k),u||(o.cap===Ni.ROUND?m+=Pi(E-O*(W-k)*.5,I-F*(W-k)*.5,E-O*W,I-F*W,E+O*k,I+F*k,d,!1)+2:o.cap===Ni.SQUARE&&(m+=xg(E,I,O,F,W,k,!1,d)));const at=t.indices,ft=Bn.epsilon*Bn.epsilon;for(let j=v;j<m+v-2;++j)A=d[j*2],S=d[j*2+1],E=d[(j+1)*2],I=d[(j+1)*2+1],D=d[(j+2)*2],L=d[(j+2)*2+1],!(Math.abs(A*(I-L)+E*(L-S)+D*(S-I))<ft)&&at.push(j,j+1,j+2)}function jD(e,t){let r=0;const i=e.shape,n=e.points||i.points,o=i.type!==ge.POLY||i.closeStroke;if(n.length===0)return;const l=t.points,h=t.indices,u=n.length/2,f=l.length/2;let d=f;for(l.push(n[0],n[1]),r=1;r<u;r++)l.push(n[r*2],n[r*2+1]),h.push(d,d+1),d++;o&&h.push(d,f)}function bg(e,t){e.lineStyle.native?jD(e,t):VD(e,t)}class gc{static curveLength(t,r,i,n,o,l){const h=t-2*i+o,u=r-2*n+l,f=2*i-2*t,d=2*n-2*r,g=4*(h*h+u*u),m=4*(h*f+u*d),v=f*f+d*d,y=2*Math.sqrt(g+m+v),w=Math.sqrt(g),x=2*g*w,A=2*Math.sqrt(v),S=m/w;return(x*y+w*m*(y-A)+(4*v*g-m*m)*Math.log((2*w+S+y)/(S+A)))/(4*x)}static curveTo(t,r,i,n,o){const l=o[o.length-2],h=o[o.length-1],u=Bn._segmentsCount(gc.curveLength(l,h,t,r,i,n));let f=0,d=0;for(let g=1;g<=u;++g){const m=g/u;f=l+(t-l)*m,d=h+(r-h)*m,o.push(f+(t+(i-t)*m-f)*m,d+(r+(n-r)*m-d)*m)}}}const Hh={[ge.POLY]:_v,[ge.CIRC]:Aa,[ge.ELIP]:Aa,[ge.RECT]:HD,[ge.RREC]:XD},wg=[],Yo=[];class Sa{constructor(t,r=null,i=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=r,this.matrix=n,this.type=t.type}clone(){return new Sa(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const dn=new At,yv=class extends Em{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new ba,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),Yo.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),wg.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,r=null,i=null){const n=new Sa(e,t,r,i);return this.graphicsData.push(n),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const r=new Sa(e,null,null,t),i=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=i.lineStyle,i.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let r=0;r<t.length;++r){const i=t[r];if(i.fillStyle.visible&&i.shape&&(i.matrix?i.matrix.applyInverse(e,dn):dn.copyFrom(e),i.shape.contains(dn.x,dn.y))){let n=!1;if(i.holes){for(let o=0;o<i.holes.length;o++)if(i.holes[o].shape.contains(dn.x,dn.y)){n=!0;break}}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let r=null,i=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],i=r.style);for(let h=this.shapeIndex;h<t.length;h++){this.shapeIndex++;const u=t[h],f=u.fillStyle,d=u.lineStyle;Hh[u.type].build(u),u.matrix&&this.transformPoints(u.points,u.matrix),(f.visible||d.visible)&&this.processHoles(u.holes);for(let m=0;m<2;m++){const v=m===0?f:d;if(!v.visible)continue;const y=v.texture.baseTexture,w=this.indices.length,x=this.points.length/2;y.wrapMode=ui.REPEAT,m===0?this.processFill(u):this.processLine(u);const A=this.points.length/2-x;A!==0&&(r&&!this._compareStyles(i,v)&&(r.end(w,x),r=null),r||(r=wg.pop()||new zD,r.begin(v,w,x),this.batches.push(r),i=v),this.addUvs(this.points,e,v.texture,x,A,v.matrix))}}const n=this.indices.length,o=this.points.length/2;if(r&&r.end(n,o),this.batches.length===0){this.batchable=!0;return}const l=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&l===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=l?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const r=this.graphicsData[e],i=r.fillStyle,n=r.lineStyle;if(i&&!i.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,r=e.length;t<r;t++){const i=e[t];for(let n=0;n<i.size;n++){const o=i.start+n;this.indicesUint16[o]=this.indicesUint16[o]-i.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<yv.BATCHABLE_SIZE*2}buildDrawCalls(){let e=++pt._globalBatch;for(let d=0;d<this.drawCalls.length;d++)this.drawCalls[d].texArray.clear(),Yo.push(this.drawCalls[d]);this.drawCalls.length=0;const t=this.colors,r=this.textureIds;let i=Yo.pop();i||(i=new Au,i.texArray=new Cu),i.texArray.count=0,i.start=0,i.size=0,i.type=Ir.TRIANGLES;let n=0,o=null,l=0,h=!1,u=Ir.TRIANGLES,f=0;this.drawCalls.push(i);for(let d=0;d<this.batches.length;d++){const g=this.batches[d],m=8,v=g.style,y=v.texture.baseTexture;h!==!!v.native&&(h=!!v.native,u=h?Ir.LINES:Ir.TRIANGLES,o=null,n=m,e++),o!==y&&(o=y,y._batchEnabled!==e&&(n===m&&(e++,n=0,i.size>0&&(i=Yo.pop(),i||(i=new Au,i.texArray=new Cu),this.drawCalls.push(i)),i.start=f,i.size=0,i.texArray.count=0,i.type=u),y.touched=1,y._batchEnabled=e,y._batchLocation=n,y.wrapMode=ui.REPEAT,i.texArray.elements[i.texArray.count++]=y,n++)),i.size+=g.size,f+=g.size,l=y._batchLocation,this.addColors(t,v.color,v.alpha,g.attribSize,g.attribStart),this.addTextureIds(r,l,g.attribSize,g.attribStart)}pt._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,r=this.colors,i=this.textureIds,n=new ArrayBuffer(e.length*3*4),o=new Float32Array(n),l=new Uint32Array(n);let h=0;for(let u=0;u<e.length/2;u++)o[h++]=e[u*2],o[h++]=e[u*2+1],o[h++]=t[u*2],o[h++]=t[u*2+1],l[h++]=r[u],o[h++]=i[u];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?_v.triangulate(e,this):Hh[e.type].triangulate(e,this)}processLine(e){bg(e,this);for(let t=0;t<e.holes.length;t++)bg(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const r=e[t];Hh[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let r=0;r<e.length/2;r++){const i=e[r*2],n=e[r*2+1];e[r*2]=t.a*i+t.c*n+t.tx,e[r*2+1]=t.b*i+t.d*n+t.ty}}addColors(e,t,r,i,n=0){const o=(t>>16)+(t&65280)+((t&255)<<16),l=ac(o,r);e.length=Math.max(e.length,n+i);for(let h=0;h<i;h++)e[n+h]=l}addTextureIds(e,t,r,i=0){e.length=Math.max(e.length,i+r);for(let n=0;n<r;n++)e[i+n]=t}addUvs(e,t,r,i,n,o=null){let l=0;const h=t.length,u=r.frame;for(;l<n;){let d=e[(i+l)*2],g=e[(i+l)*2+1];if(o){const m=o.a*d+o.c*g+o.tx;g=o.b*d+o.d*g+o.ty,d=m}l++,t.push(d/u.width,g/u.height)}const f=r.baseTexture;(u.width<f.width||u.height<f.height)&&this.adjustUvs(t,r,h,n)}adjustUvs(e,t,r,i){const n=t.baseTexture,o=1e-6,l=r+i*2,h=t.frame,u=h.width/n.width,f=h.height/n.height;let d=h.x/h.width,g=h.y/h.height,m=Math.floor(e[r]+o),v=Math.floor(e[r+1]+o);for(let y=r+2;y<l;y+=2)m=Math.min(m,Math.floor(e[y]+o)),v=Math.min(v,Math.floor(e[y+1]+o));d-=m,g-=v;for(let y=r;y<l;y+=2)e[y]=(e[y]+d)*u,e[y+1]=(e[y+1]+g)*f}};let xv=yv;xv.BATCHABLE_SIZE=100;class Ga{constructor(){this.color=16777215,this.alpha=1,this.texture=it.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Ga;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=it.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class mc extends Ga{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Ni.BUTT,this.join=oi.MITER,this.miterLimit=10}clone(){const t=new mc;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const YD=new Float32Array(3),Xh={},ha=class extends Ue{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Ga,this._lineStyle=new mc,this._matrix=null,this._holeMode=!1,this.state=Yr.for2d(),this._geometry=e||new xv,this._geometry.refCount++,this._transformID=-1,this.tint=16777215,this.blendMode=ut.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new ha(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tint}set tint(e){this._tint=e}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,r=1,i=.5,n=!1){return typeof e=="number"&&(e={width:e,color:t,alpha:r,alignment:i,native:n}),this.lineTextureStyle(e)}lineTextureStyle(e){e=Object.assign({width:0,texture:it.WHITE,color:e!=null&&e.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:Ni.BUTT,join:oi.MITER,miterLimit:10},e),this.currentPath&&this.startPoly();const t=e.width>0&&e.alpha>0;return t?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:t},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new Cn,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new Cn,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const r=this.currentPath.points,i=r[r.length-2],n=r[r.length-1];return(i!==e||n!==t)&&r.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,r,i){this._initCurve();const n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),gc.curveTo(e,t,r,i,n),this}bezierCurveTo(e,t,r,i,n,o){return this._initCurve(),pc.curveTo(e,t,r,i,n,o,this.currentPath.points),this}arcTo(e,t,r,i,n){this._initCurve(e,t);const o=this.currentPath.points,l=yg.curveTo(e,t,r,i,n,o);if(l){const{cx:h,cy:u,radius:f,startAngle:d,endAngle:g,anticlockwise:m}=l;this.arc(h,u,f,d,g,m)}return this}arc(e,t,r,i,n,o=!1){if(i===n)return this;if(!o&&n<=i?n+=xa:o&&i<=n&&(i+=xa),n-i===0)return this;const h=e+Math.cos(i)*r,u=t+Math.sin(i)*r,f=this._geometry.closePointEps;let d=this.currentPath?this.currentPath.points:null;if(d){const g=Math.abs(d[d.length-2]-h),m=Math.abs(d[d.length-1]-u);g<f&&m<f||d.push(h,u)}else this.moveTo(h,u),d=this.currentPath.points;return yg.arc(h,u,e,t,r,i,n,o,d),this}beginFill(e=0,t=1){return this.beginTextureFill({texture:it.WHITE,color:e,alpha:t})}beginTextureFill(e){e=Object.assign({texture:it.WHITE,color:16777215,alpha:1,matrix:null},e),this.currentPath&&this.startPoly();const t=e.alpha>0;return t?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:t},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,r,i){return this.drawShape(new Et(e,t,r,i))}drawRoundedRect(e,t,r,i,n){return this.drawShape(new uc(e,t,r,i,n))}drawCircle(e,t,r){return this.drawShape(new lc(e,t,r))}drawEllipse(e,t,r,i){return this.drawShape(new hc(e,t,r,i))}drawPolygon(...e){let t,r=!0;const i=e[0];i.points?(r=i.closeStroke,t=i.points):Array.isArray(e[0])?t=e[0]:t=e;const n=new Cn(t);return n.closeStroke=r,this.drawShape(n),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return e.length===1&&e[0].shape.type===ge.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,r=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(e.points);for(let i=0;i<r;i++){const n=e.batches[i],o=n.style.color,l=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),h=new Float32Array(e.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),u=new Uint16Array(e.indicesUint16.buffer,n.start*2,n.size),f={vertexData:l,blendMode:t,indices:u,uvs:h,_batchRGB:Cs(o),_tintRGB:o,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[i]=f}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,r=this.batches.length;t<r;t++){const i=this.batches[t];i.worldAlpha=this.worldAlpha*i.alpha,e.plugins[this.pluginName].render(i)}}}_renderDirect(e){const t=this._resolveDirectShader(e),r=this._geometry,i=this.tint,n=this.worldAlpha,o=t.uniforms,l=r.drawCalls;o.translationMatrix=this.transform.worldTransform,o.tint[0]=(i>>16&255)/255*n,o.tint[1]=(i>>8&255)/255*n,o.tint[2]=(i&255)/255*n,o.tint[3]=n,e.shader.bind(t),e.geometry.bind(r,t),e.state.set(this.state);for(let h=0,u=l.length;h<u;h++)this._renderDrawCallDirect(e,r.drawCalls[h])}_renderDrawCallDirect(e,t){const{texArray:r,type:i,size:n,start:o}=t,l=r.count;for(let h=0;h<l;h++)e.texture.bind(r.elements[h],h);e.geometry.draw(i,n,o)}_resolveDirectShader(e){let t=this.shader;const r=this.pluginName;if(!t){if(!Xh[r]){const{maxTextures:i}=e.plugins[r],n=new Int32Array(i);for(let h=0;h<i;h++)n[h]=h;const o={tint:new Float32Array([1,1,1,1]),translationMatrix:new $t,default:pr.from({uSamplers:n},!0)},l=e.plugins[r]._shader.program;Xh[r]=new Rr(l,o)}t=Xh[r]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:r,maxX:i,maxY:n}=e.bounds;this._bounds.addFrame(this.transform,t,r,i,n)}containsPoint(e){return this.worldTransform.applyInverse(e,ha._TEMP_POINT),this._geometry.containsPoint(ha._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;const e=Cs(this.tint,YD);for(let t=0;t<this.batches.length;t++){const r=this.batches[t],i=r._batchRGB,n=e[0]*i[0]*255,o=e[1]*i[1]*255,l=e[2]*i[2]*255,h=(n<<16)+(o<<8)+(l|0);r._tintRGB=(h>>16)+(h&65280)+((h&255)<<16)}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,r=t.a,i=t.b,n=t.c,o=t.d,l=t.tx,h=t.ty,u=this._geometry.points,f=this.vertexData;let d=0;for(let g=0;g<u.length;g+=2){const m=u[g],v=u[g+1];f[d++]=r*m+n*v+l,f[d++]=o*v+i*m+h}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};let Wa=ha;Wa.curves=Bn;Wa._TEMP_POINT=new At;class qD{constructor(t,r){this.uvBuffer=t,this.uvMatrix=r,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const r=this.uvBuffer.data;(!this.data||this.data.length!==r.length)&&(this.data=new Float32Array(r.length)),this.uvMatrix.multiplyUvs(r,this.data),this._updateID++}}const zh=new At,Eg=new Cn,bv=class extends Ue{constructor(e,t,r,i=Ir.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=r||Yr.for2d(),this.drawMode=i,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=J.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(e){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Ir.TRIANGLES&&t.length<bv.BATCHABLE_SIZE*2?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;const i=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[i]),e.plugins[i].render(this)}calculateVertices(){const t=this.geometry.buffers[0],r=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==r.length&&(this.vertexData=new Float32Array(r.length));const n=this.transform.worldTransform,o=n.a,l=n.b,h=n.c,u=n.d,f=n.tx,d=n.ty,g=this.vertexData;for(let m=0;m<g.length/2;m++){const v=r[m*2],y=r[m*2+1];g[m*2]=o*v+h*y+f,g[m*2+1]=l*v+u*y+d}if(this._roundPixels){const m=J.RESOLUTION;for(let v=0;v<g.length;++v)g[v]=Math.round(g[v]*m)/m}this.vertexDirty=i}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new qD(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,zh);const t=this.geometry.getBuffer("aVertexPosition").data,r=Eg.points,i=this.geometry.getIndex().data,n=i.length,o=this.drawMode===4?3:1;for(let l=0;l+2<n;l+=o){const h=i[l]*2,u=i[l+1]*2,f=i[l+2]*2;if(r[0]=t[h],r[1]=t[h+1],r[2]=t[u],r[3]=t[u+1],r[4]=t[f],r[5]=t[f+1],Eg.contains(zh.x,zh.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let Uu=bv;Uu.BATCHABLE_SIZE=100;class KD extends di{constructor(t,r,i){super();const n=new ee(t),o=new ee(r,!0),l=new ee(i,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,st.FLOAT).addAttribute("aTextureCoord",o,2,!1,st.FLOAT).addIndex(l),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var ZD=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,JD=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class Tg extends Rr{constructor(t,r){const i={uSampler:t,alpha:1,uTextureMatrix:$t.IDENTITY,uColor:new Float32Array([1,1,1,1])};r=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},r),r.uniforms&&Object.assign(i,r.uniforms),super(r.program||cr.from(JD,ZD),i),this._colorDirty=!1,this.uvMatrix=new Wm(t),this.batchable=r.program===void 0,this.pluginName=r.pluginName,this.tint=r.tint,this.alpha=r.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16),this._colorDirty=!0)}get tint(){return this._tint}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture;ym(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Ag{constructor(t,r,i){this.geometry=new di,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<t.length;++n){let o=t[n];o={attributeName:o.attributeName,size:o.size,uploadFunction:o.uploadFunction,type:o.type||st.FLOAT,offset:o.offset},r[n]?this.dynamicProperties.push(o):this.staticProperties.push(o)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let r=0;this.indexBuffer=new ee(HP(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let l=0;l<this.dynamicProperties.length;++l){const h=this.dynamicProperties[l];h.offset=r,r+=h.size,this.dynamicStride+=h.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new ee(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let l=0;l<this.staticProperties.length;++l){const h=this.staticProperties[l];h.offset=n,n+=h.size,this.staticStride+=h.size}const o=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(o),this.staticDataUint32=new Uint32Array(o),this.staticBuffer=new ee(this.staticData,!0,!1);for(let l=0;l<this.dynamicProperties.length;++l){const h=this.dynamicProperties[l];t.addAttribute(h.attributeName,this.dynamicBuffer,0,h.type===st.UNSIGNED_BYTE,h.type,this.dynamicStride*4,h.offset*4)}for(let l=0;l<this.staticProperties.length;++l){const h=this.staticProperties[l];t.addAttribute(h.attributeName,this.staticBuffer,0,h.type===st.UNSIGNED_BYTE,h.type,this.staticStride*4,h.offset*4)}}uploadDynamic(t,r,i){for(let n=0;n<this.dynamicProperties.length;n++){const o=this.dynamicProperties[n];o.uploadFunction(t,r,i,o.type===st.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,o.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,r,i){for(let n=0;n<this.staticProperties.length;n++){const o=this.staticProperties[n];o.uploadFunction(t,r,i,o.type===st.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,o.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var QD=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,tB=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class wv extends Na{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new $t,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:st.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Rr.from(tB,QD,{}),this.state=Yr.for2d()}render(t){const r=t.children,i=t._maxSize,n=t._batchSize,o=this.renderer;let l=r.length;if(l===0)return;l>i&&!t.autoResize&&(l=i);let h=t._buffers;h||(h=t._buffers=this.generateBuffers(t));const u=r[0]._texture.baseTexture,f=u.alphaMode>0;this.state.blendMode=_m(t.blendMode,f),o.state.set(this.state);const d=o.gl,g=t.worldTransform.copyTo(this.tempMatrix);g.prepend(o.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=g.toArray(!0),this.shader.uniforms.uColor=$P(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,f),this.shader.uniforms.uSampler=u,this.renderer.shader.bind(this.shader);let m=!1;for(let v=0,y=0;v<l;v+=n,y+=1){let w=l-v;w>n&&(w=n),y>=h.length&&h.push(this._generateOneMoreBuffer(t));const x=h[y];x.uploadDynamic(r,v,w);const A=t._bufferUpdateIDs[y]||0;m=m||x._updateID<A,m&&(x._updateID=t._updateID,x.uploadStatic(r,v,w)),o.geometry.bind(x.geometry),d.drawElements(d.TRIANGLES,w*6,d.UNSIGNED_SHORT,0)}}generateBuffers(t){const r=[],i=t._maxSize,n=t._batchSize,o=t._properties;for(let l=0;l<i;l+=n)r.push(new Ag(this.properties,o,n));return r}_generateOneMoreBuffer(t){const r=t._batchSize,i=t._properties;return new Ag(this.properties,i,r)}uploadVertices(t,r,i,n,o,l){let h=0,u=0,f=0,d=0;for(let g=0;g<i;++g){const m=t[r+g],v=m._texture,y=m.scale.x,w=m.scale.y,x=v.trim,A=v.orig;x?(u=x.x-m.anchor.x*A.width,h=u+x.width,d=x.y-m.anchor.y*A.height,f=d+x.height):(h=A.width*(1-m.anchor.x),u=A.width*-m.anchor.x,f=A.height*(1-m.anchor.y),d=A.height*-m.anchor.y),n[l]=u*y,n[l+1]=d*w,n[l+o]=h*y,n[l+o+1]=d*w,n[l+o*2]=h*y,n[l+o*2+1]=f*w,n[l+o*3]=u*y,n[l+o*3+1]=f*w,l+=o*4}}uploadPosition(t,r,i,n,o,l){for(let h=0;h<i;h++){const u=t[r+h].position;n[l]=u.x,n[l+1]=u.y,n[l+o]=u.x,n[l+o+1]=u.y,n[l+o*2]=u.x,n[l+o*2+1]=u.y,n[l+o*3]=u.x,n[l+o*3+1]=u.y,l+=o*4}}uploadRotation(t,r,i,n,o,l){for(let h=0;h<i;h++){const u=t[r+h].rotation;n[l]=u,n[l+o]=u,n[l+o*2]=u,n[l+o*3]=u,l+=o*4}}uploadUvs(t,r,i,n,o,l){for(let h=0;h<i;++h){const u=t[r+h]._texture._uvs;u?(n[l]=u.x0,n[l+1]=u.y0,n[l+o]=u.x1,n[l+o+1]=u.y1,n[l+o*2]=u.x2,n[l+o*2+1]=u.y2,n[l+o*3]=u.x3,n[l+o*3+1]=u.y3,l+=o*4):(n[l]=0,n[l+1]=0,n[l+o]=0,n[l+o+1]=0,n[l+o*2]=0,n[l+o*2+1]=0,n[l+o*3]=0,n[l+o*3+1]=0,l+=o*4)}}uploadTint(t,r,i,n,o,l){for(let h=0;h<i;++h){const u=t[r+h],f=u._texture.baseTexture.alphaMode>0,d=u.alpha,g=d<1&&f?ac(u._tintRGB,d):u._tintRGB+(d*255<<24);n[l]=g,n[l+o]=g,n[l+o*2]=g,n[l+o*3]=g,l+=o*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}wv.extension={name:"particle",type:Z.RendererPlugin};nt.add(wv);var $a=(e=>(e[e.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",e[e.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",e))($a||{});const qo={willReadFrequently:!0},et=class{static get experimentalLetterSpacingSupported(){let e=et._experimentalLetterSpacingSupported;if(e!==void 0){const t=J.ADAPTER.getCanvasRenderingContext2D().prototype;e=et._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,r,i,n,o,l,h,u){this.text=e,this.style=t,this.width=r,this.height=i,this.lines=n,this.lineWidths=o,this.lineHeight=l,this.maxLineWidth=h,this.fontProperties=u}static measureText(e,t,r,i=et._canvas){r=r??t.wordWrap;const n=t.toFontString(),o=et.measureFont(n);o.fontSize===0&&(o.fontSize=t.fontSize,o.ascent=t.fontSize);const l=i.getContext("2d",qo);l.font=n;const u=(r?et.wordWrap(e,t,i):e).split(/(?:\r\n|\r|\n)/),f=new Array(u.length);let d=0;for(let y=0;y<u.length;y++){const w=et._measureText(u[y],t.letterSpacing,l);f[y]=w,d=Math.max(d,w)}let g=d+t.strokeThickness;t.dropShadow&&(g+=t.dropShadowDistance);const m=t.lineHeight||o.fontSize+t.strokeThickness;let v=Math.max(m,o.fontSize+t.strokeThickness*2)+(u.length-1)*(m+t.leading);return t.dropShadow&&(v+=t.dropShadowDistance),new et(e,t,g,v,u,f,m+t.leading,d,o)}static _measureText(e,t,r){let i=!1;et.experimentalLetterSpacingSupported&&(et.experimentalLetterSpacing?(r.letterSpacing=`${t}px`,r.textLetterSpacing=`${t}px`,i=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let n=r.measureText(e).width;return n>0&&(i?n-=t:n+=(et.graphemeSegmenter(e).length-1)*t),n}static wordWrap(e,t,r=et._canvas){const i=r.getContext("2d",qo);let n=0,o="",l="";const h=Object.create(null),{letterSpacing:u,whiteSpace:f}=t,d=et.collapseSpaces(f),g=et.collapseNewlines(f);let m=!d;const v=t.wordWrapWidth+u,y=et.tokenize(e);for(let w=0;w<y.length;w++){let x=y[w];if(et.isNewline(x)){if(!g){l+=et.addLine(o),m=!d,o="",n=0;continue}x=" "}if(d){const S=et.isBreakingSpace(x),E=et.isBreakingSpace(o[o.length-1]);if(S&&E)continue}const A=et.getFromCache(x,u,h,i);if(A>v)if(o!==""&&(l+=et.addLine(o),o="",n=0),et.canBreakWords(x,t.breakWords)){const S=et.wordWrapSplit(x);for(let E=0;E<S.length;E++){let I=S[E],D=I,L=1;for(;S[E+L];){const F=S[E+L];if(!et.canBreakChars(D,F,x,E,t.breakWords))I+=F;else break;D=F,L++}E+=L-1;const O=et.getFromCache(I,u,h,i);O+n>v&&(l+=et.addLine(o),m=!1,o="",n=0),o+=I,n+=O}}else{o.length>0&&(l+=et.addLine(o),o="",n=0);const S=w===y.length-1;l+=et.addLine(x,!S),m=!1,o="",n=0}else A+n>v&&(m=!1,l+=et.addLine(o),o="",n=0),(o.length>0||!et.isBreakingSpace(x)||m)&&(o+=x,n+=A)}return l+=et.addLine(o,!1),l}static addLine(e,t=!0){return e=et.trimRight(e),e=t?`${e}
`:e,e}static getFromCache(e,t,r,i){let n=r[e];return typeof n!="number"&&(n=et._measureText(e,t,i)+t,r[e]=n),n}static collapseSpaces(e){return e==="normal"||e==="pre-line"}static collapseNewlines(e){return e==="normal"}static trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){const r=e[t];if(!et.isBreakingSpace(r))break;e=e.slice(0,-1)}return e}static isNewline(e){return typeof e!="string"?!1:et._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return typeof e!="string"?!1:et._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const t=[];let r="";if(typeof e!="string")return t;for(let i=0;i<e.length;i++){const n=e[i],o=e[i+1];if(et.isBreakingSpace(n,o)||et.isNewline(n)){r!==""&&(t.push(r),r=""),t.push(n);continue}r+=n}return r!==""&&t.push(r),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,r,i,n){return!0}static wordWrapSplit(e){return et.graphemeSegmenter(e)}static measureFont(e){if(et._fonts[e])return et._fonts[e];const t={ascent:0,descent:0,fontSize:0},r=et._canvas,i=et._context;i.font=e;const n=et.METRICS_STRING+et.BASELINE_SYMBOL,o=Math.ceil(i.measureText(n).width);let l=Math.ceil(i.measureText(et.BASELINE_SYMBOL).width);const h=Math.ceil(et.HEIGHT_MULTIPLIER*l);if(l=l*et.BASELINE_MULTIPLIER|0,o===0||h===0)return et._fonts[e]=t,t;r.width=o,r.height=h,i.fillStyle="#f00",i.fillRect(0,0,o,h),i.font=e,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(n,0,l);const u=i.getImageData(0,0,o,h).data,f=u.length,d=o*4;let g=0,m=0,v=!1;for(g=0;g<l;++g){for(let y=0;y<d;y+=4)if(u[m+y]!==255){v=!0;break}if(!v)m+=d;else break}for(t.ascent=l-g,m=f-d,v=!1,g=h;g>l;--g){for(let y=0;y<d;y+=4)if(u[m+y]!==255){v=!0;break}if(!v)m-=d;else break}return t.descent=g-l,t.fontSize=t.ascent+t.descent,et._fonts[e]=t,t}static clearMetrics(e=""){e?delete et._fonts[e]:et._fonts={}}static get _canvas(){if(!et.__canvas){let e;try{const t=new OffscreenCanvas(0,0),r=t.getContext("2d",qo);if(r!=null&&r.measureText)return et.__canvas=t,t;e=J.ADAPTER.createCanvas()}catch{e=J.ADAPTER.createCanvas()}e.width=e.height=10,et.__canvas=e}return et.__canvas}static get _context(){return et.__context||(et.__context=et._canvas.getContext("2d",qo)),et.__context}};let pe=et;pe.METRICS_STRING="|ÉqÅ";pe.BASELINE_SYMBOL="M";pe.BASELINE_MULTIPLIER=1.4;pe.HEIGHT_MULTIPLIER=2;pe.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const e=new Intl.Segmenter;return t=>[...e.segment(t)].map(r=>r.segment)}return e=>[...e]})();pe.experimentalLetterSpacing=!1;pe._fonts={};pe._newlines=[10,13];pe._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const eB=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],vs=class{constructor(e){this.styleID=0,this.reset(),jh(this,e,e)}clone(){const e={};return jh(e,this,vs.defaultStyle),new vs(e)}reset(){jh(this,vs.defaultStyle,vs.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=Vh(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=Vh(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){rB(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=Vh(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let r=t.length-1;r>=0;r--){let i=t[r].trim();!/([\"\'])[^\'\"]+\1/.test(i)&&!eB.includes(i)&&(i=`"${i}"`),t[r]=i}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};let Xi=vs;Xi.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:$a.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};function Sg(e){return typeof e=="number"?mm(e):(typeof e=="string"&&e.startsWith("0x")&&(e=e.replace("0x","#")),e)}function Vh(e){if(Array.isArray(e)){for(let t=0;t<e.length;++t)e[t]=Sg(e[t]);return e}else return Sg(e)}function rB(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}function jh(e,t,r){for(const i in r)Array.isArray(t[i])?e[i]=t[i].slice():e[i]=t[i]}const iB={texture:!0,children:!1,baseTexture:!0},Gu=class extends Wn{constructor(e,t,r){let i=!1;r||(r=J.ADAPTER.createCanvas(),i=!0),r.width=3,r.height=3;const n=it.from(r);n.orig=new Et,n.trim=new Et,super(n),this._ownCanvas=i,this.canvas=r,this.context=r.getContext("2d",{willReadFrequently:!0}),this._resolution=Gu.defaultResolution??J.RESOLUTION,this._autoResolution=Gu.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return pe.experimentalLetterSpacing}static set experimentalLetterSpacing(e){Ct("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),pe.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const r=this.context,i=pe.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=i.width,o=i.height,l=i.lines,h=i.lineHeight,u=i.lineWidths,f=i.maxLineWidth,d=i.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+t.padding*2)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=t.strokeThickness,r.textBaseline=t.textBaseline,r.lineJoin=t.lineJoin,r.miterLimit=t.miterLimit;let g,m;const v=t.dropShadow?2:1;for(let y=0;y<v;++y){const w=t.dropShadow&&y===0,x=w?Math.ceil(Math.max(1,o)+t.padding*2):0,A=x*this._resolution;if(w){r.fillStyle="black",r.strokeStyle="black";const E=t.dropShadowColor,I=Cs(typeof E=="number"?E:oc(E)),D=t.dropShadowBlur*this._resolution,L=t.dropShadowDistance*this._resolution;r.shadowColor=`rgba(${I[0]*255},${I[1]*255},${I[2]*255},${t.dropShadowAlpha})`,r.shadowBlur=D,r.shadowOffsetX=Math.cos(t.dropShadowAngle)*L,r.shadowOffsetY=Math.sin(t.dropShadowAngle)*L+A}else r.fillStyle=this._generateFillStyle(t,l,i),r.strokeStyle=t.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;let S=(h-d.fontSize)/2;h-d.fontSize<0&&(S=0);for(let E=0;E<l.length;E++)g=t.strokeThickness/2,m=t.strokeThickness/2+E*h+d.ascent+S,t.align==="right"?g+=f-u[E]:t.align==="center"&&(g+=(f-u[E])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(l[E],g+t.padding,m+t.padding-x,!0),t.fill&&this.drawLetterSpacing(l[E],g+t.padding,m+t.padding-x)}this.updateTexture()}drawLetterSpacing(e,t,r,i=!1){const o=this._style.letterSpacing;let l=!1;if(pe.experimentalLetterSpacingSupported&&(pe.experimentalLetterSpacing?(this.context.letterSpacing=`${o}px`,this.context.textLetterSpacing=`${o}px`,l=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),o===0||l){i?this.context.strokeText(e,t,r):this.context.fillText(e,t,r);return}let h=t;const u=pe.graphemeSegmenter(e);let f=this.context.measureText(e).width,d=0;for(let g=0;g<u.length;++g){const m=u[g];i?this.context.strokeText(m,h,r):this.context.fillText(m,h,r);let v="";for(let y=g+1;y<u.length;++y)v+=u[y];d=this.context.measureText(v).width,h+=f-d+o,f=d}}updateTexture(){const e=this.canvas;if(this._style.trim){const o=VP(e);o.data&&(e.width=o.width,e.height=o.height,this.context.putImageData(o.data,0,0))}const t=this._texture,r=this._style,i=r.trim?0:r.padding,n=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-i,t.trim.y=-i,t.orig.width=t._frame.width-i*2,t.orig.height=t._frame.height-i*2,this._onTextureUpdate(),n.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),this._textureID===-1&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,r){const i=e.fill;if(Array.isArray(i)){if(i.length===1)return i[0]}else return i;let n;const o=e.dropShadow?e.dropShadowDistance:0,l=e.padding||0,h=this.canvas.width/this._resolution-o-l*2,u=this.canvas.height/this._resolution-o-l*2,f=i.slice(),d=e.fillGradientStops.slice();if(!d.length){const g=f.length+1;for(let m=1;m<g;++m)d.push(m/g)}if(f.unshift(i[0]),d.unshift(0),f.push(i[i.length-1]),d.push(1),e.fillGradientType===$a.LINEAR_VERTICAL){n=this.context.createLinearGradient(h/2,l,h/2,u+l);const g=r.fontProperties.fontSize+e.strokeThickness;for(let m=0;m<t.length;m++){const v=r.lineHeight*(m-1)+g,y=r.lineHeight*m;let w=y;m>0&&v>y&&(w=(y+v)/2);const x=y+g,A=r.lineHeight*(m+1);let S=x;m+1<t.length&&A<x&&(S=(x+A)/2);const E=(S-w)/u;for(let I=0;I<f.length;I++){let D=0;typeof d[I]=="number"?D=d[I]:D=I/f.length;let L=Math.min(1,Math.max(0,w/u+D*E));L=Number(L.toFixed(5)),n.addColorStop(L,f[I])}}}else{n=this.context.createLinearGradient(l,u/2,h+l,u/2);const g=f.length+1;let m=1;for(let v=0;v<f.length;v++){let y;typeof d[v]=="number"?y=d[v]:y=m/g,n.addColorStop(y,f[v]),m++}}return n}destroy(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},iB,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=yn(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=yn(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},e instanceof Xi?this._style=e:this._style=new Xi(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};let vc=Gu;vc.defaultAutoResolution=!0;class nB{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function sB(e,t){var i;let r=!1;if((i=e==null?void 0:e._textures)!=null&&i.length){for(let n=0;n<e._textures.length;n++)if(e._textures[n]instanceof it){const o=e._textures[n].baseTexture;t.includes(o)||(t.push(o),r=!0)}}return r}function oB(e,t){if(e.baseTexture instanceof pt){const r=e.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function aB(e,t){if(e._texture&&e._texture instanceof it){const r=e._texture.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function lB(e,t){return t instanceof vc?(t.updateText(!0),!0):!1}function hB(e,t){if(t instanceof Xi){const r=t.toFontString();return pe.measureFont(r),!0}return!1}function uB(e,t){if(e instanceof vc){t.includes(e.style)||t.push(e.style),t.includes(e)||t.push(e);const r=e._texture.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function cB(e,t){return e instanceof Xi?(t.includes(e)||t.push(e),!0):!1}const Ev=class{constructor(e){this.limiter=new nB(Ev.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(uB),this.registerFindHook(cB),this.registerFindHook(sB),this.registerFindHook(oB),this.registerFindHook(aB),this.registerUploadHook(lB),this.registerUploadHook(hB)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,Re.system.addOnce(this.tick,this,Dn.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed){for(let r=0,i=this.uploadHooks.length;r<i;r++)if(this.uploadHooks[r](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)Re.system.addOnce(this.tick,this,Dn.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,r=e.length;t<r;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,r=this.addHooks.length;t<r&&!this.addHooks[t](e,this.queue);t++);if(e instanceof Ue)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&Re.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let Ca=Ev;Ca.uploadsPerFrame=4;Object.defineProperties(J,{UPLOADS_PER_FRAME:{get(){return Ca.uploadsPerFrame},set(e){Ct("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Ca.uploadsPerFrame=e}}});function Tv(e,t){return t instanceof pt?(t._glTextures[e.CONTEXT_UID]||e.texture.bind(t),!0):!1}function fB(e,t){if(!(t instanceof Wa))return!1;const{geometry:r}=t;t.finishPoly(),r.updateBatches();const{batches:i}=r;for(let n=0;n<i.length;n++){const{texture:o}=i[n].style;o&&Tv(e,o.baseTexture)}return r.batchable||e.geometry.bind(r,t._resolveDirectShader(e)),!0}function dB(e,t){return e instanceof Wa?(t.push(e),!0):!1}class Av extends Ca{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(dB),this.registerUploadHook(Tv),this.registerUploadHook(fB)}}Av.extension={name:"prepare",type:Z.RendererSystem};nt.add(Av);var pB=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,gB=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,mB=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,Cg=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,vB=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const Ko=new $t;class Sv extends Na{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Nm,this.state=Yr.for2d()}contextChange(){const t=this.renderer,r={globals:t.globalUniforms};this.simpleShader=Rr.from(Cg,vB,r),this.shader=t.context.webGLVersion>1?Rr.from(gB,pB,r):Rr.from(Cg,mB,r)}render(t){const r=this.renderer,i=this.quad;let n=i.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const o=t.uvRespectAnchor?t.anchor.x:0,l=t.uvRespectAnchor?t.anchor.y:0;n=i.uvs,n[0]=n[6]=-o,n[1]=n[3]=-l,n[2]=n[4]=1-o,n[5]=n[7]=1-l,i.invalidate();const h=t._texture,u=h.baseTexture,f=u.alphaMode>0,d=t.tileTransform.localTransform,g=t.uvMatrix;let m=u.isPowerOfTwo&&h.frame.width===u.width&&h.frame.height===u.height;m&&(u._glTextures[r.CONTEXT_UID]?m=u.wrapMode!==ui.CLAMP:u.wrapMode===ui.CLAMP&&(u.wrapMode=ui.REPEAT));const v=m?this.simpleShader:this.shader,y=h.width,w=h.height,x=t._width,A=t._height;Ko.set(d.a*y/x,d.b*y/A,d.c*w/x,d.d*w/A,d.tx/x,d.ty/A),Ko.invert(),m?Ko.prepend(g.mapCoord):(v.uniforms.uMapCoord=g.mapCoord.toArray(!0),v.uniforms.uClampFrame=g.uClampFrame,v.uniforms.uClampOffset=g.uClampOffset),v.uniforms.uTransform=Ko.toArray(!0),v.uniforms.uColor=ym(t.tint,t.worldAlpha,v.uniforms.uColor,f),v.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),v.uniforms.uSampler=h,r.shader.bind(v),r.geometry.bind(i),this.state.blendMode=_m(t.blendMode,f),r.state.set(this.state),r.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Sv.extension={name:"tilingSprite",type:Z.RendererPlugin};nt.add(Sv);const _s=class{constructor(e,t,r=null){this.linkedSheets=[],this._texture=e instanceof it?e:null,this.baseTexture=e instanceof pt?e:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;const i=this.baseTexture.resource;this.resolution=this._updateResolution(r||(i?i.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:t}=this.data.meta;let r=fi(e,null);return r===null&&(r=parseFloat(t??"1")),r!==1&&this.baseTexture.setResolution(r),r}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=_s.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e;const r=_s.BATCH_SIZE;for(;t-e<r&&t<this._frameKeys.length;){const i=this._frameKeys[t],n=this._frames[i],o=n.frame;if(o){let l=null,h=null;const u=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,f=new Et(0,0,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution);n.rotated?l=new Et(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):l=new Et(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(h=new Et(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[i]=new it(this.baseTexture,l,f,h,n.rotated?2:0,n.anchor),it.addToCache(this.textures[i],i)}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let r=0;r<e[t].length;r++){const i=e[t][r];this.animations[t].push(this.textures[i])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*_s.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*_s.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){var t;for(const r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let Wu=_s;Wu.BATCH_SIZE=1e3;const _B=["jpg","png","jpeg","avif","webp"];function Cv(e,t,r){const i={};if(e.forEach(n=>{i[n]=t}),Object.keys(t.textures).forEach(n=>{i[n]=t.textures[n]}),!r){const n=me.dirname(e[0]);t.linkedSheets.forEach((o,l)=>{const h=Cv([`${n}/${t.data.meta.related_multi_packs[l]}`],o,!0);Object.assign(i,h)})}return i}const yB={extension:Z.Asset,cache:{test:e=>e instanceof Wu,getCacheableAssets:(e,t)=>Cv(e,t,!1)},resolver:{test:e=>{const r=e.split("?")[0].split("."),i=r.pop(),n=r.pop();return i==="json"&&_B.includes(n)},parse:e=>{var r;const t=e.split(".");return{resolution:parseFloat(((r=J.RETINA_PREFIX.exec(e))==null?void 0:r[1])??"1"),format:t[t.length-2],src:e}}},loader:{extension:{type:Z.LoadParser,priority:Dr.Normal},async testParse(e,t){return me.extname(t.src).toLowerCase()===".json"&&!!e.frames},async parse(e,t,r){var f,d;let i=me.dirname(t.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");const n=i+e.meta.image,l=(await r.load([n]))[n],h=new Wu(l.baseTexture,e,t.src);await h.parse();const u=(f=e==null?void 0:e.meta)==null?void 0:f.related_multi_packs;if(Array.isArray(u)){const g=[];for(const v of u){if(typeof v!="string")continue;const y=i+v;(d=t.data)!=null&&d.ignoreMultiPack||g.push(r.load({src:y,data:{ignoreMultiPack:!0}}))}const m=await Promise.all(g);h.linkedSheets=m,m.forEach(v=>{v.linkedSheets=[h].concat(h.linkedSheets.filter(y=>y!==v))})}return h},unload(e){e.destroy(!0)}}};nt.add(yB);class Ia{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class ua{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const r=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const o in r){const l=r[o].match(/^[a-z]+/gm)[0],h=r[o].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),u={};for(const f in h){const d=h[f].split("="),g=d[0],m=d[1].replace(/"/gm,""),v=parseFloat(m),y=isNaN(v)?m:v;u[g]=y}i[l].push(u)}const n=new Ia;return i.info.forEach(o=>n.info.push({face:o.face,size:parseInt(o.size,10)})),i.common.forEach(o=>n.common.push({lineHeight:parseInt(o.lineHeight,10)})),i.page.forEach(o=>n.page.push({id:parseInt(o.id,10),file:o.file})),i.char.forEach(o=>n.char.push({id:parseInt(o.id,10),page:parseInt(o.page,10),x:parseInt(o.x,10),y:parseInt(o.y,10),width:parseInt(o.width,10),height:parseInt(o.height,10),xoffset:parseInt(o.xoffset,10),yoffset:parseInt(o.yoffset,10),xadvance:parseInt(o.xadvance,10)})),i.kerning.forEach(o=>n.kerning.push({first:parseInt(o.first,10),second:parseInt(o.second,10),amount:parseInt(o.amount,10)})),i.distanceField.forEach(o=>n.distanceField.push({distanceRange:parseInt(o.distanceRange,10),fieldType:o.fieldType})),n}}class $u{static test(t){const r=t;return"getElementsByTagName"in r&&r.getElementsByTagName("page").length&&r.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const r=new Ia,i=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),o=t.getElementsByTagName("page"),l=t.getElementsByTagName("char"),h=t.getElementsByTagName("kerning"),u=t.getElementsByTagName("distanceField");for(let f=0;f<i.length;f++)r.info.push({face:i[f].getAttribute("face"),size:parseInt(i[f].getAttribute("size"),10)});for(let f=0;f<n.length;f++)r.common.push({lineHeight:parseInt(n[f].getAttribute("lineHeight"),10)});for(let f=0;f<o.length;f++)r.page.push({id:parseInt(o[f].getAttribute("id"),10)||0,file:o[f].getAttribute("file")});for(let f=0;f<l.length;f++){const d=l[f];r.char.push({id:parseInt(d.getAttribute("id"),10),page:parseInt(d.getAttribute("page"),10)||0,x:parseInt(d.getAttribute("x"),10),y:parseInt(d.getAttribute("y"),10),width:parseInt(d.getAttribute("width"),10),height:parseInt(d.getAttribute("height"),10),xoffset:parseInt(d.getAttribute("xoffset"),10),yoffset:parseInt(d.getAttribute("yoffset"),10),xadvance:parseInt(d.getAttribute("xadvance"),10)})}for(let f=0;f<h.length;f++)r.kerning.push({first:parseInt(h[f].getAttribute("first"),10),second:parseInt(h[f].getAttribute("second"),10),amount:parseInt(h[f].getAttribute("amount"),10)});for(let f=0;f<u.length;f++)r.distanceField.push({fieldType:u[f].getAttribute("fieldType"),distanceRange:parseInt(u[f].getAttribute("distanceRange"),10)});return r}}class Hu{static test(t){return typeof t=="string"&&t.includes("<font>")?$u.test(J.ADAPTER.parseXML(t)):!1}static parse(t){return $u.parse(J.ADAPTER.parseXML(t))}}const Yh=[ua,$u,Hu];function xB(e){for(let t=0;t<Yh.length;t++)if(Yh[t].test(e))return Yh[t];return null}function bB(e,t,r,i,n,o){const l=r.fill;if(Array.isArray(l)){if(l.length===1)return l[0]}else return l;let h;const u=r.dropShadow?r.dropShadowDistance:0,f=r.padding||0,d=e.width/i-u-f*2,g=e.height/i-u-f*2,m=l.slice(),v=r.fillGradientStops.slice();if(!v.length){const y=m.length+1;for(let w=1;w<y;++w)v.push(w/y)}if(m.unshift(l[0]),v.unshift(0),m.push(l[l.length-1]),v.push(1),r.fillGradientType===$a.LINEAR_VERTICAL){h=t.createLinearGradient(d/2,f,d/2,g+f);let y=0;const x=(o.fontProperties.fontSize+r.strokeThickness)/g;for(let A=0;A<n.length;A++){const S=o.lineHeight*A;for(let E=0;E<m.length;E++){let I=0;typeof v[E]=="number"?I=v[E]:I=E/m.length;const D=S/g+I*x;let L=Math.max(y,D);L=Math.min(L,1),h.addColorStop(L,m[E]),y=L}}}else{h=t.createLinearGradient(f,g/2,d+f,g/2);const y=m.length+1;let w=1;for(let x=0;x<m.length;x++){let A;typeof v[x]=="number"?A=v[x]:A=w/y,h.addColorStop(A,m[x]),w++}}return h}function wB(e,t,r,i,n,o,l){const h=r.text,u=r.fontProperties;t.translate(i,n),t.scale(o,o);const f=l.strokeThickness/2,d=-(l.strokeThickness/2);if(t.font=l.toFontString(),t.lineWidth=l.strokeThickness,t.textBaseline=l.textBaseline,t.lineJoin=l.lineJoin,t.miterLimit=l.miterLimit,t.fillStyle=bB(e,t,l,o,[h],r),t.strokeStyle=l.stroke,l.dropShadow){const g=l.dropShadowColor,m=Cs(typeof g=="number"?g:oc(g)),v=l.dropShadowBlur*o,y=l.dropShadowDistance*o;t.shadowColor=`rgba(${m[0]*255},${m[1]*255},${m[2]*255},${l.dropShadowAlpha})`,t.shadowBlur=v,t.shadowOffsetX=Math.cos(l.dropShadowAngle)*y,t.shadowOffsetY=Math.sin(l.dropShadowAngle)*y}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;l.stroke&&l.strokeThickness&&t.strokeText(h,f,d+r.lineHeight-u.descent),l.fill&&t.fillText(h,f,d+r.lineHeight-u.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function ca(e){return e.codePointAt?e.codePointAt(0):e.charCodeAt(0)}function Iv(e){return Array.from?Array.from(e):e.split("")}function EB(e){typeof e=="string"&&(e=[e]);const t=[];for(let r=0,i=e.length;r<i;r++){const n=e[r];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const o=n[0].charCodeAt(0),l=n[1].charCodeAt(0);if(l<o)throw new Error("[BitmapFont]: Invalid character range.");for(let h=o,u=l;h<=u;h++)t.push(String.fromCharCode(h))}else t.push(...Iv(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const ar=class{constructor(e,t,r){var f;const[i]=e.info,[n]=e.common,[o]=e.page,[l]=e.distanceField,h=fi(o.file),u={};this._ownsTextures=r,this.font=i.face,this.size=i.size,this.lineHeight=n.lineHeight/h,this.chars={},this.pageTextures=u;for(let d=0;d<e.page.length;d++){const{id:g,file:m}=e.page[d];u[g]=t instanceof Array?t[d]:t[m],l!=null&&l.fieldType&&l.fieldType!=="none"&&(u[g].baseTexture.alphaMode=gr.NO_PREMULTIPLIED_ALPHA,u[g].baseTexture.mipmap=Mr.OFF)}for(let d=0;d<e.char.length;d++){const{id:g,page:m}=e.char[d];let{x:v,y,width:w,height:x,xoffset:A,yoffset:S,xadvance:E}=e.char[d];v/=h,y/=h,w/=h,x/=h,A/=h,S/=h,E/=h;const I=new Et(v+u[m].frame.x/h,y+u[m].frame.y/h,w,x);this.chars[g]={xOffset:A,yOffset:S,xAdvance:E,kerning:{},texture:new it(u[m].baseTexture,I),page:m}}for(let d=0;d<e.kerning.length;d++){let{first:g,second:m,amount:v}=e.kerning[d];g/=h,m/=h,v/=h,this.chars[m]&&(this.chars[m].kerning[g]=v)}this.distanceFieldRange=l==null?void 0:l.distanceRange,this.distanceFieldType=((f=l==null?void 0:l.fieldType)==null?void 0:f.toLowerCase())??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(e,t,r){let i;if(e instanceof Ia)i=e;else{const o=xB(e);if(!o)throw new Error("Unrecognized data format for font.");i=o.parse(e)}t instanceof it&&(t=[t]);const n=new ar(i,t,r);return ar.available[n.font]=n,n}static uninstall(e){const t=ar.available[e];if(!t)throw new Error(`No font found named '${e}'`);t.destroy(),delete ar.available[e]}static from(e,t,r){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:i,padding:n,resolution:o,textureWidth:l,textureHeight:h,...u}=Object.assign({},ar.defaultOptions,r),f=EB(i),d=t instanceof Xi?t:new Xi(t),g=l,m=new Ia;m.info[0]={face:d.fontFamily,size:d.fontSize},m.common[0]={lineHeight:d.fontSize};let v=0,y=0,w,x,A,S=0;const E=[];for(let D=0;D<f.length;D++){w||(w=J.ADAPTER.createCanvas(),w.width=l,w.height=h,x=w.getContext("2d"),A=new pt(w,{resolution:o,...u}),E.push(new it(A)),m.page.push({id:E.length-1,file:""}));const L=f[D],O=pe.measureText(L,d,!1,w),F=O.width,X=Math.ceil(O.height),Y=Math.ceil((d.fontStyle==="italic"?2:1)*F);if(y>=h-X*o){if(y===0)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${L}')`);--D,w=null,x=null,A=null,y=0,v=0,S=0;continue}if(S=Math.max(X+O.fontProperties.descent,S),Y*o+v>=g){if(v===0)throw new Error(`[BitmapFont] textureWidth ${l}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${L}')`);--D,y+=S*o,y=Math.ceil(y),v=0,S=0;continue}wB(w,x,O,v,y,o,d);const z=ca(O.text);m.char.push({id:z,page:E.length-1,x:v/o,y:y/o,width:Y,height:X,xoffset:0,yoffset:0,xadvance:Math.ceil(F-(d.dropShadow?d.dropShadowDistance:0)-(d.stroke?d.strokeThickness:0))}),v+=(Y+2*n)*o,v=Math.ceil(v)}for(let D=0,L=f.length;D<L;D++){const O=f[D];for(let F=0;F<L;F++){const X=f[F],Y=x.measureText(O).width,z=x.measureText(X).width,W=x.measureText(O+X).width-(Y+z);W&&m.kerning.push({first:ca(O),second:ca(X),amount:W})}}const I=new ar(m,E,!0);return ar.available[e]!==void 0&&ar.uninstall(e),ar.available[e]=I,I}};let Pe=ar;Pe.ALPHA=[["a","z"],["A","Z"]," "];Pe.NUMERIC=[["0","9"]];Pe.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];Pe.ASCII=[[" ","~"]];Pe.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:ar.ALPHANUMERIC};Pe.available={};var TB=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r
\r
}\r
`,AB=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const Ig=[],Pg=[],Rg=[],Pv=class extends Ue{constructor(e,t={}){super(),this._tint=16777215;const{align:r,tint:i,maxWidth:n,letterSpacing:o,fontName:l,fontSize:h}=Object.assign({},Pv.styleDefaults,t);if(!Pe.available[l])throw new Error(`Missing BitmapFont "${l}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=r,this._tint=i,this._font=void 0,this._fontName=l,this._fontSize=h,this.text=e,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new hi(()=>{this.dirty=!0},this,0,0),this._roundPixels=J.ROUND_PIXELS,this.dirty=!0,this._resolution=J.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var Y;const e=Pe.available[this._fontName],t=this.fontSize,r=t/e.size,i=new At,n=[],o=[],l=[],h=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",u=Iv(h),f=this._maxWidth*e.size/t,d=e.distanceFieldType==="none"?Ig:Pg;let g=null,m=0,v=0,y=0,w=-1,x=0,A=0,S=0,E=0;for(let z=0;z<u.length;z++){const K=u[z],W=ca(K);if(/(?:\s)/.test(K)&&(w=z,x=m,E++),K==="\r"||K===`
`){o.push(m),l.push(-1),v=Math.max(v,m),++y,++A,i.x=0,i.y+=e.lineHeight,g=null,E=0;continue}const k=e.chars[W];if(!k)continue;g&&k.kerning[g]&&(i.x+=k.kerning[g]);const at=Rg.pop()||{texture:it.EMPTY,line:0,charCode:0,prevSpaces:0,position:new At};at.texture=k.texture,at.line=y,at.charCode=W,at.position.x=i.x+k.xOffset+this._letterSpacing/2,at.position.y=i.y+k.yOffset,at.prevSpaces=E,n.push(at),m=at.position.x+Math.max(k.xAdvance-k.xOffset,k.texture.orig.width),i.x+=k.xAdvance+this._letterSpacing,S=Math.max(S,k.yOffset+k.texture.height),g=W,w!==-1&&f>0&&i.x>f&&(++A,Sn(n,1+w-A,1+z-w),z=w,w=-1,o.push(x),l.push(n.length>0?n[n.length-1].prevSpaces:0),v=Math.max(v,x),y++,i.x=0,i.y+=e.lineHeight,g=null,E=0)}const I=u[u.length-1];I!=="\r"&&I!==`
`&&(/(?:\s)/.test(I)&&(m=x),o.push(m),v=Math.max(v,m),l.push(-1));const D=[];for(let z=0;z<=y;z++){let K=0;this._align==="right"?K=v-o[z]:this._align==="center"?K=(v-o[z])/2:this._align==="justify"&&(K=l[z]<0?0:(v-o[z])/l[z]),D.push(K)}const L=n.length,O={},F=[],X=this._activePagesMeshData;d.push(...X);for(let z=0;z<L;z++){const K=n[z].texture,W=K.baseTexture.uid;if(!O[W]){let k=d.pop();if(!k){const ft=new KD;let j,vt;e.distanceFieldType==="none"?(j=new Tg(it.EMPTY),vt=ut.NORMAL):(j=new Tg(it.EMPTY,{program:cr.from(AB,TB),uniforms:{uFWidth:0}}),vt=ut.NORMAL_NPM);const Ot=new Uu(ft,j);Ot.blendMode=vt,k={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:Ot,vertices:null,uvs:null,indices:null}}k.index=0,k.indexCount=0,k.vertexCount=0,k.uvsCount=0,k.total=0;const{_textureCache:at}=this;at[W]=at[W]||new it(K.baseTexture),k.mesh.texture=at[W],k.mesh.tint=this._tint,F.push(k),O[W]=k}O[W].total++}for(let z=0;z<X.length;z++)F.includes(X[z])||this.removeChild(X[z].mesh);for(let z=0;z<F.length;z++)F[z].mesh.parent!==this&&this.addChild(F[z].mesh);this._activePagesMeshData=F;for(const z in O){const K=O[z],W=K.total;if(!(((Y=K.indices)==null?void 0:Y.length)>6*W)||K.vertices.length<Uu.BATCHABLE_SIZE*2)K.vertices=new Float32Array(4*2*W),K.uvs=new Float32Array(4*2*W),K.indices=new Uint16Array(6*W);else{const k=K.total,at=K.vertices;for(let ft=k*4*2;ft<at.length;ft++)at[ft]=0}K.mesh.size=6*W}for(let z=0;z<L;z++){const K=n[z];let W=K.position.x+D[K.line]*(this._align==="justify"?K.prevSpaces:1);this._roundPixels&&(W=Math.round(W));const k=W*r,at=K.position.y*r,ft=K.texture,j=O[ft.baseTexture.uid],vt=ft.frame,Ot=ft._uvs,H=j.index++;j.indices[H*6+0]=0+H*4,j.indices[H*6+1]=1+H*4,j.indices[H*6+2]=2+H*4,j.indices[H*6+3]=0+H*4,j.indices[H*6+4]=2+H*4,j.indices[H*6+5]=3+H*4,j.vertices[H*8+0]=k,j.vertices[H*8+1]=at,j.vertices[H*8+2]=k+vt.width*r,j.vertices[H*8+3]=at,j.vertices[H*8+4]=k+vt.width*r,j.vertices[H*8+5]=at+vt.height*r,j.vertices[H*8+6]=k,j.vertices[H*8+7]=at+vt.height*r,j.uvs[H*8+0]=Ot.x0,j.uvs[H*8+1]=Ot.y0,j.uvs[H*8+2]=Ot.x1,j.uvs[H*8+3]=Ot.y1,j.uvs[H*8+4]=Ot.x2,j.uvs[H*8+5]=Ot.y2,j.uvs[H*8+6]=Ot.x3,j.uvs[H*8+7]=Ot.y3}this._textWidth=v*r,this._textHeight=(i.y+e.lineHeight)*r;for(const z in O){const K=O[z];if(this.anchor.x!==0||this.anchor.y!==0){let ft=0;const j=this._textWidth*this.anchor.x,vt=this._textHeight*this.anchor.y;for(let Ot=0;Ot<K.total;Ot++)K.vertices[ft++]-=j,K.vertices[ft++]-=vt,K.vertices[ft++]-=j,K.vertices[ft++]-=vt,K.vertices[ft++]-=j,K.vertices[ft++]-=vt,K.vertices[ft++]-=j,K.vertices[ft++]-=vt}this._maxLineHeight=S*r;const W=K.mesh.geometry.getBuffer("aVertexPosition"),k=K.mesh.geometry.getBuffer("aTextureCoord"),at=K.mesh.geometry.getIndex();W.data=K.vertices,k.data=K.uvs,at.data=K.indices,W.update(),k.update(),at.update()}for(let z=0;z<n.length;z++)Rg.push(n[z]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:r,size:i}=Pe.available[this._fontName];if(r!=="none"){const{a:n,b:o,c:l,d:h}=this.worldTransform,u=Math.sqrt(n*n+o*o),f=Math.sqrt(l*l+h*h),d=(Math.abs(u)+Math.abs(f))/2,g=this.fontSize/i,m=e._view.resolution;for(const v of this._activePagesMeshData)v.mesh.shader.uniforms.uFWidth=d*t*g*m}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=Pe.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tint}set tint(e){if(this._tint!==e){this._tint=e;for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!Pe.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??Pe.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,i=Pe.available[this._fontName].distanceFieldType==="none"?Ig:Pg;i.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],i.filter(n=>t[n.mesh.texture.baseTexture.uid]).forEach(n=>{n.mesh.texture=it.EMPTY});for(const n in t)t[n].destroy(),delete t[n];this._font=null,this._textureCache=null,super.destroy(e)}};let SB=Pv;SB.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const CB=[".xml",".fnt"],IB={extension:{type:Z.LoadParser,priority:Dr.Normal},test(e){return CB.includes(me.extname(e).toLowerCase())},async testParse(e){return ua.test(e)||Hu.test(e)},async parse(e,t,r){const i=ua.test(e)?ua.parse(e):Hu.parse(e),{src:n}=t,{page:o}=i,l=[];for(let f=0;f<o.length;++f){const d=o[f].file,g=me.join(me.dirname(n),d);l.push(g)}const h=await r.load(l),u=l.map(f=>h[f]);return Pe.install(i,u,!0)},async load(e,t){return(await J.ADAPTER.fetch(e)).text()},unload(e){e.destroy()}};nt.add(IB);const PB={A:"menlo-bold-0.png",B:"menlo-bold-1.png",C:"menlo-bold-2.png",D:"menlo-bold-3.png",E:"menlo-bold-4.png",F:"menlo-bold-5.png",G:"menlo-bold-6.png",H:"menlo-bold-7.png",I:"menlo-bold-8.png",J:"menlo-bold-9.png",K:"menlo-bold-10.png",L:"menlo-bold-11.png",M:"menlo-bold-12.png",N:"menlo-bold-13.png",O:"menlo-bold-14.png",P:"menlo-bold-15.png",Q:"menlo-bold-16.png",R:"menlo-bold-17.png",S:"menlo-bold-18.png",T:"menlo-bold-19.png",U:"menlo-bold-20.png",V:"menlo-bold-21.png",W:"menlo-bold-22.png",X:"menlo-bold-23.png",Y:"menlo-bold-24.png",Z:"menlo-bold-25.png",a:"menlo-bold-26.png",b:"menlo-bold-27.png",c:"menlo-bold-28.png",d:"menlo-bold-29.png",e:"menlo-bold-30.png",f:"menlo-bold-31.png",g:"menlo-bold-32.png",h:"menlo-bold-33.png",i:"menlo-bold-34.png",j:"menlo-bold-35.png",k:"menlo-bold-36.png",l:"menlo-bold-37.png",m:"menlo-bold-38.png",n:"menlo-bold-39.png",o:"menlo-bold-40.png",p:"menlo-bold-41.png",q:"menlo-bold-42.png",r:"menlo-bold-43.png",s:"menlo-bold-44.png",t:"menlo-bold-45.png",u:"menlo-bold-46.png",v:"menlo-bold-47.png",w:"menlo-bold-48.png",x:"menlo-bold-49.png",y:"menlo-bold-50.png",z:"menlo-bold-51.png",0:"menlo-bold-52.png",1:"menlo-bold-53.png",2:"menlo-bold-54.png",3:"menlo-bold-55.png",4:"menlo-bold-56.png",5:"menlo-bold-57.png",6:"menlo-bold-58.png",7:"menlo-bold-59.png",8:"menlo-bold-60.png",9:"menlo-bold-61.png","!":"menlo-bold-62.png","@":"menlo-bold-63.png","#":"menlo-bold-64.png",$:"menlo-bold-65.png","%":"menlo-bold-66.png","^":"menlo-bold-67.png","&":"menlo-bold-68.png","*":"menlo-bold-69.png","(":"menlo-bold-70.png",")":"menlo-bold-71.png","-":"menlo-bold-72.png",_:"menlo-bold-73.png","=":"menlo-bold-74.png","+":"menlo-bold-75.png",",":"menlo-bold-76.png",".":"menlo-bold-77.png","<":"menlo-bold-78.png",">":"menlo-bold-79.png","/":"menlo-bold-80.png","?":"menlo-bold-81.png",";":"menlo-bold-82.png",":":"menlo-bold-83.png",'"':"menlo-bold-84.png","'":"menlo-bold-85.png","[":"menlo-bold-86.png","]":"menlo-bold-87.png","{":"menlo-bold-88.png","}":"menlo-bold-89.png","\\":"menlo-bold-90.png","|":"menlo-bold-91.png","`":"menlo-bold-92.png","~":"menlo-bold-93.png","•":"menlo-bold-94.png"},RB={A:"menlo-bold-half-0.png",B:"menlo-bold-half-1.png",C:"menlo-bold-half-2.png",D:"menlo-bold-half-3.png",E:"menlo-bold-half-4.png",F:"menlo-bold-half-5.png",G:"menlo-bold-half-6.png",H:"menlo-bold-half-7.png",I:"menlo-bold-half-8.png",J:"menlo-bold-half-9.png",K:"menlo-bold-half-10.png",L:"menlo-bold-half-11.png",M:"menlo-bold-half-12.png",N:"menlo-bold-half-13.png",O:"menlo-bold-half-14.png",P:"menlo-bold-half-15.png",Q:"menlo-bold-half-16.png",R:"menlo-bold-half-17.png",S:"menlo-bold-half-18.png",T:"menlo-bold-half-19.png",U:"menlo-bold-half-20.png",V:"menlo-bold-half-21.png",W:"menlo-bold-half-22.png",X:"menlo-bold-half-23.png",Y:"menlo-bold-half-24.png",Z:"menlo-bold-half-25.png",a:"menlo-bold-half-26.png",b:"menlo-bold-half-27.png",c:"menlo-bold-half-28.png",d:"menlo-bold-half-29.png",e:"menlo-bold-half-30.png",f:"menlo-bold-half-31.png",g:"menlo-bold-half-32.png",h:"menlo-bold-half-33.png",i:"menlo-bold-half-34.png",j:"menlo-bold-half-35.png",k:"menlo-bold-half-36.png",l:"menlo-bold-half-37.png",m:"menlo-bold-half-38.png",n:"menlo-bold-half-39.png",o:"menlo-bold-half-40.png",p:"menlo-bold-half-41.png",q:"menlo-bold-half-42.png",r:"menlo-bold-half-43.png",s:"menlo-bold-half-44.png",t:"menlo-bold-half-45.png",u:"menlo-bold-half-46.png",v:"menlo-bold-half-47.png",w:"menlo-bold-half-48.png",x:"menlo-bold-half-49.png",y:"menlo-bold-half-50.png",z:"menlo-bold-half-51.png",0:"menlo-bold-half-52.png",1:"menlo-bold-half-53.png",2:"menlo-bold-half-54.png",3:"menlo-bold-half-55.png",4:"menlo-bold-half-56.png",5:"menlo-bold-half-57.png",6:"menlo-bold-half-58.png",7:"menlo-bold-half-59.png",8:"menlo-bold-half-60.png",9:"menlo-bold-half-61.png","!":"menlo-bold-half-62.png","@":"menlo-bold-half-63.png","#":"menlo-bold-half-64.png",$:"menlo-bold-half-65.png","%":"menlo-bold-half-66.png","^":"menlo-bold-half-67.png","&":"menlo-bold-half-68.png","*":"menlo-bold-half-69.png","(":"menlo-bold-half-70.png",")":"menlo-bold-half-71.png","-":"menlo-bold-half-72.png",_:"menlo-bold-half-73.png","=":"menlo-bold-half-74.png","+":"menlo-bold-half-75.png",",":"menlo-bold-half-76.png",".":"menlo-bold-half-77.png","<":"menlo-bold-half-78.png",">":"menlo-bold-half-79.png","/":"menlo-bold-half-80.png","?":"menlo-bold-half-81.png",";":"menlo-bold-half-82.png",":":"menlo-bold-half-83.png",'"':"menlo-bold-half-84.png","'":"menlo-bold-half-85.png","[":"menlo-bold-half-86.png","]":"menlo-bold-half-87.png","{":"menlo-bold-half-88.png","}":"menlo-bold-half-89.png","\\":"menlo-bold-half-90.png","|":"menlo-bold-half-91.png","`":"menlo-bold-half-92.png","~":"menlo-bold-half-93.png","•":"menlo-bold-half-94.png"};let Rv;const Mv={width:100,height:46},ai=window.innerWidth/Mv.width,MB=(e,t,r)=>{const i=Math.trunc(e/ai),n=Math.trunc(t/ai);return`${i},${n},${r}`},ki={};async function DB(e){Rv=new dc({view:e,width:window.innerWidth,height:ai*Mv.height,autoDensity:!0,resolution:window.devicePixelRatio||1}),await BB()}const BB=async()=>(ki.ascii=await Li.load("/forcecrusher/fonts/menlo-bold.json"),ki.text=await Li.load("/forcecrusher/fonts/menlo-bold-half.json"),ki.tile=await Li.load("/forcecrusher/tile.png"),ki),OB=e=>ki.ascii.textures[PB[e]],FB=e=>ki.text.textures[RB[e]],LB=()=>ki.tile;class br{constructor(t){Zt(this,"x",0);Zt(this,"y",0);Zt(this,"halfWidth",!1);Zt(this,"width");Zt(this,"height");Zt(this,"layers",[]);Zt(this,"sprites",[]);Zt(this,"tileSets",[]);Zt(this,"tints",[]);Zt(this,"alphas",[]);Zt(this,"visible",!0);Zt(this,"_getTexture",t=>{const{tileSet:r,char:i}=t;return r==="ascii"?OB(i):r==="text"?FB(i):LB()});Zt(this,"_createSprite",t=>{const{char:r,width:i,height:n,layer:o,x:l,y:h,tileSet:u,tint:f=16777215,alpha:d=1}=t,g=this._getTexture({tileSet:u,char:r});let m=new Wn(g);m.width=this.halfWidth?i/2:i,m.height=n,m.x=this.halfWidth?l*(i/2):l*i,m.y=h*n,m.tint=f,m.alpha=d,this.sprites[o][h][l]=m,this.layers[o].addChild(m)});Zt(this,"updateCell",t=>(Object.keys(t).forEach(r=>{const{char:i,tint:n,alpha:o,tileSet:l,x:h,y:u}=t[r];this.updateSprite({char:i,tint:n,alpha:o,tileSet:l,x:h,y:u,layer:parseInt(r)})}),this));Zt(this,"updateSprite",async t=>{const{char:r="",layer:i,x:n,y:o,tileSet:l="text",tint:h,alpha:u}=t,f=this.sprites[i][o][n];if(f)return f.texture=this._getTexture({tileSet:l,char:r}),h&&(f.tint=h),typeof u<"u"&&(f.alpha=u),this});Zt(this,"updateRows",t=>(t.forEach((r,i)=>{r.forEach((n,o)=>{this.clearRow(o,i),this.updateRow({...n,layer:o,y:i})})}),this));Zt(this,"updateRow",t=>{const{string:r="",layer:i=0,x:n,y:o,tileSet:l,tint:h,alpha:u}=t;return[...r].forEach((d,g)=>this.updateSprite({char:d,layer:i||0,x:n||0+g,y:o||0,tileSet:l||this.tileSets[i],tint:h||this.tints[i],alpha:u||this.alphas[i]})),(l||this.tileSets[i])==="tile"&&Ci.times(this.width,d=>{this.updateSprite({layer:i,x:n||0+d,y:o||0,tileSet:l||this.tileSets[i],tint:h||this.tints[i],alpha:u||this.alphas[i]})}),this});Zt(this,"clearRow",(t,r)=>{const i=new Array(this.width+1).join(" ");this.updateRow({string:i,layer:t,y:r})});Zt(this,"clearView",()=>{let t=0;this.layers.forEach(()=>{Ci.times(this.height,r=>{this.clearRow(t,r)}),t+=1})});Zt(this,"show",()=>{this.visible=!0,this.layers.forEach(t=>t.visible=this.visible)});Zt(this,"hide",()=>{this.visible=!1,this.layers.forEach(t=>t.visible=this.visible)});return this.width=t.width,this.height=t.height,this.tileSets=t.tileSets,this.tints=t.tints,this.alphas=t.alphas,this.halfWidth=this.tileSets.includes("text"),this.visible=t.visible,Ci.times(t.layers,()=>this.layers.push(new Ue)),this.layers.forEach(r=>{const i=this.halfWidth?t.x*(ai/2):t.x*ai,n=t.y*ai;r.x=i,r.y=n,r.interactiveChildren=!1,r.visible=this.visible,Rv.stage.addChild(r)}),Ci.times(t.layers,()=>this.sprites.push(Array.from(Array(this.height),()=>Array.from(Array(this.width))))),Ci.times(t.layers,r=>{Ci.times(this.height,i=>{Ci.times(this.width,async n=>{this._createSprite({char:"",width:ai,height:ai,layer:r,x:n,y:i,tileSet:t.tileSets[r],tint:t.tints[r],alpha:t.alphas[r]})})})}),this}}var Dv={exports:{}},_c={};Object.defineProperty(_c,"__esModule",{value:!0});function Xu(e,t){t=e.length;for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function NB(e){if(Array.isArray(e))return Xu(e)}function kB(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Bv(e,t){if(e){if(typeof e=="string")return Xu(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xu(e,t)}}function UB(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GB(e){return NB(e)||kB(e)||Bv(e)||UB()}function WB(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Bv(e))||t){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(u){throw u},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,l=!1,h;return{s:function(){r=r.call(e)},n:function(){var u=r.next();return o=u.done,u},e:function(u){l=!0,h=u},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(l)throw h}}}}function $B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function HB(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Ov(e){var t=HB(e,"string");return typeof t=="symbol"?t:String(t)}function XB(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Ov(i.key),i)}}function zB(e,t,r){return t&&XB(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function VB(e,t,r){return t=Ov(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var jB=function(){function e(){$B(this,e),VB(this,"subscribers",new Set)}return zB(e,[{key:"onSubscribe",get:function(){return this._onSubscribe||(this._onSubscribe=new e),this._onSubscribe}},{key:"onUnsubscribe",get:function(){return this._onUnsubscribe||(this._onUnsubscribe=new e),this._onUnsubscribe}},{key:"subscribe",value:function(r){var i,n=this;return this.subscribers.add(r),(i=this._onSubscribe)===null||i===void 0||i.emit(r),function(){return n.unsubscribe(r)}}},{key:"unsubscribe",value:function(r){var i;this.subscribers.delete(r),(i=this._onUnsubscribe)===null||i===void 0||i.emit(r)}},{key:"clear",value:function(){if(this._onUnsubscribe){var r=WB(this.subscribers),i;try{for(r.s();!(i=r.n()).done;){var n=i.value;this._onUnsubscribe.emit(n)}}catch(o){r.e(o)}finally{r.f()}}this.subscribers.clear()}},{key:"emit",value:function(){for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];this.subscribers.forEach(function(o){return o.apply(void 0,i)})}},{key:"emitAsync",value:function(){for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return Promise.all(GB(this.subscribers).map(function(o){return o.apply(void 0,i)}))}}]),e}();_c.Event=jB;Dv.exports=_c;var Mg=Dv.exports;function Dg(e,t){t=e.length;for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function YB(e,t){if(e){if(typeof e=="string")return Dg(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Dg(e,t)}}function qB(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=YB(e))||t){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(u){throw u},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,l=!1,h;return{s:function(){r=r.call(e)},n:function(){var u=r.next();return o=u.done,u},e:function(u){l=!0,h=u},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(l)throw h}}}}function KB(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ZB(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Fv(e){var t=ZB(e,"string");return typeof t=="symbol"?t:String(t)}function JB(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Fv(i.key),i)}}function QB(e,t,r){return t&&JB(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Zo(e,t,r){return t=Fv(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Lv;Lv=Symbol.iterator;var Nv=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];KB(this,e),Zo(this,"_version",0),Zo(this,"onEntityAdded",new Mg.Event),Zo(this,"onEntityRemoved",new Mg.Event),Zo(this,"entityPositions",new Map),this._entities=t,this.add=this.add.bind(this),this.remove=this.remove.bind(this);for(var r=0;r<t.length;r++)this.entityPositions.set(t[r],r)}return QB(e,[{key:"version",get:function(){return this._version}},{key:"entities",get:function(){return this._entities}},{key:Lv,value:function(){var r=this,i=this._entities.length,n={value:void 0,done:!1};return{next:function(){return n.value=r._entities[--i],n.done=i<0,n}}}},{key:"size",get:function(){return this.entities.length}},{key:"first",get:function(){return this.entities[0]}},{key:"has",value:function(r){return this.entityPositions.has(r)}},{key:"add",value:function(r){return r&&!this.has(r)&&(this.entities.push(r),this.entityPositions.set(r,this.entities.length-1),this._version++,this.onEntityAdded.emit(r)),r}},{key:"remove",value:function(r){if(this.has(r)){this.onEntityRemoved.emit(r);var i=this.entityPositions.get(r);this.entityPositions.delete(r);var n=this.entities[this.entities.length-1];n!==r&&(this.entities[i]=n,this.entityPositions.set(n,i)),this.entities.pop(),this._version++}return r}},{key:"clear",value:function(){var r=qB(this),i;try{for(r.s();!(i=r.n()).done;){var n=i.value;this.remove(n)}}catch(o){r.e(o)}finally{r.f()}}}]),e}(),Bg=new WeakMap,Og=0,tO=function(t){var r=Bg.get(t);return r!==void 0?r:(Bg.set(t,Og),Og++)};function eO(){var e=new Array;function t(n){e.push(n)}function r(){e.length=0}function i(){e.forEach(function(n){return n()}),r()}return t.clear=r,t.flush=i,t}function zu(e,t){t=e.length;for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function rO(e){if(Array.isArray(e))return zu(e)}function iO(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function kv(e,t){if(e){if(typeof e=="string")return zu(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zu(e,t)}}function nO(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ws(e){return rO(e)||iO(e)||kv(e)||nO()}function zi(e){return zi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},zi(e)}function sO(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=zi(e),e!==null););return e}function Es(){return typeof Reflect<"u"&&Reflect.get?Es=Reflect.get.bind():Es=function(t,r,i){var n=sO(t,r);if(n){var o=Object.getOwnPropertyDescriptor(n,r);return o.get?o.get.call(arguments.length<3?t:i):o.value}},Es.apply(this,arguments)}function Vu(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=kv(e))||t){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(u){throw u},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,l=!1,h;return{s:function(){r=r.call(e)},n:function(){var u=r.next();return o=u.done,u},e:function(u){l=!0,h=u},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(l)throw h}}}}function oO(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Uv(e){var t=oO(e,"string");return typeof t=="symbol"?t:String(t)}function bn(e,t,r){return t=Uv(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Fg(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function Oi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Fg(Object(r),!0).forEach(function(i){bn(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fg(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Gv(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function aO(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Uv(i.key),i)}}function Wv(e,t,r){return t&&aO(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function wn(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ju(e,t){return ju=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,n){return i.__proto__=n,i},ju(e,t)}function $v(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ju(e,t)}function lO(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function hO(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return wn(e)}function Hv(e){var t=lO();return function(){var i=zi(e),n;if(t){var o=zi(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return hO(this,n)}}var Xv,uO=function(e){$v(r,e);var t=Hv(r);function r(){var i,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return Gv(this,r),i=t.call(this,n),bn(wn(i),"queries",new Set),bn(wn(i),"entityToId",new Map),bn(wn(i),"idToEntity",new Map),bn(wn(i),"nextId",0),i.onEntityAdded.subscribe(function(o){i.reindex(o)}),i.onEntityRemoved.subscribe(function(o){if(i.queries.forEach(function(h){return h.remove(o)}),i.entityToId.has(o)){var l=i.entityToId.get(o);i.idToEntity.delete(l),i.entityToId.delete(o)}}),i}return Wv(r,[{key:"update",value:function(i){function n(o,l,h){return i.apply(this,arguments)}return n.toString=function(){return i.toString()},n}(function(i,n,o){if(typeof n=="function"){var l=n(i);l&&Object.assign(i,l)}else typeof n=="string"?i[n]=o:n&&Object.assign(i,n);return this.reindex(i),i})},{key:"addComponent",value:function(n,o,l){n[o]===void 0&&(n[o]=l,this.reindex(n))}},{key:"removeComponent",value:function(n,o){if(n[o]!==void 0){if(this.has(n)){var l=Oi({},n);delete l[o],this.reindex(n,l)}delete n[o]}}},{key:"query",value:function(n){var o=dO(n),l=zv(o),h=Vu(this.queries),u;try{for(h.s();!(u=h.n()).done;){var f=u.value;if(f.key===l)return f}}catch(g){h.e(g)}finally{h.f()}var d=new cO(this,o);return this.queries.add(d),d}},{key:"with",value:function(){for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return this.query({with:o,without:[],predicates:[]})}},{key:"without",value:function(){for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return this.query({with:[],without:o,predicates:[]})}},{key:"where",value:function(n){return this.query({with:[],without:[],predicates:[n]})}},{key:"reindex",value:function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:n;if(this.has(n)){var l=Vu(this.queries),h;try{for(l.s();!(h=l.n()).done;){var u=h.value;u.evaluate(n,o)}}catch(f){l.e(f)}finally{l.f()}}}},{key:"id",value:function(n){if(this.has(n)){if(!this.entityToId.has(n)){var o=this.nextId++;this.entityToId.set(n,o),this.idToEntity.set(o,n)}return this.entityToId.get(n)}}},{key:"entity",value:function(n){return this.idToEntity.get(n)}}]),r}(Nv);Xv=Symbol.iterator;var cO=function(e){$v(r,e);var t=Hv(r);function r(i,n){var o;return Gv(this,r),o=t.call(this),bn(wn(o),"_isConnected",!1),o.world=i,o.config=n,o.key=zv(n),o.onEntityAdded.onSubscribe.subscribe(function(){return o.connect()}),o.onEntityRemoved.onSubscribe.subscribe(function(){return o.connect()}),o}return Wv(r,[{key:"isConnected",get:function(){return this._isConnected}},{key:"entities",get:function(){return this._isConnected||this.connect(),Es(zi(r.prototype),"entities",this)}},{key:Xv,value:function(){return this._isConnected||this.connect(),Es(zi(r.prototype),Symbol.iterator,this).call(this)}},{key:"connect",value:function(){if(!this._isConnected){this._isConnected=!0;var n=Vu(this.world),o;try{for(n.s();!(o=n.n()).done;){var l=o.value;this.evaluate(l)}}catch(h){n.e(h)}finally{n.f()}}return this}},{key:"disconnect",value:function(){return this._isConnected=!1,this}},{key:"with",value:function(){for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return this.world.query(Oi(Oi({},this.config),{},{with:[].concat(ws(this.config.with),o)}))}},{key:"without",value:function(){for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return this.world.query(Oi(Oi({},this.config),{},{without:[].concat(ws(this.config.without),o)}))}},{key:"where",value:function(n){return this.world.query(Oi(Oi({},this.config),{},{predicates:[].concat(ws(this.config.predicates),[n])}))}},{key:"want",value:function(n){return this.config.with.every(function(o){return n[o]!==void 0})&&this.config.without.every(function(o){return n[o]===void 0})&&this.config.predicates.every(function(o){return o(n)})}},{key:"evaluate",value:function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:n;if(this.isConnected){var l=this.want(o),h=this.has(n);l&&!h?this.add(n):!l&&h&&this.remove(n)}}}]),r}(Nv),Lg=function(t){return ws(new Set(t.sort().filter(function(r){return!!r&&r!==""})))};function fO(e){return ws(new Set(e))}function dO(e){return{with:Lg(e.with),without:Lg(e.without),predicates:fO(e.predicates)}}function zv(e){return"".concat(e.with.join(","),":").concat(e.without.join(","),":").concat(e.predicates.map(function(t){return tO(t)}).join(","))}eO();const St=new uO;var yc={exports:{}};yc.exports;(function(e){(function(){var t,r,i,n,o,l,h,u,f,d,g,m,v,y,w;i=Math.floor,d=Math.min,r=function(x,A){return x<A?-1:x>A?1:0},f=function(x,A,S,E,I){var D;if(S==null&&(S=0),I==null&&(I=r),S<0)throw new Error("lo must be non-negative");for(E==null&&(E=x.length);S<E;)D=i((S+E)/2),I(A,x[D])<0?E=D:S=D+1;return[].splice.apply(x,[S,S-S].concat(A)),A},l=function(x,A,S){return S==null&&(S=r),x.push(A),y(x,0,x.length-1,S)},o=function(x,A){var S,E;return A==null&&(A=r),S=x.pop(),x.length?(E=x[0],x[0]=S,w(x,0,A)):E=S,E},u=function(x,A,S){var E;return S==null&&(S=r),E=x[0],x[0]=A,w(x,0,S),E},h=function(x,A,S){var E;return S==null&&(S=r),x.length&&S(x[0],A)<0&&(E=[x[0],A],A=E[0],x[0]=E[1],w(x,0,S)),A},n=function(x,A){var S,E,I,D,L,O;for(A==null&&(A=r),D=(function(){O=[];for(var F=0,X=i(x.length/2);0<=X?F<X:F>X;0<=X?F++:F--)O.push(F);return O}).apply(this).reverse(),L=[],E=0,I=D.length;E<I;E++)S=D[E],L.push(w(x,S,A));return L},v=function(x,A,S){var E;if(S==null&&(S=r),E=x.indexOf(A),E!==-1)return y(x,0,E,S),w(x,E,S)},g=function(x,A,S){var E,I,D,L,O;if(S==null&&(S=r),I=x.slice(0,A),!I.length)return I;for(n(I,S),O=x.slice(A),D=0,L=O.length;D<L;D++)E=O[D],h(I,E,S);return I.sort(S).reverse()},m=function(x,A,S){var E,I,D,L,O,F,X,Y,z;if(S==null&&(S=r),A*10<=x.length){if(D=x.slice(0,A).sort(S),!D.length)return D;for(I=D[D.length-1],X=x.slice(A),L=0,F=X.length;L<F;L++)E=X[L],S(E,I)<0&&(f(D,E,0,null,S),D.pop(),I=D[D.length-1]);return D}for(n(x,S),z=[],O=0,Y=d(A,x.length);0<=Y?O<Y:O>Y;0<=Y?++O:--O)z.push(o(x,S));return z},y=function(x,A,S,E){var I,D,L;for(E==null&&(E=r),I=x[S];S>A;){if(L=S-1>>1,D=x[L],E(I,D)<0){x[S]=D,S=L;continue}break}return x[S]=I},w=function(x,A,S){var E,I,D,L,O;for(S==null&&(S=r),I=x.length,O=A,D=x[A],E=2*A+1;E<I;)L=E+1,L<I&&!(S(x[E],x[L])<0)&&(E=L),x[A]=x[E],A=E,E=2*A+1;return x[A]=D,y(x,O,A,S)},t=function(){x.push=l,x.pop=o,x.replace=u,x.pushpop=h,x.heapify=n,x.updateItem=v,x.nlargest=g,x.nsmallest=m;function x(A){this.cmp=A??r,this.nodes=[]}return x.prototype.push=function(A){return l(this.nodes,A,this.cmp)},x.prototype.pop=function(){return o(this.nodes,this.cmp)},x.prototype.peek=function(){return this.nodes[0]},x.prototype.contains=function(A){return this.nodes.indexOf(A)!==-1},x.prototype.replace=function(A){return u(this.nodes,A,this.cmp)},x.prototype.pushpop=function(A){return h(this.nodes,A,this.cmp)},x.prototype.heapify=function(){return n(this.nodes,this.cmp)},x.prototype.updateItem=function(A){return v(this.nodes,A,this.cmp)},x.prototype.clear=function(){return this.nodes=[]},x.prototype.empty=function(){return this.nodes.length===0},x.prototype.size=function(){return this.nodes.length},x.prototype.clone=function(){var A;return A=new x,A.nodes=this.nodes.slice(0),A},x.prototype.toArray=function(){return this.nodes.slice(0)},x.prototype.insert=x.prototype.push,x.prototype.top=x.prototype.peek,x.prototype.front=x.prototype.peek,x.prototype.has=x.prototype.contains,x.prototype.copy=x.prototype.clone,x}(),e!==null&&e.exports?e.exports=t:window.Heap=t}).call(Sr)})(yc);var pO=yc.exports,Ha=pO;function gO(e,t,r){this.x=e,this.y=t,this.walkable=r===void 0?!0:r}var xc=gO,mO={Always:1,Never:2,IfAtMostOneObstacle:3,OnlyWhenNoObstacles:4},Ze=mO,Vv=xc,Jo=Ze;function jr(e,t,r){var i;typeof e!="object"?i=e:(t=e.length,i=e[0].length,r=e),this.width=i,this.height=t,this.nodes=this._buildNodes(i,t,r)}jr.prototype._buildNodes=function(e,t,r){var i,n,o=new Array(t);for(i=0;i<t;++i)for(o[i]=new Array(e),n=0;n<e;++n)o[i][n]=new Vv(n,i);if(r===void 0)return o;if(r.length!==t||r[0].length!==e)throw new Error("Matrix size does not fit");for(i=0;i<t;++i)for(n=0;n<e;++n)r[i][n]&&(o[i][n].walkable=!1);return o};jr.prototype.getNodeAt=function(e,t){return this.nodes[t][e]};jr.prototype.isWalkableAt=function(e,t){return this.isInside(e,t)&&this.nodes[t][e].walkable};jr.prototype.isInside=function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height};jr.prototype.setWalkableAt=function(e,t,r){this.nodes[t][e].walkable=r};jr.prototype.getNeighbors=function(e,t){var r=e.x,i=e.y,n=[],o=!1,l=!1,h=!1,u=!1,f=!1,d=!1,g=!1,m=!1,v=this.nodes;if(this.isWalkableAt(r,i-1)&&(n.push(v[i-1][r]),o=!0),this.isWalkableAt(r+1,i)&&(n.push(v[i][r+1]),h=!0),this.isWalkableAt(r,i+1)&&(n.push(v[i+1][r]),f=!0),this.isWalkableAt(r-1,i)&&(n.push(v[i][r-1]),g=!0),t===Jo.Never)return n;if(t===Jo.OnlyWhenNoObstacles)l=g&&o,u=o&&h,d=h&&f,m=f&&g;else if(t===Jo.IfAtMostOneObstacle)l=g||o,u=o||h,d=h||f,m=f||g;else if(t===Jo.Always)l=!0,u=!0,d=!0,m=!0;else throw new Error("Incorrect value of diagonalMovement");return l&&this.isWalkableAt(r-1,i-1)&&n.push(v[i-1][r-1]),u&&this.isWalkableAt(r+1,i-1)&&n.push(v[i-1][r+1]),d&&this.isWalkableAt(r+1,i+1)&&n.push(v[i+1][r+1]),m&&this.isWalkableAt(r-1,i+1)&&n.push(v[i+1][r-1]),n};jr.prototype.clone=function(){var e,t,r=this.width,i=this.height,n=this.nodes,o=new jr(r,i),l=new Array(i);for(e=0;e<i;++e)for(l[e]=new Array(r),t=0;t<r;++t)l[e][t]=new Vv(t,e,n[e][t].walkable);return o.nodes=l,o};var vO=jr,Ge={};function Yu(e){for(var t=[[e.x,e.y]];e.parent;)e=e.parent,t.push([e.x,e.y]);return t.reverse()}Ge.backtrace=Yu;function _O(e,t){var r=Yu(e),i=Yu(t);return r.concat(i.reverse())}Ge.biBacktrace=_O;function yO(e){var t,r=0,i,n,o,l;for(t=1;t<e.length;++t)i=e[t-1],n=e[t],o=i[0]-n[0],l=i[1]-n[1],r+=Math.sqrt(o*o+l*l);return r}Ge.pathLength=yO;function bc(e,t,r,i){var n=Math.abs,o=[],l,h,u,f,d,g;for(u=n(r-e),f=n(i-t),l=e<r?1:-1,h=t<i?1:-1,d=u-f;o.push([e,t]),!(e===r&&t===i);)g=2*d,g>-f&&(d=d-f,e=e+l),g<u&&(d=d+u,t=t+h);return o}Ge.interpolate=bc;function xO(e){var t=[],r=e.length,i,n,o,l,h,u;if(r<2)return t;for(h=0;h<r-1;++h)for(i=e[h],n=e[h+1],o=bc(i[0],i[1],n[0],n[1]),l=o.length,u=0;u<l-1;++u)t.push(o[u]);return t.push(e[r-1]),t}Ge.expandPath=xO;function bO(e,t){var r=t.length,i=t[0][0],n=t[0][1],o=t[r-1][0],l=t[r-1][1],h,u,f,d,g,m,v,y,w,x,A;for(h=i,u=n,g=[[h,u]],m=2;m<r;++m){for(y=t[m],f=y[0],d=y[1],w=bc(h,u,f,d),A=!1,v=1;v<w.length;++v)if(x=w[v],!e.isWalkableAt(x[0],x[1])){A=!0;break}A&&(lastValidCoord=t[m-1],g.push(lastValidCoord),h=lastValidCoord[0],u=lastValidCoord[1])}return g.push([o,l]),g}Ge.smoothenPath=bO;function wO(e){if(e.length<3)return e;var t=[],r=e[0][0],i=e[0][1],n=e[1][0],o=e[1][1],l=n-r,h=o-i,u,f,d,g,m,v;for(m=Math.sqrt(l*l+h*h),l/=m,h/=m,t.push([r,i]),v=2;v<e.length;v++)u=n,f=o,d=l,g=h,n=e[v][0],o=e[v][1],l=n-u,h=o-f,m=Math.sqrt(l*l+h*h),l/=m,h/=m,(l!==d||h!==g)&&t.push([u,f]);return t.push([n,o]),t}Ge.compressPath=wO;var Ns={manhattan:function(e,t){return e+t},euclidean:function(e,t){return Math.sqrt(e*e+t*t)},octile:function(e,t){var r=Math.SQRT2-1;return e<t?r*e+t:r*t+e},chebyshev:function(e,t){return Math.max(e,t)}},EO=Ha,TO=Ge,qh=Ns,Qo=Ze;function jv(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.heuristic=e.heuristic||qh.manhattan,this.weight=e.weight||1,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=Qo.OnlyWhenNoObstacles:this.diagonalMovement=Qo.IfAtMostOneObstacle:this.diagonalMovement=Qo.Never),this.diagonalMovement===Qo.Never?this.heuristic=e.heuristic||qh.manhattan:this.heuristic=e.heuristic||qh.octile}jv.prototype.findPath=function(e,t,r,i,n){var o=new EO(function(D,L){return D.f-L.f}),l=n.getNodeAt(e,t),h=n.getNodeAt(r,i),u=this.heuristic,f=this.diagonalMovement,d=this.weight,g=Math.abs,m=Math.SQRT2,v,y,w,x,A,S,E,I;for(l.g=0,l.f=0,o.push(l),l.opened=!0;!o.empty();){if(v=o.pop(),v.closed=!0,v===h)return TO.backtrace(h);for(y=n.getNeighbors(v,f),x=0,A=y.length;x<A;++x)w=y[x],!w.closed&&(S=w.x,E=w.y,I=v.g+(S-v.x===0||E-v.y===0?1:m),(!w.opened||I<w.g)&&(w.g=I,w.h=w.h||d*u(g(S-r),g(E-i)),w.f=w.g+w.h,w.parent=v,w.opened?o.updateItem(w):(o.push(w),w.opened=!0)))}return[]};var wc=jv,Yv=wc;function Pa(e){Yv.call(this,e);var t=this.heuristic;this.heuristic=function(r,i){return t(r,i)*1e6}}Pa.prototype=new Yv;Pa.prototype.constructor=Pa;var AO=Pa,SO=Ge,Kh=Ze;function qv(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=Kh.OnlyWhenNoObstacles:this.diagonalMovement=Kh.IfAtMostOneObstacle:this.diagonalMovement=Kh.Never)}qv.prototype.findPath=function(e,t,r,i,n){var o=[],l=this.diagonalMovement,h=n.getNodeAt(e,t),u=n.getNodeAt(r,i),f,d,g,m,v;for(o.push(h),h.opened=!0;o.length;){if(g=o.shift(),g.closed=!0,g===u)return SO.backtrace(u);for(f=n.getNeighbors(g,l),m=0,v=f.length;m<v;++m)d=f[m],!(d.closed||d.opened)&&(o.push(d),d.opened=!0,d.parent=g)}return[]};var CO=qv,Kv=wc;function Ra(e){Kv.call(this,e),this.heuristic=function(t,r){return 0}}Ra.prototype=new Kv;Ra.prototype.constructor=Ra;var IO=Ra,Ng=Ha,kg=Ge,Zh=Ns,ta=Ze;function Zv(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.heuristic=e.heuristic||Zh.manhattan,this.weight=e.weight||1,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=ta.OnlyWhenNoObstacles:this.diagonalMovement=ta.IfAtMostOneObstacle:this.diagonalMovement=ta.Never),this.diagonalMovement===ta.Never?this.heuristic=e.heuristic||Zh.manhattan:this.heuristic=e.heuristic||Zh.octile}Zv.prototype.findPath=function(e,t,r,i,n){var o=function(X,Y){return X.f-Y.f},l=new Ng(o),h=new Ng(o),u=n.getNodeAt(e,t),f=n.getNodeAt(r,i),d=this.heuristic,g=this.diagonalMovement,m=this.weight,v=Math.abs,y=Math.SQRT2,w,x,A,S,E,I,D,L,O=1,F=2;for(u.g=0,u.f=0,l.push(u),u.opened=O,f.g=0,f.f=0,h.push(f),f.opened=F;!l.empty()&&!h.empty();){for(w=l.pop(),w.closed=!0,x=n.getNeighbors(w,g),S=0,E=x.length;S<E;++S)if(A=x[S],!A.closed){if(A.opened===F)return kg.biBacktrace(w,A);I=A.x,D=A.y,L=w.g+(I-w.x===0||D-w.y===0?1:y),(!A.opened||L<A.g)&&(A.g=L,A.h=A.h||m*d(v(I-r),v(D-i)),A.f=A.g+A.h,A.parent=w,A.opened?l.updateItem(A):(l.push(A),A.opened=O))}for(w=h.pop(),w.closed=!0,x=n.getNeighbors(w,g),S=0,E=x.length;S<E;++S)if(A=x[S],!A.closed){if(A.opened===O)return kg.biBacktrace(A,w);I=A.x,D=A.y,L=w.g+(I-w.x===0||D-w.y===0?1:y),(!A.opened||L<A.g)&&(A.g=L,A.h=A.h||m*d(v(I-e),v(D-t)),A.f=A.g+A.h,A.parent=w,A.opened?h.updateItem(A):(h.push(A),A.opened=F))}}return[]};var Ec=Zv,Jv=Ec;function Ma(e){Jv.call(this,e);var t=this.heuristic;this.heuristic=function(r,i){return t(r,i)*1e6}}Ma.prototype=new Jv;Ma.prototype.constructor=Ma;var PO=Ma,Ug=Ge,Jh=Ze;function Qv(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=Jh.OnlyWhenNoObstacles:this.diagonalMovement=Jh.IfAtMostOneObstacle:this.diagonalMovement=Jh.Never)}Qv.prototype.findPath=function(e,t,r,i,n){var o=n.getNodeAt(e,t),l=n.getNodeAt(r,i),h=[],u=[],f,d,g,m=this.diagonalMovement,v=0,y=1,w,x;for(h.push(o),o.opened=!0,o.by=v,u.push(l),l.opened=!0,l.by=y;h.length&&u.length;){for(g=h.shift(),g.closed=!0,f=n.getNeighbors(g,m),w=0,x=f.length;w<x;++w)if(d=f[w],!d.closed){if(d.opened){if(d.by===y)return Ug.biBacktrace(g,d);continue}h.push(d),d.parent=g,d.opened=!0,d.by=v}for(g=u.shift(),g.closed=!0,f=n.getNeighbors(g,m),w=0,x=f.length;w<x;++w)if(d=f[w],!d.closed){if(d.opened){if(d.by===v)return Ug.biBacktrace(d,g);continue}u.push(d),d.parent=g,d.opened=!0,d.by=y}}return[]};var RO=Qv,t_=Ec;function Da(e){t_.call(this,e),this.heuristic=function(t,r){return 0}}Da.prototype=new t_;Da.prototype.constructor=Da;var MO=Da,Qh=Ns,Gg=xc,ea=Ze;function e_(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.heuristic=e.heuristic||Qh.manhattan,this.weight=e.weight||1,this.trackRecursion=e.trackRecursion||!1,this.timeLimit=e.timeLimit||1/0,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=ea.OnlyWhenNoObstacles:this.diagonalMovement=ea.IfAtMostOneObstacle:this.diagonalMovement=ea.Never),this.diagonalMovement===ea.Never?this.heuristic=e.heuristic||Qh.manhattan:this.heuristic=e.heuristic||Qh.octile}e_.prototype.findPath=function(e,t,r,i,n){var o=new Date().getTime(),l=(function(w,x){return this.heuristic(Math.abs(x.x-w.x),Math.abs(x.y-w.y))}).bind(this),h=function(w,x){return w.x===x.x||w.y===x.y?1:Math.SQRT2},u=(function(w,x,A,S,E){if(this.timeLimit>0&&new Date().getTime()-o>this.timeLimit*1e3)return 1/0;var I=x+l(w,d)*this.weight;if(I>A)return I;if(w==d)return S[E]=[w.x,w.y],w;var D,L,O,F,X=n.getNeighbors(w,this.diagonalMovement);for(O=0,D=1/0;F=X[O];++O){if(this.trackRecursion&&(F.retainCount=F.retainCount+1||1,F.tested!==!0&&(F.tested=!0)),L=u(F,x+h(w,F),A,S,E+1),L instanceof Gg)return S[E]=[w.x,w.y],L;this.trackRecursion&&--F.retainCount===0&&(F.tested=!1),L<D&&(D=L)}return D}).bind(this),f=n.getNodeAt(e,t),d=n.getNodeAt(r,i),g=l(f,d),m,v,y;for(m=0;;++m){if(v=[],y=u(f,0,g,v,0),y===1/0)return[];if(y instanceof Gg)return v;g=y}return[]};var DO=e_,BO=Ha,Wg=Ge,r_=Ns;function Tc(e){e=e||{},this.heuristic=e.heuristic||r_.manhattan,this.trackJumpRecursion=e.trackJumpRecursion||!1}Tc.prototype.findPath=function(e,t,r,i,n){var o=this.openList=new BO(function(f,d){return f.f-d.f}),l=this.startNode=n.getNodeAt(e,t),h=this.endNode=n.getNodeAt(r,i),u;for(this.grid=n,l.g=0,l.f=0,o.push(l),l.opened=!0;!o.empty();){if(u=o.pop(),u.closed=!0,u===h)return Wg.expandPath(Wg.backtrace(h));this._identifySuccessors(u)}return[]};Tc.prototype._identifySuccessors=function(e){var t=this.grid,r=this.heuristic,i=this.openList,n=this.endNode.x,o=this.endNode.y,l,h,u,f,d,g=e.x,m=e.y,v,y,w,x,A,S=Math.abs;for(l=this._findNeighbors(e),f=0,d=l.length;f<d;++f)if(h=l[f],u=this._jump(h[0],h[1],g,m),u){if(v=u[0],y=u[1],A=t.getNodeAt(v,y),A.closed)continue;w=r_.octile(S(v-g),S(y-m)),x=e.g+w,(!A.opened||x<A.g)&&(A.g=x,A.h=A.h||r(S(v-n),S(y-o)),A.f=A.g+A.h,A.parent=e,A.opened?i.updateItem(A):(i.push(A),A.opened=!0))}};var Xa=Tc,i_=Xa,OO=Ze;function On(e){i_.call(this,e)}On.prototype=new i_;On.prototype.constructor=On;On.prototype._jump=function(e,t,r,i){var n=this.grid,o=e-r,l=t-i;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0){if(n.isWalkableAt(e,t-1)&&!n.isWalkableAt(e-o,t-1)||n.isWalkableAt(e,t+1)&&!n.isWalkableAt(e-o,t+1))return[e,t]}else if(l!==0){if(n.isWalkableAt(e-1,t)&&!n.isWalkableAt(e-1,t-l)||n.isWalkableAt(e+1,t)&&!n.isWalkableAt(e+1,t-l))return[e,t];if(this._jump(e+1,t,e,t)||this._jump(e-1,t,e,t))return[e,t]}else throw new Error("Only horizontal and vertical movements are allowed");return this._jump(e+o,t+l,e,t)};On.prototype._findNeighbors=function(e){var t=e.parent,r=e.x,i=e.y,n=this.grid,o,l,h,u,f=[],d,g,m,v;if(t)o=t.x,l=t.y,h=(r-o)/Math.max(Math.abs(r-o),1),u=(i-l)/Math.max(Math.abs(i-l),1),h!==0?(n.isWalkableAt(r,i-1)&&f.push([r,i-1]),n.isWalkableAt(r,i+1)&&f.push([r,i+1]),n.isWalkableAt(r+h,i)&&f.push([r+h,i])):u!==0&&(n.isWalkableAt(r-1,i)&&f.push([r-1,i]),n.isWalkableAt(r+1,i)&&f.push([r+1,i]),n.isWalkableAt(r,i+u)&&f.push([r,i+u]));else for(d=n.getNeighbors(e,OO.Never),m=0,v=d.length;m<v;++m)g=d[m],f.push([g.x,g.y]);return f};var FO=On,n_=Xa,LO=Ze;function Fn(e){n_.call(this,e)}Fn.prototype=new n_;Fn.prototype.constructor=Fn;Fn.prototype._jump=function(e,t,r,i){var n=this.grid,o=e-r,l=t-i;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0&&l!==0){if(n.isWalkableAt(e-o,t+l)&&!n.isWalkableAt(e-o,t)||n.isWalkableAt(e+o,t-l)&&!n.isWalkableAt(e,t-l))return[e,t];if(this._jump(e+o,t,e,t)||this._jump(e,t+l,e,t))return[e,t]}else if(o!==0){if(n.isWalkableAt(e+o,t+1)&&!n.isWalkableAt(e,t+1)||n.isWalkableAt(e+o,t-1)&&!n.isWalkableAt(e,t-1))return[e,t]}else if(n.isWalkableAt(e+1,t+l)&&!n.isWalkableAt(e+1,t)||n.isWalkableAt(e-1,t+l)&&!n.isWalkableAt(e-1,t))return[e,t];return this._jump(e+o,t+l,e,t)};Fn.prototype._findNeighbors=function(e){var t=e.parent,r=e.x,i=e.y,n=this.grid,o,l,h,u,f=[],d,g,m,v;if(t)o=t.x,l=t.y,h=(r-o)/Math.max(Math.abs(r-o),1),u=(i-l)/Math.max(Math.abs(i-l),1),h!==0&&u!==0?(n.isWalkableAt(r,i+u)&&f.push([r,i+u]),n.isWalkableAt(r+h,i)&&f.push([r+h,i]),n.isWalkableAt(r+h,i+u)&&f.push([r+h,i+u]),n.isWalkableAt(r-h,i)||f.push([r-h,i+u]),n.isWalkableAt(r,i-u)||f.push([r+h,i-u])):h===0?(n.isWalkableAt(r,i+u)&&f.push([r,i+u]),n.isWalkableAt(r+1,i)||f.push([r+1,i+u]),n.isWalkableAt(r-1,i)||f.push([r-1,i+u])):(n.isWalkableAt(r+h,i)&&f.push([r+h,i]),n.isWalkableAt(r,i+1)||f.push([r+h,i+1]),n.isWalkableAt(r,i-1)||f.push([r+h,i-1]));else for(d=n.getNeighbors(e,LO.Always),m=0,v=d.length;m<v;++m)g=d[m],f.push([g.x,g.y]);return f};var NO=Fn,s_=Xa,kO=Ze;function Ln(e){s_.call(this,e)}Ln.prototype=new s_;Ln.prototype.constructor=Ln;Ln.prototype._jump=function(e,t,r,i){var n=this.grid,o=e-r,l=t-i;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0&&l!==0){if(this._jump(e+o,t,e,t)||this._jump(e,t+l,e,t))return[e,t]}else if(o!==0){if(n.isWalkableAt(e,t-1)&&!n.isWalkableAt(e-o,t-1)||n.isWalkableAt(e,t+1)&&!n.isWalkableAt(e-o,t+1))return[e,t]}else if(l!==0&&(n.isWalkableAt(e-1,t)&&!n.isWalkableAt(e-1,t-l)||n.isWalkableAt(e+1,t)&&!n.isWalkableAt(e+1,t-l)))return[e,t];return n.isWalkableAt(e+o,t)&&n.isWalkableAt(e,t+l)?this._jump(e+o,t+l,e,t):null};Ln.prototype._findNeighbors=function(e){var t=e.parent,r=e.x,i=e.y,n=this.grid,o,l,h,u,f=[],d,g,m,v;if(t)if(o=t.x,l=t.y,h=(r-o)/Math.max(Math.abs(r-o),1),u=(i-l)/Math.max(Math.abs(i-l),1),h!==0&&u!==0)n.isWalkableAt(r,i+u)&&f.push([r,i+u]),n.isWalkableAt(r+h,i)&&f.push([r+h,i]),n.isWalkableAt(r,i+u)&&n.isWalkableAt(r+h,i)&&f.push([r+h,i+u]);else{var y;if(h!==0){y=n.isWalkableAt(r+h,i);var w=n.isWalkableAt(r,i+1),x=n.isWalkableAt(r,i-1);y&&(f.push([r+h,i]),w&&f.push([r+h,i+1]),x&&f.push([r+h,i-1])),w&&f.push([r,i+1]),x&&f.push([r,i-1])}else if(u!==0){y=n.isWalkableAt(r,i+u);var A=n.isWalkableAt(r+1,i),S=n.isWalkableAt(r-1,i);y&&(f.push([r,i+u]),A&&f.push([r+1,i+u]),S&&f.push([r-1,i+u])),A&&f.push([r+1,i]),S&&f.push([r-1,i])}}else for(d=n.getNeighbors(e,kO.OnlyWhenNoObstacles),m=0,v=d.length;m<v;++m)g=d[m],f.push([g.x,g.y]);return f};var UO=Ln,o_=Xa,GO=Ze;function Nn(e){o_.call(this,e)}Nn.prototype=new o_;Nn.prototype.constructor=Nn;Nn.prototype._jump=function(e,t,r,i){var n=this.grid,o=e-r,l=t-i;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0&&l!==0){if(n.isWalkableAt(e-o,t+l)&&!n.isWalkableAt(e-o,t)||n.isWalkableAt(e+o,t-l)&&!n.isWalkableAt(e,t-l))return[e,t];if(this._jump(e+o,t,e,t)||this._jump(e,t+l,e,t))return[e,t]}else if(o!==0){if(n.isWalkableAt(e+o,t+1)&&!n.isWalkableAt(e,t+1)||n.isWalkableAt(e+o,t-1)&&!n.isWalkableAt(e,t-1))return[e,t]}else if(n.isWalkableAt(e+1,t+l)&&!n.isWalkableAt(e+1,t)||n.isWalkableAt(e-1,t+l)&&!n.isWalkableAt(e-1,t))return[e,t];return n.isWalkableAt(e+o,t)||n.isWalkableAt(e,t+l)?this._jump(e+o,t+l,e,t):null};Nn.prototype._findNeighbors=function(e){var t=e.parent,r=e.x,i=e.y,n=this.grid,o,l,h,u,f=[],d,g,m,v;if(t)o=t.x,l=t.y,h=(r-o)/Math.max(Math.abs(r-o),1),u=(i-l)/Math.max(Math.abs(i-l),1),h!==0&&u!==0?(n.isWalkableAt(r,i+u)&&f.push([r,i+u]),n.isWalkableAt(r+h,i)&&f.push([r+h,i]),(n.isWalkableAt(r,i+u)||n.isWalkableAt(r+h,i))&&f.push([r+h,i+u]),!n.isWalkableAt(r-h,i)&&n.isWalkableAt(r,i+u)&&f.push([r-h,i+u]),!n.isWalkableAt(r,i-u)&&n.isWalkableAt(r+h,i)&&f.push([r+h,i-u])):h===0?n.isWalkableAt(r,i+u)&&(f.push([r,i+u]),n.isWalkableAt(r+1,i)||f.push([r+1,i+u]),n.isWalkableAt(r-1,i)||f.push([r-1,i+u])):n.isWalkableAt(r+h,i)&&(f.push([r+h,i]),n.isWalkableAt(r,i+1)||f.push([r+h,i+1]),n.isWalkableAt(r,i-1)||f.push([r+h,i-1]));else for(d=n.getNeighbors(e,GO.IfAtMostOneObstacle),m=0,v=d.length;m<v;++m)g=d[m],f.push([g.x,g.y]);return f};var WO=Nn,tu=Ze,$O=FO,HO=NO,XO=UO,zO=WO;function VO(e){return e=e||{},e.diagonalMovement===tu.Never?new $O(e):e.diagonalMovement===tu.Always?new HO(e):e.diagonalMovement===tu.OnlyWhenNoObstacles?new XO(e):new zO(e)}var jO=VO,YO={Heap:Ha,Node:xc,Grid:vO,Util:Ge,DiagonalMovement:Ze,Heuristic:Ns,AStarFinder:wc,BestFirstFinder:AO,BreadthFirstFinder:CO,DijkstraFinder:IO,BiAStarFinder:Ec,BiBestFirstFinder:PO,BiBreadthFirstFinder:RO,BiDijkstraFinder:MO,IDAStarFinder:DO,JumpPointFinder:jO},qO=YO;const $g=Ba(qO),KO=St.with("position"),ZO=(e,t)=>{const{width:r,height:i}=lr().views.map,n=new $g.Grid(r,i);for(const h of KO)if(h.blocking&&!h.pathThrough){const{x:u,y:f}=h.position;n.setWalkableAt(u,f,!1)}return n.setWalkableAt(e.x,e.y,!0),n.setWalkableAt(t.x,t.y,!0),new $g.AStarFinder({}).findPath(e.x,e.y,t.x,t.y,n)},JO=St.with("pc","position"),QO=St.with("ai","position"),tF=()=>{const[e]=JO.entities;for(const t of QO){const r=ZO(t.position,e.position);if(r[1]){const i={x:r[1][0],y:r[1][1],z:t.position.z};St.addComponent(t,"tryMove",i)}}},ks=e=>`${e.x},${e.y},${e.z}`,Hg=(e,t)=>{const{x:r,y:i,z:n,width:o,height:l,hasWalls:h}=e,u={},f=r,d=r+o,g=i,m=i+l;if(h)for(let y=g+1;y<m-1;y++)for(let w=f+1;w<d-1;w++)u[`${w},${y},${n}`]={x:w,y,z:n,...t};else for(let y=g;y<m;y++)for(let w=f;w<d;w++)u[`${w},${y},${n}`]={x:w,y,z:n,...t};const v={x:Math.round((f+d)/2),y:Math.round((g+m)/2),z:n};return{x1:f,x2:d,y1:g,y2:m,z:n,center:v,hasWalls:h,tiles:u,width:o,height:l}},eF=(e,t)=>e.x1<=t.x2&&e.x2>=t.x1&&e.y1<=t.y2&&e.y2>=t.y1,rF=[{xx:1,xy:0,yx:0,yy:1},{xx:1,xy:0,yx:0,yy:-1},{xx:-1,xy:0,yx:0,yy:1},{xx:-1,xy:0,yx:0,yy:-1},{xx:0,xy:1,yx:1,yy:0},{xx:0,xy:1,yx:-1,yy:0},{xx:0,xy:-1,yx:1,yy:0},{xx:0,xy:-1,yx:-1,yy:0}];function iF(e,t,r,i,n){const{x:o,y:l,z:h}=i,u=new Set,f=new Set;for(const v of e)v.position.z===h&&f.add(ks(v.position));const d=(v,y)=>{const w=`${v},${y},${h}`;return!!f.has(w)},g=(v,y)=>u.add(`${v},${y},${h}`);function m(v,y,w,x,A,S,E){let I=0;if(x<A)return;let D=!1;for(let L=w;L<E&&!D;L++){let O=-L;for(let F=-L;F<=0;F++){let X=v+F*S.xx+O*S.xy,Y=y+F*S.yx+O*S.yy,z=(F-.5)/(O+.5),K=(F+.5)/(O-.5);if(!(!(X>=0&&Y>=0&&X<t&&Y<r)||x<K)){if(A>z)break;if(Math.sqrt(F*F+O*O)<=E&&g(X,Y),D)if(d(X,Y)){I=K;continue}else D=!1,x=I;else d(X,Y)&&L<E&&(D=!0,m(v,y,L+1,x,z,S,E),I=K)}}}}g(o,l);for(let v of rF)m(o,l,1,1,0,v,n);return{fov:u}}const nF=St.with("inFov","position"),sF=St.with("opaque","position"),oF=St.with("pc","position"),aF=St.with("appearance","position"),qu=()=>{let e;for(const r of oF)e=r;if(!e)return;const t=iF(sF,74,39,e.position,10);for(const r of nF)St.removeComponent(r,"inFov");for(const r of aF)t.fov.has(ks(r.position))&&(St.addComponent(r,"inFov",!0),St.addComponent(r,"revealed",!0))},lF=St.with("position","tryMove"),hF=St.with("blocking","position"),Xg=()=>{for(const e of lF){const{position:t,tryMove:r}=e;let i=!1;for(const n of hF)if(n.position.x===r.x&&n.position.y===r.y){St.removeComponent(e,"tryMove"),n.health?(n.health.current-=5,console.log(`${n.name} attacked by ${e.name} for 5hp`)):console.log(`${e.name} blocked by ${n.name}`),i=!0;break}i||(t.x=r.x,t.y=r.y,t.z=r.z,St.removeComponent(e,"tryMove"))}},eu=St.with("position","appearance","layer100"),ru=St.with("position","appearance","layer200"),iu=St.with("position","appearance","layer300"),nu=St.with("position","appearance","layer400"),qe=(e,t,r)=>{const{appearance:i,position:n}=t;if(!i||!n)return;const{char:o,tint:l,tileSet:h}=i,{x:u,y:f}=n;e==null||e.updateCell({0:{char:o,tint:65280,alpha:0,tileSet:"tile",x:u,y:f},1:{char:o,tint:l,alpha:r,tileSet:h,x:u,y:f}})},Ku=()=>{const e=lr().views.map;if(e){for(const t of eu)t.inFov&&qe(e,t,1);for(const t of ru)t.inFov&&qe(e,t,1);for(const t of iu)t.inFov&&qe(e,t,1);for(const t of nu)t.inFov&&qe(e,t,1);for(const t of eu)!t.inFov&&t.revealed&&qe(e,t,.35);for(const t of ru)!t.inFov&&t.revealed&&qe(e,t,.35);for(const t of iu)!t.inFov&&t.revealed&&qe(e,t,.35);for(const t of nu)!t.inFov&&t.revealed&&qe(e,t,.35);if(window.skulltooth.debug){for(const t of eu)qe(e,t,1);for(const t of ru)qe(e,t,1);for(const t of iu)qe(e,t,1);for(const t of nu)qe(e,t,1)}}},uF=["ArrowLeft","ArrowDown","ArrowUp","ArrowRight","h","j","k","l"],cF=St.with("pc"),fF=()=>{const{userInput:e,gameState:t}=lr();if(!e)return ci(i=>{i.userInput=null});const{key:r}=e;if(t===Ac.GAME&&uF.includes(r)){for(const i of cF)if(i!=null&&i.position){const{x:n,y:o,z:l}=i.position;if(r==="h"||r==="ArrowLeft"){const h={x:n-1,y:o,z:l};St.addComponent(i,"tryMove",h)}if(r==="j"||r==="ArrowDown"){const h={x:n,y:o+1,z:l};St.addComponent(i,"tryMove",h)}if(r==="k"||r==="ArrowUp"){const h={x:n,y:o-1,z:l};St.addComponent(i,"tryMove",h)}if(r==="l"||r==="ArrowRight"){const h={x:n+1,y:o,z:l};St.addComponent(i,"tryMove",h)}}}ci(i=>{i.userInput=null})};var $n=(e=>(e.default="?",e.floor="•",e.owlbear="F",e.player="@",e.potion="!",e.rat="r",e.rock="*",e.wall="#",e))($n||{}),Hn=(e=>(e[e.default=65399]="default",e[e.floor=3355443]="floor",e[e.owlbear=11027200]="owlbear",e[e.player=16777215]="player",e[e.potion=14329120]="potion",e[e.rat=14047863]="rat",e[e.rock=8355711]="rock",e[e.wall=8421504]="wall",e))(Hn||{});const za={appearance:{char:$n.default,tint:Hn.default,tileSet:"ascii"},position:{x:0,y:0,z:0},name:"default"},a_={layer100:!0},l_={health:{max:1,current:1},blocking:!0,layer300:!0},dF={...za,...l_,appearance:{char:$n.player,tint:Hn.player,tileSet:"ascii"},health:{max:10,current:10},name:"player",pc:!0},pF={...za,...a_,appearance:{char:$n.wall,tint:Hn.wall,tileSet:"ascii"},blocking:!0,opaque:!0,name:"wall"},gF={...za,...a_,appearance:{char:$n.floor,tint:Hn.floor,tileSet:"ascii"},name:"floor"},mF={...za,...l_,ai:!0,pathThrough:!0,appearance:{char:$n.rat,tint:Hn.rat,tileSet:"ascii"},health:{max:1,current:1},name:"rat"};function vF(e,t){const r={},i=Math.min(e.x,t.x),n=Math.max(e.x,t.x)+1;let o=i;for(;o<n;){const l={...t,x:o};r[ks(l)]={...l,sprite:"FLOOR"},o++}return r}function _F(e,t){const r={},i=Math.min(e.y,t.y),n=Math.max(e.y,t.y)+1;let o=i;for(;o<n;){const l={...e,y:o};r[ks(l)]={...l,sprite:"FLOOR"},o++}return r}const yF=e=>{const{pos:t,width:r,height:i,minRoomSize:n=6,maxRoomSize:o=12,maxRoomCount:l=30}=e,{x:h,y:u,z:f}=t,d={...Hg({x:h,y:u,z:f,width:r,height:i,hasWalls:!1},{sprite:"WALL"}),rooms:[]};let g={};Cr.times(l,()=>{let y=Cr.random(n,o),w=Cr.random(n,o),x=Cr.random(h,r+h-y-1),A=Cr.random(u,i+u-w-1);const S=Hg({x,y:A,z:f,width:y,height:w,hasWalls:!0},{sprite:"FLOOR"});d.rooms.some(E=>eF(E,S))||(d.rooms.push(S),g={...g,...S.tiles})});let m=null,v={};for(let y of d.rooms)m&&(v={...v,...vF(y.center,m.center),..._F(y.center,m.center)}),m=y;return d.tiles={...d.tiles,...g,...v},d},xF=()=>{const e=yF({pos:{x:0,y:0,z:0},width:74,height:39,minRoomSize:8,maxRoomSize:18,maxRoomCount:100}),t=Object.values(e.tiles);for(const r of t){if(r.sprite==="WALL"){const{x:i,y:n,z:o}=r;St.add({...Cr.cloneDeep(pF),position:{x:i,y:n,z:o}})}if(r.sprite==="FLOOR"){const{x:i,y:n,z:o}=r;St.add({...Cr.cloneDeep(gF),position:{x:i,y:n,z:o}})}}return e.rooms.forEach((r,i)=>{i&&St.add({...Cr.cloneDeep(mF),position:r.center})}),e},bF=e=>{console.log(JSON.parse(JSON.stringify(e)))},wF=St.with("health").without("dead"),zg=()=>{for(const e of wF)e.health.current<=0&&(e.appearance&&(e.appearance.char="%"),St.removeComponent(e,"ai"),St.removeComponent(e,"blocking"),St.addComponent(e,"dead",!0),console.log(`${e.name} has died!`),e.pc&&(ci(t=>t.gameState=Ac.GAME_OVER),console.log("Game Over!")))};var Ac=(e=>(e.GAME="GAME",e.GAME_OVER="GAME_OVER",e.INVENTORY="INVENTORY",e.INSPECT="INSPECT",e.TARGET="TARGET",e))(Ac||{});window.skulltooth=window.skulltooth||{};window.skulltooth.debug=!1;const Ms={fps:0,views:{},userInput:null,turn:"PLAYER",gameState:"GAME"};window.skulltooth.state=Ms;const ci=e=>{e(Ms)},lr=()=>Ms,EF=async()=>{await DB(document.querySelector("#canvas")),new br({width:12,height:2,x:0,y:0,layers:2,tileSets:["tile","text"],tints:[16777215,16711799],alphas:[1,1],visible:!0}).updateRows([[{},{string:"skulltooth 2"}],[{tint:16711799},{string:"forcecrusher",tint:16777215}]]);const e=new br({width:25,height:42,x:0,y:2,layers:1,tileSets:["text"],tints:[16711799],alphas:[1],visible:!0}),t=new br({width:74,height:5,x:26,y:0,layers:1,tileSets:["text"],tints:[15658734],alphas:[1],visible:!0}),r=new br({width:74,height:5,x:100,y:0,layers:1,tileSets:["text"],tints:[16711799],alphas:[1],visible:!0}),i=new br({width:74,height:39,x:13,y:5,layers:3,tileSets:["tile","ascii","tile"],tints:[0,0,0],alphas:[1,1,0],visible:!0}),n=new br({width:12,height:1,x:0,y:44,layers:1,tileSets:["text"],tints:[14540253],alphas:[1],visible:!0}).updateRows([[{string:"FPS: calc..."}]]);new br({width:12,height:1,x:0,y:45,layers:1,tileSets:["text"],tints:[16777215],alphas:[1],visible:!0}).updateRows([[{string:"TAG: 2767a83"}]]);const o=new br({width:148,height:2,x:26,y:44,layers:1,tileSets:["text"],tints:[15658734],alphas:[1],visible:!0}),l=new br({width:100,height:44,x:0,y:0,layers:1,tileSets:["tile"],tints:[1118481],alphas:[.75],visible:!1}),h=new br({width:148,height:39,x:26,y:5,layers:2,tileSets:["text","text"],tints:[1118481,16777215],alphas:[1],visible:!1});ci(g=>{g.views.fps=n,g.views.map=i,g.views.log=t,g.views.senses=r,g.views.legend=e,g.views.inventory=h,g.views.menuUnderlay=l,g.views.controls=o});const f=xF().rooms[0].center,d=St.add(dF);d.position.x=f.x,d.position.y=f.y,d.position.z=f.z,qu(),Ku(),h_(),document.addEventListener("keydown",g=>{ci(m=>{m.userInput=g})}),document.addEventListener("mousedown",g=>{const m=g.x-Ms.views.map.layers[0].x,v=g.layerY-Ms.views.map.layers[0].y,w=MB(m,v,0);if(window.skulltooth.debug===!0){const x=St.with("position");for(const A of x)w===ks(A.position)&&(console.log(w),bF(A))}})};let su=0,ra=Date.now(),ia=[];function h_(){var e;requestAnimationFrame(h_),lr().gameState==="GAME"&&(lr().userInput&&lr().turn==="PLAYER"&&(fF(),Xg(),zg(),qu(),Ku(),lr().gameState==="GAME"&&ci(t=>{t.turn="WORLD"})),lr().turn==="WORLD"&&(tF(),Xg(),zg(),qu(),Ku(),ci(t=>{t.turn="PLAYER"}))),ra||(ra=Date.now()),Date.now()-ra>1e3&&(ia.unshift(su),ia.length>3&&ia.pop(),isNaN(lr().fps)||(e=lr().views.fps)==null||e.updateRow({string:`FPS: ${lr().fps}     `,layer:0,x:0,y:0,tileSet:"text"}),ra=Date.now(),su=0),ci(t=>t.fps=Math.round(Cr.mean(ia))),su++}EF();
