var pT=Object.defineProperty;var gT=(e,t,r)=>t in e?pT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var zt=(e,t,r)=>(gT(e,typeof t!="symbol"?t+"":t,r),r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();var Dr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ha(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function mT(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),r}var wa={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */wa.exports;(function(e,t){(function(){var r,n="4.17.21",i=200,o="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",h="Invalid `variable` option passed into `_.template`",u="__lodash_hash_undefined__",f=500,d="__lodash_placeholder__",p=1,g=2,v=4,y=1,w=2,x=1,T=2,S=4,E=8,I=16,D=32,L=64,O=128,F=256,X=512,q=30,V="...",Z=800,$=16,k=1,lt=2,pt=3,j=1/0,_t=9007199254740991,Ft=17976931348623157e292,H=NaN,nt=4294967295,wt=nt-1,Rt=nt>>>1,Dt=[["ary",O],["bind",x],["bindKey",T],["curry",E],["curryRight",I],["flip",X],["partial",D],["partialRight",L],["rearg",F]],Gt="[object Arguments]",$t="[object Array]",oe="[object AsyncFunction]",Zt="[object Boolean]",ae="[object Date]",he="[object DOMException]",Bt="[object Error]",Wt="[object Function]",Jt="[object GeneratorFunction]",Qt="[object Map]",we="[object Number]",Sn="[object Null]",Er="[object Object]",Nc="[object Promise]",Dy="[object Proxy]",Ji="[object RegExp]",ir="[object Set]",Qi="[object String]",Vs="[object Symbol]",By="[object Undefined]",ts="[object WeakMap]",Oy="[object WeakSet]",es="[object ArrayBuffer]",ri="[object DataView]",rl="[object Float32Array]",nl="[object Float64Array]",il="[object Int8Array]",sl="[object Int16Array]",ol="[object Int32Array]",al="[object Uint8Array]",ll="[object Uint8ClampedArray]",hl="[object Uint16Array]",ul="[object Uint32Array]",Fy=/\b__p \+= '';/g,Ly=/\b(__p \+=) '' \+/g,Ny=/(__e\(.*?\)|\b__t\)) \+\n'';/g,kc=/&(?:amp|lt|gt|quot|#39);/g,Uc=/[&<>"']/g,ky=RegExp(kc.source),Uy=RegExp(Uc.source),Gy=/<%-([\s\S]+?)%>/g,$y=/<%([\s\S]+?)%>/g,Gc=/<%=([\s\S]+?)%>/g,Wy=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hy=/^\w*$/,zy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,cl=/[\\^$.*+?()[\]{}|]/g,Xy=RegExp(cl.source),fl=/^\s+/,Vy=/\s/,Yy=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,jy=/\{\n\/\* \[wrapped with (.+)\] \*/,qy=/,? & /,Ky=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Zy=/[()=,{}\[\]\/\s]/,Jy=/\\(\\)?/g,Qy=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,$c=/\w*$/,t_=/^[-+]0x[0-9a-f]+$/i,e_=/^0b[01]+$/i,r_=/^\[object .+?Constructor\]$/,n_=/^0o[0-7]+$/i,i_=/^(?:0|[1-9]\d*)$/,s_=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ys=/($^)/,o_=/['\n\r\u2028\u2029\\]/g,js="\\ud800-\\udfff",a_="\\u0300-\\u036f",l_="\\ufe20-\\ufe2f",h_="\\u20d0-\\u20ff",Wc=a_+l_+h_,Hc="\\u2700-\\u27bf",zc="a-z\\xdf-\\xf6\\xf8-\\xff",u_="\\xac\\xb1\\xd7\\xf7",c_="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",f_="\\u2000-\\u206f",d_=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Xc="A-Z\\xc0-\\xd6\\xd8-\\xde",Vc="\\ufe0e\\ufe0f",Yc=u_+c_+f_+d_,dl="['’]",p_="["+js+"]",jc="["+Yc+"]",qs="["+Wc+"]",qc="\\d+",g_="["+Hc+"]",Kc="["+zc+"]",Zc="[^"+js+Yc+qc+Hc+zc+Xc+"]",pl="\\ud83c[\\udffb-\\udfff]",m_="(?:"+qs+"|"+pl+")",Jc="[^"+js+"]",gl="(?:\\ud83c[\\udde6-\\uddff]){2}",ml="[\\ud800-\\udbff][\\udc00-\\udfff]",ni="["+Xc+"]",Qc="\\u200d",tf="(?:"+Kc+"|"+Zc+")",v_="(?:"+ni+"|"+Zc+")",ef="(?:"+dl+"(?:d|ll|m|re|s|t|ve))?",rf="(?:"+dl+"(?:D|LL|M|RE|S|T|VE))?",nf=m_+"?",sf="["+Vc+"]?",y_="(?:"+Qc+"(?:"+[Jc,gl,ml].join("|")+")"+sf+nf+")*",__="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",x_="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",of=sf+nf+y_,b_="(?:"+[g_,gl,ml].join("|")+")"+of,w_="(?:"+[Jc+qs+"?",qs,gl,ml,p_].join("|")+")",E_=RegExp(dl,"g"),T_=RegExp(qs,"g"),vl=RegExp(pl+"(?="+pl+")|"+w_+of,"g"),A_=RegExp([ni+"?"+Kc+"+"+ef+"(?="+[jc,ni,"$"].join("|")+")",v_+"+"+rf+"(?="+[jc,ni+tf,"$"].join("|")+")",ni+"?"+tf+"+"+ef,ni+"+"+rf,x_,__,qc,b_].join("|"),"g"),S_=RegExp("["+Qc+js+Wc+Vc+"]"),C_=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,I_=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],P_=-1,Ht={};Ht[rl]=Ht[nl]=Ht[il]=Ht[sl]=Ht[ol]=Ht[al]=Ht[ll]=Ht[hl]=Ht[ul]=!0,Ht[Gt]=Ht[$t]=Ht[es]=Ht[Zt]=Ht[ri]=Ht[ae]=Ht[Bt]=Ht[Wt]=Ht[Qt]=Ht[we]=Ht[Er]=Ht[Ji]=Ht[ir]=Ht[Qi]=Ht[ts]=!1;var Nt={};Nt[Gt]=Nt[$t]=Nt[es]=Nt[ri]=Nt[Zt]=Nt[ae]=Nt[rl]=Nt[nl]=Nt[il]=Nt[sl]=Nt[ol]=Nt[Qt]=Nt[we]=Nt[Er]=Nt[Ji]=Nt[ir]=Nt[Qi]=Nt[Vs]=Nt[al]=Nt[ll]=Nt[hl]=Nt[ul]=!0,Nt[Bt]=Nt[Wt]=Nt[ts]=!1;var R_={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},M_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},D_={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},B_={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},O_=parseFloat,F_=parseInt,af=typeof Dr=="object"&&Dr&&Dr.Object===Object&&Dr,L_=typeof self=="object"&&self&&self.Object===Object&&self,ve=af||L_||Function("return this")(),yl=t&&!t.nodeType&&t,Cn=yl&&!0&&e&&!e.nodeType&&e,lf=Cn&&Cn.exports===yl,_l=lf&&af.process,Ye=function(){try{var R=Cn&&Cn.require&&Cn.require("util").types;return R||_l&&_l.binding&&_l.binding("util")}catch{}}(),hf=Ye&&Ye.isArrayBuffer,uf=Ye&&Ye.isDate,cf=Ye&&Ye.isMap,ff=Ye&&Ye.isRegExp,df=Ye&&Ye.isSet,pf=Ye&&Ye.isTypedArray;function Ne(R,N,B){switch(B.length){case 0:return R.call(N);case 1:return R.call(N,B[0]);case 2:return R.call(N,B[0],B[1]);case 3:return R.call(N,B[0],B[1],B[2])}return R.apply(N,B)}function N_(R,N,B,tt){for(var dt=-1,Pt=R==null?0:R.length;++dt<Pt;){var ue=R[dt];N(tt,ue,B(ue),R)}return tt}function je(R,N){for(var B=-1,tt=R==null?0:R.length;++B<tt&&N(R[B],B,R)!==!1;);return R}function k_(R,N){for(var B=R==null?0:R.length;B--&&N(R[B],B,R)!==!1;);return R}function gf(R,N){for(var B=-1,tt=R==null?0:R.length;++B<tt;)if(!N(R[B],B,R))return!1;return!0}function nn(R,N){for(var B=-1,tt=R==null?0:R.length,dt=0,Pt=[];++B<tt;){var ue=R[B];N(ue,B,R)&&(Pt[dt++]=ue)}return Pt}function Ks(R,N){var B=R==null?0:R.length;return!!B&&ii(R,N,0)>-1}function xl(R,N,B){for(var tt=-1,dt=R==null?0:R.length;++tt<dt;)if(B(N,R[tt]))return!0;return!1}function Xt(R,N){for(var B=-1,tt=R==null?0:R.length,dt=Array(tt);++B<tt;)dt[B]=N(R[B],B,R);return dt}function sn(R,N){for(var B=-1,tt=N.length,dt=R.length;++B<tt;)R[dt+B]=N[B];return R}function bl(R,N,B,tt){var dt=-1,Pt=R==null?0:R.length;for(tt&&Pt&&(B=R[++dt]);++dt<Pt;)B=N(B,R[dt],dt,R);return B}function U_(R,N,B,tt){var dt=R==null?0:R.length;for(tt&&dt&&(B=R[--dt]);dt--;)B=N(B,R[dt],dt,R);return B}function wl(R,N){for(var B=-1,tt=R==null?0:R.length;++B<tt;)if(N(R[B],B,R))return!0;return!1}var G_=El("length");function $_(R){return R.split("")}function W_(R){return R.match(Ky)||[]}function mf(R,N,B){var tt;return B(R,function(dt,Pt,ue){if(N(dt,Pt,ue))return tt=Pt,!1}),tt}function Zs(R,N,B,tt){for(var dt=R.length,Pt=B+(tt?1:-1);tt?Pt--:++Pt<dt;)if(N(R[Pt],Pt,R))return Pt;return-1}function ii(R,N,B){return N===N?t0(R,N,B):Zs(R,vf,B)}function H_(R,N,B,tt){for(var dt=B-1,Pt=R.length;++dt<Pt;)if(tt(R[dt],N))return dt;return-1}function vf(R){return R!==R}function yf(R,N){var B=R==null?0:R.length;return B?Al(R,N)/B:H}function El(R){return function(N){return N==null?r:N[R]}}function Tl(R){return function(N){return R==null?r:R[N]}}function _f(R,N,B,tt,dt){return dt(R,function(Pt,ue,Lt){B=tt?(tt=!1,Pt):N(B,Pt,ue,Lt)}),B}function z_(R,N){var B=R.length;for(R.sort(N);B--;)R[B]=R[B].value;return R}function Al(R,N){for(var B,tt=-1,dt=R.length;++tt<dt;){var Pt=N(R[tt]);Pt!==r&&(B=B===r?Pt:B+Pt)}return B}function Sl(R,N){for(var B=-1,tt=Array(R);++B<R;)tt[B]=N(B);return tt}function X_(R,N){return Xt(N,function(B){return[B,R[B]]})}function xf(R){return R&&R.slice(0,Tf(R)+1).replace(fl,"")}function ke(R){return function(N){return R(N)}}function Cl(R,N){return Xt(N,function(B){return R[B]})}function rs(R,N){return R.has(N)}function bf(R,N){for(var B=-1,tt=R.length;++B<tt&&ii(N,R[B],0)>-1;);return B}function wf(R,N){for(var B=R.length;B--&&ii(N,R[B],0)>-1;);return B}function V_(R,N){for(var B=R.length,tt=0;B--;)R[B]===N&&++tt;return tt}var Y_=Tl(R_),j_=Tl(M_);function q_(R){return"\\"+B_[R]}function K_(R,N){return R==null?r:R[N]}function si(R){return S_.test(R)}function Z_(R){return C_.test(R)}function J_(R){for(var N,B=[];!(N=R.next()).done;)B.push(N.value);return B}function Il(R){var N=-1,B=Array(R.size);return R.forEach(function(tt,dt){B[++N]=[dt,tt]}),B}function Ef(R,N){return function(B){return R(N(B))}}function on(R,N){for(var B=-1,tt=R.length,dt=0,Pt=[];++B<tt;){var ue=R[B];(ue===N||ue===d)&&(R[B]=d,Pt[dt++]=B)}return Pt}function Js(R){var N=-1,B=Array(R.size);return R.forEach(function(tt){B[++N]=tt}),B}function Q_(R){var N=-1,B=Array(R.size);return R.forEach(function(tt){B[++N]=[tt,tt]}),B}function t0(R,N,B){for(var tt=B-1,dt=R.length;++tt<dt;)if(R[tt]===N)return tt;return-1}function e0(R,N,B){for(var tt=B+1;tt--;)if(R[tt]===N)return tt;return tt}function oi(R){return si(R)?n0(R):G_(R)}function sr(R){return si(R)?i0(R):$_(R)}function Tf(R){for(var N=R.length;N--&&Vy.test(R.charAt(N)););return N}var r0=Tl(D_);function n0(R){for(var N=vl.lastIndex=0;vl.test(R);)++N;return N}function i0(R){return R.match(vl)||[]}function s0(R){return R.match(A_)||[]}var o0=function R(N){N=N==null?ve:ai.defaults(ve.Object(),N,ai.pick(ve,I_));var B=N.Array,tt=N.Date,dt=N.Error,Pt=N.Function,ue=N.Math,Lt=N.Object,Pl=N.RegExp,a0=N.String,qe=N.TypeError,Qs=B.prototype,l0=Pt.prototype,li=Lt.prototype,to=N["__core-js_shared__"],eo=l0.toString,Ot=li.hasOwnProperty,h0=0,Af=function(){var s=/[^.]+$/.exec(to&&to.keys&&to.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""}(),ro=li.toString,u0=eo.call(Lt),c0=ve._,f0=Pl("^"+eo.call(Ot).replace(cl,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),no=lf?N.Buffer:r,an=N.Symbol,io=N.Uint8Array,Sf=no?no.allocUnsafe:r,so=Ef(Lt.getPrototypeOf,Lt),Cf=Lt.create,If=li.propertyIsEnumerable,oo=Qs.splice,Pf=an?an.isConcatSpreadable:r,ns=an?an.iterator:r,In=an?an.toStringTag:r,ao=function(){try{var s=Bn(Lt,"defineProperty");return s({},"",{}),s}catch{}}(),d0=N.clearTimeout!==ve.clearTimeout&&N.clearTimeout,p0=tt&&tt.now!==ve.Date.now&&tt.now,g0=N.setTimeout!==ve.setTimeout&&N.setTimeout,lo=ue.ceil,ho=ue.floor,Rl=Lt.getOwnPropertySymbols,m0=no?no.isBuffer:r,Rf=N.isFinite,v0=Qs.join,y0=Ef(Lt.keys,Lt),ce=ue.max,Ee=ue.min,_0=tt.now,x0=N.parseInt,Mf=ue.random,b0=Qs.reverse,Ml=Bn(N,"DataView"),is=Bn(N,"Map"),Dl=Bn(N,"Promise"),hi=Bn(N,"Set"),ss=Bn(N,"WeakMap"),os=Bn(Lt,"create"),uo=ss&&new ss,ui={},w0=On(Ml),E0=On(is),T0=On(Dl),A0=On(hi),S0=On(ss),co=an?an.prototype:r,as=co?co.valueOf:r,Df=co?co.toString:r;function b(s){if(te(s)&&!gt(s)&&!(s instanceof Et)){if(s instanceof Ke)return s;if(Ot.call(s,"__wrapped__"))return Bd(s)}return new Ke(s)}var ci=function(){function s(){}return function(a){if(!Yt(a))return{};if(Cf)return Cf(a);s.prototype=a;var c=new s;return s.prototype=r,c}}();function fo(){}function Ke(s,a){this.__wrapped__=s,this.__actions__=[],this.__chain__=!!a,this.__index__=0,this.__values__=r}b.templateSettings={escape:Gy,evaluate:$y,interpolate:Gc,variable:"",imports:{_:b}},b.prototype=fo.prototype,b.prototype.constructor=b,Ke.prototype=ci(fo.prototype),Ke.prototype.constructor=Ke;function Et(s){this.__wrapped__=s,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=nt,this.__views__=[]}function C0(){var s=new Et(this.__wrapped__);return s.__actions__=Me(this.__actions__),s.__dir__=this.__dir__,s.__filtered__=this.__filtered__,s.__iteratees__=Me(this.__iteratees__),s.__takeCount__=this.__takeCount__,s.__views__=Me(this.__views__),s}function I0(){if(this.__filtered__){var s=new Et(this);s.__dir__=-1,s.__filtered__=!0}else s=this.clone(),s.__dir__*=-1;return s}function P0(){var s=this.__wrapped__.value(),a=this.__dir__,c=gt(s),m=a<0,_=c?s.length:0,A=$x(0,_,this.__views__),C=A.start,P=A.end,M=P-C,U=m?P:C-1,G=this.__iteratees__,W=G.length,K=0,et=Ee(M,this.__takeCount__);if(!c||!m&&_==M&&et==M)return rd(s,this.__actions__);var ht=[];t:for(;M--&&K<et;){U+=a;for(var yt=-1,ut=s[U];++yt<W;){var bt=G[yt],St=bt.iteratee,$e=bt.type,Ie=St(ut);if($e==lt)ut=Ie;else if(!Ie){if($e==k)continue t;break t}}ht[K++]=ut}return ht}Et.prototype=ci(fo.prototype),Et.prototype.constructor=Et;function Pn(s){var a=-1,c=s==null?0:s.length;for(this.clear();++a<c;){var m=s[a];this.set(m[0],m[1])}}function R0(){this.__data__=os?os(null):{},this.size=0}function M0(s){var a=this.has(s)&&delete this.__data__[s];return this.size-=a?1:0,a}function D0(s){var a=this.__data__;if(os){var c=a[s];return c===u?r:c}return Ot.call(a,s)?a[s]:r}function B0(s){var a=this.__data__;return os?a[s]!==r:Ot.call(a,s)}function O0(s,a){var c=this.__data__;return this.size+=this.has(s)?0:1,c[s]=os&&a===r?u:a,this}Pn.prototype.clear=R0,Pn.prototype.delete=M0,Pn.prototype.get=D0,Pn.prototype.has=B0,Pn.prototype.set=O0;function $r(s){var a=-1,c=s==null?0:s.length;for(this.clear();++a<c;){var m=s[a];this.set(m[0],m[1])}}function F0(){this.__data__=[],this.size=0}function L0(s){var a=this.__data__,c=po(a,s);if(c<0)return!1;var m=a.length-1;return c==m?a.pop():oo.call(a,c,1),--this.size,!0}function N0(s){var a=this.__data__,c=po(a,s);return c<0?r:a[c][1]}function k0(s){return po(this.__data__,s)>-1}function U0(s,a){var c=this.__data__,m=po(c,s);return m<0?(++this.size,c.push([s,a])):c[m][1]=a,this}$r.prototype.clear=F0,$r.prototype.delete=L0,$r.prototype.get=N0,$r.prototype.has=k0,$r.prototype.set=U0;function Wr(s){var a=-1,c=s==null?0:s.length;for(this.clear();++a<c;){var m=s[a];this.set(m[0],m[1])}}function G0(){this.size=0,this.__data__={hash:new Pn,map:new(is||$r),string:new Pn}}function $0(s){var a=So(this,s).delete(s);return this.size-=a?1:0,a}function W0(s){return So(this,s).get(s)}function H0(s){return So(this,s).has(s)}function z0(s,a){var c=So(this,s),m=c.size;return c.set(s,a),this.size+=c.size==m?0:1,this}Wr.prototype.clear=G0,Wr.prototype.delete=$0,Wr.prototype.get=W0,Wr.prototype.has=H0,Wr.prototype.set=z0;function Rn(s){var a=-1,c=s==null?0:s.length;for(this.__data__=new Wr;++a<c;)this.add(s[a])}function X0(s){return this.__data__.set(s,u),this}function V0(s){return this.__data__.has(s)}Rn.prototype.add=Rn.prototype.push=X0,Rn.prototype.has=V0;function or(s){var a=this.__data__=new $r(s);this.size=a.size}function Y0(){this.__data__=new $r,this.size=0}function j0(s){var a=this.__data__,c=a.delete(s);return this.size=a.size,c}function q0(s){return this.__data__.get(s)}function K0(s){return this.__data__.has(s)}function Z0(s,a){var c=this.__data__;if(c instanceof $r){var m=c.__data__;if(!is||m.length<i-1)return m.push([s,a]),this.size=++c.size,this;c=this.__data__=new Wr(m)}return c.set(s,a),this.size=c.size,this}or.prototype.clear=Y0,or.prototype.delete=j0,or.prototype.get=q0,or.prototype.has=K0,or.prototype.set=Z0;function Bf(s,a){var c=gt(s),m=!c&&Fn(s),_=!c&&!m&&fn(s),A=!c&&!m&&!_&&gi(s),C=c||m||_||A,P=C?Sl(s.length,a0):[],M=P.length;for(var U in s)(a||Ot.call(s,U))&&!(C&&(U=="length"||_&&(U=="offset"||U=="parent")||A&&(U=="buffer"||U=="byteLength"||U=="byteOffset")||Vr(U,M)))&&P.push(U);return P}function Of(s){var a=s.length;return a?s[Hl(0,a-1)]:r}function J0(s,a){return Co(Me(s),Mn(a,0,s.length))}function Q0(s){return Co(Me(s))}function Bl(s,a,c){(c!==r&&!ar(s[a],c)||c===r&&!(a in s))&&Hr(s,a,c)}function ls(s,a,c){var m=s[a];(!(Ot.call(s,a)&&ar(m,c))||c===r&&!(a in s))&&Hr(s,a,c)}function po(s,a){for(var c=s.length;c--;)if(ar(s[c][0],a))return c;return-1}function tx(s,a,c,m){return ln(s,function(_,A,C){a(m,_,c(_),C)}),m}function Ff(s,a){return s&&Ar(a,pe(a),s)}function ex(s,a){return s&&Ar(a,Be(a),s)}function Hr(s,a,c){a=="__proto__"&&ao?ao(s,a,{configurable:!0,enumerable:!0,value:c,writable:!0}):s[a]=c}function Ol(s,a){for(var c=-1,m=a.length,_=B(m),A=s==null;++c<m;)_[c]=A?r:ph(s,a[c]);return _}function Mn(s,a,c){return s===s&&(c!==r&&(s=s<=c?s:c),a!==r&&(s=s>=a?s:a)),s}function Ze(s,a,c,m,_,A){var C,P=a&p,M=a&g,U=a&v;if(c&&(C=_?c(s,m,_,A):c(s)),C!==r)return C;if(!Yt(s))return s;var G=gt(s);if(G){if(C=Hx(s),!P)return Me(s,C)}else{var W=Te(s),K=W==Wt||W==Jt;if(fn(s))return sd(s,P);if(W==Er||W==Gt||K&&!_){if(C=M||K?{}:Td(s),!P)return M?Dx(s,ex(C,s)):Mx(s,Ff(C,s))}else{if(!Nt[W])return _?s:{};C=zx(s,W,P)}}A=new or;var et=A.get(s);if(et)return et;A.set(s,C),Qd(s)?s.forEach(function(ut){C.add(Ze(ut,a,c,ut,s,A))}):Zd(s)&&s.forEach(function(ut,bt){C.set(bt,Ze(ut,a,c,bt,s,A))});var ht=U?M?th:Ql:M?Be:pe,yt=G?r:ht(s);return je(yt||s,function(ut,bt){yt&&(bt=ut,ut=s[bt]),ls(C,bt,Ze(ut,a,c,bt,s,A))}),C}function rx(s){var a=pe(s);return function(c){return Lf(c,s,a)}}function Lf(s,a,c){var m=c.length;if(s==null)return!m;for(s=Lt(s);m--;){var _=c[m],A=a[_],C=s[_];if(C===r&&!(_ in s)||!A(C))return!1}return!0}function Nf(s,a,c){if(typeof s!="function")throw new qe(l);return gs(function(){s.apply(r,c)},a)}function hs(s,a,c,m){var _=-1,A=Ks,C=!0,P=s.length,M=[],U=a.length;if(!P)return M;c&&(a=Xt(a,ke(c))),m?(A=xl,C=!1):a.length>=i&&(A=rs,C=!1,a=new Rn(a));t:for(;++_<P;){var G=s[_],W=c==null?G:c(G);if(G=m||G!==0?G:0,C&&W===W){for(var K=U;K--;)if(a[K]===W)continue t;M.push(G)}else A(a,W,m)||M.push(G)}return M}var ln=ud(Tr),kf=ud(Ll,!0);function nx(s,a){var c=!0;return ln(s,function(m,_,A){return c=!!a(m,_,A),c}),c}function go(s,a,c){for(var m=-1,_=s.length;++m<_;){var A=s[m],C=a(A);if(C!=null&&(P===r?C===C&&!Ge(C):c(C,P)))var P=C,M=A}return M}function ix(s,a,c,m){var _=s.length;for(c=vt(c),c<0&&(c=-c>_?0:_+c),m=m===r||m>_?_:vt(m),m<0&&(m+=_),m=c>m?0:ep(m);c<m;)s[c++]=a;return s}function Uf(s,a){var c=[];return ln(s,function(m,_,A){a(m,_,A)&&c.push(m)}),c}function ye(s,a,c,m,_){var A=-1,C=s.length;for(c||(c=Vx),_=[];++A<C;){var P=s[A];a>0&&c(P)?a>1?ye(P,a-1,c,m,_):sn(_,P):m||(_[_.length]=P)}return _}var Fl=cd(),Gf=cd(!0);function Tr(s,a){return s&&Fl(s,a,pe)}function Ll(s,a){return s&&Gf(s,a,pe)}function mo(s,a){return nn(a,function(c){return Yr(s[c])})}function Dn(s,a){a=un(a,s);for(var c=0,m=a.length;s!=null&&c<m;)s=s[Sr(a[c++])];return c&&c==m?s:r}function $f(s,a,c){var m=a(s);return gt(s)?m:sn(m,c(s))}function Se(s){return s==null?s===r?By:Sn:In&&In in Lt(s)?Gx(s):Qx(s)}function Nl(s,a){return s>a}function sx(s,a){return s!=null&&Ot.call(s,a)}function ox(s,a){return s!=null&&a in Lt(s)}function ax(s,a,c){return s>=Ee(a,c)&&s<ce(a,c)}function kl(s,a,c){for(var m=c?xl:Ks,_=s[0].length,A=s.length,C=A,P=B(A),M=1/0,U=[];C--;){var G=s[C];C&&a&&(G=Xt(G,ke(a))),M=Ee(G.length,M),P[C]=!c&&(a||_>=120&&G.length>=120)?new Rn(C&&G):r}G=s[0];var W=-1,K=P[0];t:for(;++W<_&&U.length<M;){var et=G[W],ht=a?a(et):et;if(et=c||et!==0?et:0,!(K?rs(K,ht):m(U,ht,c))){for(C=A;--C;){var yt=P[C];if(!(yt?rs(yt,ht):m(s[C],ht,c)))continue t}K&&K.push(ht),U.push(et)}}return U}function lx(s,a,c,m){return Tr(s,function(_,A,C){a(m,c(_),A,C)}),m}function us(s,a,c){a=un(a,s),s=Id(s,a);var m=s==null?s:s[Sr(Qe(a))];return m==null?r:Ne(m,s,c)}function Wf(s){return te(s)&&Se(s)==Gt}function hx(s){return te(s)&&Se(s)==es}function ux(s){return te(s)&&Se(s)==ae}function cs(s,a,c,m,_){return s===a?!0:s==null||a==null||!te(s)&&!te(a)?s!==s&&a!==a:cx(s,a,c,m,cs,_)}function cx(s,a,c,m,_,A){var C=gt(s),P=gt(a),M=C?$t:Te(s),U=P?$t:Te(a);M=M==Gt?Er:M,U=U==Gt?Er:U;var G=M==Er,W=U==Er,K=M==U;if(K&&fn(s)){if(!fn(a))return!1;C=!0,G=!1}if(K&&!G)return A||(A=new or),C||gi(s)?bd(s,a,c,m,_,A):kx(s,a,M,c,m,_,A);if(!(c&y)){var et=G&&Ot.call(s,"__wrapped__"),ht=W&&Ot.call(a,"__wrapped__");if(et||ht){var yt=et?s.value():s,ut=ht?a.value():a;return A||(A=new or),_(yt,ut,c,m,A)}}return K?(A||(A=new or),Ux(s,a,c,m,_,A)):!1}function fx(s){return te(s)&&Te(s)==Qt}function Ul(s,a,c,m){var _=c.length,A=_,C=!m;if(s==null)return!A;for(s=Lt(s);_--;){var P=c[_];if(C&&P[2]?P[1]!==s[P[0]]:!(P[0]in s))return!1}for(;++_<A;){P=c[_];var M=P[0],U=s[M],G=P[1];if(C&&P[2]){if(U===r&&!(M in s))return!1}else{var W=new or;if(m)var K=m(U,G,M,s,a,W);if(!(K===r?cs(G,U,y|w,m,W):K))return!1}}return!0}function Hf(s){if(!Yt(s)||jx(s))return!1;var a=Yr(s)?f0:r_;return a.test(On(s))}function dx(s){return te(s)&&Se(s)==Ji}function px(s){return te(s)&&Te(s)==ir}function gx(s){return te(s)&&Bo(s.length)&&!!Ht[Se(s)]}function zf(s){return typeof s=="function"?s:s==null?Oe:typeof s=="object"?gt(s)?Yf(s[0],s[1]):Vf(s):fp(s)}function Gl(s){if(!ps(s))return y0(s);var a=[];for(var c in Lt(s))Ot.call(s,c)&&c!="constructor"&&a.push(c);return a}function mx(s){if(!Yt(s))return Jx(s);var a=ps(s),c=[];for(var m in s)m=="constructor"&&(a||!Ot.call(s,m))||c.push(m);return c}function $l(s,a){return s<a}function Xf(s,a){var c=-1,m=De(s)?B(s.length):[];return ln(s,function(_,A,C){m[++c]=a(_,A,C)}),m}function Vf(s){var a=rh(s);return a.length==1&&a[0][2]?Sd(a[0][0],a[0][1]):function(c){return c===s||Ul(c,s,a)}}function Yf(s,a){return ih(s)&&Ad(a)?Sd(Sr(s),a):function(c){var m=ph(c,s);return m===r&&m===a?gh(c,s):cs(a,m,y|w)}}function vo(s,a,c,m,_){s!==a&&Fl(a,function(A,C){if(_||(_=new or),Yt(A))vx(s,a,C,c,vo,m,_);else{var P=m?m(oh(s,C),A,C+"",s,a,_):r;P===r&&(P=A),Bl(s,C,P)}},Be)}function vx(s,a,c,m,_,A,C){var P=oh(s,c),M=oh(a,c),U=C.get(M);if(U){Bl(s,c,U);return}var G=A?A(P,M,c+"",s,a,C):r,W=G===r;if(W){var K=gt(M),et=!K&&fn(M),ht=!K&&!et&&gi(M);G=M,K||et||ht?gt(P)?G=P:re(P)?G=Me(P):et?(W=!1,G=sd(M,!0)):ht?(W=!1,G=od(M,!0)):G=[]:ms(M)||Fn(M)?(G=P,Fn(P)?G=rp(P):(!Yt(P)||Yr(P))&&(G=Td(M))):W=!1}W&&(C.set(M,G),_(G,M,m,A,C),C.delete(M)),Bl(s,c,G)}function jf(s,a){var c=s.length;if(c)return a+=a<0?c:0,Vr(a,c)?s[a]:r}function qf(s,a,c){a.length?a=Xt(a,function(A){return gt(A)?function(C){return Dn(C,A.length===1?A[0]:A)}:A}):a=[Oe];var m=-1;a=Xt(a,ke(at()));var _=Xf(s,function(A,C,P){var M=Xt(a,function(U){return U(A)});return{criteria:M,index:++m,value:A}});return z_(_,function(A,C){return Rx(A,C,c)})}function yx(s,a){return Kf(s,a,function(c,m){return gh(s,m)})}function Kf(s,a,c){for(var m=-1,_=a.length,A={};++m<_;){var C=a[m],P=Dn(s,C);c(P,C)&&fs(A,un(C,s),P)}return A}function _x(s){return function(a){return Dn(a,s)}}function Wl(s,a,c,m){var _=m?H_:ii,A=-1,C=a.length,P=s;for(s===a&&(a=Me(a)),c&&(P=Xt(s,ke(c)));++A<C;)for(var M=0,U=a[A],G=c?c(U):U;(M=_(P,G,M,m))>-1;)P!==s&&oo.call(P,M,1),oo.call(s,M,1);return s}function Zf(s,a){for(var c=s?a.length:0,m=c-1;c--;){var _=a[c];if(c==m||_!==A){var A=_;Vr(_)?oo.call(s,_,1):Vl(s,_)}}return s}function Hl(s,a){return s+ho(Mf()*(a-s+1))}function xx(s,a,c,m){for(var _=-1,A=ce(lo((a-s)/(c||1)),0),C=B(A);A--;)C[m?A:++_]=s,s+=c;return C}function zl(s,a){var c="";if(!s||a<1||a>_t)return c;do a%2&&(c+=s),a=ho(a/2),a&&(s+=s);while(a);return c}function xt(s,a){return ah(Cd(s,a,Oe),s+"")}function bx(s){return Of(mi(s))}function wx(s,a){var c=mi(s);return Co(c,Mn(a,0,c.length))}function fs(s,a,c,m){if(!Yt(s))return s;a=un(a,s);for(var _=-1,A=a.length,C=A-1,P=s;P!=null&&++_<A;){var M=Sr(a[_]),U=c;if(M==="__proto__"||M==="constructor"||M==="prototype")return s;if(_!=C){var G=P[M];U=m?m(G,M,P):r,U===r&&(U=Yt(G)?G:Vr(a[_+1])?[]:{})}ls(P,M,U),P=P[M]}return s}var Jf=uo?function(s,a){return uo.set(s,a),s}:Oe,Ex=ao?function(s,a){return ao(s,"toString",{configurable:!0,enumerable:!1,value:vh(a),writable:!0})}:Oe;function Tx(s){return Co(mi(s))}function Je(s,a,c){var m=-1,_=s.length;a<0&&(a=-a>_?0:_+a),c=c>_?_:c,c<0&&(c+=_),_=a>c?0:c-a>>>0,a>>>=0;for(var A=B(_);++m<_;)A[m]=s[m+a];return A}function Ax(s,a){var c;return ln(s,function(m,_,A){return c=a(m,_,A),!c}),!!c}function yo(s,a,c){var m=0,_=s==null?m:s.length;if(typeof a=="number"&&a===a&&_<=Rt){for(;m<_;){var A=m+_>>>1,C=s[A];C!==null&&!Ge(C)&&(c?C<=a:C<a)?m=A+1:_=A}return _}return Xl(s,a,Oe,c)}function Xl(s,a,c,m){var _=0,A=s==null?0:s.length;if(A===0)return 0;a=c(a);for(var C=a!==a,P=a===null,M=Ge(a),U=a===r;_<A;){var G=ho((_+A)/2),W=c(s[G]),K=W!==r,et=W===null,ht=W===W,yt=Ge(W);if(C)var ut=m||ht;else U?ut=ht&&(m||K):P?ut=ht&&K&&(m||!et):M?ut=ht&&K&&!et&&(m||!yt):et||yt?ut=!1:ut=m?W<=a:W<a;ut?_=G+1:A=G}return Ee(A,wt)}function Qf(s,a){for(var c=-1,m=s.length,_=0,A=[];++c<m;){var C=s[c],P=a?a(C):C;if(!c||!ar(P,M)){var M=P;A[_++]=C===0?0:C}}return A}function td(s){return typeof s=="number"?s:Ge(s)?H:+s}function Ue(s){if(typeof s=="string")return s;if(gt(s))return Xt(s,Ue)+"";if(Ge(s))return Df?Df.call(s):"";var a=s+"";return a=="0"&&1/s==-j?"-0":a}function hn(s,a,c){var m=-1,_=Ks,A=s.length,C=!0,P=[],M=P;if(c)C=!1,_=xl;else if(A>=i){var U=a?null:Lx(s);if(U)return Js(U);C=!1,_=rs,M=new Rn}else M=a?[]:P;t:for(;++m<A;){var G=s[m],W=a?a(G):G;if(G=c||G!==0?G:0,C&&W===W){for(var K=M.length;K--;)if(M[K]===W)continue t;a&&M.push(W),P.push(G)}else _(M,W,c)||(M!==P&&M.push(W),P.push(G))}return P}function Vl(s,a){return a=un(a,s),s=Id(s,a),s==null||delete s[Sr(Qe(a))]}function ed(s,a,c,m){return fs(s,a,c(Dn(s,a)),m)}function _o(s,a,c,m){for(var _=s.length,A=m?_:-1;(m?A--:++A<_)&&a(s[A],A,s););return c?Je(s,m?0:A,m?A+1:_):Je(s,m?A+1:0,m?_:A)}function rd(s,a){var c=s;return c instanceof Et&&(c=c.value()),bl(a,function(m,_){return _.func.apply(_.thisArg,sn([m],_.args))},c)}function Yl(s,a,c){var m=s.length;if(m<2)return m?hn(s[0]):[];for(var _=-1,A=B(m);++_<m;)for(var C=s[_],P=-1;++P<m;)P!=_&&(A[_]=hs(A[_]||C,s[P],a,c));return hn(ye(A,1),a,c)}function nd(s,a,c){for(var m=-1,_=s.length,A=a.length,C={};++m<_;){var P=m<A?a[m]:r;c(C,s[m],P)}return C}function jl(s){return re(s)?s:[]}function ql(s){return typeof s=="function"?s:Oe}function un(s,a){return gt(s)?s:ih(s,a)?[s]:Dd(Mt(s))}var Sx=xt;function cn(s,a,c){var m=s.length;return c=c===r?m:c,!a&&c>=m?s:Je(s,a,c)}var id=d0||function(s){return ve.clearTimeout(s)};function sd(s,a){if(a)return s.slice();var c=s.length,m=Sf?Sf(c):new s.constructor(c);return s.copy(m),m}function Kl(s){var a=new s.constructor(s.byteLength);return new io(a).set(new io(s)),a}function Cx(s,a){var c=a?Kl(s.buffer):s.buffer;return new s.constructor(c,s.byteOffset,s.byteLength)}function Ix(s){var a=new s.constructor(s.source,$c.exec(s));return a.lastIndex=s.lastIndex,a}function Px(s){return as?Lt(as.call(s)):{}}function od(s,a){var c=a?Kl(s.buffer):s.buffer;return new s.constructor(c,s.byteOffset,s.length)}function ad(s,a){if(s!==a){var c=s!==r,m=s===null,_=s===s,A=Ge(s),C=a!==r,P=a===null,M=a===a,U=Ge(a);if(!P&&!U&&!A&&s>a||A&&C&&M&&!P&&!U||m&&C&&M||!c&&M||!_)return 1;if(!m&&!A&&!U&&s<a||U&&c&&_&&!m&&!A||P&&c&&_||!C&&_||!M)return-1}return 0}function Rx(s,a,c){for(var m=-1,_=s.criteria,A=a.criteria,C=_.length,P=c.length;++m<C;){var M=ad(_[m],A[m]);if(M){if(m>=P)return M;var U=c[m];return M*(U=="desc"?-1:1)}}return s.index-a.index}function ld(s,a,c,m){for(var _=-1,A=s.length,C=c.length,P=-1,M=a.length,U=ce(A-C,0),G=B(M+U),W=!m;++P<M;)G[P]=a[P];for(;++_<C;)(W||_<A)&&(G[c[_]]=s[_]);for(;U--;)G[P++]=s[_++];return G}function hd(s,a,c,m){for(var _=-1,A=s.length,C=-1,P=c.length,M=-1,U=a.length,G=ce(A-P,0),W=B(G+U),K=!m;++_<G;)W[_]=s[_];for(var et=_;++M<U;)W[et+M]=a[M];for(;++C<P;)(K||_<A)&&(W[et+c[C]]=s[_++]);return W}function Me(s,a){var c=-1,m=s.length;for(a||(a=B(m));++c<m;)a[c]=s[c];return a}function Ar(s,a,c,m){var _=!c;c||(c={});for(var A=-1,C=a.length;++A<C;){var P=a[A],M=m?m(c[P],s[P],P,c,s):r;M===r&&(M=s[P]),_?Hr(c,P,M):ls(c,P,M)}return c}function Mx(s,a){return Ar(s,nh(s),a)}function Dx(s,a){return Ar(s,wd(s),a)}function xo(s,a){return function(c,m){var _=gt(c)?N_:tx,A=a?a():{};return _(c,s,at(m,2),A)}}function fi(s){return xt(function(a,c){var m=-1,_=c.length,A=_>1?c[_-1]:r,C=_>2?c[2]:r;for(A=s.length>3&&typeof A=="function"?(_--,A):r,C&&Ce(c[0],c[1],C)&&(A=_<3?r:A,_=1),a=Lt(a);++m<_;){var P=c[m];P&&s(a,P,m,A)}return a})}function ud(s,a){return function(c,m){if(c==null)return c;if(!De(c))return s(c,m);for(var _=c.length,A=a?_:-1,C=Lt(c);(a?A--:++A<_)&&m(C[A],A,C)!==!1;);return c}}function cd(s){return function(a,c,m){for(var _=-1,A=Lt(a),C=m(a),P=C.length;P--;){var M=C[s?P:++_];if(c(A[M],M,A)===!1)break}return a}}function Bx(s,a,c){var m=a&x,_=ds(s);function A(){var C=this&&this!==ve&&this instanceof A?_:s;return C.apply(m?c:this,arguments)}return A}function fd(s){return function(a){a=Mt(a);var c=si(a)?sr(a):r,m=c?c[0]:a.charAt(0),_=c?cn(c,1).join(""):a.slice(1);return m[s]()+_}}function di(s){return function(a){return bl(up(hp(a).replace(E_,"")),s,"")}}function ds(s){return function(){var a=arguments;switch(a.length){case 0:return new s;case 1:return new s(a[0]);case 2:return new s(a[0],a[1]);case 3:return new s(a[0],a[1],a[2]);case 4:return new s(a[0],a[1],a[2],a[3]);case 5:return new s(a[0],a[1],a[2],a[3],a[4]);case 6:return new s(a[0],a[1],a[2],a[3],a[4],a[5]);case 7:return new s(a[0],a[1],a[2],a[3],a[4],a[5],a[6])}var c=ci(s.prototype),m=s.apply(c,a);return Yt(m)?m:c}}function Ox(s,a,c){var m=ds(s);function _(){for(var A=arguments.length,C=B(A),P=A,M=pi(_);P--;)C[P]=arguments[P];var U=A<3&&C[0]!==M&&C[A-1]!==M?[]:on(C,M);if(A-=U.length,A<c)return vd(s,a,bo,_.placeholder,r,C,U,r,r,c-A);var G=this&&this!==ve&&this instanceof _?m:s;return Ne(G,this,C)}return _}function dd(s){return function(a,c,m){var _=Lt(a);if(!De(a)){var A=at(c,3);a=pe(a),c=function(P){return A(_[P],P,_)}}var C=s(a,c,m);return C>-1?_[A?a[C]:C]:r}}function pd(s){return Xr(function(a){var c=a.length,m=c,_=Ke.prototype.thru;for(s&&a.reverse();m--;){var A=a[m];if(typeof A!="function")throw new qe(l);if(_&&!C&&Ao(A)=="wrapper")var C=new Ke([],!0)}for(m=C?m:c;++m<c;){A=a[m];var P=Ao(A),M=P=="wrapper"?eh(A):r;M&&sh(M[0])&&M[1]==(O|E|D|F)&&!M[4].length&&M[9]==1?C=C[Ao(M[0])].apply(C,M[3]):C=A.length==1&&sh(A)?C[P]():C.thru(A)}return function(){var U=arguments,G=U[0];if(C&&U.length==1&&gt(G))return C.plant(G).value();for(var W=0,K=c?a[W].apply(this,U):G;++W<c;)K=a[W].call(this,K);return K}})}function bo(s,a,c,m,_,A,C,P,M,U){var G=a&O,W=a&x,K=a&T,et=a&(E|I),ht=a&X,yt=K?r:ds(s);function ut(){for(var bt=arguments.length,St=B(bt),$e=bt;$e--;)St[$e]=arguments[$e];if(et)var Ie=pi(ut),We=V_(St,Ie);if(m&&(St=ld(St,m,_,et)),A&&(St=hd(St,A,C,et)),bt-=We,et&&bt<U){var ne=on(St,Ie);return vd(s,a,bo,ut.placeholder,c,St,ne,P,M,U-bt)}var lr=W?c:this,qr=K?lr[s]:s;return bt=St.length,P?St=tb(St,P):ht&&bt>1&&St.reverse(),G&&M<bt&&(St.length=M),this&&this!==ve&&this instanceof ut&&(qr=yt||ds(qr)),qr.apply(lr,St)}return ut}function gd(s,a){return function(c,m){return lx(c,s,a(m),{})}}function wo(s,a){return function(c,m){var _;if(c===r&&m===r)return a;if(c!==r&&(_=c),m!==r){if(_===r)return m;typeof c=="string"||typeof m=="string"?(c=Ue(c),m=Ue(m)):(c=td(c),m=td(m)),_=s(c,m)}return _}}function Zl(s){return Xr(function(a){return a=Xt(a,ke(at())),xt(function(c){var m=this;return s(a,function(_){return Ne(_,m,c)})})})}function Eo(s,a){a=a===r?" ":Ue(a);var c=a.length;if(c<2)return c?zl(a,s):a;var m=zl(a,lo(s/oi(a)));return si(a)?cn(sr(m),0,s).join(""):m.slice(0,s)}function Fx(s,a,c,m){var _=a&x,A=ds(s);function C(){for(var P=-1,M=arguments.length,U=-1,G=m.length,W=B(G+M),K=this&&this!==ve&&this instanceof C?A:s;++U<G;)W[U]=m[U];for(;M--;)W[U++]=arguments[++P];return Ne(K,_?c:this,W)}return C}function md(s){return function(a,c,m){return m&&typeof m!="number"&&Ce(a,c,m)&&(c=m=r),a=jr(a),c===r?(c=a,a=0):c=jr(c),m=m===r?a<c?1:-1:jr(m),xx(a,c,m,s)}}function To(s){return function(a,c){return typeof a=="string"&&typeof c=="string"||(a=tr(a),c=tr(c)),s(a,c)}}function vd(s,a,c,m,_,A,C,P,M,U){var G=a&E,W=G?C:r,K=G?r:C,et=G?A:r,ht=G?r:A;a|=G?D:L,a&=~(G?L:D),a&S||(a&=~(x|T));var yt=[s,a,_,et,W,ht,K,P,M,U],ut=c.apply(r,yt);return sh(s)&&Pd(ut,yt),ut.placeholder=m,Rd(ut,s,a)}function Jl(s){var a=ue[s];return function(c,m){if(c=tr(c),m=m==null?0:Ee(vt(m),292),m&&Rf(c)){var _=(Mt(c)+"e").split("e"),A=a(_[0]+"e"+(+_[1]+m));return _=(Mt(A)+"e").split("e"),+(_[0]+"e"+(+_[1]-m))}return a(c)}}var Lx=hi&&1/Js(new hi([,-0]))[1]==j?function(s){return new hi(s)}:xh;function yd(s){return function(a){var c=Te(a);return c==Qt?Il(a):c==ir?Q_(a):X_(a,s(a))}}function zr(s,a,c,m,_,A,C,P){var M=a&T;if(!M&&typeof s!="function")throw new qe(l);var U=m?m.length:0;if(U||(a&=~(D|L),m=_=r),C=C===r?C:ce(vt(C),0),P=P===r?P:vt(P),U-=_?_.length:0,a&L){var G=m,W=_;m=_=r}var K=M?r:eh(s),et=[s,a,c,m,_,G,W,A,C,P];if(K&&Zx(et,K),s=et[0],a=et[1],c=et[2],m=et[3],_=et[4],P=et[9]=et[9]===r?M?0:s.length:ce(et[9]-U,0),!P&&a&(E|I)&&(a&=~(E|I)),!a||a==x)var ht=Bx(s,a,c);else a==E||a==I?ht=Ox(s,a,P):(a==D||a==(x|D))&&!_.length?ht=Fx(s,a,c,m):ht=bo.apply(r,et);var yt=K?Jf:Pd;return Rd(yt(ht,et),s,a)}function _d(s,a,c,m){return s===r||ar(s,li[c])&&!Ot.call(m,c)?a:s}function xd(s,a,c,m,_,A){return Yt(s)&&Yt(a)&&(A.set(a,s),vo(s,a,r,xd,A),A.delete(a)),s}function Nx(s){return ms(s)?r:s}function bd(s,a,c,m,_,A){var C=c&y,P=s.length,M=a.length;if(P!=M&&!(C&&M>P))return!1;var U=A.get(s),G=A.get(a);if(U&&G)return U==a&&G==s;var W=-1,K=!0,et=c&w?new Rn:r;for(A.set(s,a),A.set(a,s);++W<P;){var ht=s[W],yt=a[W];if(m)var ut=C?m(yt,ht,W,a,s,A):m(ht,yt,W,s,a,A);if(ut!==r){if(ut)continue;K=!1;break}if(et){if(!wl(a,function(bt,St){if(!rs(et,St)&&(ht===bt||_(ht,bt,c,m,A)))return et.push(St)})){K=!1;break}}else if(!(ht===yt||_(ht,yt,c,m,A))){K=!1;break}}return A.delete(s),A.delete(a),K}function kx(s,a,c,m,_,A,C){switch(c){case ri:if(s.byteLength!=a.byteLength||s.byteOffset!=a.byteOffset)return!1;s=s.buffer,a=a.buffer;case es:return!(s.byteLength!=a.byteLength||!A(new io(s),new io(a)));case Zt:case ae:case we:return ar(+s,+a);case Bt:return s.name==a.name&&s.message==a.message;case Ji:case Qi:return s==a+"";case Qt:var P=Il;case ir:var M=m&y;if(P||(P=Js),s.size!=a.size&&!M)return!1;var U=C.get(s);if(U)return U==a;m|=w,C.set(s,a);var G=bd(P(s),P(a),m,_,A,C);return C.delete(s),G;case Vs:if(as)return as.call(s)==as.call(a)}return!1}function Ux(s,a,c,m,_,A){var C=c&y,P=Ql(s),M=P.length,U=Ql(a),G=U.length;if(M!=G&&!C)return!1;for(var W=M;W--;){var K=P[W];if(!(C?K in a:Ot.call(a,K)))return!1}var et=A.get(s),ht=A.get(a);if(et&&ht)return et==a&&ht==s;var yt=!0;A.set(s,a),A.set(a,s);for(var ut=C;++W<M;){K=P[W];var bt=s[K],St=a[K];if(m)var $e=C?m(St,bt,K,a,s,A):m(bt,St,K,s,a,A);if(!($e===r?bt===St||_(bt,St,c,m,A):$e)){yt=!1;break}ut||(ut=K=="constructor")}if(yt&&!ut){var Ie=s.constructor,We=a.constructor;Ie!=We&&"constructor"in s&&"constructor"in a&&!(typeof Ie=="function"&&Ie instanceof Ie&&typeof We=="function"&&We instanceof We)&&(yt=!1)}return A.delete(s),A.delete(a),yt}function Xr(s){return ah(Cd(s,r,Ld),s+"")}function Ql(s){return $f(s,pe,nh)}function th(s){return $f(s,Be,wd)}var eh=uo?function(s){return uo.get(s)}:xh;function Ao(s){for(var a=s.name+"",c=ui[a],m=Ot.call(ui,a)?c.length:0;m--;){var _=c[m],A=_.func;if(A==null||A==s)return _.name}return a}function pi(s){var a=Ot.call(b,"placeholder")?b:s;return a.placeholder}function at(){var s=b.iteratee||yh;return s=s===yh?zf:s,arguments.length?s(arguments[0],arguments[1]):s}function So(s,a){var c=s.__data__;return Yx(a)?c[typeof a=="string"?"string":"hash"]:c.map}function rh(s){for(var a=pe(s),c=a.length;c--;){var m=a[c],_=s[m];a[c]=[m,_,Ad(_)]}return a}function Bn(s,a){var c=K_(s,a);return Hf(c)?c:r}function Gx(s){var a=Ot.call(s,In),c=s[In];try{s[In]=r;var m=!0}catch{}var _=ro.call(s);return m&&(a?s[In]=c:delete s[In]),_}var nh=Rl?function(s){return s==null?[]:(s=Lt(s),nn(Rl(s),function(a){return If.call(s,a)}))}:bh,wd=Rl?function(s){for(var a=[];s;)sn(a,nh(s)),s=so(s);return a}:bh,Te=Se;(Ml&&Te(new Ml(new ArrayBuffer(1)))!=ri||is&&Te(new is)!=Qt||Dl&&Te(Dl.resolve())!=Nc||hi&&Te(new hi)!=ir||ss&&Te(new ss)!=ts)&&(Te=function(s){var a=Se(s),c=a==Er?s.constructor:r,m=c?On(c):"";if(m)switch(m){case w0:return ri;case E0:return Qt;case T0:return Nc;case A0:return ir;case S0:return ts}return a});function $x(s,a,c){for(var m=-1,_=c.length;++m<_;){var A=c[m],C=A.size;switch(A.type){case"drop":s+=C;break;case"dropRight":a-=C;break;case"take":a=Ee(a,s+C);break;case"takeRight":s=ce(s,a-C);break}}return{start:s,end:a}}function Wx(s){var a=s.match(jy);return a?a[1].split(qy):[]}function Ed(s,a,c){a=un(a,s);for(var m=-1,_=a.length,A=!1;++m<_;){var C=Sr(a[m]);if(!(A=s!=null&&c(s,C)))break;s=s[C]}return A||++m!=_?A:(_=s==null?0:s.length,!!_&&Bo(_)&&Vr(C,_)&&(gt(s)||Fn(s)))}function Hx(s){var a=s.length,c=new s.constructor(a);return a&&typeof s[0]=="string"&&Ot.call(s,"index")&&(c.index=s.index,c.input=s.input),c}function Td(s){return typeof s.constructor=="function"&&!ps(s)?ci(so(s)):{}}function zx(s,a,c){var m=s.constructor;switch(a){case es:return Kl(s);case Zt:case ae:return new m(+s);case ri:return Cx(s,c);case rl:case nl:case il:case sl:case ol:case al:case ll:case hl:case ul:return od(s,c);case Qt:return new m;case we:case Qi:return new m(s);case Ji:return Ix(s);case ir:return new m;case Vs:return Px(s)}}function Xx(s,a){var c=a.length;if(!c)return s;var m=c-1;return a[m]=(c>1?"& ":"")+a[m],a=a.join(c>2?", ":" "),s.replace(Yy,`{
/* [wrapped with `+a+`] */
`)}function Vx(s){return gt(s)||Fn(s)||!!(Pf&&s&&s[Pf])}function Vr(s,a){var c=typeof s;return a=a??_t,!!a&&(c=="number"||c!="symbol"&&i_.test(s))&&s>-1&&s%1==0&&s<a}function Ce(s,a,c){if(!Yt(c))return!1;var m=typeof a;return(m=="number"?De(c)&&Vr(a,c.length):m=="string"&&a in c)?ar(c[a],s):!1}function ih(s,a){if(gt(s))return!1;var c=typeof s;return c=="number"||c=="symbol"||c=="boolean"||s==null||Ge(s)?!0:Hy.test(s)||!Wy.test(s)||a!=null&&s in Lt(a)}function Yx(s){var a=typeof s;return a=="string"||a=="number"||a=="symbol"||a=="boolean"?s!=="__proto__":s===null}function sh(s){var a=Ao(s),c=b[a];if(typeof c!="function"||!(a in Et.prototype))return!1;if(s===c)return!0;var m=eh(c);return!!m&&s===m[0]}function jx(s){return!!Af&&Af in s}var qx=to?Yr:wh;function ps(s){var a=s&&s.constructor,c=typeof a=="function"&&a.prototype||li;return s===c}function Ad(s){return s===s&&!Yt(s)}function Sd(s,a){return function(c){return c==null?!1:c[s]===a&&(a!==r||s in Lt(c))}}function Kx(s){var a=Mo(s,function(m){return c.size===f&&c.clear(),m}),c=a.cache;return a}function Zx(s,a){var c=s[1],m=a[1],_=c|m,A=_<(x|T|O),C=m==O&&c==E||m==O&&c==F&&s[7].length<=a[8]||m==(O|F)&&a[7].length<=a[8]&&c==E;if(!(A||C))return s;m&x&&(s[2]=a[2],_|=c&x?0:S);var P=a[3];if(P){var M=s[3];s[3]=M?ld(M,P,a[4]):P,s[4]=M?on(s[3],d):a[4]}return P=a[5],P&&(M=s[5],s[5]=M?hd(M,P,a[6]):P,s[6]=M?on(s[5],d):a[6]),P=a[7],P&&(s[7]=P),m&O&&(s[8]=s[8]==null?a[8]:Ee(s[8],a[8])),s[9]==null&&(s[9]=a[9]),s[0]=a[0],s[1]=_,s}function Jx(s){var a=[];if(s!=null)for(var c in Lt(s))a.push(c);return a}function Qx(s){return ro.call(s)}function Cd(s,a,c){return a=ce(a===r?s.length-1:a,0),function(){for(var m=arguments,_=-1,A=ce(m.length-a,0),C=B(A);++_<A;)C[_]=m[a+_];_=-1;for(var P=B(a+1);++_<a;)P[_]=m[_];return P[a]=c(C),Ne(s,this,P)}}function Id(s,a){return a.length<2?s:Dn(s,Je(a,0,-1))}function tb(s,a){for(var c=s.length,m=Ee(a.length,c),_=Me(s);m--;){var A=a[m];s[m]=Vr(A,c)?_[A]:r}return s}function oh(s,a){if(!(a==="constructor"&&typeof s[a]=="function")&&a!="__proto__")return s[a]}var Pd=Md(Jf),gs=g0||function(s,a){return ve.setTimeout(s,a)},ah=Md(Ex);function Rd(s,a,c){var m=a+"";return ah(s,Xx(m,eb(Wx(m),c)))}function Md(s){var a=0,c=0;return function(){var m=_0(),_=$-(m-c);if(c=m,_>0){if(++a>=Z)return arguments[0]}else a=0;return s.apply(r,arguments)}}function Co(s,a){var c=-1,m=s.length,_=m-1;for(a=a===r?m:a;++c<a;){var A=Hl(c,_),C=s[A];s[A]=s[c],s[c]=C}return s.length=a,s}var Dd=Kx(function(s){var a=[];return s.charCodeAt(0)===46&&a.push(""),s.replace(zy,function(c,m,_,A){a.push(_?A.replace(Jy,"$1"):m||c)}),a});function Sr(s){if(typeof s=="string"||Ge(s))return s;var a=s+"";return a=="0"&&1/s==-j?"-0":a}function On(s){if(s!=null){try{return eo.call(s)}catch{}try{return s+""}catch{}}return""}function eb(s,a){return je(Dt,function(c){var m="_."+c[0];a&c[1]&&!Ks(s,m)&&s.push(m)}),s.sort()}function Bd(s){if(s instanceof Et)return s.clone();var a=new Ke(s.__wrapped__,s.__chain__);return a.__actions__=Me(s.__actions__),a.__index__=s.__index__,a.__values__=s.__values__,a}function rb(s,a,c){(c?Ce(s,a,c):a===r)?a=1:a=ce(vt(a),0);var m=s==null?0:s.length;if(!m||a<1)return[];for(var _=0,A=0,C=B(lo(m/a));_<m;)C[A++]=Je(s,_,_+=a);return C}function nb(s){for(var a=-1,c=s==null?0:s.length,m=0,_=[];++a<c;){var A=s[a];A&&(_[m++]=A)}return _}function ib(){var s=arguments.length;if(!s)return[];for(var a=B(s-1),c=arguments[0],m=s;m--;)a[m-1]=arguments[m];return sn(gt(c)?Me(c):[c],ye(a,1))}var sb=xt(function(s,a){return re(s)?hs(s,ye(a,1,re,!0)):[]}),ob=xt(function(s,a){var c=Qe(a);return re(c)&&(c=r),re(s)?hs(s,ye(a,1,re,!0),at(c,2)):[]}),ab=xt(function(s,a){var c=Qe(a);return re(c)&&(c=r),re(s)?hs(s,ye(a,1,re,!0),r,c):[]});function lb(s,a,c){var m=s==null?0:s.length;return m?(a=c||a===r?1:vt(a),Je(s,a<0?0:a,m)):[]}function hb(s,a,c){var m=s==null?0:s.length;return m?(a=c||a===r?1:vt(a),a=m-a,Je(s,0,a<0?0:a)):[]}function ub(s,a){return s&&s.length?_o(s,at(a,3),!0,!0):[]}function cb(s,a){return s&&s.length?_o(s,at(a,3),!0):[]}function fb(s,a,c,m){var _=s==null?0:s.length;return _?(c&&typeof c!="number"&&Ce(s,a,c)&&(c=0,m=_),ix(s,a,c,m)):[]}function Od(s,a,c){var m=s==null?0:s.length;if(!m)return-1;var _=c==null?0:vt(c);return _<0&&(_=ce(m+_,0)),Zs(s,at(a,3),_)}function Fd(s,a,c){var m=s==null?0:s.length;if(!m)return-1;var _=m-1;return c!==r&&(_=vt(c),_=c<0?ce(m+_,0):Ee(_,m-1)),Zs(s,at(a,3),_,!0)}function Ld(s){var a=s==null?0:s.length;return a?ye(s,1):[]}function db(s){var a=s==null?0:s.length;return a?ye(s,j):[]}function pb(s,a){var c=s==null?0:s.length;return c?(a=a===r?1:vt(a),ye(s,a)):[]}function gb(s){for(var a=-1,c=s==null?0:s.length,m={};++a<c;){var _=s[a];m[_[0]]=_[1]}return m}function Nd(s){return s&&s.length?s[0]:r}function mb(s,a,c){var m=s==null?0:s.length;if(!m)return-1;var _=c==null?0:vt(c);return _<0&&(_=ce(m+_,0)),ii(s,a,_)}function vb(s){var a=s==null?0:s.length;return a?Je(s,0,-1):[]}var yb=xt(function(s){var a=Xt(s,jl);return a.length&&a[0]===s[0]?kl(a):[]}),_b=xt(function(s){var a=Qe(s),c=Xt(s,jl);return a===Qe(c)?a=r:c.pop(),c.length&&c[0]===s[0]?kl(c,at(a,2)):[]}),xb=xt(function(s){var a=Qe(s),c=Xt(s,jl);return a=typeof a=="function"?a:r,a&&c.pop(),c.length&&c[0]===s[0]?kl(c,r,a):[]});function bb(s,a){return s==null?"":v0.call(s,a)}function Qe(s){var a=s==null?0:s.length;return a?s[a-1]:r}function wb(s,a,c){var m=s==null?0:s.length;if(!m)return-1;var _=m;return c!==r&&(_=vt(c),_=_<0?ce(m+_,0):Ee(_,m-1)),a===a?e0(s,a,_):Zs(s,vf,_,!0)}function Eb(s,a){return s&&s.length?jf(s,vt(a)):r}var Tb=xt(kd);function kd(s,a){return s&&s.length&&a&&a.length?Wl(s,a):s}function Ab(s,a,c){return s&&s.length&&a&&a.length?Wl(s,a,at(c,2)):s}function Sb(s,a,c){return s&&s.length&&a&&a.length?Wl(s,a,r,c):s}var Cb=Xr(function(s,a){var c=s==null?0:s.length,m=Ol(s,a);return Zf(s,Xt(a,function(_){return Vr(_,c)?+_:_}).sort(ad)),m});function Ib(s,a){var c=[];if(!(s&&s.length))return c;var m=-1,_=[],A=s.length;for(a=at(a,3);++m<A;){var C=s[m];a(C,m,s)&&(c.push(C),_.push(m))}return Zf(s,_),c}function lh(s){return s==null?s:b0.call(s)}function Pb(s,a,c){var m=s==null?0:s.length;return m?(c&&typeof c!="number"&&Ce(s,a,c)?(a=0,c=m):(a=a==null?0:vt(a),c=c===r?m:vt(c)),Je(s,a,c)):[]}function Rb(s,a){return yo(s,a)}function Mb(s,a,c){return Xl(s,a,at(c,2))}function Db(s,a){var c=s==null?0:s.length;if(c){var m=yo(s,a);if(m<c&&ar(s[m],a))return m}return-1}function Bb(s,a){return yo(s,a,!0)}function Ob(s,a,c){return Xl(s,a,at(c,2),!0)}function Fb(s,a){var c=s==null?0:s.length;if(c){var m=yo(s,a,!0)-1;if(ar(s[m],a))return m}return-1}function Lb(s){return s&&s.length?Qf(s):[]}function Nb(s,a){return s&&s.length?Qf(s,at(a,2)):[]}function kb(s){var a=s==null?0:s.length;return a?Je(s,1,a):[]}function Ub(s,a,c){return s&&s.length?(a=c||a===r?1:vt(a),Je(s,0,a<0?0:a)):[]}function Gb(s,a,c){var m=s==null?0:s.length;return m?(a=c||a===r?1:vt(a),a=m-a,Je(s,a<0?0:a,m)):[]}function $b(s,a){return s&&s.length?_o(s,at(a,3),!1,!0):[]}function Wb(s,a){return s&&s.length?_o(s,at(a,3)):[]}var Hb=xt(function(s){return hn(ye(s,1,re,!0))}),zb=xt(function(s){var a=Qe(s);return re(a)&&(a=r),hn(ye(s,1,re,!0),at(a,2))}),Xb=xt(function(s){var a=Qe(s);return a=typeof a=="function"?a:r,hn(ye(s,1,re,!0),r,a)});function Vb(s){return s&&s.length?hn(s):[]}function Yb(s,a){return s&&s.length?hn(s,at(a,2)):[]}function jb(s,a){return a=typeof a=="function"?a:r,s&&s.length?hn(s,r,a):[]}function hh(s){if(!(s&&s.length))return[];var a=0;return s=nn(s,function(c){if(re(c))return a=ce(c.length,a),!0}),Sl(a,function(c){return Xt(s,El(c))})}function Ud(s,a){if(!(s&&s.length))return[];var c=hh(s);return a==null?c:Xt(c,function(m){return Ne(a,r,m)})}var qb=xt(function(s,a){return re(s)?hs(s,a):[]}),Kb=xt(function(s){return Yl(nn(s,re))}),Zb=xt(function(s){var a=Qe(s);return re(a)&&(a=r),Yl(nn(s,re),at(a,2))}),Jb=xt(function(s){var a=Qe(s);return a=typeof a=="function"?a:r,Yl(nn(s,re),r,a)}),Qb=xt(hh);function t1(s,a){return nd(s||[],a||[],ls)}function e1(s,a){return nd(s||[],a||[],fs)}var r1=xt(function(s){var a=s.length,c=a>1?s[a-1]:r;return c=typeof c=="function"?(s.pop(),c):r,Ud(s,c)});function Gd(s){var a=b(s);return a.__chain__=!0,a}function n1(s,a){return a(s),s}function Io(s,a){return a(s)}var i1=Xr(function(s){var a=s.length,c=a?s[0]:0,m=this.__wrapped__,_=function(A){return Ol(A,s)};return a>1||this.__actions__.length||!(m instanceof Et)||!Vr(c)?this.thru(_):(m=m.slice(c,+c+(a?1:0)),m.__actions__.push({func:Io,args:[_],thisArg:r}),new Ke(m,this.__chain__).thru(function(A){return a&&!A.length&&A.push(r),A}))});function s1(){return Gd(this)}function o1(){return new Ke(this.value(),this.__chain__)}function a1(){this.__values__===r&&(this.__values__=tp(this.value()));var s=this.__index__>=this.__values__.length,a=s?r:this.__values__[this.__index__++];return{done:s,value:a}}function l1(){return this}function h1(s){for(var a,c=this;c instanceof fo;){var m=Bd(c);m.__index__=0,m.__values__=r,a?_.__wrapped__=m:a=m;var _=m;c=c.__wrapped__}return _.__wrapped__=s,a}function u1(){var s=this.__wrapped__;if(s instanceof Et){var a=s;return this.__actions__.length&&(a=new Et(this)),a=a.reverse(),a.__actions__.push({func:Io,args:[lh],thisArg:r}),new Ke(a,this.__chain__)}return this.thru(lh)}function c1(){return rd(this.__wrapped__,this.__actions__)}var f1=xo(function(s,a,c){Ot.call(s,c)?++s[c]:Hr(s,c,1)});function d1(s,a,c){var m=gt(s)?gf:nx;return c&&Ce(s,a,c)&&(a=r),m(s,at(a,3))}function p1(s,a){var c=gt(s)?nn:Uf;return c(s,at(a,3))}var g1=dd(Od),m1=dd(Fd);function v1(s,a){return ye(Po(s,a),1)}function y1(s,a){return ye(Po(s,a),j)}function _1(s,a,c){return c=c===r?1:vt(c),ye(Po(s,a),c)}function $d(s,a){var c=gt(s)?je:ln;return c(s,at(a,3))}function Wd(s,a){var c=gt(s)?k_:kf;return c(s,at(a,3))}var x1=xo(function(s,a,c){Ot.call(s,c)?s[c].push(a):Hr(s,c,[a])});function b1(s,a,c,m){s=De(s)?s:mi(s),c=c&&!m?vt(c):0;var _=s.length;return c<0&&(c=ce(_+c,0)),Oo(s)?c<=_&&s.indexOf(a,c)>-1:!!_&&ii(s,a,c)>-1}var w1=xt(function(s,a,c){var m=-1,_=typeof a=="function",A=De(s)?B(s.length):[];return ln(s,function(C){A[++m]=_?Ne(a,C,c):us(C,a,c)}),A}),E1=xo(function(s,a,c){Hr(s,c,a)});function Po(s,a){var c=gt(s)?Xt:Xf;return c(s,at(a,3))}function T1(s,a,c,m){return s==null?[]:(gt(a)||(a=a==null?[]:[a]),c=m?r:c,gt(c)||(c=c==null?[]:[c]),qf(s,a,c))}var A1=xo(function(s,a,c){s[c?0:1].push(a)},function(){return[[],[]]});function S1(s,a,c){var m=gt(s)?bl:_f,_=arguments.length<3;return m(s,at(a,4),c,_,ln)}function C1(s,a,c){var m=gt(s)?U_:_f,_=arguments.length<3;return m(s,at(a,4),c,_,kf)}function I1(s,a){var c=gt(s)?nn:Uf;return c(s,Do(at(a,3)))}function P1(s){var a=gt(s)?Of:bx;return a(s)}function R1(s,a,c){(c?Ce(s,a,c):a===r)?a=1:a=vt(a);var m=gt(s)?J0:wx;return m(s,a)}function M1(s){var a=gt(s)?Q0:Tx;return a(s)}function D1(s){if(s==null)return 0;if(De(s))return Oo(s)?oi(s):s.length;var a=Te(s);return a==Qt||a==ir?s.size:Gl(s).length}function B1(s,a,c){var m=gt(s)?wl:Ax;return c&&Ce(s,a,c)&&(a=r),m(s,at(a,3))}var O1=xt(function(s,a){if(s==null)return[];var c=a.length;return c>1&&Ce(s,a[0],a[1])?a=[]:c>2&&Ce(a[0],a[1],a[2])&&(a=[a[0]]),qf(s,ye(a,1),[])}),Ro=p0||function(){return ve.Date.now()};function F1(s,a){if(typeof a!="function")throw new qe(l);return s=vt(s),function(){if(--s<1)return a.apply(this,arguments)}}function Hd(s,a,c){return a=c?r:a,a=s&&a==null?s.length:a,zr(s,O,r,r,r,r,a)}function zd(s,a){var c;if(typeof a!="function")throw new qe(l);return s=vt(s),function(){return--s>0&&(c=a.apply(this,arguments)),s<=1&&(a=r),c}}var uh=xt(function(s,a,c){var m=x;if(c.length){var _=on(c,pi(uh));m|=D}return zr(s,m,a,c,_)}),Xd=xt(function(s,a,c){var m=x|T;if(c.length){var _=on(c,pi(Xd));m|=D}return zr(a,m,s,c,_)});function Vd(s,a,c){a=c?r:a;var m=zr(s,E,r,r,r,r,r,a);return m.placeholder=Vd.placeholder,m}function Yd(s,a,c){a=c?r:a;var m=zr(s,I,r,r,r,r,r,a);return m.placeholder=Yd.placeholder,m}function jd(s,a,c){var m,_,A,C,P,M,U=0,G=!1,W=!1,K=!0;if(typeof s!="function")throw new qe(l);a=tr(a)||0,Yt(c)&&(G=!!c.leading,W="maxWait"in c,A=W?ce(tr(c.maxWait)||0,a):A,K="trailing"in c?!!c.trailing:K);function et(ne){var lr=m,qr=_;return m=_=r,U=ne,C=s.apply(qr,lr),C}function ht(ne){return U=ne,P=gs(bt,a),G?et(ne):C}function yt(ne){var lr=ne-M,qr=ne-U,dp=a-lr;return W?Ee(dp,A-qr):dp}function ut(ne){var lr=ne-M,qr=ne-U;return M===r||lr>=a||lr<0||W&&qr>=A}function bt(){var ne=Ro();if(ut(ne))return St(ne);P=gs(bt,yt(ne))}function St(ne){return P=r,K&&m?et(ne):(m=_=r,C)}function $e(){P!==r&&id(P),U=0,m=M=_=P=r}function Ie(){return P===r?C:St(Ro())}function We(){var ne=Ro(),lr=ut(ne);if(m=arguments,_=this,M=ne,lr){if(P===r)return ht(M);if(W)return id(P),P=gs(bt,a),et(M)}return P===r&&(P=gs(bt,a)),C}return We.cancel=$e,We.flush=Ie,We}var L1=xt(function(s,a){return Nf(s,1,a)}),N1=xt(function(s,a,c){return Nf(s,tr(a)||0,c)});function k1(s){return zr(s,X)}function Mo(s,a){if(typeof s!="function"||a!=null&&typeof a!="function")throw new qe(l);var c=function(){var m=arguments,_=a?a.apply(this,m):m[0],A=c.cache;if(A.has(_))return A.get(_);var C=s.apply(this,m);return c.cache=A.set(_,C)||A,C};return c.cache=new(Mo.Cache||Wr),c}Mo.Cache=Wr;function Do(s){if(typeof s!="function")throw new qe(l);return function(){var a=arguments;switch(a.length){case 0:return!s.call(this);case 1:return!s.call(this,a[0]);case 2:return!s.call(this,a[0],a[1]);case 3:return!s.call(this,a[0],a[1],a[2])}return!s.apply(this,a)}}function U1(s){return zd(2,s)}var G1=Sx(function(s,a){a=a.length==1&&gt(a[0])?Xt(a[0],ke(at())):Xt(ye(a,1),ke(at()));var c=a.length;return xt(function(m){for(var _=-1,A=Ee(m.length,c);++_<A;)m[_]=a[_].call(this,m[_]);return Ne(s,this,m)})}),ch=xt(function(s,a){var c=on(a,pi(ch));return zr(s,D,r,a,c)}),qd=xt(function(s,a){var c=on(a,pi(qd));return zr(s,L,r,a,c)}),$1=Xr(function(s,a){return zr(s,F,r,r,r,a)});function W1(s,a){if(typeof s!="function")throw new qe(l);return a=a===r?a:vt(a),xt(s,a)}function H1(s,a){if(typeof s!="function")throw new qe(l);return a=a==null?0:ce(vt(a),0),xt(function(c){var m=c[a],_=cn(c,0,a);return m&&sn(_,m),Ne(s,this,_)})}function z1(s,a,c){var m=!0,_=!0;if(typeof s!="function")throw new qe(l);return Yt(c)&&(m="leading"in c?!!c.leading:m,_="trailing"in c?!!c.trailing:_),jd(s,a,{leading:m,maxWait:a,trailing:_})}function X1(s){return Hd(s,1)}function V1(s,a){return ch(ql(a),s)}function Y1(){if(!arguments.length)return[];var s=arguments[0];return gt(s)?s:[s]}function j1(s){return Ze(s,v)}function q1(s,a){return a=typeof a=="function"?a:r,Ze(s,v,a)}function K1(s){return Ze(s,p|v)}function Z1(s,a){return a=typeof a=="function"?a:r,Ze(s,p|v,a)}function J1(s,a){return a==null||Lf(s,a,pe(a))}function ar(s,a){return s===a||s!==s&&a!==a}var Q1=To(Nl),tw=To(function(s,a){return s>=a}),Fn=Wf(function(){return arguments}())?Wf:function(s){return te(s)&&Ot.call(s,"callee")&&!If.call(s,"callee")},gt=B.isArray,ew=hf?ke(hf):hx;function De(s){return s!=null&&Bo(s.length)&&!Yr(s)}function re(s){return te(s)&&De(s)}function rw(s){return s===!0||s===!1||te(s)&&Se(s)==Zt}var fn=m0||wh,nw=uf?ke(uf):ux;function iw(s){return te(s)&&s.nodeType===1&&!ms(s)}function sw(s){if(s==null)return!0;if(De(s)&&(gt(s)||typeof s=="string"||typeof s.splice=="function"||fn(s)||gi(s)||Fn(s)))return!s.length;var a=Te(s);if(a==Qt||a==ir)return!s.size;if(ps(s))return!Gl(s).length;for(var c in s)if(Ot.call(s,c))return!1;return!0}function ow(s,a){return cs(s,a)}function aw(s,a,c){c=typeof c=="function"?c:r;var m=c?c(s,a):r;return m===r?cs(s,a,r,c):!!m}function fh(s){if(!te(s))return!1;var a=Se(s);return a==Bt||a==he||typeof s.message=="string"&&typeof s.name=="string"&&!ms(s)}function lw(s){return typeof s=="number"&&Rf(s)}function Yr(s){if(!Yt(s))return!1;var a=Se(s);return a==Wt||a==Jt||a==oe||a==Dy}function Kd(s){return typeof s=="number"&&s==vt(s)}function Bo(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=_t}function Yt(s){var a=typeof s;return s!=null&&(a=="object"||a=="function")}function te(s){return s!=null&&typeof s=="object"}var Zd=cf?ke(cf):fx;function hw(s,a){return s===a||Ul(s,a,rh(a))}function uw(s,a,c){return c=typeof c=="function"?c:r,Ul(s,a,rh(a),c)}function cw(s){return Jd(s)&&s!=+s}function fw(s){if(qx(s))throw new dt(o);return Hf(s)}function dw(s){return s===null}function pw(s){return s==null}function Jd(s){return typeof s=="number"||te(s)&&Se(s)==we}function ms(s){if(!te(s)||Se(s)!=Er)return!1;var a=so(s);if(a===null)return!0;var c=Ot.call(a,"constructor")&&a.constructor;return typeof c=="function"&&c instanceof c&&eo.call(c)==u0}var dh=ff?ke(ff):dx;function gw(s){return Kd(s)&&s>=-_t&&s<=_t}var Qd=df?ke(df):px;function Oo(s){return typeof s=="string"||!gt(s)&&te(s)&&Se(s)==Qi}function Ge(s){return typeof s=="symbol"||te(s)&&Se(s)==Vs}var gi=pf?ke(pf):gx;function mw(s){return s===r}function vw(s){return te(s)&&Te(s)==ts}function yw(s){return te(s)&&Se(s)==Oy}var _w=To($l),xw=To(function(s,a){return s<=a});function tp(s){if(!s)return[];if(De(s))return Oo(s)?sr(s):Me(s);if(ns&&s[ns])return J_(s[ns]());var a=Te(s),c=a==Qt?Il:a==ir?Js:mi;return c(s)}function jr(s){if(!s)return s===0?s:0;if(s=tr(s),s===j||s===-j){var a=s<0?-1:1;return a*Ft}return s===s?s:0}function vt(s){var a=jr(s),c=a%1;return a===a?c?a-c:a:0}function ep(s){return s?Mn(vt(s),0,nt):0}function tr(s){if(typeof s=="number")return s;if(Ge(s))return H;if(Yt(s)){var a=typeof s.valueOf=="function"?s.valueOf():s;s=Yt(a)?a+"":a}if(typeof s!="string")return s===0?s:+s;s=xf(s);var c=e_.test(s);return c||n_.test(s)?F_(s.slice(2),c?2:8):t_.test(s)?H:+s}function rp(s){return Ar(s,Be(s))}function bw(s){return s?Mn(vt(s),-_t,_t):s===0?s:0}function Mt(s){return s==null?"":Ue(s)}var ww=fi(function(s,a){if(ps(a)||De(a)){Ar(a,pe(a),s);return}for(var c in a)Ot.call(a,c)&&ls(s,c,a[c])}),np=fi(function(s,a){Ar(a,Be(a),s)}),Fo=fi(function(s,a,c,m){Ar(a,Be(a),s,m)}),Ew=fi(function(s,a,c,m){Ar(a,pe(a),s,m)}),Tw=Xr(Ol);function Aw(s,a){var c=ci(s);return a==null?c:Ff(c,a)}var Sw=xt(function(s,a){s=Lt(s);var c=-1,m=a.length,_=m>2?a[2]:r;for(_&&Ce(a[0],a[1],_)&&(m=1);++c<m;)for(var A=a[c],C=Be(A),P=-1,M=C.length;++P<M;){var U=C[P],G=s[U];(G===r||ar(G,li[U])&&!Ot.call(s,U))&&(s[U]=A[U])}return s}),Cw=xt(function(s){return s.push(r,xd),Ne(ip,r,s)});function Iw(s,a){return mf(s,at(a,3),Tr)}function Pw(s,a){return mf(s,at(a,3),Ll)}function Rw(s,a){return s==null?s:Fl(s,at(a,3),Be)}function Mw(s,a){return s==null?s:Gf(s,at(a,3),Be)}function Dw(s,a){return s&&Tr(s,at(a,3))}function Bw(s,a){return s&&Ll(s,at(a,3))}function Ow(s){return s==null?[]:mo(s,pe(s))}function Fw(s){return s==null?[]:mo(s,Be(s))}function ph(s,a,c){var m=s==null?r:Dn(s,a);return m===r?c:m}function Lw(s,a){return s!=null&&Ed(s,a,sx)}function gh(s,a){return s!=null&&Ed(s,a,ox)}var Nw=gd(function(s,a,c){a!=null&&typeof a.toString!="function"&&(a=ro.call(a)),s[a]=c},vh(Oe)),kw=gd(function(s,a,c){a!=null&&typeof a.toString!="function"&&(a=ro.call(a)),Ot.call(s,a)?s[a].push(c):s[a]=[c]},at),Uw=xt(us);function pe(s){return De(s)?Bf(s):Gl(s)}function Be(s){return De(s)?Bf(s,!0):mx(s)}function Gw(s,a){var c={};return a=at(a,3),Tr(s,function(m,_,A){Hr(c,a(m,_,A),m)}),c}function $w(s,a){var c={};return a=at(a,3),Tr(s,function(m,_,A){Hr(c,_,a(m,_,A))}),c}var Ww=fi(function(s,a,c){vo(s,a,c)}),ip=fi(function(s,a,c,m){vo(s,a,c,m)}),Hw=Xr(function(s,a){var c={};if(s==null)return c;var m=!1;a=Xt(a,function(A){return A=un(A,s),m||(m=A.length>1),A}),Ar(s,th(s),c),m&&(c=Ze(c,p|g|v,Nx));for(var _=a.length;_--;)Vl(c,a[_]);return c});function zw(s,a){return sp(s,Do(at(a)))}var Xw=Xr(function(s,a){return s==null?{}:yx(s,a)});function sp(s,a){if(s==null)return{};var c=Xt(th(s),function(m){return[m]});return a=at(a),Kf(s,c,function(m,_){return a(m,_[0])})}function Vw(s,a,c){a=un(a,s);var m=-1,_=a.length;for(_||(_=1,s=r);++m<_;){var A=s==null?r:s[Sr(a[m])];A===r&&(m=_,A=c),s=Yr(A)?A.call(s):A}return s}function Yw(s,a,c){return s==null?s:fs(s,a,c)}function jw(s,a,c,m){return m=typeof m=="function"?m:r,s==null?s:fs(s,a,c,m)}var op=yd(pe),ap=yd(Be);function qw(s,a,c){var m=gt(s),_=m||fn(s)||gi(s);if(a=at(a,4),c==null){var A=s&&s.constructor;_?c=m?new A:[]:Yt(s)?c=Yr(A)?ci(so(s)):{}:c={}}return(_?je:Tr)(s,function(C,P,M){return a(c,C,P,M)}),c}function Kw(s,a){return s==null?!0:Vl(s,a)}function Zw(s,a,c){return s==null?s:ed(s,a,ql(c))}function Jw(s,a,c,m){return m=typeof m=="function"?m:r,s==null?s:ed(s,a,ql(c),m)}function mi(s){return s==null?[]:Cl(s,pe(s))}function Qw(s){return s==null?[]:Cl(s,Be(s))}function tE(s,a,c){return c===r&&(c=a,a=r),c!==r&&(c=tr(c),c=c===c?c:0),a!==r&&(a=tr(a),a=a===a?a:0),Mn(tr(s),a,c)}function eE(s,a,c){return a=jr(a),c===r?(c=a,a=0):c=jr(c),s=tr(s),ax(s,a,c)}function rE(s,a,c){if(c&&typeof c!="boolean"&&Ce(s,a,c)&&(a=c=r),c===r&&(typeof a=="boolean"?(c=a,a=r):typeof s=="boolean"&&(c=s,s=r)),s===r&&a===r?(s=0,a=1):(s=jr(s),a===r?(a=s,s=0):a=jr(a)),s>a){var m=s;s=a,a=m}if(c||s%1||a%1){var _=Mf();return Ee(s+_*(a-s+O_("1e-"+((_+"").length-1))),a)}return Hl(s,a)}var nE=di(function(s,a,c){return a=a.toLowerCase(),s+(c?lp(a):a)});function lp(s){return mh(Mt(s).toLowerCase())}function hp(s){return s=Mt(s),s&&s.replace(s_,Y_).replace(T_,"")}function iE(s,a,c){s=Mt(s),a=Ue(a);var m=s.length;c=c===r?m:Mn(vt(c),0,m);var _=c;return c-=a.length,c>=0&&s.slice(c,_)==a}function sE(s){return s=Mt(s),s&&Uy.test(s)?s.replace(Uc,j_):s}function oE(s){return s=Mt(s),s&&Xy.test(s)?s.replace(cl,"\\$&"):s}var aE=di(function(s,a,c){return s+(c?"-":"")+a.toLowerCase()}),lE=di(function(s,a,c){return s+(c?" ":"")+a.toLowerCase()}),hE=fd("toLowerCase");function uE(s,a,c){s=Mt(s),a=vt(a);var m=a?oi(s):0;if(!a||m>=a)return s;var _=(a-m)/2;return Eo(ho(_),c)+s+Eo(lo(_),c)}function cE(s,a,c){s=Mt(s),a=vt(a);var m=a?oi(s):0;return a&&m<a?s+Eo(a-m,c):s}function fE(s,a,c){s=Mt(s),a=vt(a);var m=a?oi(s):0;return a&&m<a?Eo(a-m,c)+s:s}function dE(s,a,c){return c||a==null?a=0:a&&(a=+a),x0(Mt(s).replace(fl,""),a||0)}function pE(s,a,c){return(c?Ce(s,a,c):a===r)?a=1:a=vt(a),zl(Mt(s),a)}function gE(){var s=arguments,a=Mt(s[0]);return s.length<3?a:a.replace(s[1],s[2])}var mE=di(function(s,a,c){return s+(c?"_":"")+a.toLowerCase()});function vE(s,a,c){return c&&typeof c!="number"&&Ce(s,a,c)&&(a=c=r),c=c===r?nt:c>>>0,c?(s=Mt(s),s&&(typeof a=="string"||a!=null&&!dh(a))&&(a=Ue(a),!a&&si(s))?cn(sr(s),0,c):s.split(a,c)):[]}var yE=di(function(s,a,c){return s+(c?" ":"")+mh(a)});function _E(s,a,c){return s=Mt(s),c=c==null?0:Mn(vt(c),0,s.length),a=Ue(a),s.slice(c,c+a.length)==a}function xE(s,a,c){var m=b.templateSettings;c&&Ce(s,a,c)&&(a=r),s=Mt(s),a=Fo({},a,m,_d);var _=Fo({},a.imports,m.imports,_d),A=pe(_),C=Cl(_,A),P,M,U=0,G=a.interpolate||Ys,W="__p += '",K=Pl((a.escape||Ys).source+"|"+G.source+"|"+(G===Gc?Qy:Ys).source+"|"+(a.evaluate||Ys).source+"|$","g"),et="//# sourceURL="+(Ot.call(a,"sourceURL")?(a.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++P_+"]")+`
`;s.replace(K,function(ut,bt,St,$e,Ie,We){return St||(St=$e),W+=s.slice(U,We).replace(o_,q_),bt&&(P=!0,W+=`' +
__e(`+bt+`) +
'`),Ie&&(M=!0,W+=`';
`+Ie+`;
__p += '`),St&&(W+=`' +
((__t = (`+St+`)) == null ? '' : __t) +
'`),U=We+ut.length,ut}),W+=`';
`;var ht=Ot.call(a,"variable")&&a.variable;if(!ht)W=`with (obj) {
`+W+`
}
`;else if(Zy.test(ht))throw new dt(h);W=(M?W.replace(Fy,""):W).replace(Ly,"$1").replace(Ny,"$1;"),W="function("+(ht||"obj")+`) {
`+(ht?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(P?", __e = _.escape":"")+(M?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+W+`return __p
}`;var yt=cp(function(){return Pt(A,et+"return "+W).apply(r,C)});if(yt.source=W,fh(yt))throw yt;return yt}function bE(s){return Mt(s).toLowerCase()}function wE(s){return Mt(s).toUpperCase()}function EE(s,a,c){if(s=Mt(s),s&&(c||a===r))return xf(s);if(!s||!(a=Ue(a)))return s;var m=sr(s),_=sr(a),A=bf(m,_),C=wf(m,_)+1;return cn(m,A,C).join("")}function TE(s,a,c){if(s=Mt(s),s&&(c||a===r))return s.slice(0,Tf(s)+1);if(!s||!(a=Ue(a)))return s;var m=sr(s),_=wf(m,sr(a))+1;return cn(m,0,_).join("")}function AE(s,a,c){if(s=Mt(s),s&&(c||a===r))return s.replace(fl,"");if(!s||!(a=Ue(a)))return s;var m=sr(s),_=bf(m,sr(a));return cn(m,_).join("")}function SE(s,a){var c=q,m=V;if(Yt(a)){var _="separator"in a?a.separator:_;c="length"in a?vt(a.length):c,m="omission"in a?Ue(a.omission):m}s=Mt(s);var A=s.length;if(si(s)){var C=sr(s);A=C.length}if(c>=A)return s;var P=c-oi(m);if(P<1)return m;var M=C?cn(C,0,P).join(""):s.slice(0,P);if(_===r)return M+m;if(C&&(P+=M.length-P),dh(_)){if(s.slice(P).search(_)){var U,G=M;for(_.global||(_=Pl(_.source,Mt($c.exec(_))+"g")),_.lastIndex=0;U=_.exec(G);)var W=U.index;M=M.slice(0,W===r?P:W)}}else if(s.indexOf(Ue(_),P)!=P){var K=M.lastIndexOf(_);K>-1&&(M=M.slice(0,K))}return M+m}function CE(s){return s=Mt(s),s&&ky.test(s)?s.replace(kc,r0):s}var IE=di(function(s,a,c){return s+(c?" ":"")+a.toUpperCase()}),mh=fd("toUpperCase");function up(s,a,c){return s=Mt(s),a=c?r:a,a===r?Z_(s)?s0(s):W_(s):s.match(a)||[]}var cp=xt(function(s,a){try{return Ne(s,r,a)}catch(c){return fh(c)?c:new dt(c)}}),PE=Xr(function(s,a){return je(a,function(c){c=Sr(c),Hr(s,c,uh(s[c],s))}),s});function RE(s){var a=s==null?0:s.length,c=at();return s=a?Xt(s,function(m){if(typeof m[1]!="function")throw new qe(l);return[c(m[0]),m[1]]}):[],xt(function(m){for(var _=-1;++_<a;){var A=s[_];if(Ne(A[0],this,m))return Ne(A[1],this,m)}})}function ME(s){return rx(Ze(s,p))}function vh(s){return function(){return s}}function DE(s,a){return s==null||s!==s?a:s}var BE=pd(),OE=pd(!0);function Oe(s){return s}function yh(s){return zf(typeof s=="function"?s:Ze(s,p))}function FE(s){return Vf(Ze(s,p))}function LE(s,a){return Yf(s,Ze(a,p))}var NE=xt(function(s,a){return function(c){return us(c,s,a)}}),kE=xt(function(s,a){return function(c){return us(s,c,a)}});function _h(s,a,c){var m=pe(a),_=mo(a,m);c==null&&!(Yt(a)&&(_.length||!m.length))&&(c=a,a=s,s=this,_=mo(a,pe(a)));var A=!(Yt(c)&&"chain"in c)||!!c.chain,C=Yr(s);return je(_,function(P){var M=a[P];s[P]=M,C&&(s.prototype[P]=function(){var U=this.__chain__;if(A||U){var G=s(this.__wrapped__),W=G.__actions__=Me(this.__actions__);return W.push({func:M,args:arguments,thisArg:s}),G.__chain__=U,G}return M.apply(s,sn([this.value()],arguments))})}),s}function UE(){return ve._===this&&(ve._=c0),this}function xh(){}function GE(s){return s=vt(s),xt(function(a){return jf(a,s)})}var $E=Zl(Xt),WE=Zl(gf),HE=Zl(wl);function fp(s){return ih(s)?El(Sr(s)):_x(s)}function zE(s){return function(a){return s==null?r:Dn(s,a)}}var XE=md(),VE=md(!0);function bh(){return[]}function wh(){return!1}function YE(){return{}}function jE(){return""}function qE(){return!0}function KE(s,a){if(s=vt(s),s<1||s>_t)return[];var c=nt,m=Ee(s,nt);a=at(a),s-=nt;for(var _=Sl(m,a);++c<s;)a(c);return _}function ZE(s){return gt(s)?Xt(s,Sr):Ge(s)?[s]:Me(Dd(Mt(s)))}function JE(s){var a=++h0;return Mt(s)+a}var QE=wo(function(s,a){return s+a},0),tT=Jl("ceil"),eT=wo(function(s,a){return s/a},1),rT=Jl("floor");function nT(s){return s&&s.length?go(s,Oe,Nl):r}function iT(s,a){return s&&s.length?go(s,at(a,2),Nl):r}function sT(s){return yf(s,Oe)}function oT(s,a){return yf(s,at(a,2))}function aT(s){return s&&s.length?go(s,Oe,$l):r}function lT(s,a){return s&&s.length?go(s,at(a,2),$l):r}var hT=wo(function(s,a){return s*a},1),uT=Jl("round"),cT=wo(function(s,a){return s-a},0);function fT(s){return s&&s.length?Al(s,Oe):0}function dT(s,a){return s&&s.length?Al(s,at(a,2)):0}return b.after=F1,b.ary=Hd,b.assign=ww,b.assignIn=np,b.assignInWith=Fo,b.assignWith=Ew,b.at=Tw,b.before=zd,b.bind=uh,b.bindAll=PE,b.bindKey=Xd,b.castArray=Y1,b.chain=Gd,b.chunk=rb,b.compact=nb,b.concat=ib,b.cond=RE,b.conforms=ME,b.constant=vh,b.countBy=f1,b.create=Aw,b.curry=Vd,b.curryRight=Yd,b.debounce=jd,b.defaults=Sw,b.defaultsDeep=Cw,b.defer=L1,b.delay=N1,b.difference=sb,b.differenceBy=ob,b.differenceWith=ab,b.drop=lb,b.dropRight=hb,b.dropRightWhile=ub,b.dropWhile=cb,b.fill=fb,b.filter=p1,b.flatMap=v1,b.flatMapDeep=y1,b.flatMapDepth=_1,b.flatten=Ld,b.flattenDeep=db,b.flattenDepth=pb,b.flip=k1,b.flow=BE,b.flowRight=OE,b.fromPairs=gb,b.functions=Ow,b.functionsIn=Fw,b.groupBy=x1,b.initial=vb,b.intersection=yb,b.intersectionBy=_b,b.intersectionWith=xb,b.invert=Nw,b.invertBy=kw,b.invokeMap=w1,b.iteratee=yh,b.keyBy=E1,b.keys=pe,b.keysIn=Be,b.map=Po,b.mapKeys=Gw,b.mapValues=$w,b.matches=FE,b.matchesProperty=LE,b.memoize=Mo,b.merge=Ww,b.mergeWith=ip,b.method=NE,b.methodOf=kE,b.mixin=_h,b.negate=Do,b.nthArg=GE,b.omit=Hw,b.omitBy=zw,b.once=U1,b.orderBy=T1,b.over=$E,b.overArgs=G1,b.overEvery=WE,b.overSome=HE,b.partial=ch,b.partialRight=qd,b.partition=A1,b.pick=Xw,b.pickBy=sp,b.property=fp,b.propertyOf=zE,b.pull=Tb,b.pullAll=kd,b.pullAllBy=Ab,b.pullAllWith=Sb,b.pullAt=Cb,b.range=XE,b.rangeRight=VE,b.rearg=$1,b.reject=I1,b.remove=Ib,b.rest=W1,b.reverse=lh,b.sampleSize=R1,b.set=Yw,b.setWith=jw,b.shuffle=M1,b.slice=Pb,b.sortBy=O1,b.sortedUniq=Lb,b.sortedUniqBy=Nb,b.split=vE,b.spread=H1,b.tail=kb,b.take=Ub,b.takeRight=Gb,b.takeRightWhile=$b,b.takeWhile=Wb,b.tap=n1,b.throttle=z1,b.thru=Io,b.toArray=tp,b.toPairs=op,b.toPairsIn=ap,b.toPath=ZE,b.toPlainObject=rp,b.transform=qw,b.unary=X1,b.union=Hb,b.unionBy=zb,b.unionWith=Xb,b.uniq=Vb,b.uniqBy=Yb,b.uniqWith=jb,b.unset=Kw,b.unzip=hh,b.unzipWith=Ud,b.update=Zw,b.updateWith=Jw,b.values=mi,b.valuesIn=Qw,b.without=qb,b.words=up,b.wrap=V1,b.xor=Kb,b.xorBy=Zb,b.xorWith=Jb,b.zip=Qb,b.zipObject=t1,b.zipObjectDeep=e1,b.zipWith=r1,b.entries=op,b.entriesIn=ap,b.extend=np,b.extendWith=Fo,_h(b,b),b.add=QE,b.attempt=cp,b.camelCase=nE,b.capitalize=lp,b.ceil=tT,b.clamp=tE,b.clone=j1,b.cloneDeep=K1,b.cloneDeepWith=Z1,b.cloneWith=q1,b.conformsTo=J1,b.deburr=hp,b.defaultTo=DE,b.divide=eT,b.endsWith=iE,b.eq=ar,b.escape=sE,b.escapeRegExp=oE,b.every=d1,b.find=g1,b.findIndex=Od,b.findKey=Iw,b.findLast=m1,b.findLastIndex=Fd,b.findLastKey=Pw,b.floor=rT,b.forEach=$d,b.forEachRight=Wd,b.forIn=Rw,b.forInRight=Mw,b.forOwn=Dw,b.forOwnRight=Bw,b.get=ph,b.gt=Q1,b.gte=tw,b.has=Lw,b.hasIn=gh,b.head=Nd,b.identity=Oe,b.includes=b1,b.indexOf=mb,b.inRange=eE,b.invoke=Uw,b.isArguments=Fn,b.isArray=gt,b.isArrayBuffer=ew,b.isArrayLike=De,b.isArrayLikeObject=re,b.isBoolean=rw,b.isBuffer=fn,b.isDate=nw,b.isElement=iw,b.isEmpty=sw,b.isEqual=ow,b.isEqualWith=aw,b.isError=fh,b.isFinite=lw,b.isFunction=Yr,b.isInteger=Kd,b.isLength=Bo,b.isMap=Zd,b.isMatch=hw,b.isMatchWith=uw,b.isNaN=cw,b.isNative=fw,b.isNil=pw,b.isNull=dw,b.isNumber=Jd,b.isObject=Yt,b.isObjectLike=te,b.isPlainObject=ms,b.isRegExp=dh,b.isSafeInteger=gw,b.isSet=Qd,b.isString=Oo,b.isSymbol=Ge,b.isTypedArray=gi,b.isUndefined=mw,b.isWeakMap=vw,b.isWeakSet=yw,b.join=bb,b.kebabCase=aE,b.last=Qe,b.lastIndexOf=wb,b.lowerCase=lE,b.lowerFirst=hE,b.lt=_w,b.lte=xw,b.max=nT,b.maxBy=iT,b.mean=sT,b.meanBy=oT,b.min=aT,b.minBy=lT,b.stubArray=bh,b.stubFalse=wh,b.stubObject=YE,b.stubString=jE,b.stubTrue=qE,b.multiply=hT,b.nth=Eb,b.noConflict=UE,b.noop=xh,b.now=Ro,b.pad=uE,b.padEnd=cE,b.padStart=fE,b.parseInt=dE,b.random=rE,b.reduce=S1,b.reduceRight=C1,b.repeat=pE,b.replace=gE,b.result=Vw,b.round=uT,b.runInContext=R,b.sample=P1,b.size=D1,b.snakeCase=mE,b.some=B1,b.sortedIndex=Rb,b.sortedIndexBy=Mb,b.sortedIndexOf=Db,b.sortedLastIndex=Bb,b.sortedLastIndexBy=Ob,b.sortedLastIndexOf=Fb,b.startCase=yE,b.startsWith=_E,b.subtract=cT,b.sum=fT,b.sumBy=dT,b.template=xE,b.times=KE,b.toFinite=jr,b.toInteger=vt,b.toLength=ep,b.toLower=bE,b.toNumber=tr,b.toSafeInteger=bw,b.toString=Mt,b.toUpper=wE,b.trim=EE,b.trimEnd=TE,b.trimStart=AE,b.truncate=SE,b.unescape=CE,b.uniqueId=JE,b.upperCase=IE,b.upperFirst=mh,b.each=$d,b.eachRight=Wd,b.first=Nd,_h(b,function(){var s={};return Tr(b,function(a,c){Ot.call(b.prototype,c)||(s[c]=a)}),s}(),{chain:!1}),b.VERSION=n,je(["bind","bindKey","curry","curryRight","partial","partialRight"],function(s){b[s].placeholder=b}),je(["drop","take"],function(s,a){Et.prototype[s]=function(c){c=c===r?1:ce(vt(c),0);var m=this.__filtered__&&!a?new Et(this):this.clone();return m.__filtered__?m.__takeCount__=Ee(c,m.__takeCount__):m.__views__.push({size:Ee(c,nt),type:s+(m.__dir__<0?"Right":"")}),m},Et.prototype[s+"Right"]=function(c){return this.reverse()[s](c).reverse()}}),je(["filter","map","takeWhile"],function(s,a){var c=a+1,m=c==k||c==pt;Et.prototype[s]=function(_){var A=this.clone();return A.__iteratees__.push({iteratee:at(_,3),type:c}),A.__filtered__=A.__filtered__||m,A}}),je(["head","last"],function(s,a){var c="take"+(a?"Right":"");Et.prototype[s]=function(){return this[c](1).value()[0]}}),je(["initial","tail"],function(s,a){var c="drop"+(a?"":"Right");Et.prototype[s]=function(){return this.__filtered__?new Et(this):this[c](1)}}),Et.prototype.compact=function(){return this.filter(Oe)},Et.prototype.find=function(s){return this.filter(s).head()},Et.prototype.findLast=function(s){return this.reverse().find(s)},Et.prototype.invokeMap=xt(function(s,a){return typeof s=="function"?new Et(this):this.map(function(c){return us(c,s,a)})}),Et.prototype.reject=function(s){return this.filter(Do(at(s)))},Et.prototype.slice=function(s,a){s=vt(s);var c=this;return c.__filtered__&&(s>0||a<0)?new Et(c):(s<0?c=c.takeRight(-s):s&&(c=c.drop(s)),a!==r&&(a=vt(a),c=a<0?c.dropRight(-a):c.take(a-s)),c)},Et.prototype.takeRightWhile=function(s){return this.reverse().takeWhile(s).reverse()},Et.prototype.toArray=function(){return this.take(nt)},Tr(Et.prototype,function(s,a){var c=/^(?:filter|find|map|reject)|While$/.test(a),m=/^(?:head|last)$/.test(a),_=b[m?"take"+(a=="last"?"Right":""):a],A=m||/^find/.test(a);_&&(b.prototype[a]=function(){var C=this.__wrapped__,P=m?[1]:arguments,M=C instanceof Et,U=P[0],G=M||gt(C),W=function(bt){var St=_.apply(b,sn([bt],P));return m&&K?St[0]:St};G&&c&&typeof U=="function"&&U.length!=1&&(M=G=!1);var K=this.__chain__,et=!!this.__actions__.length,ht=A&&!K,yt=M&&!et;if(!A&&G){C=yt?C:new Et(this);var ut=s.apply(C,P);return ut.__actions__.push({func:Io,args:[W],thisArg:r}),new Ke(ut,K)}return ht&&yt?s.apply(this,P):(ut=this.thru(W),ht?m?ut.value()[0]:ut.value():ut)})}),je(["pop","push","shift","sort","splice","unshift"],function(s){var a=Qs[s],c=/^(?:push|sort|unshift)$/.test(s)?"tap":"thru",m=/^(?:pop|shift)$/.test(s);b.prototype[s]=function(){var _=arguments;if(m&&!this.__chain__){var A=this.value();return a.apply(gt(A)?A:[],_)}return this[c](function(C){return a.apply(gt(C)?C:[],_)})}}),Tr(Et.prototype,function(s,a){var c=b[a];if(c){var m=c.name+"";Ot.call(ui,m)||(ui[m]=[]),ui[m].push({name:a,func:c})}}),ui[bo(r,T).name]=[{name:"wrapper",func:r}],Et.prototype.clone=C0,Et.prototype.reverse=I0,Et.prototype.value=P0,b.prototype.at=i1,b.prototype.chain=s1,b.prototype.commit=o1,b.prototype.next=a1,b.prototype.plant=h1,b.prototype.reverse=u1,b.prototype.toJSON=b.prototype.valueOf=b.prototype.value=c1,b.prototype.first=b.prototype.head,ns&&(b.prototype[ns]=l1),b},ai=o0();Cn?((Cn.exports=ai)._=ai,yl._=ai):ve._=ai}).call(Dr)})(wa,wa.exports);var Ut=wa.exports;const Ln=Ha(Ut);var ei=(e=>(e[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2",e))(ei||{}),_u=(e=>(e[e.COLOR=16384]="COLOR",e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL",e))(_u||{}),ct=(e=>(e[e.NORMAL=0]="NORMAL",e[e.ADD=1]="ADD",e[e.MULTIPLY=2]="MULTIPLY",e[e.SCREEN=3]="SCREEN",e[e.OVERLAY=4]="OVERLAY",e[e.DARKEN=5]="DARKEN",e[e.LIGHTEN=6]="LIGHTEN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.COLOR_BURN=8]="COLOR_BURN",e[e.HARD_LIGHT=9]="HARD_LIGHT",e[e.SOFT_LIGHT=10]="SOFT_LIGHT",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.EXCLUSION=12]="EXCLUSION",e[e.HUE=13]="HUE",e[e.SATURATION=14]="SATURATION",e[e.COLOR=15]="COLOR",e[e.LUMINOSITY=16]="LUMINOSITY",e[e.NORMAL_NPM=17]="NORMAL_NPM",e[e.ADD_NPM=18]="ADD_NPM",e[e.SCREEN_NPM=19]="SCREEN_NPM",e[e.NONE=20]="NONE",e[e.SRC_OVER=0]="SRC_OVER",e[e.SRC_IN=21]="SRC_IN",e[e.SRC_OUT=22]="SRC_OUT",e[e.SRC_ATOP=23]="SRC_ATOP",e[e.DST_OVER=24]="DST_OVER",e[e.DST_IN=25]="DST_IN",e[e.DST_OUT=26]="DST_OUT",e[e.DST_ATOP=27]="DST_ATOP",e[e.ERASE=26]="ERASE",e[e.SUBTRACT=28]="SUBTRACT",e[e.XOR=29]="XOR",e))(ct||{}),Br=(e=>(e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e))(Br||{}),Y=(e=>(e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e))(Y||{}),Bi=(e=>(e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e))(Bi||{}),ot=(e=>(e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT",e))(ot||{}),xu=(e=>(e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT",e[e.UINT=2]="UINT",e))(xu||{}),Jr=(e=>(e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e))(Jr||{}),_n=(e=>(e[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e))(_n||{}),Lr=(e=>(e[e.OFF=0]="OFF",e[e.POW2=1]="POW2",e[e.ON=2]="ON",e[e.ON_MANUAL=3]="ON_MANUAL",e))(Lr||{}),wr=(e=>(e[e.NPM=0]="NPM",e[e.UNPACK=1]="UNPACK",e[e.PMA=2]="PMA",e[e.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",e[e.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",e[e.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",e))(wr||{}),Rr=(e=>(e[e.NO=0]="NO",e[e.YES=1]="YES",e[e.AUTO=2]="AUTO",e[e.BLEND=0]="BLEND",e[e.CLEAR=1]="CLEAR",e[e.BLIT=2]="BLIT",e))(Rr||{}),hc=(e=>(e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL",e))(hc||{}),rr=(e=>(e.LOW="lowp",e.MEDIUM="mediump",e.HIGH="highp",e))(rr||{}),de=(e=>(e[e.NONE=0]="NONE",e[e.SCISSOR=1]="SCISSOR",e[e.STENCIL=2]="STENCIL",e[e.SPRITE=3]="SPRITE",e[e.COLOR=4]="COLOR",e))(de||{}),le=(e=>(e[e.NONE=0]="NONE",e[e.LOW=2]="LOW",e[e.MEDIUM=4]="MEDIUM",e[e.HIGH=8]="HIGH",e))(le||{}),Or=(e=>(e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e))(Or||{});const vT={createCanvas:(e,t)=>{const r=document.createElement("canvas");return r.width=e,r.height=t,r},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(e,t)=>fetch(e,t),parseXML:e=>new DOMParser().parseFromString(e,"text/xml")},Q={ADAPTER:vT,RESOLUTION:1,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,premultipliedAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1,hello:!1},CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Eh=/iPhone/i,pp=/iPod/i,gp=/iPad/i,mp=/\biOS-universal(?:.+)Mac\b/i,Th=/\bAndroid(?:.+)Mobile\b/i,vp=/Android/i,vi=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Lo=/Silk/i,Kr=/Windows Phone/i,yp=/\bWindows(?:.+)ARM\b/i,_p=/BlackBerry/i,xp=/BB10/i,bp=/Opera Mini/i,wp=/\b(CriOS|Chrome)(?:.+)Mobile/i,Ep=/Mobile(?:.+)Firefox\b/i,Tp=function(e){return typeof e<"u"&&e.platform==="MacIntel"&&typeof e.maxTouchPoints=="number"&&e.maxTouchPoints>1&&typeof MSStream>"u"};function yT(e){return function(t){return t.test(e)}}function _T(e){var t={userAgent:"",platform:"",maxTouchPoints:0};!e&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof e=="string"?t.userAgent=e:e&&e.userAgent&&(t={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0});var r=t.userAgent,n=r.split("[FBAN");typeof n[1]<"u"&&(r=n[0]),n=r.split("Twitter"),typeof n[1]<"u"&&(r=n[0]);var i=yT(r),o={apple:{phone:i(Eh)&&!i(Kr),ipod:i(pp),tablet:!i(Eh)&&(i(gp)||Tp(t))&&!i(Kr),universal:i(mp),device:(i(Eh)||i(pp)||i(gp)||i(mp)||Tp(t))&&!i(Kr)},amazon:{phone:i(vi),tablet:!i(vi)&&i(Lo),device:i(vi)||i(Lo)},android:{phone:!i(Kr)&&i(vi)||!i(Kr)&&i(Th),tablet:!i(Kr)&&!i(vi)&&!i(Th)&&(i(Lo)||i(vp)),device:!i(Kr)&&(i(vi)||i(Lo)||i(Th)||i(vp))||i(/\bokhttp\b/i)},windows:{phone:i(Kr),tablet:i(yp),device:i(Kr)||i(yp)},other:{blackberry:i(_p),blackberry10:i(xp),opera:i(bp),firefox:i(Ep),chrome:i(wp),device:i(_p)||i(xp)||i(bp)||i(Ep)||i(wp)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}const Qr=_T(globalThis.navigator);Q.RETINA_PREFIX=/@([0-9\.]+)x/;Q.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var cm={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function i(u,f,d){this.fn=u,this.context=f,this.once=d||!1}function o(u,f,d,p,g){if(typeof d!="function")throw new TypeError("The listener must be a function");var v=new i(d,p||u,g),y=r?r+f:f;return u._events[y]?u._events[y].fn?u._events[y]=[u._events[y],v]:u._events[y].push(v):(u._events[y]=v,u._eventsCount++),u}function l(u,f){--u._eventsCount===0?u._events=new n:delete u._events[f]}function h(){this._events=new n,this._eventsCount=0}h.prototype.eventNames=function(){var f=[],d,p;if(this._eventsCount===0)return f;for(p in d=this._events)t.call(d,p)&&f.push(r?p.slice(1):p);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(d)):f},h.prototype.listeners=function(f){var d=r?r+f:f,p=this._events[d];if(!p)return[];if(p.fn)return[p.fn];for(var g=0,v=p.length,y=new Array(v);g<v;g++)y[g]=p[g].fn;return y},h.prototype.listenerCount=function(f){var d=r?r+f:f,p=this._events[d];return p?p.fn?1:p.length:0},h.prototype.emit=function(f,d,p,g,v,y){var w=r?r+f:f;if(!this._events[w])return!1;var x=this._events[w],T=arguments.length,S,E;if(x.fn){switch(x.once&&this.removeListener(f,x.fn,void 0,!0),T){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,d),!0;case 3:return x.fn.call(x.context,d,p),!0;case 4:return x.fn.call(x.context,d,p,g),!0;case 5:return x.fn.call(x.context,d,p,g,v),!0;case 6:return x.fn.call(x.context,d,p,g,v,y),!0}for(E=1,S=new Array(T-1);E<T;E++)S[E-1]=arguments[E];x.fn.apply(x.context,S)}else{var I=x.length,D;for(E=0;E<I;E++)switch(x[E].once&&this.removeListener(f,x[E].fn,void 0,!0),T){case 1:x[E].fn.call(x[E].context);break;case 2:x[E].fn.call(x[E].context,d);break;case 3:x[E].fn.call(x[E].context,d,p);break;case 4:x[E].fn.call(x[E].context,d,p,g);break;default:if(!S)for(D=1,S=new Array(T-1);D<T;D++)S[D-1]=arguments[D];x[E].fn.apply(x[E].context,S)}}return!0},h.prototype.on=function(f,d,p){return o(this,f,d,p,!1)},h.prototype.once=function(f,d,p){return o(this,f,d,p,!0)},h.prototype.removeListener=function(f,d,p,g){var v=r?r+f:f;if(!this._events[v])return this;if(!d)return l(this,v),this;var y=this._events[v];if(y.fn)y.fn===d&&(!g||y.once)&&(!p||y.context===p)&&l(this,v);else{for(var w=0,x=[],T=y.length;w<T;w++)(y[w].fn!==d||g&&!y[w].once||p&&y[w].context!==p)&&x.push(y[w]);x.length?this._events[v]=x.length===1?x[0]:x:l(this,v)}return this},h.prototype.removeAllListeners=function(f){var d;return f?(d=r?r+f:f,this._events[d]&&l(this,d)):(this._events=new n,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=r,h.EventEmitter=h,e.exports=h})(cm);var xT=cm.exports;const Gs=Ha(xT);var uc={exports:{}};uc.exports=za;uc.exports.default=za;function za(e,t,r){r=r||2;var n=t&&t.length,i=n?t[0]*r:e.length,o=fm(e,0,i,r,!0),l=[];if(!o||o.next===o.prev)return l;var h,u,f,d,p,g,v;if(n&&(o=AT(e,t,o,r)),e.length>80*r){h=f=e[0],u=d=e[1];for(var y=r;y<i;y+=r)p=e[y],g=e[y+1],p<h&&(h=p),g<u&&(u=g),p>f&&(f=p),g>d&&(d=g);v=Math.max(f-h,d-u),v=v!==0?32767/v:0}return Ds(o,l,r,h,u,v,0),l}function fm(e,t,r,n,i){var o,l;if(i===Eu(e,t,r,n)>0)for(o=t;o<r;o+=n)l=Ap(o,e[o],e[o+1],l);else for(o=r-n;o>=t;o-=n)l=Ap(o,e[o],e[o+1],l);return l&&Xa(l,l.next)&&(Os(l),l=l.next),l}function Zn(e,t){if(!e)return e;t||(t=e);var r=e,n;do if(n=!1,!r.steiner&&(Xa(r,r.next)||qt(r.prev,r,r.next)===0)){if(Os(r),r=t=r.prev,r===r.next)break;n=!0}else r=r.next;while(n||r!==t);return t}function Ds(e,t,r,n,i,o,l){if(e){!l&&o&&RT(e,n,i,o);for(var h=e,u,f;e.prev!==e.next;){if(u=e.prev,f=e.next,o?wT(e,n,i,o):bT(e)){t.push(u.i/r|0),t.push(e.i/r|0),t.push(f.i/r|0),Os(e),e=f.next,h=f.next;continue}if(e=f,e===h){l?l===1?(e=ET(Zn(e),t,r),Ds(e,t,r,n,i,o,2)):l===2&&TT(e,t,r,n,i,o):Ds(Zn(e),t,r,n,i,o,1);break}}}}function bT(e){var t=e.prev,r=e,n=e.next;if(qt(t,r,n)>=0)return!1;for(var i=t.x,o=r.x,l=n.x,h=t.y,u=r.y,f=n.y,d=i<o?i<l?i:l:o<l?o:l,p=h<u?h<f?h:f:u<f?u:f,g=i>o?i>l?i:l:o>l?o:l,v=h>u?h>f?h:f:u>f?u:f,y=n.next;y!==t;){if(y.x>=d&&y.x<=g&&y.y>=p&&y.y<=v&&Ii(i,h,o,u,l,f,y.x,y.y)&&qt(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function wT(e,t,r,n){var i=e.prev,o=e,l=e.next;if(qt(i,o,l)>=0)return!1;for(var h=i.x,u=o.x,f=l.x,d=i.y,p=o.y,g=l.y,v=h<u?h<f?h:f:u<f?u:f,y=d<p?d<g?d:g:p<g?p:g,w=h>u?h>f?h:f:u>f?u:f,x=d>p?d>g?d:g:p>g?p:g,T=bu(v,y,t,r,n),S=bu(w,x,t,r,n),E=e.prevZ,I=e.nextZ;E&&E.z>=T&&I&&I.z<=S;){if(E.x>=v&&E.x<=w&&E.y>=y&&E.y<=x&&E!==i&&E!==l&&Ii(h,d,u,p,f,g,E.x,E.y)&&qt(E.prev,E,E.next)>=0||(E=E.prevZ,I.x>=v&&I.x<=w&&I.y>=y&&I.y<=x&&I!==i&&I!==l&&Ii(h,d,u,p,f,g,I.x,I.y)&&qt(I.prev,I,I.next)>=0))return!1;I=I.nextZ}for(;E&&E.z>=T;){if(E.x>=v&&E.x<=w&&E.y>=y&&E.y<=x&&E!==i&&E!==l&&Ii(h,d,u,p,f,g,E.x,E.y)&&qt(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;I&&I.z<=S;){if(I.x>=v&&I.x<=w&&I.y>=y&&I.y<=x&&I!==i&&I!==l&&Ii(h,d,u,p,f,g,I.x,I.y)&&qt(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function ET(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!Xa(i,o)&&dm(i,n,n.next,o)&&Bs(i,o)&&Bs(o,i)&&(t.push(i.i/r|0),t.push(n.i/r|0),t.push(o.i/r|0),Os(n),Os(n.next),n=e=o),n=n.next}while(n!==e);return Zn(n)}function TT(e,t,r,n,i,o){var l=e;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&BT(l,h)){var u=pm(l,h);l=Zn(l,l.next),u=Zn(u,u.next),Ds(l,t,r,n,i,o,0),Ds(u,t,r,n,i,o,0);return}h=h.next}l=l.next}while(l!==e)}function AT(e,t,r,n){var i=[],o,l,h,u,f;for(o=0,l=t.length;o<l;o++)h=t[o]*n,u=o<l-1?t[o+1]*n:e.length,f=fm(e,h,u,n,!1),f===f.next&&(f.steiner=!0),i.push(DT(f));for(i.sort(ST),o=0;o<i.length;o++)r=CT(i[o],r);return r}function ST(e,t){return e.x-t.x}function CT(e,t){var r=IT(e,t);if(!r)return t;var n=pm(r,e);return Zn(n,n.next),Zn(r,r.next)}function IT(e,t){var r=t,n=e.x,i=e.y,o=-1/0,l;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var h=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(h<=n&&h>o&&(o=h,l=r.x<r.next.x?r:r.next,h===n))return l}r=r.next}while(r!==t);if(!l)return null;var u=l,f=l.x,d=l.y,p=1/0,g;r=l;do n>=r.x&&r.x>=f&&n!==r.x&&Ii(i<d?n:o,i,f,d,i<d?o:n,i,r.x,r.y)&&(g=Math.abs(i-r.y)/(n-r.x),Bs(r,e)&&(g<p||g===p&&(r.x>l.x||r.x===l.x&&PT(l,r)))&&(l=r,p=g)),r=r.next;while(r!==u);return l}function PT(e,t){return qt(e.prev,e,t.prev)<0&&qt(t.next,e,e.next)<0}function RT(e,t,r,n){var i=e;do i.z===0&&(i.z=bu(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,MT(i)}function MT(e){var t,r,n,i,o,l,h,u,f=1;do{for(r=e,e=null,o=null,l=0;r;){for(l++,n=r,h=0,t=0;t<f&&(h++,n=n.nextZ,!!n);t++);for(u=f;h>0||u>0&&n;)h!==0&&(u===0||!n||r.z<=n.z)?(i=r,r=r.nextZ,h--):(i=n,n=n.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,f*=2}while(l>1);return e}function bu(e,t,r,n,i){return e=(e-r)*i|0,t=(t-n)*i|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function DT(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function Ii(e,t,r,n,i,o,l,h){return(i-l)*(t-h)>=(e-l)*(o-h)&&(e-l)*(n-h)>=(r-l)*(t-h)&&(r-l)*(o-h)>=(i-l)*(n-h)}function BT(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!OT(e,t)&&(Bs(e,t)&&Bs(t,e)&&FT(e,t)&&(qt(e.prev,e,t.prev)||qt(e,t.prev,t))||Xa(e,t)&&qt(e.prev,e,e.next)>0&&qt(t.prev,t,t.next)>0)}function qt(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Xa(e,t){return e.x===t.x&&e.y===t.y}function dm(e,t,r,n){var i=ko(qt(e,t,r)),o=ko(qt(e,t,n)),l=ko(qt(r,n,e)),h=ko(qt(r,n,t));return!!(i!==o&&l!==h||i===0&&No(e,r,t)||o===0&&No(e,n,t)||l===0&&No(r,e,n)||h===0&&No(r,t,n))}function No(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function ko(e){return e>0?1:e<0?-1:0}function OT(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&dm(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function Bs(e,t){return qt(e.prev,e,e.next)<0?qt(e,t,e.next)>=0&&qt(e,e.prev,t)>=0:qt(e,t,e.prev)<0||qt(e,e.next,t)<0}function FT(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e);return n}function pm(e,t){var r=new wu(e.i,e.x,e.y),n=new wu(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function Ap(e,t,r,n){var i=new wu(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Os(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function wu(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}za.deviation=function(e,t,r,n){var i=t&&t.length,o=i?t[0]*r:e.length,l=Math.abs(Eu(e,0,o,r));if(i)for(var h=0,u=t.length;h<u;h++){var f=t[h]*r,d=h<u-1?t[h+1]*r:e.length;l-=Math.abs(Eu(e,f,d,r))}var p=0;for(h=0;h<n.length;h+=3){var g=n[h]*r,v=n[h+1]*r,y=n[h+2]*r;p+=Math.abs((e[g]-e[y])*(e[v+1]-e[g+1])-(e[g]-e[v])*(e[y+1]-e[g+1]))}return l===0&&p===0?0:Math.abs((p-l)/l)};function Eu(e,t,r,n){for(var i=0,o=t,l=r-n;o<r;o+=n)i+=(e[l]-e[o])*(e[o+1]+e[l+1]),l=o;return i}za.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var l=0;l<t;l++)r.vertices.push(e[i][o][l]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r};var LT=uc.exports;const NT=Ha(LT);var Ea={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */Ea.exports;(function(e,t){(function(r){var n=t&&!t.nodeType&&t,i=e&&!e.nodeType&&e,o=typeof Dr=="object"&&Dr;(o.global===o||o.window===o||o.self===o)&&(r=o);var l,h=2147483647,u=36,f=1,d=26,p=38,g=700,v=72,y=128,w="-",x=/^xn--/,T=/[^\x20-\x7E]/,S=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},I=u-f,D=Math.floor,L=String.fromCharCode,O;function F(H){throw new RangeError(E[H])}function X(H,nt){for(var wt=H.length,Rt=[];wt--;)Rt[wt]=nt(H[wt]);return Rt}function q(H,nt){var wt=H.split("@"),Rt="";wt.length>1&&(Rt=wt[0]+"@",H=wt[1]),H=H.replace(S,".");var Dt=H.split("."),Gt=X(Dt,nt).join(".");return Rt+Gt}function V(H){for(var nt=[],wt=0,Rt=H.length,Dt,Gt;wt<Rt;)Dt=H.charCodeAt(wt++),Dt>=55296&&Dt<=56319&&wt<Rt?(Gt=H.charCodeAt(wt++),(Gt&64512)==56320?nt.push(((Dt&1023)<<10)+(Gt&1023)+65536):(nt.push(Dt),wt--)):nt.push(Dt);return nt}function Z(H){return X(H,function(nt){var wt="";return nt>65535&&(nt-=65536,wt+=L(nt>>>10&1023|55296),nt=56320|nt&1023),wt+=L(nt),wt}).join("")}function $(H){return H-48<10?H-22:H-65<26?H-65:H-97<26?H-97:u}function k(H,nt){return H+22+75*(H<26)-((nt!=0)<<5)}function lt(H,nt,wt){var Rt=0;for(H=wt?D(H/g):H>>1,H+=D(H/nt);H>I*d>>1;Rt+=u)H=D(H/I);return D(Rt+(I+1)*H/(H+p))}function pt(H){var nt=[],wt=H.length,Rt,Dt=0,Gt=y,$t=v,oe,Zt,ae,he,Bt,Wt,Jt,Qt,we;for(oe=H.lastIndexOf(w),oe<0&&(oe=0),Zt=0;Zt<oe;++Zt)H.charCodeAt(Zt)>=128&&F("not-basic"),nt.push(H.charCodeAt(Zt));for(ae=oe>0?oe+1:0;ae<wt;){for(he=Dt,Bt=1,Wt=u;ae>=wt&&F("invalid-input"),Jt=$(H.charCodeAt(ae++)),(Jt>=u||Jt>D((h-Dt)/Bt))&&F("overflow"),Dt+=Jt*Bt,Qt=Wt<=$t?f:Wt>=$t+d?d:Wt-$t,!(Jt<Qt);Wt+=u)we=u-Qt,Bt>D(h/we)&&F("overflow"),Bt*=we;Rt=nt.length+1,$t=lt(Dt-he,Rt,he==0),D(Dt/Rt)>h-Gt&&F("overflow"),Gt+=D(Dt/Rt),Dt%=Rt,nt.splice(Dt++,0,Gt)}return Z(nt)}function j(H){var nt,wt,Rt,Dt,Gt,$t,oe,Zt,ae,he,Bt,Wt=[],Jt,Qt,we,Sn;for(H=V(H),Jt=H.length,nt=y,wt=0,Gt=v,$t=0;$t<Jt;++$t)Bt=H[$t],Bt<128&&Wt.push(L(Bt));for(Rt=Dt=Wt.length,Dt&&Wt.push(w);Rt<Jt;){for(oe=h,$t=0;$t<Jt;++$t)Bt=H[$t],Bt>=nt&&Bt<oe&&(oe=Bt);for(Qt=Rt+1,oe-nt>D((h-wt)/Qt)&&F("overflow"),wt+=(oe-nt)*Qt,nt=oe,$t=0;$t<Jt;++$t)if(Bt=H[$t],Bt<nt&&++wt>h&&F("overflow"),Bt==nt){for(Zt=wt,ae=u;he=ae<=Gt?f:ae>=Gt+d?d:ae-Gt,!(Zt<he);ae+=u)Sn=Zt-he,we=u-he,Wt.push(L(k(he+Sn%we,0))),Zt=D(Sn/we);Wt.push(L(k(Zt,0))),Gt=lt(wt,Qt,Rt==Dt),wt=0,++Rt}++wt,++nt}return Wt.join("")}function _t(H){return q(H,function(nt){return x.test(nt)?pt(nt.slice(4).toLowerCase()):nt})}function Ft(H){return q(H,function(nt){return T.test(nt)?"xn--"+j(nt):nt})}if(l={version:"1.4.1",ucs2:{decode:V,encode:Z},decode:pt,encode:j,toASCII:Ft,toUnicode:_t},n&&i)if(e.exports==n)i.exports=l;else for(O in l)l.hasOwnProperty(O)&&(n[O]=l[O]);else r.punycode=l})(Dr)})(Ea,Ea.exports);var kT=Ea.exports,UT=Error,GT=EvalError,$T=RangeError,WT=ReferenceError,gm=SyntaxError,$s=TypeError,HT=URIError,zT=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;t[r]=i;for(r in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==r||!Object.prototype.propertyIsEnumerable.call(t,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var l=Object.getOwnPropertyDescriptor(t,r);if(l.value!==i||l.enumerable!==!0)return!1}return!0},Sp=typeof Symbol<"u"&&Symbol,XT=zT,VT=function(){return typeof Sp!="function"||typeof Symbol!="function"||typeof Sp("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:XT()},Ah={__proto__:null,foo:{}},YT=Object,jT=function(){return{__proto__:Ah}.foo===Ah.foo&&!(Ah instanceof YT)},qT="Function.prototype.bind called on incompatible ",KT=Object.prototype.toString,ZT=Math.max,JT="[object Function]",Cp=function(t,r){for(var n=[],i=0;i<t.length;i+=1)n[i]=t[i];for(var o=0;o<r.length;o+=1)n[o+t.length]=r[o];return n},QT=function(t,r){for(var n=[],i=r,o=0;i<t.length;i+=1,o+=1)n[o]=t[i];return n},tA=function(e,t){for(var r="",n=0;n<e.length;n+=1)r+=e[n],n+1<e.length&&(r+=t);return r},eA=function(t){var r=this;if(typeof r!="function"||KT.apply(r)!==JT)throw new TypeError(qT+r);for(var n=QT(arguments,1),i,o=function(){if(this instanceof i){var d=r.apply(this,Cp(n,arguments));return Object(d)===d?d:this}return r.apply(t,Cp(n,arguments))},l=ZT(0,r.length-n.length),h=[],u=0;u<l;u++)h[u]="$"+u;if(i=Function("binder","return function ("+tA(h,",")+"){ return binder.apply(this,arguments); }")(o),r.prototype){var f=function(){};f.prototype=r.prototype,i.prototype=new f,f.prototype=null}return i},rA=eA,cc=Function.prototype.bind||rA,nA=Function.prototype.call,iA=Object.prototype.hasOwnProperty,sA=cc,oA=sA.call(nA,iA),Tt,aA=UT,lA=GT,hA=$T,uA=WT,Ui=gm,Oi=$s,cA=HT,mm=Function,Sh=function(e){try{return mm('"use strict"; return ('+e+").constructor;")()}catch{}},jn=Object.getOwnPropertyDescriptor;if(jn)try{jn({},"")}catch{jn=null}var Ch=function(){throw new Oi},fA=jn?function(){try{return arguments.callee,Ch}catch{try{return jn(arguments,"callee").get}catch{return Ch}}}():Ch,yi=VT(),dA=jT(),ge=Object.getPrototypeOf||(dA?function(e){return e.__proto__}:null),Ei={},pA=typeof Uint8Array>"u"||!ge?Tt:ge(Uint8Array),qn={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Tt:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Tt:ArrayBuffer,"%ArrayIteratorPrototype%":yi&&ge?ge([][Symbol.iterator]()):Tt,"%AsyncFromSyncIteratorPrototype%":Tt,"%AsyncFunction%":Ei,"%AsyncGenerator%":Ei,"%AsyncGeneratorFunction%":Ei,"%AsyncIteratorPrototype%":Ei,"%Atomics%":typeof Atomics>"u"?Tt:Atomics,"%BigInt%":typeof BigInt>"u"?Tt:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Tt:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Tt:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Tt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":aA,"%eval%":eval,"%EvalError%":lA,"%Float32Array%":typeof Float32Array>"u"?Tt:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Tt:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Tt:FinalizationRegistry,"%Function%":mm,"%GeneratorFunction%":Ei,"%Int8Array%":typeof Int8Array>"u"?Tt:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Tt:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Tt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":yi&&ge?ge(ge([][Symbol.iterator]())):Tt,"%JSON%":typeof JSON=="object"?JSON:Tt,"%Map%":typeof Map>"u"?Tt:Map,"%MapIteratorPrototype%":typeof Map>"u"||!yi||!ge?Tt:ge(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Tt:Promise,"%Proxy%":typeof Proxy>"u"?Tt:Proxy,"%RangeError%":hA,"%ReferenceError%":uA,"%Reflect%":typeof Reflect>"u"?Tt:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Tt:Set,"%SetIteratorPrototype%":typeof Set>"u"||!yi||!ge?Tt:ge(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Tt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":yi&&ge?ge(""[Symbol.iterator]()):Tt,"%Symbol%":yi?Symbol:Tt,"%SyntaxError%":Ui,"%ThrowTypeError%":fA,"%TypedArray%":pA,"%TypeError%":Oi,"%Uint8Array%":typeof Uint8Array>"u"?Tt:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Tt:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Tt:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Tt:Uint32Array,"%URIError%":cA,"%WeakMap%":typeof WeakMap>"u"?Tt:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Tt:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Tt:WeakSet};if(ge)try{null.error}catch(e){var gA=ge(ge(e));qn["%Error.prototype%"]=gA}var mA=function e(t){var r;if(t==="%AsyncFunction%")r=Sh("async function () {}");else if(t==="%GeneratorFunction%")r=Sh("function* () {}");else if(t==="%AsyncGeneratorFunction%")r=Sh("async function* () {}");else if(t==="%AsyncGenerator%"){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if(t==="%AsyncIteratorPrototype%"){var i=e("%AsyncGenerator%");i&&ge&&(r=ge(i.prototype))}return qn[t]=r,r},Ip={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Ws=cc,Ta=oA,vA=Ws.call(Function.call,Array.prototype.concat),yA=Ws.call(Function.apply,Array.prototype.splice),Pp=Ws.call(Function.call,String.prototype.replace),Aa=Ws.call(Function.call,String.prototype.slice),_A=Ws.call(Function.call,RegExp.prototype.exec),xA=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,bA=/\\(\\)?/g,wA=function(t){var r=Aa(t,0,1),n=Aa(t,-1);if(r==="%"&&n!=="%")throw new Ui("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&r!=="%")throw new Ui("invalid intrinsic syntax, expected opening `%`");var i=[];return Pp(t,xA,function(o,l,h,u){i[i.length]=h?Pp(u,bA,"$1"):l||o}),i},EA=function(t,r){var n=t,i;if(Ta(Ip,n)&&(i=Ip[n],n="%"+i[0]+"%"),Ta(qn,n)){var o=qn[n];if(o===Ei&&(o=mA(n)),typeof o>"u"&&!r)throw new Oi("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:o}}throw new Ui("intrinsic "+t+" does not exist!")},ji=function(t,r){if(typeof t!="string"||t.length===0)throw new Oi("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof r!="boolean")throw new Oi('"allowMissing" argument must be a boolean');if(_A(/^%?[^%]*%?$/,t)===null)throw new Ui("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=wA(t),i=n.length>0?n[0]:"",o=EA("%"+i+"%",r),l=o.name,h=o.value,u=!1,f=o.alias;f&&(i=f[0],yA(n,vA([0,1],f)));for(var d=1,p=!0;d<n.length;d+=1){var g=n[d],v=Aa(g,0,1),y=Aa(g,-1);if((v==='"'||v==="'"||v==="`"||y==='"'||y==="'"||y==="`")&&v!==y)throw new Ui("property names with quotes must have matching quotes");if((g==="constructor"||!p)&&(u=!0),i+="."+g,l="%"+i+"%",Ta(qn,l))h=qn[l];else if(h!=null){if(!(g in h)){if(!r)throw new Oi("base intrinsic for "+t+" exists, but the property is not available.");return}if(jn&&d+1>=n.length){var w=jn(h,g);p=!!w,p&&"get"in w&&!("originalValue"in w.get)?h=w.get:h=h[g]}else p=Ta(h,g),h=h[g];p&&!u&&(qn[l]=h)}}return h},vm={exports:{}},Ih,Rp;function fc(){if(Rp)return Ih;Rp=1;var e=ji,t=e("%Object.defineProperty%",!0)||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return Ih=t,Ih}var TA=ji,da=TA("%Object.getOwnPropertyDescriptor%",!0);if(da)try{da([],"length")}catch{da=null}var ym=da,Mp=fc(),AA=gm,_i=$s,Dp=ym,SA=function(t,r,n){if(!t||typeof t!="object"&&typeof t!="function")throw new _i("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new _i("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new _i("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new _i("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new _i("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new _i("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,l=arguments.length>5?arguments[5]:null,h=arguments.length>6?arguments[6]:!1,u=!!Dp&&Dp(t,r);if(Mp)Mp(t,r,{configurable:l===null&&u?u.configurable:!l,enumerable:i===null&&u?u.enumerable:!i,value:n,writable:o===null&&u?u.writable:!o});else if(h||!i&&!o&&!l)t[r]=n;else throw new AA("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Tu=fc(),_m=function(){return!!Tu};_m.hasArrayLengthDefineBug=function(){if(!Tu)return null;try{return Tu([],"length",{value:1}).length!==1}catch{return!0}};var CA=_m,IA=ji,Bp=SA,PA=CA(),Op=ym,Fp=$s,RA=IA("%Math.floor%"),MA=function(t,r){if(typeof t!="function")throw new Fp("`fn` is not a function");if(typeof r!="number"||r<0||r>4294967295||RA(r)!==r)throw new Fp("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],i=!0,o=!0;if("length"in t&&Op){var l=Op(t,"length");l&&!l.configurable&&(i=!1),l&&!l.writable&&(o=!1)}return(i||o||!n)&&(PA?Bp(t,"length",r,!0,!0):Bp(t,"length",r)),t};(function(e){var t=cc,r=ji,n=MA,i=$s,o=r("%Function.prototype.apply%"),l=r("%Function.prototype.call%"),h=r("%Reflect.apply%",!0)||t.call(l,o),u=fc(),f=r("%Math.max%");e.exports=function(g){if(typeof g!="function")throw new i("a function is required");var v=h(t,l,arguments);return n(v,1+f(0,g.length-(arguments.length-1)),!0)};var d=function(){return h(t,o,arguments)};u?u(e.exports,"apply",{value:d}):e.exports.apply=d})(vm);var DA=vm.exports,xm=ji,bm=DA,BA=bm(xm("String.prototype.indexOf")),OA=function(t,r){var n=xm(t,!!r);return typeof n=="function"&&BA(t,".prototype.")>-1?bm(n):n};const FA={},LA=Object.freeze(Object.defineProperty({__proto__:null,default:FA},Symbol.toStringTag,{value:"Module"})),NA=mT(LA);var dc=typeof Map=="function"&&Map.prototype,Ph=Object.getOwnPropertyDescriptor&&dc?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Sa=dc&&Ph&&typeof Ph.get=="function"?Ph.get:null,Lp=dc&&Map.prototype.forEach,pc=typeof Set=="function"&&Set.prototype,Rh=Object.getOwnPropertyDescriptor&&pc?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Ca=pc&&Rh&&typeof Rh.get=="function"?Rh.get:null,Np=pc&&Set.prototype.forEach,kA=typeof WeakMap=="function"&&WeakMap.prototype,Cs=kA?WeakMap.prototype.has:null,UA=typeof WeakSet=="function"&&WeakSet.prototype,Is=UA?WeakSet.prototype.has:null,GA=typeof WeakRef=="function"&&WeakRef.prototype,kp=GA?WeakRef.prototype.deref:null,$A=Boolean.prototype.valueOf,WA=Object.prototype.toString,HA=Function.prototype.toString,zA=String.prototype.match,gc=String.prototype.slice,vn=String.prototype.replace,XA=String.prototype.toUpperCase,Up=String.prototype.toLowerCase,wm=RegExp.prototype.test,Gp=Array.prototype.concat,Mr=Array.prototype.join,VA=Array.prototype.slice,$p=Math.floor,Au=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Mh=Object.getOwnPropertySymbols,Su=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Gi=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Ae=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Gi||!0)?Symbol.toStringTag:null,Em=Object.prototype.propertyIsEnumerable,Wp=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function Hp(e,t){if(e===1/0||e===-1/0||e!==e||e&&e>-1e3&&e<1e3||wm.call(/e/,t))return t;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof e=="number"){var n=e<0?-$p(-e):$p(e);if(n!==e){var i=String(n),o=gc.call(t,i.length+1);return vn.call(i,r,"$&_")+"."+vn.call(vn.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return vn.call(t,r,"$&_")}var Cu=NA,zp=Cu.custom,Xp=Am(zp)?zp:null,YA=function e(t,r,n,i){var o=r||{};if(pn(o,"quoteStyle")&&o.quoteStyle!=="single"&&o.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(pn(o,"maxStringLength")&&(typeof o.maxStringLength=="number"?o.maxStringLength<0&&o.maxStringLength!==1/0:o.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var l=pn(o,"customInspect")?o.customInspect:!0;if(typeof l!="boolean"&&l!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(pn(o,"indent")&&o.indent!==null&&o.indent!=="	"&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(pn(o,"numericSeparator")&&typeof o.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var h=o.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return Cm(t,o);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var u=String(t);return h?Hp(t,u):u}if(typeof t=="bigint"){var f=String(t)+"n";return h?Hp(t,f):f}var d=typeof o.depth>"u"?5:o.depth;if(typeof n>"u"&&(n=0),n>=d&&d>0&&typeof t=="object")return Iu(t)?"[Array]":"[Object]";var p=cS(o,n);if(typeof i>"u")i=[];else if(Sm(i,t)>=0)return"[Circular]";function g($,k,lt){if(k&&(i=VA.call(i),i.push(k)),lt){var pt={depth:o.depth};return pn(o,"quoteStyle")&&(pt.quoteStyle=o.quoteStyle),e($,pt,n+1,i)}return e($,o,n+1,i)}if(typeof t=="function"&&!Vp(t)){var v=rS(t),y=Uo(t,g);return"[Function"+(v?": "+v:" (anonymous)")+"]"+(y.length>0?" { "+Mr.call(y,", ")+" }":"")}if(Am(t)){var w=Gi?vn.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Su.call(t);return typeof t=="object"&&!Gi?vs(w):w}if(lS(t)){for(var x="<"+Up.call(String(t.nodeName)),T=t.attributes||[],S=0;S<T.length;S++)x+=" "+T[S].name+"="+Tm(jA(T[S].value),"double",o);return x+=">",t.childNodes&&t.childNodes.length&&(x+="..."),x+="</"+Up.call(String(t.nodeName))+">",x}if(Iu(t)){if(t.length===0)return"[]";var E=Uo(t,g);return p&&!uS(E)?"["+Pu(E,p)+"]":"[ "+Mr.call(E,", ")+" ]"}if(KA(t)){var I=Uo(t,g);return!("cause"in Error.prototype)&&"cause"in t&&!Em.call(t,"cause")?"{ ["+String(t)+"] "+Mr.call(Gp.call("[cause]: "+g(t.cause),I),", ")+" }":I.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+Mr.call(I,", ")+" }"}if(typeof t=="object"&&l){if(Xp&&typeof t[Xp]=="function"&&Cu)return Cu(t,{depth:d-n});if(l!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(nS(t)){var D=[];return Lp&&Lp.call(t,function($,k){D.push(g(k,t,!0)+" => "+g($,t))}),Yp("Map",Sa.call(t),D,p)}if(oS(t)){var L=[];return Np&&Np.call(t,function($){L.push(g($,t))}),Yp("Set",Ca.call(t),L,p)}if(iS(t))return Dh("WeakMap");if(aS(t))return Dh("WeakSet");if(sS(t))return Dh("WeakRef");if(JA(t))return vs(g(Number(t)));if(tS(t))return vs(g(Au.call(t)));if(QA(t))return vs($A.call(t));if(ZA(t))return vs(g(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(t===Dr)return"{ [object globalThis] }";if(!qA(t)&&!Vp(t)){var O=Uo(t,g),F=Wp?Wp(t)===Object.prototype:t instanceof Object||t.constructor===Object,X=t instanceof Object?"":"null prototype",q=!F&&Ae&&Object(t)===t&&Ae in t?gc.call(Tn(t),8,-1):X?"Object":"",V=F||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",Z=V+(q||X?"["+Mr.call(Gp.call([],q||[],X||[]),": ")+"] ":"");return O.length===0?Z+"{}":p?Z+"{"+Pu(O,p)+"}":Z+"{ "+Mr.call(O,", ")+" }"}return String(t)};function Tm(e,t,r){var n=(r.quoteStyle||t)==="double"?'"':"'";return n+e+n}function jA(e){return vn.call(String(e),/"/g,"&quot;")}function Iu(e){return Tn(e)==="[object Array]"&&(!Ae||!(typeof e=="object"&&Ae in e))}function qA(e){return Tn(e)==="[object Date]"&&(!Ae||!(typeof e=="object"&&Ae in e))}function Vp(e){return Tn(e)==="[object RegExp]"&&(!Ae||!(typeof e=="object"&&Ae in e))}function KA(e){return Tn(e)==="[object Error]"&&(!Ae||!(typeof e=="object"&&Ae in e))}function ZA(e){return Tn(e)==="[object String]"&&(!Ae||!(typeof e=="object"&&Ae in e))}function JA(e){return Tn(e)==="[object Number]"&&(!Ae||!(typeof e=="object"&&Ae in e))}function QA(e){return Tn(e)==="[object Boolean]"&&(!Ae||!(typeof e=="object"&&Ae in e))}function Am(e){if(Gi)return e&&typeof e=="object"&&e instanceof Symbol;if(typeof e=="symbol")return!0;if(!e||typeof e!="object"||!Su)return!1;try{return Su.call(e),!0}catch{}return!1}function tS(e){if(!e||typeof e!="object"||!Au)return!1;try{return Au.call(e),!0}catch{}return!1}var eS=Object.prototype.hasOwnProperty||function(e){return e in this};function pn(e,t){return eS.call(e,t)}function Tn(e){return WA.call(e)}function rS(e){if(e.name)return e.name;var t=zA.call(HA.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}function Sm(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}function nS(e){if(!Sa||!e||typeof e!="object")return!1;try{Sa.call(e);try{Ca.call(e)}catch{return!0}return e instanceof Map}catch{}return!1}function iS(e){if(!Cs||!e||typeof e!="object")return!1;try{Cs.call(e,Cs);try{Is.call(e,Is)}catch{return!0}return e instanceof WeakMap}catch{}return!1}function sS(e){if(!kp||!e||typeof e!="object")return!1;try{return kp.call(e),!0}catch{}return!1}function oS(e){if(!Ca||!e||typeof e!="object")return!1;try{Ca.call(e);try{Sa.call(e)}catch{return!0}return e instanceof Set}catch{}return!1}function aS(e){if(!Is||!e||typeof e!="object")return!1;try{Is.call(e,Is);try{Cs.call(e,Cs)}catch{return!0}return e instanceof WeakSet}catch{}return!1}function lS(e){return!e||typeof e!="object"?!1:typeof HTMLElement<"u"&&e instanceof HTMLElement?!0:typeof e.nodeName=="string"&&typeof e.getAttribute=="function"}function Cm(e,t){if(e.length>t.maxStringLength){var r=e.length-t.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return Cm(gc.call(e,0,t.maxStringLength),t)+n}var i=vn.call(vn.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,hS);return Tm(i,"single",t)}function hS(e){var t=e.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return r?"\\"+r:"\\x"+(t<16?"0":"")+XA.call(t.toString(16))}function vs(e){return"Object("+e+")"}function Dh(e){return e+" { ? }"}function Yp(e,t,r,n){var i=n?Pu(r,n):Mr.call(r,", ");return e+" ("+t+") {"+i+"}"}function uS(e){for(var t=0;t<e.length;t++)if(Sm(e[t],`
`)>=0)return!1;return!0}function cS(e,t){var r;if(e.indent==="	")r="	";else if(typeof e.indent=="number"&&e.indent>0)r=Mr.call(Array(e.indent+1)," ");else return null;return{base:r,prev:Mr.call(Array(t+1),r)}}function Pu(e,t){if(e.length===0)return"";var r=`
`+t.prev+t.base;return r+Mr.call(e,","+r)+`
`+t.prev}function Uo(e,t){var r=Iu(e),n=[];if(r){n.length=e.length;for(var i=0;i<e.length;i++)n[i]=pn(e,i)?t(e[i],e):""}var o=typeof Mh=="function"?Mh(e):[],l;if(Gi){l={};for(var h=0;h<o.length;h++)l["$"+o[h]]=o[h]}for(var u in e)pn(e,u)&&(r&&String(Number(u))===u&&u<e.length||Gi&&l["$"+u]instanceof Symbol||(wm.call(/[^\w$]/,u)?n.push(t(u,e)+": "+t(e[u],e)):n.push(u+": "+t(e[u],e))));if(typeof Mh=="function")for(var f=0;f<o.length;f++)Em.call(e,o[f])&&n.push("["+t(o[f])+"]: "+t(e[o[f]],e));return n}var Im=ji,qi=OA,fS=YA,dS=$s,Go=Im("%WeakMap%",!0),$o=Im("%Map%",!0),pS=qi("WeakMap.prototype.get",!0),gS=qi("WeakMap.prototype.set",!0),mS=qi("WeakMap.prototype.has",!0),vS=qi("Map.prototype.get",!0),yS=qi("Map.prototype.set",!0),_S=qi("Map.prototype.has",!0),mc=function(e,t){for(var r=e,n;(n=r.next)!==null;r=n)if(n.key===t)return r.next=n.next,n.next=e.next,e.next=n,n},xS=function(e,t){var r=mc(e,t);return r&&r.value},bS=function(e,t,r){var n=mc(e,t);n?n.value=r:e.next={key:t,next:e.next,value:r}},wS=function(e,t){return!!mc(e,t)},ES=function(){var t,r,n,i={assert:function(o){if(!i.has(o))throw new dS("Side channel does not contain "+fS(o))},get:function(o){if(Go&&o&&(typeof o=="object"||typeof o=="function")){if(t)return pS(t,o)}else if($o){if(r)return vS(r,o)}else if(n)return xS(n,o)},has:function(o){if(Go&&o&&(typeof o=="object"||typeof o=="function")){if(t)return mS(t,o)}else if($o){if(r)return _S(r,o)}else if(n)return wS(n,o);return!1},set:function(o,l){Go&&o&&(typeof o=="object"||typeof o=="function")?(t||(t=new Go),gS(t,o,l)):$o?(r||(r=new $o),yS(r,o,l)):(n||(n={key:{},next:null}),bS(n,o,l))}};return i},TS=String.prototype.replace,AS=/%20/g,Bh={RFC1738:"RFC1738",RFC3986:"RFC3986"},vc={default:Bh.RFC3986,formatters:{RFC1738:function(e){return TS.call(e,AS,"+")},RFC3986:function(e){return String(e)}},RFC1738:Bh.RFC1738,RFC3986:Bh.RFC3986},SS=vc,Oh=Object.prototype.hasOwnProperty,zn=Array.isArray,Cr=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),CS=function(t){for(;t.length>1;){var r=t.pop(),n=r.obj[r.prop];if(zn(n)){for(var i=[],o=0;o<n.length;++o)typeof n[o]<"u"&&i.push(n[o]);r.obj[r.prop]=i}}},Pm=function(t,r){for(var n=r&&r.plainObjects?Object.create(null):{},i=0;i<t.length;++i)typeof t[i]<"u"&&(n[i]=t[i]);return n},IS=function e(t,r,n){if(!r)return t;if(typeof r!="object"){if(zn(t))t.push(r);else if(t&&typeof t=="object")(n&&(n.plainObjects||n.allowPrototypes)||!Oh.call(Object.prototype,r))&&(t[r]=!0);else return[t,r];return t}if(!t||typeof t!="object")return[t].concat(r);var i=t;return zn(t)&&!zn(r)&&(i=Pm(t,n)),zn(t)&&zn(r)?(r.forEach(function(o,l){if(Oh.call(t,l)){var h=t[l];h&&typeof h=="object"&&o&&typeof o=="object"?t[l]=e(h,o,n):t.push(o)}else t[l]=o}),t):Object.keys(r).reduce(function(o,l){var h=r[l];return Oh.call(o,l)?o[l]=e(o[l],h,n):o[l]=h,o},i)},PS=function(t,r){return Object.keys(r).reduce(function(n,i){return n[i]=r[i],n},t)},RS=function(e,t,r){var n=e.replace(/\+/g," ");if(r==="iso-8859-1")return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch{return n}},Fh=1024,MS=function(t,r,n,i,o){if(t.length===0)return t;var l=t;if(typeof t=="symbol"?l=Symbol.prototype.toString.call(t):typeof t!="string"&&(l=String(t)),n==="iso-8859-1")return escape(l).replace(/%u[0-9a-f]{4}/gi,function(v){return"%26%23"+parseInt(v.slice(2),16)+"%3B"});for(var h="",u=0;u<l.length;u+=Fh){for(var f=l.length>=Fh?l.slice(u,u+Fh):l,d=[],p=0;p<f.length;++p){var g=f.charCodeAt(p);if(g===45||g===46||g===95||g===126||g>=48&&g<=57||g>=65&&g<=90||g>=97&&g<=122||o===SS.RFC1738&&(g===40||g===41)){d[d.length]=f.charAt(p);continue}if(g<128){d[d.length]=Cr[g];continue}if(g<2048){d[d.length]=Cr[192|g>>6]+Cr[128|g&63];continue}if(g<55296||g>=57344){d[d.length]=Cr[224|g>>12]+Cr[128|g>>6&63]+Cr[128|g&63];continue}p+=1,g=65536+((g&1023)<<10|f.charCodeAt(p)&1023),d[d.length]=Cr[240|g>>18]+Cr[128|g>>12&63]+Cr[128|g>>6&63]+Cr[128|g&63]}h+=d.join("")}return h},DS=function(t){for(var r=[{obj:{o:t},prop:"o"}],n=[],i=0;i<r.length;++i)for(var o=r[i],l=o.obj[o.prop],h=Object.keys(l),u=0;u<h.length;++u){var f=h[u],d=l[f];typeof d=="object"&&d!==null&&n.indexOf(d)===-1&&(r.push({obj:l,prop:f}),n.push(d))}return CS(r),t},BS=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},OS=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},FS=function(t,r){return[].concat(t,r)},LS=function(t,r){if(zn(t)){for(var n=[],i=0;i<t.length;i+=1)n.push(r(t[i]));return n}return r(t)},Rm={arrayToObject:Pm,assign:PS,combine:FS,compact:DS,decode:RS,encode:MS,isBuffer:OS,isRegExp:BS,maybeMap:LS,merge:IS},Mm=ES,pa=Rm,Ps=vc,NS=Object.prototype.hasOwnProperty,Dm={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,r){return t+"["+r+"]"},repeat:function(t){return t}},Pr=Array.isArray,kS=Array.prototype.push,Bm=function(e,t){kS.apply(e,Pr(t)?t:[t])},US=Date.prototype.toISOString,jp=Ps.default,fe={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:pa.encode,encodeValuesOnly:!1,format:jp,formatter:Ps.formatters[jp],indices:!1,serializeDate:function(t){return US.call(t)},skipNulls:!1,strictNullHandling:!1},GS=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},Lh={},$S=function e(t,r,n,i,o,l,h,u,f,d,p,g,v,y,w,x,T,S){for(var E=t,I=S,D=0,L=!1;(I=I.get(Lh))!==void 0&&!L;){var O=I.get(t);if(D+=1,typeof O<"u"){if(O===D)throw new RangeError("Cyclic object value");L=!0}typeof I.get(Lh)>"u"&&(D=0)}if(typeof d=="function"?E=d(r,E):E instanceof Date?E=v(E):n==="comma"&&Pr(E)&&(E=pa.maybeMap(E,function(H){return H instanceof Date?v(H):H})),E===null){if(l)return f&&!x?f(r,fe.encoder,T,"key",y):r;E=""}if(GS(E)||pa.isBuffer(E)){if(f){var F=x?r:f(r,fe.encoder,T,"key",y);return[w(F)+"="+w(f(E,fe.encoder,T,"value",y))]}return[w(r)+"="+w(String(E))]}var X=[];if(typeof E>"u")return X;var q;if(n==="comma"&&Pr(E))x&&f&&(E=pa.maybeMap(E,f)),q=[{value:E.length>0?E.join(",")||null:void 0}];else if(Pr(d))q=d;else{var V=Object.keys(E);q=p?V.sort(p):V}var Z=u?r.replace(/\./g,"%2E"):r,$=i&&Pr(E)&&E.length===1?Z+"[]":Z;if(o&&Pr(E)&&E.length===0)return $+"[]";for(var k=0;k<q.length;++k){var lt=q[k],pt=typeof lt=="object"&&typeof lt.value<"u"?lt.value:E[lt];if(!(h&&pt===null)){var j=g&&u?lt.replace(/\./g,"%2E"):lt,_t=Pr(E)?typeof n=="function"?n($,j):$:$+(g?"."+j:"["+j+"]");S.set(t,D);var Ft=Mm();Ft.set(Lh,S),Bm(X,e(pt,_t,n,i,o,l,h,u,n==="comma"&&x&&Pr(E)?null:f,d,p,g,v,y,w,x,T,Ft))}}return X},WS=function(t){if(!t)return fe;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var r=t.charset||fe.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=Ps.default;if(typeof t.format<"u"){if(!NS.call(Ps.formatters,t.format))throw new TypeError("Unknown format option provided.");n=t.format}var i=Ps.formatters[n],o=fe.filter;(typeof t.filter=="function"||Pr(t.filter))&&(o=t.filter);var l;if(t.arrayFormat in Dm?l=t.arrayFormat:"indices"in t?l=t.indices?"indices":"repeat":l=fe.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var h=typeof t.allowDots>"u"?t.encodeDotInKeys===!0?!0:fe.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:fe.addQueryPrefix,allowDots:h,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:fe.allowEmptyArrays,arrayFormat:l,charset:r,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:fe.charsetSentinel,commaRoundTrip:t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?fe.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:fe.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:fe.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:fe.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:fe.encodeValuesOnly,filter:o,format:n,formatter:i,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:fe.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:fe.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:fe.strictNullHandling}},HS=function(e,t){var r=e,n=WS(t),i,o;typeof n.filter=="function"?(o=n.filter,r=o("",r)):Pr(n.filter)&&(o=n.filter,i=o);var l=[];if(typeof r!="object"||r===null)return"";var h=Dm[n.arrayFormat],u=h==="comma"&&n.commaRoundTrip;i||(i=Object.keys(r)),n.sort&&i.sort(n.sort);for(var f=Mm(),d=0;d<i.length;++d){var p=i[d];n.skipNulls&&r[p]===null||Bm(l,$S(r[p],p,h,u,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,f))}var g=l.join(n.delimiter),v=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?v+="utf8=%26%2310003%3B&":v+="utf8=%E2%9C%93&"),g.length>0?v+g:""},$i=Rm,Ru=Object.prototype.hasOwnProperty,zS=Array.isArray,ie={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:$i.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},XS=function(e){return e.replace(/&#(\d+);/g,function(t,r){return String.fromCharCode(parseInt(r,10))})},Om=function(e,t){return e&&typeof e=="string"&&t.comma&&e.indexOf(",")>-1?e.split(","):e},VS="utf8=%26%2310003%3B",YS="utf8=%E2%9C%93",jS=function(t,r){var n={__proto__:null},i=r.ignoreQueryPrefix?t.replace(/^\?/,""):t,o=r.parameterLimit===1/0?void 0:r.parameterLimit,l=i.split(r.delimiter,o),h=-1,u,f=r.charset;if(r.charsetSentinel)for(u=0;u<l.length;++u)l[u].indexOf("utf8=")===0&&(l[u]===YS?f="utf-8":l[u]===VS&&(f="iso-8859-1"),h=u,u=l.length);for(u=0;u<l.length;++u)if(u!==h){var d=l[u],p=d.indexOf("]="),g=p===-1?d.indexOf("="):p+1,v,y;g===-1?(v=r.decoder(d,ie.decoder,f,"key"),y=r.strictNullHandling?null:""):(v=r.decoder(d.slice(0,g),ie.decoder,f,"key"),y=$i.maybeMap(Om(d.slice(g+1),r),function(x){return r.decoder(x,ie.decoder,f,"value")})),y&&r.interpretNumericEntities&&f==="iso-8859-1"&&(y=XS(y)),d.indexOf("[]=")>-1&&(y=zS(y)?[y]:y);var w=Ru.call(n,v);w&&r.duplicates==="combine"?n[v]=$i.combine(n[v],y):(!w||r.duplicates==="last")&&(n[v]=y)}return n},qS=function(e,t,r,n){for(var i=n?t:Om(t,r),o=e.length-1;o>=0;--o){var l,h=e[o];if(h==="[]"&&r.parseArrays)l=r.allowEmptyArrays&&i===""?[]:[].concat(i);else{l=r.plainObjects?Object.create(null):{};var u=h.charAt(0)==="["&&h.charAt(h.length-1)==="]"?h.slice(1,-1):h,f=r.decodeDotInKeys?u.replace(/%2E/g,"."):u,d=parseInt(f,10);!r.parseArrays&&f===""?l={0:i}:!isNaN(d)&&h!==f&&String(d)===f&&d>=0&&r.parseArrays&&d<=r.arrayLimit?(l=[],l[d]=i):f!=="__proto__"&&(l[f]=i)}i=l}return i},KS=function(t,r,n,i){if(t){var o=n.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,l=/(\[[^[\]]*])/,h=/(\[[^[\]]*])/g,u=n.depth>0&&l.exec(o),f=u?o.slice(0,u.index):o,d=[];if(f){if(!n.plainObjects&&Ru.call(Object.prototype,f)&&!n.allowPrototypes)return;d.push(f)}for(var p=0;n.depth>0&&(u=h.exec(o))!==null&&p<n.depth;){if(p+=1,!n.plainObjects&&Ru.call(Object.prototype,u[1].slice(1,-1))&&!n.allowPrototypes)return;d.push(u[1])}return u&&d.push("["+o.slice(u.index)+"]"),qS(d,r,n,i)}},ZS=function(t){if(!t)return ie;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.decodeDotInKeys<"u"&&typeof t.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(t.decoder!==null&&typeof t.decoder<"u"&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=typeof t.charset>"u"?ie.charset:t.charset,n=typeof t.duplicates>"u"?ie.duplicates:t.duplicates;if(n!=="combine"&&n!=="first"&&n!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var i=typeof t.allowDots>"u"?t.decodeDotInKeys===!0?!0:ie.allowDots:!!t.allowDots;return{allowDots:i,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:ie.allowEmptyArrays,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:ie.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:ie.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:ie.arrayLimit,charset:r,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:ie.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:ie.comma,decodeDotInKeys:typeof t.decodeDotInKeys=="boolean"?t.decodeDotInKeys:ie.decodeDotInKeys,decoder:typeof t.decoder=="function"?t.decoder:ie.decoder,delimiter:typeof t.delimiter=="string"||$i.isRegExp(t.delimiter)?t.delimiter:ie.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:ie.depth,duplicates:n,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:ie.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:ie.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:ie.plainObjects,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:ie.strictNullHandling}},JS=function(e,t){var r=ZS(t);if(e===""||e===null||typeof e>"u")return r.plainObjects?Object.create(null):{};for(var n=typeof e=="string"?jS(e,r):e,i=r.plainObjects?Object.create(null):{},o=Object.keys(n),l=0;l<o.length;++l){var h=o[l],u=KS(h,n[h],r,typeof e=="string");i=$i.merge(i,u,r)}return r.allowSparse===!0?i:$i.compact(i)},QS=HS,tC=JS,eC=vc,rC={formats:eC,parse:tC,stringify:QS},nC=kT;function _r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var iC=/^([a-z0-9.+-]+:)/i,sC=/:[0-9]*$/,oC=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,aC=["<",">",'"',"`"," ","\r",`
`,"	"],lC=["{","}","|","\\","^","`"].concat(aC),Mu=["'"].concat(lC),qp=["%","/","?",";","#"].concat(Mu),Kp=["/","?","#"],hC=255,Zp=/^[+a-z0-9A-Z_-]{0,63}$/,uC=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,cC={javascript:!0,"javascript:":!0},Du={javascript:!0,"javascript:":!0},Fi={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Bu=rC;function Va(e,t,r){if(e&&typeof e=="object"&&e instanceof _r)return e;var n=new _r;return n.parse(e,t,r),n}_r.prototype.parse=function(e,t,r){if(typeof e!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e.indexOf("?"),i=n!==-1&&n<e.indexOf("#")?"?":"#",o=e.split(i),l=/\\/g;o[0]=o[0].replace(l,"/"),e=o.join(i);var h=e;if(h=h.trim(),!r&&e.split("#").length===1){var u=oC.exec(h);if(u)return this.path=h,this.href=h,this.pathname=u[1],u[2]?(this.search=u[2],t?this.query=Bu.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var f=iC.exec(h);if(f){f=f[0];var d=f.toLowerCase();this.protocol=d,h=h.substr(f.length)}if(r||f||h.match(/^\/\/[^@/]+@[^@/]+/)){var p=h.substr(0,2)==="//";p&&!(f&&Du[f])&&(h=h.substr(2),this.slashes=!0)}if(!Du[f]&&(p||f&&!Fi[f])){for(var g=-1,v=0;v<Kp.length;v++){var y=h.indexOf(Kp[v]);y!==-1&&(g===-1||y<g)&&(g=y)}var w,x;g===-1?x=h.lastIndexOf("@"):x=h.lastIndexOf("@",g),x!==-1&&(w=h.slice(0,x),h=h.slice(x+1),this.auth=decodeURIComponent(w)),g=-1;for(var v=0;v<qp.length;v++){var y=h.indexOf(qp[v]);y!==-1&&(g===-1||y<g)&&(g=y)}g===-1&&(g=h.length),this.host=h.slice(0,g),h=h.slice(g),this.parseHost(),this.hostname=this.hostname||"";var T=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!T)for(var S=this.hostname.split(/\./),v=0,E=S.length;v<E;v++){var I=S[v];if(I&&!I.match(Zp)){for(var D="",L=0,O=I.length;L<O;L++)I.charCodeAt(L)>127?D+="x":D+=I[L];if(!D.match(Zp)){var F=S.slice(0,v),X=S.slice(v+1),q=I.match(uC);q&&(F.push(q[1]),X.unshift(q[2])),X.length&&(h="/"+X.join(".")+h),this.hostname=F.join(".");break}}}this.hostname.length>hC?this.hostname="":this.hostname=this.hostname.toLowerCase(),T||(this.hostname=nC.toASCII(this.hostname));var V=this.port?":"+this.port:"",Z=this.hostname||"";this.host=Z+V,this.href+=this.host,T&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),h[0]!=="/"&&(h="/"+h))}if(!cC[d])for(var v=0,E=Mu.length;v<E;v++){var $=Mu[v];if(h.indexOf($)!==-1){var k=encodeURIComponent($);k===$&&(k=escape($)),h=h.split($).join(k)}}var lt=h.indexOf("#");lt!==-1&&(this.hash=h.substr(lt),h=h.slice(0,lt));var pt=h.indexOf("?");if(pt!==-1?(this.search=h.substr(pt),this.query=h.substr(pt+1),t&&(this.query=Bu.parse(this.query)),h=h.slice(0,pt)):t&&(this.search="",this.query={}),h&&(this.pathname=h),Fi[d]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var V=this.pathname||"",j=this.search||"";this.path=V+j}return this.href=this.format(),this};function fC(e){return typeof e=="string"&&(e=Va(e)),e instanceof _r?e.format():_r.prototype.format.call(e)}_r.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",i=!1,o="";this.host?i=e+this.host:this.hostname&&(i=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(o=Bu.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var l=this.search||o&&"?"+o||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||Fi[t])&&i!==!1?(i="//"+(i||""),r&&r.charAt(0)!=="/"&&(r="/"+r)):i||(i=""),n&&n.charAt(0)!=="#"&&(n="#"+n),l&&l.charAt(0)!=="?"&&(l="?"+l),r=r.replace(/[?#]/g,function(h){return encodeURIComponent(h)}),l=l.replace("#","%23"),t+i+r+l+n};function dC(e,t){return Va(e,!1,!0).resolve(t)}_r.prototype.resolve=function(e){return this.resolveObject(Va(e,!1,!0)).format()};_r.prototype.resolveObject=function(e){if(typeof e=="string"){var t=new _r;t.parse(e,!1,!0),e=t}for(var r=new _r,n=Object.keys(this),i=0;i<n.length;i++){var o=n[i];r[o]=this[o]}if(r.hash=e.hash,e.href==="")return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),h=0;h<l.length;h++){var u=l[h];u!=="protocol"&&(r[u]=e[u])}return Fi[r.protocol]&&r.hostname&&!r.pathname&&(r.pathname="/",r.path=r.pathname),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!Fi[e.protocol]){for(var f=Object.keys(e),d=0;d<f.length;d++){var p=f[d];r[p]=e[p]}return r.href=r.format(),r}if(r.protocol=e.protocol,!e.host&&!Du[e.protocol]){for(var E=(e.pathname||"").split("/");E.length&&!(e.host=E.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),E[0]!==""&&E.unshift(""),E.length<2&&E.unshift(""),r.pathname=E.join("/")}else r.pathname=e.pathname;if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var g=r.pathname||"",v=r.search||"";r.path=g+v}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var y=r.pathname&&r.pathname.charAt(0)==="/",w=e.host||e.pathname&&e.pathname.charAt(0)==="/",x=w||y||r.host&&e.pathname,T=x,S=r.pathname&&r.pathname.split("/")||[],E=e.pathname&&e.pathname.split("/")||[],I=r.protocol&&!Fi[r.protocol];if(I&&(r.hostname="",r.port=null,r.host&&(S[0]===""?S[0]=r.host:S.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(E[0]===""?E[0]=e.host:E.unshift(e.host)),e.host=null),x=x&&(E[0]===""||S[0]==="")),w)r.host=e.host||e.host===""?e.host:r.host,r.hostname=e.hostname||e.hostname===""?e.hostname:r.hostname,r.search=e.search,r.query=e.query,S=E;else if(E.length)S||(S=[]),S.pop(),S=S.concat(E),r.search=e.search,r.query=e.query;else if(e.search!=null){if(I){r.host=S.shift(),r.hostname=r.host;var D=r.host&&r.host.indexOf("@")>0?r.host.split("@"):!1;D&&(r.auth=D.shift(),r.hostname=D.shift(),r.host=r.hostname)}return r.search=e.search,r.query=e.query,(r.pathname!==null||r.search!==null)&&(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!S.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var L=S.slice(-1)[0],O=(r.host||e.host||S.length>1)&&(L==="."||L==="..")||L==="",F=0,X=S.length;X>=0;X--)L=S[X],L==="."?S.splice(X,1):L===".."?(S.splice(X,1),F++):F&&(S.splice(X,1),F--);if(!x&&!T)for(;F--;F)S.unshift("..");x&&S[0]!==""&&(!S[0]||S[0].charAt(0)!=="/")&&S.unshift(""),O&&S.join("/").substr(-1)!=="/"&&S.push("");var q=S[0]===""||S[0]&&S[0].charAt(0)==="/";if(I){r.hostname=q?"":S.length?S.shift():"",r.host=r.hostname;var D=r.host&&r.host.indexOf("@")>0?r.host.split("@"):!1;D&&(r.auth=D.shift(),r.hostname=D.shift(),r.host=r.hostname)}return x=x||r.host&&S.length,x&&!q&&S.unshift(""),S.length>0?r.pathname=S.join("/"):(r.pathname=null,r.path=null),(r.pathname!==null||r.search!==null)&&(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r};_r.prototype.parseHost=function(){var e=this.host,t=sC.exec(e);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)};var pC=Va,gC=dC,mC=fC;const vC={parse:pC,format:mC,resolve:gC};function hr(e){if(typeof e!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function ys(e){return e.split("?")[0].split("#")[0]}function yC(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function _C(e,t,r){return e.replace(new RegExp(yC(t),"g"),r)}function xC(e,t){let r="",n=0,i=-1,o=0,l=-1;for(let h=0;h<=e.length;++h){if(h<e.length)l=e.charCodeAt(h);else{if(l===47)break;l=47}if(l===47){if(!(i===h-1||o===1))if(i!==h-1&&o===2){if(r.length<2||n!==2||r.charCodeAt(r.length-1)!==46||r.charCodeAt(r.length-2)!==46){if(r.length>2){const u=r.lastIndexOf("/");if(u!==r.length-1){u===-1?(r="",n=0):(r=r.slice(0,u),n=r.length-1-r.lastIndexOf("/")),i=h,o=0;continue}}else if(r.length===2||r.length===1){r="",n=0,i=h,o=0;continue}}}else r.length>0?r+=`/${e.slice(i+1,h)}`:r=e.slice(i+1,h),n=h-i-1;i=h,o=0}else l===46&&o!==-1?++o:o=-1}return r}const be={toPosix(e){return _C(e,"\\","/")},isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl(e){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(e)},hasProtocol(e){return/^[^/:]+:\//.test(this.toPosix(e))},getProtocol(e){hr(e),e=this.toPosix(e);let t="";const r=/^file:\/\/\//.exec(e),n=/^[^/:]+:\/\//.exec(e),i=/^[^/:]+:\//.exec(e);if(r||n||i){const o=(r==null?void 0:r[0])||(n==null?void 0:n[0])||(i==null?void 0:i[0]);t=o,e=e.slice(o.length)}return t},toAbsolute(e,t,r){if(this.isDataUrl(e))return e;const n=ys(this.toPosix(t??Q.ADAPTER.getBaseUrl())),i=ys(this.toPosix(r??this.rootname(n)));return hr(e),e=this.toPosix(e),e.startsWith("/")?be.join(i,e.slice(1)):this.isAbsolute(e)?e:this.join(n,e)},normalize(e){if(e=this.toPosix(e),hr(e),e.length===0)return".";let t="";const r=e.startsWith("/");this.hasProtocol(e)&&(t=this.rootname(e),e=e.slice(t.length));const n=e.endsWith("/");return e=xC(e),e.length>0&&n&&(e+="/"),r?`/${e}`:t+e},isAbsolute(e){return hr(e),e=this.toPosix(e),this.hasProtocol(e)?!0:e.startsWith("/")},join(...e){if(e.length===0)return".";let t;for(let r=0;r<e.length;++r){const n=e[r];if(hr(n),n.length>0)if(t===void 0)t=n;else{const i=e[r-1]??"";this.extname(i)?t+=`/../${n}`:t+=`/${n}`}}return t===void 0?".":this.normalize(t)},dirname(e){if(hr(e),e.length===0)return".";e=this.toPosix(e);let t=e.charCodeAt(0);const r=t===47;let n=-1,i=!0;const o=this.getProtocol(e),l=e;e=e.slice(o.length);for(let h=e.length-1;h>=1;--h)if(t=e.charCodeAt(h),t===47){if(!i){n=h;break}}else i=!1;return n===-1?r?"/":this.isUrl(l)?o+e:o:r&&n===1?"//":o+e.slice(0,n)},rootname(e){hr(e),e=this.toPosix(e);let t="";if(e.startsWith("/")?t="/":t=this.getProtocol(e),this.isUrl(e)){const r=e.indexOf("/",t.length);r!==-1?t=e.slice(0,r):t=e,t.endsWith("/")||(t+="/")}return t},basename(e,t){hr(e),t&&hr(t),e=ys(this.toPosix(e));let r=0,n=-1,i=!0,o;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let l=t.length-1,h=-1;for(o=e.length-1;o>=0;--o){const u=e.charCodeAt(o);if(u===47){if(!i){r=o+1;break}}else h===-1&&(i=!1,h=o+1),l>=0&&(u===t.charCodeAt(l)?--l===-1&&(n=o):(l=-1,n=h))}return r===n?n=h:n===-1&&(n=e.length),e.slice(r,n)}for(o=e.length-1;o>=0;--o)if(e.charCodeAt(o)===47){if(!i){r=o+1;break}}else n===-1&&(i=!1,n=o+1);return n===-1?"":e.slice(r,n)},extname(e){hr(e),e=ys(this.toPosix(e));let t=-1,r=0,n=-1,i=!0,o=0;for(let l=e.length-1;l>=0;--l){const h=e.charCodeAt(l);if(h===47){if(!i){r=l+1;break}continue}n===-1&&(i=!1,n=l+1),h===46?t===-1?t=l:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||n===-1||o===0||o===1&&t===n-1&&t===r+1?"":e.slice(t,n)},parse(e){hr(e);const t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;e=ys(this.toPosix(e));let r=e.charCodeAt(0);const n=this.isAbsolute(e);let i;t.root=this.rootname(e),n||this.hasProtocol(e)?i=1:i=0;let o=-1,l=0,h=-1,u=!0,f=e.length-1,d=0;for(;f>=i;--f){if(r=e.charCodeAt(f),r===47){if(!u){l=f+1;break}continue}h===-1&&(u=!1,h=f+1),r===46?o===-1?o=f:d!==1&&(d=1):o!==-1&&(d=-1)}return o===-1||h===-1||d===0||d===1&&o===h-1&&o===l+1?h!==-1&&(l===0&&n?t.base=t.name=e.slice(1,h):t.base=t.name=e.slice(l,h)):(l===0&&n?(t.name=e.slice(1,o),t.base=e.slice(1,h)):(t.name=e.slice(l,o),t.base=e.slice(l,h)),t.ext=e.slice(o,h)),t.dir=this.dirname(e),t},sep:"/",delimiter:":"},Jp={};function It(e,t,r=3){if(Jp[t])return;let n=new Error().stack;typeof n>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`):(n=n.split(`
`).splice(r).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${e}`),console.warn(n),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`),console.warn(n))),Jp[t]=!0}let Nh;function bC(){return typeof Nh>"u"&&(Nh=function(){var r;const t={stencil:!0,failIfMajorPerformanceCaveat:Q.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Q.ADAPTER.getWebGLRenderingContext())return!1;const n=Q.ADAPTER.createCanvas();let i=n.getContext("webgl",t)||n.getContext("experimental-webgl",t);const o=!!((r=i==null?void 0:i.getContextAttributes())!=null&&r.stencil);if(i){const l=i.getExtension("WEBGL_lose_context");l&&l.loseContext()}return i=null,o}catch{return!1}}()),Nh}var wC="#f0f8ff",EC="#faebd7",TC="#00ffff",AC="#7fffd4",SC="#f0ffff",CC="#f5f5dc",IC="#ffe4c4",PC="#000000",RC="#ffebcd",MC="#0000ff",DC="#8a2be2",BC="#a52a2a",OC="#deb887",FC="#5f9ea0",LC="#7fff00",NC="#d2691e",kC="#ff7f50",UC="#6495ed",GC="#fff8dc",$C="#dc143c",WC="#00ffff",HC="#00008b",zC="#008b8b",XC="#b8860b",VC="#a9a9a9",YC="#006400",jC="#a9a9a9",qC="#bdb76b",KC="#8b008b",ZC="#556b2f",JC="#ff8c00",QC="#9932cc",tI="#8b0000",eI="#e9967a",rI="#8fbc8f",nI="#483d8b",iI="#2f4f4f",sI="#2f4f4f",oI="#00ced1",aI="#9400d3",lI="#ff1493",hI="#00bfff",uI="#696969",cI="#696969",fI="#1e90ff",dI="#b22222",pI="#fffaf0",gI="#228b22",mI="#ff00ff",vI="#dcdcdc",yI="#f8f8ff",_I="#daa520",xI="#ffd700",bI="#808080",wI="#008000",EI="#adff2f",TI="#808080",AI="#f0fff0",SI="#ff69b4",CI="#cd5c5c",II="#4b0082",PI="#fffff0",RI="#f0e68c",MI="#fff0f5",DI="#e6e6fa",BI="#7cfc00",OI="#fffacd",FI="#add8e6",LI="#f08080",NI="#e0ffff",kI="#fafad2",UI="#d3d3d3",GI="#90ee90",$I="#d3d3d3",WI="#ffb6c1",HI="#ffa07a",zI="#20b2aa",XI="#87cefa",VI="#778899",YI="#778899",jI="#b0c4de",qI="#ffffe0",KI="#00ff00",ZI="#32cd32",JI="#faf0e6",QI="#ff00ff",tP="#800000",eP="#66cdaa",rP="#0000cd",nP="#ba55d3",iP="#9370db",sP="#3cb371",oP="#7b68ee",aP="#00fa9a",lP="#48d1cc",hP="#c71585",uP="#191970",cP="#f5fffa",fP="#ffe4e1",dP="#ffe4b5",pP="#ffdead",gP="#000080",mP="#fdf5e6",vP="#808000",yP="#6b8e23",_P="#ffa500",xP="#ff4500",bP="#da70d6",wP="#eee8aa",EP="#98fb98",TP="#afeeee",AP="#db7093",SP="#ffefd5",CP="#ffdab9",IP="#cd853f",PP="#ffc0cb",RP="#dda0dd",MP="#b0e0e6",DP="#800080",BP="#663399",OP="#ff0000",FP="#bc8f8f",LP="#4169e1",NP="#8b4513",kP="#fa8072",UP="#f4a460",GP="#2e8b57",$P="#fff5ee",WP="#a0522d",HP="#c0c0c0",zP="#87ceeb",XP="#6a5acd",VP="#708090",YP="#708090",jP="#fffafa",qP="#00ff7f",KP="#4682b4",ZP="#d2b48c",JP="#008080",QP="#d8bfd8",tR="#ff6347",eR="#40e0d0",rR="#ee82ee",nR="#f5deb3",iR="#ffffff",sR="#f5f5f5",oR="#ffff00",aR="#9acd32",lR={aliceblue:wC,antiquewhite:EC,aqua:TC,aquamarine:AC,azure:SC,beige:CC,bisque:IC,black:PC,blanchedalmond:RC,blue:MC,blueviolet:DC,brown:BC,burlywood:OC,cadetblue:FC,chartreuse:LC,chocolate:NC,coral:kC,cornflowerblue:UC,cornsilk:GC,crimson:$C,cyan:WC,darkblue:HC,darkcyan:zC,darkgoldenrod:XC,darkgray:VC,darkgreen:YC,darkgrey:jC,darkkhaki:qC,darkmagenta:KC,darkolivegreen:ZC,darkorange:JC,darkorchid:QC,darkred:tI,darksalmon:eI,darkseagreen:rI,darkslateblue:nI,darkslategray:iI,darkslategrey:sI,darkturquoise:oI,darkviolet:aI,deeppink:lI,deepskyblue:hI,dimgray:uI,dimgrey:cI,dodgerblue:fI,firebrick:dI,floralwhite:pI,forestgreen:gI,fuchsia:mI,gainsboro:vI,ghostwhite:yI,goldenrod:_I,gold:xI,gray:bI,green:wI,greenyellow:EI,grey:TI,honeydew:AI,hotpink:SI,indianred:CI,indigo:II,ivory:PI,khaki:RI,lavenderblush:MI,lavender:DI,lawngreen:BI,lemonchiffon:OI,lightblue:FI,lightcoral:LI,lightcyan:NI,lightgoldenrodyellow:kI,lightgray:UI,lightgreen:GI,lightgrey:$I,lightpink:WI,lightsalmon:HI,lightseagreen:zI,lightskyblue:XI,lightslategray:VI,lightslategrey:YI,lightsteelblue:jI,lightyellow:qI,lime:KI,limegreen:ZI,linen:JI,magenta:QI,maroon:tP,mediumaquamarine:eP,mediumblue:rP,mediumorchid:nP,mediumpurple:iP,mediumseagreen:sP,mediumslateblue:oP,mediumspringgreen:aP,mediumturquoise:lP,mediumvioletred:hP,midnightblue:uP,mintcream:cP,mistyrose:fP,moccasin:dP,navajowhite:pP,navy:gP,oldlace:mP,olive:vP,olivedrab:yP,orange:_P,orangered:xP,orchid:bP,palegoldenrod:wP,palegreen:EP,paleturquoise:TP,palevioletred:AP,papayawhip:SP,peachpuff:CP,peru:IP,pink:PP,plum:RP,powderblue:MP,purple:DP,rebeccapurple:BP,red:OP,rosybrown:FP,royalblue:LP,saddlebrown:NP,salmon:kP,sandybrown:UP,seagreen:GP,seashell:$P,sienna:WP,silver:HP,skyblue:zP,slateblue:XP,slategray:VP,slategrey:YP,snow:jP,springgreen:qP,steelblue:KP,tan:ZP,teal:JP,thistle:QP,tomato:tR,turquoise:eR,violet:rR,wheat:nR,white:iR,whitesmoke:sR,yellow:oR,yellowgreen:aR};function Fs(e,t=[]){return t[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(e&255)/255,t}function Fm(e){let t=e.toString(16);return t="000000".substring(0,6-t.length)+t,`#${t}`}function yc(e){if(typeof e=="string"&&(e=lR[e.toLowerCase()]||e,e[0]==="#"&&(e=e.slice(1)),e.length===3)){const[t,r,n]=e;e=t+t+r+r+n+n}return parseInt(e,16)}function hR(){const e=[],t=[];for(let n=0;n<32;n++)e[n]=n,t[n]=n;e[ct.NORMAL_NPM]=ct.NORMAL,e[ct.ADD_NPM]=ct.ADD,e[ct.SCREEN_NPM]=ct.SCREEN,t[ct.NORMAL]=ct.NORMAL_NPM,t[ct.ADD]=ct.ADD_NPM,t[ct.SCREEN]=ct.SCREEN_NPM;const r=[];return r.push(t),r.push(e),r}const Lm=hR();function Nm(e,t){return Lm[t?1:0][e]}function uR(e,t,r,n){return r=r||new Float32Array(4),n||n===void 0?(r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t):(r[0]=e[0],r[1]=e[1],r[2]=e[2]),r[3]=t,r}function _c(e,t){if(t===1)return(t*255<<24)+e;if(t===0)return 0;let r=e>>16&255,n=e>>8&255,i=e&255;return r=r*t+.5|0,n=n*t+.5|0,i=i*t+.5|0,(t*255<<24)+(r<<16)+(n<<8)+i}function km(e,t,r,n){return r=r||new Float32Array(4),r[0]=(e>>16&255)/255,r[1]=(e>>8&255)/255,r[2]=(e&255)/255,(n||n===void 0)&&(r[0]*=t,r[1]*=t,r[2]*=t),r[3]=t,r}function cR(e,t=null){const r=e*6;if(t=t||new Uint16Array(r),t.length!==r)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${r}`);for(let n=0,i=0;n<r;n+=6,i+=4)t[n+0]=i+0,t[n+1]=i+1,t[n+2]=i+2,t[n+3]=i+0,t[n+4]=i+2,t[n+5]=i+3;return t}function Um(e){if(e.BYTES_PER_ELEMENT===4)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(e.BYTES_PER_ELEMENT===2){if(e instanceof Uint16Array)return"Uint16Array"}else if(e.BYTES_PER_ELEMENT===1&&e instanceof Uint8Array)return"Uint8Array";return null}function Ia(e){return e+=e===0?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e+1}function Qp(e){return!(e&e-1)&&!!e}function tg(e){let t=(e>65535?1:0)<<4;e>>>=t;let r=(e>255?1:0)<<3;return e>>>=r,t|=r,r=(e>15?1:0)<<2,e>>>=r,t|=r,r=(e>3?1:0)<<1,e>>>=r,t|=r,t|e>>1}function Li(e,t,r){const n=e.length;let i;if(t>=n||r===0)return;r=t+r>n?n-t:r;const o=n-r;for(i=t;i<o;++i)e[i]=e[i+r];e.length=o}function Pi(e){return e===0?0:e<0?-1:1}let fR=0;function Jn(){return++fR}const Gm=class{constructor(e,t,r,n){this.left=e,this.top=t,this.right=r,this.bottom=n}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let Ou=Gm;Ou.EMPTY=new Gm(0,0,0,0);const eg={},Ir=Object.create(null),dn=Object.create(null);class rg{constructor(t,r,n){this._canvas=Q.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=n||Q.RESOLUTION,this.resize(t,r)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,r){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(r*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function ng(e,t,r){for(let n=0,i=4*r*t;n<t;++n,i+=4)if(e[i+3]!==0)return!1;return!0}function ig(e,t,r,n,i){const o=4*t;for(let l=n,h=n*o+4*r;l<=i;++l,h+=o)if(e[h+3]!==0)return!1;return!0}function dR(e){const{width:t,height:r}=e,n=e.getContext("2d",{willReadFrequently:!0});if(n===null)throw new TypeError("Failed to get canvas 2D context");const o=n.getImageData(0,0,t,r).data;let l=0,h=0,u=t-1,f=r-1;for(;h<r&&ng(o,t,h);)++h;if(h===r)return Ou.EMPTY;for(;ng(o,t,f);)--f;for(;ig(o,t,l,h,f);)++l;for(;ig(o,t,u,h,f);)--u;return++u,++f,new Ou(l,h,u,f)}function pR(e){const t=dR(e),{width:r,height:n}=t;let i=null;if(!t.isEmpty()){const o=e.getContext("2d");if(o===null)throw new TypeError("Failed to get canvas 2D context");i=o.getImageData(t.left,t.top,r,n)}return{width:r,height:n,data:i}}let Wo;function gR(e,t=globalThis.location){if(e.startsWith("data:"))return"";t=t||globalThis.location,Wo||(Wo=document.createElement("a")),Wo.href=e;const r=vC.parse(Wo.href),n=!r.port&&t.port===""||r.port===t.port;return r.hostname!==t.hostname||!n||r.protocol!==t.protocol?"anonymous":""}function xn(e,t=1){var n;const r=(n=Q.RETINA_PREFIX)==null?void 0:n.exec(e);return r?parseFloat(r[1]):t}var J=(e=>(e.Renderer="renderer",e.Application="application",e.RendererSystem="renderer-webgl-system",e.RendererPlugin="renderer-webgl-plugin",e.CanvasRendererSystem="renderer-canvas-system",e.CanvasRendererPlugin="renderer-canvas-plugin",e.Asset="asset",e.LoadParser="load-parser",e.ResolveParser="resolve-parser",e.CacheParser="cache-parser",e.DetectionParser="detection-parser",e))(J||{});const Fu=e=>{if(typeof e=="function"||typeof e=="object"&&e.extension){if(!e.extension)throw new Error("Extension class must have an extension object");e={...typeof e.extension!="object"?{type:e.extension}:e.extension,ref:e}}if(typeof e=="object")e={...e};else throw new Error("Invalid extension type");return typeof e.type=="string"&&(e.type=[e.type]),e},sg=(e,t)=>Fu(e).priority??t,st={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...e){return e.map(Fu).forEach(t=>{t.type.forEach(r=>{var n,i;return(i=(n=this._removeHandlers)[r])==null?void 0:i.call(n,t)})}),this},add(...e){return e.map(Fu).forEach(t=>{t.type.forEach(r=>{const n=this._addHandlers,i=this._queue;n[r]?n[r](t):(i[r]=i[r]||[],i[r].push(t))})}),this},handle(e,t,r){const n=this._addHandlers,i=this._removeHandlers;if(n[e]||i[e])throw new Error(`Extension type ${e} already has a handler`);n[e]=t,i[e]=r;const o=this._queue;return o[e]&&(o[e].forEach(l=>t(l)),delete o[e]),this},handleByMap(e,t){return this.handle(e,r=>{t[r.name]=r.ref},r=>{delete t[r.name]})},handleByList(e,t,r=-1){return this.handle(e,n=>{t.includes(n.ref)||(t.push(n.ref),t.sort((i,o)=>sg(o,r)-sg(i,r)))},n=>{const i=t.indexOf(n.ref);i!==-1&&t.splice(i,1)})}};class Lu{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const mR=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function vR(e){let t="";for(let r=0;r<e;++r)r>0&&(t+=`
else `),r<e-1&&(t+=`if(test == ${r}.0){}`);return t}function yR(e,t){if(e===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const r=t.createShader(t.FRAGMENT_SHADER);for(;;){const n=mR.replace(/%forloop%/gi,vR(e));if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))e=e/2|0;else break}return e}const kh=0,Uh=1,Gh=2,$h=3,Wh=4,Hh=5;class rn{constructor(){this.data=0,this.blendMode=ct.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<kh)}set blend(t){!!(this.data&1<<kh)!==t&&(this.data^=1<<kh)}get offsets(){return!!(this.data&1<<Uh)}set offsets(t){!!(this.data&1<<Uh)!==t&&(this.data^=1<<Uh)}get culling(){return!!(this.data&1<<Gh)}set culling(t){!!(this.data&1<<Gh)!==t&&(this.data^=1<<Gh)}get depthTest(){return!!(this.data&1<<$h)}set depthTest(t){!!(this.data&1<<$h)!==t&&(this.data^=1<<$h)}get depthMask(){return!!(this.data&1<<Hh)}set depthMask(t){!!(this.data&1<<Hh)!==t&&(this.data^=1<<Hh)}get clockwiseFrontFace(){return!!(this.data&1<<Wh)}set clockwiseFrontFace(t){!!(this.data&1<<Wh)!==t&&(this.data^=1<<Wh)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==ct.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new rn;return t.depthTest=!1,t.blend=!0,t}}const Nu=[];function $m(e,t){if(!e)return null;let r="";if(typeof e=="string"){const n=/\.(\w{3,4})(?:$|\?|#)/i.exec(e);n&&(r=n[1].toLowerCase())}for(let n=Nu.length-1;n>=0;--n){const i=Nu[n];if(i.test&&i.test(e,r))return new i(e,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class xr{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,r,n,i,o,l,h,u){if(arguments.length>8)throw new Error("max arguments reached");const{name:f,items:d}=this;this._aliasCount++;for(let p=0,g=d.length;p<g;p++)d[p][f](t,r,n,i,o,l,h,u);return d===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const r=this.items.indexOf(t);return r!==-1&&(this.ensureNonAliasedItems(),this.items.splice(r,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(xr.prototype,{dispatch:{value:xr.prototype.emit},run:{value:xr.prototype.emit}});class Ls{constructor(t=0,r=0){this._width=t,this._height=r,this.destroyed=!1,this.internal=!1,this.onResize=new xr("setRealSize"),this.onUpdate=new xr("update"),this.onError=new xr("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,r){(t!==this._width||r!==this._height)&&(this._width=t,this._height=r,this.onResize.emit(t,r))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,r,n){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,r){return!1}}class Hs extends Ls{constructor(t,r){const{width:n,height:i}=r||{};if(!n||!i)throw new Error("BufferResource width or height invalid");super(n,i),this.data=t}upload(t,r,n){const i=t.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===wr.UNPACK);const o=r.realWidth,l=r.realHeight;return n.width===o&&n.height===l?i.texSubImage2D(r.target,0,0,0,o,l,r.format,n.type,this.data):(n.width=o,n.height=l,i.texImage2D(r.target,0,n.internalFormat,o,l,0,r.format,n.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const _R={scaleMode:Jr.NEAREST,format:Y.RGBA,alphaMode:wr.NPM},Ti=class extends Gs{constructor(e=null,t=null){super(),t=Object.assign({},Ti.defaultOptions,t);const{alphaMode:r,mipmap:n,anisotropicLevel:i,scaleMode:o,width:l,height:h,wrapMode:u,format:f,type:d,target:p,resolution:g,resourceOptions:v}=t;e&&!(e instanceof Ls)&&(e=$m(e,v),e.internal=!0),this.resolution=g||Q.RESOLUTION,this.width=Math.round((l||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=n,this.anisotropicLevel=i,this._wrapMode=u,this._scaleMode=o,this.format=f,this.type=d,this.target=p,this.alphaMode=r,this.uid=Jn(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=l>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let r;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,r=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,r=!0),r&&this.dirtyStyleId++,this}setSize(e,t,r){return r=r||this.resolution,this.setRealSize(e*r,t*r,r)}setRealSize(e,t,r){return this.resolution=r||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Qp(this.realWidth)&&Qp(this.realHeight)}setResolution(e){const t=this.resolution;return t===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT(),this)}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete dn[this.cacheId],delete Ir[this.cacheId],this.cacheId=null),this.dispose(),Ti.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,t,r=Q.STRICT_TEXTURE_CACHE){const n=typeof e=="string";let i=null;if(n)i=e;else{if(!e._pixiId){const l=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${l}_${Jn()}`}i=e._pixiId}let o=dn[i];if(n&&r&&!o)throw new Error(`The cacheId "${i}" does not exist in BaseTextureCache.`);return o||(o=new Ti(e,t),o.cacheId=i,Ti.addToCache(o,i)),o}static fromBuffer(e,t,r,n){e=e||new Float32Array(t*r*4);const i=new Hs(e,{width:t,height:r}),o=e instanceof Float32Array?ot.FLOAT:ot.UNSIGNED_BYTE;return new Ti(i,Object.assign({},_R,n||{width:t,height:r,type:o}))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),dn[t]&&dn[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),dn[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=dn[e];if(t){const r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete dn[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete dn[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};let mt=Ti;mt.defaultOptions={mipmap:Lr.POW2,anisotropicLevel:0,scaleMode:Jr.LINEAR,wrapMode:_n.CLAMP,alphaMode:wr.UNPACK,target:Bi.TEXTURE_2D,format:Y.RGBA,type:ot.UNSIGNED_BYTE};mt._globalBatch=0;class ku{constructor(){this.texArray=null,this.blend=0,this.type=Br.TRIANGLES,this.start=0,this.size=0,this.data=null}}let xR=0;class se{constructor(t,r=!0,n=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=n,this.static=r,this.id=xR++,this.disposeRunner=new xr("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Or.ELEMENT_ARRAY_BUFFER:Or.ARRAY_BUFFER}get index(){return this.type===Or.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new se(t)}}class Pa{constructor(t,r=0,n=!1,i=ot.FLOAT,o,l,h,u=1){this.buffer=t,this.size=r,this.normalized=n,this.type=i,this.stride=o,this.start=l,this.instance=h,this.divisor=u}destroy(){this.buffer=null}static from(t,r,n,i,o){return new Pa(t,r,n,i,o)}}const bR={Float32Array,Uint32Array,Int32Array,Uint8Array};function wR(e,t){let r=0,n=0;const i={};for(let u=0;u<e.length;u++)n+=t[u],r+=e[u].length;const o=new ArrayBuffer(r*4);let l=null,h=0;for(let u=0;u<e.length;u++){const f=t[u],d=e[u],p=Um(d);i[p]||(i[p]=new bR[p](o)),l=i[p];for(let g=0;g<d.length;g++){const v=(g/f|0)*n+h,y=g%f;l[v+y]=d[g]}h+=f}return new Float32Array(o)}const og={5126:4,5123:2,5121:1};let ER=0;const TR={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class bn{constructor(t=[],r={}){this.buffers=t,this.indexBuffer=null,this.attributes=r,this.glVertexArrayObjects={},this.id=ER++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new xr("disposeGeometry"),this.refCount=0}addAttribute(t,r,n=0,i=!1,o,l,h,u=!1){if(!r)throw new Error("You must pass a buffer when creating an attribute");r instanceof se||(r instanceof Array&&(r=new Float32Array(r)),r=new se(r));const f=t.split("|");if(f.length>1){for(let p=0;p<f.length;p++)this.addAttribute(f[p],r,n,i,o);return this}let d=this.buffers.indexOf(r);return d===-1&&(this.buffers.push(r),d=this.buffers.length-1),this.attributes[t]=new Pa(d,n,i,o,l,h,u),this.instanced=this.instanced||u,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof se||(t instanceof Array&&(t=new Uint16Array(t)),t=new se(t)),t.type=Or.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],r=[],n=new se;let i;for(i in this.attributes){const o=this.attributes[i],l=this.buffers[o.buffer];t.push(l.data),r.push(o.size*og[o.type]/4),o.buffer=0}for(n.data=wR(t,r),i=0;i<this.buffers.length;i++)this.buffers[i]!==this.indexBuffer&&this.buffers[i].destroy();return this.buffers=[n],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const r=this.attributes[t];return this.buffers[r.buffer].data.length/(r.stride/4||r.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new bn;for(let r=0;r<this.buffers.length;r++)t.buffers[r]=new se(this.buffers[r].data.slice(0));for(const r in this.attributes){const n=this.attributes[r];t.attributes[r]=new Pa(n.buffer,n.size,n.normalized,n.type,n.stride,n.start,n.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Or.ELEMENT_ARRAY_BUFFER),t}static merge(t){const r=new bn,n=[],i=[],o=[];let l;for(let h=0;h<t.length;h++){l=t[h];for(let u=0;u<l.buffers.length;u++)i[u]=i[u]||0,i[u]+=l.buffers[u].data.length,o[u]=0}for(let h=0;h<l.buffers.length;h++)n[h]=new TR[Um(l.buffers[h].data)](i[h]),r.buffers[h]=new se(n[h]);for(let h=0;h<t.length;h++){l=t[h];for(let u=0;u<l.buffers.length;u++)n[u].set(l.buffers[u].data,o[u]),o[u]+=l.buffers[u].data.length}if(r.attributes=l.attributes,l.indexBuffer){r.indexBuffer=r.buffers[l.buffers.indexOf(l.indexBuffer)],r.indexBuffer.type=Or.ELEMENT_ARRAY_BUFFER;let h=0,u=0,f=0,d=0;for(let p=0;p<l.buffers.length;p++)if(l.buffers[p]!==l.indexBuffer){d=p;break}for(const p in l.attributes){const g=l.attributes[p];(g.buffer|0)===d&&(u+=g.size*og[g.type]/4)}for(let p=0;p<t.length;p++){const g=t[p].indexBuffer.data;for(let v=0;v<g.length;v++)r.indexBuffer.data[v+f]+=h;h+=t[p].buffers[d].data.length/u,f+=g.length}}return r}}class Wm extends bn{constructor(t=!1){super(),this._buffer=new se(null,t,!1),this._indexBuffer=new se(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,ot.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,ot.FLOAT).addAttribute("aColor",this._buffer,4,!0,ot.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,ot.FLOAT).addIndex(this._indexBuffer)}}const Ra=Math.PI*2,AR=180/Math.PI,SR=Math.PI/180;var xe=(e=>(e[e.POLY=0]="POLY",e[e.RECT=1]="RECT",e[e.CIRC=2]="CIRC",e[e.ELIP=3]="ELIP",e[e.RREC=4]="RREC",e))(xe||{});class Ct{constructor(t=0,r=0){this.x=0,this.y=0,this.x=t,this.y=r}clone(){return new Ct(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,r=t){return this.x=t,this.y=r,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const Ho=[new Ct,new Ct,new Ct,new Ct];class At{constructor(t=0,r=0,n=0,i=0){this.x=Number(t),this.y=Number(r),this.width=Number(n),this.height=Number(i),this.type=xe.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new At(0,0,0,0)}clone(){return new At(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,r){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&r>=this.y&&r<this.y+this.height}intersects(t,r){if(!r){const F=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=F)return!1;const q=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>q}const n=this.left,i=this.right,o=this.top,l=this.bottom;if(i<=n||l<=o)return!1;const h=Ho[0].set(t.left,t.top),u=Ho[1].set(t.left,t.bottom),f=Ho[2].set(t.right,t.top),d=Ho[3].set(t.right,t.bottom);if(f.x<=h.x||u.y<=h.y)return!1;const p=Math.sign(r.a*r.d-r.b*r.c);if(p===0||(r.apply(h,h),r.apply(u,u),r.apply(f,f),r.apply(d,d),Math.max(h.x,u.x,f.x,d.x)<=n||Math.min(h.x,u.x,f.x,d.x)>=i||Math.max(h.y,u.y,f.y,d.y)<=o||Math.min(h.y,u.y,f.y,d.y)>=l))return!1;const g=p*(u.y-h.y),v=p*(h.x-u.x),y=g*n+v*o,w=g*i+v*o,x=g*n+v*l,T=g*i+v*l;if(Math.max(y,w,x,T)<=g*h.x+v*h.y||Math.min(y,w,x,T)>=g*d.x+v*d.y)return!1;const S=p*(h.y-f.y),E=p*(f.x-h.x),I=S*n+E*o,D=S*i+E*o,L=S*n+E*l,O=S*i+E*l;return!(Math.max(I,D,L,O)<=S*h.x+E*h.y||Math.min(I,D,L,O)>=S*d.x+E*d.y)}pad(t=0,r=t){return this.x-=t,this.y-=r,this.width+=t*2,this.height+=r*2,this}fit(t){const r=Math.max(this.x,t.x),n=Math.min(this.x+this.width,t.x+t.width),i=Math.max(this.y,t.y),o=Math.min(this.y+this.height,t.y+t.height);return this.x=r,this.width=Math.max(n-r,0),this.y=i,this.height=Math.max(o-i,0),this}ceil(t=1,r=.001){const n=Math.ceil((this.x+this.width-r)*t)/t,i=Math.ceil((this.y+this.height-r)*t)/t;return this.x=Math.floor((this.x+r)*t)/t,this.y=Math.floor((this.y+r)*t)/t,this.width=n-this.x,this.height=i-this.y,this}enlarge(t){const r=Math.min(this.x,t.x),n=Math.max(this.x+this.width,t.x+t.width),i=Math.min(this.y,t.y),o=Math.max(this.y+this.height,t.y+t.height);return this.x=r,this.width=n-r,this.y=i,this.height=o-i,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class xc{constructor(t=0,r=0,n=0){this.x=t,this.y=r,this.radius=n,this.type=xe.CIRC}clone(){return new xc(this.x,this.y,this.radius)}contains(t,r){if(this.radius<=0)return!1;const n=this.radius*this.radius;let i=this.x-t,o=this.y-r;return i*=i,o*=o,i+o<=n}getBounds(){return new At(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class bc{constructor(t=0,r=0,n=0,i=0){this.x=t,this.y=r,this.width=n,this.height=i,this.type=xe.ELIP}clone(){return new bc(this.x,this.y,this.width,this.height)}contains(t,r){if(this.width<=0||this.height<=0)return!1;let n=(t-this.x)/this.width,i=(r-this.y)/this.height;return n*=n,i*=i,n+i<=1}getBounds(){return new At(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Ni{constructor(...t){let r=Array.isArray(t[0])?t[0]:t;if(typeof r[0]!="number"){const n=[];for(let i=0,o=r.length;i<o;i++)n.push(r[i].x,r[i].y);r=n}this.points=r,this.type=xe.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),r=new Ni(t);return r.closeStroke=this.closeStroke,r}contains(t,r){let n=!1;const i=this.points.length/2;for(let o=0,l=i-1;o<i;l=o++){const h=this.points[o*2],u=this.points[o*2+1],f=this.points[l*2],d=this.points[l*2+1];u>r!=d>r&&t<(f-h)*((r-u)/(d-u))+h&&(n=!n)}return n}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((t,r)=>`${t}, ${r}`,"")}]`}}class wc{constructor(t=0,r=0,n=0,i=0,o=20){this.x=t,this.y=r,this.width=n,this.height=i,this.radius=o,this.type=xe.RREC}clone(){return new wc(this.x,this.y,this.width,this.height,this.radius)}contains(t,r){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&r>=this.y&&r<=this.y+this.height){const n=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(r>=this.y+n&&r<=this.y+this.height-n||t>=this.x+n&&t<=this.x+this.width-n)return!0;let i=t-(this.x+n),o=r-(this.y+n);const l=n*n;if(i*i+o*o<=l||(i=t-(this.x+this.width-n),i*i+o*o<=l)||(o=r-(this.y+this.height-n),i*i+o*o<=l)||(i=t-(this.x+n),i*i+o*o<=l))return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class Vt{constructor(t=1,r=0,n=0,i=1,o=0,l=0){this.array=null,this.a=t,this.b=r,this.c=n,this.d=i,this.tx=o,this.ty=l}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,r,n,i,o,l){return this.a=t,this.b=r,this.c=n,this.d=i,this.tx=o,this.ty=l,this}toArray(t,r){this.array||(this.array=new Float32Array(9));const n=r||this.array;return t?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n}apply(t,r){r=r||new Ct;const n=t.x,i=t.y;return r.x=this.a*n+this.c*i+this.tx,r.y=this.b*n+this.d*i+this.ty,r}applyInverse(t,r){r=r||new Ct;const n=1/(this.a*this.d+this.c*-this.b),i=t.x,o=t.y;return r.x=this.d*n*i+-this.c*n*o+(this.ty*this.c-this.tx*this.d)*n,r.y=this.a*n*o+-this.b*n*i+(-this.ty*this.a+this.tx*this.b)*n,r}translate(t,r){return this.tx+=t,this.ty+=r,this}scale(t,r){return this.a*=t,this.d*=r,this.c*=t,this.b*=r,this.tx*=t,this.ty*=r,this}rotate(t){const r=Math.cos(t),n=Math.sin(t),i=this.a,o=this.c,l=this.tx;return this.a=i*r-this.b*n,this.b=i*n+this.b*r,this.c=o*r-this.d*n,this.d=o*n+this.d*r,this.tx=l*r-this.ty*n,this.ty=l*n+this.ty*r,this}append(t){const r=this.a,n=this.b,i=this.c,o=this.d;return this.a=t.a*r+t.b*i,this.b=t.a*n+t.b*o,this.c=t.c*r+t.d*i,this.d=t.c*n+t.d*o,this.tx=t.tx*r+t.ty*i+this.tx,this.ty=t.tx*n+t.ty*o+this.ty,this}setTransform(t,r,n,i,o,l,h,u,f){return this.a=Math.cos(h+f)*o,this.b=Math.sin(h+f)*o,this.c=-Math.sin(h-u)*l,this.d=Math.cos(h-u)*l,this.tx=t-(n*this.a+i*this.c),this.ty=r-(n*this.b+i*this.d),this}prepend(t){const r=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const n=this.a,i=this.c;this.a=n*t.a+this.b*t.c,this.b=n*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d}return this.tx=r*t.a+this.ty*t.c+t.tx,this.ty=r*t.b+this.ty*t.d+t.ty,this}decompose(t){const r=this.a,n=this.b,i=this.c,o=this.d,l=t.pivot,h=-Math.atan2(-i,o),u=Math.atan2(n,r),f=Math.abs(h+u);return f<1e-5||Math.abs(Ra-f)<1e-5?(t.rotation=u,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=h,t.skew.y=u),t.scale.x=Math.sqrt(r*r+n*n),t.scale.y=Math.sqrt(i*i+o*o),t.position.x=this.tx+(l.x*r+l.y*i),t.position.y=this.ty+(l.x*n+l.y*o),t}invert(){const t=this.a,r=this.b,n=this.c,i=this.d,o=this.tx,l=t*i-r*n;return this.a=i/l,this.b=-r/l,this.c=-n/l,this.d=t/l,this.tx=(n*this.ty-i*o)/l,this.ty=-(t*this.ty-r*o)/l,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Vt;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new Vt}static get TEMP_MATRIX(){return new Vt}}const Un=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Gn=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],$n=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Wn=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Uu=[],Hm=[],zo=Math.sign;function CR(){for(let e=0;e<16;e++){const t=[];Uu.push(t);for(let r=0;r<16;r++){const n=zo(Un[e]*Un[r]+$n[e]*Gn[r]),i=zo(Gn[e]*Un[r]+Wn[e]*Gn[r]),o=zo(Un[e]*$n[r]+$n[e]*Wn[r]),l=zo(Gn[e]*$n[r]+Wn[e]*Wn[r]);for(let h=0;h<16;h++)if(Un[h]===n&&Gn[h]===i&&$n[h]===o&&Wn[h]===l){t.push(h);break}}}for(let e=0;e<16;e++){const t=new Vt;t.set(Un[e],Gn[e],$n[e],Wn[e],0,0),Hm.push(t)}}CR();const jt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:e=>Un[e],uY:e=>Gn[e],vX:e=>$n[e],vY:e=>Wn[e],inv:e=>e&8?e&15:-e&7,add:(e,t)=>Uu[e][t],sub:(e,t)=>Uu[e][jt.inv(t)],rotate180:e=>e^4,isVertical:e=>(e&3)===2,byDirection:(e,t)=>Math.abs(e)*2<=Math.abs(t)?t>=0?jt.S:jt.N:Math.abs(t)*2<=Math.abs(e)?e>0?jt.E:jt.W:t>0?e>0?jt.SE:jt.SW:e>0?jt.NE:jt.NW,matrixAppendRotationInv:(e,t,r=0,n=0)=>{const i=Hm[jt.inv(t)];i.tx=r,i.ty=n,e.append(i)}};class yn{constructor(t,r,n=0,i=0){this._x=n,this._y=i,this.cb=t,this.scope=r}clone(t=this.cb,r=this.scope){return new yn(t,r,this._x,this._y)}set(t=0,r=t){return(this._x!==t||this._y!==r)&&(this._x=t,this._y=r,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const zm=class{constructor(){this.worldTransform=new Vt,this.localTransform=new Vt,this.position=new yn(this.onChange,this,0,0),this.scale=new yn(this.onChange,this,1,1),this.pivot=new yn(this.onChange,this,0,0),this.skew=new yn(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(e){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){const r=e.worldTransform,n=this.worldTransform;n.a=t.a*r.a+t.b*r.c,n.b=t.a*r.b+t.b*r.d,n.c=t.c*r.a+t.d*r.c,n.d=t.c*r.b+t.d*r.d,n.tx=t.tx*r.a+t.ty*r.c+r.tx,n.ty=t.tx*r.b+t.ty*r.d+r.ty,this._parentID=e._worldID,this._worldID++}}setFromMatrix(e){e.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())}};let Ec=zm;Ec.IDENTITY=new zm;var IR=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,PR=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function ag(e,t,r){const n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),n}function zh(e){const t=new Array(e);for(let r=0;r<t.length;r++)t[r]=!1;return t}function Xm(e,t){switch(e){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return zh(2*t);case"bvec3":return zh(3*t);case"bvec4":return zh(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const ki=[{test:e=>e.type==="float"&&e.size===1&&!e.isArray,code:e=>`
            if(uv["${e}"] !== ud["${e}"].value)
            {
                ud["${e}"].value = uv["${e}"]
                gl.uniform1f(ud["${e}"].location, uv["${e}"])
            }
            `},{test:(e,t)=>(e.type==="sampler2D"||e.type==="samplerCube"||e.type==="sampler2DArray")&&e.size===1&&!e.isArray&&(t==null||t.castToBaseTexture!==void 0),code:e=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${e}"], t);

            if(ud["${e}"].value !== t)
            {
                ud["${e}"].value = t;
                gl.uniform1i(ud["${e}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(e,t)=>e.type==="mat3"&&e.size===1&&!e.isArray&&t.a!==void 0,code:e=>`
            gl.uniformMatrix3fv(ud["${e}"].location, false, uv["${e}"].toArray(true));
            `,codeUbo:e=>`
                var ${e}_matrix = uv.${e}.toArray(true);

                data[offset] = ${e}_matrix[0];
                data[offset+1] = ${e}_matrix[1];
                data[offset+2] = ${e}_matrix[2];
        
                data[offset + 4] = ${e}_matrix[3];
                data[offset + 5] = ${e}_matrix[4];
                data[offset + 6] = ${e}_matrix[5];
        
                data[offset + 8] = ${e}_matrix[6];
                data[offset + 9] = ${e}_matrix[7];
                data[offset + 10] = ${e}_matrix[8];
            `},{test:(e,t)=>e.type==="vec2"&&e.size===1&&!e.isArray&&t.x!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${e}"].location, v.x, v.y);
                }`,codeUbo:e=>`
                v = uv.${e};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:e=>e.type==="vec2"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${e}"].location, v[0], v[1]);
                }
            `},{test:(e,t)=>e.type==="vec4"&&e.size===1&&!e.isArray&&t.width!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${e}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:e=>e.type==="vec4"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${e}"].location, v[0], v[1], v[2], v[3])
                }`}],RR={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},MR={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function DR(e,t){var n;const r=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const i in e.uniforms){const o=t[i];if(!o){(n=e.uniforms[i])!=null&&n.group&&(e.uniforms[i].ubo?r.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${i}, '${i}');
                    `):r.push(`
                        renderer.shader.syncUniformGroup(uv.${i}, syncData);
                    `));continue}const l=e.uniforms[i];let h=!1;for(let u=0;u<ki.length;u++)if(ki[u].test(o,l)){r.push(ki[u].code(i,l)),h=!0;break}if(!h){const f=(o.size===1&&!o.isArray?RR:MR)[o.type].replace("location",`ud["${i}"].location`);r.push(`
            cu = ud["${i}"];
            cv = cu.value;
            v = uv["${i}"];
            ${f};`)}}return new Function("ud","uv","renderer","syncData",r.join(`
`))}const Vm={};let xi=Vm;function BR(){if(xi===Vm||xi!=null&&xi.isContextLost()){const e=Q.ADAPTER.createCanvas();let t;Q.PREFER_ENV>=ei.WEBGL2&&(t=e.getContext("webgl2",{})),t||(t=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),xi=t}return xi}let Xo;function OR(){if(!Xo){Xo=rr.MEDIUM;const e=BR();e&&e.getShaderPrecisionFormat&&(Xo=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision?rr.HIGH:rr.MEDIUM)}return Xo}function lg(e,t){const r=e.getShaderSource(t).split(`
`).map((f,d)=>`${d}: ${f}`),n=e.getShaderInfoLog(t),i=n.split(`
`),o={},l=i.map(f=>parseFloat(f.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(f=>f&&!o[f]?(o[f]=!0,!0):!1),h=[""];l.forEach(f=>{r[f-1]=`%c${r[f-1]}%c`,h.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const u=r.join(`
`);h[0]=u,console.error(n),console.groupCollapsed("click to view full shader code"),console.warn(...h),console.groupEnd()}function FR(e,t,r,n){e.getProgramParameter(t,e.LINK_STATUS)||(e.getShaderParameter(r,e.COMPILE_STATUS)||lg(e,r),e.getShaderParameter(n,e.COMPILE_STATUS)||lg(e,n),console.error("PixiJS Error: Could not initialize shader."),e.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(t)))}const LR={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Ym(e){return LR[e]}let Vo=null;const hg={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function jm(e,t){if(!Vo){const r=Object.keys(hg);Vo={};for(let n=0;n<r.length;++n){const i=r[n];Vo[e[i]]=hg[i]}}return Vo[t]}function ug(e,t,r){if(e.substring(0,9)!=="precision"){let n=t;return t===rr.HIGH&&r!==rr.HIGH&&(n=rr.MEDIUM),`precision ${n} float;
${e}`}else if(r!==rr.HIGH&&e.substring(0,15)==="precision highp")return e.replace("precision highp","precision mediump");return e}let _s;function NR(){if(typeof _s=="boolean")return _s;try{_s=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{_s=!1}return _s}let kR=0;const Yo={},Ai=class{constructor(e,t,r="pixi-shader",n={}){this.extra={},this.id=kR++,this.vertexSrc=e||Ai.defaultVertexSrc,this.fragmentSrc=t||Ai.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),Yo[r]?(Yo[r]++,r+=`-${Yo[r]}`):Yo[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=ug(this.vertexSrc,Ai.defaultVertexPrecision,rr.HIGH),this.fragmentSrc=ug(this.fragmentSrc,Ai.defaultFragmentPrecision,OR())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return PR}static get defaultFragmentSrc(){return IR}static from(e,t,r){const n=e+t;let i=eg[n];return i||(eg[n]=i=new Ai(e,t,r)),i}};let vr=Ai;vr.defaultVertexPrecision=rr.HIGH;vr.defaultFragmentPrecision=Qr.apple.device?rr.HIGH:rr.MEDIUM;let UR=0;class br{constructor(t,r,n){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=UR++,this.static=!!r,this.ubo=!!n,t instanceof se?(this.buffer=t,this.buffer.type=Or.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new se(new Float32Array(1)),this.buffer.type=Or.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,r,n){if(!this.ubo)this.uniforms[t]=new br(r,n);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,r,n){return new br(t,r,n)}static uboFrom(t,r){return new br(t,r??!0,!0)}}class Fr{constructor(t,r){this.uniformBindCount=0,this.program=t,r?r instanceof br?this.uniformGroup=r:this.uniformGroup=new br(r):this.uniformGroup=new br({}),this.disposeRunner=new xr("disposeShader")}checkUniformExists(t,r){if(r.uniforms[t])return!0;for(const n in r.uniforms){const i=r.uniforms[n];if(i.group&&this.checkUniformExists(t,i))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,r,n){const i=vr.from(t,r);return new Fr(i,n)}}class GR{constructor(t,r){if(this.vertexSrc=t,this.fragTemplate=r,this.programCache={},this.defaultGroupCache={},!r.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!r.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const n=new Int32Array(t);for(let o=0;o<t;o++)n[o]=o;this.defaultGroupCache[t]=br.from({uSamplers:n},!0);let i=this.fragTemplate;i=i.replace(/%count%/gi,`${t}`),i=i.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new vr(this.vertexSrc,i)}const r={tint:new Float32Array([1,1,1,1]),translationMatrix:new Vt,default:this.defaultGroupCache[t]};return new Fr(this.programCache[t],r)}generateSampleSrc(t){let r="";r+=`
`,r+=`
`;for(let n=0;n<t;n++)n>0&&(r+=`
else `),n<t-1&&(r+=`if(vTextureId < ${n}.5)`),r+=`
{`,r+=`
	color = texture2D(uSamplers[${n}], vTextureCoord);`,r+=`
}`;return r+=`
`,r+=`
`,r}}class Gu{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function $R(){return!Qr.apple.device}function WR(e){let t=!0;const r=Q.ADAPTER.getNavigator();if(Qr.tablet||Qr.phone){if(Qr.apple.device){const n=r.userAgent.match(/OS (\d+)_(\d+)?/);n&&parseInt(n[1],10)<11&&(t=!1)}if(Qr.android.device){const n=r.userAgent.match(/Android\s([0-9.]*)/);n&&parseInt(n[1],10)<7&&(t=!1)}}return t?e:4}class Ya{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var HR=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,zR=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const fr=class extends Ya{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=Wm,this.vertexSize=6,this.state=rn.for2d(),this.size=fr.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??WR(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??$R(),this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return It("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return zR}static get defaultFragmentTemplate(){return HR}setShaderGenerator({vertex:e=fr.defaultVertexSrc,fragment:t=fr.defaultFragmentTemplate}={}){this.shaderGenerator=new GR(e,t)}contextChange(){const e=this.renderer.gl;Q.PREFER_ENV===ei.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),fr.defaultMaxTextures),this.maxTextures=yR(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:t}=fr,r=this.size/4,n=Math.floor(r/this.maxTextures)+1;for(;e.length<r;)e.push(new ku);for(;t.length<n;)t.push(new Gu);for(let i=0;i<this.maxTextures;i++)this._tempBoundTextures[i]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:t}=this,r=fr._textureArrayPool,n=this.renderer.batch,i=this._tempBoundTextures,o=this.renderer.textureGC.count;let l=++mt._globalBatch,h=0,u=r[0],f=0;n.copyBoundTextures(i,t);for(let d=0;d<this._bufferSize;++d){const p=e[d];e[d]=null,p._batchEnabled!==l&&(u.count>=t&&(n.boundArray(u,i,l,t),this.buildDrawCalls(u,f,d),f=d,u=r[++h],++l),p._batchEnabled=l,p.touched=o,u.elements[u.count++]=p)}u.count>0&&(n.boundArray(u,i,l,t),this.buildDrawCalls(u,f,this._bufferSize),++h,++l);for(let d=0;d<i.length;d++)i[d]=null;mt._globalBatch=l}buildDrawCalls(e,t,r){const{_bufferedElements:n,_attributeBuffer:i,_indexBuffer:o,vertexSize:l}=this,h=fr._drawCallPool;let u=this._dcIndex,f=this._aIndex,d=this._iIndex,p=h[u];p.start=this._iIndex,p.texArray=e;for(let g=t;g<r;++g){const v=n[g],y=v._texture.baseTexture,w=Lm[y.alphaMode?1:0][v.blendMode];n[g]=null,t<g&&p.blend!==w&&(p.size=d-p.start,t=g,p=h[++u],p.texArray=e,p.start=d),this.packInterleavedGeometry(v,i,o,f,d),f+=v.vertexData.length/2*l,d+=v.indices.length,p.blend=w}t<r&&(p.size=d-p.start,++u),this._dcIndex=u,this._aIndex=f,this._iIndex=d}bindAndClearTexArray(e){const t=this.renderer.texture;for(let r=0;r<e.count;r++)t.bind(e.elements[r],e.ids[r]),e.elements[r]=null;e.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:t,_indexBuffer:r}=this;fr.canUploadSameBuffer?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:t,state:r}=this.renderer,n=fr._drawCallPool;let i=null;for(let o=0;o<e;o++){const{texArray:l,type:h,size:u,start:f,blend:d}=n[o];i!==l&&(i=l,this.bindAndClearTexArray(l)),this.state.blendMode=d,r.set(this.state),t.drawElements(h,u,t.UNSIGNED_SHORT,f*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),fr.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=Ia(Math.ceil(e/8)),r=tg(t),n=t*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let i=this._aBuffers[n];return i||(this._aBuffers[n]=i=new Lu(n*this.vertexSize*4)),i}getIndexBuffer(e){const t=Ia(Math.ceil(e/12)),r=tg(t),n=t*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let i=this._iBuffers[r];return i||(this._iBuffers[r]=i=new Uint16Array(n)),i}packInterleavedGeometry(e,t,r,n,i){const{uint32View:o,float32View:l}=t,h=n/this.vertexSize,u=e.uvs,f=e.indices,d=e.vertexData,p=e._texture.baseTexture._batchLocation,g=Math.min(e.worldAlpha,1),v=g<1&&e._texture.baseTexture.alphaMode?_c(e._tintRGB,g):e._tintRGB+(g*255<<24);for(let y=0;y<d.length;y+=2)l[n++]=d[y],l[n++]=d[y+1],l[n++]=u[y],l[n++]=u[y+1],o[n++]=v,l[n++]=p;for(let y=0;y<f.length;y++)r[i++]=h+f[y]}};let gr=fr;gr.defaultBatchSize=4096;gr.extension={name:"batch",type:J.RendererPlugin};gr._drawCallPool=[];gr._textureArrayPool=[];st.add(gr);var XR=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,VR=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Es=class extends Fr{constructor(e,t,r){const n=vr.from(e||Es.defaultVertexSrc,t||Es.defaultFragmentSrc);super(n,r),this.padding=0,this.resolution=Es.defaultResolution,this.multisample=Es.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new rn}apply(e,t,r,n,i){e.applyFilter(this,t,r,n)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return VR}static get defaultFragmentSrc(){return XR}};let Re=Es;Re.defaultResolution=1;Re.defaultMultisample=le.NONE;class qm{constructor(){this.clearBeforeRender=!0,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,1],this._backgroundColorString="#000000",this.color=this._backgroundColor,this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender,t.color&&(this.color=typeof t.color=="string"?yc(t.color):t.color),this.alpha=t.alpha}get color(){return this._backgroundColor}set color(t){this._backgroundColor=t,this._backgroundColorString=Fm(t),Fs(t,this._backgroundColorRgba)}get alpha(){return this._backgroundColorRgba[3]}set alpha(t){this._backgroundColorRgba[3]=t}get colorRgba(){return this._backgroundColorRgba}get colorString(){return this._backgroundColorString}destroy(){}}qm.extension={type:[J.RendererSystem,J.CanvasRendererSystem],name:"background"};st.add(qm);class Km{constructor(t){this.renderer=t,this.emptyRenderer=new Ya(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,r){const{boundTextures:n}=this.renderer.texture;for(let i=r-1;i>=0;--i)t[i]=n[i]||null,t[i]&&(t[i]._batchLocation=i)}boundArray(t,r,n,i){const{elements:o,ids:l,count:h}=t;let u=0;for(let f=0;f<h;f++){const d=o[f],p=d._batchLocation;if(p>=0&&p<i&&r[p]===d){l[f]=p;continue}for(;u<i;){const g=r[u];if(g&&g._batchEnabled===n&&g._batchLocation===u){u++;continue}l[f]=u,d._batchLocation=u,r[u]=d;break}}}destroy(){this.renderer=null}}Km.extension={type:J.RendererSystem,name:"batch"};st.add(Km);let cg=0;class Zm{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=cg++}init(t){if(t.context)this.initFromContext(t.context);else{const r=this.renderer.background.alpha<1,n=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:r,premultipliedAlpha:n,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=cg++,this.renderer.runners.contextChange.emit(t);const r=this.renderer.view;r.addEventListener!==void 0&&(r.addEventListener("webglcontextlost",this.handleContextLost,!1),r.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const r=this.createContext(this.renderer.view,t);this.initFromContext(r)}createContext(t,r){let n;if(Q.PREFER_ENV>=ei.WEBGL2&&(n=t.getContext("webgl2",r)),n)this.webGLVersion=2;else if(this.webGLVersion=1,n=t.getContext("webgl",r)||t.getContext("experimental-webgl",r),!n)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=n,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,r={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,r,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,r,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const r=t.getContextAttributes(),n="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;n&&(this.webGLVersion=2),r&&!r.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const i=n||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=i,i||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Zm.extension={type:J.RendererSystem,name:"context"};st.add(Zm);class YR extends Hs{upload(t,r,n){const i=t.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===wr.UNPACK);const o=r.realWidth,l=r.realHeight;return n.width===o&&n.height===l?i.texSubImage2D(r.target,0,0,0,o,l,r.format,n.type,this.data):(n.width=o,n.height=l,i.texImage2D(r.target,0,n.internalFormat,o,l,0,r.format,n.type,this.data)),!0}}class $u{constructor(t,r){this.width=Math.round(t||100),this.height=Math.round(r||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new xr("disposeFramebuffer"),this.multisample=le.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,r){return this.colorTextures[t]=r||new mt(null,{scaleMode:Jr.NEAREST,resolution:1,mipmap:Lr.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new mt(new YR(null,{width:this.width,height:this.height}),{scaleMode:Jr.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Lr.OFF,format:Y.DEPTH_COMPONENT,type:ot.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,r){if(t=Math.round(t),r=Math.round(r),!(t===this.width&&r===this.height)){this.width=t,this.height=r,this.dirtyId++,this.dirtySize++;for(let n=0;n<this.colorTextures.length;n++){const i=this.colorTextures[n],o=i.resolution;i.setSize(t/o,r/o)}if(this.depthTexture){const n=this.depthTexture.resolution;this.depthTexture.setSize(t/n,r/n)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Jm extends mt{constructor(t={}){if(typeof t=="number"){const r=arguments[0],n=arguments[1],i=arguments[2],o=arguments[3];t={width:r,height:n,scaleMode:i,resolution:o}}t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=le.NONE),super(null,t),this.mipmap=Lr.OFF,this.valid=!0,this.clearColor=[0,0,0,0],this.framebuffer=new $u(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}resize(t,r){this.framebuffer.resize(t*this.resolution,r*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class wn extends Ls{constructor(t){const r=t,n=r.naturalWidth||r.videoWidth||r.width,i=r.naturalHeight||r.videoHeight||r.height;super(n,i),this.source=t,this.noSubImage=!1}static crossOrigin(t,r,n){n===void 0&&!r.startsWith("data:")?t.crossOrigin=gR(r):n!==!1&&(t.crossOrigin=typeof n=="string"?n:"anonymous")}upload(t,r,n,i){const o=t.gl,l=r.realWidth,h=r.realHeight;if(i=i||this.source,typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement){if(!i.complete||i.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement&&i.readyState<=1&&i.buffered.length===0)return!1;return o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===wr.UNPACK),!this.noSubImage&&r.target===o.TEXTURE_2D&&n.width===l&&n.height===h?o.texSubImage2D(o.TEXTURE_2D,0,0,0,r.format,n.type,i):(n.width=l,n.height=h,o.texImage2D(r.target,0,n.internalFormat,r.format,n.type,i)),!0}update(){if(this.destroyed)return;const t=this.source,r=t.naturalWidth||t.videoWidth||t.width,n=t.naturalHeight||t.videoHeight||t.height;this.resize(r,n),super.update()}dispose(){this.source=null}}class Qm extends wn{constructor(t,r){if(r=r||{},typeof t=="string"){const n=new Image;wn.crossOrigin(n,t,r.crossorigin),n.src=t,t=n}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(r.createBitmap??Q.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof r.alphaMode=="number"?r.alphaMode:null,this.bitmap=null,this._load=null,r.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((r,n)=>{const i=this.source;this.url=i.src;const o=()=>{this.destroyed||(i.onload=null,i.onerror=null,this.resize(i.width,i.height),this._load=null,this.createBitmap?r(this.process()):r(this))};i.complete&&i.src?o():(i.onload=o,i.onerror=l=>{n(l),this.onError.emit(l)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const r=globalThis.createImageBitmap,n=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:n?"cors":"no-cors"}).then(i=>i.blob()).then(i=>r(i,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===wr.UNPACK?"premultiply":"none"})).then(i=>this.destroyed?Promise.reject():(this.bitmap=i,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,r,n){if(typeof this.alphaMode=="number"&&(r.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,r,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,r,n,this.bitmap),!this.preserveBitmap){let i=!0;const o=r._glTextures;for(const l in o){const h=o[l];if(h!==n&&h.dirtyId!==r.dirtyId){i=!1;break}}i&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class tv{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,r,n){const i=r.width,o=r.height;if(n){const l=t.width/2/i,h=t.height/2/o,u=t.x/i+l,f=t.y/o+h;n=jt.add(n,jt.NW),this.x0=u+l*jt.uX(n),this.y0=f+h*jt.uY(n),n=jt.add(n,2),this.x1=u+l*jt.uX(n),this.y1=f+h*jt.uY(n),n=jt.add(n,2),this.x2=u+l*jt.uX(n),this.y2=f+h*jt.uY(n),n=jt.add(n,2),this.x3=u+l*jt.uX(n),this.y3=f+h*jt.uY(n)}else this.x0=t.x/i,this.y0=t.y/o,this.x1=(t.x+t.width)/i,this.y1=t.y/o,this.x2=(t.x+t.width)/i,this.y2=(t.y+t.height)/o,this.x3=t.x/i,this.y3=(t.y+t.height)/o;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const fg=new tv;function jo(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}class it extends Gs{constructor(t,r,n,i,o,l){if(super(),this.noFrame=!1,r||(this.noFrame=!0,r=new At(0,0,1,1)),t instanceof it&&(t=t.baseTexture),this.baseTexture=t,this._frame=r,this.trim=i,this.valid=!1,this._uvs=fg,this.uvMatrix=null,this.orig=n||r,this._rotate=Number(o||0),o===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=l?new Ct(l.x,l.y):new Ct(0,0),this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=r:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:r}=this.baseTexture;r!=null&&r.url&&Ir[r.url]&&it.removeFromCache(r.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,it.removeFromCache(this),this.textureCacheIds=null}clone(){var i;const t=this._frame.clone(),r=this._frame===this.orig?t:this.orig.clone(),n=new it(this.baseTexture,!this.noFrame&&t,r,(i=this.trim)==null?void 0:i.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(n._frame=t),n}updateUvs(){this._uvs===fg&&(this._uvs=new tv),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,r={},n=Q.STRICT_TEXTURE_CACHE){const i=typeof t=="string";let o=null;if(i)o=t;else if(t instanceof mt){if(!t.cacheId){const h=(r==null?void 0:r.pixiIdPrefix)||"pixiid";t.cacheId=`${h}-${Jn()}`,mt.addToCache(t,t.cacheId)}o=t.cacheId}else{if(!t._pixiId){const h=(r==null?void 0:r.pixiIdPrefix)||"pixiid";t._pixiId=`${h}_${Jn()}`}o=t._pixiId}let l=Ir[o];if(i&&n&&!l)throw new Error(`The cacheId "${o}" does not exist in TextureCache.`);return!l&&!(t instanceof mt)?(r.resolution||(r.resolution=xn(t)),l=new it(new mt(t,r)),l.baseTexture.cacheId=o,mt.addToCache(l.baseTexture,o),it.addToCache(l,o)):!l&&t instanceof mt&&(l=new it(t),it.addToCache(l,o)),l}static fromURL(t,r){const n=Object.assign({autoLoad:!1},r==null?void 0:r.resourceOptions),i=it.from(t,Object.assign({resourceOptions:n},r),!1),o=i.baseTexture.resource;return i.baseTexture.valid?Promise.resolve(i):o.load().then(()=>Promise.resolve(i))}static fromBuffer(t,r,n,i){return new it(mt.fromBuffer(t,r,n,i))}static fromLoader(t,r,n,i){const o=new mt(t,Object.assign({scaleMode:Q.SCALE_MODE,resolution:xn(r)},i)),{resource:l}=o;l instanceof Qm&&(l.url=r);const h=new it(o);return n||(n=r),mt.addToCache(h.baseTexture,n),it.addToCache(h,n),n!==r&&(mt.addToCache(h.baseTexture,r),it.addToCache(h,r)),h.baseTexture.valid?Promise.resolve(h):new Promise(u=>{h.baseTexture.once("loaded",()=>u(h))})}static addToCache(t,r){r&&(t.textureCacheIds.includes(r)||t.textureCacheIds.push(r),Ir[r]&&Ir[r]!==t&&console.warn(`Texture added to the cache with an id [${r}] that already had an entry`),Ir[r]=t)}static removeFromCache(t){if(typeof t=="string"){const r=Ir[t];if(r){const n=r.textureCacheIds.indexOf(t);return n>-1&&r.textureCacheIds.splice(n,1),delete Ir[t],r}}else if(t!=null&&t.textureCacheIds){for(let r=0;r<t.textureCacheIds.length;++r)Ir[t.textureCacheIds[r]]===t&&delete Ir[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:r,y:n,width:i,height:o}=t,l=r+i>this.baseTexture.width,h=n+o>this.baseTexture.height;if(l||h){const u=l&&h?"and":"or",f=`X: ${r} + ${i} = ${r+i} > ${this.baseTexture.width}`,d=`Y: ${n} + ${o} = ${n+o} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${f} ${u} ${d}`)}this.valid=i&&o&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return it._EMPTY||(it._EMPTY=new it(new mt),jo(it._EMPTY),jo(it._EMPTY.baseTexture)),it._EMPTY}static get WHITE(){if(!it._WHITE){const t=Q.ADAPTER.createCanvas(16,16),r=t.getContext("2d");t.width=16,t.height=16,r.fillStyle="white",r.fillRect(0,0,16,16),it._WHITE=new it(mt.from(t)),jo(it._WHITE),jo(it._WHITE.baseTexture)}return it._WHITE}}class En extends it{constructor(t,r){super(t,r),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,r,n=!0){const i=this.baseTexture.resolution,o=Math.round(t*i)/i,l=Math.round(r*i)/i;this.valid=o>0&&l>0,this._frame.width=this.orig.width=o,this._frame.height=this.orig.height=l,n&&this.baseTexture.resize(o,l),this.updateUvs()}setResolution(t){const{baseTexture:r}=this;r.resolution!==t&&(r.setResolution(t),this.resize(r.width,r.height,!1))}static create(t){return new En(new Jm(t))}}class ev{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,r,n=le.NONE){const i=new Jm(Object.assign({width:t,height:r,resolution:1,multisample:n},this.textureOptions));return new En(i)}getOptimalTexture(t,r,n=1,i=le.NONE){let o;t=Math.ceil(t*n-1e-6),r=Math.ceil(r*n-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||r!==this._pixelsHeight?(t=Ia(t),r=Ia(r),o=((t&65535)<<16|r&65535)>>>0,i>1&&(o+=i*4294967296)):o=i>1?-i:-1,this.texturePool[o]||(this.texturePool[o]=[]);let l=this.texturePool[o].pop();return l||(l=this.createTexture(t,r,i)),l.filterPoolKey=o,l.setResolution(n),l}getFilterTexture(t,r,n){const i=this.getOptimalTexture(t.width,t.height,r||t.resolution,n||le.NONE);return i.filterFrame=t.filterFrame,i}returnTexture(t){const r=t.filterPoolKey;t.filterFrame=null,this.texturePool[r].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const r in this.texturePool){const n=this.texturePool[r];if(n)for(let i=0;i<n.length;i++)n[i].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const r in this.texturePool){if(!(Number(r)<0))continue;const n=this.texturePool[r];if(n)for(let i=0;i<n.length;i++)n[i].destroy(!0);this.texturePool[r]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}ev.SCREEN_KEY=-1;class jR extends bn{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class rv extends bn{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new se(this.vertices),this.uvBuffer=new se(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,r){let n=0,i=0;return this.uvs[0]=n,this.uvs[1]=i,this.uvs[2]=n+r.width/t.width,this.uvs[3]=i,this.uvs[4]=n+r.width/t.width,this.uvs[5]=i+r.height/t.height,this.uvs[6]=n,this.uvs[7]=i+r.height/t.height,n=r.x,i=r.y,this.vertices[0]=n,this.vertices[1]=i,this.vertices[2]=n+r.width,this.vertices[3]=i,this.vertices[4]=n+r.width,this.vertices[5]=i+r.height,this.vertices[6]=n,this.vertices[7]=i+r.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class qR{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=le.NONE,this.sourceFrame=new At,this.destinationFrame=new At,this.bindingSourceFrame=new At,this.bindingDestinationFrame=new At,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const qo=[new Ct,new Ct,new Ct,new Ct],Xh=new Vt;class nv{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new ev,this.statePool=[],this.quad=new jR,this.quadUv=new rv,this.tempRect=new At,this.activeState={},this.globalUniforms=new br({outputFrame:new At,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,r){const n=this.renderer,i=this.defaultFilterStack,o=this.statePool.pop()||new qR,l=this.renderer.renderTexture;let h=r[0].resolution,u=r[0].multisample,f=r[0].padding,d=r[0].autoFit,p=r[0].legacy??!0;for(let y=1;y<r.length;y++){const w=r[y];h=Math.min(h,w.resolution),u=Math.min(u,w.multisample),f=this.useMaxPadding?Math.max(f,w.padding):f+w.padding,d=d&&w.autoFit,p=p||(w.legacy??!0)}i.length===1&&(this.defaultFilterStack[0].renderTexture=l.current),i.push(o),o.resolution=h,o.multisample=u,o.legacy=p,o.target=t,o.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),o.sourceFrame.pad(f);const g=this.tempRect.copyFrom(l.sourceFrame);n.projection.transform&&this.transformAABB(Xh.copyFrom(n.projection.transform).invert(),g),d?(o.sourceFrame.fit(g),(o.sourceFrame.width<=0||o.sourceFrame.height<=0)&&(o.sourceFrame.width=0,o.sourceFrame.height=0)):o.sourceFrame.intersects(g)||(o.sourceFrame.width=0,o.sourceFrame.height=0),this.roundFrame(o.sourceFrame,l.current?l.current.resolution:n.resolution,l.sourceFrame,l.destinationFrame,n.projection.transform),o.renderTexture=this.getOptimalFilterTexture(o.sourceFrame.width,o.sourceFrame.height,h,u),o.filters=r,o.destinationFrame.width=o.renderTexture.width,o.destinationFrame.height=o.renderTexture.height;const v=this.tempRect;v.x=0,v.y=0,v.width=o.sourceFrame.width,v.height=o.sourceFrame.height,o.renderTexture.filterFrame=o.sourceFrame,o.bindingSourceFrame.copyFrom(l.sourceFrame),o.bindingDestinationFrame.copyFrom(l.destinationFrame),o.transform=n.projection.transform,n.projection.transform=null,l.bind(o.renderTexture,o.sourceFrame,v),n.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,r=t.pop(),n=r.filters;this.activeState=r;const i=this.globalUniforms.uniforms;i.outputFrame=r.sourceFrame,i.resolution=r.resolution;const o=i.inputSize,l=i.inputPixel,h=i.inputClamp;if(o[0]=r.destinationFrame.width,o[1]=r.destinationFrame.height,o[2]=1/o[0],o[3]=1/o[1],l[0]=Math.round(o[0]*r.resolution),l[1]=Math.round(o[1]*r.resolution),l[2]=1/l[0],l[3]=1/l[1],h[0]=.5*l[2],h[1]=.5*l[3],h[2]=r.sourceFrame.width*o[2]-.5*l[2],h[3]=r.sourceFrame.height*o[3]-.5*l[3],r.legacy){const f=i.filterArea;f[0]=r.destinationFrame.width,f[1]=r.destinationFrame.height,f[2]=r.sourceFrame.x,f[3]=r.sourceFrame.y,i.filterClamp=i.inputClamp}this.globalUniforms.update();const u=t[t.length-1];if(this.renderer.framebuffer.blit(),n.length===1)n[0].apply(this,r.renderTexture,u.renderTexture,Rr.BLEND,r),this.returnFilterTexture(r.renderTexture);else{let f=r.renderTexture,d=this.getOptimalFilterTexture(f.width,f.height,r.resolution);d.filterFrame=f.filterFrame;let p=0;for(p=0;p<n.length-1;++p){p===1&&r.multisample>1&&(d=this.getOptimalFilterTexture(f.width,f.height,r.resolution),d.filterFrame=f.filterFrame),n[p].apply(this,f,d,Rr.CLEAR,r);const g=f;f=d,d=g}n[p].apply(this,f,u.renderTexture,Rr.BLEND,r),p>1&&r.multisample>1&&this.returnFilterTexture(r.renderTexture),this.returnFilterTexture(f),this.returnFilterTexture(d)}r.clear(),this.statePool.push(r)}bindAndClear(t,r=Rr.CLEAR){const{renderTexture:n,state:i}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t!=null&&t.filterFrame){const l=this.tempRect;l.x=0,l.y=0,l.width=t.filterFrame.width,l.height=t.filterFrame.height,n.bind(t,t.filterFrame,l)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const o=i.stateId&1||this.forceClear;(r===Rr.CLEAR||r===Rr.BLIT&&o)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,r,n,i){const o=this.renderer;o.state.set(t.state),this.bindAndClear(n,i),t.uniforms.uSampler=r,t.uniforms.filterGlobals=this.globalUniforms,o.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(r._frame,r.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(Br.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(Br.TRIANGLE_STRIP))}calculateSpriteMatrix(t,r){const{sourceFrame:n,destinationFrame:i}=this.activeState,{orig:o}=r._texture,l=t.set(i.width,0,0,i.height,n.x,n.y),h=r.worldTransform.copyTo(Vt.TEMP_MATRIX);return h.invert(),l.prepend(h),l.scale(1/o.width,1/o.height),l.translate(r.anchor.x,r.anchor.y),l}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,r,n=1,i=le.NONE){return this.texturePool.getOptimalTexture(t,r,n,i)}getFilterTexture(t,r,n){if(typeof t=="number"){const o=t;t=r,r=o}t=t||this.activeState.renderTexture;const i=this.texturePool.getOptimalTexture(t.width,t.height,r||t.resolution,n||le.NONE);return i.filterFrame=t.filterFrame,i}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,r){const n=qo[0],i=qo[1],o=qo[2],l=qo[3];n.set(r.left,r.top),i.set(r.left,r.bottom),o.set(r.right,r.top),l.set(r.right,r.bottom),t.apply(n,n),t.apply(i,i),t.apply(o,o),t.apply(l,l);const h=Math.min(n.x,i.x,o.x,l.x),u=Math.min(n.y,i.y,o.y,l.y),f=Math.max(n.x,i.x,o.x,l.x),d=Math.max(n.y,i.y,o.y,l.y);r.x=h,r.y=u,r.width=f-h,r.height=d-u}roundFrame(t,r,n,i,o){if(!(t.width<=0||t.height<=0||n.width<=0||n.height<=0)){if(o){const{a:l,b:h,c:u,d:f}=o;if((Math.abs(h)>1e-4||Math.abs(u)>1e-4)&&(Math.abs(l)>1e-4||Math.abs(f)>1e-4))return}o=o?Xh.copyFrom(o):Xh.identity(),o.translate(-n.x,-n.y).scale(i.width/n.width,i.height/n.height).translate(i.x,i.y),this.transformAABB(o,t),t.ceil(r),this.transformAABB(o.invert(),t)}}}nv.extension={type:J.RendererSystem,name:"filter"};st.add(nv);class KR{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=le.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const ZR=new At;class iv{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new $u(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new At,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let r=this.renderer.context.extensions.drawBuffers,n=this.renderer.context.extensions.depthTexture;Q.PREFER_ENV===ei.WEBGL_LEGACY&&(r=null,n=null),r?t.drawBuffers=i=>r.drawBuffersWEBGL(i):(this.hasMRT=!1,t.drawBuffers=()=>{}),n||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,r,n=0){const{gl:i}=this;if(t){const o=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,i.bindFramebuffer(i.FRAMEBUFFER,o.framebuffer)),o.mipLevel!==n&&(t.dirtyId++,t.dirtyFormat++,o.mipLevel=n),o.dirtyId!==t.dirtyId&&(o.dirtyId=t.dirtyId,o.dirtyFormat!==t.dirtyFormat?(o.dirtyFormat=t.dirtyFormat,o.dirtySize=t.dirtySize,this.updateFramebuffer(t,n)):o.dirtySize!==t.dirtySize&&(o.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let l=0;l<t.colorTextures.length;l++){const h=t.colorTextures[l];this.renderer.texture.unbind(h.parentTextureArray||h)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),r){const l=r.width>>n,h=r.height>>n,u=l/r.width;this.setViewport(r.x*u,r.y*u,l,h)}else{const l=t.width>>n,h=t.height>>n;this.setViewport(0,0,l,h)}}else this.current&&(this.current=null,i.bindFramebuffer(i.FRAMEBUFFER,null)),r?this.setViewport(r.x,r.y,r.width,r.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,r,n,i){const o=this.viewport;t=Math.round(t),r=Math.round(r),n=Math.round(n),i=Math.round(i),(o.width!==n||o.height!==i||o.x!==t||o.y!==r)&&(o.x=t,o.y=r,o.width=n,o.height=i,this.gl.viewport(t,r,n,i))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,r,n,i,o=_u.COLOR|_u.DEPTH){const{gl:l}=this;l.clearColor(t,r,n,i),l.clear(o)}initFramebuffer(t){const{gl:r}=this,n=new KR(r.createFramebuffer());return n.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=n,this.managedFramebuffers.push(t),t.disposeRunner.add(this),n}resizeFramebuffer(t){const{gl:r}=this,n=t.glFramebuffers[this.CONTEXT_UID];n.stencil&&(r.bindRenderbuffer(r.RENDERBUFFER,n.stencil),n.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,r.DEPTH24_STENCIL8,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t.width,t.height));const i=t.colorTextures;let o=i.length;r.drawBuffers||(o=Math.min(o,1));for(let l=0;l<o;l++){const h=i[l],u=h.parentTextureArray||h;this.renderer.texture.bind(u,0),l===0&&n.msaaBuffer&&(r.bindRenderbuffer(r.RENDERBUFFER,n.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,r){const{gl:n}=this,i=t.glFramebuffers[this.CONTEXT_UID],o=t.colorTextures;let l=o.length;n.drawBuffers||(l=Math.min(l,1)),i.multisample>1&&this.canMultisampleFramebuffer(t)?i.msaaBuffer=i.msaaBuffer||n.createRenderbuffer():i.msaaBuffer&&(n.deleteRenderbuffer(i.msaaBuffer),i.msaaBuffer=null,i.blitFramebuffer&&(i.blitFramebuffer.dispose(),i.blitFramebuffer=null));const h=[];for(let u=0;u<l;u++){const f=o[u],d=f.parentTextureArray||f;this.renderer.texture.bind(d,0),u===0&&i.msaaBuffer?(n.bindRenderbuffer(n.RENDERBUFFER,i.msaaBuffer),n.renderbufferStorageMultisample(n.RENDERBUFFER,i.multisample,d._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,i.msaaBuffer)):(n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+u,f.target,d._glTextures[this.CONTEXT_UID].texture,r),h.push(n.COLOR_ATTACHMENT0+u))}if(h.length>1&&n.drawBuffers(h),t.depthTexture&&this.writeDepthTexture){const f=t.depthTexture;this.renderer.texture.bind(f,0),n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,f._glTextures[this.CONTEXT_UID].texture,r)}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(i.stencil=i.stencil||n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,i.stencil),i.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,i.multisample,n.DEPTH24_STENCIL8,t.width,t.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,i.stencil)):i.stencil&&(n.deleteRenderbuffer(i.stencil),i.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:r}=this;let n=le.NONE;if(t<=1||r===null)return n;for(let i=0;i<r.length;i++)if(r[i]<=t){n=r[i];break}return n===1&&(n=le.NONE),n}blit(t,r,n){const{current:i,renderer:o,gl:l,CONTEXT_UID:h}=this;if(o.context.webGLVersion!==2||!i)return;const u=i.glFramebuffers[h];if(!u)return;if(!t){if(!u.msaaBuffer)return;const d=i.colorTextures[0];if(!d)return;u.blitFramebuffer||(u.blitFramebuffer=new $u(i.width,i.height),u.blitFramebuffer.addColorTexture(0,d)),t=u.blitFramebuffer,t.colorTextures[0]!==d&&(t.colorTextures[0]=d,t.dirtyId++,t.dirtyFormat++),(t.width!==i.width||t.height!==i.height)&&(t.width=i.width,t.height=i.height,t.dirtyId++,t.dirtySize++)}r||(r=ZR,r.width=i.width,r.height=i.height),n||(n=r);const f=r.width===n.width&&r.height===n.height;this.bind(t),l.bindFramebuffer(l.READ_FRAMEBUFFER,u.framebuffer),l.blitFramebuffer(r.left,r.top,r.right,r.bottom,n.left,n.top,n.right,n.bottom,l.COLOR_BUFFER_BIT,f?l.NEAREST:l.LINEAR)}disposeFramebuffer(t,r){const n=t.glFramebuffers[this.CONTEXT_UID],i=this.gl;if(!n)return;delete t.glFramebuffers[this.CONTEXT_UID];const o=this.managedFramebuffers.indexOf(t);o>=0&&this.managedFramebuffers.splice(o,1),t.disposeRunner.remove(this),r||(i.deleteFramebuffer(n.framebuffer),n.msaaBuffer&&i.deleteRenderbuffer(n.msaaBuffer),n.stencil&&i.deleteRenderbuffer(n.stencil)),n.blitFramebuffer&&n.blitFramebuffer.dispose()}disposeAll(t){const r=this.managedFramebuffers;this.managedFramebuffers=[];for(let n=0;n<r.length;n++)this.disposeFramebuffer(r[n],t)}forceStencil(){const t=this.current;if(!t)return;const r=t.glFramebuffers[this.CONTEXT_UID];if(!r||r.stencil)return;t.stencil=!0;const n=t.width,i=t.height,o=this.gl,l=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,l),r.msaaBuffer?o.renderbufferStorageMultisample(o.RENDERBUFFER,r.multisample,o.DEPTH24_STENCIL8,n,i):o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,n,i),r.stencil=l,o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,l)}reset(){this.current=this.unknownFramebuffer,this.viewport=new At}destroy(){this.renderer=null}}iv.extension={type:J.RendererSystem,name:"framebuffer"};st.add(iv);const Vh={5126:4,5123:2,5121:1};class sv{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,r=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,r.webGLVersion!==2){let n=this.renderer.context.extensions.vertexArrayObject;Q.PREFER_ENV===ei.WEBGL_LEGACY&&(n=null),n?(t.createVertexArray=()=>n.createVertexArrayOES(),t.bindVertexArray=i=>n.bindVertexArrayOES(i),t.deleteVertexArray=i=>n.deleteVertexArrayOES(i)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(r.webGLVersion!==2){const n=t.getExtension("ANGLE_instanced_arrays");n?(t.vertexAttribDivisor=(i,o)=>n.vertexAttribDivisorANGLE(i,o),t.drawElementsInstanced=(i,o,l,h,u)=>n.drawElementsInstancedANGLE(i,o,l,h,u),t.drawArraysInstanced=(i,o,l,h)=>n.drawArraysInstancedANGLE(i,o,l,h)):this.hasInstance=!1}this.canUseUInt32ElementIndex=r.webGLVersion===2||!!r.extensions.uint32ElementIndex}bind(t,r){r=r||this.renderer.shader.shader;const{gl:n}=this;let i=t.glVertexArrayObjects[this.CONTEXT_UID],o=!1;i||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=i={},o=!0);const l=i[r.program.id]||this.initGeometryVao(t,r,o);this._activeGeometry=t,this._activeVao!==l&&(this._activeVao=l,this.hasVao?n.bindVertexArray(l):this.activateVao(t,r.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,r=this.renderer.buffer;for(let n=0;n<t.buffers.length;n++){const i=t.buffers[n];r.update(i)}}checkCompatibility(t,r){const n=t.attributes,i=r.attributeData;for(const o in i)if(!n[o])throw new Error(`shader and geometry incompatible, geometry missing the "${o}" attribute`)}getSignature(t,r){const n=t.attributes,i=r.attributeData,o=["g",t.id];for(const l in n)i[l]&&o.push(l,i[l].location);return o.join("-")}initGeometryVao(t,r,n=!0){const i=this.gl,o=this.CONTEXT_UID,l=this.renderer.buffer,h=r.program;h.glPrograms[o]||this.renderer.shader.generateProgram(r),this.checkCompatibility(t,h);const u=this.getSignature(t,h),f=t.glVertexArrayObjects[this.CONTEXT_UID];let d=f[u];if(d)return f[h.id]=d,d;const p=t.buffers,g=t.attributes,v={},y={};for(const w in p)v[w]=0,y[w]=0;for(const w in g)!g[w].size&&h.attributeData[w]?g[w].size=h.attributeData[w].size:g[w].size||console.warn(`PIXI Geometry attribute '${w}' size cannot be determined (likely the bound shader does not have the attribute)`),v[g[w].buffer]+=g[w].size*Vh[g[w].type];for(const w in g){const x=g[w],T=x.size;x.stride===void 0&&(v[x.buffer]===T*Vh[x.type]?x.stride=0:x.stride=v[x.buffer]),x.start===void 0&&(x.start=y[x.buffer],y[x.buffer]+=T*Vh[x.type])}d=i.createVertexArray(),i.bindVertexArray(d);for(let w=0;w<p.length;w++){const x=p[w];l.bind(x),n&&x._glBuffers[o].refCount++}return this.activateVao(t,h),f[h.id]=d,f[u]=d,i.bindVertexArray(null),l.unbind(Or.ARRAY_BUFFER),d}disposeGeometry(t,r){var h;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const n=t.glVertexArrayObjects[this.CONTEXT_UID],i=this.gl,o=t.buffers,l=(h=this.renderer)==null?void 0:h.buffer;if(t.disposeRunner.remove(this),!!n){if(l)for(let u=0;u<o.length;u++){const f=o[u]._glBuffers[this.CONTEXT_UID];f&&(f.refCount--,f.refCount===0&&!r&&l.dispose(o[u],r))}if(!r){for(const u in n)if(u[0]==="g"){const f=n[u];this._activeVao===f&&this.unbind(),i.deleteVertexArray(f)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const r=Object.keys(this.managedGeometries);for(let n=0;n<r.length;n++)this.disposeGeometry(this.managedGeometries[r[n]],t)}activateVao(t,r){const n=this.gl,i=this.CONTEXT_UID,o=this.renderer.buffer,l=t.buffers,h=t.attributes;t.indexBuffer&&o.bind(t.indexBuffer);let u=null;for(const f in h){const d=h[f],p=l[d.buffer],g=p._glBuffers[i];if(r.attributeData[f]){u!==g&&(o.bind(p),u=g);const v=r.attributeData[f].location;if(n.enableVertexAttribArray(v),n.vertexAttribPointer(v,d.size,d.type||n.FLOAT,d.normalized,d.stride,d.start),d.instance)if(this.hasInstance)n.vertexAttribDivisor(v,d.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,r,n,i){const{gl:o}=this,l=this._activeGeometry;if(l.indexBuffer){const h=l.indexBuffer.data.BYTES_PER_ELEMENT,u=h===2?o.UNSIGNED_SHORT:o.UNSIGNED_INT;h===2||h===4&&this.canUseUInt32ElementIndex?l.instanced?o.drawElementsInstanced(t,r||l.indexBuffer.data.length,u,(n||0)*h,i||1):o.drawElements(t,r||l.indexBuffer.data.length,u,(n||0)*h):console.warn("unsupported index buffer type: uint32")}else l.instanced?o.drawArraysInstanced(t,n,r||l.getSize(),i||1):o.drawArrays(t,n,r||l.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}sv.extension={type:J.RendererSystem,name:"geometry"};st.add(sv);const dg=new Vt;class ov{constructor(t,r){this._texture=t,this.mapCoord=new Vt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof r>"u"?.5:r,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,r){r===void 0&&(r=t);const n=this.mapCoord;for(let i=0;i<t.length;i+=2){const o=t[i],l=t[i+1];r[i]=o*n.a+l*n.c+n.tx,r[i+1]=o*n.b+l*n.d+n.ty}return r}update(t){const r=this._texture;if(!r||!r.valid||!t&&this._textureID===r._updateID)return!1;this._textureID=r._updateID,this._updateID++;const n=r._uvs;this.mapCoord.set(n.x1-n.x0,n.y1-n.y0,n.x3-n.x0,n.y3-n.y0,n.x0,n.y0);const i=r.orig,o=r.trim;o&&(dg.set(i.width/o.width,0,0,i.height/o.height,-o.x/o.width,-o.y/o.height),this.mapCoord.append(dg));const l=r.baseTexture,h=this.uClampFrame,u=this.clampMargin/l.resolution,f=this.clampOffset;return h[0]=(r._frame.x+u+f)/l.width,h[1]=(r._frame.y+u+f)/l.height,h[2]=(r._frame.x+r._frame.width-u+f)/l.width,h[3]=(r._frame.y+r._frame.height-u+f)/l.height,this.uClampOffset[0]=f/l.realWidth,this.uClampOffset[1]=f/l.realHeight,this.isSimple=r._frame.width===l.width&&r._frame.height===l.height&&r.rotate===0,!0}}var JR=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,QR=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class tM extends Re{constructor(t,r,n){let i=null;typeof t!="string"&&r===void 0&&n===void 0&&(i=t,t=void 0,r=void 0,n=void 0),super(t||QR,r||JR,n),this.maskSprite=i,this.maskMatrix=new Vt}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,r,n,i){const o=this._maskSprite,l=o._texture;l.valid&&(l.uvMatrix||(l.uvMatrix=new ov(l,0)),l.uvMatrix.update(),this.uniforms.npmAlpha=l.baseTexture.alphaMode?0:1,this.uniforms.mask=l,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,o).prepend(l.uvMatrix.mapCoord),this.uniforms.alpha=o.worldAlpha,this.uniforms.maskClamp=l.uvMatrix.uClampFrame,t.applyFilter(this,r,n,i))}}class eM{constructor(t=null){this.type=de.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Q.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=de.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class av{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,r){let n=r;if(!n.isMaskData){const o=this.maskDataPool.pop()||new eM;o.pooled=!0,o.maskObject=r,n=o}const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(n.copyCountersOrReset(i),n._colorMask=i?i._colorMask:15,n.autoDetect&&this.detect(n),n._target=t,n.type!==de.SPRITE&&this.maskStack.push(n),n.enabled)switch(n.type){case de.SCISSOR:this.renderer.scissor.push(n);break;case de.STENCIL:this.renderer.stencil.push(n);break;case de.SPRITE:n.copyCountersOrReset(null),this.pushSpriteMask(n);break;case de.COLOR:this.pushColorMask(n);break}n.type===de.SPRITE&&this.maskStack.push(n)}pop(t){const r=this.maskStack.pop();if(!(!r||r._target!==t)){if(r.enabled)switch(r.type){case de.SCISSOR:this.renderer.scissor.pop(r);break;case de.STENCIL:this.renderer.stencil.pop(r.maskObject);break;case de.SPRITE:this.popSpriteMask(r);break;case de.COLOR:this.popColorMask(r);break}if(r.reset(),r.pooled&&this.maskDataPool.push(r),this.maskStack.length!==0){const n=this.maskStack[this.maskStack.length-1];n.type===de.SPRITE&&n._filters&&(n._filters[0].maskSprite=n.maskObject)}}}detect(t){const r=t.maskObject;r?r.isSprite?t.type=de.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=de.SCISSOR:t.type=de.STENCIL:t.type=de.COLOR}pushSpriteMask(t){const{maskObject:r}=t,n=t._target;let i=t._filters;i||(i=this.alphaMaskPool[this.alphaMaskIndex],i||(i=this.alphaMaskPool[this.alphaMaskIndex]=[new tM]));const o=this.renderer,l=o.renderTexture;let h,u;if(l.current){const d=l.current;h=t.resolution||d.resolution,u=t.multisample??d.multisample}else h=t.resolution||o.resolution,u=t.multisample??o.multisample;i[0].resolution=h,i[0].multisample=u,i[0].maskSprite=r;const f=n.filterArea;n.filterArea=r.getBounds(!0),o.filter.push(n,i),n.filterArea=f,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const r=t._colorMask,n=t._colorMask=r&t.colorMask;n!==r&&this.renderer.gl.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)}popColorMask(t){const r=t._colorMask,n=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;n!==r&&this.renderer.gl.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)}destroy(){this.renderer=null}}av.extension={type:J.RendererSystem,name:"mask"};st.add(av);class lv{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:r}=this.renderer,n=this.getStackLength();this.maskStack=t;const i=this.getStackLength();i!==n&&(i===0?r.disable(this.glConst):(r.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const pg=new Vt,gg=[],ga=class extends lv{constructor(e){super(e),this.glConst=Q.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:r}=e,{renderer:n}=this,i=n.renderTexture,o=r.getBounds(!0,gg.pop()??new At);this.roundFrameToPixels(o,i.current?i.current.resolution:n.resolution,i.sourceFrame,i.destinationFrame,n.projection.transform),t&&o.fit(t),e._scissorRectLocal=o}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:r,c:n,d:i}=e;return(Math.abs(r)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(i)>1e-4)}testScissor(e){const{maskObject:t}=e;if(!t.isFastRect||!t.isFastRect()||ga.isMatrixRotated(t.worldTransform)||ga.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const r=e._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(e,t,r,n,i){ga.isMatrixRotated(i)||(i=i?pg.copyFrom(i):pg.identity(),i.translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.renderer.filter.transformAABB(i,e),e.fit(n),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&gg.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=e.y:t=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};let hv=ga;hv.extension={type:J.RendererSystem,name:"scissor"};st.add(hv);class uv extends lv{constructor(t){super(t),this.glConst=Q.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const r=t.maskObject,{gl:n}=this.renderer,i=t._stencilCounter;i===0&&(this.renderer.framebuffer.forceStencil(),n.clearStencil(0),n.clear(n.STENCIL_BUFFER_BIT),n.enable(n.STENCIL_TEST)),t._stencilCounter++;const o=t._colorMask;o!==0&&(t._colorMask=0,n.colorMask(!1,!1,!1,!1)),n.stencilFunc(n.EQUAL,i,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.INCR),r.renderable=!0,r.render(this.renderer),this.renderer.batch.flush(),r.renderable=!1,o!==0&&(t._colorMask=o,n.colorMask((o&1)!==0,(o&2)!==0,(o&4)!==0,(o&8)!==0)),this._useCurrent()}pop(t){const r=this.renderer.gl;if(this.getStackLength()===0)r.disable(r.STENCIL_TEST);else{const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,i=n?n._colorMask:15;i!==0&&(n._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilOp(r.KEEP,r.KEEP,r.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,i!==0&&(n._colorMask=i,r.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}uv.extension={type:J.RendererSystem,name:"stencil"};st.add(uv);class cv{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return It("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return It("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return It("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(t){for(const r in t)this.plugins[r]=new t[r](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}cv.extension={type:[J.RendererSystem,J.CanvasRendererSystem],name:"_plugin"};st.add(cv);class fv{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Vt,this.transform=null}update(t,r,n,i){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=r||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,n,i),this.transform&&this.projectionMatrix.append(this.transform);const o=this.renderer;o.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,o.globalUniforms.update(),o.shader.shader&&o.shader.syncUniformGroup(o.shader.shader.uniforms.globals)}calculateProjection(t,r,n,i){const o=this.projectionMatrix,l=i?-1:1;o.identity(),o.a=1/r.width*2,o.d=l*(1/r.height*2),o.tx=-1-r.x*o.a,o.ty=-l-r.y*o.d}setTransform(t){}destroy(){this.renderer=null}}fv.extension={type:J.RendererSystem,name:"projection"};st.add(fv);const rM=new Ec;class dv{constructor(t){this.renderer=t,this._tempMatrix=new Vt}generateTexture(t,r){const{region:n,...i}=r||{},o=n||t.getLocalBounds(null,!0);o.width===0&&(o.width=1),o.height===0&&(o.height=1);const l=En.create({width:o.width,height:o.height,...i});this._tempMatrix.tx=-o.x,this._tempMatrix.ty=-o.y;const h=t.transform;return t.transform=rM,this.renderer.render(t,{renderTexture:l,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=h,l}destroy(){}}dv.extension={type:[J.RendererSystem,J.CanvasRendererSystem],name:"textureGenerator"};st.add(dv);const Nn=new At,xs=new At;class pv{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new At,this.destinationFrame=new At,this.viewportFrame=new At}bind(t=null,r,n){const i=this.renderer;this.current=t;let o,l,h;t?(o=t.baseTexture,h=o.resolution,r||(Nn.width=t.frame.width,Nn.height=t.frame.height,r=Nn),n||(xs.x=t.frame.x,xs.y=t.frame.y,xs.width=r.width,xs.height=r.height,n=xs),l=o.framebuffer):(h=i.resolution,r||(Nn.width=i._view.screen.width,Nn.height=i._view.screen.height,r=Nn),n||(n=Nn,n.width=r.width,n.height=r.height));const u=this.viewportFrame;u.x=n.x*h,u.y=n.y*h,u.width=n.width*h,u.height=n.height*h,t||(u.y=i.view.height-(u.y+u.height)),u.ceil(),this.renderer.framebuffer.bind(l,u),this.renderer.projection.update(n,r,h,!l),t?this.renderer.mask.setMaskStack(o.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(r),this.destinationFrame.copyFrom(n)}clear(t,r){this.current?t=t||this.current.baseTexture.clearColor:t=t||this.renderer.background.colorRgba;const n=this.destinationFrame,i=this.current?this.current.baseTexture:this.renderer._view.screen,o=n.width!==i.width||n.height!==i.height;if(o){let{x:l,y:h,width:u,height:f}=this.viewportFrame;l=Math.round(l),h=Math.round(h),u=Math.round(u),f=Math.round(f),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,h,u,f)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],r),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}pv.extension={type:J.RendererSystem,name:"renderTexture"};st.add(pv);class nM{constructor(t,r){this.program=t,this.uniformData=r,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function iM(e,t){const r={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const o=t.getActiveAttrib(e,i);if(o.name.startsWith("gl_"))continue;const l=jm(t,o.type),h={type:l,name:o.name,size:Ym(l),location:t.getAttribLocation(e,o.name)};r[o.name]=h}return r}function sM(e,t){const r={},n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<n;i++){const o=t.getActiveUniform(e,i),l=o.name.replace(/\[.*?\]$/,""),h=!!o.name.match(/\[.*?\]$/),u=jm(t,o.type);r[l]={name:l,index:i,type:u,size:o.size,isArray:h,value:Xm(u,o.size)}}return r}function oM(e,t){var u;const r=ag(e,e.VERTEX_SHADER,t.vertexSrc),n=ag(e,e.FRAGMENT_SHADER,t.fragmentSrc),i=e.createProgram();e.attachShader(i,r),e.attachShader(i,n);const o=(u=t.extra)==null?void 0:u.transformFeedbackVaryings;if(o&&(typeof e.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):e.transformFeedbackVaryings(i,o.names,o.bufferMode==="separate"?e.SEPARATE_ATTRIBS:e.INTERLEAVED_ATTRIBS)),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)||FR(e,i,r,n),t.attributeData=iM(i,e),t.uniformData=sM(i,e),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const f=Object.keys(t.attributeData);f.sort((d,p)=>d>p?1:-1);for(let d=0;d<f.length;d++)t.attributeData[f[d]].location=d,e.bindAttribLocation(i,d,f[d]);e.linkProgram(i)}e.deleteShader(r),e.deleteShader(n);const l={};for(const f in t.uniformData){const d=t.uniformData[f];l[f]={location:e.getUniformLocation(i,f),value:Xm(d.type,d.size)}}return new nM(i,l)}function aM(e,t,r,n,i){r.buffer.update(i)}const lM={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},gv={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function hM(e){const t=e.map(o=>({data:o,offset:0,dataLen:0,dirty:0}));let r=0,n=0,i=0;for(let o=0;o<t.length;o++){const l=t[o];if(r=gv[l.data.type],l.data.size>1&&(r=Math.max(r,16)*l.data.size),l.dataLen=r,n%r!==0&&n<16){const h=n%r%16;n+=h,i+=h}n+r>16?(i=Math.ceil(i/16)*16,l.offset=i,i+=r,n=r):(l.offset=i,n+=r,i+=r)}return i=Math.ceil(i/16)*16,{uboElements:t,size:i}}function uM(e,t){const r=[];for(const n in e)t[n]&&r.push(t[n]);return r.sort((n,i)=>n.index-i.index),r}function cM(e,t){if(!e.autoManage)return{size:0,syncFunc:aM};const r=uM(e.uniforms,t),{uboElements:n,size:i}=hM(r),o=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let l=0;l<n.length;l++){const h=n[l],u=e.uniforms[h.data.name],f=h.data.name;let d=!1;for(let p=0;p<ki.length;p++){const g=ki[p];if(g.codeUbo&&g.test(h.data,u)){o.push(`offset = ${h.offset/4};`,ki[p].codeUbo(h.data.name,u)),d=!0;break}}if(!d)if(h.data.size>1){const p=Ym(h.data.type),g=Math.max(gv[h.data.type]/16,1),v=p/g,y=(4-v%4)%4;o.push(`
                cv = ud.${f}.value;
                v = uv.${f};
                offset = ${h.offset/4};

                t = 0;

                for(var i=0; i < ${h.data.size*g}; i++)
                {
                    for(var j = 0; j < ${v}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${y};
                }

                `)}else{const p=lM[h.data.type];o.push(`
                cv = ud.${f}.value;
                v = uv.${f};
                offset = ${h.offset/4};
                ${p};
                `)}}return o.push(`
       renderer.buffer.update(buffer);
    `),{size:i,syncFunc:new Function("ud","uv","renderer","syncData","buffer",o.join(`
`))}}let fM=0;const Ko={textureCount:0,uboCount:0};class mv{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=fM++}systemCheck(){if(!NR())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,r){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const n=t.program,i=n.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==n&&(this.program=n,this.gl.useProgram(i.program)),r||(Ko.textureCount=0,Ko.uboCount=0,this.syncUniformGroup(t.uniformGroup,Ko)),i}setUniforms(t){const r=this.shader.program,n=r.glPrograms[this.renderer.CONTEXT_UID];r.syncUniforms(n.uniformData,t,this.renderer)}syncUniformGroup(t,r){const n=this.getGlProgram();(!t.static||t.dirtyId!==n.uniformDirtyGroups[t.id])&&(n.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,n,r))}syncUniforms(t,r,n){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(r.uniformData,t.uniforms,this.renderer,n)}createSyncGroups(t){const r=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[r]||(this.cache[r]=DR(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[r],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,r){const n=this.getGlProgram();if(!t.static||t.dirtyId!==0||!n.uniformGroups[t.id]){t.dirtyId=0;const i=n.uniformGroups[t.id]||this.createSyncBufferGroup(t,n,r);t.buffer.update(),i(n.uniformData,t.uniforms,this.renderer,Ko,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,n.uniformBufferBindings[r])}createSyncBufferGroup(t,r,n){const{gl:i}=this.renderer;this.renderer.buffer.bind(t.buffer);const o=this.gl.getUniformBlockIndex(r.program,n);r.uniformBufferBindings[n]=this.shader.uniformBindCount,i.uniformBlockBinding(r.program,o,this.shader.uniformBindCount),this.shader.uniformBindCount++;const l=this.getSignature(t,this.shader.program.uniformData,"ubo");let h=this._uboCache[l];if(h||(h=this._uboCache[l]=cM(t,this.shader.program.uniformData)),t.autoManage){const u=new Float32Array(h.size/4);t.buffer.update(u)}return r.uniformGroups[t.id]=h.syncFunc,r.uniformGroups[t.id]}getSignature(t,r,n){const i=t.uniforms,o=[`${n}-`];for(const l in i)o.push(l),r[l]&&o.push(r[l].type);return o.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const r=this.gl,n=t.program,i=oM(r,n);return n.glPrograms[this.renderer.CONTEXT_UID]=i,i}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}mv.extension={type:J.RendererSystem,name:"shader"};st.add(mv);class vv{constructor(t){this.renderer=t}run(t){const r=this.renderer;r.emitWithCustomOptions(r.runners.init,t),t.hello&&console.log(`PixiJS 7.1.0 - ${r.rendererLogId} - https://pixijs.com`),r.resize(this.renderer.screen.width,this.renderer.screen.height)}destroy(){}}vv.extension={type:[J.RendererSystem,J.CanvasRendererSystem],name:"startup"};st.add(vv);function dM(e,t=[]){return t[ct.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.ADD]=[e.ONE,e.ONE],t[ct.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.NONE]=[0,0],t[ct.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[ct.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[ct.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[ct.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[ct.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[ct.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[ct.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[ct.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[ct.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[ct.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[ct.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t}const pM=0,gM=1,mM=2,vM=3,yM=4,_M=5,Wu=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=ct.NONE,this._blendEq=!1,this.map=[],this.map[pM]=this.setBlend,this.map[gM]=this.setOffset,this.map[mM]=this.setCullFace,this.map[vM]=this.setDepthTest,this.map[yM]=this.setFrontFace,this.map[_M]=this.setDepthMask,this.checks=[],this.defaultState=new rn,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=dM(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,r=0;for(;t;)t&1&&this.map[r].call(this,!!(e.data&1<<r)),t=t>>1,r++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this.updateCheck(Wu.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(Wu.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],r=this.gl;t.length===2?r.blendFunc(t[0],t[1]):r.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,r.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const r=this.checks.indexOf(e);t&&r===-1?this.checks.push(e):!t&&r!==-1&&this.checks.splice(r,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let yv=Wu;yv.extension={type:J.RendererSystem,name:"state"};st.add(yv);class xM extends Gs{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const r=(t.priority??[]).filter(i=>t.systems[i]),n=[...r,...Object.keys(t.systems).filter(i=>!r.includes(i))];for(const i of n)this.addSystem(t.systems[i],i)}addRunners(...t){t.forEach(r=>{this.runners[r]=new xr(r)})}addSystem(t,r){const n=new t(this);if(this[r])throw new Error(`Whoops! The name "${r}" is already in use`);this[r]=n,this._systemsHash[r]=n;for(const i in this.runners)this.runners[i].add(n);return this}emitWithCustomOptions(t,r){const n=Object.keys(this._systemsHash);t.items.forEach(i=>{const o=n.find(l=>this._systemsHash[l]===i);i[t.name](r[o])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const ma=class{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=ma.defaultMaxIdle,this.checkCountMax=ma.defaultCheckCountMax,this.mode=ma.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==hc.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let r=!1;for(let n=0;n<t.length;n++){const i=t[n];!i.framebuffer&&this.count-i.touched>this.maxIdle&&(e.destroyTexture(i,!0),t[n]=null,r=!0)}if(r){let n=0;for(let i=0;i<t.length;i++)t[i]!==null&&(t[n++]=t[i]);t.length=n}}unload(e){const t=this.renderer.texture,r=e._texture;r&&!r.framebuffer&&t.destroyTexture(r);for(let n=e.children.length-1;n>=0;n--)this.unload(e.children[n])}destroy(){this.renderer=null}};let mr=ma;mr.defaultMode=hc.AUTO;mr.defaultMaxIdle=60*60;mr.defaultCheckCountMax=60*10;mr.extension={type:J.RendererSystem,name:"textureGC"};st.add(mr);class Yh{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=ot.UNSIGNED_BYTE,this.internalFormat=Y.RGBA,this.samplerType=0}}function bM(e){let t;return"WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?t={[ot.UNSIGNED_BYTE]:{[Y.RGBA]:e.RGBA8,[Y.RGB]:e.RGB8,[Y.RG]:e.RG8,[Y.RED]:e.R8,[Y.RGBA_INTEGER]:e.RGBA8UI,[Y.RGB_INTEGER]:e.RGB8UI,[Y.RG_INTEGER]:e.RG8UI,[Y.RED_INTEGER]:e.R8UI,[Y.ALPHA]:e.ALPHA,[Y.LUMINANCE]:e.LUMINANCE,[Y.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[ot.BYTE]:{[Y.RGBA]:e.RGBA8_SNORM,[Y.RGB]:e.RGB8_SNORM,[Y.RG]:e.RG8_SNORM,[Y.RED]:e.R8_SNORM,[Y.RGBA_INTEGER]:e.RGBA8I,[Y.RGB_INTEGER]:e.RGB8I,[Y.RG_INTEGER]:e.RG8I,[Y.RED_INTEGER]:e.R8I},[ot.UNSIGNED_SHORT]:{[Y.RGBA_INTEGER]:e.RGBA16UI,[Y.RGB_INTEGER]:e.RGB16UI,[Y.RG_INTEGER]:e.RG16UI,[Y.RED_INTEGER]:e.R16UI,[Y.DEPTH_COMPONENT]:e.DEPTH_COMPONENT16},[ot.SHORT]:{[Y.RGBA_INTEGER]:e.RGBA16I,[Y.RGB_INTEGER]:e.RGB16I,[Y.RG_INTEGER]:e.RG16I,[Y.RED_INTEGER]:e.R16I},[ot.UNSIGNED_INT]:{[Y.RGBA_INTEGER]:e.RGBA32UI,[Y.RGB_INTEGER]:e.RGB32UI,[Y.RG_INTEGER]:e.RG32UI,[Y.RED_INTEGER]:e.R32UI,[Y.DEPTH_COMPONENT]:e.DEPTH_COMPONENT24},[ot.INT]:{[Y.RGBA_INTEGER]:e.RGBA32I,[Y.RGB_INTEGER]:e.RGB32I,[Y.RG_INTEGER]:e.RG32I,[Y.RED_INTEGER]:e.R32I},[ot.FLOAT]:{[Y.RGBA]:e.RGBA32F,[Y.RGB]:e.RGB32F,[Y.RG]:e.RG32F,[Y.RED]:e.R32F,[Y.DEPTH_COMPONENT]:e.DEPTH_COMPONENT32F},[ot.HALF_FLOAT]:{[Y.RGBA]:e.RGBA16F,[Y.RGB]:e.RGB16F,[Y.RG]:e.RG16F,[Y.RED]:e.R16F},[ot.UNSIGNED_SHORT_5_6_5]:{[Y.RGB]:e.RGB565},[ot.UNSIGNED_SHORT_4_4_4_4]:{[Y.RGBA]:e.RGBA4},[ot.UNSIGNED_SHORT_5_5_5_1]:{[Y.RGBA]:e.RGB5_A1},[ot.UNSIGNED_INT_2_10_10_10_REV]:{[Y.RGBA]:e.RGB10_A2,[Y.RGBA_INTEGER]:e.RGB10_A2UI},[ot.UNSIGNED_INT_10F_11F_11F_REV]:{[Y.RGB]:e.R11F_G11F_B10F},[ot.UNSIGNED_INT_5_9_9_9_REV]:{[Y.RGB]:e.RGB9_E5},[ot.UNSIGNED_INT_24_8]:{[Y.DEPTH_STENCIL]:e.DEPTH24_STENCIL8},[ot.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[Y.DEPTH_STENCIL]:e.DEPTH32F_STENCIL8}}:t={[ot.UNSIGNED_BYTE]:{[Y.RGBA]:e.RGBA,[Y.RGB]:e.RGB,[Y.ALPHA]:e.ALPHA,[Y.LUMINANCE]:e.LUMINANCE,[Y.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[ot.UNSIGNED_SHORT_5_6_5]:{[Y.RGB]:e.RGB},[ot.UNSIGNED_SHORT_4_4_4_4]:{[Y.RGBA]:e.RGBA},[ot.UNSIGNED_SHORT_5_5_5_1]:{[Y.RGBA]:e.RGBA}},t}class _v{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new mt,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=bM(t);const r=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=r;for(let i=0;i<r;i++)this.boundTextures[i]=null;this.emptyTextures={};const n=new Yh(t.createTexture());t.bindTexture(t.TEXTURE_2D,n.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=n,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Yh(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let i=0;i<6;i++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let i=0;i<this.boundTextures.length;i++)this.bind(null,i)}bind(t,r=0){const{gl:n}=this;if(t=t==null?void 0:t.castToBaseTexture(),t!=null&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const i=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[r]!==t&&(this.currentLocation!==r&&(this.currentLocation=r,n.activeTexture(n.TEXTURE0+r)),n.bindTexture(t.target,i.texture)),i.dirtyId!==t.dirtyId?(this.currentLocation!==r&&(this.currentLocation=r,n.activeTexture(n.TEXTURE0+r)),this.updateTexture(t)):i.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[r]=t}else this.currentLocation!==r&&(this.currentLocation=r,n.activeTexture(n.TEXTURE0+r)),n.bindTexture(n.TEXTURE_2D,this.emptyTextures[n.TEXTURE_2D].texture),this.boundTextures[r]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:r,boundTextures:n}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let i=0;i<n.length;i++)n[i]===this.unknownTexture&&this.bind(null,i)}for(let i=0;i<n.length;i++)n[i]===t&&(this.currentLocation!==i&&(r.activeTexture(r.TEXTURE0+i),this.currentLocation=i),r.bindTexture(t.target,this.emptyTextures[t.target].texture),n[i]=null)}ensureSamplerType(t){const{boundTextures:r,hasIntegerTextures:n,CONTEXT_UID:i}=this;if(n)for(let o=t-1;o>=0;--o){const l=r[o];l&&l._glTextures[i].samplerType!==xu.FLOAT&&this.renderer.texture.unbind(l)}}initTexture(t){const r=new Yh(this.gl.createTexture());return r.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=r,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),r}initTextureType(t,r){var n;r.internalFormat=((n=this.internalFormats[t.type])==null?void 0:n[t.format])??t.format,this.webGLVersion===2&&t.type===ot.HALF_FLOAT?r.type=this.gl.HALF_FLOAT:r.type=t.type}updateTexture(t){var i;const r=t._glTextures[this.CONTEXT_UID];if(!r)return;const n=this.renderer;if(this.initTextureType(t,r),(i=t.resource)!=null&&i.upload(n,t,r))r.samplerType!==xu.FLOAT&&(this.hasIntegerTextures=!0);else{const o=t.realWidth,l=t.realHeight,h=n.gl;(r.width!==o||r.height!==l||r.dirtyId<0)&&(r.width=o,r.height=l,h.texImage2D(t.target,0,r.internalFormat,o,l,0,t.format,r.type,null))}t.dirtyStyleId!==r.dirtyStyleId&&this.updateTextureStyle(t),r.dirtyId=t.dirtyId}destroyTexture(t,r){const{gl:n}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),n.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!r)){const i=this.managedTextures.indexOf(t);i!==-1&&Li(this.managedTextures,i,1)}}updateTextureStyle(t){var n;const r=t._glTextures[this.CONTEXT_UID];r&&((t.mipmap===Lr.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?r.mipmap=!1:r.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?r.wrapMode=_n.CLAMP:r.wrapMode=t.wrapMode,(n=t.resource)!=null&&n.style(this.renderer,t,r)||this.setStyle(t,r),r.dirtyStyleId=t.dirtyStyleId)}setStyle(t,r){const n=this.gl;if(r.mipmap&&t.mipmap!==Lr.ON_MANUAL&&n.generateMipmap(t.target),n.texParameteri(t.target,n.TEXTURE_WRAP_S,r.wrapMode),n.texParameteri(t.target,n.TEXTURE_WRAP_T,r.wrapMode),r.mipmap){n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode===Jr.LINEAR?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST);const i=this.renderer.context.extensions.anisotropicFiltering;if(i&&t.anisotropicLevel>0&&t.scaleMode===Jr.LINEAR){const o=Math.min(t.anisotropicLevel,n.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT));n.texParameterf(t.target,i.TEXTURE_MAX_ANISOTROPY_EXT,o)}}else n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode===Jr.LINEAR?n.LINEAR:n.NEAREST);n.texParameteri(t.target,n.TEXTURE_MAG_FILTER,t.scaleMode===Jr.LINEAR?n.LINEAR:n.NEAREST)}destroy(){this.renderer=null}}_v.extension={type:J.RendererSystem,name:"texture"};st.add(_v);class xv{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:r,CONTEXT_UID:n}=this,i=t._glTransformFeedbacks[n]||this.createGLTransformFeedback(t);r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,i)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,r){const{gl:n,renderer:i}=this;r&&i.shader.bind(r),n.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:r,renderer:n,CONTEXT_UID:i}=this,o=r.createTransformFeedback();t._glTransformFeedbacks[i]=o,r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,o);for(let l=0;l<t.buffers.length;l++){const h=t.buffers[l];h&&(n.buffer.update(h),h._glBuffers[i].refCount++,r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,l,h._glBuffers[i].buffer||null))}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),o}disposeTransformFeedback(t,r){const n=t._glTransformFeedbacks[this.CONTEXT_UID],i=this.gl;t.disposeRunner.remove(this);const o=this.renderer.buffer;if(o)for(let l=0;l<t.buffers.length;l++){const h=t.buffers[l];if(!h)continue;const u=h._glBuffers[this.CONTEXT_UID];u&&(u.refCount--,u.refCount===0&&!r&&o.dispose(h,r))}n&&(r||i.deleteTransformFeedback(n),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}xv.extension={type:J.RendererSystem,name:"transformFeedback"};st.add(xv);class bv{constructor(t){this.renderer=t}init(t){this.screen=new At(0,0,t.width,t.height),this.element=t.view||Q.ADAPTER.createCanvas(),this.resolution=t.resolution||Q.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,r){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(r*this.resolution);const n=this.element.width/this.resolution,i=this.element.height/this.resolution;this.screen.width=n,this.screen.height=i,this.autoDensity&&(this.element.style.width=`${n}px`,this.element.style.height=`${i}px`),this.renderer.emit("resize",n,i),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var r;t&&((r=this.element.parentNode)==null||r.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}bv.extension={type:[J.RendererSystem,J.CanvasRendererSystem],name:"_view"};st.add(bv);Q.PREFER_ENV=ei.WEBGL2;Q.STRICT_TEXTURE_CACHE=!1;Object.defineProperties(Q,{WRAP_MODE:{get(){return mt.defaultOptions.wrapMode},set(e){It("7.1.0","settings.WRAP_MODE is deprecated, use BaseTeture.defaultOptions.wrapMode"),mt.defaultOptions.wrapMode=e}},SCALE_MODE:{get(){return mt.defaultOptions.scaleMode},set(e){It("7.1.0","settings.SCALE_MODE is deprecated, use BaseTeture.defaultOptions.scaleMode"),mt.defaultOptions.scaleMode=e}},MIPMAP_TEXTURES:{get(){return mt.defaultOptions.mipmap},set(e){It("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTeture.defaultOptions.mipmap"),mt.defaultOptions.mipmap=e}},ANISOTROPIC_LEVEL:{get(){return mt.defaultOptions.anisotropicLevel},set(e){It("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTeture.defaultOptions.anisotropicLevel"),mt.defaultOptions.anisotropicLevel=e}},FILTER_RESOLUTION:{get(){return It("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Re.defaultResolution},set(e){Re.defaultResolution=e}},FILTER_MULTISAMPLE:{get(){return It("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Re.defaultMultisample},set(e){Re.defaultMultisample=e}},SPRITE_MAX_TEXTURES:{get(){return gr.defaultMaxTextures},set(e){It("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),gr.defaultMaxTextures=e}},SPRITE_BATCH_SIZE:{get(){return gr.defaultBatchSize},set(e){It("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),gr.defaultBatchSize=e}},CAN_UPLOAD_SAME_BUFFER:{get(){return gr.canUploadSameBuffer},set(e){It("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),gr.canUploadSameBuffer=e}},GC_MODE:{get(){return mr.defaultMode},set(e){It("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),mr.defaultMode=e}},GC_MAX_IDLE:{get(){return mr.defaultMaxIdle},set(e){It("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),mr.defaultMaxIdle=e}},GC_MAX_CHECK_COUNT:{get(){return mr.defaultCheckCountMax},set(e){It("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),mr.defaultCheckCountMax=e}},PRECISION_VERTEX:{get(){return vr.defaultVertexPrecision},set(e){It("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),vr.defaultVertexPrecision=e}},PRECISION_FRAGMENT:{get(){return vr.defaultFragmentPrecision},set(e){It("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),vr.defaultFragmentPrecision=e}}});var Wi=(e=>(e[e.HIGH=25]="HIGH",e[e.NORMAL=0]="NORMAL",e[e.LOW=-25]="LOW",e[e.UTILITY=-50]="UTILITY",e))(Wi||{});class jh{constructor(t,r=null,n=0,i=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=r,this.priority=n,this.once=i}match(t,r=null){return this.fn===t&&this.context===r}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const r=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),r}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const r=this.next;return this.next=t?null:r,this.previous=null,r}}const He=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new jh(null,null,1/0),this.deltaMS=1/He.targetFPMS,this.elapsedMS=1/He.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,r=Wi.NORMAL){return this._addListener(new jh(e,t,r))}addOnce(e,t,r=Wi.NORMAL){return this._addListener(new jh(e,t,r,!0))}_addListener(e){let t=this._head.next,r=this._head;if(!t)e.connect(r);else{for(;t;){if(e.priority>t.priority){e.connect(r);break}r=t,t=t.next}e.previous||e.connect(r)}return this._startIfPossible(),this}remove(e,t){let r=this._head.next;for(;r;)r.match(e,t)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const i=e-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=e-i%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*He.targetFPMS;const r=this._head;let n=r.next;for(;n;)n=n.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),r=Math.min(Math.max(0,t)/1e3,He.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!He._shared){const e=He._shared=new He;e.autoStart=!0,e._protected=!0}return He._shared}static get system(){if(!He._system){const e=He._system=new He;e.autoStart=!0,e._protected=!0}return He._system}};let Le=He;Le.targetFPMS=.06;Object.defineProperties(Q,{TARGET_FPMS:{get(){return Le.targetFPMS},set(e){It("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Le.targetFPMS=e}}});class wv{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(r){this._ticker&&this._ticker.remove(this.render,this),this._ticker=r,r&&r.add(this.render,this,Wi.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Le.shared:new Le,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}wv.extension=J.Application;st.add(wv);const Ev=[];st.handleByList(J.Renderer,Ev);function wM(e){for(const t of Ev)if(t.test(e))return new t(e);throw new Error("Unable to auto-detect a suitable renderer.")}var EM=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,TM=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const AM=EM,Tv=TM;class Av{constructor(t){this.renderer=t}contextChange(t){let r;if(this.renderer.context.webGLVersion===1){const n=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),r=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,n)}else{const n=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),r=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,n)}r>=le.HIGH?this.multisample=le.HIGH:r>=le.MEDIUM?this.multisample=le.MEDIUM:r>=le.LOW?this.multisample=le.LOW:this.multisample=le.NONE}destroy(){}}Av.extension={type:J.RendererSystem,name:"_multisample"};st.add(Av);class SM{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Sv{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:r,CONTEXT_UID:n}=this,i=t._glBuffers[n]||this.createGLBuffer(t);r.bindBuffer(t.type,i.buffer)}unbind(t){const{gl:r}=this;r.bindBuffer(t,null)}bindBufferBase(t,r){const{gl:n,CONTEXT_UID:i}=this;if(this.boundBufferBases[r]!==t){const o=t._glBuffers[i]||this.createGLBuffer(t);this.boundBufferBases[r]=t,n.bindBufferBase(n.UNIFORM_BUFFER,r,o.buffer)}}bindBufferRange(t,r,n){const{gl:i,CONTEXT_UID:o}=this;n=n||0;const l=t._glBuffers[o]||this.createGLBuffer(t);i.bindBufferRange(i.UNIFORM_BUFFER,r||0,l.buffer,n*256,256)}update(t){const{gl:r,CONTEXT_UID:n}=this,i=t._glBuffers[n]||this.createGLBuffer(t);if(t._updateID!==i.updateID)if(i.updateID=t._updateID,r.bindBuffer(t.type,i.buffer),i.byteLength>=t.data.byteLength)r.bufferSubData(t.type,0,t.data);else{const o=t.static?r.STATIC_DRAW:r.DYNAMIC_DRAW;i.byteLength=t.data.byteLength,r.bufferData(t.type,t.data,o)}}dispose(t,r){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const n=t._glBuffers[this.CONTEXT_UID],i=this.gl;t.disposeRunner.remove(this),n&&(r||i.deleteBuffer(n.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const r=Object.keys(this.managedBuffers);for(let n=0;n<r.length;n++)this.dispose(this.managedBuffers[r[n]],t)}createGLBuffer(t){const{CONTEXT_UID:r,gl:n}=this;return t._glBuffers[r]=new SM(n.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[r]}}Sv.extension={type:J.RendererSystem,name:"buffer"};st.add(Sv);class Cv{constructor(t){this.renderer=t}render(t,r){const n=this.renderer;let i,o,l,h;if(r&&(i=r.renderTexture,o=r.clear,l=r.transform,h=r.skipUpdateTransform),this.renderingToScreen=!i,n.runners.prerender.emit(),n.emit("prerender"),n.projection.transform=l,!n.context.isLost){if(i||(this.lastObjectRendered=t),!h){const u=t.enableTempParent();t.updateTransform(),t.disableTempParent(u)}n.renderTexture.bind(i),n.batch.currentRenderer.start(),(o??n.background.clearBeforeRender)&&n.renderTexture.clear(),t.render(n),n.batch.currentRenderer.flush(),i&&(r.blit&&n.framebuffer.blit(),i.baseTexture.update()),n.runners.postrender.emit(),n.projection.transform=null,n.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Cv.extension={type:J.RendererSystem,name:"objectRenderer"};st.add(Cv);const Hu=class extends xM{constructor(e){super(),e=Object.assign({},Q.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new br({projectionMatrix:new Vt},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Hu.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in e&&(It("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&e.useContextAlpha!=="notMultiplied",e.backgroundAlpha=e.useContextAlpha===!1?1:e.backgroundAlpha);const r={hello:e.hello,_plugin:Hu.__plugins,background:{alpha:e.backgroundAlpha,color:e.background??e.backgroundColor,clearBeforeRender:e.clearBeforeRender},_view:{height:e.height,width:e.width,autoDensity:e.autoDensity,resolution:e.resolution,view:e.view},context:{antialias:e.antialias,context:e.context,powerPreference:e.powerPreference,premultipliedAlpha:e.premultipliedAlpha,preserveDrawingBuffer:e.preserveDrawingBuffer}};this.startup.run(r),this.options=e}static test(e){return e!=null&&e.forceCanvas?!1:bC()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return It("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return It("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return It("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return It("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){It("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return It("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.color}set backgroundAlpha(e){It("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return It("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};let Ki=Hu;Ki.extension={type:J.Renderer,priority:1};Ki.__plugins={};Ki.__systems={};st.handleByMap(J.RendererPlugin,Ki.__plugins);st.handleByMap(J.RendererSystem,Ki.__systems);st.add(Ki);class Iv extends Ls{constructor(t,r){const{width:n,height:i}=r||{};super(n,i),this.items=[],this.itemDirtyIds=[];for(let o=0;o<t;o++){const l=new mt;this.items.push(l),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,r){for(let n=0;n<this.length;n++)t[n]&&(t[n].castToBaseTexture?this.addBaseTextureAt(t[n].castToBaseTexture(),n):t[n]instanceof Ls?this.addResourceAt(t[n],n):this.addResourceAt($m(t[n],r),n))}dispose(){for(let t=0,r=this.length;t<r;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,r){if(!this.items[r])throw new Error(`Index ${r} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[r].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let r=0;r<this.length;r++)this.items[r].parentTextureArray=t,this.items[r].on("update",t.update,t)}unbind(t){super.unbind(t);for(let r=0;r<this.length;r++)this.items[r].parentTextureArray=null,this.items[r].off("update",t.update,t)}load(){if(this._load)return this._load;const r=this.items.map(n=>n.resource).filter(n=>n).map(n=>n.load());return this._load=Promise.all(r).then(()=>{const{realWidth:n,realHeight:i}=this.items[0];return this.resize(n,i),Promise.resolve(this)}),this._load}}class CM extends Iv{constructor(t,r){const{width:n,height:i}=r||{};let o,l;Array.isArray(t)?(o=t,l=t.length):l=t,super(l,{width:n,height:i}),o&&this.initFromArray(o,r)}addBaseTextureAt(t,r){if(t.resource)this.addResourceAt(t.resource,r);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=Bi.TEXTURE_2D_ARRAY}upload(t,r,n){const{length:i,itemDirtyIds:o,items:l}=this,{gl:h}=t;n.dirtyId<0&&h.texImage3D(h.TEXTURE_2D_ARRAY,0,n.internalFormat,this._width,this._height,i,0,r.format,n.type,null);for(let u=0;u<i;u++){const f=l[u];o[u]<f.dirtyId&&(o[u]=f.dirtyId,f.valid&&h.texSubImage3D(h.TEXTURE_2D_ARRAY,0,0,0,u,f.resource.width,f.resource.height,1,r.format,n.type,f.resource.source))}return!0}}class IM extends wn{constructor(t){super(t)}static test(t){const{OffscreenCanvas:r}=globalThis;return r&&t instanceof r?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const Ts=class extends Iv{constructor(e,t){const{width:r,height:n,autoLoad:i,linkBaseTexture:o}=t||{};if(e&&e.length!==Ts.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:r,height:n});for(let l=0;l<Ts.SIDES;l++)this.items[l].target=Bi.TEXTURE_CUBE_MAP_POSITIVE_X+l;this.linkBaseTexture=o!==!1,e&&this.initFromArray(e,t),i!==!1&&this.load()}bind(e){super.bind(e),e.target=Bi.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,r){if(r===void 0&&(r=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=Bi.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(e,t,r){const n=this.itemDirtyIds;for(let i=0;i<Ts.SIDES;i++){const o=this.items[i];(n[i]<o.dirtyId||r.dirtyId<t.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(e,o,r),n[i]=o.dirtyId):n[i]<-1&&(e.gl.texImage2D(o.target,0,r.internalFormat,t.realWidth,t.realHeight,0,t.format,r.type,null),n[i]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===Ts.SIDES}};let Pv=Ts;Pv.SIDES=6;class Ri extends wn{constructor(t,r){var n=(...i)=>{super(...i)};r=r||{},typeof t=="string"?(n(Ri.EMPTY),this.url=t):(n(t),this.url=null),this.crossOrigin=r.crossOrigin??!0,this.alphaMode=typeof r.alphaMode=="number"?r.alphaMode:null,this._load=null,r.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,r)=>{if(this.url===null){t(this);return}try{const n=await Q.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const i=await n.blob();if(this.destroyed)return;const o=await createImageBitmap(i,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===wr.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=o,this.update(),t(this)}catch(n){if(this.destroyed)return;r(n),this.onError.emit(n)}}),this._load)}upload(t,r,n){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(r.alphaMode=this.alphaMode),super.upload(t,r,n)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return Ri._EMPTY=Ri._EMPTY??Q.ADAPTER.createCanvas(0,0),Ri._EMPTY}}const va=class extends wn{constructor(e,t){t=t||{},super(Q.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(e=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),e(this)},va.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const e=new Image;wn.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,r=e.height;if(!t||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let n=t*this.scale,i=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(n=this._overrideWidth||this._overrideHeight/r*t,i=this._overrideHeight||this._overrideWidth/t*r),n=Math.round(n),i=Math.round(i);const o=this.source;o.width=n,o.height=i,o._pixiId=`canvas_${Jn()}`,o.getContext("2d").drawImage(e,0,0,t,r,0,0,n,i),this._resolve(),this._resolve=null}}static getSize(e){const t=va.SVG_SIZE.exec(e),r={};return t&&(r[t[1]]=Math.round(parseFloat(t[3])),r[t[5]]=Math.round(parseFloat(t[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,t){return t==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&va.SVG_XML.test(e)}};let Ns=va;Ns.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;Ns.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const zu=class extends wn{constructor(e,t){if(t=t||{},!(e instanceof HTMLVideoElement)){const r=document.createElement("video");r.setAttribute("preload","auto"),r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline",""),typeof e=="string"&&(e=[e]);const n=e[0].src||e[0];wn.crossOrigin(r,n,t.crossorigin);for(let i=0;i<e.length;++i){const o=document.createElement("source");let{src:l,mime:h}=e[i];l=l||e[i];const u=l.split("?").shift().toLowerCase(),f=u.slice(u.lastIndexOf(".")+1);h=h||zu.MIME_TYPES[f]||`video/${f}`,o.src=l,o.type=h,r.appendChild(o)}e=r}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),t.autoLoad!==!1&&this.load()}update(e=0){if(!this.destroyed){const t=Le.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Le.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Le.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(e.videoWidth,e.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._isConnectedToTicker&&(Le.shared.remove(this.update,this),this._isConnectedToTicker=!1);const e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(Le.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Le.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e)}static test(e,t){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||zu.TYPES.includes(t)}};let Tc=zu;Tc.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];Tc.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};Nu.push(Ri,Qm,IM,Tc,Ns,Hs,Pv,CM);class Ma{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?At.EMPTY:(t=t||new At(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,r){const{a:n,b:i,c:o,d:l,tx:h,ty:u}=t,f=n*r.x+o*r.y+h,d=i*r.x+l*r.y+u;this.minX=Math.min(this.minX,f),this.maxX=Math.max(this.maxX,f),this.minY=Math.min(this.minY,d),this.maxY=Math.max(this.maxY,d)}addQuad(t){let r=this.minX,n=this.minY,i=this.maxX,o=this.maxY,l=t[0],h=t[1];r=l<r?l:r,n=h<n?h:n,i=l>i?l:i,o=h>o?h:o,l=t[2],h=t[3],r=l<r?l:r,n=h<n?h:n,i=l>i?l:i,o=h>o?h:o,l=t[4],h=t[5],r=l<r?l:r,n=h<n?h:n,i=l>i?l:i,o=h>o?h:o,l=t[6],h=t[7],r=l<r?l:r,n=h<n?h:n,i=l>i?l:i,o=h>o?h:o,this.minX=r,this.minY=n,this.maxX=i,this.maxY=o}addFrame(t,r,n,i,o){this.addFrameMatrix(t.worldTransform,r,n,i,o)}addFrameMatrix(t,r,n,i,o){const l=t.a,h=t.b,u=t.c,f=t.d,d=t.tx,p=t.ty;let g=this.minX,v=this.minY,y=this.maxX,w=this.maxY,x=l*r+u*n+d,T=h*r+f*n+p;g=x<g?x:g,v=T<v?T:v,y=x>y?x:y,w=T>w?T:w,x=l*i+u*n+d,T=h*i+f*n+p,g=x<g?x:g,v=T<v?T:v,y=x>y?x:y,w=T>w?T:w,x=l*r+u*o+d,T=h*r+f*o+p,g=x<g?x:g,v=T<v?T:v,y=x>y?x:y,w=T>w?T:w,x=l*i+u*o+d,T=h*i+f*o+p,g=x<g?x:g,v=T<v?T:v,y=x>y?x:y,w=T>w?T:w,this.minX=g,this.minY=v,this.maxX=y,this.maxY=w}addVertexData(t,r,n){let i=this.minX,o=this.minY,l=this.maxX,h=this.maxY;for(let u=r;u<n;u+=2){const f=t[u],d=t[u+1];i=f<i?f:i,o=d<o?d:o,l=f>l?f:l,h=d>h?d:h}this.minX=i,this.minY=o,this.maxX=l,this.maxY=h}addVertices(t,r,n,i){this.addVerticesMatrix(t.worldTransform,r,n,i)}addVerticesMatrix(t,r,n,i,o=0,l=o){const h=t.a,u=t.b,f=t.c,d=t.d,p=t.tx,g=t.ty;let v=this.minX,y=this.minY,w=this.maxX,x=this.maxY;for(let T=n;T<i;T+=2){const S=r[T],E=r[T+1],I=h*S+f*E+p,D=d*E+u*S+g;v=Math.min(v,I-o),w=Math.max(w,I+o),y=Math.min(y,D-l),x=Math.max(x,D+l)}this.minX=v,this.minY=y,this.maxX=w,this.maxY=x}addBounds(t){const r=this.minX,n=this.minY,i=this.maxX,o=this.maxY;this.minX=t.minX<r?t.minX:r,this.minY=t.minY<n?t.minY:n,this.maxX=t.maxX>i?t.maxX:i,this.maxY=t.maxY>o?t.maxY:o}addBoundsMask(t,r){const n=t.minX>r.minX?t.minX:r.minX,i=t.minY>r.minY?t.minY:r.minY,o=t.maxX<r.maxX?t.maxX:r.maxX,l=t.maxY<r.maxY?t.maxY:r.maxY;if(n<=o&&i<=l){const h=this.minX,u=this.minY,f=this.maxX,d=this.maxY;this.minX=n<h?n:h,this.minY=i<u?i:u,this.maxX=o>f?o:f,this.maxY=l>d?l:d}}addBoundsMatrix(t,r){this.addFrameMatrix(r,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,r){const n=t.minX>r.x?t.minX:r.x,i=t.minY>r.y?t.minY:r.y,o=t.maxX<r.x+r.width?t.maxX:r.x+r.width,l=t.maxY<r.y+r.height?t.maxY:r.y+r.height;if(n<=o&&i<=l){const h=this.minX,u=this.minY,f=this.maxX,d=this.maxY;this.minX=n<h?n:h,this.minY=i<u?i:u,this.maxX=o>f?o:f,this.maxY=l>d?l:d}}pad(t=0,r=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=r,this.maxY+=r)}addFramePad(t,r,n,i,o,l){t-=o,r-=l,n+=o,i+=l,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>n?this.maxX:n,this.minY=this.minY<r?this.minY:r,this.maxY=this.maxY>i?this.maxY:i}}class Kt extends Gs{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Ec,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Ma,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const r=Object.keys(t);for(let n=0;n<r.length;++n){const i=r[n];Object.defineProperty(Kt.prototype,i,Object.getOwnPropertyDescriptor(t,i))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,r){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),r||(this._boundsRect||(this._boundsRect=new At),r=this._boundsRect),this._bounds.getRectangle(r)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new At),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Ma);const r=this.transform,n=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const i=this._bounds,o=this._boundsID;this._bounds=this._localBounds;const l=this.getBounds(!1,t);return this.parent=n,this.transform=r,this._bounds=i,this._bounds.updateID+=this._boundsID-o,l}toGlobal(t,r,n=!1){return n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,r)}toLocal(t,r,n,i){return r&&(t=r.toGlobal(t,n,i)),i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,n)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,r=0,n=1,i=1,o=0,l=0,h=0,u=0,f=0){return this.position.x=t,this.position.y=r,this.scale.x=n||1,this.scale.y=i||1,this.rotation=o,this.skew.x=l,this.skew.y=h,this.pivot.x=u,this.pivot.y=f,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new PM),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*AR}set angle(t){this.transform.rotation=t*SR}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount--,r._maskRefCount===0&&(r.renderable=!0,r.isMask=!1))}if(this._mask=t,this._mask){const r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount===0&&(r.renderable=!1,r.isMask=!0),r._maskRefCount++)}}}}class PM extends Kt{constructor(){super(...arguments),this.sortDirty=null}}Kt.prototype.displayObjectUpdateTransform=Kt.prototype.updateTransform;const RM=new Vt;function MM(e,t){return e.zIndex===t.zIndex?e._lastSortedIndex-t._lastSortedIndex:e.zIndex-t.zIndex}const Xu=class extends Kt{constructor(){super(),this.children=[],this.sortableChildren=Xu.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const r=this.getChildIndex(e),n=this.getChildIndex(t);this.children[r]=t,this.children[n]=e,this.onChildrenChange(r<n?r:n)}getChildIndex(e){const t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(e);Li(this.children,r,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],r=this.children.indexOf(t);if(r===-1)return null;t.parent=null,t.transform._parentID=-1,Li(this.children,r,1),this._boundsID++,this.onChildrenChange(r),t.emit("removed",this),this.emit("childRemoved",t,this,r)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,Li(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const r=e,n=t,i=n-r;let o;if(i>0&&i<=n){o=this.children.splice(r,i);for(let l=0;l<o.length;++l)o[l].parent=null,o[l].transform&&(o[l].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let l=0;l<o.length;++l)o[l].emit("removed",this),this.emit("childRemoved",o[l],this,l);return o}else if(i===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,r=this.children.length;t<r;++t){const n=this.children[t];n._lastSortedIndex=t,!e&&n.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(MM),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const r=this.children[e];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(t._bounds,r._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const r=super.getLocalBounds(e);if(!t)for(let n=0,i=this.children.length;n<i;++n){const o=this.children[n];o.visible&&o.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(e){const t=e.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let r,n;this.cullArea?(r=this.cullArea,n=this.worldTransform):this._render!==Xu.prototype._render&&(r=this.getBounds(!0));const i=e.projection.transform;if(i&&(n?(n=RM.copyFrom(n),n.prepend(i)):n=i),r&&t.intersects(r,n))this._render(e);else if(this.cullArea)return;for(let o=0,l=this.children.length;o<l;++o){const h=this.children[o],u=h.cullable;h.cullable=u||!this.cullArea,h.render(e),h.cullable=u}}render(e){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(t=this.filters)!=null&&t.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let r=0,n=this.children.length;r<n;++r)this.children[r].render(e)}}renderAdvanced(e){var i,o,l;const t=this.filters,r=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let h=0;h<t.length;h++)t[h].enabled&&this._enabledFilters.push(t[h])}const n=t&&((i=this._enabledFilters)==null?void 0:i.length)||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==de.NONE));if(n&&e.batch.flush(),t&&((o=this._enabledFilters)!=null&&o.length)&&e.filter.push(this,this._enabledFilters),r&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let h=0,u=this.children.length;h<u;++h)this.children[h].render(e)}n&&e.batch.flush(),r&&e.mask.pop(this),t&&((l=this._enabledFilters)!=null&&l.length)&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t=typeof e=="boolean"?e:e==null?void 0:e.children,r=this.removeChildren(0,this.children.length);if(t)for(let n=0;n<r.length;++n)r[n].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}};let Xe=Xu;Xe.defaultSortableChildren=!1;Xe.prototype.containerUpdateTransform=Xe.prototype.updateTransform;Object.defineProperties(Q,{SORTABLE_CHILDREN:{get(){return Xe.defaultSortableChildren},set(e){It("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Xe.defaultSortableChildren=e}}});const bs=new Ct,DM=new Uint16Array([0,1,2,0,2,3]);class Zi extends Xe{constructor(t){super(),this._anchor=new yn(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=ct.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||it.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=DM,this.pluginName="batch",this.isSprite=!0,this._roundPixels=Q.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Pi(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Pi(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const r=this.transform.worldTransform,n=r.a,i=r.b,o=r.c,l=r.d,h=r.tx,u=r.ty,f=this.vertexData,d=t.trim,p=t.orig,g=this._anchor;let v=0,y=0,w=0,x=0;if(d?(y=d.x-g._x*p.width,v=y+d.width,x=d.y-g._y*p.height,w=x+d.height):(y=-g._x*p.width,v=y+p.width,x=-g._y*p.height,w=x+p.height),f[0]=n*y+o*x+h,f[1]=l*x+i*y+u,f[2]=n*v+o*x+h,f[3]=l*x+i*v+u,f[4]=n*v+o*w+h,f[5]=l*w+i*v+u,f[6]=n*y+o*w+h,f[7]=l*w+i*y+u,this._roundPixels){const T=Q.RESOLUTION;for(let S=0;S<f.length;++S)f[S]=Math.round(f[S]*T)/T}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,r=this.vertexTrimmedData,n=t.orig,i=this._anchor,o=this.transform.worldTransform,l=o.a,h=o.b,u=o.c,f=o.d,d=o.tx,p=o.ty,g=-i._x*n.width,v=g+n.width,y=-i._y*n.height,w=y+n.height;r[0]=l*g+u*y+d,r[1]=f*y+h*g+p,r[2]=l*v+u*y+d,r[3]=f*y+h*v+p,r[4]=l*v+u*w+d,r[5]=f*w+h*v+p,r[6]=l*g+u*w+d,r[7]=f*w+h*g+p}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,r=this._texture.orig;!t||t.width===r.width&&t.height===r.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new Ma),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new At),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,bs);const r=this._texture.orig.width,n=this._texture.orig.height,i=-r*this.anchor.x;let o=0;return bs.x>=i&&bs.x<i+r&&(o=-n*this.anchor.y,bs.y>=o&&bs.y<o+n)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const n=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!n)}this._texture=null}static from(t,r){const n=t instanceof it?t:it.from(t,r);return new Zi(n)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const r=Pi(this.scale.x)||1;this.scale.x=r*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const r=Pi(this.scale.y)||1;this.scale.y=r*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tint}set tint(t){this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16)}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||it.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const Rv=new Vt;Kt.prototype._cacheAsBitmap=!1;Kt.prototype._cacheData=null;Kt.prototype._cacheAsBitmapResolution=null;Kt.prototype._cacheAsBitmapMultisample=null;class BM{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Kt.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(e){e!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(e){e!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(e){if(this._cacheAsBitmap===e)return;this._cacheAsBitmap=e;let t;e?(this._cacheData||(this._cacheData=new BM),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});Kt.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))};Kt.prototype._initCachedDisplayObject=function(t){var g,v;if((g=this._cacheData)!=null&&g.sprite)return;const r=this.alpha;this.alpha=1,t.batch.flush();const n=this.getLocalBounds(null,!0).clone();if((v=this.filters)!=null&&v.length){const y=this.filters[0].padding;n.pad(y)}n.ceil(Q.RESOLUTION);const i=t.renderTexture.current,o=t.renderTexture.sourceFrame.clone(),l=t.renderTexture.destinationFrame.clone(),h=t.projection.transform,u=En.create({width:n.width,height:n.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),f=`cacheAsBitmap_${Jn()}`;this._cacheData.textureCacheId=f,mt.addToCache(u.baseTexture,f),it.addToCache(u,f);const d=this.transform.localTransform.copyTo(Rv).invert().translate(-n.x,-n.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:u,clear:!0,transform:d,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=h,t.renderTexture.bind(i,o,l),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const p=new Zi(u);p.transform.worldTransform=this.transform.worldTransform,p.anchor.x=-(n.x/n.width),p.anchor.y=-(n.y/n.height),p.alpha=r,p._bounds=this._bounds,this._cacheData.sprite=p,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=p.containsPoint.bind(p)};Kt.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))};Kt.prototype._initCachedDisplayObjectCanvas=function(t){var d;if((d=this._cacheData)!=null&&d.sprite)return;const r=this.getLocalBounds(null,!0),n=this.alpha;this.alpha=1;const i=t.canvasContext.activeContext,o=t._projTransform;r.ceil(Q.RESOLUTION);const l=En.create({width:r.width,height:r.height}),h=`cacheAsBitmap_${Jn()}`;this._cacheData.textureCacheId=h,mt.addToCache(l.baseTexture,h),it.addToCache(l,h);const u=Rv;this.transform.localTransform.copyTo(u),u.invert(),u.tx-=r.x,u.ty-=r.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:l,clear:!0,transform:u,skipUpdateTransform:!1}),t.canvasContext.activeContext=i,t._projTransform=o,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=n;const f=new Zi(l);f.transform.worldTransform=this.transform.worldTransform,f.anchor.x=-(r.x/r.width),f.anchor.y=-(r.y/r.height),f.alpha=n,f._bounds=this._bounds,this._cacheData.sprite=f,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=f.containsPoint.bind(f)};Kt.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};Kt.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};Kt.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,mt.removeFromCache(this._cacheData.textureCacheId),it.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};Kt.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)};Kt.prototype.name=null;Xe.prototype.getChildByName=function(t,r){for(let n=0,i=this.children.length;n<i;n++)if(this.children[n].name===t)return this.children[n];if(r)for(let n=0,i=this.children.length;n<i;n++){const o=this.children[n];if(!o.getChildByName)continue;const l=o.getChildByName(t,!0);if(l)return l}return null};Kt.prototype.getGlobalPosition=function(t=new Ct,r=!1){return this.parent?this.parent.toGlobal(this.position,t,r):(t.x=this.position.x,t.y=this.position.y),t};var OM=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class FM extends Re{constructor(t=1){super(AM,OM,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const LM={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},NM=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function kM(e){const t=LM[e],r=t.length;let n=NM,i="";const o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let l;for(let h=0;h<e;h++){let u=o.replace("%index%",h.toString());l=h,h>=r&&(l=e-h-1),u=u.replace("%value%",t[l].toString()),i+=u,i+=`
`}return n=n.replace("%blur%",i),n=n.replace("%size%",e.toString()),n}const UM=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function GM(e,t){const r=Math.ceil(e/2);let n=UM,i="",o;t?o="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":o="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let l=0;l<e;l++){let h=o.replace("%index%",l.toString());h=h.replace("%sampleIndex%",`${l-(r-1)}.0`),i+=h,i+=`
`}return n=n.replace("%blur%",i),n=n.replace("%size%",e.toString()),n}class Vu extends Re{constructor(t,r=8,n=4,i=Q.FILTER_RESOLUTION,o=5){const l=GM(o,t),h=kM(o);super(l,h),this.horizontal=t,this.resolution=i,this._quality=0,this.quality=n,this.blur=r}apply(t,r,n,i){if(n?this.horizontal?this.uniforms.strength=1/n.width*(n.width/r.width):this.uniforms.strength=1/n.height*(n.height/r.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/r.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/r.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,r,n,i);else{const o=t.getFilterTexture(),l=t.renderer;let h=r,u=o;this.state.blend=!1,t.applyFilter(this,h,u,Rr.CLEAR);for(let f=1;f<this.passes-1;f++){t.bindAndClear(h,Rr.BLIT),this.uniforms.uSampler=u;const d=u;u=h,h=d,l.shader.bind(this),l.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,u,n,i),t.returnFilterTexture(o)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class $M extends Re{constructor(t=8,r=4,n=Re.defaultResolution,i=5){super(),this.blurXFilter=new Vu(!0,t,r,n,i),this.blurYFilter=new Vu(!1,t,r,n,i),this.resolution=n,this.quality=r,this.blur=t,this.repeatEdgePixels=!1}apply(t,r,n,i){const o=Math.abs(this.blurXFilter.strength),l=Math.abs(this.blurYFilter.strength);if(o&&l){const h=t.getFilterTexture();this.blurXFilter.apply(t,r,h,Rr.CLEAR),this.blurYFilter.apply(t,h,n,i),t.returnFilterTexture(h)}else l?this.blurYFilter.apply(t,r,n,i):this.blurXFilter.apply(t,r,n,i)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var WM=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class Yu extends Re{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Tv,WM,t),this.alpha=1}_loadMatrix(t,r=!1){let n=t;r&&(this._multiply(n,this.uniforms.m,t),n=this._colorMatrix(n)),this.uniforms.m=n}_multiply(t,r,n){return t[0]=r[0]*n[0]+r[1]*n[5]+r[2]*n[10]+r[3]*n[15],t[1]=r[0]*n[1]+r[1]*n[6]+r[2]*n[11]+r[3]*n[16],t[2]=r[0]*n[2]+r[1]*n[7]+r[2]*n[12]+r[3]*n[17],t[3]=r[0]*n[3]+r[1]*n[8]+r[2]*n[13]+r[3]*n[18],t[4]=r[0]*n[4]+r[1]*n[9]+r[2]*n[14]+r[3]*n[19]+r[4],t[5]=r[5]*n[0]+r[6]*n[5]+r[7]*n[10]+r[8]*n[15],t[6]=r[5]*n[1]+r[6]*n[6]+r[7]*n[11]+r[8]*n[16],t[7]=r[5]*n[2]+r[6]*n[7]+r[7]*n[12]+r[8]*n[17],t[8]=r[5]*n[3]+r[6]*n[8]+r[7]*n[13]+r[8]*n[18],t[9]=r[5]*n[4]+r[6]*n[9]+r[7]*n[14]+r[8]*n[19]+r[9],t[10]=r[10]*n[0]+r[11]*n[5]+r[12]*n[10]+r[13]*n[15],t[11]=r[10]*n[1]+r[11]*n[6]+r[12]*n[11]+r[13]*n[16],t[12]=r[10]*n[2]+r[11]*n[7]+r[12]*n[12]+r[13]*n[17],t[13]=r[10]*n[3]+r[11]*n[8]+r[12]*n[13]+r[13]*n[18],t[14]=r[10]*n[4]+r[11]*n[9]+r[12]*n[14]+r[13]*n[19]+r[14],t[15]=r[15]*n[0]+r[16]*n[5]+r[17]*n[10]+r[18]*n[15],t[16]=r[15]*n[1]+r[16]*n[6]+r[17]*n[11]+r[18]*n[16],t[17]=r[15]*n[2]+r[16]*n[7]+r[17]*n[12]+r[18]*n[17],t[18]=r[15]*n[3]+r[16]*n[8]+r[17]*n[13]+r[18]*n[18],t[19]=r[15]*n[4]+r[16]*n[9]+r[17]*n[14]+r[18]*n[19]+r[19],t}_colorMatrix(t){const r=new Float32Array(t);return r[4]/=255,r[9]/=255,r[14]/=255,r[19]/=255,r}brightness(t,r){const n=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(n,r)}tint(t,r){const n=t>>16&255,i=t>>8&255,o=t&255,l=[n/255,0,0,0,0,0,i/255,0,0,0,0,0,o/255,0,0,0,0,0,1,0];this._loadMatrix(l,r)}greyscale(t,r){const n=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(n,r)}blackAndWhite(t){const r=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(r,t)}hue(t,r){t=(t||0)/180*Math.PI;const n=Math.cos(t),i=Math.sin(t),o=Math.sqrt,l=1/3,h=o(l),u=n+(1-n)*l,f=l*(1-n)-h*i,d=l*(1-n)+h*i,p=l*(1-n)+h*i,g=n+l*(1-n),v=l*(1-n)-h*i,y=l*(1-n)-h*i,w=l*(1-n)+h*i,x=n+l*(1-n),T=[u,f,d,0,0,p,g,v,0,0,y,w,x,0,0,0,0,0,1,0];this._loadMatrix(T,r)}contrast(t,r){const n=(t||0)+1,i=-.5*(n-1),o=[n,0,0,0,i,0,n,0,0,i,0,0,n,0,i,0,0,0,1,0];this._loadMatrix(o,r)}saturate(t=0,r){const n=t*2/3+1,i=(n-1)*-.5,o=[n,i,i,0,0,i,n,i,0,0,i,i,n,0,0,0,0,0,1,0];this._loadMatrix(o,r)}desaturate(){this.saturate(-1)}negative(t){const r=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(r,t)}sepia(t){const r=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(r,t)}technicolor(t){const r=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(r,t)}polaroid(t){const r=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(r,t)}toBGR(t){const r=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(r,t)}kodachrome(t){const r=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(r,t)}browni(t){const r=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(r,t)}vintage(t){const r=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(r,t)}colorTone(t,r,n,i,o){t=t||.2,r=r||.15,n=n||16770432,i=i||3375104;const l=(n>>16&255)/255,h=(n>>8&255)/255,u=(n&255)/255,f=(i>>16&255)/255,d=(i>>8&255)/255,p=(i&255)/255,g=[.3,.59,.11,0,0,l,h,u,t,0,f,d,p,r,0,l-f,h-d,u-p,0,0];this._loadMatrix(g,o)}night(t,r){t=t||.1;const n=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(n,r)}predator(t,r){const n=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(n,r)}lsd(t){const r=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(r,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}Yu.prototype.grayscale=Yu.prototype.greyscale;var HM=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,zM=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class XM extends Re{constructor(t,r){const n=new Vt;t.renderable=!1,super(zM,HM,{mapSampler:t._texture,filterMatrix:n,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=n,r==null&&(r=20),this.scale=new Ct(r,r)}apply(t,r,n,i){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const o=this.maskSprite.worldTransform,l=Math.sqrt(o.a*o.a+o.b*o.b),h=Math.sqrt(o.c*o.c+o.d*o.d);l!==0&&h!==0&&(this.uniforms.rotation[0]=o.a/l,this.uniforms.rotation[1]=o.b/l,this.uniforms.rotation[2]=o.c/h,this.uniforms.rotation[3]=o.d/h),t.applyFilter(this,r,n,i)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var VM=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,YM=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class jM extends Re{constructor(){super(YM,VM)}}var qM=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class KM extends Re{constructor(t=.5,r=Math.random()){super(Tv,qM,{uNoise:0,uSeed:0}),this.noise=t,this.seed=r}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const mg={AlphaFilter:FM,BlurFilter:$M,BlurFilterPass:Vu,ColorMatrixFilter:Yu,DisplacementFilter:XM,FXAAFilter:jM,NoiseFilter:KM};Object.entries(mg).forEach(([e,t])=>{Object.defineProperty(mg,e,{get(){return It("7.1.0",`filters.${e} has moved to ${e}`),t}})});class zs{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=zs.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Ct,this.page=new Ct,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,r,n){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,r,n,i,o){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Da extends zs{constructor(){super(...arguments),this.client=new Ct,this.movement=new Ct,this.offset=new Ct,this.global=new Ct,this.screen=new Ct}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,r,n,i,o,l,h,u,f,d,p,g,v,y,w){throw new Error("Method not implemented.")}}class dr extends Da{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class ju extends Da{constructor(){super(...arguments),this.DOM_DELTA_LINE=0,this.DOM_DELTA_PAGE=1,this.DOM_DELTA_PIXEL=2}}const ZM=2048,JM=new Ct,qh=new Ct;class QM{constructor(t){this.dispatch=new Gs,this.moveOnAll=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,r){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:r,priority:0}),this.mappingTable[t].sort((n,i)=>n.priority-i.priority)}dispatchEvent(t,r){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,r),this.dispatch.emit(r||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const r=this.mappingTable[t.type];if(r)for(let n=0,i=r.length;n<i;n++)r[n].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,r){const n=this.hitTestRecursive(this.rootTarget,this.rootTarget.interactive,JM.set(t,r),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(t,r){if(!t.target)return;const n=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let i=0,o=n.length-1;i<o;i++)if(t.currentTarget=n[i],this.notifyTarget(t,r),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,r),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let i=n.length-2;i>=0;i--)if(t.currentTarget=n[i],this.notifyTarget(t,r),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,r,n=this.rootTarget){t.eventPhase=t.BUBBLING_PHASE;const i=n.children;if(i)for(let o=0;o<i.length;o++)this.all(t,r,i[o]);t.currentTarget=n,this.notifyTarget(t,r)}propagationPath(t){const r=[t];for(let n=0;n<ZM&&t!==this.rootTarget;n++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");r.push(t.parent),t=t.parent}return r.reverse(),r}hitTestRecursive(t,r,n,i,o){if(!t||!t.visible||o(t,n))return null;if(t.interactiveChildren&&t.children){const l=t.children;for(let h=l.length-1;h>=0;h--){const u=l[h],f=this.hitTestRecursive(u,r||u.interactive,n,i,o);if(f){if(f.length>0&&!f[f.length-1].parent)continue;return(f.length>0||t.interactive)&&f.push(t),f}}}return r&&i(t,n)?t.interactive?[t]:[]:null}hitPruneFn(t,r){var n;if(t.hitArea&&(t.worldTransform.applyInverse(r,qh),!t.hitArea.contains(qh.x,qh.y)))return!0;if(t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;if(i&&!((n=i.containsPoint)!=null&&n.call(i,r)))return!0}return!1}hitTestFn(t,r){return t.hitArea?!0:t.containsPoint?t.containsPoint(r):!1}notifyTarget(t,r){var o,l;r=r??t.type;const n=`on${r}`;(l=(o=t.currentTarget)[n])==null||l.call(o,t);const i=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${r}capture`:r;this.notifyListeners(t,i),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,r)}mapPointerDown(t){if(!(t instanceof dr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerdown"),r.pointerType==="touch")this.dispatchEvent(r,"touchstart");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const i=r.button===2;this.dispatchEvent(r,i?"rightdown":"mousedown")}const n=this.trackingData(t.pointerId);n.pressTargetsByButton[t.button]=r.composedPath(),this.freeEvent(r)}mapPointerMove(t){var h;if(!(t instanceof dr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.createPointerEvent(t),n=r.pointerType==="mouse"||r.pointerType==="pen",i=this.trackingData(t.pointerId),o=this.findMountedTarget(i.overTargets);if(i.overTargets&&o!==r.target){const u=t.type==="mousemove"?"mouseout":"pointerout",f=this.createPointerEvent(t,u,o);if(this.dispatchEvent(f,"pointerout"),n&&this.dispatchEvent(f,"mouseout"),!r.composedPath().includes(o)){const d=this.createPointerEvent(t,"pointerleave",o);for(d.eventPhase=d.AT_TARGET;d.target&&!r.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),n&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(f)}if(o!==r.target){const u=t.type==="mousemove"?"mouseover":"pointerover",f=this.clonePointerEvent(r,u);this.dispatchEvent(f,"pointerover"),n&&this.dispatchEvent(f,"mouseover");let d=o==null?void 0:o.parent;for(;d&&d!==this.rootTarget.parent&&d!==r.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const g=this.clonePointerEvent(r,"pointerenter");for(g.eventPhase=g.AT_TARGET;g.target&&g.target!==o&&g.target!==this.rootTarget.parent;)g.currentTarget=g.target,this.notifyTarget(g),n&&this.notifyTarget(g,"mouseenter"),g.target=g.target.parent;this.freeEvent(g)}this.freeEvent(f)}const l=this.moveOnAll?"all":"dispatchEvent";this[l](r,"pointermove"),r.pointerType==="touch"&&this[l](r,"touchmove"),n&&(this[l](r,"mousemove"),this.cursor=(h=r.target)==null?void 0:h.cursor),i.overTargets=r.composedPath(),this.freeEvent(r)}mapPointerOver(t){var l;if(!(t instanceof dr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.trackingData(t.pointerId),n=this.createPointerEvent(t),i=n.pointerType==="mouse"||n.pointerType==="pen";this.dispatchEvent(n,"pointerover"),i&&this.dispatchEvent(n,"mouseover"),n.pointerType==="mouse"&&(this.cursor=(l=n.target)==null?void 0:l.cursor);const o=this.clonePointerEvent(n,"pointerenter");for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),i&&this.notifyTarget(o,"mouseenter"),o.target=o.target.parent;r.overTargets=n.composedPath(),this.freeEvent(n),this.freeEvent(o)}mapPointerOut(t){if(!(t instanceof dr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.trackingData(t.pointerId);if(r.overTargets){const n=t.pointerType==="mouse"||t.pointerType==="pen",i=this.findMountedTarget(r.overTargets),o=this.createPointerEvent(t,"pointerout",i);this.dispatchEvent(o),n&&this.dispatchEvent(o,"mouseout");const l=this.createPointerEvent(t,"pointerleave",i);for(l.eventPhase=l.AT_TARGET;l.target&&l.target!==this.rootTarget.parent;)l.currentTarget=l.target,this.notifyTarget(l),n&&this.notifyTarget(l,"mouseleave"),l.target=l.target.parent;r.overTargets=null,this.freeEvent(o),this.freeEvent(l)}this.cursor=null}mapPointerUp(t){if(!(t instanceof dr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=performance.now(),n=this.createPointerEvent(t);if(this.dispatchEvent(n,"pointerup"),n.pointerType==="touch")this.dispatchEvent(n,"touchend");else if(n.pointerType==="mouse"||n.pointerType==="pen"){const h=n.button===2;this.dispatchEvent(n,h?"rightup":"mouseup")}const i=this.trackingData(t.pointerId),o=this.findMountedTarget(i.pressTargetsByButton[t.button]);let l=o;if(o&&!n.composedPath().includes(o)){let h=o;for(;h&&!n.composedPath().includes(h);){if(n.currentTarget=h,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch")this.notifyTarget(n,"touchendoutside");else if(n.pointerType==="mouse"||n.pointerType==="pen"){const u=n.button===2;this.notifyTarget(n,u?"rightupoutside":"mouseupoutside")}h=h.parent}delete i.pressTargetsByButton[t.button],l=h}if(l){const h=this.clonePointerEvent(n,"click");h.target=l,h.path=null,i.clicksByButton[t.button]||(i.clicksByButton[t.button]={clickCount:0,target:h.target,timeStamp:r});const u=i.clicksByButton[t.button];u.target===h.target&&r-u.timeStamp<200?++u.clickCount:u.clickCount=1,u.target=h.target,u.timeStamp=r,h.detail=u.clickCount,h.pointerType==="mouse"?this.dispatchEvent(h,"click"):h.pointerType==="touch"&&this.dispatchEvent(h,"tap"),this.dispatchEvent(h,"pointertap"),this.freeEvent(h)}this.freeEvent(n)}mapPointerUpOutside(t){if(!(t instanceof dr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.trackingData(t.pointerId),n=this.findMountedTarget(r.pressTargetsByButton[t.button]),i=this.createPointerEvent(t);if(n){let o=n;for(;o;)i.currentTarget=o,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch"?this.notifyTarget(i,"touchendoutside"):(i.pointerType==="mouse"||i.pointerType==="pen")&&this.notifyTarget(i,i.button===2?"rightupoutside":"mouseupoutside"),o=o.parent;delete r.pressTargetsByButton[t.button]}this.freeEvent(i)}mapWheel(t){if(!(t instanceof ju)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const r=this.createWheelEvent(t);this.dispatchEvent(r),this.freeEvent(r)}findMountedTarget(t){if(!t)return null;let r=t[0];for(let n=1;n<t.length&&t[n].parent===r;n++)r=t[n];return r}createPointerEvent(t,r,n){const i=this.allocateEvent(dr);return this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.nativeEvent=t.nativeEvent,i.originalEvent=t,i.target=n??this.hitTest(i.global.x,i.global.y),typeof r=="string"&&(i.type=r),i}createWheelEvent(t){const r=this.allocateEvent(ju);return this.copyWheelData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t,r.target=this.hitTest(r.global.x,r.global.y),r}clonePointerEvent(t,r){const n=this.allocateEvent(dr);return n.nativeEvent=t.nativeEvent,n.originalEvent=t.originalEvent,this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.target=t.target,n.path=t.composedPath().slice(),n.type=r??n.type,n}copyWheelData(t,r){r.deltaMode=t.deltaMode,r.deltaX=t.deltaX,r.deltaY=t.deltaY,r.deltaZ=t.deltaZ}copyPointerData(t,r){t instanceof dr&&r instanceof dr&&(r.pointerId=t.pointerId,r.width=t.width,r.height=t.height,r.isPrimary=t.isPrimary,r.pointerType=t.pointerType,r.pressure=t.pressure,r.tangentialPressure=t.tangentialPressure,r.tiltX=t.tiltX,r.tiltY=t.tiltY,r.twist=t.twist)}copyMouseData(t,r){t instanceof Da&&r instanceof Da&&(r.altKey=t.altKey,r.button=t.button,r.buttons=t.buttons,r.client.copyFrom(t.client),r.ctrlKey=t.ctrlKey,r.metaKey=t.metaKey,r.movement.copyFrom(t.movement),r.screen.copyFrom(t.screen),r.global.copyFrom(t.global))}copyData(t,r){r.isTrusted=t.isTrusted,r.srcElement=t.srcElement,r.timeStamp=performance.now(),r.type=t.type,r.detail=t.detail,r.view=t.view,r.which=t.which,r.layer.copyFrom(t.layer),r.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const r=this.eventPool.get(t).pop()||new t(this);return r.eventPhase=r.NONE,r.currentTarget=null,r.path=null,r.target=null,r}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const r=t.constructor;this.eventPool.has(r)||this.eventPool.set(r,[]),this.eventPool.get(r).push(t)}notifyListeners(t,r){const n=t.currentTarget._events[r];if(n)if("fn"in n)n.fn.call(n.context,t);else for(let i=0,o=n.length;i<o&&!t.propagationImmediatelyStopped;i++)n[i].fn.call(n[i].context,t)}}const tD=1,eD={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class Mv{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new QM(null),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new dr(null),this.rootWheelEvent=new ju(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}init(){const{view:t,resolution:r}=this.renderer;this.setTargetElement(t),this.resolution=r}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let r=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(r=!1),this.currentCursor===t)return;this.currentCursor=t;const n=this.cursorStyles[t];if(n)switch(typeof n){case"string":r&&(this.domElement.style.cursor=n);break;case"function":n(t);break;case"object":r&&Object.assign(this.domElement.style,n);break}else r&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}onPointerDown(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const r=this.normalizeToPointerData(t);this.autoPreventDefault&&r[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let n=0,i=r.length;n<i;n++){const o=r[n],l=this.bootstrapEvent(this.rootPointerEvent,o);this.rootBoundary.mapEvent(l)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const r=this.normalizeToPointerData(t);for(let n=0,i=r.length;n<i;n++){const o=this.bootstrapEvent(this.rootPointerEvent,r[n]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;let r=t.target;t.composedPath&&t.composedPath().length>0&&(r=t.composedPath()[0]);const n=r!==this.domElement?"outside":"",i=this.normalizeToPointerData(t);for(let o=0,l=i.length;o<l;o++){const h=this.bootstrapEvent(this.rootPointerEvent,i[o]);h.type+=n,this.rootBoundary.mapEvent(h)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const r=this.normalizeToPointerData(t);for(let n=0,i=r.length;n<i;n++){const o=this.bootstrapEvent(this.rootPointerEvent,r[n]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){const r=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(r)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,r,n){let i;this.domElement.parentElement?i=this.domElement.getBoundingClientRect():i={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const o=1/this.resolution;t.x=(r-i.left)*(this.domElement.width/i.width)*o,t.y=(n-i.top)*(this.domElement.height/i.height)*o}normalizeToPointerData(t){const r=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let n=0,i=t.changedTouches.length;n<i;n++){const o=t.changedTouches[n];typeof o.button>"u"&&(o.button=0),typeof o.buttons>"u"&&(o.buttons=1),typeof o.isPrimary>"u"&&(o.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof o.width>"u"&&(o.width=o.radiusX||1),typeof o.height>"u"&&(o.height=o.radiusY||1),typeof o.tiltX>"u"&&(o.tiltX=0),typeof o.tiltY>"u"&&(o.tiltY=0),typeof o.pointerType>"u"&&(o.pointerType="touch"),typeof o.pointerId>"u"&&(o.pointerId=o.identifier||0),typeof o.pressure>"u"&&(o.pressure=o.force||.5),typeof o.twist>"u"&&(o.twist=0),typeof o.tangentialPressure>"u"&&(o.tangentialPressure=0),typeof o.layerX>"u"&&(o.layerX=o.offsetX=o.clientX),typeof o.layerY>"u"&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,o.type=t.type,r.push(o)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const n=t;typeof n.isPrimary>"u"&&(n.isPrimary=!0),typeof n.width>"u"&&(n.width=1),typeof n.height>"u"&&(n.height=1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="mouse"),typeof n.pointerId>"u"&&(n.pointerId=tD),typeof n.pressure>"u"&&(n.pressure=.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),n.isNormalized=!0,r.push(n)}else r.push(t);return r}normalizeWheelEvent(t){const r=this.rootWheelEvent;return this.transferMouseData(r,t),r.deltaX=t.deltaX,r.deltaY=t.deltaY,r.deltaZ=t.deltaZ,r.deltaMode=t.deltaMode,this.mapPositionToPoint(r.screen,t.clientX,t.clientY),r.global.copyFrom(r.screen),r.offset.copyFrom(r.screen),r.nativeEvent=t,r.type=t.type,r}bootstrapEvent(t,r){return t.originalEvent=null,t.nativeEvent=r,t.pointerId=r.pointerId,t.width=r.width,t.height=r.height,t.isPrimary=r.isPrimary,t.pointerType=r.pointerType,t.pressure=r.pressure,t.tangentialPressure=r.tangentialPressure,t.tiltX=r.tiltX,t.tiltY=r.tiltY,t.twist=r.twist,this.transferMouseData(t,r),this.mapPositionToPoint(t.screen,r.clientX,r.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=r.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=eD[t.type]||t.type),t}transferMouseData(t,r){t.isTrusted=r.isTrusted,t.srcElement=r.srcElement,t.timeStamp=performance.now(),t.type=r.type,t.altKey=r.altKey,t.button=r.button,t.buttons=r.buttons,t.client.x=r.clientX,t.client.y=r.clientY,t.ctrlKey=r.ctrlKey,t.metaKey=r.metaKey,t.movement.x=r.movementX,t.movement.y=r.movementY,t.page.x=r.pageX,t.page.y=r.pageY,t.relatedTarget=null,t.shiftKey=r.shiftKey}}Mv.extension={name:"events",type:[J.RendererSystem,J.CanvasRendererSystem]};st.add(Mv);const rD={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,ontouchstart:null,onwheel:null,interactive:!1,interactiveChildren:!0,hitArea:null,addEventListener(e,t,r){const n=typeof r=="boolean"&&r||typeof r=="object"&&r.capture,i=typeof t=="function"?void 0:t;e=n?`${e}capture`:e,t=typeof t=="function"?t:t.handleEvent,this.on(e,t,i)},removeEventListener(e,t,r){const n=typeof r=="boolean"&&r||typeof r=="object"&&r.capture,i=typeof t=="function"?void 0:t;e=n?`${e}capture`:e,t=typeof t=="function"?t:t.handleEvent,this.off(e,t,i)},dispatchEvent(e){if(!(e instanceof zs))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return e.defaultPrevented=!1,e.path=null,e.target=this,e.manager.dispatchEvent(e),!e.defaultPrevented}};Kt.mixin(rD);const nD={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Kt.mixin(nD);const iD=9,Zo=100,sD=0,oD=0,vg=2,yg=1,aD=-1e3,lD=-1e3,hD=2;class Dv{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Qr.tablet||Qr.phone)&&this.createTouchHook();const r=document.createElement("div");r.style.width=`${Zo}px`,r.style.height=`${Zo}px`,r.style.position="absolute",r.style.top=`${sD}px`,r.style.left=`${oD}px`,r.style.zIndex=vg.toString(),this.div=r,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${yg}px`,t.style.height=`${yg}px`,t.style.position="absolute",t.style.top=`${aD}px`,t.style.left=`${lD}px`,t.style.zIndex=hD.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const r=t.children;if(r)for(let n=0;n<r.length;n++)this.updateAccessibleObjects(r[n])}update(){const t=performance.now();if(Qr.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:r,y:n,width:i,height:o}=this.renderer.view.getBoundingClientRect(),{width:l,height:h,resolution:u}=this.renderer,f=i/l*u,d=o/h*u;let p=this.div;p.style.left=`${r}px`,p.style.top=`${n}px`,p.style.width=`${l}px`,p.style.height=`${h}px`;for(let g=0;g<this.children.length;g++){const v=this.children[g];if(v.renderId!==this.renderId)v._accessibleActive=!1,Li(this.children,g,1),this.div.removeChild(v._accessibleDiv),this.pool.push(v._accessibleDiv),v._accessibleDiv=null,g--;else{p=v._accessibleDiv;let y=v.hitArea;const w=v.worldTransform;v.hitArea?(p.style.left=`${(w.tx+y.x*w.a)*f}px`,p.style.top=`${(w.ty+y.y*w.d)*d}px`,p.style.width=`${y.width*w.a*f}px`,p.style.height=`${y.height*w.d*d}px`):(y=v.getBounds(),this.capHitArea(y),p.style.left=`${y.x*f}px`,p.style.top=`${y.y*d}px`,p.style.width=`${y.width*f}px`,p.style.height=`${y.height*d}px`,p.title!==v.accessibleTitle&&v.accessibleTitle!==null&&(p.title=v.accessibleTitle),p.getAttribute("aria-label")!==v.accessibleHint&&v.accessibleHint!==null&&p.setAttribute("aria-label",v.accessibleHint)),(v.accessibleTitle!==p.title||v.tabIndex!==p.tabIndex)&&(p.title=v.accessibleTitle,p.tabIndex=v.tabIndex,this.debug&&this.updateDebugHTML(p))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:r,height:n}=this.renderer;t.x+t.width>r&&(t.width=r-t.x),t.y+t.height>n&&(t.height=n-t.y)}addChild(t){let r=this.pool.pop();r||(r=document.createElement("button"),r.style.width=`${Zo}px`,r.style.height=`${Zo}px`,r.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",r.style.position="absolute",r.style.zIndex=vg.toString(),r.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?r.setAttribute("aria-live","off"):r.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?r.setAttribute("aria-relevant","additions"):r.setAttribute("aria-relevant","text"),r.addEventListener("click",this._onClick.bind(this)),r.addEventListener("focus",this._onFocus.bind(this)),r.addEventListener("focusout",this._onFocusOut.bind(this))),r.style.pointerEvents=t.accessiblePointerEvents,r.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?r.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(r.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&r.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(r),t._accessibleActive=!0,t._accessibleDiv=r,r.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,r){const{displayObject:n}=t.target,i=this.renderer.events.rootBoundary,o=Object.assign(new zs(i),{target:n});i.rootTarget=this.renderer.lastObjectRendered,r.forEach(l=>i.dispatchEvent(o,l))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===iD&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Dv.extension={name:"accessibility",type:[J.RendererPlugin,J.CanvasRendererPlugin]};st.add(Dv);const qu=class{constructor(e){this.stage=new Xe,e=Object.assign({forceCanvas:!1},e),this.renderer=wM(e),qu._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(e,t){const r=qu._plugins.slice(0);r.reverse(),r.forEach(n=>{n.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};let Ac=qu;Ac._plugins=[];st.handleByList(J.Application,Ac._plugins);class Bv{static init(t){Object.defineProperty(this,"resizeTo",{set(r){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=r,r&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let r,n;if(this._resizeTo===globalThis.window)r=globalThis.innerWidth,n=globalThis.innerHeight;else{const{clientWidth:i,clientHeight:o}=this._resizeTo;r=i,n=o}this.renderer.resize(r,n),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Bv.extension=J.Application;st.add(Bv);const _g={loader:J.LoadParser,resolver:J.ResolveParser,cache:J.CacheParser,detection:J.DetectionParser};st.handle(J.Asset,e=>{const t=e.ref;Object.entries(_g).filter(([r])=>!!t[r]).forEach(([r,n])=>st.add(Object.assign(t[r],{extension:t[r].extension??n})))},e=>{const t=e.ref;Object.keys(_g).filter(r=>!!t[r]).forEach(r=>st.remove(t[r]))});class uD{constructor(t,r=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=r}add(t){t.forEach(r=>{this._assetList.push(r)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],r=Math.min(this._assetList.length,this._maxConcurrent);for(let n=0;n<r;n++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Ov(e,t){if(Array.isArray(t)){for(const r of t)if(e.startsWith(`data:${r}`))return!0;return!1}return e.startsWith(`data:${t}`)}function ja(e,t){const r=e.split("?")[0],n=be.extname(r).toLowerCase();return Array.isArray(t)?t.includes(n):n===t}const tn=(e,t)=>(Array.isArray(e)||(e=[e]),t?e.map(r=>typeof r=="string"?t(r):r):e);function Fv(e,t,r,n,i){const o=t[r];for(let l=0;l<o.length;l++){const h=o[l];r<t.length-1?Fv(e.replace(n[r],h),t,r+1,n,i):i.push(e.replace(n[r],h))}}function cD(e){const t=/\{(.*?)\}/g,r=e.match(t),n=[];if(r){const i=[];r.forEach(o=>{const l=o.substring(1,o.length-1).split(",");i.push(l)}),Fv(e,i,0,r,n)}else n.push(e);return n}const Ba=e=>!Array.isArray(e);class fD{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const r=this._cache.get(t);return r||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),r}set(t,r){const n=tn(t);let i;for(let h=0;h<this.parsers.length;h++){const u=this.parsers[h];if(u.test(r)){i=u.getCacheableAssets(n,r);break}}i||(i={},n.forEach(h=>{i[h]=r}));const o=Object.keys(i),l={cacheKeys:o,keys:n};if(n.forEach(h=>{this._cacheMap.set(h,l)}),o.forEach(h=>{this._cache.has(h)&&this._cache.get(h)!==r&&console.warn("[Cache] already has key:",h),this._cache.set(h,i[h])}),r instanceof it){const h=r;n.forEach(u=>{h.baseTexture!==it.EMPTY.baseTexture&&mt.addToCache(h.baseTexture,u),it.addToCache(h,u)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const r=this._cacheMap.get(t);r.cacheKeys.forEach(i=>{this._cache.delete(i)}),r.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}}const ws=new fD;class dD{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(t,r){const n={promise:null,parser:null};return n.promise=(async()=>{var o,l;let i=null;for(let h=0;h<this.parsers.length;h++){const u=this.parsers[h];if(u.load&&((o=u.test)!=null&&o.call(u,t,r,this))){i=await u.load(t,r,this),n.parser=u;break}}if(!n.parser)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has being added`),null;for(let h=0;h<this.parsers.length;h++){const u=this.parsers[h];u.parse&&u.parse&&await((l=u.testParse)==null?void 0:l.call(u,i,r,this))&&(i=await u.parse(i,r,this)||i,n.parser=u)}return i})(),n}async load(t,r){let n=0;const i={},o=Ba(t),l=tn(t,f=>({src:f})),h=l.length,u=l.map(async f=>{const d=be.toAbsolute(f.src);if(!i[f.src])try{this.promiseCache[d]||(this.promiseCache[d]=this._getLoadPromiseAndParser(d,f)),i[f.src]=await this.promiseCache[d].promise,r&&r(++n/h)}catch(p){throw delete this.promiseCache[d],delete i[f.src],new Error(`[Loader.load] Failed to load ${d}.
${p}`)}});return await Promise.all(u),o?i[l[0].src]:i}async unload(t){const n=tn(t,i=>({src:i})).map(async i=>{var h,u;const o=be.toAbsolute(i.src),l=this.promiseCache[o];if(l){const f=await l.promise;(u=(h=l.parser)==null?void 0:h.unload)==null||u.call(h,f,i,this),delete this.promiseCache[o]}});await Promise.all(n)}get parsers(){return this._parsers}}var Nr=(e=>(e[e.Low=0]="Low",e[e.Normal=1]="Normal",e[e.High=2]="High",e))(Nr||{});const pD={extension:{type:J.LoadParser,priority:Nr.Low},test(e){return be.extname(e).toLowerCase()===".json"},async load(e){return await(await Q.ADAPTER.fetch(e)).json()}};st.add(pD);const gD={extension:{type:J.LoadParser,priority:Nr.Low},test(e){return be.extname(e).toLowerCase()===".txt"},async load(e){return await(await Q.ADAPTER.fetch(e)).text()}};st.add(gD);const mD=["normal","bold","100","200","300","400","500","600","700","800","900"],vD=[".ttf",".otf",".woff",".woff2"],yD=["font/ttf","font/otf","font/woff","font/woff2"];function _D(e){const t=be.extname(e);return be.basename(e,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ")}const xD={extension:{type:J.LoadParser,priority:Nr.Low},test(e){return Ov(e,yD)||ja(e,vD)},async load(e,t){var n,i,o;if(!globalThis.navigator.onLine)throw new Error("[loadWebFont] Cannot load font - navigator is offline");const r=Q.ADAPTER.getFontFaceSet();if(r){const l=[],h=((n=t.data)==null?void 0:n.family)??_D(e),u=((o=(i=t.data)==null?void 0:i.weights)==null?void 0:o.filter(d=>mD.includes(d)))??["normal"],f=t.data??{};for(let d=0;d<u.length;d++){const p=u[d],g=new FontFace(h,`url(${encodeURI(e)})`,{...f,weight:p});await g.load(),r.add(g),l.push(g)}return l.length===1?l[0]:l}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach(t=>Q.ADAPTER.getFontFaceSet().delete(t))}};st.add(xD);let xg=0,Kh;const bD="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",wD={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${bD}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},ED={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let Zh;class TD{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const r=URL.createObjectURL(new Blob([wD.code],{type:"application/javascript"})),n=new Worker(r);n.addEventListener("message",i=>{n.terminate(),URL.revokeObjectURL(r),t(i.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){Kh===void 0&&(Kh=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Kh&&(Zh||(Zh=URL.createObjectURL(new Blob([ED.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Zh),t.addEventListener("message",r=>{this.complete(r.data),this.returnWorker(r.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,r){await this._initWorkers();const n=new Promise((i,o)=>{this.queue.push({id:t,arguments:r,resolve:i,reject:o})});return this.next(),n}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const r=this.queue.pop(),n=r.id;this.resolveHash[xg]={resolve:r.resolve,reject:r.reject},t.postMessage({data:r.arguments,uuid:xg++,id:n})}}const bg=new TD;function qa(e,t,r){const n=new it(e);return n.baseTexture.on("dispose",()=>{delete t.promiseCache[r]}),n}const AD=[".jpeg",".jpg",".png",".webp",".avif"],SD=["image/jpeg","image/png","image/webp","image/avif"];async function CD(e){const t=await Q.ADAPTER.fetch(e);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${t.status} ${t.statusText}`);const r=await t.blob();return await createImageBitmap(r)}const ks={extension:{type:J.LoadParser,priority:Nr.High},config:{preferWorkers:!0},test(e){return Ov(e,SD)||ja(e,AD)},async load(e,t,r){let n=null;globalThis.createImageBitmap?this.config.preferWorkers&&await bg.isImageBitmapSupported()?n=await bg.loadImageBitmap(e):n=await CD(e):n=await new Promise(o=>{n=new Image,n.crossOrigin="anonymous",n.src=e,n.complete?o(n):n.onload=()=>{o(n)}});const i=new mt(n,{resolution:xn(e),...t.data});return i.resource.src=e,qa(i,r,e)},unload(e){e.destroy(!0)}};st.add(ks);const ID={extension:{type:J.LoadParser,priority:Nr.High},test(e){return be.extname(e).toLowerCase()===".svg"},async testParse(e){return Ns.test(e)},async parse(e,t,r){var l,h,u;const n=new Ns(e,(l=t==null?void 0:t.data)==null?void 0:l.resourceOptions),i=new mt(n,{resolution:xn(e),...t==null?void 0:t.data});i.resource.src=e;const o=qa(i,r,e);return(u=(h=t==null?void 0:t.data)==null?void 0:h.resourceOptions)!=null&&u.autoLoad||await n.load(),o},async load(e,t){return(await Q.ADAPTER.fetch(e)).text()},unload:ks.unload};st.add(ID);class PD{constructor(){this._bundleIdConnector="-",this._createBundleAssetId=(t,r)=>`${t}${this._bundleIdConnector}${r}`,this._extractAssetIdFromBundle=(t,r)=>r.replace(`${t}${this._bundleIdConnector}`,""),this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(r=>{this._preferredOrder.push(r),r.priority||(r.priority=Object.keys(r.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this._preferredOrder=[],this._resolverHash={},this._assetMap={},this._rootPath=null,this._basePath=null,this._manifest=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const r=t;this._defaultSearchParams=Object.keys(r).map(n=>`${encodeURIComponent(n)}=${encodeURIComponent(r[n])}`).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(r=>{this.addBundle(r.name,r.assets)})}addBundle(t,r){const n=[];Array.isArray(r)?r.forEach(i=>{if(typeof i.name=="string"){const o=this._createBundleAssetId(t,i.name);n.push(o),this.add([i.name,o],i.srcs)}else{const o=i.name.map(l=>this._createBundleAssetId(t,l));o.forEach(l=>{n.push(l)}),this.add([...i.name,...o],i.srcs)}}):Object.keys(r).forEach(i=>{n.push(this._createBundleAssetId(t,i)),this.add([i,this._createBundleAssetId(t,i)],r[i])}),this._bundles[t]=n}add(t,r,n){const i=tn(t);i.forEach(l=>{this._assetMap[l]&&console.warn(`[Resolver] already has key: ${l} overwriting`)}),Array.isArray(r)||(typeof r=="string"?r=cD(r):r=[r]);const o=r.map(l=>{let h=l;if(typeof l=="string"){let u=!1;for(let f=0;f<this._parsers.length;f++){const d=this._parsers[f];if(d.test(l)){h=d.parse(l),u=!0;break}}u||(h={src:l})}return h.format||(h.format=h.src.split(".").pop()),h.alias||(h.alias=i),(this._basePath||this._rootPath)&&(h.src=be.toAbsolute(h.src,this._basePath,this._rootPath)),h.src=this._appendDefaultSearchParams(h.src),h.data=h.data??n,h});i.forEach(l=>{this._assetMap[l]=o})}resolveBundle(t){const r=Ba(t);t=tn(t);const n={};return t.forEach(i=>{const o=this._bundles[i];if(o){const l=this.resolve(o),h={};for(const u in l){const f=l[u];h[this._extractAssetIdFromBundle(i,u)]=f}n[i]=h}}),r?n[t[0]]:n}resolveUrl(t){const r=this.resolve(t);if(typeof t!="string"){const n={};for(const i in r)n[i]=r[i].src;return n}return r.src}resolve(t){const r=Ba(t);t=tn(t);const n={};return t.forEach(i=>{if(!this._resolverHash[i])if(this._assetMap[i]){let o=this._assetMap[i];const l=this._getPreferredOrder(o),h=o[0];l==null||l.priority.forEach(u=>{l.params[u].forEach(f=>{const d=o.filter(p=>p[u]?p[u]===f:!1);d.length&&(o=d)})}),this._resolverHash[i]=o[0]??h}else{let o=i;(this._basePath||this._rootPath)&&(o=be.toAbsolute(o,this._basePath,this._rootPath)),o=this._appendDefaultSearchParams(o),this._resolverHash[i]={src:o}}n[i]=this._resolverHash[i]}),r?n[t[0]]:n}_getPreferredOrder(t){for(let r=0;r<t.length;r++){const n=t[0],i=this._preferredOrder.find(o=>o.params.format.includes(n.format));if(i)return i}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const r=/\?/.test(t)?"&":"?";return`${t}${r}${this._defaultSearchParams}`}}class RD{constructor(){this._detections=[],this._initialized=!1,this.resolver=new PD,this.loader=new dD,this.cache=ws,this._backgroundLoader=new uD(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var o,l,h;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let u=t.manifest;typeof u=="string"&&(u=await this.load(u)),this.resolver.addManifest(u)}const r=((o=t.texturePreference)==null?void 0:o.resolution)??1,n=typeof r=="number"?[r]:r;let i=[];if((l=t.texturePreference)!=null&&l.format){const u=(h=t.texturePreference)==null?void 0:h.format;i=typeof u=="string"?[u]:u;for(const f of this._detections)await f.test()||(i=await f.remove(i))}else for(const u of this._detections)await u.test()&&(i=await u.add(i));this.resolver.prefer({params:{format:i,resolution:n}})}add(t,r,n){this.resolver.add(t,r,n)}async load(t,r){this._initialized||await this.init();const n=Ba(t),i=tn(t).map(h=>typeof h!="string"?(this.resolver.add(h.src,h),h.src):h),o=this.resolver.resolve(i),l=await this._mapLoadToResolve(o,r);return n?l[i[0]]:l}addBundle(t,r){this.resolver.addBundle(t,r)}async loadBundle(t,r){this._initialized||await this.init();let n=!1;typeof t=="string"&&(n=!0,t=[t]);const i=this.resolver.resolveBundle(t),o={},l=Object.keys(i);let h=0,u=0;const f=()=>{r==null||r(++h/u)},d=l.map(p=>{const g=i[p];return u+=Object.keys(g).length,this._mapLoadToResolve(g,f).then(v=>{o[p]=v})});return await Promise.all(d),n?o[t[0]]:o}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const r=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(r))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const r=this.resolver.resolveBundle(t);Object.values(r).forEach(n=>{this._backgroundLoader.add(Object.values(n))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return ws.get(t);const r={};for(let n=0;n<t.length;n++)r[n]=ws.get(t[n]);return r}async _mapLoadToResolve(t,r){const n=Object.values(t),i=Object.keys(t);this._backgroundLoader.active=!1;const o=await this.loader.load(n,r);this._backgroundLoader.active=!0;const l={};return n.forEach((h,u)=>{const f=o[h.src],d=[h.src];h.alias&&d.push(...h.alias),l[i[u]]=f,ws.set(d,f)}),l}async unload(t){this._initialized||await this.init();const r=tn(t).map(i=>typeof i!="string"?i.src:i),n=this.resolver.resolve(r);await this._unloadFromResolved(n)}async unloadBundle(t){this._initialized||await this.init(),t=tn(t);const r=this.resolver.resolveBundle(t),n=Object.keys(r).map(i=>this._unloadFromResolved(r[i]));await Promise.all(n)}async _unloadFromResolved(t){const r=Object.values(t);r.forEach(n=>{ws.remove(n.src)}),await this.loader.unload(r)}get detections(){return this._detections}get preferWorkers(){return ks.config.preferWorkers}set preferWorkers(t){ks.config.preferWorkers=t}}const Xn=new RD;st.handleByList(J.LoadParser,Xn.loader.parsers).handleByList(J.ResolveParser,Xn.resolver.parsers).handleByList(J.CacheParser,Xn.cache.parsers).handleByList(J.DetectionParser,Xn.detections);const MD={extension:J.CacheParser,test:e=>Array.isArray(e)&&e.every(t=>t instanceof it),getCacheableAssets:(e,t)=>{const r={};return e.forEach(n=>{t.forEach((i,o)=>{r[n+(o===0?"":o+1)]=i})}),r}};st.add(MD);const DD={extension:{type:J.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await Q.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then(r=>r.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"avif"],remove:async e=>e.filter(t=>t!=="avif")};st.add(DD);const BD={extension:{type:J.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await Q.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then(r=>r.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"webp"],remove:async e=>e.filter(t=>t!=="webp")};st.add(BD);const wg=["png","jpg","jpeg"],OD={extension:{type:J.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...wg],remove:async e=>e.filter(t=>!wg.includes(t))};st.add(OD);const FD={extension:J.ResolveParser,test:ks.test,parse:e=>{var t;return{resolution:parseFloat(((t=Q.RETINA_PREFIX.exec(e))==null?void 0:t[1])??"1"),format:e.split(".").pop(),src:e}}};st.add(FD);var ze=(e=>(e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e))(ze||{});const Oa={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let Zr,Si;function Eg(){Si={s3tc:Zr.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Zr.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Zr.getExtension("WEBGL_compressed_texture_etc"),etc1:Zr.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Zr.getExtension("WEBGL_compressed_texture_pvrtc")||Zr.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Zr.getExtension("WEBGL_compressed_texture_atc"),astc:Zr.getExtension("WEBGL_compressed_texture_astc")}}const LD={extension:{type:J.DetectionParser,priority:2},test:async()=>{const t=Q.ADAPTER.createCanvas().getContext("webgl");return t?(Zr=t,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async e=>{Si||Eg();const t=[];for(const r in Si)Si[r]&&t.push(r);return[...t,...e]},remove:async e=>(Si||Eg(),e.filter(t=>!(t in Si)))};st.add(LD);class ND extends Hs{constructor(t,r={width:1,height:1,autoLoad:!0}){let n,i;typeof t=="string"?(n=t,i=new Uint8Array):(n=null,i=t),super(i,r),this.origin=n,this.buffer=i?new Lu(i):null,this.origin&&r.autoLoad!==!1&&this.load(),i!=null&&i.length&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}async load(){const n=await(await(await fetch(this.origin)).blob()).arrayBuffer();return this.data=new Uint32Array(n),this.buffer=new Lu(n),this.loaded=!0,this.onBlobLoaded(n),this.update(),this}}class Kn extends ND{constructor(t,r){super(t,r),this.format=r.format,this.levels=r.levels||1,this._width=r.width,this._height=r.height,this._extension=Kn._formatToExtension(this.format),(r.levelBuffers||this.buffer)&&(this._levelBuffers=r.levelBuffers||Kn._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,r,n){const i=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let l=0,h=this.levels;l<h;l++){const{levelID:u,levelWidth:f,levelHeight:d,levelBuffer:p}=this._levelBuffers[l];i.compressedTexImage2D(i.TEXTURE_2D,u,this.format,f,d,0,p)}return!0}onBlobLoaded(){this._levelBuffers=Kn._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,r,n,i,o,l,h){const u=new Array(n);let f=t.byteOffset,d=l,p=h,g=d+i-1&~(i-1),v=p+o-1&~(o-1),y=g*v*Oa[r];for(let w=0;w<n;w++)u[w]={levelID:w,levelWidth:n>1?d:g,levelHeight:n>1?p:v,levelBuffer:new Uint8Array(t.buffer,f,y)},f+=y,d=d>>1||1,p=p>>1||1,g=d+i-1&~(i-1),v=p+o-1&~(o-1),y=g*v*Oa[r];return u}}const Jh=4,Jo=124,kD=32,Tg=20,UD=542327876,Qo={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},GD={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},ta={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},$D=1,WD=2,HD=4,zD=64,XD=512,VD=131072,YD=827611204,jD=861165636,qD=894720068,KD=808540228,ZD=4,JD={[YD]:ze.COMPRESSED_RGBA_S3TC_DXT1_EXT,[jD]:ze.COMPRESSED_RGBA_S3TC_DXT3_EXT,[qD]:ze.COMPRESSED_RGBA_S3TC_DXT5_EXT},QD={70:ze.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:ze.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:ze.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:ze.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:ze.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:ze.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:ze.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:ze.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:ze.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function tB(e){const t=new Uint32Array(e);if(t[0]!==UD)throw new Error("Invalid DDS file magic word");const n=new Uint32Array(e,0,Jo/Uint32Array.BYTES_PER_ELEMENT),i=n[Qo.HEIGHT],o=n[Qo.WIDTH],l=n[Qo.MIPMAP_COUNT],h=new Uint32Array(e,Qo.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,kD/Uint32Array.BYTES_PER_ELEMENT),u=h[$D];if(u&HD){const f=h[GD.FOURCC];if(f!==KD){const E=JD[f],I=Jh+Jo,D=new Uint8Array(e,I);return[new Kn(D,{format:E,width:o,height:i,levels:l})]}const d=Jh+Jo,p=new Uint32Array(t.buffer,d,Tg/Uint32Array.BYTES_PER_ELEMENT),g=p[ta.DXGI_FORMAT],v=p[ta.RESOURCE_DIMENSION],y=p[ta.MISC_FLAG],w=p[ta.ARRAY_SIZE],x=QD[g];if(x===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${g}`);if(y===ZD)throw new Error("DDSParser does not support cubemap textures");if(v===6)throw new Error("DDSParser does not supported 3D texture data");const T=new Array,S=Jh+Jo+Tg;if(w===1)T.push(new Uint8Array(e,S));else{const E=Oa[x];let I=0,D=o,L=i;for(let F=0;F<l;F++){const X=Math.max(1,D+3&-4),q=Math.max(1,L+3&-4),V=X*q*E;I+=V,D=D>>>1,L=L>>>1}let O=S;for(let F=0;F<w;F++)T.push(new Uint8Array(e,O,I)),O+=I}return T.map(E=>new Kn(E,{format:x,width:o,height:i,levels:l}))}throw u&zD?new Error("DDSParser does not support uncompressed texture data."):u&XD?new Error("DDSParser does not supported YUV uncompressed texture data."):u&VD?new Error("DDSParser does not support single-channel (lumninance) texture data!"):u&WD?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const Ag=[171,75,84,88,32,49,49,187,13,10,26,10],eB=67305985,ur={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Ku=64,Sg={[ot.UNSIGNED_BYTE]:1,[ot.UNSIGNED_SHORT]:2,[ot.INT]:4,[ot.UNSIGNED_INT]:4,[ot.FLOAT]:4,[ot.HALF_FLOAT]:8},rB={[Y.RGBA]:4,[Y.RGB]:3,[Y.RG]:2,[Y.RED]:1,[Y.LUMINANCE]:1,[Y.LUMINANCE_ALPHA]:2,[Y.ALPHA]:1},nB={[ot.UNSIGNED_SHORT_4_4_4_4]:2,[ot.UNSIGNED_SHORT_5_5_5_1]:2,[ot.UNSIGNED_SHORT_5_6_5]:2};function iB(e,t,r=!1){const n=new DataView(t);if(!sB(e,n))return null;const i=n.getUint32(ur.ENDIANNESS,!0)===eB,o=n.getUint32(ur.GL_TYPE,i),l=n.getUint32(ur.GL_FORMAT,i),h=n.getUint32(ur.GL_INTERNAL_FORMAT,i),u=n.getUint32(ur.PIXEL_WIDTH,i),f=n.getUint32(ur.PIXEL_HEIGHT,i)||1,d=n.getUint32(ur.PIXEL_DEPTH,i)||1,p=n.getUint32(ur.NUMBER_OF_ARRAY_ELEMENTS,i)||1,g=n.getUint32(ur.NUMBER_OF_FACES,i),v=n.getUint32(ur.NUMBER_OF_MIPMAP_LEVELS,i),y=n.getUint32(ur.BYTES_OF_KEY_VALUE_DATA,i);if(f===0||d!==1)throw new Error("Only 2D textures are supported");if(g!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(p!==1)throw new Error("WebGL does not support array textures");const w=4,x=4,T=u+3&-4,S=f+3&-4,E=new Array(p);let I=u*f;o===0&&(I=T*S);let D;if(o!==0?Sg[o]?D=Sg[o]*rB[l]:D=nB[o]:D=Oa[h],D===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const L=r?aB(n,y,i):null;let F=I*D,X=u,q=f,V=T,Z=S,$=Ku+y;for(let k=0;k<v;k++){const lt=n.getUint32($,i);let pt=$+4;for(let j=0;j<p;j++){let _t=E[j];_t||(_t=E[j]=new Array(v)),_t[k]={levelID:k,levelWidth:v>1||o!==0?X:V,levelHeight:v>1||o!==0?q:Z,levelBuffer:new Uint8Array(t,pt,F)},pt+=F}$+=lt+4,$=$%4!==0?$+4-$%4:$,X=X>>1||1,q=q>>1||1,V=X+w-1&~(w-1),Z=q+x-1&~(x-1),F=V*Z*D}return o!==0?{uncompressed:E.map(k=>{let lt=k[0].levelBuffer,pt=!1;return o===ot.FLOAT?lt=new Float32Array(k[0].levelBuffer.buffer,k[0].levelBuffer.byteOffset,k[0].levelBuffer.byteLength/4):o===ot.UNSIGNED_INT?(pt=!0,lt=new Uint32Array(k[0].levelBuffer.buffer,k[0].levelBuffer.byteOffset,k[0].levelBuffer.byteLength/4)):o===ot.INT&&(pt=!0,lt=new Int32Array(k[0].levelBuffer.buffer,k[0].levelBuffer.byteOffset,k[0].levelBuffer.byteLength/4)),{resource:new Hs(lt,{width:k[0].levelWidth,height:k[0].levelHeight}),type:o,format:pt?oB(l):l}}),kvData:L}:{compressed:E.map(k=>new Kn(null,{format:h,width:u,height:f,levels:v,levelBuffers:k})),kvData:L}}function sB(e,t){for(let r=0;r<Ag.length;r++)if(t.getUint8(r)!==Ag[r])return console.error(`${e} is not a valid *.ktx file!`),!1;return!0}function oB(e){switch(e){case Y.RGBA:return Y.RGBA_INTEGER;case Y.RGB:return Y.RGB_INTEGER;case Y.RG:return Y.RG_INTEGER;case Y.RED:return Y.RED_INTEGER;default:return e}}function aB(e,t,r){const n=new Map;let i=0;for(;i<t;){const o=e.getUint32(Ku+i,r),l=Ku+i+4,h=3-(o+3)%4;if(o===0||o>t-i){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let u=0;for(;u<o&&e.getUint8(l+u)!==0;u++);if(u===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const f=new TextDecoder().decode(new Uint8Array(e.buffer,l,u)),d=new DataView(e.buffer,l+u+1,o-u-1);n.set(f,d),i+=4+o+h}return n}const lB={extension:{type:J.LoadParser,priority:Nr.High},test(e){return ja(e,".dds")},async load(e,t,r){const i=await(await Q.ADAPTER.fetch(e)).arrayBuffer(),l=tB(i).map(h=>{const u=new mt(h,{mipmap:Lr.OFF,alphaMode:wr.NO_PREMULTIPLIED_ALPHA,resolution:xn(e),...t.data});return qa(u,r,e)});return l.length===1?l[0]:l},unload(e){Array.isArray(e)?e.forEach(t=>t.destroy(!0)):e.destroy(!0)}};st.add(lB);const hB={extension:{type:J.LoadParser,priority:Nr.High},test(e){return ja(e,".ktx")},async load(e,t,r){const i=await(await Q.ADAPTER.fetch(e)).arrayBuffer(),{compressed:o,uncompressed:l,kvData:h}=iB(e,i),u=o??l,f={mipmap:Lr.OFF,alphaMode:wr.NO_PREMULTIPLIED_ALPHA,resolution:xn(e),...t.data},d=u.map(p=>{u===l&&Object.assign(f,{type:p.type,format:p.format});const g=new mt(p,f);return g.ktxKeyValueData=h,qa(g,r,e)});return d.length===1?d[0]:d},unload(e){Array.isArray(e)?e.forEach(t=>t.destroy(!0)):e.destroy(!0)}};st.add(hB);const uB={extension:J.ResolveParser,test:e=>{const r=e.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(r)},parse:e=>{var n,i;if(e.split("?")[0].split(".").pop()==="ktx"){const o=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(o.some(l=>e.endsWith(l)))return{resolution:parseFloat(((n=Q.RETINA_PREFIX.exec(e))==null?void 0:n[1])??"1"),format:o.find(l=>e.endsWith(l)),src:e}}return{resolution:parseFloat(((i=Q.RETINA_PREFIX.exec(e))==null?void 0:i[1])??"1"),format:e.split(".").pop(),src:e}}};st.add(uB);const Cg=new At,Ig=4,Zu=class{constructor(e){this.renderer=e}async image(e,t,r){const n=new Image;return n.src=await this.base64(e,t,r),n}async base64(e,t,r){const n=this.canvas(e);if(n.toDataURL!==void 0)return n.toDataURL(t,r);if(n.convertToBlob!==void 0){const i=await n.convertToBlob({type:t,quality:r});return await new Promise(o=>{const l=new FileReader;l.onload=()=>o(l.result),l.readAsDataURL(i)})}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")}canvas(e,t){const r=this.renderer;let n,i=!1,o,l=!1;e&&(e instanceof En?o=e:(o=this.renderer.generateTexture(e),l=!0)),o?(n=o.baseTexture.resolution,t=t??o.frame,i=!1,r.renderTexture.bind(o)):(n=r.resolution,t||(t=Cg,t.width=r.width,t.height=r.height),i=!0,r.renderTexture.bind(null));const h=Math.round(t.width*n),u=Math.round(t.height*n);let f=new rg(h,u,1);const d=new Uint8Array(Ig*h*u),p=r.gl;p.readPixels(Math.round(t.x*n),Math.round(t.y*n),h,u,p.RGBA,p.UNSIGNED_BYTE,d);const g=f.context.getImageData(0,0,h,u);if(Zu.arrayPostDivide(d,g.data),f.context.putImageData(g,0,0),i){const v=new rg(f.width,f.height,1);v.context.scale(1,-1),v.context.drawImage(f.canvas,0,-u),f.destroy(),f=v}return l&&o.destroy(!0),f.canvas}pixels(e,t){const r=this.renderer;let n,i,o=!1;e&&(e instanceof En?i=e:(i=this.renderer.generateTexture(e),o=!0)),i?(n=i.baseTexture.resolution,t=t??i.frame,r.renderTexture.bind(i)):(n=r.resolution,t||(t=Cg,t.width=r.width,t.height=r.height),r.renderTexture.bind(null));const l=Math.round(t.width*n),h=Math.round(t.height*n),u=new Uint8Array(Ig*l*h),f=r.gl;return f.readPixels(Math.round(t.x*n),Math.round(t.y*n),l,h,f.RGBA,f.UNSIGNED_BYTE,u),o&&i.destroy(!0),Zu.arrayPostDivide(u,u),u}destroy(){this.renderer=null}static arrayPostDivide(e,t){for(let r=0;r<e.length;r+=4){const n=t[r+3]=e[r+3];n!==0?(t[r]=Math.round(Math.min(e[r]*255/n,255)),t[r+1]=Math.round(Math.min(e[r+1]*255/n,255)),t[r+2]=Math.round(Math.min(e[r+2]*255/n,255))):(t[r]=e[r],t[r+1]=e[r+1],t[r+2]=e[r+2])}}};let Lv=Zu;Lv.extension={name:"extract",type:J.RendererSystem};st.add(Lv);const Fa={build(e){const t=e.points;let r,n,i,o,l,h;if(e.type===xe.CIRC){const y=e.shape;r=y.x,n=y.y,l=h=y.radius,i=o=0}else if(e.type===xe.ELIP){const y=e.shape;r=y.x,n=y.y,l=y.width,h=y.height,i=o=0}else{const y=e.shape,w=y.width/2,x=y.height/2;r=y.x+w,n=y.y+x,l=h=Math.max(0,Math.min(y.radius,Math.min(w,x))),i=w-l,o=x-h}if(!(l>=0&&h>=0&&i>=0&&o>=0)){t.length=0;return}const u=Math.ceil(2.3*Math.sqrt(l+h)),f=u*8+(i?4:0)+(o?4:0);if(t.length=f,f===0)return;if(u===0){t.length=8,t[0]=t[6]=r+i,t[1]=t[3]=n+o,t[2]=t[4]=r-i,t[5]=t[7]=n-o;return}let d=0,p=u*4+(i?2:0)+2,g=p,v=f;{const y=i+l,w=o,x=r+y,T=r-y,S=n+w;if(t[d++]=x,t[d++]=S,t[--p]=S,t[--p]=T,o){const E=n-w;t[g++]=T,t[g++]=E,t[--v]=E,t[--v]=x}}for(let y=1;y<u;y++){const w=Math.PI/2*(y/u),x=i+Math.cos(w)*l,T=o+Math.sin(w)*h,S=r+x,E=r-x,I=n+T,D=n-T;t[d++]=S,t[d++]=I,t[--p]=I,t[--p]=E,t[g++]=E,t[g++]=D,t[--v]=D,t[--v]=S}{const y=i,w=o+h,x=r+y,T=r-y,S=n+w,E=n-w;t[d++]=x,t[d++]=S,t[--v]=E,t[--v]=x,i&&(t[d++]=T,t[d++]=S,t[--v]=E,t[--v]=T)}},triangulate(e,t){const r=e.points,n=t.points,i=t.indices;if(r.length===0)return;let o=n.length/2;const l=o;let h,u;if(e.type!==xe.RREC){const d=e.shape;h=d.x,u=d.y}else{const d=e.shape;h=d.x+d.width/2,u=d.y+d.height/2}const f=e.matrix;n.push(e.matrix?f.a*h+f.c*u+f.tx:h,e.matrix?f.b*h+f.d*u+f.ty:u),o++,n.push(r[0],r[1]);for(let d=2;d<r.length;d+=2)n.push(r[d],r[d+1]),i.push(o++,l,o);i.push(l+1,l,o)}};function Pg(e,t=!1){const r=e.length;if(r<6)return;let n=0;for(let i=0,o=e[r-2],l=e[r-1];i<r;i+=2){const h=e[i],u=e[i+1];n+=(h-o)*(u+l),o=h,l=u}if(!t&&n>0||t&&n<=0){const i=r/2;for(let o=i+i%2;o<r;o+=2){const l=r-o-2,h=r-o-1,u=o,f=o+1;[e[l],e[u]]=[e[u],e[l]],[e[h],e[f]]=[e[f],e[h]]}}}const Nv={build(e){e.points=e.shape.points.slice()},triangulate(e,t){let r=e.points;const n=e.holes,i=t.points,o=t.indices;if(r.length>=6){Pg(r,!1);const l=[];for(let f=0;f<n.length;f++){const d=n[f];Pg(d.points,!0),l.push(r.length/2),r=r.concat(d.points)}const h=NT(r,l,2);if(!h)return;const u=i.length/2;for(let f=0;f<h.length;f+=3)o.push(h[f]+u),o.push(h[f+1]+u),o.push(h[f+2]+u);for(let f=0;f<r.length;f++)i.push(r[f])}}},cB={build(e){const t=e.shape,r=t.x,n=t.y,i=t.width,o=t.height,l=e.points;l.length=0,i>=0&&o>=0&&l.push(r,n,r+i,n,r+i,n+o,r,n+o)},triangulate(e,t){const r=e.points,n=t.points;if(r.length===0)return;const i=n.length/2;n.push(r[0],r[1],r[2],r[3],r[6],r[7],r[4],r[5]),t.indices.push(i,i+1,i+2,i+1,i+2,i+3)}},fB={build(e){Fa.build(e)},triangulate(e,t){Fa.triangulate(e,t)}};var gn=(e=>(e.MITER="miter",e.BEVEL="bevel",e.ROUND="round",e))(gn||{}),Vn=(e=>(e.BUTT="butt",e.ROUND="round",e.SQUARE="square",e))(Vn||{});const Hi={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(e,t=20){if(!this.adaptive||!e||isNaN(e))return t;let r=Math.ceil(e/this.maxLength);return r<this.minSegments?r=this.minSegments:r>this.maxSegments&&(r=this.maxSegments),r}};class Rg{static curveTo(t,r,n,i,o,l){const h=l[l.length-2],f=l[l.length-1]-r,d=h-t,p=i-r,g=n-t,v=Math.abs(f*g-d*p);if(v<1e-8||o===0)return(l[l.length-2]!==t||l[l.length-1]!==r)&&l.push(t,r),null;const y=f*f+d*d,w=p*p+g*g,x=f*p+d*g,T=o*Math.sqrt(y)/v,S=o*Math.sqrt(w)/v,E=T*x/y,I=S*x/w,D=T*g+S*d,L=T*p+S*f,O=d*(S+E),F=f*(S+E),X=g*(T+I),q=p*(T+I),V=Math.atan2(F-L,O-D),Z=Math.atan2(q-L,X-D);return{cx:D+t,cy:L+r,radius:o,startAngle:V,endAngle:Z,anticlockwise:d*p>g*f}}static arc(t,r,n,i,o,l,h,u,f){const d=h-l,p=Hi._segmentsCount(Math.abs(d)*o,Math.ceil(Math.abs(d)/Ra)*40),g=d/(p*2),v=g*2,y=Math.cos(g),w=Math.sin(g),x=p-1,T=x%1/x;for(let S=0;S<=x;++S){const E=S+T*S,I=g+l+v*E,D=Math.cos(I),L=-Math.sin(I);f.push((y*D+w*L)*o+n,(y*-L+w*D)*o+i)}}}class dB{constructor(){this.reset()}begin(t,r,n){this.reset(),this.style=t,this.start=r,this.attribStart=n}end(t,r){this.attribSize=r-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class Sc{static curveLength(t,r,n,i,o,l,h,u){let d=0,p=0,g=0,v=0,y=0,w=0,x=0,T=0,S=0,E=0,I=0,D=t,L=r;for(let O=1;O<=10;++O)p=O/10,g=p*p,v=g*p,y=1-p,w=y*y,x=w*y,T=x*t+3*w*p*n+3*y*g*o+v*h,S=x*r+3*w*p*i+3*y*g*l+v*u,E=D-T,I=L-S,D=T,L=S,d+=Math.sqrt(E*E+I*I);return d}static curveTo(t,r,n,i,o,l,h){const u=h[h.length-2],f=h[h.length-1];h.length-=2;const d=Hi._segmentsCount(Sc.curveLength(u,f,t,r,n,i,o,l));let p=0,g=0,v=0,y=0,w=0;h.push(u,f);for(let x=1,T=0;x<=d;++x)T=x/d,p=1-T,g=p*p,v=g*p,y=T*T,w=y*T,h.push(v*u+3*g*T*t+3*p*y*n+w*o,v*f+3*g*T*r+3*p*y*i+w*l)}}function Mg(e,t,r,n,i,o,l,h){const u=e-r*i,f=t-n*i,d=e+r*o,p=t+n*o;let g,v;l?(g=n,v=-r):(g=-n,v=r);const y=u+g,w=f+v,x=d+g,T=p+v;return h.push(y,w),h.push(x,T),2}function kn(e,t,r,n,i,o,l,h){const u=r-e,f=n-t;let d=Math.atan2(u,f),p=Math.atan2(i-e,o-t);h&&d<p?d+=Math.PI*2:!h&&d>p&&(p+=Math.PI*2);let g=d;const v=p-d,y=Math.abs(v),w=Math.sqrt(u*u+f*f),x=(15*y*Math.sqrt(w)/Math.PI>>0)+1,T=v/x;if(g+=T,h){l.push(e,t),l.push(r,n);for(let S=1,E=g;S<x;S++,E+=T)l.push(e,t),l.push(e+Math.sin(E)*w,t+Math.cos(E)*w);l.push(e,t),l.push(i,o)}else{l.push(r,n),l.push(e,t);for(let S=1,E=g;S<x;S++,E+=T)l.push(e+Math.sin(E)*w,t+Math.cos(E)*w),l.push(e,t);l.push(i,o),l.push(e,t)}return x*2}function pB(e,t){const r=e.shape;let n=e.points||r.points.slice();const i=t.closePointEps;if(n.length===0)return;const o=e.lineStyle,l=new Ct(n[0],n[1]),h=new Ct(n[n.length-2],n[n.length-1]),u=r.type!==xe.POLY||r.closeStroke,f=Math.abs(l.x-h.x)<i&&Math.abs(l.y-h.y)<i;if(u){n=n.slice(),f&&(n.pop(),n.pop(),h.set(n[n.length-2],n[n.length-1]));const j=(l.x+h.x)*.5,_t=(h.y+l.y)*.5;n.unshift(j,_t),n.push(j,_t)}const d=t.points,p=n.length/2;let g=n.length;const v=d.length/2,y=o.width/2,w=y*y,x=o.miterLimit*o.miterLimit;let T=n[0],S=n[1],E=n[2],I=n[3],D=0,L=0,O=-(S-I),F=T-E,X=0,q=0,V=Math.sqrt(O*O+F*F);O/=V,F/=V,O*=y,F*=y;const Z=o.alignment,$=(1-Z)*2,k=Z*2;u||(o.cap===Vn.ROUND?g+=kn(T-O*($-k)*.5,S-F*($-k)*.5,T-O*$,S-F*$,T+O*k,S+F*k,d,!0)+2:o.cap===Vn.SQUARE&&(g+=Mg(T,S,O,F,$,k,!0,d))),d.push(T-O*$,S-F*$),d.push(T+O*k,S+F*k);for(let j=1;j<p-1;++j){T=n[(j-1)*2],S=n[(j-1)*2+1],E=n[j*2],I=n[j*2+1],D=n[(j+1)*2],L=n[(j+1)*2+1],O=-(S-I),F=T-E,V=Math.sqrt(O*O+F*F),O/=V,F/=V,O*=y,F*=y,X=-(I-L),q=E-D,V=Math.sqrt(X*X+q*q),X/=V,q/=V,X*=y,q*=y;const _t=E-T,Ft=S-I,H=E-D,nt=L-I,wt=_t*H+Ft*nt,Rt=Ft*H-nt*_t,Dt=Rt<0;if(Math.abs(Rt)<.001*Math.abs(wt)){d.push(E-O*$,I-F*$),d.push(E+O*k,I+F*k),wt>=0&&(o.join===gn.ROUND?g+=kn(E,I,E-O*$,I-F*$,E-X*$,I-q*$,d,!1)+4:g+=2,d.push(E-X*k,I-q*k),d.push(E+X*$,I+q*$));continue}const Gt=(-O+T)*(-F+I)-(-O+E)*(-F+S),$t=(-X+D)*(-q+I)-(-X+E)*(-q+L),oe=(_t*$t-H*Gt)/Rt,Zt=(nt*Gt-Ft*$t)/Rt,ae=(oe-E)*(oe-E)+(Zt-I)*(Zt-I),he=E+(oe-E)*$,Bt=I+(Zt-I)*$,Wt=E-(oe-E)*k,Jt=I-(Zt-I)*k,Qt=Math.min(_t*_t+Ft*Ft,H*H+nt*nt),we=Dt?$:k,Sn=Qt+we*we*w;ae<=Sn?o.join===gn.BEVEL||ae/w>x?(Dt?(d.push(he,Bt),d.push(E+O*k,I+F*k),d.push(he,Bt),d.push(E+X*k,I+q*k)):(d.push(E-O*$,I-F*$),d.push(Wt,Jt),d.push(E-X*$,I-q*$),d.push(Wt,Jt)),g+=2):o.join===gn.ROUND?Dt?(d.push(he,Bt),d.push(E+O*k,I+F*k),g+=kn(E,I,E+O*k,I+F*k,E+X*k,I+q*k,d,!0)+4,d.push(he,Bt),d.push(E+X*k,I+q*k)):(d.push(E-O*$,I-F*$),d.push(Wt,Jt),g+=kn(E,I,E-O*$,I-F*$,E-X*$,I-q*$,d,!1)+4,d.push(E-X*$,I-q*$),d.push(Wt,Jt)):(d.push(he,Bt),d.push(Wt,Jt)):(d.push(E-O*$,I-F*$),d.push(E+O*k,I+F*k),o.join===gn.ROUND?Dt?g+=kn(E,I,E+O*k,I+F*k,E+X*k,I+q*k,d,!0)+2:g+=kn(E,I,E-O*$,I-F*$,E-X*$,I-q*$,d,!1)+2:o.join===gn.MITER&&ae/w<=x&&(Dt?(d.push(Wt,Jt),d.push(Wt,Jt)):(d.push(he,Bt),d.push(he,Bt)),g+=2),d.push(E-X*$,I-q*$),d.push(E+X*k,I+q*k),g+=2)}T=n[(p-2)*2],S=n[(p-2)*2+1],E=n[(p-1)*2],I=n[(p-1)*2+1],O=-(S-I),F=T-E,V=Math.sqrt(O*O+F*F),O/=V,F/=V,O*=y,F*=y,d.push(E-O*$,I-F*$),d.push(E+O*k,I+F*k),u||(o.cap===Vn.ROUND?g+=kn(E-O*($-k)*.5,I-F*($-k)*.5,E-O*$,I-F*$,E+O*k,I+F*k,d,!1)+2:o.cap===Vn.SQUARE&&(g+=Mg(E,I,O,F,$,k,!1,d)));const lt=t.indices,pt=Hi.epsilon*Hi.epsilon;for(let j=v;j<g+v-2;++j)T=d[j*2],S=d[j*2+1],E=d[(j+1)*2],I=d[(j+1)*2+1],D=d[(j+2)*2],L=d[(j+2)*2+1],!(Math.abs(T*(I-L)+E*(L-S)+D*(S-I))<pt)&&lt.push(j,j+1,j+2)}function gB(e,t){let r=0;const n=e.shape,i=e.points||n.points,o=n.type!==xe.POLY||n.closeStroke;if(i.length===0)return;const l=t.points,h=t.indices,u=i.length/2,f=l.length/2;let d=f;for(l.push(i[0],i[1]),r=1;r<u;r++)l.push(i[r*2],i[r*2+1]),h.push(d,d+1),d++;o&&h.push(d,f)}function Dg(e,t){e.lineStyle.native?gB(e,t):pB(e,t)}class Cc{static curveLength(t,r,n,i,o,l){const h=t-2*n+o,u=r-2*i+l,f=2*n-2*t,d=2*i-2*r,p=4*(h*h+u*u),g=4*(h*f+u*d),v=f*f+d*d,y=2*Math.sqrt(p+g+v),w=Math.sqrt(p),x=2*p*w,T=2*Math.sqrt(v),S=g/w;return(x*y+w*g*(y-T)+(4*v*p-g*g)*Math.log((2*w+S+y)/(S+T)))/(4*x)}static curveTo(t,r,n,i,o){const l=o[o.length-2],h=o[o.length-1],u=Hi._segmentsCount(Cc.curveLength(l,h,t,r,n,i));let f=0,d=0;for(let p=1;p<=u;++p){const g=p/u;f=l+(t-l)*g,d=h+(r-h)*g,o.push(f+(t+(n-t)*g-f)*g,d+(r+(i-r)*g-d)*g)}}}const Qh={[xe.POLY]:Nv,[xe.CIRC]:Fa,[xe.ELIP]:Fa,[xe.RECT]:cB,[xe.RREC]:fB},Bg=[],ea=[];class La{constructor(t,r=null,n=null,i=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=n,this.fillStyle=r,this.matrix=i,this.type=t.type}clone(){return new La(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const bi=new Ct,kv=class extends Wm{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Ma,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),ea.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),Bg.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,r=null,n=null){const i=new La(e,t,r,n);return this.graphicsData.push(i),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const r=new La(e,null,null,t),n=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=n.lineStyle,n.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let r=0;r<t.length;++r){const n=t[r];if(n.fillStyle.visible&&n.shape&&(n.matrix?n.matrix.applyInverse(e,bi):bi.copyFrom(e),n.shape.contains(bi.x,bi.y))){let i=!1;if(n.holes){for(let o=0;o<n.holes.length;o++)if(n.holes[o].shape.contains(bi.x,bi.y)){i=!0;break}}if(!i)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let r=null,n=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],n=r.style);for(let h=this.shapeIndex;h<t.length;h++){this.shapeIndex++;const u=t[h],f=u.fillStyle,d=u.lineStyle;Qh[u.type].build(u),u.matrix&&this.transformPoints(u.points,u.matrix),(f.visible||d.visible)&&this.processHoles(u.holes);for(let g=0;g<2;g++){const v=g===0?f:d;if(!v.visible)continue;const y=v.texture.baseTexture,w=this.indices.length,x=this.points.length/2;y.wrapMode=_n.REPEAT,g===0?this.processFill(u):this.processLine(u);const T=this.points.length/2-x;T!==0&&(r&&!this._compareStyles(n,v)&&(r.end(w,x),r=null),r||(r=Bg.pop()||new dB,r.begin(v,w,x),this.batches.push(r),n=v),this.addUvs(this.points,e,v.texture,x,T,v.matrix))}}const i=this.indices.length,o=this.points.length/2;if(r&&r.end(i,o),this.batches.length===0){this.batchable=!0;return}const l=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&l===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=l?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const r=this.graphicsData[e],n=r.fillStyle,i=r.lineStyle;if(n&&!n.texture.baseTexture.valid||i&&!i.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,r=e.length;t<r;t++){const n=e[t];for(let i=0;i<n.size;i++){const o=n.start+i;this.indicesUint16[o]=this.indicesUint16[o]-n.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<kv.BATCHABLE_SIZE*2}buildDrawCalls(){let e=++mt._globalBatch;for(let d=0;d<this.drawCalls.length;d++)this.drawCalls[d].texArray.clear(),ea.push(this.drawCalls[d]);this.drawCalls.length=0;const t=this.colors,r=this.textureIds;let n=ea.pop();n||(n=new ku,n.texArray=new Gu),n.texArray.count=0,n.start=0,n.size=0,n.type=Br.TRIANGLES;let i=0,o=null,l=0,h=!1,u=Br.TRIANGLES,f=0;this.drawCalls.push(n);for(let d=0;d<this.batches.length;d++){const p=this.batches[d],g=8,v=p.style,y=v.texture.baseTexture;h!==!!v.native&&(h=!!v.native,u=h?Br.LINES:Br.TRIANGLES,o=null,i=g,e++),o!==y&&(o=y,y._batchEnabled!==e&&(i===g&&(e++,i=0,n.size>0&&(n=ea.pop(),n||(n=new ku,n.texArray=new Gu),this.drawCalls.push(n)),n.start=f,n.size=0,n.texArray.count=0,n.type=u),y.touched=1,y._batchEnabled=e,y._batchLocation=i,y.wrapMode=_n.REPEAT,n.texArray.elements[n.texArray.count++]=y,i++)),n.size+=p.size,f+=p.size,l=y._batchLocation,this.addColors(t,v.color,v.alpha,p.attribSize,p.attribStart),this.addTextureIds(r,l,p.attribSize,p.attribStart)}mt._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,r=this.colors,n=this.textureIds,i=new ArrayBuffer(e.length*3*4),o=new Float32Array(i),l=new Uint32Array(i);let h=0;for(let u=0;u<e.length/2;u++)o[h++]=e[u*2],o[h++]=e[u*2+1],o[h++]=t[u*2],o[h++]=t[u*2+1],l[h++]=r[u],o[h++]=n[u];this._buffer.update(i),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?Nv.triangulate(e,this):Qh[e.type].triangulate(e,this)}processLine(e){Dg(e,this);for(let t=0;t<e.holes.length;t++)Dg(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const r=e[t];Qh[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let r=0;r<e.length/2;r++){const n=e[r*2],i=e[r*2+1];e[r*2]=t.a*n+t.c*i+t.tx,e[r*2+1]=t.b*n+t.d*i+t.ty}}addColors(e,t,r,n,i=0){const o=(t>>16)+(t&65280)+((t&255)<<16),l=_c(o,r);e.length=Math.max(e.length,i+n);for(let h=0;h<n;h++)e[i+h]=l}addTextureIds(e,t,r,n=0){e.length=Math.max(e.length,n+r);for(let i=0;i<r;i++)e[n+i]=t}addUvs(e,t,r,n,i,o=null){let l=0;const h=t.length,u=r.frame;for(;l<i;){let d=e[(n+l)*2],p=e[(n+l)*2+1];if(o){const g=o.a*d+o.c*p+o.tx;p=o.b*d+o.d*p+o.ty,d=g}l++,t.push(d/u.width,p/u.height)}const f=r.baseTexture;(u.width<f.width||u.height<f.height)&&this.adjustUvs(t,r,h,i)}adjustUvs(e,t,r,n){const i=t.baseTexture,o=1e-6,l=r+n*2,h=t.frame,u=h.width/i.width,f=h.height/i.height;let d=h.x/h.width,p=h.y/h.height,g=Math.floor(e[r]+o),v=Math.floor(e[r+1]+o);for(let y=r+2;y<l;y+=2)g=Math.min(g,Math.floor(e[y]+o)),v=Math.min(v,Math.floor(e[y+1]+o));d-=g,p-=v;for(let y=r;y<l;y+=2)e[y]=(e[y]+d)*u,e[y+1]=(e[y+1]+p)*f}};let Uv=kv;Uv.BATCHABLE_SIZE=100;class Ka{constructor(){this.color=16777215,this.alpha=1,this.texture=it.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Ka;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=it.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Ic extends Ka{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Vn.BUTT,this.join=gn.MITER,this.miterLimit=10}clone(){const t=new Ic;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const mB=new Float32Array(3),tu={},ya=class extends Xe{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Ka,this._lineStyle=new Ic,this._matrix=null,this._holeMode=!1,this.state=rn.for2d(),this._geometry=e||new Uv,this._geometry.refCount++,this._transformID=-1,this.tint=16777215,this.blendMode=ct.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new ya(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tint}set tint(e){this._tint=e}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,r=1,n=.5,i=!1){return typeof e=="number"&&(e={width:e,color:t,alpha:r,alignment:n,native:i}),this.lineTextureStyle(e)}lineTextureStyle(e){e=Object.assign({width:0,texture:it.WHITE,color:e!=null&&e.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:Vn.BUTT,join:gn.MITER,miterLimit:10},e),this.currentPath&&this.startPoly();const t=e.width>0&&e.alpha>0;return t?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:t},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new Ni,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new Ni,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const r=this.currentPath.points,n=r[r.length-2],i=r[r.length-1];return(n!==e||i!==t)&&r.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,r,n){this._initCurve();const i=this.currentPath.points;return i.length===0&&this.moveTo(0,0),Cc.curveTo(e,t,r,n,i),this}bezierCurveTo(e,t,r,n,i,o){return this._initCurve(),Sc.curveTo(e,t,r,n,i,o,this.currentPath.points),this}arcTo(e,t,r,n,i){this._initCurve(e,t);const o=this.currentPath.points,l=Rg.curveTo(e,t,r,n,i,o);if(l){const{cx:h,cy:u,radius:f,startAngle:d,endAngle:p,anticlockwise:g}=l;this.arc(h,u,f,d,p,g)}return this}arc(e,t,r,n,i,o=!1){if(n===i)return this;if(!o&&i<=n?i+=Ra:o&&n<=i&&(n+=Ra),i-n===0)return this;const h=e+Math.cos(n)*r,u=t+Math.sin(n)*r,f=this._geometry.closePointEps;let d=this.currentPath?this.currentPath.points:null;if(d){const p=Math.abs(d[d.length-2]-h),g=Math.abs(d[d.length-1]-u);p<f&&g<f||d.push(h,u)}else this.moveTo(h,u),d=this.currentPath.points;return Rg.arc(h,u,e,t,r,n,i,o,d),this}beginFill(e=0,t=1){return this.beginTextureFill({texture:it.WHITE,color:e,alpha:t})}beginTextureFill(e){e=Object.assign({texture:it.WHITE,color:16777215,alpha:1,matrix:null},e),this.currentPath&&this.startPoly();const t=e.alpha>0;return t?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:t},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,r,n){return this.drawShape(new At(e,t,r,n))}drawRoundedRect(e,t,r,n,i){return this.drawShape(new wc(e,t,r,n,i))}drawCircle(e,t,r){return this.drawShape(new xc(e,t,r))}drawEllipse(e,t,r,n){return this.drawShape(new bc(e,t,r,n))}drawPolygon(...e){let t,r=!0;const n=e[0];n.points?(r=n.closeStroke,t=n.points):Array.isArray(e[0])?t=e[0]:t=e;const i=new Ni(t);return i.closeStroke=r,this.drawShape(i),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return e.length===1&&e[0].shape.type===xe.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,r=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(e.points);for(let n=0;n<r;n++){const i=e.batches[n],o=i.style.color,l=new Float32Array(this.vertexData.buffer,i.attribStart*4*2,i.attribSize*2),h=new Float32Array(e.uvsFloat32.buffer,i.attribStart*4*2,i.attribSize*2),u=new Uint16Array(e.indicesUint16.buffer,i.start*2,i.size),f={vertexData:l,blendMode:t,indices:u,uvs:h,_batchRGB:Fs(o),_tintRGB:o,_texture:i.style.texture,alpha:i.style.alpha,worldAlpha:1};this.batches[n]=f}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,r=this.batches.length;t<r;t++){const n=this.batches[t];n.worldAlpha=this.worldAlpha*n.alpha,e.plugins[this.pluginName].render(n)}}}_renderDirect(e){const t=this._resolveDirectShader(e),r=this._geometry,n=this.tint,i=this.worldAlpha,o=t.uniforms,l=r.drawCalls;o.translationMatrix=this.transform.worldTransform,o.tint[0]=(n>>16&255)/255*i,o.tint[1]=(n>>8&255)/255*i,o.tint[2]=(n&255)/255*i,o.tint[3]=i,e.shader.bind(t),e.geometry.bind(r,t),e.state.set(this.state);for(let h=0,u=l.length;h<u;h++)this._renderDrawCallDirect(e,r.drawCalls[h])}_renderDrawCallDirect(e,t){const{texArray:r,type:n,size:i,start:o}=t,l=r.count;for(let h=0;h<l;h++)e.texture.bind(r.elements[h],h);e.geometry.draw(n,i,o)}_resolveDirectShader(e){let t=this.shader;const r=this.pluginName;if(!t){if(!tu[r]){const{maxTextures:n}=e.plugins[r],i=new Int32Array(n);for(let h=0;h<n;h++)i[h]=h;const o={tint:new Float32Array([1,1,1,1]),translationMatrix:new Vt,default:br.from({uSamplers:i},!0)},l=e.plugins[r]._shader.program;tu[r]=new Fr(l,o)}t=tu[r]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:r,maxX:n,maxY:i}=e.bounds;this._bounds.addFrame(this.transform,t,r,n,i)}containsPoint(e){return this.worldTransform.applyInverse(e,ya._TEMP_POINT),this._geometry.containsPoint(ya._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;const e=Fs(this.tint,mB);for(let t=0;t<this.batches.length;t++){const r=this.batches[t],n=r._batchRGB,i=e[0]*n[0]*255,o=e[1]*n[1]*255,l=e[2]*n[2]*255,h=(i<<16)+(o<<8)+(l|0);r._tintRGB=(h>>16)+(h&65280)+((h&255)<<16)}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,r=t.a,n=t.b,i=t.c,o=t.d,l=t.tx,h=t.ty,u=this._geometry.points,f=this.vertexData;let d=0;for(let p=0;p<u.length;p+=2){const g=u[p],v=u[p+1];f[d++]=r*g+i*v+l,f[d++]=o*v+n*g+h}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};let Za=ya;Za.curves=Hi;Za._TEMP_POINT=new Ct;class vB{constructor(t,r){this.uvBuffer=t,this.uvMatrix=r,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const r=this.uvBuffer.data;(!this.data||this.data.length!==r.length)&&(this.data=new Float32Array(r.length)),this.uvMatrix.multiplyUvs(r,this.data),this._updateID++}}const eu=new Ct,Og=new Ni,Gv=class extends Xe{constructor(e,t,r,n=Br.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=r||rn.for2d(),this.drawMode=n,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=Q.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(e){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Br.TRIANGLES&&t.length<Gv.BATCHABLE_SIZE*2?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;const n=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[n]),e.plugins[n].render(this)}calculateVertices(){const t=this.geometry.buffers[0],r=t.data,n=t._updateID;if(n===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==r.length&&(this.vertexData=new Float32Array(r.length));const i=this.transform.worldTransform,o=i.a,l=i.b,h=i.c,u=i.d,f=i.tx,d=i.ty,p=this.vertexData;for(let g=0;g<p.length/2;g++){const v=r[g*2],y=r[g*2+1];p[g*2]=o*v+h*y+f,p[g*2+1]=l*v+u*y+d}if(this._roundPixels){const g=Q.RESOLUTION;for(let v=0;v<p.length;++v)p[v]=Math.round(p[v]*g)/g}this.vertexDirty=n}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new vB(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,eu);const t=this.geometry.getBuffer("aVertexPosition").data,r=Og.points,n=this.geometry.getIndex().data,i=n.length,o=this.drawMode===4?3:1;for(let l=0;l+2<i;l+=o){const h=n[l]*2,u=n[l+1]*2,f=n[l+2]*2;if(r[0]=t[h],r[1]=t[h+1],r[2]=t[u],r[3]=t[u+1],r[4]=t[f],r[5]=t[f+1],Og.contains(eu.x,eu.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let Ju=Gv;Ju.BATCHABLE_SIZE=100;class yB extends bn{constructor(t,r,n){super();const i=new se(t),o=new se(r,!0),l=new se(n,!0,!0);this.addAttribute("aVertexPosition",i,2,!1,ot.FLOAT).addAttribute("aTextureCoord",o,2,!1,ot.FLOAT).addIndex(l),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var _B=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,xB=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class Fg extends Fr{constructor(t,r){const n={uSampler:t,alpha:1,uTextureMatrix:Vt.IDENTITY,uColor:new Float32Array([1,1,1,1])};r=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},r),r.uniforms&&Object.assign(n,r.uniforms),super(r.program||vr.from(xB,_B),n),this._colorDirty=!1,this.uvMatrix=new ov(t),this.batchable=r.program===void 0,this.pluginName=r.pluginName,this.tint=r.tint,this.alpha=r.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16),this._colorDirty=!0)}get tint(){return this._tint}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture;km(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Lg{constructor(t,r,n){this.geometry=new bn,this.indexBuffer=null,this.size=n,this.dynamicProperties=[],this.staticProperties=[];for(let i=0;i<t.length;++i){let o=t[i];o={attributeName:o.attributeName,size:o.size,uploadFunction:o.uploadFunction,type:o.type||ot.FLOAT,offset:o.offset},r[i]?this.dynamicProperties.push(o):this.staticProperties.push(o)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let r=0;this.indexBuffer=new se(cR(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let l=0;l<this.dynamicProperties.length;++l){const h=this.dynamicProperties[l];h.offset=r,r+=h.size,this.dynamicStride+=h.size}const n=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(n),this.dynamicDataUint32=new Uint32Array(n),this.dynamicBuffer=new se(this.dynamicData,!1,!1);let i=0;this.staticStride=0;for(let l=0;l<this.staticProperties.length;++l){const h=this.staticProperties[l];h.offset=i,i+=h.size,this.staticStride+=h.size}const o=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(o),this.staticDataUint32=new Uint32Array(o),this.staticBuffer=new se(this.staticData,!0,!1);for(let l=0;l<this.dynamicProperties.length;++l){const h=this.dynamicProperties[l];t.addAttribute(h.attributeName,this.dynamicBuffer,0,h.type===ot.UNSIGNED_BYTE,h.type,this.dynamicStride*4,h.offset*4)}for(let l=0;l<this.staticProperties.length;++l){const h=this.staticProperties[l];t.addAttribute(h.attributeName,this.staticBuffer,0,h.type===ot.UNSIGNED_BYTE,h.type,this.staticStride*4,h.offset*4)}}uploadDynamic(t,r,n){for(let i=0;i<this.dynamicProperties.length;i++){const o=this.dynamicProperties[i];o.uploadFunction(t,r,n,o.type===ot.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,o.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,r,n){for(let i=0;i<this.staticProperties.length;i++){const o=this.staticProperties[i];o.uploadFunction(t,r,n,o.type===ot.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,o.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var bB=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,wB=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class $v extends Ya{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new Vt,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:ot.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Fr.from(wB,bB,{}),this.state=rn.for2d()}render(t){const r=t.children,n=t._maxSize,i=t._batchSize,o=this.renderer;let l=r.length;if(l===0)return;l>n&&!t.autoResize&&(l=n);let h=t._buffers;h||(h=t._buffers=this.generateBuffers(t));const u=r[0]._texture.baseTexture,f=u.alphaMode>0;this.state.blendMode=Nm(t.blendMode,f),o.state.set(this.state);const d=o.gl,p=t.worldTransform.copyTo(this.tempMatrix);p.prepend(o.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=p.toArray(!0),this.shader.uniforms.uColor=uR(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,f),this.shader.uniforms.uSampler=u,this.renderer.shader.bind(this.shader);let g=!1;for(let v=0,y=0;v<l;v+=i,y+=1){let w=l-v;w>i&&(w=i),y>=h.length&&h.push(this._generateOneMoreBuffer(t));const x=h[y];x.uploadDynamic(r,v,w);const T=t._bufferUpdateIDs[y]||0;g=g||x._updateID<T,g&&(x._updateID=t._updateID,x.uploadStatic(r,v,w)),o.geometry.bind(x.geometry),d.drawElements(d.TRIANGLES,w*6,d.UNSIGNED_SHORT,0)}}generateBuffers(t){const r=[],n=t._maxSize,i=t._batchSize,o=t._properties;for(let l=0;l<n;l+=i)r.push(new Lg(this.properties,o,i));return r}_generateOneMoreBuffer(t){const r=t._batchSize,n=t._properties;return new Lg(this.properties,n,r)}uploadVertices(t,r,n,i,o,l){let h=0,u=0,f=0,d=0;for(let p=0;p<n;++p){const g=t[r+p],v=g._texture,y=g.scale.x,w=g.scale.y,x=v.trim,T=v.orig;x?(u=x.x-g.anchor.x*T.width,h=u+x.width,d=x.y-g.anchor.y*T.height,f=d+x.height):(h=T.width*(1-g.anchor.x),u=T.width*-g.anchor.x,f=T.height*(1-g.anchor.y),d=T.height*-g.anchor.y),i[l]=u*y,i[l+1]=d*w,i[l+o]=h*y,i[l+o+1]=d*w,i[l+o*2]=h*y,i[l+o*2+1]=f*w,i[l+o*3]=u*y,i[l+o*3+1]=f*w,l+=o*4}}uploadPosition(t,r,n,i,o,l){for(let h=0;h<n;h++){const u=t[r+h].position;i[l]=u.x,i[l+1]=u.y,i[l+o]=u.x,i[l+o+1]=u.y,i[l+o*2]=u.x,i[l+o*2+1]=u.y,i[l+o*3]=u.x,i[l+o*3+1]=u.y,l+=o*4}}uploadRotation(t,r,n,i,o,l){for(let h=0;h<n;h++){const u=t[r+h].rotation;i[l]=u,i[l+o]=u,i[l+o*2]=u,i[l+o*3]=u,l+=o*4}}uploadUvs(t,r,n,i,o,l){for(let h=0;h<n;++h){const u=t[r+h]._texture._uvs;u?(i[l]=u.x0,i[l+1]=u.y0,i[l+o]=u.x1,i[l+o+1]=u.y1,i[l+o*2]=u.x2,i[l+o*2+1]=u.y2,i[l+o*3]=u.x3,i[l+o*3+1]=u.y3,l+=o*4):(i[l]=0,i[l+1]=0,i[l+o]=0,i[l+o+1]=0,i[l+o*2]=0,i[l+o*2+1]=0,i[l+o*3]=0,i[l+o*3+1]=0,l+=o*4)}}uploadTint(t,r,n,i,o,l){for(let h=0;h<n;++h){const u=t[r+h],f=u._texture.baseTexture.alphaMode>0,d=u.alpha,p=d<1&&f?_c(u._tintRGB,d):u._tintRGB+(d*255<<24);i[l]=p,i[l+o]=p,i[l+o*2]=p,i[l+o*3]=p,l+=o*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}$v.extension={name:"particle",type:J.RendererPlugin};st.add($v);var Ja=(e=>(e[e.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",e[e.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",e))(Ja||{});const ra={willReadFrequently:!0},rt=class{static get experimentalLetterSpacingSupported(){let e=rt._experimentalLetterSpacingSupported;if(e!==void 0){const t=Q.ADAPTER.getCanvasRenderingContext2D().prototype;e=rt._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,r,n,i,o,l,h,u){this.text=e,this.style=t,this.width=r,this.height=n,this.lines=i,this.lineWidths=o,this.lineHeight=l,this.maxLineWidth=h,this.fontProperties=u}static measureText(e,t,r,n=rt._canvas){r=r??t.wordWrap;const i=t.toFontString(),o=rt.measureFont(i);o.fontSize===0&&(o.fontSize=t.fontSize,o.ascent=t.fontSize);const l=n.getContext("2d",ra);l.font=i;const u=(r?rt.wordWrap(e,t,n):e).split(/(?:\r\n|\r|\n)/),f=new Array(u.length);let d=0;for(let y=0;y<u.length;y++){const w=rt._measureText(u[y],t.letterSpacing,l);f[y]=w,d=Math.max(d,w)}let p=d+t.strokeThickness;t.dropShadow&&(p+=t.dropShadowDistance);const g=t.lineHeight||o.fontSize+t.strokeThickness;let v=Math.max(g,o.fontSize+t.strokeThickness*2)+(u.length-1)*(g+t.leading);return t.dropShadow&&(v+=t.dropShadowDistance),new rt(e,t,p,v,u,f,g+t.leading,d,o)}static _measureText(e,t,r){let n=!1;rt.experimentalLetterSpacingSupported&&(rt.experimentalLetterSpacing?(r.letterSpacing=`${t}px`,r.textLetterSpacing=`${t}px`,n=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let i=r.measureText(e).width;return i>0&&(n?i-=t:i+=(rt.graphemeSegmenter(e).length-1)*t),i}static wordWrap(e,t,r=rt._canvas){const n=r.getContext("2d",ra);let i=0,o="",l="";const h=Object.create(null),{letterSpacing:u,whiteSpace:f}=t,d=rt.collapseSpaces(f),p=rt.collapseNewlines(f);let g=!d;const v=t.wordWrapWidth+u,y=rt.tokenize(e);for(let w=0;w<y.length;w++){let x=y[w];if(rt.isNewline(x)){if(!p){l+=rt.addLine(o),g=!d,o="",i=0;continue}x=" "}if(d){const S=rt.isBreakingSpace(x),E=rt.isBreakingSpace(o[o.length-1]);if(S&&E)continue}const T=rt.getFromCache(x,u,h,n);if(T>v)if(o!==""&&(l+=rt.addLine(o),o="",i=0),rt.canBreakWords(x,t.breakWords)){const S=rt.wordWrapSplit(x);for(let E=0;E<S.length;E++){let I=S[E],D=I,L=1;for(;S[E+L];){const F=S[E+L];if(!rt.canBreakChars(D,F,x,E,t.breakWords))I+=F;else break;D=F,L++}E+=L-1;const O=rt.getFromCache(I,u,h,n);O+i>v&&(l+=rt.addLine(o),g=!1,o="",i=0),o+=I,i+=O}}else{o.length>0&&(l+=rt.addLine(o),o="",i=0);const S=w===y.length-1;l+=rt.addLine(x,!S),g=!1,o="",i=0}else T+i>v&&(g=!1,l+=rt.addLine(o),o="",i=0),(o.length>0||!rt.isBreakingSpace(x)||g)&&(o+=x,i+=T)}return l+=rt.addLine(o,!1),l}static addLine(e,t=!0){return e=rt.trimRight(e),e=t?`${e}
`:e,e}static getFromCache(e,t,r,n){let i=r[e];return typeof i!="number"&&(i=rt._measureText(e,t,n)+t,r[e]=i),i}static collapseSpaces(e){return e==="normal"||e==="pre-line"}static collapseNewlines(e){return e==="normal"}static trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){const r=e[t];if(!rt.isBreakingSpace(r))break;e=e.slice(0,-1)}return e}static isNewline(e){return typeof e!="string"?!1:rt._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return typeof e!="string"?!1:rt._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const t=[];let r="";if(typeof e!="string")return t;for(let n=0;n<e.length;n++){const i=e[n],o=e[n+1];if(rt.isBreakingSpace(i,o)||rt.isNewline(i)){r!==""&&(t.push(r),r=""),t.push(i);continue}r+=i}return r!==""&&t.push(r),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,r,n,i){return!0}static wordWrapSplit(e){return rt.graphemeSegmenter(e)}static measureFont(e){if(rt._fonts[e])return rt._fonts[e];const t={ascent:0,descent:0,fontSize:0},r=rt._canvas,n=rt._context;n.font=e;const i=rt.METRICS_STRING+rt.BASELINE_SYMBOL,o=Math.ceil(n.measureText(i).width);let l=Math.ceil(n.measureText(rt.BASELINE_SYMBOL).width);const h=Math.ceil(rt.HEIGHT_MULTIPLIER*l);if(l=l*rt.BASELINE_MULTIPLIER|0,o===0||h===0)return rt._fonts[e]=t,t;r.width=o,r.height=h,n.fillStyle="#f00",n.fillRect(0,0,o,h),n.font=e,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(i,0,l);const u=n.getImageData(0,0,o,h).data,f=u.length,d=o*4;let p=0,g=0,v=!1;for(p=0;p<l;++p){for(let y=0;y<d;y+=4)if(u[g+y]!==255){v=!0;break}if(!v)g+=d;else break}for(t.ascent=l-p,g=f-d,v=!1,p=h;p>l;--p){for(let y=0;y<d;y+=4)if(u[g+y]!==255){v=!0;break}if(!v)g-=d;else break}return t.descent=p-l,t.fontSize=t.ascent+t.descent,rt._fonts[e]=t,t}static clearMetrics(e=""){e?delete rt._fonts[e]:rt._fonts={}}static get _canvas(){if(!rt.__canvas){let e;try{const t=new OffscreenCanvas(0,0),r=t.getContext("2d",ra);if(r!=null&&r.measureText)return rt.__canvas=t,t;e=Q.ADAPTER.createCanvas()}catch{e=Q.ADAPTER.createCanvas()}e.width=e.height=10,rt.__canvas=e}return rt.__canvas}static get _context(){return rt.__context||(rt.__context=rt._canvas.getContext("2d",ra)),rt.__context}};let _e=rt;_e.METRICS_STRING="|ÉqÅ";_e.BASELINE_SYMBOL="M";_e.BASELINE_MULTIPLIER=1.4;_e.HEIGHT_MULTIPLIER=2;_e.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const e=new Intl.Segmenter;return t=>[...e.segment(t)].map(r=>r.segment)}return e=>[...e]})();_e.experimentalLetterSpacing=!1;_e._fonts={};_e._newlines=[10,13];_e._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const EB=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],As=class{constructor(e){this.styleID=0,this.reset(),nu(this,e,e)}clone(){const e={};return nu(e,this,As.defaultStyle),new As(e)}reset(){nu(this,As.defaultStyle,As.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=ru(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=ru(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){TB(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=ru(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let r=t.length-1;r>=0;r--){let n=t[r].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!EB.includes(n)&&(n=`"${n}"`),t[r]=n}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};let Qn=As;Qn.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Ja.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};function Ng(e){return typeof e=="number"?Fm(e):(typeof e=="string"&&e.startsWith("0x")&&(e=e.replace("0x","#")),e)}function ru(e){if(Array.isArray(e)){for(let t=0;t<e.length;++t)e[t]=Ng(e[t]);return e}else return Ng(e)}function TB(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}function nu(e,t,r){for(const n in r)Array.isArray(t[n])?e[n]=t[n].slice():e[n]=t[n]}const AB={texture:!0,children:!1,baseTexture:!0},Qu=class extends Zi{constructor(e,t,r){let n=!1;r||(r=Q.ADAPTER.createCanvas(),n=!0),r.width=3,r.height=3;const i=it.from(r);i.orig=new At,i.trim=new At,super(i),this._ownCanvas=n,this.canvas=r,this.context=r.getContext("2d",{willReadFrequently:!0}),this._resolution=Qu.defaultResolution??Q.RESOLUTION,this._autoResolution=Qu.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return _e.experimentalLetterSpacing}static set experimentalLetterSpacing(e){It("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),_e.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const r=this.context,n=_e.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),i=n.width,o=n.height,l=n.lines,h=n.lineHeight,u=n.lineWidths,f=n.maxLineWidth,d=n.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,i)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+t.padding*2)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=t.strokeThickness,r.textBaseline=t.textBaseline,r.lineJoin=t.lineJoin,r.miterLimit=t.miterLimit;let p,g;const v=t.dropShadow?2:1;for(let y=0;y<v;++y){const w=t.dropShadow&&y===0,x=w?Math.ceil(Math.max(1,o)+t.padding*2):0,T=x*this._resolution;if(w){r.fillStyle="black",r.strokeStyle="black";const E=t.dropShadowColor,I=Fs(typeof E=="number"?E:yc(E)),D=t.dropShadowBlur*this._resolution,L=t.dropShadowDistance*this._resolution;r.shadowColor=`rgba(${I[0]*255},${I[1]*255},${I[2]*255},${t.dropShadowAlpha})`,r.shadowBlur=D,r.shadowOffsetX=Math.cos(t.dropShadowAngle)*L,r.shadowOffsetY=Math.sin(t.dropShadowAngle)*L+T}else r.fillStyle=this._generateFillStyle(t,l,n),r.strokeStyle=t.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;let S=(h-d.fontSize)/2;h-d.fontSize<0&&(S=0);for(let E=0;E<l.length;E++)p=t.strokeThickness/2,g=t.strokeThickness/2+E*h+d.ascent+S,t.align==="right"?p+=f-u[E]:t.align==="center"&&(p+=(f-u[E])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(l[E],p+t.padding,g+t.padding-x,!0),t.fill&&this.drawLetterSpacing(l[E],p+t.padding,g+t.padding-x)}this.updateTexture()}drawLetterSpacing(e,t,r,n=!1){const o=this._style.letterSpacing;let l=!1;if(_e.experimentalLetterSpacingSupported&&(_e.experimentalLetterSpacing?(this.context.letterSpacing=`${o}px`,this.context.textLetterSpacing=`${o}px`,l=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),o===0||l){n?this.context.strokeText(e,t,r):this.context.fillText(e,t,r);return}let h=t;const u=_e.graphemeSegmenter(e);let f=this.context.measureText(e).width,d=0;for(let p=0;p<u.length;++p){const g=u[p];n?this.context.strokeText(g,h,r):this.context.fillText(g,h,r);let v="";for(let y=p+1;y<u.length;++y)v+=u[y];d=this.context.measureText(v).width,h+=f-d+o,f=d}}updateTexture(){const e=this.canvas;if(this._style.trim){const o=pR(e);o.data&&(e.width=o.width,e.height=o.height,this.context.putImageData(o.data,0,0))}const t=this._texture,r=this._style,n=r.trim?0:r.padding,i=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-n,t.trim.y=-n,t.orig.width=t._frame.width-n*2,t.orig.height=t._frame.height-n*2,this._onTextureUpdate(),i.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),this._textureID===-1&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,r){const n=e.fill;if(Array.isArray(n)){if(n.length===1)return n[0]}else return n;let i;const o=e.dropShadow?e.dropShadowDistance:0,l=e.padding||0,h=this.canvas.width/this._resolution-o-l*2,u=this.canvas.height/this._resolution-o-l*2,f=n.slice(),d=e.fillGradientStops.slice();if(!d.length){const p=f.length+1;for(let g=1;g<p;++g)d.push(g/p)}if(f.unshift(n[0]),d.unshift(0),f.push(n[n.length-1]),d.push(1),e.fillGradientType===Ja.LINEAR_VERTICAL){i=this.context.createLinearGradient(h/2,l,h/2,u+l);const p=r.fontProperties.fontSize+e.strokeThickness;for(let g=0;g<t.length;g++){const v=r.lineHeight*(g-1)+p,y=r.lineHeight*g;let w=y;g>0&&v>y&&(w=(y+v)/2);const x=y+p,T=r.lineHeight*(g+1);let S=x;g+1<t.length&&T<x&&(S=(x+T)/2);const E=(S-w)/u;for(let I=0;I<f.length;I++){let D=0;typeof d[I]=="number"?D=d[I]:D=I/f.length;let L=Math.min(1,Math.max(0,w/u+D*E));L=Number(L.toFixed(5)),i.addColorStop(L,f[I])}}}else{i=this.context.createLinearGradient(l,u/2,h+l,u/2);const p=f.length+1;let g=1;for(let v=0;v<f.length;v++){let y;typeof d[v]=="number"?y=d[v]:y=g/p,i.addColorStop(y,f[v]),g++}}return i}destroy(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},AB,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=Pi(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=Pi(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},e instanceof Qn?this._style=e:this._style=new Qn(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};let Pc=Qu;Pc.defaultAutoResolution=!0;class SB{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function CB(e,t){var n;let r=!1;if((n=e==null?void 0:e._textures)!=null&&n.length){for(let i=0;i<e._textures.length;i++)if(e._textures[i]instanceof it){const o=e._textures[i].baseTexture;t.includes(o)||(t.push(o),r=!0)}}return r}function IB(e,t){if(e.baseTexture instanceof mt){const r=e.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function PB(e,t){if(e._texture&&e._texture instanceof it){const r=e._texture.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function RB(e,t){return t instanceof Pc?(t.updateText(!0),!0):!1}function MB(e,t){if(t instanceof Qn){const r=t.toFontString();return _e.measureFont(r),!0}return!1}function DB(e,t){if(e instanceof Pc){t.includes(e.style)||t.push(e.style),t.includes(e)||t.push(e);const r=e._texture.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function BB(e,t){return e instanceof Qn?(t.includes(e)||t.push(e),!0):!1}const Wv=class{constructor(e){this.limiter=new SB(Wv.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(DB),this.registerFindHook(BB),this.registerFindHook(CB),this.registerFindHook(IB),this.registerFindHook(PB),this.registerUploadHook(RB),this.registerUploadHook(MB)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,Le.system.addOnce(this.tick,this,Wi.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed){for(let r=0,n=this.uploadHooks.length;r<n;r++)if(this.uploadHooks[r](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)Le.system.addOnce(this.tick,this,Wi.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,r=e.length;t<r;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,r=this.addHooks.length;t<r&&!this.addHooks[t](e,this.queue);t++);if(e instanceof Xe)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&Le.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let Na=Wv;Na.uploadsPerFrame=4;Object.defineProperties(Q,{UPLOADS_PER_FRAME:{get(){return Na.uploadsPerFrame},set(e){It("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Na.uploadsPerFrame=e}}});function Hv(e,t){return t instanceof mt?(t._glTextures[e.CONTEXT_UID]||e.texture.bind(t),!0):!1}function OB(e,t){if(!(t instanceof Za))return!1;const{geometry:r}=t;t.finishPoly(),r.updateBatches();const{batches:n}=r;for(let i=0;i<n.length;i++){const{texture:o}=n[i].style;o&&Hv(e,o.baseTexture)}return r.batchable||e.geometry.bind(r,t._resolveDirectShader(e)),!0}function FB(e,t){return e instanceof Za?(t.push(e),!0):!1}class zv extends Na{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(FB),this.registerUploadHook(Hv),this.registerUploadHook(OB)}}zv.extension={name:"prepare",type:J.RendererSystem};st.add(zv);var LB=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,NB=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,kB=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,kg=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,UB=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const na=new Vt;class Xv extends Ya{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new rv,this.state=rn.for2d()}contextChange(){const t=this.renderer,r={globals:t.globalUniforms};this.simpleShader=Fr.from(kg,UB,r),this.shader=t.context.webGLVersion>1?Fr.from(NB,LB,r):Fr.from(kg,kB,r)}render(t){const r=this.renderer,n=this.quad;let i=n.vertices;i[0]=i[6]=t._width*-t.anchor.x,i[1]=i[3]=t._height*-t.anchor.y,i[2]=i[4]=t._width*(1-t.anchor.x),i[5]=i[7]=t._height*(1-t.anchor.y);const o=t.uvRespectAnchor?t.anchor.x:0,l=t.uvRespectAnchor?t.anchor.y:0;i=n.uvs,i[0]=i[6]=-o,i[1]=i[3]=-l,i[2]=i[4]=1-o,i[5]=i[7]=1-l,n.invalidate();const h=t._texture,u=h.baseTexture,f=u.alphaMode>0,d=t.tileTransform.localTransform,p=t.uvMatrix;let g=u.isPowerOfTwo&&h.frame.width===u.width&&h.frame.height===u.height;g&&(u._glTextures[r.CONTEXT_UID]?g=u.wrapMode!==_n.CLAMP:u.wrapMode===_n.CLAMP&&(u.wrapMode=_n.REPEAT));const v=g?this.simpleShader:this.shader,y=h.width,w=h.height,x=t._width,T=t._height;na.set(d.a*y/x,d.b*y/T,d.c*w/x,d.d*w/T,d.tx/x,d.ty/T),na.invert(),g?na.prepend(p.mapCoord):(v.uniforms.uMapCoord=p.mapCoord.toArray(!0),v.uniforms.uClampFrame=p.uClampFrame,v.uniforms.uClampOffset=p.uClampOffset),v.uniforms.uTransform=na.toArray(!0),v.uniforms.uColor=km(t.tint,t.worldAlpha,v.uniforms.uColor,f),v.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),v.uniforms.uSampler=h,r.shader.bind(v),r.geometry.bind(n),this.state.blendMode=Nm(t.blendMode,f),r.state.set(this.state),r.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Xv.extension={name:"tilingSprite",type:J.RendererPlugin};st.add(Xv);const Ss=class{constructor(e,t,r=null){this.linkedSheets=[],this._texture=e instanceof it?e:null,this.baseTexture=e instanceof mt?e:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;const n=this.baseTexture.resource;this.resolution=this._updateResolution(r||(n?n.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:t}=this.data.meta;let r=xn(e,null);return r===null&&(r=parseFloat(t??"1")),r!==1&&this.baseTexture.setResolution(r),r}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=Ss.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e;const r=Ss.BATCH_SIZE;for(;t-e<r&&t<this._frameKeys.length;){const n=this._frameKeys[t],i=this._frames[n],o=i.frame;if(o){let l=null,h=null;const u=i.trimmed!==!1&&i.sourceSize?i.sourceSize:i.frame,f=new At(0,0,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution);i.rotated?l=new At(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):l=new At(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),i.trimmed!==!1&&i.spriteSourceSize&&(h=new At(Math.floor(i.spriteSourceSize.x)/this.resolution,Math.floor(i.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[n]=new it(this.baseTexture,l,f,h,i.rotated?2:0,i.anchor),it.addToCache(this.textures[n],n)}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let r=0;r<e[t].length;r++){const n=e[t][r];this.animations[t].push(this.textures[n])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Ss.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Ss.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){var t;for(const r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let tc=Ss;tc.BATCH_SIZE=1e3;const GB=["jpg","png","jpeg","avif","webp"];function Vv(e,t,r){const n={};if(e.forEach(i=>{n[i]=t}),Object.keys(t.textures).forEach(i=>{n[i]=t.textures[i]}),!r){const i=be.dirname(e[0]);t.linkedSheets.forEach((o,l)=>{const h=Vv([`${i}/${t.data.meta.related_multi_packs[l]}`],o,!0);Object.assign(n,h)})}return n}const $B={extension:J.Asset,cache:{test:e=>e instanceof tc,getCacheableAssets:(e,t)=>Vv(e,t,!1)},resolver:{test:e=>{const r=e.split("?")[0].split("."),n=r.pop(),i=r.pop();return n==="json"&&GB.includes(i)},parse:e=>{var r;const t=e.split(".");return{resolution:parseFloat(((r=Q.RETINA_PREFIX.exec(e))==null?void 0:r[1])??"1"),format:t[t.length-2],src:e}}},loader:{extension:{type:J.LoadParser,priority:Nr.Normal},async testParse(e,t){return be.extname(t.src).toLowerCase()===".json"&&!!e.frames},async parse(e,t,r){var f,d;let n=be.dirname(t.src);n&&n.lastIndexOf("/")!==n.length-1&&(n+="/");const i=n+e.meta.image,l=(await r.load([i]))[i],h=new tc(l.baseTexture,e,t.src);await h.parse();const u=(f=e==null?void 0:e.meta)==null?void 0:f.related_multi_packs;if(Array.isArray(u)){const p=[];for(const v of u){if(typeof v!="string")continue;const y=n+v;(d=t.data)!=null&&d.ignoreMultiPack||p.push(r.load({src:y,data:{ignoreMultiPack:!0}}))}const g=await Promise.all(p);h.linkedSheets=g,g.forEach(v=>{v.linkedSheets=[h].concat(h.linkedSheets.filter(y=>y!==v))})}return h},unload(e){e.destroy(!0)}}};st.add($B);class ka{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class _a{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const r=t.match(/^[a-z]+\s+.+$/gm),n={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const o in r){const l=r[o].match(/^[a-z]+/gm)[0],h=r[o].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),u={};for(const f in h){const d=h[f].split("="),p=d[0],g=d[1].replace(/"/gm,""),v=parseFloat(g),y=isNaN(v)?g:v;u[p]=y}n[l].push(u)}const i=new ka;return n.info.forEach(o=>i.info.push({face:o.face,size:parseInt(o.size,10)})),n.common.forEach(o=>i.common.push({lineHeight:parseInt(o.lineHeight,10)})),n.page.forEach(o=>i.page.push({id:parseInt(o.id,10),file:o.file})),n.char.forEach(o=>i.char.push({id:parseInt(o.id,10),page:parseInt(o.page,10),x:parseInt(o.x,10),y:parseInt(o.y,10),width:parseInt(o.width,10),height:parseInt(o.height,10),xoffset:parseInt(o.xoffset,10),yoffset:parseInt(o.yoffset,10),xadvance:parseInt(o.xadvance,10)})),n.kerning.forEach(o=>i.kerning.push({first:parseInt(o.first,10),second:parseInt(o.second,10),amount:parseInt(o.amount,10)})),n.distanceField.forEach(o=>i.distanceField.push({distanceRange:parseInt(o.distanceRange,10),fieldType:o.fieldType})),i}}class ec{static test(t){const r=t;return"getElementsByTagName"in r&&r.getElementsByTagName("page").length&&r.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const r=new ka,n=t.getElementsByTagName("info"),i=t.getElementsByTagName("common"),o=t.getElementsByTagName("page"),l=t.getElementsByTagName("char"),h=t.getElementsByTagName("kerning"),u=t.getElementsByTagName("distanceField");for(let f=0;f<n.length;f++)r.info.push({face:n[f].getAttribute("face"),size:parseInt(n[f].getAttribute("size"),10)});for(let f=0;f<i.length;f++)r.common.push({lineHeight:parseInt(i[f].getAttribute("lineHeight"),10)});for(let f=0;f<o.length;f++)r.page.push({id:parseInt(o[f].getAttribute("id"),10)||0,file:o[f].getAttribute("file")});for(let f=0;f<l.length;f++){const d=l[f];r.char.push({id:parseInt(d.getAttribute("id"),10),page:parseInt(d.getAttribute("page"),10)||0,x:parseInt(d.getAttribute("x"),10),y:parseInt(d.getAttribute("y"),10),width:parseInt(d.getAttribute("width"),10),height:parseInt(d.getAttribute("height"),10),xoffset:parseInt(d.getAttribute("xoffset"),10),yoffset:parseInt(d.getAttribute("yoffset"),10),xadvance:parseInt(d.getAttribute("xadvance"),10)})}for(let f=0;f<h.length;f++)r.kerning.push({first:parseInt(h[f].getAttribute("first"),10),second:parseInt(h[f].getAttribute("second"),10),amount:parseInt(h[f].getAttribute("amount"),10)});for(let f=0;f<u.length;f++)r.distanceField.push({fieldType:u[f].getAttribute("fieldType"),distanceRange:parseInt(u[f].getAttribute("distanceRange"),10)});return r}}class rc{static test(t){return typeof t=="string"&&t.includes("<font>")?ec.test(Q.ADAPTER.parseXML(t)):!1}static parse(t){return ec.parse(Q.ADAPTER.parseXML(t))}}const iu=[_a,ec,rc];function WB(e){for(let t=0;t<iu.length;t++)if(iu[t].test(e))return iu[t];return null}function HB(e,t,r,n,i,o){const l=r.fill;if(Array.isArray(l)){if(l.length===1)return l[0]}else return l;let h;const u=r.dropShadow?r.dropShadowDistance:0,f=r.padding||0,d=e.width/n-u-f*2,p=e.height/n-u-f*2,g=l.slice(),v=r.fillGradientStops.slice();if(!v.length){const y=g.length+1;for(let w=1;w<y;++w)v.push(w/y)}if(g.unshift(l[0]),v.unshift(0),g.push(l[l.length-1]),v.push(1),r.fillGradientType===Ja.LINEAR_VERTICAL){h=t.createLinearGradient(d/2,f,d/2,p+f);let y=0;const x=(o.fontProperties.fontSize+r.strokeThickness)/p;for(let T=0;T<i.length;T++){const S=o.lineHeight*T;for(let E=0;E<g.length;E++){let I=0;typeof v[E]=="number"?I=v[E]:I=E/g.length;const D=S/p+I*x;let L=Math.max(y,D);L=Math.min(L,1),h.addColorStop(L,g[E]),y=L}}}else{h=t.createLinearGradient(f,p/2,d+f,p/2);const y=g.length+1;let w=1;for(let x=0;x<g.length;x++){let T;typeof v[x]=="number"?T=v[x]:T=w/y,h.addColorStop(T,g[x]),w++}}return h}function zB(e,t,r,n,i,o,l){const h=r.text,u=r.fontProperties;t.translate(n,i),t.scale(o,o);const f=l.strokeThickness/2,d=-(l.strokeThickness/2);if(t.font=l.toFontString(),t.lineWidth=l.strokeThickness,t.textBaseline=l.textBaseline,t.lineJoin=l.lineJoin,t.miterLimit=l.miterLimit,t.fillStyle=HB(e,t,l,o,[h],r),t.strokeStyle=l.stroke,l.dropShadow){const p=l.dropShadowColor,g=Fs(typeof p=="number"?p:yc(p)),v=l.dropShadowBlur*o,y=l.dropShadowDistance*o;t.shadowColor=`rgba(${g[0]*255},${g[1]*255},${g[2]*255},${l.dropShadowAlpha})`,t.shadowBlur=v,t.shadowOffsetX=Math.cos(l.dropShadowAngle)*y,t.shadowOffsetY=Math.sin(l.dropShadowAngle)*y}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;l.stroke&&l.strokeThickness&&t.strokeText(h,f,d+r.lineHeight-u.descent),l.fill&&t.fillText(h,f,d+r.lineHeight-u.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function xa(e){return e.codePointAt?e.codePointAt(0):e.charCodeAt(0)}function Yv(e){return Array.from?Array.from(e):e.split("")}function XB(e){typeof e=="string"&&(e=[e]);const t=[];for(let r=0,n=e.length;r<n;r++){const i=e[r];if(Array.isArray(i)){if(i.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${i.length}.`);const o=i[0].charCodeAt(0),l=i[1].charCodeAt(0);if(l<o)throw new Error("[BitmapFont]: Invalid character range.");for(let h=o,u=l;h<=u;h++)t.push(String.fromCharCode(h))}else t.push(...Yv(i))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const pr=class{constructor(e,t,r){var f;const[n]=e.info,[i]=e.common,[o]=e.page,[l]=e.distanceField,h=xn(o.file),u={};this._ownsTextures=r,this.font=n.face,this.size=n.size,this.lineHeight=i.lineHeight/h,this.chars={},this.pageTextures=u;for(let d=0;d<e.page.length;d++){const{id:p,file:g}=e.page[d];u[p]=t instanceof Array?t[d]:t[g],l!=null&&l.fieldType&&l.fieldType!=="none"&&(u[p].baseTexture.alphaMode=wr.NO_PREMULTIPLIED_ALPHA,u[p].baseTexture.mipmap=Lr.OFF)}for(let d=0;d<e.char.length;d++){const{id:p,page:g}=e.char[d];let{x:v,y,width:w,height:x,xoffset:T,yoffset:S,xadvance:E}=e.char[d];v/=h,y/=h,w/=h,x/=h,T/=h,S/=h,E/=h;const I=new At(v+u[g].frame.x/h,y+u[g].frame.y/h,w,x);this.chars[p]={xOffset:T,yOffset:S,xAdvance:E,kerning:{},texture:new it(u[g].baseTexture,I),page:g}}for(let d=0;d<e.kerning.length;d++){let{first:p,second:g,amount:v}=e.kerning[d];p/=h,g/=h,v/=h,this.chars[g]&&(this.chars[g].kerning[p]=v)}this.distanceFieldRange=l==null?void 0:l.distanceRange,this.distanceFieldType=((f=l==null?void 0:l.fieldType)==null?void 0:f.toLowerCase())??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(e,t,r){let n;if(e instanceof ka)n=e;else{const o=WB(e);if(!o)throw new Error("Unrecognized data format for font.");n=o.parse(e)}t instanceof it&&(t=[t]);const i=new pr(n,t,r);return pr.available[i.font]=i,i}static uninstall(e){const t=pr.available[e];if(!t)throw new Error(`No font found named '${e}'`);t.destroy(),delete pr.available[e]}static from(e,t,r){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:n,padding:i,resolution:o,textureWidth:l,textureHeight:h,...u}=Object.assign({},pr.defaultOptions,r),f=XB(n),d=t instanceof Qn?t:new Qn(t),p=l,g=new ka;g.info[0]={face:d.fontFamily,size:d.fontSize},g.common[0]={lineHeight:d.fontSize};let v=0,y=0,w,x,T,S=0;const E=[];for(let D=0;D<f.length;D++){w||(w=Q.ADAPTER.createCanvas(),w.width=l,w.height=h,x=w.getContext("2d"),T=new mt(w,{resolution:o,...u}),E.push(new it(T)),g.page.push({id:E.length-1,file:""}));const L=f[D],O=_e.measureText(L,d,!1,w),F=O.width,X=Math.ceil(O.height),q=Math.ceil((d.fontStyle==="italic"?2:1)*F);if(y>=h-X*o){if(y===0)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${L}')`);--D,w=null,x=null,T=null,y=0,v=0,S=0;continue}if(S=Math.max(X+O.fontProperties.descent,S),q*o+v>=p){if(v===0)throw new Error(`[BitmapFont] textureWidth ${l}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${L}')`);--D,y+=S*o,y=Math.ceil(y),v=0,S=0;continue}zB(w,x,O,v,y,o,d);const V=xa(O.text);g.char.push({id:V,page:E.length-1,x:v/o,y:y/o,width:q,height:X,xoffset:0,yoffset:0,xadvance:Math.ceil(F-(d.dropShadow?d.dropShadowDistance:0)-(d.stroke?d.strokeThickness:0))}),v+=(q+2*i)*o,v=Math.ceil(v)}for(let D=0,L=f.length;D<L;D++){const O=f[D];for(let F=0;F<L;F++){const X=f[F],q=x.measureText(O).width,V=x.measureText(X).width,$=x.measureText(O+X).width-(q+V);$&&g.kerning.push({first:xa(O),second:xa(X),amount:$})}}const I=new pr(g,E,!0);return pr.available[e]!==void 0&&pr.uninstall(e),pr.available[e]=I,I}};let Fe=pr;Fe.ALPHA=[["a","z"],["A","Z"]," "];Fe.NUMERIC=[["0","9"]];Fe.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];Fe.ASCII=[[" ","~"]];Fe.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:pr.ALPHANUMERIC};Fe.available={};var VB=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r
\r
}\r
`,YB=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const Ug=[],Gg=[],$g=[],jv=class extends Xe{constructor(e,t={}){super(),this._tint=16777215;const{align:r,tint:n,maxWidth:i,letterSpacing:o,fontName:l,fontSize:h}=Object.assign({},jv.styleDefaults,t);if(!Fe.available[l])throw new Error(`Missing BitmapFont "${l}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=r,this._tint=n,this._font=void 0,this._fontName=l,this._fontSize=h,this.text=e,this._maxWidth=i,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new yn(()=>{this.dirty=!0},this,0,0),this._roundPixels=Q.ROUND_PIXELS,this.dirty=!0,this._resolution=Q.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var q;const e=Fe.available[this._fontName],t=this.fontSize,r=t/e.size,n=new Ct,i=[],o=[],l=[],h=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",u=Yv(h),f=this._maxWidth*e.size/t,d=e.distanceFieldType==="none"?Ug:Gg;let p=null,g=0,v=0,y=0,w=-1,x=0,T=0,S=0,E=0;for(let V=0;V<u.length;V++){const Z=u[V],$=xa(Z);if(/(?:\s)/.test(Z)&&(w=V,x=g,E++),Z==="\r"||Z===`
`){o.push(g),l.push(-1),v=Math.max(v,g),++y,++T,n.x=0,n.y+=e.lineHeight,p=null,E=0;continue}const k=e.chars[$];if(!k)continue;p&&k.kerning[p]&&(n.x+=k.kerning[p]);const lt=$g.pop()||{texture:it.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Ct};lt.texture=k.texture,lt.line=y,lt.charCode=$,lt.position.x=n.x+k.xOffset+this._letterSpacing/2,lt.position.y=n.y+k.yOffset,lt.prevSpaces=E,i.push(lt),g=lt.position.x+Math.max(k.xAdvance-k.xOffset,k.texture.orig.width),n.x+=k.xAdvance+this._letterSpacing,S=Math.max(S,k.yOffset+k.texture.height),p=$,w!==-1&&f>0&&n.x>f&&(++T,Li(i,1+w-T,1+V-w),V=w,w=-1,o.push(x),l.push(i.length>0?i[i.length-1].prevSpaces:0),v=Math.max(v,x),y++,n.x=0,n.y+=e.lineHeight,p=null,E=0)}const I=u[u.length-1];I!=="\r"&&I!==`
`&&(/(?:\s)/.test(I)&&(g=x),o.push(g),v=Math.max(v,g),l.push(-1));const D=[];for(let V=0;V<=y;V++){let Z=0;this._align==="right"?Z=v-o[V]:this._align==="center"?Z=(v-o[V])/2:this._align==="justify"&&(Z=l[V]<0?0:(v-o[V])/l[V]),D.push(Z)}const L=i.length,O={},F=[],X=this._activePagesMeshData;d.push(...X);for(let V=0;V<L;V++){const Z=i[V].texture,$=Z.baseTexture.uid;if(!O[$]){let k=d.pop();if(!k){const pt=new yB;let j,_t;e.distanceFieldType==="none"?(j=new Fg(it.EMPTY),_t=ct.NORMAL):(j=new Fg(it.EMPTY,{program:vr.from(YB,VB),uniforms:{uFWidth:0}}),_t=ct.NORMAL_NPM);const Ft=new Ju(pt,j);Ft.blendMode=_t,k={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:Ft,vertices:null,uvs:null,indices:null}}k.index=0,k.indexCount=0,k.vertexCount=0,k.uvsCount=0,k.total=0;const{_textureCache:lt}=this;lt[$]=lt[$]||new it(Z.baseTexture),k.mesh.texture=lt[$],k.mesh.tint=this._tint,F.push(k),O[$]=k}O[$].total++}for(let V=0;V<X.length;V++)F.includes(X[V])||this.removeChild(X[V].mesh);for(let V=0;V<F.length;V++)F[V].mesh.parent!==this&&this.addChild(F[V].mesh);this._activePagesMeshData=F;for(const V in O){const Z=O[V],$=Z.total;if(!(((q=Z.indices)==null?void 0:q.length)>6*$)||Z.vertices.length<Ju.BATCHABLE_SIZE*2)Z.vertices=new Float32Array(4*2*$),Z.uvs=new Float32Array(4*2*$),Z.indices=new Uint16Array(6*$);else{const k=Z.total,lt=Z.vertices;for(let pt=k*4*2;pt<lt.length;pt++)lt[pt]=0}Z.mesh.size=6*$}for(let V=0;V<L;V++){const Z=i[V];let $=Z.position.x+D[Z.line]*(this._align==="justify"?Z.prevSpaces:1);this._roundPixels&&($=Math.round($));const k=$*r,lt=Z.position.y*r,pt=Z.texture,j=O[pt.baseTexture.uid],_t=pt.frame,Ft=pt._uvs,H=j.index++;j.indices[H*6+0]=0+H*4,j.indices[H*6+1]=1+H*4,j.indices[H*6+2]=2+H*4,j.indices[H*6+3]=0+H*4,j.indices[H*6+4]=2+H*4,j.indices[H*6+5]=3+H*4,j.vertices[H*8+0]=k,j.vertices[H*8+1]=lt,j.vertices[H*8+2]=k+_t.width*r,j.vertices[H*8+3]=lt,j.vertices[H*8+4]=k+_t.width*r,j.vertices[H*8+5]=lt+_t.height*r,j.vertices[H*8+6]=k,j.vertices[H*8+7]=lt+_t.height*r,j.uvs[H*8+0]=Ft.x0,j.uvs[H*8+1]=Ft.y0,j.uvs[H*8+2]=Ft.x1,j.uvs[H*8+3]=Ft.y1,j.uvs[H*8+4]=Ft.x2,j.uvs[H*8+5]=Ft.y2,j.uvs[H*8+6]=Ft.x3,j.uvs[H*8+7]=Ft.y3}this._textWidth=v*r,this._textHeight=(n.y+e.lineHeight)*r;for(const V in O){const Z=O[V];if(this.anchor.x!==0||this.anchor.y!==0){let pt=0;const j=this._textWidth*this.anchor.x,_t=this._textHeight*this.anchor.y;for(let Ft=0;Ft<Z.total;Ft++)Z.vertices[pt++]-=j,Z.vertices[pt++]-=_t,Z.vertices[pt++]-=j,Z.vertices[pt++]-=_t,Z.vertices[pt++]-=j,Z.vertices[pt++]-=_t,Z.vertices[pt++]-=j,Z.vertices[pt++]-=_t}this._maxLineHeight=S*r;const $=Z.mesh.geometry.getBuffer("aVertexPosition"),k=Z.mesh.geometry.getBuffer("aTextureCoord"),lt=Z.mesh.geometry.getIndex();$.data=Z.vertices,k.data=Z.uvs,lt.data=Z.indices,$.update(),k.update(),lt.update()}for(let V=0;V<i.length;V++)$g.push(i[V]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:r,size:n}=Fe.available[this._fontName];if(r!=="none"){const{a:i,b:o,c:l,d:h}=this.worldTransform,u=Math.sqrt(i*i+o*o),f=Math.sqrt(l*l+h*h),d=(Math.abs(u)+Math.abs(f))/2,p=this.fontSize/n,g=e._view.resolution;for(const v of this._activePagesMeshData)v.mesh.shader.uniforms.uFWidth=d*t*p*g}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=Fe.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tint}set tint(e){if(this._tint!==e){this._tint=e;for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!Fe.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??Fe.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,n=Fe.available[this._fontName].distanceFieldType==="none"?Ug:Gg;n.push(...this._activePagesMeshData);for(const i of this._activePagesMeshData)this.removeChild(i.mesh);this._activePagesMeshData=[],n.filter(i=>t[i.mesh.texture.baseTexture.uid]).forEach(i=>{i.mesh.texture=it.EMPTY});for(const i in t)t[i].destroy(),delete t[i];this._font=null,this._textureCache=null,super.destroy(e)}};let jB=jv;jB.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const qB=[".xml",".fnt"],KB={extension:{type:J.LoadParser,priority:Nr.Normal},test(e){return qB.includes(be.extname(e).toLowerCase())},async testParse(e){return _a.test(e)||rc.test(e)},async parse(e,t,r){const n=_a.test(e)?_a.parse(e):rc.parse(e),{src:i}=t,{page:o}=n,l=[];for(let f=0;f<o.length;++f){const d=o[f].file,p=be.join(be.dirname(i),d);l.push(p)}const h=await r.load(l),u=l.map(f=>h[f]);return Fe.install(n,u,!0)},async load(e,t){return(await Q.ADAPTER.fetch(e)).text()},unload(e){e.destroy()}};st.add(KB);const ZB={A:"menlo-bold-0.png",B:"menlo-bold-1.png",C:"menlo-bold-2.png",D:"menlo-bold-3.png",E:"menlo-bold-4.png",F:"menlo-bold-5.png",G:"menlo-bold-6.png",H:"menlo-bold-7.png",I:"menlo-bold-8.png",J:"menlo-bold-9.png",K:"menlo-bold-10.png",L:"menlo-bold-11.png",M:"menlo-bold-12.png",N:"menlo-bold-13.png",O:"menlo-bold-14.png",P:"menlo-bold-15.png",Q:"menlo-bold-16.png",R:"menlo-bold-17.png",S:"menlo-bold-18.png",T:"menlo-bold-19.png",U:"menlo-bold-20.png",V:"menlo-bold-21.png",W:"menlo-bold-22.png",X:"menlo-bold-23.png",Y:"menlo-bold-24.png",Z:"menlo-bold-25.png",a:"menlo-bold-26.png",b:"menlo-bold-27.png",c:"menlo-bold-28.png",d:"menlo-bold-29.png",e:"menlo-bold-30.png",f:"menlo-bold-31.png",g:"menlo-bold-32.png",h:"menlo-bold-33.png",i:"menlo-bold-34.png",j:"menlo-bold-35.png",k:"menlo-bold-36.png",l:"menlo-bold-37.png",m:"menlo-bold-38.png",n:"menlo-bold-39.png",o:"menlo-bold-40.png",p:"menlo-bold-41.png",q:"menlo-bold-42.png",r:"menlo-bold-43.png",s:"menlo-bold-44.png",t:"menlo-bold-45.png",u:"menlo-bold-46.png",v:"menlo-bold-47.png",w:"menlo-bold-48.png",x:"menlo-bold-49.png",y:"menlo-bold-50.png",z:"menlo-bold-51.png",0:"menlo-bold-52.png",1:"menlo-bold-53.png",2:"menlo-bold-54.png",3:"menlo-bold-55.png",4:"menlo-bold-56.png",5:"menlo-bold-57.png",6:"menlo-bold-58.png",7:"menlo-bold-59.png",8:"menlo-bold-60.png",9:"menlo-bold-61.png","!":"menlo-bold-62.png","@":"menlo-bold-63.png","#":"menlo-bold-64.png",$:"menlo-bold-65.png","%":"menlo-bold-66.png","^":"menlo-bold-67.png","&":"menlo-bold-68.png","*":"menlo-bold-69.png","(":"menlo-bold-70.png",")":"menlo-bold-71.png","-":"menlo-bold-72.png",_:"menlo-bold-73.png","=":"menlo-bold-74.png","+":"menlo-bold-75.png",",":"menlo-bold-76.png",".":"menlo-bold-77.png","<":"menlo-bold-78.png",">":"menlo-bold-79.png","/":"menlo-bold-80.png","?":"menlo-bold-81.png",";":"menlo-bold-82.png",":":"menlo-bold-83.png",'"':"menlo-bold-84.png","'":"menlo-bold-85.png","[":"menlo-bold-86.png","]":"menlo-bold-87.png","{":"menlo-bold-88.png","}":"menlo-bold-89.png","\\":"menlo-bold-90.png","|":"menlo-bold-91.png","`":"menlo-bold-92.png","~":"menlo-bold-93.png","•":"menlo-bold-94.png"},JB={A:"menlo-bold-half-0.png",B:"menlo-bold-half-1.png",C:"menlo-bold-half-2.png",D:"menlo-bold-half-3.png",E:"menlo-bold-half-4.png",F:"menlo-bold-half-5.png",G:"menlo-bold-half-6.png",H:"menlo-bold-half-7.png",I:"menlo-bold-half-8.png",J:"menlo-bold-half-9.png",K:"menlo-bold-half-10.png",L:"menlo-bold-half-11.png",M:"menlo-bold-half-12.png",N:"menlo-bold-half-13.png",O:"menlo-bold-half-14.png",P:"menlo-bold-half-15.png",Q:"menlo-bold-half-16.png",R:"menlo-bold-half-17.png",S:"menlo-bold-half-18.png",T:"menlo-bold-half-19.png",U:"menlo-bold-half-20.png",V:"menlo-bold-half-21.png",W:"menlo-bold-half-22.png",X:"menlo-bold-half-23.png",Y:"menlo-bold-half-24.png",Z:"menlo-bold-half-25.png",a:"menlo-bold-half-26.png",b:"menlo-bold-half-27.png",c:"menlo-bold-half-28.png",d:"menlo-bold-half-29.png",e:"menlo-bold-half-30.png",f:"menlo-bold-half-31.png",g:"menlo-bold-half-32.png",h:"menlo-bold-half-33.png",i:"menlo-bold-half-34.png",j:"menlo-bold-half-35.png",k:"menlo-bold-half-36.png",l:"menlo-bold-half-37.png",m:"menlo-bold-half-38.png",n:"menlo-bold-half-39.png",o:"menlo-bold-half-40.png",p:"menlo-bold-half-41.png",q:"menlo-bold-half-42.png",r:"menlo-bold-half-43.png",s:"menlo-bold-half-44.png",t:"menlo-bold-half-45.png",u:"menlo-bold-half-46.png",v:"menlo-bold-half-47.png",w:"menlo-bold-half-48.png",x:"menlo-bold-half-49.png",y:"menlo-bold-half-50.png",z:"menlo-bold-half-51.png",0:"menlo-bold-half-52.png",1:"menlo-bold-half-53.png",2:"menlo-bold-half-54.png",3:"menlo-bold-half-55.png",4:"menlo-bold-half-56.png",5:"menlo-bold-half-57.png",6:"menlo-bold-half-58.png",7:"menlo-bold-half-59.png",8:"menlo-bold-half-60.png",9:"menlo-bold-half-61.png","!":"menlo-bold-half-62.png","@":"menlo-bold-half-63.png","#":"menlo-bold-half-64.png",$:"menlo-bold-half-65.png","%":"menlo-bold-half-66.png","^":"menlo-bold-half-67.png","&":"menlo-bold-half-68.png","*":"menlo-bold-half-69.png","(":"menlo-bold-half-70.png",")":"menlo-bold-half-71.png","-":"menlo-bold-half-72.png",_:"menlo-bold-half-73.png","=":"menlo-bold-half-74.png","+":"menlo-bold-half-75.png",",":"menlo-bold-half-76.png",".":"menlo-bold-half-77.png","<":"menlo-bold-half-78.png",">":"menlo-bold-half-79.png","/":"menlo-bold-half-80.png","?":"menlo-bold-half-81.png",";":"menlo-bold-half-82.png",":":"menlo-bold-half-83.png",'"':"menlo-bold-half-84.png","'":"menlo-bold-half-85.png","[":"menlo-bold-half-86.png","]":"menlo-bold-half-87.png","{":"menlo-bold-half-88.png","}":"menlo-bold-half-89.png","\\":"menlo-bold-half-90.png","|":"menlo-bold-half-91.png","`":"menlo-bold-half-92.png","~":"menlo-bold-half-93.png","•":"menlo-bold-half-94.png"};let qv;const Kv={width:100,height:46},mn=window.innerWidth/Kv.width,QB=(e,t,r)=>{const n=Math.trunc(e/mn),i=Math.trunc(t/mn);return`${n},${i},${r}`},Yn={};async function tO(e){qv=new Ac({view:e,width:window.innerWidth,height:mn*Kv.height,autoDensity:!0,resolution:window.devicePixelRatio||1}),await eO()}const eO=async()=>(Yn.ascii=await Xn.load("/forcecrusher/fonts/menlo-bold.json"),Yn.text=await Xn.load("/forcecrusher/fonts/menlo-bold-half.json"),Yn.tile=await Xn.load("/forcecrusher/tile.png"),Yn),rO=e=>Yn.ascii.textures[ZB[e]],nO=e=>Yn.text.textures[JB[e]],iO=()=>Yn.tile;class cr{constructor(t){zt(this,"x",0);zt(this,"y",0);zt(this,"halfWidth",!1);zt(this,"width");zt(this,"height");zt(this,"layers",[]);zt(this,"sprites",[]);zt(this,"tileSets",[]);zt(this,"tints",[]);zt(this,"alphas",[]);zt(this,"visible",!0);zt(this,"_getTexture",t=>{const{tileSet:r,char:n}=t;return r==="ascii"?rO(n):r==="text"?nO(n):iO()});zt(this,"_createSprite",t=>{const{char:r,width:n,height:i,layer:o,x:l,y:h,tileSet:u,tint:f=16777215,alpha:d=1}=t,p=this._getTexture({tileSet:u,char:r});let g=new Zi(p);g.width=this.halfWidth?n/2:n,g.height=i,g.x=this.halfWidth?l*(n/2):l*n,g.y=h*i,g.tint=f,g.alpha=d,this.sprites[o][h][l]=g,this.layers[o].addChild(g)});zt(this,"updateCell",t=>(Object.keys(t).forEach(r=>{const{char:n,tint:i,alpha:o,tileSet:l,x:h,y:u}=t[r];this.updateSprite({char:n,tint:i,alpha:o,tileSet:l,x:h,y:u,layer:parseInt(r)})}),this));zt(this,"updateSprite",async t=>{const{char:r="",layer:n,x:i,y:o,tileSet:l="text",tint:h,alpha:u}=t,f=this.sprites[n][o][i];if(f)return f.texture=this._getTexture({tileSet:l,char:r}),h&&(f.tint=h),typeof u<"u"&&(f.alpha=u),this});zt(this,"updateRows",t=>(t.forEach((r,n)=>{r.forEach((i,o)=>{this.clearRow(o,n),this.updateRow({...i,layer:o,y:n})})}),this));zt(this,"updateRow",t=>{const{string:r="",layer:n=0,x:i,y:o,tileSet:l,tint:h,alpha:u}=t;return[...r].forEach((d,p)=>this.updateSprite({char:d,layer:n||0,x:i||0+p,y:o||0,tileSet:l||this.tileSets[n],tint:h||this.tints[n],alpha:u||this.alphas[n]})),(l||this.tileSets[n])==="tile"&&Ln.times(this.width,d=>{this.updateSprite({layer:n,x:i||0+d,y:o||0,tileSet:l||this.tileSets[n],tint:h||this.tints[n],alpha:u||this.alphas[n]})}),this});zt(this,"clearRow",(t,r)=>{const n=new Array(this.width+1).join(" ");this.updateRow({string:n,layer:t,y:r})});zt(this,"clearView",()=>{let t=0;this.layers.forEach(()=>{Ln.times(this.height,r=>{this.clearRow(t,r)}),t+=1})});zt(this,"show",()=>{this.visible=!0,this.layers.forEach(t=>t.visible=this.visible)});zt(this,"hide",()=>{this.visible=!1,this.layers.forEach(t=>t.visible=this.visible)});return this.width=t.width,this.height=t.height,this.tileSets=t.tileSets,this.tints=t.tints,this.alphas=t.alphas,this.halfWidth=this.tileSets.includes("text"),this.visible=t.visible,Ln.times(t.layers,()=>this.layers.push(new Xe)),this.layers.forEach(r=>{const n=this.halfWidth?t.x*(mn/2):t.x*mn,i=t.y*mn;r.x=n,r.y=i,r.interactiveChildren=!1,r.visible=this.visible,qv.stage.addChild(r)}),Ln.times(t.layers,()=>this.sprites.push(Array.from(Array(this.height),()=>Array.from(Array(this.width))))),Ln.times(t.layers,r=>{Ln.times(this.height,n=>{Ln.times(this.width,async i=>{this._createSprite({char:"",width:mn,height:mn,layer:r,x:i,y:n,tileSet:t.tileSets[r],tint:t.tints[r],alpha:t.alphas[r]})})})}),this}}const yr=e=>`${e.x},${e.y},${e.z}`,Wg=e=>{const t=e.split(",").map(r=>parseInt(r,10));return{x:t[0],y:t[1],z:t[2]}},Hg=(e,t,r)=>e+r*(t-e),sO=(e,t,r)=>{const n=Hg(e.x,t.x,r),i=Hg(e.y,t.y,r),o=e.z;return{x:n,y:i,z:o}},oO=(e,t)=>{const r=t.x-e.x,n=t.y-e.y;return Math.max(Math.abs(r),Math.abs(n))},aO=e=>{const t=Math.round(e.x),r=Math.round(e.y),n=e.z;return{x:t,y:r,z:n}},lO=(e,t)=>{let r=[],n=oO(e,t);for(let i=0;i<=n;i++){let o=n===0?0:i/n;r.push(aO(sO(e,t,o)))}return r},zg=(e,t)=>{const{x:r,y:n,z:i,width:o,height:l,hasWalls:h}=e,u={},f=r,d=r+o,p=n,g=n+l;if(h)for(let y=p+1;y<g-1;y++)for(let w=f+1;w<d-1;w++)u[`${w},${y},${i}`]={x:w,y,z:i,...t};else for(let y=p;y<g;y++)for(let w=f;w<d;w++)u[`${w},${y},${i}`]={x:w,y,z:i,...t};const v={x:Math.round((f+d)/2),y:Math.round((p+g)/2),z:i};return{x1:f,x2:d,y1:p,y2:g,z:i,center:v,hasWalls:h,tiles:u,width:o,height:l}},hO=(e,t)=>e.x1<=t.x2&&e.x2>=t.x1&&e.y1<=t.y2&&e.y2>=t.y1,uO=(e,t)=>{const r=Math.pow(t.x-e.x,2),n=Math.pow(t.y-e.y,2);return Math.floor(Math.sqrt(r+n))},Xg=(e,t)=>e.x===t.x&&e.y===t.y&&e.z===t.z,Pe=e=>{console.log(JSON.parse(JSON.stringify(e)))},me=e=>{kt(t=>t.log.push(e))},ia=e=>{const{x:t,y:r}=e,{width:n,height:i}=ft().views.map;return t<0||r<0||t>=n||r>=i},cO=(e,t)=>e.x===t.x&&e.y===t.y&&e.z===t.z,fO=()=>Ut.random(1,6),Zv=()=>Ut.random(1,20);var Jv={exports:{}},Rc={};Object.defineProperty(Rc,"__esModule",{value:!0});function nc(e,t){t=e.length;for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function dO(e){if(Array.isArray(e))return nc(e)}function pO(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Qv(e,t){if(e){if(typeof e=="string")return nc(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return nc(e,t)}}function gO(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mO(e){return dO(e)||pO(e)||Qv(e)||gO()}function vO(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Qv(e))||t){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,l=!1,h;return{s:function(){r=r.call(e)},n:function(){var u=r.next();return o=u.done,u},e:function(u){l=!0,h=u},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(l)throw h}}}}function yO(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _O(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function ty(e){var t=_O(e,"string");return typeof t=="symbol"?t:String(t)}function xO(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ty(n.key),n)}}function bO(e,t,r){return t&&xO(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function wO(e,t,r){return t=ty(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var EO=function(){function e(){yO(this,e),wO(this,"subscribers",new Set)}return bO(e,[{key:"onSubscribe",get:function(){return this._onSubscribe||(this._onSubscribe=new e),this._onSubscribe}},{key:"onUnsubscribe",get:function(){return this._onUnsubscribe||(this._onUnsubscribe=new e),this._onUnsubscribe}},{key:"subscribe",value:function(r){var n,i=this;return this.subscribers.add(r),(n=this._onSubscribe)===null||n===void 0||n.emit(r),function(){return i.unsubscribe(r)}}},{key:"unsubscribe",value:function(r){var n;this.subscribers.delete(r),(n=this._onUnsubscribe)===null||n===void 0||n.emit(r)}},{key:"clear",value:function(){if(this._onUnsubscribe){var r=vO(this.subscribers),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;this._onUnsubscribe.emit(i)}}catch(o){r.e(o)}finally{r.f()}}this.subscribers.clear()}},{key:"emit",value:function(){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];this.subscribers.forEach(function(o){return o.apply(void 0,n)})}},{key:"emitAsync",value:function(){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return Promise.all(mO(this.subscribers).map(function(o){return o.apply(void 0,n)}))}}]),e}();Rc.Event=EO;Jv.exports=Rc;var Vg=Jv.exports;function Yg(e,t){t=e.length;for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function TO(e,t){if(e){if(typeof e=="string")return Yg(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Yg(e,t)}}function AO(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=TO(e))||t){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,l=!1,h;return{s:function(){r=r.call(e)},n:function(){var u=r.next();return o=u.done,u},e:function(u){l=!0,h=u},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(l)throw h}}}}function SO(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function CO(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function ey(e){var t=CO(e,"string");return typeof t=="symbol"?t:String(t)}function IO(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ey(n.key),n)}}function PO(e,t,r){return t&&IO(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function sa(e,t,r){return t=ey(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ry;ry=Symbol.iterator;var ny=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];SO(this,e),sa(this,"_version",0),sa(this,"onEntityAdded",new Vg.Event),sa(this,"onEntityRemoved",new Vg.Event),sa(this,"entityPositions",new Map),this._entities=t,this.add=this.add.bind(this),this.remove=this.remove.bind(this);for(var r=0;r<t.length;r++)this.entityPositions.set(t[r],r)}return PO(e,[{key:"version",get:function(){return this._version}},{key:"entities",get:function(){return this._entities}},{key:ry,value:function(){var r=this,n=this._entities.length,i={value:void 0,done:!1};return{next:function(){return i.value=r._entities[--n],i.done=n<0,i}}}},{key:"size",get:function(){return this.entities.length}},{key:"first",get:function(){return this.entities[0]}},{key:"has",value:function(r){return this.entityPositions.has(r)}},{key:"add",value:function(r){return r&&!this.has(r)&&(this.entities.push(r),this.entityPositions.set(r,this.entities.length-1),this._version++,this.onEntityAdded.emit(r)),r}},{key:"remove",value:function(r){if(this.has(r)){this.onEntityRemoved.emit(r);var n=this.entityPositions.get(r);this.entityPositions.delete(r);var i=this.entities[this.entities.length-1];i!==r&&(this.entities[n]=i,this.entityPositions.set(i,n)),this.entities.pop(),this._version++}return r}},{key:"clear",value:function(){var r=AO(this),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;this.remove(i)}}catch(o){r.e(o)}finally{r.f()}}}]),e}(),jg=new WeakMap,qg=0,RO=function(t){var r=jg.get(t);return r!==void 0?r:(jg.set(t,qg),qg++)};function MO(){var e=new Array;function t(i){e.push(i)}function r(){e.length=0}function n(){e.forEach(function(i){return i()}),r()}return t.clear=r,t.flush=n,t}function ic(e,t){t=e.length;for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function DO(e){if(Array.isArray(e))return ic(e)}function BO(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function iy(e,t){if(e){if(typeof e=="string")return ic(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ic(e,t)}}function OO(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rs(e){return DO(e)||BO(e)||iy(e)||OO()}function ti(e){return ti=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},ti(e)}function FO(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=ti(e),e!==null););return e}function Ms(){return typeof Reflect<"u"&&Reflect.get?Ms=Reflect.get.bind():Ms=function(t,r,n){var i=FO(t,r);if(i){var o=Object.getOwnPropertyDescriptor(i,r);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Ms.apply(this,arguments)}function sc(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=iy(e))||t){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,l=!1,h;return{s:function(){r=r.call(e)},n:function(){var u=r.next();return o=u.done,u},e:function(u){l=!0,h=u},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(l)throw h}}}}function LO(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function sy(e){var t=LO(e,"string");return typeof t=="symbol"?t:String(t)}function Mi(e,t,r){return t=sy(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Kg(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Hn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Kg(Object(r),!0).forEach(function(n){Mi(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oy(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function NO(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,sy(n.key),n)}}function ay(e,t,r){return t&&NO(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Di(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oc(e,t){return oc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},oc(e,t)}function ly(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oc(e,t)}function kO(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function UO(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Di(e)}function hy(e){var t=kO();return function(){var n=ti(e),i;if(t){var o=ti(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return UO(this,i)}}var uy,GO=function(e){ly(r,e);var t=hy(r);function r(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return oy(this,r),n=t.call(this,i),Mi(Di(n),"queries",new Set),Mi(Di(n),"entityToId",new Map),Mi(Di(n),"idToEntity",new Map),Mi(Di(n),"nextId",0),n.onEntityAdded.subscribe(function(o){n.reindex(o)}),n.onEntityRemoved.subscribe(function(o){if(n.queries.forEach(function(h){return h.remove(o)}),n.entityToId.has(o)){var l=n.entityToId.get(o);n.idToEntity.delete(l),n.entityToId.delete(o)}}),n}return ay(r,[{key:"update",value:function(n){function i(o,l,h){return n.apply(this,arguments)}return i.toString=function(){return n.toString()},i}(function(n,i,o){if(typeof i=="function"){var l=i(n);l&&Object.assign(n,l)}else typeof i=="string"?n[i]=o:i&&Object.assign(n,i);return this.reindex(n),n})},{key:"addComponent",value:function(i,o,l){i[o]===void 0&&(i[o]=l,this.reindex(i))}},{key:"removeComponent",value:function(i,o){if(i[o]!==void 0){if(this.has(i)){var l=Hn({},i);delete l[o],this.reindex(i,l)}delete i[o]}}},{key:"query",value:function(i){var o=HO(i),l=cy(o),h=sc(this.queries),u;try{for(h.s();!(u=h.n()).done;){var f=u.value;if(f.key===l)return f}}catch(p){h.e(p)}finally{h.f()}var d=new $O(this,o);return this.queries.add(d),d}},{key:"with",value:function(){for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return this.query({with:o,without:[],predicates:[]})}},{key:"without",value:function(){for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return this.query({with:[],without:o,predicates:[]})}},{key:"where",value:function(i){return this.query({with:[],without:[],predicates:[i]})}},{key:"reindex",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:i;if(this.has(i)){var l=sc(this.queries),h;try{for(l.s();!(h=l.n()).done;){var u=h.value;u.evaluate(i,o)}}catch(f){l.e(f)}finally{l.f()}}}},{key:"id",value:function(i){if(this.has(i)){if(!this.entityToId.has(i)){var o=this.nextId++;this.entityToId.set(i,o),this.idToEntity.set(o,i)}return this.entityToId.get(i)}}},{key:"entity",value:function(i){return this.idToEntity.get(i)}}]),r}(ny);uy=Symbol.iterator;var $O=function(e){ly(r,e);var t=hy(r);function r(n,i){var o;return oy(this,r),o=t.call(this),Mi(Di(o),"_isConnected",!1),o.world=n,o.config=i,o.key=cy(i),o.onEntityAdded.onSubscribe.subscribe(function(){return o.connect()}),o.onEntityRemoved.onSubscribe.subscribe(function(){return o.connect()}),o}return ay(r,[{key:"isConnected",get:function(){return this._isConnected}},{key:"entities",get:function(){return this._isConnected||this.connect(),Ms(ti(r.prototype),"entities",this)}},{key:uy,value:function(){return this._isConnected||this.connect(),Ms(ti(r.prototype),Symbol.iterator,this).call(this)}},{key:"connect",value:function(){if(!this._isConnected){this._isConnected=!0;var i=sc(this.world),o;try{for(i.s();!(o=i.n()).done;){var l=o.value;this.evaluate(l)}}catch(h){i.e(h)}finally{i.f()}}return this}},{key:"disconnect",value:function(){return this._isConnected=!1,this}},{key:"with",value:function(){for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return this.world.query(Hn(Hn({},this.config),{},{with:[].concat(Rs(this.config.with),o)}))}},{key:"without",value:function(){for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return this.world.query(Hn(Hn({},this.config),{},{without:[].concat(Rs(this.config.without),o)}))}},{key:"where",value:function(i){return this.world.query(Hn(Hn({},this.config),{},{predicates:[].concat(Rs(this.config.predicates),[i])}))}},{key:"want",value:function(i){return this.config.with.every(function(o){return i[o]!==void 0})&&this.config.without.every(function(o){return i[o]===void 0})&&this.config.predicates.every(function(o){return o(i)})}},{key:"evaluate",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:i;if(this.isConnected){var l=this.want(o),h=this.has(i);l&&!h?this.add(i):!l&&h&&this.remove(i)}}}]),r}(ny),Zg=function(t){return Rs(new Set(t.sort().filter(function(r){return!!r&&r!==""})))};function WO(e){return Rs(new Set(e))}function HO(e){return{with:Zg(e.with),without:Zg(e.without),predicates:WO(e.predicates)}}function cy(e){return"".concat(e.with.join(","),":").concat(e.without.join(","),":").concat(e.predicates.map(function(t){return RO(t)}).join(","))}MO();var kr=(e=>(e.default="?",e.floor="•",e.owlbear="F",e.player="@",e.potion="!",e.rat="r",e.rock="*",e.stairsDown=">",e.stairsUp="<",e.wall="#",e))(kr||{}),Ur=(e=>(e[e.default=65399]="default",e[e.floor=3355443]="floor",e[e.owlbear=11027200]="owlbear",e[e.player=16777215]="player",e[e.potion=14329120]="potion",e[e.rat=14047863]="rat",e[e.rock=8355711]="rock",e[e.stairsDown=14329120]="stairsDown",e[e.stairsUp=14329120]="stairsUp",e[e.wall=8421504]="wall",e))(Ur||{});const Gr={id:"",version:1,name:"base"},An={...Gr,appearance:{char:kr.default,tint:Ur.default,tileSet:"ascii"},position:{x:0,y:0,z:0},name:"renderable"},Qa={...Gr,layer100:!0,name:"tile"},fy={...Gr,health:{max:1,current:1},blocking:!0,layer300:!0,name:"being",armorClass:10,strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10},zO={...An,...fy,appearance:{char:kr.player,tint:Ur.player,tileSet:"ascii"},health:{max:1e3,current:1e3},legendable:!0,name:"player",pc:!0,container:{name:"Haversack",description:"A simple medium sized burlap pouch with a single shoulder strap.",slots:10,contents:[]},armorClass:16,strength:16,dexterity:10,constitution:16,intelligence:8,wisdom:14,charisma:10,activeEffects:[]},XO={...Gr,...An,...Qa,appearance:{char:kr.wall,tint:Ur.wall,tileSet:"ascii"},blocking:!0,opaque:!0,name:"wall"},VO={...Gr,...An,...Qa,appearance:{char:kr.floor,tint:Ur.floor,tileSet:"ascii"},name:"floor"},YO={...Gr,...An,...Qa,appearance:{char:kr.stairsDown,tint:Ur.stairsDown,tileSet:"ascii"},name:"stairs down",stairsDown:!0,legendable:!0,description:"Stairs leading down",layer200:!0},jO={...Gr,...An,...Qa,appearance:{char:kr.stairsUp,tint:Ur.stairsUp,tileSet:"ascii"},name:"stairs up",stairsUp:!0,legendable:!0,description:"Stairs leading up",layer200:!0},qO={...Gr,...An,...fy,ai:!0,appearance:{char:kr.rat,tint:Ur.rat,tileSet:"ascii"},legendable:!0,name:"rat",description:"A medium-sized, long-tailed rodent",pathThrough:!0,health:{max:1,current:1},armorClass:13,strength:2,dexterity:11,constitution:9,intelligence:2,wisdom:10,charisma:4},KO={...Gr,...An,appearance:{char:kr.rock,tint:Ur.rock,tileSet:"ascii"},legendable:!0,name:"Rock",description:"A small rock for throwing",layer200:!0,pickUp:!0},ZO={...Gr,...An,appearance:{char:kr.potion,tint:Ur.potion,tileSet:"ascii"},consumable:!0,legendable:!0,name:"Health Potion",description:"A syrupy red liquid in a small glass vile",effects:[{component:"health",delta:10}],layer200:!0,pickUp:!0};function JO(e,t){const r={},n=Math.min(e.x,t.x),i=Math.max(e.x,t.x)+1;let o=n;for(;o<i;){const l={...t,x:o};r[yr(l)]={...l,sprite:"FLOOR"},o++}return r}function QO(e,t){const r={},n=Math.min(e.y,t.y),i=Math.max(e.y,t.y)+1;let o=n;for(;o<i;){const l={...e,y:o};r[yr(l)]={...l,sprite:"FLOOR"},o++}return r}const t2=e=>{const{pos:t,width:r,height:n,minRoomSize:i=6,maxRoomSize:o=12,maxRoomCount:l=30}=e,{x:h,y:u,z:f}=t,d={...zg({x:h,y:u,z:f,width:r,height:n,hasWalls:!1},{sprite:"WALL"}),rooms:[]};let p={};Ut.times(l,()=>{let y=Ut.random(i,o),w=Ut.random(i,o),x=Ut.random(h,r+h-y-1),T=Ut.random(u,n+u-w-1);const S=zg({x,y:T,z:f,width:y,height:w,hasWalls:!0},{sprite:"FLOOR"});d.rooms.some(E=>hO(E,S))||(d.rooms.push(S),p={...p,...S.tiles})});let g=null,v={};for(let y of d.rooms)g&&(v={...v,...JO(y.center,g.center),...QO(y.center,g.center)}),g=y;return d.tiles={...d.tiles,...p,...v},d},dy=()=>{const e=t2({pos:{x:0,y:0,z:0},width:74,height:39,minRoomSize:8,maxRoomSize:18,maxRoomCount:100}),t=Object.values(e.tiles);for(const r of t){if(r.sprite==="WALL"){const{x:n,y:i,z:o}=r;z.world.add({...Ut.cloneDeep(XO),position:{x:n,y:i,z:o}})}if(r.sprite==="FLOOR"){const{x:n,y:i,z:o}=r;z.world.add({...Ut.cloneDeep(VO),position:{x:n,y:i,z:o}})}}return e.rooms.forEach((r,n)=>{const i=Ut.sample([qO,KO,ZO]);if(n&&z.world.add({...Ut.cloneDeep(i),position:r.center}),n===1){const{x:o,y:l,z:h}=Ut.sample(r.tiles)||{x:0,y:0,z:0};z.world.add({...Ut.cloneDeep(jO),position:{x:o,y:l,z:h}})}if(n===2){const{x:o,y:l,z:h}=Ut.sample(r.tiles)||{x:0,y:0,z:0};z.world.add({...Ut.cloneDeep(YO),position:{x:o,y:l,z:h}})}}),e};var ac=(e=>(e.up="up",e.down="down",e))(ac||{});class e2{constructor(){zt(this,"_world",new GO);zt(this,"_entityById",new Map);zt(this,"_zones",new Map)}get world(){return this._world}get registry(){return this._entityById}get zones(){return this._zones}clearEntities(t=[]){for(const r of[...this.world.entities])t.includes(r.id)||this.world.remove(r)}saveZone(t){var r,n;this.zones.has(t)||this.zones.set(t,new Set),(r=this.zones.get(t))==null||r.clear();for(const i of z.world.entities)(n=this.zones.get(t))==null||n.add(i.id)}saveGameData(){const{log:t,zoneId:r,playerId:n,version:i}=ft();this.saveZone(r);const o={registry:r2(this.registry),zones:n2(this.zones),state:{log:t,zoneId:r,playerId:n,version:i}};localStorage.setItem("gameData",JSON.stringify(o))}changeZone(t,r){var h;const{playerId:n}=ft(),i=this.registry.get(n),o=((h=i==null?void 0:i.container)==null?void 0:h.contents)||[],l=[n,...o];if(su(r),this.clearEntities(l),this.zones.has(t)){const u=z.world.with("position").without("blocking"),f=this.zones.get(t);if(!f)return;for(const d of f){const p=this.registry.get(d);if(!p)return;this.world.add(p)}for(const d of u)if(d){if(!i)return;const p=su(r);if(!p)return;for(const g of p)i.position={...g.position};break}}else{dy();const u=z.registry.get(n);if(u){const f=su(r);if(!f)return;for(const d of f)u.position={...d.position}}}kt(u=>u.zoneId=t),this.saveZone(t)}loadGameData(){const t=localStorage.getItem("gameData");if(!t)return;const{registry:r,state:n,zones:i}=JSON.parse(t);this.registry.clear(),this.zones.clear(),this.clearEntities();for(const d of Object.values(r))this.world.add(d);for(const[d,p]of i)this.zones.set(d,new Set(p));this.clearEntities();const o=this.zones.get(n.zoneId);if(o)for(const d of o){const p=this.registry.get(d);p&&this.world.add(p)}const{log:l,zoneId:h,playerId:u,version:f}=n;kt(d=>{d.log=l,d.zoneId=h,d.playerId=u,d.version=f})}}const z=new e2;z.world.onEntityAdded.subscribe(e=>{let t=self.crypto.randomUUID();e.id||(e.id=t),e.id&&z.registry.set(e.id,e)});const r2=e=>{const t={};for(let[r,n]of e)t[r]=n;return t},n2=e=>Array.from(e.entries()).map(([t,r])=>[t,Array.from(r)]),su=e=>{const t=z.world.with("stairsUp","position"),r=z.world.with("stairsDown","position");if(e==="up")return r;if(e==="down")return t},i2=z.world.with("activeEffects"),ou=()=>{for(const e of i2){const{activeEffects:t}=e;t.forEach(r=>{const n=e[r.component];n&&(n.current+=r.delta)}),t.splice(0,t.length)}};var Mc={exports:{}};Mc.exports;(function(e){(function(){var t,r,n,i,o,l,h,u,f,d,p,g,v,y,w;n=Math.floor,d=Math.min,r=function(x,T){return x<T?-1:x>T?1:0},f=function(x,T,S,E,I){var D;if(S==null&&(S=0),I==null&&(I=r),S<0)throw new Error("lo must be non-negative");for(E==null&&(E=x.length);S<E;)D=n((S+E)/2),I(T,x[D])<0?E=D:S=D+1;return[].splice.apply(x,[S,S-S].concat(T)),T},l=function(x,T,S){return S==null&&(S=r),x.push(T),y(x,0,x.length-1,S)},o=function(x,T){var S,E;return T==null&&(T=r),S=x.pop(),x.length?(E=x[0],x[0]=S,w(x,0,T)):E=S,E},u=function(x,T,S){var E;return S==null&&(S=r),E=x[0],x[0]=T,w(x,0,S),E},h=function(x,T,S){var E;return S==null&&(S=r),x.length&&S(x[0],T)<0&&(E=[x[0],T],T=E[0],x[0]=E[1],w(x,0,S)),T},i=function(x,T){var S,E,I,D,L,O;for(T==null&&(T=r),D=(function(){O=[];for(var F=0,X=n(x.length/2);0<=X?F<X:F>X;0<=X?F++:F--)O.push(F);return O}).apply(this).reverse(),L=[],E=0,I=D.length;E<I;E++)S=D[E],L.push(w(x,S,T));return L},v=function(x,T,S){var E;if(S==null&&(S=r),E=x.indexOf(T),E!==-1)return y(x,0,E,S),w(x,E,S)},p=function(x,T,S){var E,I,D,L,O;if(S==null&&(S=r),I=x.slice(0,T),!I.length)return I;for(i(I,S),O=x.slice(T),D=0,L=O.length;D<L;D++)E=O[D],h(I,E,S);return I.sort(S).reverse()},g=function(x,T,S){var E,I,D,L,O,F,X,q,V;if(S==null&&(S=r),T*10<=x.length){if(D=x.slice(0,T).sort(S),!D.length)return D;for(I=D[D.length-1],X=x.slice(T),L=0,F=X.length;L<F;L++)E=X[L],S(E,I)<0&&(f(D,E,0,null,S),D.pop(),I=D[D.length-1]);return D}for(i(x,S),V=[],O=0,q=d(T,x.length);0<=q?O<q:O>q;0<=q?++O:--O)V.push(o(x,S));return V},y=function(x,T,S,E){var I,D,L;for(E==null&&(E=r),I=x[S];S>T;){if(L=S-1>>1,D=x[L],E(I,D)<0){x[S]=D,S=L;continue}break}return x[S]=I},w=function(x,T,S){var E,I,D,L,O;for(S==null&&(S=r),I=x.length,O=T,D=x[T],E=2*T+1;E<I;)L=E+1,L<I&&!(S(x[E],x[L])<0)&&(E=L),x[T]=x[E],T=E,E=2*T+1;return x[T]=D,y(x,O,T,S)},t=function(){x.push=l,x.pop=o,x.replace=u,x.pushpop=h,x.heapify=i,x.updateItem=v,x.nlargest=p,x.nsmallest=g;function x(T){this.cmp=T??r,this.nodes=[]}return x.prototype.push=function(T){return l(this.nodes,T,this.cmp)},x.prototype.pop=function(){return o(this.nodes,this.cmp)},x.prototype.peek=function(){return this.nodes[0]},x.prototype.contains=function(T){return this.nodes.indexOf(T)!==-1},x.prototype.replace=function(T){return u(this.nodes,T,this.cmp)},x.prototype.pushpop=function(T){return h(this.nodes,T,this.cmp)},x.prototype.heapify=function(){return i(this.nodes,this.cmp)},x.prototype.updateItem=function(T){return v(this.nodes,T,this.cmp)},x.prototype.clear=function(){return this.nodes=[]},x.prototype.empty=function(){return this.nodes.length===0},x.prototype.size=function(){return this.nodes.length},x.prototype.clone=function(){var T;return T=new x,T.nodes=this.nodes.slice(0),T},x.prototype.toArray=function(){return this.nodes.slice(0)},x.prototype.insert=x.prototype.push,x.prototype.top=x.prototype.peek,x.prototype.front=x.prototype.peek,x.prototype.has=x.prototype.contains,x.prototype.copy=x.prototype.clone,x}(),e!==null&&e.exports?e.exports=t:window.Heap=t}).call(Dr)})(Mc);var s2=Mc.exports,tl=s2;function o2(e,t,r){this.x=e,this.y=t,this.walkable=r===void 0?!0:r}var Dc=o2,a2={Always:1,Never:2,IfAtMostOneObstacle:3,OnlyWhenNoObstacles:4},nr=a2,py=Dc,oa=nr;function en(e,t,r){var n;typeof e!="object"?n=e:(t=e.length,n=e[0].length,r=e),this.width=n,this.height=t,this.nodes=this._buildNodes(n,t,r)}en.prototype._buildNodes=function(e,t,r){var n,i,o=new Array(t);for(n=0;n<t;++n)for(o[n]=new Array(e),i=0;i<e;++i)o[n][i]=new py(i,n);if(r===void 0)return o;if(r.length!==t||r[0].length!==e)throw new Error("Matrix size does not fit");for(n=0;n<t;++n)for(i=0;i<e;++i)r[n][i]&&(o[n][i].walkable=!1);return o};en.prototype.getNodeAt=function(e,t){return this.nodes[t][e]};en.prototype.isWalkableAt=function(e,t){return this.isInside(e,t)&&this.nodes[t][e].walkable};en.prototype.isInside=function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height};en.prototype.setWalkableAt=function(e,t,r){this.nodes[t][e].walkable=r};en.prototype.getNeighbors=function(e,t){var r=e.x,n=e.y,i=[],o=!1,l=!1,h=!1,u=!1,f=!1,d=!1,p=!1,g=!1,v=this.nodes;if(this.isWalkableAt(r,n-1)&&(i.push(v[n-1][r]),o=!0),this.isWalkableAt(r+1,n)&&(i.push(v[n][r+1]),h=!0),this.isWalkableAt(r,n+1)&&(i.push(v[n+1][r]),f=!0),this.isWalkableAt(r-1,n)&&(i.push(v[n][r-1]),p=!0),t===oa.Never)return i;if(t===oa.OnlyWhenNoObstacles)l=p&&o,u=o&&h,d=h&&f,g=f&&p;else if(t===oa.IfAtMostOneObstacle)l=p||o,u=o||h,d=h||f,g=f||p;else if(t===oa.Always)l=!0,u=!0,d=!0,g=!0;else throw new Error("Incorrect value of diagonalMovement");return l&&this.isWalkableAt(r-1,n-1)&&i.push(v[n-1][r-1]),u&&this.isWalkableAt(r+1,n-1)&&i.push(v[n-1][r+1]),d&&this.isWalkableAt(r+1,n+1)&&i.push(v[n+1][r+1]),g&&this.isWalkableAt(r-1,n+1)&&i.push(v[n+1][r-1]),i};en.prototype.clone=function(){var e,t,r=this.width,n=this.height,i=this.nodes,o=new en(r,n),l=new Array(n);for(e=0;e<n;++e)for(l[e]=new Array(r),t=0;t<r;++t)l[e][t]=new py(t,e,i[e][t].walkable);return o.nodes=l,o};var l2=en,Ve={};function lc(e){for(var t=[[e.x,e.y]];e.parent;)e=e.parent,t.push([e.x,e.y]);return t.reverse()}Ve.backtrace=lc;function h2(e,t){var r=lc(e),n=lc(t);return r.concat(n.reverse())}Ve.biBacktrace=h2;function u2(e){var t,r=0,n,i,o,l;for(t=1;t<e.length;++t)n=e[t-1],i=e[t],o=n[0]-i[0],l=n[1]-i[1],r+=Math.sqrt(o*o+l*l);return r}Ve.pathLength=u2;function Bc(e,t,r,n){var i=Math.abs,o=[],l,h,u,f,d,p;for(u=i(r-e),f=i(n-t),l=e<r?1:-1,h=t<n?1:-1,d=u-f;o.push([e,t]),!(e===r&&t===n);)p=2*d,p>-f&&(d=d-f,e=e+l),p<u&&(d=d+u,t=t+h);return o}Ve.interpolate=Bc;function c2(e){var t=[],r=e.length,n,i,o,l,h,u;if(r<2)return t;for(h=0;h<r-1;++h)for(n=e[h],i=e[h+1],o=Bc(n[0],n[1],i[0],i[1]),l=o.length,u=0;u<l-1;++u)t.push(o[u]);return t.push(e[r-1]),t}Ve.expandPath=c2;function f2(e,t){var r=t.length,n=t[0][0],i=t[0][1],o=t[r-1][0],l=t[r-1][1],h,u,f,d,p,g,v,y,w,x,T;for(h=n,u=i,p=[[h,u]],g=2;g<r;++g){for(y=t[g],f=y[0],d=y[1],w=Bc(h,u,f,d),T=!1,v=1;v<w.length;++v)if(x=w[v],!e.isWalkableAt(x[0],x[1])){T=!0;break}T&&(lastValidCoord=t[g-1],p.push(lastValidCoord),h=lastValidCoord[0],u=lastValidCoord[1])}return p.push([o,l]),p}Ve.smoothenPath=f2;function d2(e){if(e.length<3)return e;var t=[],r=e[0][0],n=e[0][1],i=e[1][0],o=e[1][1],l=i-r,h=o-n,u,f,d,p,g,v;for(g=Math.sqrt(l*l+h*h),l/=g,h/=g,t.push([r,n]),v=2;v<e.length;v++)u=i,f=o,d=l,p=h,i=e[v][0],o=e[v][1],l=i-u,h=o-f,g=Math.sqrt(l*l+h*h),l/=g,h/=g,(l!==d||h!==p)&&t.push([u,f]);return t.push([i,o]),t}Ve.compressPath=d2;var Xs={manhattan:function(e,t){return e+t},euclidean:function(e,t){return Math.sqrt(e*e+t*t)},octile:function(e,t){var r=Math.SQRT2-1;return e<t?r*e+t:r*t+e},chebyshev:function(e,t){return Math.max(e,t)}},p2=tl,g2=Ve,au=Xs,aa=nr;function gy(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.heuristic=e.heuristic||au.manhattan,this.weight=e.weight||1,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=aa.OnlyWhenNoObstacles:this.diagonalMovement=aa.IfAtMostOneObstacle:this.diagonalMovement=aa.Never),this.diagonalMovement===aa.Never?this.heuristic=e.heuristic||au.manhattan:this.heuristic=e.heuristic||au.octile}gy.prototype.findPath=function(e,t,r,n,i){var o=new p2(function(D,L){return D.f-L.f}),l=i.getNodeAt(e,t),h=i.getNodeAt(r,n),u=this.heuristic,f=this.diagonalMovement,d=this.weight,p=Math.abs,g=Math.SQRT2,v,y,w,x,T,S,E,I;for(l.g=0,l.f=0,o.push(l),l.opened=!0;!o.empty();){if(v=o.pop(),v.closed=!0,v===h)return g2.backtrace(h);for(y=i.getNeighbors(v,f),x=0,T=y.length;x<T;++x)w=y[x],!w.closed&&(S=w.x,E=w.y,I=v.g+(S-v.x===0||E-v.y===0?1:g),(!w.opened||I<w.g)&&(w.g=I,w.h=w.h||d*u(p(S-r),p(E-n)),w.f=w.g+w.h,w.parent=v,w.opened?o.updateItem(w):(o.push(w),w.opened=!0)))}return[]};var Oc=gy,my=Oc;function Ua(e){my.call(this,e);var t=this.heuristic;this.heuristic=function(r,n){return t(r,n)*1e6}}Ua.prototype=new my;Ua.prototype.constructor=Ua;var m2=Ua,v2=Ve,lu=nr;function vy(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=lu.OnlyWhenNoObstacles:this.diagonalMovement=lu.IfAtMostOneObstacle:this.diagonalMovement=lu.Never)}vy.prototype.findPath=function(e,t,r,n,i){var o=[],l=this.diagonalMovement,h=i.getNodeAt(e,t),u=i.getNodeAt(r,n),f,d,p,g,v;for(o.push(h),h.opened=!0;o.length;){if(p=o.shift(),p.closed=!0,p===u)return v2.backtrace(u);for(f=i.getNeighbors(p,l),g=0,v=f.length;g<v;++g)d=f[g],!(d.closed||d.opened)&&(o.push(d),d.opened=!0,d.parent=p)}return[]};var y2=vy,yy=Oc;function Ga(e){yy.call(this,e),this.heuristic=function(t,r){return 0}}Ga.prototype=new yy;Ga.prototype.constructor=Ga;var _2=Ga,Jg=tl,Qg=Ve,hu=Xs,la=nr;function _y(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.heuristic=e.heuristic||hu.manhattan,this.weight=e.weight||1,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=la.OnlyWhenNoObstacles:this.diagonalMovement=la.IfAtMostOneObstacle:this.diagonalMovement=la.Never),this.diagonalMovement===la.Never?this.heuristic=e.heuristic||hu.manhattan:this.heuristic=e.heuristic||hu.octile}_y.prototype.findPath=function(e,t,r,n,i){var o=function(X,q){return X.f-q.f},l=new Jg(o),h=new Jg(o),u=i.getNodeAt(e,t),f=i.getNodeAt(r,n),d=this.heuristic,p=this.diagonalMovement,g=this.weight,v=Math.abs,y=Math.SQRT2,w,x,T,S,E,I,D,L,O=1,F=2;for(u.g=0,u.f=0,l.push(u),u.opened=O,f.g=0,f.f=0,h.push(f),f.opened=F;!l.empty()&&!h.empty();){for(w=l.pop(),w.closed=!0,x=i.getNeighbors(w,p),S=0,E=x.length;S<E;++S)if(T=x[S],!T.closed){if(T.opened===F)return Qg.biBacktrace(w,T);I=T.x,D=T.y,L=w.g+(I-w.x===0||D-w.y===0?1:y),(!T.opened||L<T.g)&&(T.g=L,T.h=T.h||g*d(v(I-r),v(D-n)),T.f=T.g+T.h,T.parent=w,T.opened?l.updateItem(T):(l.push(T),T.opened=O))}for(w=h.pop(),w.closed=!0,x=i.getNeighbors(w,p),S=0,E=x.length;S<E;++S)if(T=x[S],!T.closed){if(T.opened===O)return Qg.biBacktrace(T,w);I=T.x,D=T.y,L=w.g+(I-w.x===0||D-w.y===0?1:y),(!T.opened||L<T.g)&&(T.g=L,T.h=T.h||g*d(v(I-e),v(D-t)),T.f=T.g+T.h,T.parent=w,T.opened?h.updateItem(T):(h.push(T),T.opened=F))}}return[]};var Fc=_y,xy=Fc;function $a(e){xy.call(this,e);var t=this.heuristic;this.heuristic=function(r,n){return t(r,n)*1e6}}$a.prototype=new xy;$a.prototype.constructor=$a;var x2=$a,tm=Ve,uu=nr;function by(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=uu.OnlyWhenNoObstacles:this.diagonalMovement=uu.IfAtMostOneObstacle:this.diagonalMovement=uu.Never)}by.prototype.findPath=function(e,t,r,n,i){var o=i.getNodeAt(e,t),l=i.getNodeAt(r,n),h=[],u=[],f,d,p,g=this.diagonalMovement,v=0,y=1,w,x;for(h.push(o),o.opened=!0,o.by=v,u.push(l),l.opened=!0,l.by=y;h.length&&u.length;){for(p=h.shift(),p.closed=!0,f=i.getNeighbors(p,g),w=0,x=f.length;w<x;++w)if(d=f[w],!d.closed){if(d.opened){if(d.by===y)return tm.biBacktrace(p,d);continue}h.push(d),d.parent=p,d.opened=!0,d.by=v}for(p=u.shift(),p.closed=!0,f=i.getNeighbors(p,g),w=0,x=f.length;w<x;++w)if(d=f[w],!d.closed){if(d.opened){if(d.by===v)return tm.biBacktrace(d,p);continue}u.push(d),d.parent=p,d.opened=!0,d.by=y}}return[]};var b2=by,wy=Fc;function Wa(e){wy.call(this,e),this.heuristic=function(t,r){return 0}}Wa.prototype=new wy;Wa.prototype.constructor=Wa;var w2=Wa,cu=Xs,em=Dc,ha=nr;function Ey(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.heuristic=e.heuristic||cu.manhattan,this.weight=e.weight||1,this.trackRecursion=e.trackRecursion||!1,this.timeLimit=e.timeLimit||1/0,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=ha.OnlyWhenNoObstacles:this.diagonalMovement=ha.IfAtMostOneObstacle:this.diagonalMovement=ha.Never),this.diagonalMovement===ha.Never?this.heuristic=e.heuristic||cu.manhattan:this.heuristic=e.heuristic||cu.octile}Ey.prototype.findPath=function(e,t,r,n,i){var o=new Date().getTime(),l=(function(w,x){return this.heuristic(Math.abs(x.x-w.x),Math.abs(x.y-w.y))}).bind(this),h=function(w,x){return w.x===x.x||w.y===x.y?1:Math.SQRT2},u=(function(w,x,T,S,E){if(this.timeLimit>0&&new Date().getTime()-o>this.timeLimit*1e3)return 1/0;var I=x+l(w,d)*this.weight;if(I>T)return I;if(w==d)return S[E]=[w.x,w.y],w;var D,L,O,F,X=i.getNeighbors(w,this.diagonalMovement);for(O=0,D=1/0;F=X[O];++O){if(this.trackRecursion&&(F.retainCount=F.retainCount+1||1,F.tested!==!0&&(F.tested=!0)),L=u(F,x+h(w,F),T,S,E+1),L instanceof em)return S[E]=[w.x,w.y],L;this.trackRecursion&&--F.retainCount===0&&(F.tested=!1),L<D&&(D=L)}return D}).bind(this),f=i.getNodeAt(e,t),d=i.getNodeAt(r,n),p=l(f,d),g,v,y;for(g=0;;++g){if(v=[],y=u(f,0,p,v,0),y===1/0)return[];if(y instanceof em)return v;p=y}return[]};var E2=Ey,T2=tl,rm=Ve,Ty=Xs;function Lc(e){e=e||{},this.heuristic=e.heuristic||Ty.manhattan,this.trackJumpRecursion=e.trackJumpRecursion||!1}Lc.prototype.findPath=function(e,t,r,n,i){var o=this.openList=new T2(function(f,d){return f.f-d.f}),l=this.startNode=i.getNodeAt(e,t),h=this.endNode=i.getNodeAt(r,n),u;for(this.grid=i,l.g=0,l.f=0,o.push(l),l.opened=!0;!o.empty();){if(u=o.pop(),u.closed=!0,u===h)return rm.expandPath(rm.backtrace(h));this._identifySuccessors(u)}return[]};Lc.prototype._identifySuccessors=function(e){var t=this.grid,r=this.heuristic,n=this.openList,i=this.endNode.x,o=this.endNode.y,l,h,u,f,d,p=e.x,g=e.y,v,y,w,x,T,S=Math.abs;for(l=this._findNeighbors(e),f=0,d=l.length;f<d;++f)if(h=l[f],u=this._jump(h[0],h[1],p,g),u){if(v=u[0],y=u[1],T=t.getNodeAt(v,y),T.closed)continue;w=Ty.octile(S(v-p),S(y-g)),x=e.g+w,(!T.opened||x<T.g)&&(T.g=x,T.h=T.h||r(S(v-i),S(y-o)),T.f=T.g+T.h,T.parent=e,T.opened?n.updateItem(T):(n.push(T),T.opened=!0))}};var el=Lc,Ay=el,A2=nr;function zi(e){Ay.call(this,e)}zi.prototype=new Ay;zi.prototype.constructor=zi;zi.prototype._jump=function(e,t,r,n){var i=this.grid,o=e-r,l=t-n;if(!i.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(i.getNodeAt(e,t).tested=!0),i.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0){if(i.isWalkableAt(e,t-1)&&!i.isWalkableAt(e-o,t-1)||i.isWalkableAt(e,t+1)&&!i.isWalkableAt(e-o,t+1))return[e,t]}else if(l!==0){if(i.isWalkableAt(e-1,t)&&!i.isWalkableAt(e-1,t-l)||i.isWalkableAt(e+1,t)&&!i.isWalkableAt(e+1,t-l))return[e,t];if(this._jump(e+1,t,e,t)||this._jump(e-1,t,e,t))return[e,t]}else throw new Error("Only horizontal and vertical movements are allowed");return this._jump(e+o,t+l,e,t)};zi.prototype._findNeighbors=function(e){var t=e.parent,r=e.x,n=e.y,i=this.grid,o,l,h,u,f=[],d,p,g,v;if(t)o=t.x,l=t.y,h=(r-o)/Math.max(Math.abs(r-o),1),u=(n-l)/Math.max(Math.abs(n-l),1),h!==0?(i.isWalkableAt(r,n-1)&&f.push([r,n-1]),i.isWalkableAt(r,n+1)&&f.push([r,n+1]),i.isWalkableAt(r+h,n)&&f.push([r+h,n])):u!==0&&(i.isWalkableAt(r-1,n)&&f.push([r-1,n]),i.isWalkableAt(r+1,n)&&f.push([r+1,n]),i.isWalkableAt(r,n+u)&&f.push([r,n+u]));else for(d=i.getNeighbors(e,A2.Never),g=0,v=d.length;g<v;++g)p=d[g],f.push([p.x,p.y]);return f};var S2=zi,Sy=el,C2=nr;function Xi(e){Sy.call(this,e)}Xi.prototype=new Sy;Xi.prototype.constructor=Xi;Xi.prototype._jump=function(e,t,r,n){var i=this.grid,o=e-r,l=t-n;if(!i.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(i.getNodeAt(e,t).tested=!0),i.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0&&l!==0){if(i.isWalkableAt(e-o,t+l)&&!i.isWalkableAt(e-o,t)||i.isWalkableAt(e+o,t-l)&&!i.isWalkableAt(e,t-l))return[e,t];if(this._jump(e+o,t,e,t)||this._jump(e,t+l,e,t))return[e,t]}else if(o!==0){if(i.isWalkableAt(e+o,t+1)&&!i.isWalkableAt(e,t+1)||i.isWalkableAt(e+o,t-1)&&!i.isWalkableAt(e,t-1))return[e,t]}else if(i.isWalkableAt(e+1,t+l)&&!i.isWalkableAt(e+1,t)||i.isWalkableAt(e-1,t+l)&&!i.isWalkableAt(e-1,t))return[e,t];return this._jump(e+o,t+l,e,t)};Xi.prototype._findNeighbors=function(e){var t=e.parent,r=e.x,n=e.y,i=this.grid,o,l,h,u,f=[],d,p,g,v;if(t)o=t.x,l=t.y,h=(r-o)/Math.max(Math.abs(r-o),1),u=(n-l)/Math.max(Math.abs(n-l),1),h!==0&&u!==0?(i.isWalkableAt(r,n+u)&&f.push([r,n+u]),i.isWalkableAt(r+h,n)&&f.push([r+h,n]),i.isWalkableAt(r+h,n+u)&&f.push([r+h,n+u]),i.isWalkableAt(r-h,n)||f.push([r-h,n+u]),i.isWalkableAt(r,n-u)||f.push([r+h,n-u])):h===0?(i.isWalkableAt(r,n+u)&&f.push([r,n+u]),i.isWalkableAt(r+1,n)||f.push([r+1,n+u]),i.isWalkableAt(r-1,n)||f.push([r-1,n+u])):(i.isWalkableAt(r+h,n)&&f.push([r+h,n]),i.isWalkableAt(r,n+1)||f.push([r+h,n+1]),i.isWalkableAt(r,n-1)||f.push([r+h,n-1]));else for(d=i.getNeighbors(e,C2.Always),g=0,v=d.length;g<v;++g)p=d[g],f.push([p.x,p.y]);return f};var I2=Xi,Cy=el,P2=nr;function Vi(e){Cy.call(this,e)}Vi.prototype=new Cy;Vi.prototype.constructor=Vi;Vi.prototype._jump=function(e,t,r,n){var i=this.grid,o=e-r,l=t-n;if(!i.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(i.getNodeAt(e,t).tested=!0),i.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0&&l!==0){if(this._jump(e+o,t,e,t)||this._jump(e,t+l,e,t))return[e,t]}else if(o!==0){if(i.isWalkableAt(e,t-1)&&!i.isWalkableAt(e-o,t-1)||i.isWalkableAt(e,t+1)&&!i.isWalkableAt(e-o,t+1))return[e,t]}else if(l!==0&&(i.isWalkableAt(e-1,t)&&!i.isWalkableAt(e-1,t-l)||i.isWalkableAt(e+1,t)&&!i.isWalkableAt(e+1,t-l)))return[e,t];return i.isWalkableAt(e+o,t)&&i.isWalkableAt(e,t+l)?this._jump(e+o,t+l,e,t):null};Vi.prototype._findNeighbors=function(e){var t=e.parent,r=e.x,n=e.y,i=this.grid,o,l,h,u,f=[],d,p,g,v;if(t)if(o=t.x,l=t.y,h=(r-o)/Math.max(Math.abs(r-o),1),u=(n-l)/Math.max(Math.abs(n-l),1),h!==0&&u!==0)i.isWalkableAt(r,n+u)&&f.push([r,n+u]),i.isWalkableAt(r+h,n)&&f.push([r+h,n]),i.isWalkableAt(r,n+u)&&i.isWalkableAt(r+h,n)&&f.push([r+h,n+u]);else{var y;if(h!==0){y=i.isWalkableAt(r+h,n);var w=i.isWalkableAt(r,n+1),x=i.isWalkableAt(r,n-1);y&&(f.push([r+h,n]),w&&f.push([r+h,n+1]),x&&f.push([r+h,n-1])),w&&f.push([r,n+1]),x&&f.push([r,n-1])}else if(u!==0){y=i.isWalkableAt(r,n+u);var T=i.isWalkableAt(r+1,n),S=i.isWalkableAt(r-1,n);y&&(f.push([r,n+u]),T&&f.push([r+1,n+u]),S&&f.push([r-1,n+u])),T&&f.push([r+1,n]),S&&f.push([r-1,n])}}else for(d=i.getNeighbors(e,P2.OnlyWhenNoObstacles),g=0,v=d.length;g<v;++g)p=d[g],f.push([p.x,p.y]);return f};var R2=Vi,Iy=el,M2=nr;function Yi(e){Iy.call(this,e)}Yi.prototype=new Iy;Yi.prototype.constructor=Yi;Yi.prototype._jump=function(e,t,r,n){var i=this.grid,o=e-r,l=t-n;if(!i.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(i.getNodeAt(e,t).tested=!0),i.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0&&l!==0){if(i.isWalkableAt(e-o,t+l)&&!i.isWalkableAt(e-o,t)||i.isWalkableAt(e+o,t-l)&&!i.isWalkableAt(e,t-l))return[e,t];if(this._jump(e+o,t,e,t)||this._jump(e,t+l,e,t))return[e,t]}else if(o!==0){if(i.isWalkableAt(e+o,t+1)&&!i.isWalkableAt(e,t+1)||i.isWalkableAt(e+o,t-1)&&!i.isWalkableAt(e,t-1))return[e,t]}else if(i.isWalkableAt(e+1,t+l)&&!i.isWalkableAt(e+1,t)||i.isWalkableAt(e-1,t+l)&&!i.isWalkableAt(e-1,t))return[e,t];return i.isWalkableAt(e+o,t)||i.isWalkableAt(e,t+l)?this._jump(e+o,t+l,e,t):null};Yi.prototype._findNeighbors=function(e){var t=e.parent,r=e.x,n=e.y,i=this.grid,o,l,h,u,f=[],d,p,g,v;if(t)o=t.x,l=t.y,h=(r-o)/Math.max(Math.abs(r-o),1),u=(n-l)/Math.max(Math.abs(n-l),1),h!==0&&u!==0?(i.isWalkableAt(r,n+u)&&f.push([r,n+u]),i.isWalkableAt(r+h,n)&&f.push([r+h,n]),(i.isWalkableAt(r,n+u)||i.isWalkableAt(r+h,n))&&f.push([r+h,n+u]),!i.isWalkableAt(r-h,n)&&i.isWalkableAt(r,n+u)&&f.push([r-h,n+u]),!i.isWalkableAt(r,n-u)&&i.isWalkableAt(r+h,n)&&f.push([r+h,n-u])):h===0?i.isWalkableAt(r,n+u)&&(f.push([r,n+u]),i.isWalkableAt(r+1,n)||f.push([r+1,n+u]),i.isWalkableAt(r-1,n)||f.push([r-1,n+u])):i.isWalkableAt(r+h,n)&&(f.push([r+h,n]),i.isWalkableAt(r,n+1)||f.push([r+h,n+1]),i.isWalkableAt(r,n-1)||f.push([r+h,n-1]));else for(d=i.getNeighbors(e,M2.IfAtMostOneObstacle),g=0,v=d.length;g<v;++g)p=d[g],f.push([p.x,p.y]);return f};var D2=Yi,fu=nr,B2=S2,O2=I2,F2=R2,L2=D2;function N2(e){return e=e||{},e.diagonalMovement===fu.Never?new B2(e):e.diagonalMovement===fu.Always?new O2(e):e.diagonalMovement===fu.OnlyWhenNoObstacles?new F2(e):new L2(e)}var k2=N2,U2={Heap:tl,Node:Dc,Grid:l2,Util:Ve,DiagonalMovement:nr,Heuristic:Xs,AStarFinder:Oc,BestFirstFinder:m2,BreadthFirstFinder:y2,DijkstraFinder:_2,BiAStarFinder:Fc,BiBestFirstFinder:x2,BiBreadthFirstFinder:b2,BiDijkstraFinder:w2,IDAStarFinder:E2,JumpPointFinder:k2},G2=U2;const nm=Ha(G2),$2=z.world.with("position"),W2=(e,t)=>{const{width:r,height:n}=ft().views.map,i=new nm.Grid(r,n);for(const h of $2)if(h.blocking&&!h.pathThrough){const{x:u,y:f}=h.position;i.setWalkableAt(u,f,!1)}return i.setWalkableAt(e.x,e.y,!0),i.setWalkableAt(t.x,t.y,!0),new nm.AStarFinder({}).findPath(e.x,e.y,t.x,t.y,i)},H2=z.world.with("pc","position"),z2=z.world.with("ai","position"),X2=()=>{const[e]=H2.entities;for(const t of z2){const r=W2(t.position,e.position);if(r[1]){const n={x:r[1][0],y:r[1][1],z:t.position.z};z.world.addComponent(t,"tryMove",n)}}},V2=z.world.with("revealed","position"),im=()=>{const e=yr(ft().cursor[1]),t=[],r=[],n=[];for(const i of V2)e===yr(i.position)&&(i.layer100&&t.push(i),i.layer200&&r.push(i),i.layer300&&n.push(i));if(t.length){let i="";const o=[];if(t.forEach(l=>o.push(l.name)),t[0].inFov?i+="You see ":i+="You recall seeing ",n.length||r.length){const l=[];n.forEach(h=>l.push(h.name)),r.forEach(h=>l.push(h.name)),l.length&&(l.forEach((h,u)=>{l.length>1&&u===l.length-1?i+=`and a ${h} `:i+=`a ${h} `}),i+=`on the ${o[0]}`)}else i+=`the ${o[0]}`;kt(l=>{l.senses.see=i})}else kt(i=>{i.senses.see="You see nothing."})},Y2=[{xx:1,xy:0,yx:0,yy:1},{xx:1,xy:0,yx:0,yy:-1},{xx:-1,xy:0,yx:0,yy:1},{xx:-1,xy:0,yx:0,yy:-1},{xx:0,xy:1,yx:1,yy:0},{xx:0,xy:1,yx:-1,yy:0},{xx:0,xy:-1,yx:1,yy:0},{xx:0,xy:-1,yx:-1,yy:0}];function j2(e,t,r,n,i){const{x:o,y:l,z:h}=n,u=new Set,f=new Set;for(const v of e)v.position.z===h&&f.add(yr(v.position));const d=(v,y)=>{const w=`${v},${y},${h}`;return!!f.has(w)},p=(v,y)=>u.add(`${v},${y},${h}`);function g(v,y,w,x,T,S,E){let I=0;if(x<T)return;let D=!1;for(let L=w;L<E&&!D;L++){const O=-L;for(let F=-L;F<=0;F++){const X=v+F*S.xx+O*S.xy,q=y+F*S.yx+O*S.yy,V=(F-.5)/(O+.5),Z=(F+.5)/(O-.5);if(!(!(X>=0&&q>=0&&X<t&&q<r)||x<Z)){if(T>V)break;if(Math.sqrt(F*F+O*O)<=E&&p(X,q),D)if(d(X,q)){I=Z;continue}else D=!1,x=I;else d(X,q)&&L<E&&(D=!0,g(v,y,L+1,x,V,S,E),I=Z)}}}}p(o,l);for(const v of Y2)g(o,l,1,1,0,v,i);return{fov:u}}const q2=z.world.with("inFov","position"),K2=z.world.with("opaque","position"),Z2=z.world.with("pc","position"),J2=z.world.with("appearance","position"),ba=()=>{let e;for(const r of Z2)e=r;if(!e)return;const t=j2(K2,74,39,e.position,10);for(const r of q2)z.world.removeComponent(r,"inFov");for(const r of J2)t.fov.has(yr(r.position))&&(z.world.addComponent(r,"inFov",!0),z.world.addComponent(r,"revealed",!0))},Q2=z.world.with("tryDrop"),sm=()=>{var e;for(const t of Q2){const r=t.tryDrop.dropperId,n=z.registry.get(r);if(!n){console.log(`dropperId: ${r} does not exist`),Pe(t),z.world.removeComponent(t,"tryDrop");break}const i=t.id;if(!i){console.log("Entity does not have an id."),Pe(t),z.world.removeComponent(t,"tryDrop");break}if(!((e=n==null?void 0:n.container)!=null&&e.contents.includes(i))){console.log(`${n.name} is not holding ${t.name}`),Pe(n),Pe(t),z.world.removeComponent(t,"tryDrop");break}const{position:o}=n;if(!o){console.log(`${n.name} has no position and cannot drop ${t.name}`),Pe(n),Pe(t),z.world.removeComponent(t,"tryDrop");break}z.world.addComponent(t,"position",{...o}),Ut.remove(n.container.contents,l=>i===l),z.world.removeComponent(t,"tryDrop"),me(`${n.name} drops ${t.name}`)}},tF=z.world.with("health").without("dead"),om=()=>{for(const e of tF)e.health.current<=0&&(e.appearance&&(e.appearance.char="%"),z.world.removeComponent(e,"ai"),z.world.removeComponent(e,"blocking"),z.world.removeComponent(e,"layer300"),z.world.addComponent(e,"dead",!0),z.world.addComponent(e,"pickUp",!0),z.world.addComponent(e,"layer200",!0),me(`${e.name} has died!`),e.pc&&(kt(t=>t.gameState=ee.GAME_OVER),console.log("Game Over!")))};function eF(e,t){let r=!1;(e.pc||t.pc)&&(r=!0);const n=Zv(),i=n===20,{armorClass:o}=t;if(!(!o||!t.health))if(n>=o){let l=Py(e,!1);if(i&&(l*=2),t.health.current-=l,r){let h=`${e.name} hits ${t.name} for ${l} hp!`;i&&(h=`Critical! ${h}`),me(h)}}else r&&me(`${e.name} misses ${t.name}!`)}function rF(e,t,r){let n=!1;(e.pc||t.pc)&&(n=!0);const i=Zv(),o=i===20,{armorClass:l}=t;if(!(!l||!t.health))if(i>=l){let h=Py(e,!0);if(o&&(h*=2),t.health.current-=h,n){let u=`${e.name} hits ${t.name} with ${r.name} for ${h} hp!`;o&&(u=`Critical! ${u}`),me(u)}}else n&&me(`${e.name} misses ${t.name}!`)}function Py(e,t){let r=fO();return t?e.dexterity&&(r+=am(e.dexterity)):e.strength&&(r+=am(e.strength)),Math.max(0,r)}function am(e){return Math.floor((e-10)/2)}const nF=z.world.with("position","tryMove"),iF=z.world.with("blocking","position"),lm=()=>{for(const e of nF){const{position:t,tryMove:r}=e;let n=!1;for(const i of iF)if(i.position.x===r.x&&i.position.y===r.y){z.world.removeComponent(e,"tryMove"),i.health?eF(e,i):e.pc&&me(`${e.name} blocked by ${i.name}`),n=!0;break}n||(t.x=r.x,t.y=r.y,t.z=r.z,z.world.removeComponent(e,"tryMove"))}},sF=z.world.with("pc"),oF=z.world.with("tryPickUp"),aF=()=>{var t,r;const[e]=sF;for(const n of oF){if(!n.pickUp){console.log("Entity is not a pickup"),Pe(n);break}const{pickerId:i}=n.tryPickUp,o=z.registry.get(i);if(!o){console.log(`pickerId ${i} does not exist`);break}const{container:l}=o;if(!l){console.log("Picker has no container"),Pe(o),o===e&&me("You have nowhere to put that."),z.world.removeComponent(n,"tryPickUp");break}if(l.contents.length>=l.slots){console.log("Picker has no room in container"),Pe(o),o===e&&me(`You have no room in your ${(t=e==null?void 0:e.container)==null?void 0:t.name}.`),z.world.removeComponent(n,"tryPickUp");break}const h=n.id;if(Ut.isUndefined(h)){console.log(`pickupId ${h} does not exist`),z.world.removeComponent(n,"tryPickUp");break}l.contents.push(h),z.world.removeComponent(n,"tryPickUp"),z.world.removeComponent(n,"position"),me(`${o.name} puts ${n.name} in ${(r=o==null?void 0:o.container)==null?void 0:r.name}`)}},wi=(e,t)=>{let r=e;if(r.length>t){const n=r.length-(t-3);r=r.substring(0,r.length-n).trim().concat("...")}return r},lF=e=>e<4?(100-(5-e)*7)/100:1,du=z.world.with("position","appearance","layer100"),pu=z.world.with("position","appearance","layer200"),gu=z.world.with("position","appearance","layer300"),mu=z.world.with("position","appearance","layer400"),hF=z.world.with("inFov","legendable","position","appearance","name"),vu=z.world.with("pc","position"),er=(e,t,r)=>{const{appearance:n,position:i}=t;if(!n||!i)return;const{char:o,tint:l,tileSet:h}=n,{x:u,y:f}=i;e==null||e.updateCell({0:{char:o,tint:0,alpha:0,tileSet:"tile",x:u,y:f},1:{char:o,tint:l,alpha:r,tileSet:h,x:u,y:f}})},Ci=()=>{var i,o,l,h,u,f,d;const e=ft().views.map;if(!e)return;e.clearView();for(const p of du)p.inFov&&er(e,p,1);for(const p of pu)p.inFov&&er(e,p,1);for(const p of gu)p.inFov&&er(e,p,1);for(const p of mu)p.inFov&&er(e,p,1);for(const p of du)!p.inFov&&p.revealed&&er(e,p,.35);for(const p of pu)!p.inFov&&p.revealed&&er(e,p,.35);for(const p of gu)!p.inFov&&p.revealed&&er(e,p,.35);for(const p of mu)!p.inFov&&p.revealed&&er(e,p,.35);if(window.skulltooth.debug){for(const p of du)er(e,p,1);for(const p of pu)er(e,p,1);for(const p of gu)er(e,p,1);for(const p of mu)er(e,p,1)}{const p=ft().views.senses,g=ft().senses,v=p.width-1;p==null||p.updateRows([[{string:wi(g.feel,v)}],[{string:wi(g.see,v)}],[{string:wi(g.hear,v)}],[{string:wi(g.smell,v)}],[{string:wi(g.taste,v)}]])}{const p=ft().views.legend;if(p){const g=[],[v]=vu;for(const w of hF)g.push(w);g.sort(w=>uO(v.position,w.position)),p==null||p.clearView();const y=[];g.forEach(w=>{const x=w.appearance.char,T=w.name,S=`${x} ${T}`;y.push([{string:S}])}),p==null||p.updateRows(y)}}{const p=ft().views.menuUnderlay,g=ft().views.inventory;if(ft().gameState===ee.INVENTORY){const[v]=vu;if(!v)return;const w=(((i=v.container)==null?void 0:i.contents)||[]).map(T=>z.registry.get(T)),x=[[{},{string:"Inventory"}],[],[{},{string:`${(o=v.container)==null?void 0:o.name} [${(l=v.container)==null?void 0:l.contents.length}/${(h=v.container)==null?void 0:h.slots}]`}],[{},{string:`${(u=v.container)==null?void 0:u.description}`}],[],...w.map(T=>{var S;return[{},{string:`${(S=T==null?void 0:T.appearance)==null?void 0:S.char} ${T==null?void 0:T.name} ${T==null?void 0:T.description}`}]})];p==null||p.show(),g==null||g.clearView(),g==null||g.updateRows(x),g==null||g.show()}else p==null||p.hide(),g==null||g.hide()}{const p=ft().views.log;if(p){p.clearView();const g=ft().log,v=g.slice(Math.max(g.length-5,0)),y=p.width-1;p==null||p.updateRows(v.map((w,x)=>[{string:wi(w,y),alpha:lF(x)}]))}}{const[p,g]=ft().cursor,v={char:"",tint:65399,tileSet:"tile",alpha:0,x:p.x,y:p.y};ft().gameState===ee.INSPECT||ft().gameState===ee.TARGET?(e==null||e.updateCell({2:{...v,alpha:0,x:p.x,y:p.y}}),e==null||e.updateCell({2:{...v,alpha:.25,x:g.x,y:g.y}})):e==null||e.updateCell({2:{...v,alpha:0,x:g.x,y:g.y}})}const t=ft().views.hud,[r]=vu;if(t){const p=[[{string:"Forcecrusher"}],[],[{string:`Zone: ${ft().zoneId}`}],[],[{string:"LV: 1"}],[{string:`HP: ${(f=r==null?void 0:r.health)==null?void 0:f.current}/${(d=r==null?void 0:r.health)==null?void 0:d.max}`}],[],[{string:`AC: ${r==null?void 0:r.armorClass}`}],[{string:`ST: ${r==null?void 0:r.strength}`}],[{string:`DX: ${r==null?void 0:r.dexterity}`}],[{string:`CN: ${r==null?void 0:r.constitution}`}],[{string:`IN: ${r==null?void 0:r.intelligence}`}],[{string:`WI: ${r==null?void 0:r.wisdom}`}],[{string:`CH: ${r==null?void 0:r.charisma}`}]];t==null||t.clearView(),t==null||t.updateRows(p)}const n=ft().views.controls;if(n){let p="";ft().gameState===ee.GAME&&(p="(arrows/hjkl)Move (i)Inventory (L)Look"),ft().gameState===ee.INSPECT&&(p="(L/escape)Return to Game (arrows/hjkl)Move cursor"),ft().gameState===ee.TARGET&&(p="(t/escape)Return to Inventory (arrows/hjkl)Move cursor (enter)Throw item"),ft().gameState===ee.INVENTORY&&(p="(i/escape)Return to Game (d)Drop (c)Consume (t)Throw"),n==null||n.updateRows([[],[{string:p}]])}},uF=z.world.with("tryThrow"),cF=z.world.with("blocking","position"),fF=()=>{for(const e of uF){const{throwerId:t}=e.tryThrow,r=e.id,n=z.registry.get(t),i=e;if(!n){console.log(`dropperId: ${t} does not exist`),Pe(i),z.world.removeComponent(i,"tryThrow");break}if(!n.container){console.log(`thrower: ${t} has no container`),Pe(i),Pe(n),z.world.removeComponent(i,"tryThrow");break}let o,l,h=!1;if(n.position){const u=n.position,f=ft().cursor[1],d=lO(u,f);for(let p=0;p<Ut.tail(d).length;p++){const g=Ut.tail(d)[p];for(const v of cF)if(cO(v.position,g)){h=!0,o=v,l=d[p];break}if(h)break}}if(h){const u=l;u&&z.world.addComponent(i,"position",{...u}),o!=null&&o.health&&rF(n,o,i)}else{const u=ft().cursor[1];z.world.addComponent(i,"position",{...u}),me(`${n.name} throws ${i.name}`)}Ut.remove(n.container.contents,u=>r===u),z.world.removeComponent(i,"tryThrow")}},hm=["ArrowLeft","ArrowDown","ArrowUp","ArrowRight","h","j","k","l",">"],um=z.world.with("pc","position"),dF=z.world.with("pickUp"),pF=z.world.with("stairsUp","position"),gF=z.world.with("stairsDown","position"),ua=()=>{var i,o,l,h;const{userInput:e,gameState:t}=ft();if(!e)return kt(u=>{u.userInput=null});const{key:r}=e,[n]=um;if(t===ee.GAME){if(r==="1"&&z.saveGameData(),r==="2"&&z.loadGameData(),r===">"){const[u]=gF;if(Xg(n.position,u.position)){const{zoneId:f}=ft(),d=Wg(f),p={...d,z:d.z-1},g=yr(p);z.changeZone(g,ac.down)}}if(r==="<"){const[u]=pF;if(Xg(n.position,u.position)){const{zoneId:f}=ft(),d=Wg(f),p={...d,z:d.z+1},g=yr(p);z.changeZone(g,ac.up)}}if(r==="i"&&kt(u=>u.gameState=ee.INVENTORY),r==="L"&&(kt(u=>u.gameState=ee.INSPECT),kt(u=>u.cursor=[n.position,n.position])),hm.includes(r)){for(const u of um)if(u!=null&&u.position){const{x:f,y:d,z:p}=u.position;if(r==="h"||r==="ArrowLeft"){const g={x:f-1,y:d,z:p};z.world.addComponent(u,"tryMove",g)}if(r==="j"||r==="ArrowDown"){const g={x:f,y:d+1,z:p};z.world.addComponent(u,"tryMove",g)}if(r==="k"||r==="ArrowUp"){const g={x:f,y:d-1,z:p};z.world.addComponent(u,"tryMove",g)}if(r==="l"||r==="ArrowRight"){const g={x:f+1,y:d,z:p};z.world.addComponent(u,"tryMove",g)}}}if(r==="g"){let u=!0;for(const f of dF)if(n.position&&f.position&&yr(n.position)===yr(f.position)){const{id:d}=n;Ut.isUndefined(d)||(z.world.addComponent(f,"tryPickUp",{pickerId:d}),u=!1)}u&&me("There is nothing to pickup")}}if(t===ee.INSPECT||t===ee.TARGET){if(t===ee.INSPECT&&(r==="L"||r==="Escape")&&kt(u=>u.gameState=ee.GAME),t===ee.TARGET&&((r==="t"||r==="Escape")&&kt(u=>u.gameState=ee.INVENTORY),r==="Enter")){const u=(i=n.container)==null?void 0:i.contents[0];if(u){const f=z.registry.get(u);if(f){const d=n.id;Ut.isUndefined(d)||z.world.addComponent(f,"tryThrow",{throwerId:d})}}kt(f=>{f.turn=Ry.WORLD,f.gameState=ee.GAME})}if(hm.includes(r)&&n.position){const u=ft().cursor[1],{x:f,y:d,z:p}=u;if(r==="h"||r==="ArrowLeft"){const g={x:f-1,y:d,z:p};if(ia(g))return;kt(v=>{v.cursor=[u,g]})}if(r==="j"||r==="ArrowDown"){const g={x:f,y:d+1,z:p};if(ia(g))return;kt(v=>{v.cursor=[u,g]})}if(r==="k"||r==="ArrowUp"){const g={x:f,y:d-1,z:p};if(ia(g))return;kt(v=>{v.cursor=[u,g]})}if(r==="l"||r==="ArrowRight"){const g={x:f+1,y:d,z:p};if(ia(g))return;kt(v=>{v.cursor=[u,g]})}}}if(t===ee.INVENTORY){if((r==="i"||r==="Escape")&&kt(u=>u.gameState=ee.GAME),r==="d")do{if(!n.container){me("You can't drop without a container to hold.");break}if(!((o=n.container)!=null&&o.contents.length)){me("You have nothing to drop");break}const u=n.container.contents[0],f=z.registry.get(u);if(!f){console.log(`id: ${u} does not exist.`),Pe(n);break}const d=n.id;if(Ut.isUndefined(d))break;z.world.addComponent(f,"tryDrop",{dropperId:d});break}while(!0);if(r==="c")do{if(!n.container){me("You have no container to hold consumables");break}if(!((l=n.container)!=null&&l.contents.length)){me("You have nothing to consume");break}const u=n.container.contents[0],f=z.registry.get(u);if(!f){console.log(`id: ${u} does not exist.`),Pe(n);break}if(!f.consumable){me(`${n.name} cannot consume ${f.name}`);break}f.effects&&n.activeEffects.push(...f.effects),Ut.remove(n.container.contents,d=>u===d),me(`${n.name} consumes ${f.name}`),z.world.remove(f);break}while(!0);r==="t"&&(h=n.container)!=null&&h.contents.length&&kt(u=>{u.gameState=ee.TARGET,u.cursor=[n.position,n.position]})}kt(u=>{u.userInput=null})};var Ry=(e=>(e.PLAYER="PLAYER",e.WORLD="WORLD",e))(Ry||{}),ee=(e=>(e.GAME="GAME",e.GAME_OVER="GAME_OVER",e.INVENTORY="INVENTORY",e.INSPECT="INSPECT",e.TARGET="TARGET",e))(ee||{});window.skulltooth=window.skulltooth||{};window.skulltooth.debug=!1;const Us={cursor:[{x:0,y:0,z:0},{x:0,y:0,z:0}],fps:0,gameState:"GAME",log:["hello world","your adventure begins anew!"],senses:{feel:"You feel nothing.",see:"You see nothing.",hear:"You hear nothing.",smell:"You smell nothing.",taste:"You taste nothing."},turn:"PLAYER",userInput:null,views:{},zoneId:"0,0,0",playerId:"",version:1};window.skulltooth.state=Us;const kt=e=>{e(Us)},ft=()=>Us,mF=async()=>{await tO(document.querySelector("#canvas")),new cr({width:12,height:2,x:0,y:0,layers:2,tileSets:["tile","text"],tints:[16777215,16711799],alphas:[1,1],visible:!0}).updateRows([[{},{string:"skulltooth 2"}],[{tint:16711799},{string:"forcecrusher",tint:16777215}]]);const e=new cr({width:25,height:42,x:0,y:2,layers:1,tileSets:["text"],tints:[16711799],alphas:[1],visible:!0}),t=new cr({width:74,height:5,x:26,y:0,layers:1,tileSets:["text"],tints:[15658734],alphas:[1],visible:!0}),r=new cr({width:74,height:5,x:100,y:0,layers:1,tileSets:["text"],tints:[16711799],alphas:[1],visible:!0}),n=new cr({width:74,height:39,x:13,y:5,layers:3,tileSets:["tile","ascii","tile"],tints:[0,0,0],alphas:[1,1,0],visible:!0}),i=new cr({width:12,height:1,x:0,y:44,layers:1,tileSets:["text"],tints:[14540253],alphas:[1],visible:!0}).updateRows([[{string:"FPS: calc..."}]]);new cr({width:12,height:1,x:0,y:45,layers:1,tileSets:["text"],tints:[16777215],alphas:[1],visible:!0}).updateRows([[{string:"TAG: 9376080"}]]);const o=new cr({width:26,height:46,x:174,y:0,layers:1,tileSets:["text"],tints:[14540253],alphas:[1],visible:!0}),l=new cr({width:148,height:2,x:26,y:44,layers:1,tileSets:["text"],tints:[15658734],alphas:[1],visible:!0}),h=new cr({width:100,height:44,x:0,y:0,layers:1,tileSets:["tile"],tints:[1118481],alphas:[.75],visible:!1}),u=new cr({width:148,height:39,x:26,y:5,layers:2,tileSets:["text","text"],tints:[1118481,16777215],alphas:[1],visible:!1});kt(v=>{v.views.fps=i,v.views.map=n,v.views.log=t,v.views.senses=r,v.views.legend=e,v.views.inventory=u,v.views.menuUnderlay=h,v.views.controls=l,v.views.hud=o});const f=dy();if(!f)return;const d=f.rooms[0].center,p=z.world.add(zO);p.position.x=d.x,p.position.y=d.y,p.position.z=d.z,kt(v=>{v.playerId=p.id}),z.saveZone(ft().zoneId),ba(),Ci(),My();const g=["Shift","Meta","Control","Alt"];document.addEventListener("keydown",v=>{g.includes(v.key)||kt(y=>{y.userInput=v})}),document.addEventListener("mousedown",v=>{const y=v.x-Us.views.map.layers[0].x,w=v.layerY-Us.views.map.layers[0].y,T=QB(y,w,0);if(window.skulltooth.debug===!0){const S=z.world.with("position");for(const E of S)T===yr(E.position)&&(console.log(T),Pe(E))}})};let yu=0,ca=Date.now(),fa=[];function My(){var e;requestAnimationFrame(My),ft().gameState==="INSPECT"&&ft().userInput&&ft().turn==="PLAYER"&&(ua(),im(),Ci()),ft().gameState==="TARGET"&&ft().userInput&&ft().turn==="PLAYER"&&(ua(),im(),fF(),Ci()),ft().gameState==="INVENTORY"&&ft().userInput&&ft().turn==="PLAYER"&&(ou(),ua(),sm(),ba(),Ci()),ft().gameState==="GAME"&&(ft().userInput&&ft().turn==="PLAYER"&&(ou(),ua(),aF(),sm(),lm(),om(),ba(),Ci(),ft().gameState==="GAME"&&kt(t=>{t.turn="WORLD"})),ft().turn==="WORLD"&&(ou(),om(),X2(),lm(),ba(),Ci(),kt(t=>{t.turn="PLAYER"}))),ca||(ca=Date.now()),Date.now()-ca>1e3&&(fa.unshift(yu),fa.length>3&&fa.pop(),isNaN(ft().fps)||(e=ft().views.fps)==null||e.updateRow({string:`FPS: ${ft().fps}     `,layer:0,x:0,y:0,tileSet:"text"}),ca=Date.now(),yu=0),kt(t=>t.fps=Math.round(Ut.mean(fa))),yu++}mF();
